<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>KSFoundation: KSFoundation_common.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="KarolinskaLogo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">KSFoundation
   &#160;<span id="projectnumber">[Feb-2019]</span>
   </div>
   <div id="projectbrief">A platform for simpler EPIC programming on GE MR systems</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_k_s_foundation__common_8c.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">KSFoundation_common.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a6d84b666d948d2167844ac88f05d8c8c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a6d84b666d948d2167844ac88f05d8c8c">ABORT_ON_KSERROR</a>&#160;&#160;&#160;0</td></tr>
<tr class="separator:a6d84b666d948d2167844ac88f05d8c8c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:abf203f668f25e2c05338fddeb1bb1434"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a> (const char *format,...)</td></tr>
<tr class="separator:abf203f668f25e2c05338fddeb1bb1434"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0077bec1cb7fd1cccf8f35a978242ff7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a0077bec1cb7fd1cccf8f35a978242ff7">ks_dbg_reset</a> ()</td></tr>
<tr class="separator:a0077bec1cb7fd1cccf8f35a978242ff7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abdc1fc916ea7bfbc3ce222f646ee3ae9"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#abdc1fc916ea7bfbc3ce222f646ee3ae9">ks_dbg</a> (const char *format,...)</td></tr>
<tr class="separator:abdc1fc916ea7bfbc3ce222f646ee3ae9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a27447cc04cbace6c280b78bb72c5f5d8"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a27447cc04cbace6c280b78bb72c5f5d8">ks_syslimits_hasICEhardware</a> ()</td></tr>
<tr class="separator:a27447cc04cbace6c280b78bb72c5f5d8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5c919c547ee396b18069ed505c695139"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a5c919c547ee396b18069ed505c695139">ks_syslimits_ampmax</a> (LOG_GRAD <a class="el" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>)</td></tr>
<tr class="separator:a5c919c547ee396b18069ed505c695139"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4b3a3095702bf551f318ef9f03ff3403"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a4b3a3095702bf551f318ef9f03ff3403">ks_syslimits_ampmax2</a> (LOG_GRAD <a class="el" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>)</td></tr>
<tr class="separator:a4b3a3095702bf551f318ef9f03ff3403"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a431729c0ecf331b33d84db72a80debaf"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a431729c0ecf331b33d84db72a80debaf">ks_syslimits_ampmax1</a> (LOG_GRAD <a class="el" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>)</td></tr>
<tr class="separator:a431729c0ecf331b33d84db72a80debaf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa65115d54842eeffc47a1b324caa62ab"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#aa65115d54842eeffc47a1b324caa62ab">ks_syslimits_gradtarget</a> (LOG_GRAD <a class="el" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>, WF_PROCESSOR board)</td></tr>
<tr class="separator:aa65115d54842eeffc47a1b324caa62ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a72446af13d4f4cd0dc9caf51bd58f88e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a72446af13d4f4cd0dc9caf51bd58f88e">ks_syslimits_ramptimemax</a> (LOG_GRAD <a class="el" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>)</td></tr>
<tr class="separator:a72446af13d4f4cd0dc9caf51bd58f88e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a712d215e449900b4fc566fefff51b4e9"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a712d215e449900b4fc566fefff51b4e9">ks_syslimits_slewrate</a> (LOG_GRAD <a class="el" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>)</td></tr>
<tr class="separator:a712d215e449900b4fc566fefff51b4e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a53d792432e1fd99fa597314576fa9e49"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a53d792432e1fd99fa597314576fa9e49">ks_syslimits_slewrate2</a> (LOG_GRAD <a class="el" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>)</td></tr>
<tr class="separator:a53d792432e1fd99fa597314576fa9e49"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaeea7c06ce455978cce287cf28c22a4f"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#aaeea7c06ce455978cce287cf28c22a4f">ks_syslimits_slewrate1</a> (LOG_GRAD <a class="el" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>)</td></tr>
<tr class="separator:aaeea7c06ce455978cce287cf28c22a4f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a20bd7aa0fe253faf974ef414e91481a0"><td class="memItemLeft" align="right" valign="top">short&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a20bd7aa0fe253faf974ef414e91481a0">ks_phase_radians2hw</a> (float phase)</td></tr>
<tr class="separator:a20bd7aa0fe253faf974ef414e91481a0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa875ce80cee0a35eb44d31f981de253a"><td class="memItemLeft" align="right" valign="top">short&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#aa875ce80cee0a35eb44d31f981de253a">ks_phase_degrees2hw</a> (float phase)</td></tr>
<tr class="separator:aa875ce80cee0a35eb44d31f981de253a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9261718b4f0e64bab0da0b9e9c2c02f0"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a9261718b4f0e64bab0da0b9e9c2c02f0">ks_calc_selgradamp</a> (float rfbw, float slthick)</td></tr>
<tr class="separator:a9261718b4f0e64bab0da0b9e9c2c02f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ffabfee55fc92b35511d263092f6ea9"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a6ffabfee55fc92b35511d263092f6ea9">ks_calc_minfov</a> (float ampmax, int tsp)</td></tr>
<tr class="separator:a6ffabfee55fc92b35511d263092f6ea9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a296e894800a7f533250c6ae58e625da9"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a296e894800a7f533250c6ae58e625da9">ks_calc_minslthick</a> (float bw)</td></tr>
<tr class="separator:a296e894800a7f533250c6ae58e625da9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3957455e4a8980ae7cf4dc1edefa5a4e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a3957455e4a8980ae7cf4dc1edefa5a4e">ks_calc_mintsp</a> (float ampmax, float fov)</td></tr>
<tr class="separator:a3957455e4a8980ae7cf4dc1edefa5a4e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeb07c1278254f0a40622fbbe10566f57"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#aeb07c1278254f0a40622fbbe10566f57">ks_calc_fov2gradareapixel</a> (float fov)</td></tr>
<tr class="separator:aeb07c1278254f0a40622fbbe10566f57"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ab9211cdefcc0e167b71289e23829bc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a6ab9211cdefcc0e167b71289e23829bc">ks_phaseencoding_init_tgt</a> (<a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *phaseenc_plan_ptr)</td></tr>
<tr class="separator:a6ab9211cdefcc0e167b71289e23829bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9712828cb11bdaf20671ac4e43c80d3a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html">KS_PHASEENCODING_COORD</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a9712828cb11bdaf20671ac4e43c80d3a">ks_phaseencoding_get</a> (const <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *phaseenc_plan_ptr, int echo, int shot)</td></tr>
<tr class="separator:a9712828cb11bdaf20671ac4e43c80d3a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb524977b3e7a48a58dad2370166df9b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#abb524977b3e7a48a58dad2370166df9b">ks_phaseencoding_set</a> (<a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *phaseenc_plan_ptr, int echo, int shot, int ky, int kz)</td></tr>
<tr class="separator:abb524977b3e7a48a58dad2370166df9b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab37bdbd70185618b80d077f99b253616"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#ab37bdbd70185618b80d077f99b253616">ks_phaseencoding_print</a> (const <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *phaseenc_plan_ptr)</td></tr>
<tr class="separator:ab37bdbd70185618b80d077f99b253616"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad3b39ba8c626f4580806078dc4f4b211"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#ad3b39ba8c626f4580806078dc4f4b211">ks_phaseencoding_resize</a> (<a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *phaseenc_plan_ptr, int etl, int num_shots)</td></tr>
<tr class="separator:ad3b39ba8c626f4580806078dc4f4b211"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa887db0578a0780ccd7ed143e858588c"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#aa887db0578a0780ccd7ed143e858588c">ks_phaseencoding_generate_simple</a> (<a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *phaseenc_plan_ptr, const char *const desc, <a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *phaser, <a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *zphaser)</td></tr>
<tr class="separator:aa887db0578a0780ccd7ed143e858588c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa067bf0cb6e0bfc4a1d39f4fe760f213"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#aa067bf0cb6e0bfc4a1d39f4fe760f213">ks_phaseencoding_generate_simple_ellipse</a> (<a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *phaseenc_plan_ptr, const char *const desc, <a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *phaser, <a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *zphaser)</td></tr>
<tr class="separator:aa067bf0cb6e0bfc4a1d39f4fe760f213"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad6d4710baf0864b0e04ba55908a52666"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#ad6d4710baf0864b0e04ba55908a52666">ks_fse_calcecho</a> (double *bestecho, double *optecho, <a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *pe, int TE, int etl, int esp)</td></tr>
<tr class="separator:ad6d4710baf0864b0e04ba55908a52666"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6101f1a037684c71a6c5d654671824f9"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a6101f1a037684c71a6c5d654671824f9">ks_phaseencoding_generate_2Dfse</a> (<a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *phaseenc_plan_ptr, const char *const desc, <a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *phaser, <a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *zphaser, int TE, int etl, int esp)</td></tr>
<tr class="separator:a6101f1a037684c71a6c5d654671824f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab437a342f7b8f05dbe9efd90c6dd989f"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#ab437a342f7b8f05dbe9efd90c6dd989f">ks_phaseencoding_generate_epi</a> (<a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *phaseenc_plan_ptr, const char *const desc, <a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *epitrain, int blipsign, int numkyshots, int numsegments, int caipi_delta)</td></tr>
<tr class="separator:ab437a342f7b8f05dbe9efd90c6dd989f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa672c7e32ce3bce20534fa814901e720"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#aa672c7e32ce3bce20534fa814901e720">ks_wave_res</a> (const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave)</td></tr>
<tr class="separator:aa672c7e32ce3bce20534fa814901e720"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adf7aec11f0fecce133070402558215ff"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#adf7aec11f0fecce133070402558215ff">ks_waveform_max</a> (const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a> waveform, int res)</td></tr>
<tr class="separator:adf7aec11f0fecce133070402558215ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8309ba456fc3e23a10111a1439b13e21"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a8309ba456fc3e23a10111a1439b13e21">ks_wave_max</a> (const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave)</td></tr>
<tr class="separator:a8309ba456fc3e23a10111a1439b13e21"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb6bc5f956fac809f44006a5b2698ee6"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#abb6bc5f956fac809f44006a5b2698ee6">ks_waveform_min</a> (const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a> waveform, int res)</td></tr>
<tr class="separator:abb6bc5f956fac809f44006a5b2698ee6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adce100a7702e71bfb10377f1652465a2"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#adce100a7702e71bfb10377f1652465a2">ks_wave_min</a> (const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave)</td></tr>
<tr class="separator:adce100a7702e71bfb10377f1652465a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a838f4d91abbaf80203c3c6cc3797d036"><td class="memItemLeft" align="right" valign="top">short&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a838f4d91abbaf80203c3c6cc3797d036">ks_iwave_absmax</a> (const <a class="el" href="_k_s_foundation_8h.html#abba996c24da629eea72eecbd9a22a873">KS_IWAVE</a> waveform, int res)</td></tr>
<tr class="separator:a838f4d91abbaf80203c3c6cc3797d036"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf8e5bff3973c32360bc0e1505db61bc"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#abf8e5bff3973c32360bc0e1505db61bc">ks_waveform_absmax</a> (const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a> waveform, int res)</td></tr>
<tr class="separator:abf8e5bff3973c32360bc0e1505db61bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2bfec427bf5a8966edf279b2eba23396"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a2bfec427bf5a8966edf279b2eba23396">ks_wave_absmax</a> (const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave)</td></tr>
<tr class="separator:a2bfec427bf5a8966edf279b2eba23396"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7e9a8aad6f58220e83c48dd10d9a5e3c"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a7e9a8aad6f58220e83c48dd10d9a5e3c">ks_waveform_area</a> (const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a> waveform, int start, int end, int dwelltime)</td></tr>
<tr class="separator:a7e9a8aad6f58220e83c48dd10d9a5e3c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ed01e2c72db1252e516b9c2b098bbee"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a1ed01e2c72db1252e516b9c2b098bbee">ks_wave_area</a> (const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave, int start, int end)</td></tr>
<tr class="separator:a1ed01e2c72db1252e516b9c2b098bbee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a836fc0fca52fac39fbecc05b3f1b2329"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a836fc0fca52fac39fbecc05b3f1b2329">ks_waveform_sum</a> (const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a> waveform, int res)</td></tr>
<tr class="separator:a836fc0fca52fac39fbecc05b3f1b2329"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a147f6b9c40c1978fde2395ac2a97a88f"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a147f6b9c40c1978fde2395ac2a97a88f">ks_wave_sum</a> (const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave)</td></tr>
<tr class="separator:a147f6b9c40c1978fde2395ac2a97a88f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5128fc94664d4d81425a461ea4a73b09"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a5128fc94664d4d81425a461ea4a73b09">ks_waveform_norm</a> (const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a> waveform, int res)</td></tr>
<tr class="separator:a5128fc94664d4d81425a461ea4a73b09"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4bc0ca8d038d6083ad28d01f37cb946c"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a4bc0ca8d038d6083ad28d01f37cb946c">ks_wave_norm</a> (const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave)</td></tr>
<tr class="separator:a4bc0ca8d038d6083ad28d01f37cb946c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a01ad5d5e6870a3b956943a73b348d69d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a01ad5d5e6870a3b956943a73b348d69d">ks_waveform_cumsum</a> (<a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a> cumsumwaveform, const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a> waveform, int res)</td></tr>
<tr class="separator:a01ad5d5e6870a3b956943a73b348d69d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af2f69e088a1a8833c9b3e1cad2119321"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#af2f69e088a1a8833c9b3e1cad2119321">ks_wave_cumsum</a> (<a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *cumsumwave, const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave)</td></tr>
<tr class="separator:af2f69e088a1a8833c9b3e1cad2119321"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a183b6f1b3697030d122bb4a0cfda5619"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a183b6f1b3697030d122bb4a0cfda5619">ks_waveform_multiply</a> (<a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a> waveform_mod, const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a> waveform, int res)</td></tr>
<tr class="separator:a183b6f1b3697030d122bb4a0cfda5619"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a89145883bc5e8fcf4a93002535aa50a3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a89145883bc5e8fcf4a93002535aa50a3">ks_wave_multiply</a> (<a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave_mod, const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave)</td></tr>
<tr class="separator:a89145883bc5e8fcf4a93002535aa50a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a23f59d14bb955dd5a9e19bb705cb70"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a0a23f59d14bb955dd5a9e19bb705cb70">ks_waveform_add</a> (<a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a> waveform_mod, const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a> waveform, int res)</td></tr>
<tr class="separator:a0a23f59d14bb955dd5a9e19bb705cb70"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a74cda06697c45a3c9914e6b091be5efb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a74cda06697c45a3c9914e6b091be5efb">ks_wave_add</a> (<a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave_mod, const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave)</td></tr>
<tr class="separator:a74cda06697c45a3c9914e6b091be5efb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ace0cae3befbb3608319f34a61657bc26"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#ace0cae3befbb3608319f34a61657bc26">ks_waveform_multiplyval</a> (<a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a> waveform, float val, int res)</td></tr>
<tr class="separator:ace0cae3befbb3608319f34a61657bc26"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a23b3d305df1e2ad0563f8a2fea2330df"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a23b3d305df1e2ad0563f8a2fea2330df">ks_wave_multiplyval</a> (<a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave, float val)</td></tr>
<tr class="separator:a23b3d305df1e2ad0563f8a2fea2330df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae029b50a84f55155fdca946ec828e3fc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#ae029b50a84f55155fdca946ec828e3fc">ks_waveform_addval</a> (<a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a> waveform, float val, int res)</td></tr>
<tr class="separator:ae029b50a84f55155fdca946ec828e3fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a66a14bcaf8bf19a334866090c1f2ee49"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a66a14bcaf8bf19a334866090c1f2ee49">ks_wave_addval</a> (<a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave, float val)</td></tr>
<tr class="separator:a66a14bcaf8bf19a334866090c1f2ee49"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8a25c2686e8915b6953cee6568ec69e3"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a8a25c2686e8915b6953cee6568ec69e3">ks_waveform2iwave</a> (<a class="el" href="_k_s_foundation_8h.html#abba996c24da629eea72eecbd9a22a873">KS_IWAVE</a> iwave, const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a> waveform, int res, int board)</td></tr>
<tr class="separator:a8a25c2686e8915b6953cee6568ec69e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9506a3d2dc5e084c69dda40e8e127a97"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a9506a3d2dc5e084c69dda40e8e127a97">ks_wave2iwave</a> (<a class="el" href="_k_s_foundation_8h.html#abba996c24da629eea72eecbd9a22a873">KS_IWAVE</a> iwave, const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave, int board)</td></tr>
<tr class="separator:a9506a3d2dc5e084c69dda40e8e127a97"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a220c36b2fe5f7910508f38d66cfd6335"><td class="memItemLeft" align="right" valign="top">WF_PULSE *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a220c36b2fe5f7910508f38d66cfd6335">ks_pg_echossp</a> (WF_PULSE *echo, char *suffix)</td></tr>
<tr class="separator:a220c36b2fe5f7910508f38d66cfd6335"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab3341eea000c35a438dfeb3cfc1da103"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#ab3341eea000c35a438dfeb3cfc1da103">ks_pg_trap</a> (<a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> *trap, <a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> loc, <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *ctrl)</td></tr>
<tr class="separator:ab3341eea000c35a438dfeb3cfc1da103"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a82a797ba7a2ddcd48502d834c2a067b6"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a82a797ba7a2ddcd48502d834c2a067b6">ks_pg_phaser</a> (<a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *phaser, <a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> loc, <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *ctrl)</td></tr>
<tr class="separator:a82a797ba7a2ddcd48502d834c2a067b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3bed936c3bb14d2d25d5ddbaa3d54007"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a3bed936c3bb14d2d25d5ddbaa3d54007">ks_pg_read</a> (<a class="el" href="struct_k_s___r_e_a_d.html">KS_READ</a> *read, int pos, <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *ctrl)</td></tr>
<tr class="separator:a3bed936c3bb14d2d25d5ddbaa3d54007"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9310a853d09f6db581a771a9b274f01d"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a9310a853d09f6db581a771a9b274f01d">ks_pg_readtrap</a> (<a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a> *readtrap, <a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> loc, <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *ctrl)</td></tr>
<tr class="separator:a9310a853d09f6db581a771a9b274f01d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9c5ace140d91043230e2e5364a0be90b"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a9c5ace140d91043230e2e5364a0be90b">ks_pg_wave</a> (<a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave, <a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> loc, <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *ctrl)</td></tr>
<tr class="separator:a9c5ace140d91043230e2e5364a0be90b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc74b390428f6607e8c540f6b4182407"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#acc74b390428f6607e8c540f6b4182407">ks_pg_rf</a> (<a class="el" href="struct_k_s___r_f.html">KS_RF</a> *rf, <a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> loc, <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *ctrl)</td></tr>
<tr class="separator:acc74b390428f6607e8c540f6b4182407"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3ac7fbefbe1b3e6b8bca64e64a927130"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a3ac7fbefbe1b3e6b8bca64e64a927130">ks_pg_selrf</a> (<a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *selrf, <a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> loc, <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *ctrl)</td></tr>
<tr class="separator:a3ac7fbefbe1b3e6b8bca64e64a927130"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeea9a34f36ca48eda6882d9426a4e638"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#aeea9a34f36ca48eda6882d9426a4e638">ks_pg_wait</a> (<a class="el" href="struct_k_s___w_a_i_t.html">KS_WAIT</a> *wait, <a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> loc, <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *ctrl)</td></tr>
<tr class="separator:aeea9a34f36ca48eda6882d9426a4e638"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aada57f8dd7b50aacf95e65220950547f"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#aada57f8dd7b50aacf95e65220950547f">ks_pg_isirot</a> (<a class="el" href="struct_k_s___i_s_i_r_o_t.html">KS_ISIROT</a> *isirot, SCAN_INFO scan_info, int pos, void *rotfun, <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *ctrl)</td></tr>
<tr class="separator:aada57f8dd7b50aacf95e65220950547f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f4f5dedf466061d2d764c1a11e2b06c"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a5f4f5dedf466061d2d764c1a11e2b06c">ks_pg_epi_dephasers</a> (<a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *epi, <a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> loc, <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *ctrl)</td></tr>
<tr class="separator:a5f4f5dedf466061d2d764c1a11e2b06c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a14fed222bd2a857b8e1514f2e8e958c8"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a14fed222bd2a857b8e1514f2e8e958c8">ks_pg_epi_rephasers</a> (<a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *epi, <a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> loc, <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *ctrl)</td></tr>
<tr class="separator:a14fed222bd2a857b8e1514f2e8e958c8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a57a2d3f6e79ef085c2918652d22a3296"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a57a2d3f6e79ef085c2918652d22a3296">ks_pg_epi_echo</a> (<a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *epi, <a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> loc, <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *ctrl)</td></tr>
<tr class="separator:a57a2d3f6e79ef085c2918652d22a3296"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a491c005da937fd4ae3469a26ce87fabb"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a491c005da937fd4ae3469a26ce87fabb">ks_pg_epi</a> (<a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *epi, <a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> loc, <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *ctrl)</td></tr>
<tr class="separator:a491c005da937fd4ae3469a26ce87fabb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43efb5f9eb84e0ace408cd1a74825f3f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a43efb5f9eb84e0ace408cd1a74825f3f">ks_pg_mod_fse_rfpulse_structs</a> (<a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *rf1, <a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *rf2, <a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *rf3, const double *flip_angles, const int etl)</td></tr>
<tr class="separator:a43efb5f9eb84e0ace408cd1a74825f3f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adee331638310d0a0ed1c726c02051e1b"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#adee331638310d0a0ed1c726c02051e1b">ks_pg_fse_flip_angle_taperoff</a> (double *flip_angles, int etl, double flip1, double flip2, double flip3, double target_flip, int start_middle)</td></tr>
<tr class="separator:adee331638310d0a0ed1c726c02051e1b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad4f6f11e79e686edc745fb372307da07"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#ad4f6f11e79e686edc745fb372307da07">ks_instancereset_trap</a> (<a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> *trap)</td></tr>
<tr class="separator:ad4f6f11e79e686edc745fb372307da07"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ef78e75e7d598cbd08cf10cb31f0220"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a6ef78e75e7d598cbd08cf10cb31f0220">ks_instancereset_wave</a> (<a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave)</td></tr>
<tr class="separator:a6ef78e75e7d598cbd08cf10cb31f0220"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aad9c2e7d88da5870c5326fff22fef2b8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#aad9c2e7d88da5870c5326fff22fef2b8">ks_instancereset_wait</a> (<a class="el" href="struct_k_s___w_a_i_t.html">KS_WAIT</a> *wait)</td></tr>
<tr class="separator:aad9c2e7d88da5870c5326fff22fef2b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ace40879ab8ead831e2cb4813d0c129c7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#ace40879ab8ead831e2cb4813d0c129c7">ks_instancereset_phaser</a> (<a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *phaser)</td></tr>
<tr class="separator:ace40879ab8ead831e2cb4813d0c129c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeb15e81750dea5de7e46585faf05cdc7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#aeb15e81750dea5de7e46585faf05cdc7">ks_instancereset_readtrap</a> (<a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a> *read)</td></tr>
<tr class="separator:aeb15e81750dea5de7e46585faf05cdc7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7f71a623c82d573e0418c143e8ecec56"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a7f71a623c82d573e0418c143e8ecec56">ks_instancereset_rf</a> (<a class="el" href="struct_k_s___r_f.html">KS_RF</a> *rf)</td></tr>
<tr class="separator:a7f71a623c82d573e0418c143e8ecec56"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ace7a321746aada2f87551d05f5a4a77f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#ace7a321746aada2f87551d05f5a4a77f">ks_instancereset_selrf</a> (<a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *selrf)</td></tr>
<tr class="separator:ace7a321746aada2f87551d05f5a4a77f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3944bb2736d992be3c1b512d8dfb0ce8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a3944bb2736d992be3c1b512d8dfb0ce8">ks_instancereset_epi</a> (<a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *epi)</td></tr>
<tr class="separator:a3944bb2736d992be3c1b512d8dfb0ce8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7a01a25fab5445b8ba0d31def1d8eb22"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a7a01a25fab5445b8ba0d31def1d8eb22">ks_mat4_zero</a> (<a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a> m)</td></tr>
<tr class="separator:a7a01a25fab5445b8ba0d31def1d8eb22"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3cf10f4e08ef58cf5122ed6bbef18cd8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a3cf10f4e08ef58cf5122ed6bbef18cd8">ks_mat4_identity</a> (<a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a> m)</td></tr>
<tr class="separator:a3cf10f4e08ef58cf5122ed6bbef18cd8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af4ff614f0e15263516162ae891a85e3b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#af4ff614f0e15263516162ae891a85e3b">ks_mat4_print</a> (const <a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a> m)</td></tr>
<tr class="separator:af4ff614f0e15263516162ae891a85e3b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7860cb28ef3d14b565548f0cf546ef9b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a7860cb28ef3d14b565548f0cf546ef9b">ks_mat4_multiply</a> (<a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a> lhs, const <a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a> rhs_left, const <a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a> rhs_right)</td></tr>
<tr class="separator:a7860cb28ef3d14b565548f0cf546ef9b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa73a59f910febec479331b756b4e0b0b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#aa73a59f910febec479331b756b4e0b0b">ks_mat4_invert</a> (<a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a> lhs, const <a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a> rhs)</td></tr>
<tr class="separator:aa73a59f910febec479331b756b4e0b0b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a72637d90aca1ebbbbc0fa6b9fa905070"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a72637d90aca1ebbbbc0fa6b9fa905070">ks_mat4_setgeometry</a> (<a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a> lhs, float x, float y, float z, float xr, float yr, float zr)</td></tr>
<tr class="separator:a72637d90aca1ebbbbc0fa6b9fa905070"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a52b5ac8e52a9813764edfb25fc43842e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a52b5ac8e52a9813764edfb25fc43842e">ks_mat4_setrotation1axis</a> (<a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a> rhs, float rot, char axis)</td></tr>
<tr class="separator:a52b5ac8e52a9813764edfb25fc43842e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ace371e00b197f1e2810b8d113b367266"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#ace371e00b197f1e2810b8d113b367266">ks_mat4_extractrotation</a> (<a class="el" href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a> R, const <a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a> M)</td></tr>
<tr class="separator:ace371e00b197f1e2810b8d113b367266"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5367cf93c8126b5e1ebe7af1455bd12f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a5367cf93c8126b5e1ebe7af1455bd12f">ks_mat4_extracttranslation</a> (double *T, const <a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a> M)</td></tr>
<tr class="separator:a5367cf93c8126b5e1ebe7af1455bd12f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a90b2a40a2ec0d6386acd1a882826db29"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a90b2a40a2ec0d6386acd1a882826db29">ks_mat3_identity</a> (<a class="el" href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a> m)</td></tr>
<tr class="separator:a90b2a40a2ec0d6386acd1a882826db29"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef9748ef561f24658a823f99823bf9f3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#aef9748ef561f24658a823f99823bf9f3">ks_mat3_multiply</a> (<a class="el" href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a> lhs, const <a class="el" href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a> rhs_left, const <a class="el" href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a> rhs_right)</td></tr>
<tr class="separator:aef9748ef561f24658a823f99823bf9f3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa256047bba2d4ee8f8b0244323dc4d65"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#aa256047bba2d4ee8f8b0244323dc4d65">ks_mat3_print</a> (const <a class="el" href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a> m)</td></tr>
<tr class="separator:aa256047bba2d4ee8f8b0244323dc4d65"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a028d9a1107a86d282f556e43658ada9b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a028d9a1107a86d282f556e43658ada9b">ks_mat3_apply</a> (double *w, const <a class="el" href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a> R, const double *v)</td></tr>
<tr class="separator:a028d9a1107a86d282f556e43658ada9b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a22ac65cbd45dee4eec9f4f2612af92a8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a22ac65cbd45dee4eec9f4f2612af92a8">ks_mat3_invapply</a> (double *w, const <a class="el" href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a> R, const double *v)</td></tr>
<tr class="separator:a22ac65cbd45dee4eec9f4f2612af92a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acee69d0d4db843c9923ab78fd3939009"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#acee69d0d4db843c9923ab78fd3939009">ks_compare_wfi_by_timeboard</a> (const <a class="el" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a> *a, const <a class="el" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a> *b)</td></tr>
<tr class="separator:acee69d0d4db843c9923ab78fd3939009"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:addfe7afa496fc5757c450680db49dc5f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#addfe7afa496fc5757c450680db49dc5f">ks_compare_wfi_by_boardtime</a> (const <a class="el" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a> *a, const <a class="el" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a> *b)</td></tr>
<tr class="separator:addfe7afa496fc5757c450680db49dc5f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d24ff69a16ddb94bd6317e6c5594fe1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a3d24ff69a16ddb94bd6317e6c5594fe1">ks_compare_wfp_by_time</a> (const WF_PULSE *a, const WF_PULSE *b)</td></tr>
<tr class="separator:a3d24ff69a16ddb94bd6317e6c5594fe1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ae65ed3cc2deb47ccf50b7988239474"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a0ae65ed3cc2deb47ccf50b7988239474">ks_sort_wfi_by_timeboard</a> (<a class="el" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a> *a, int nitems)</td></tr>
<tr class="separator:a0ae65ed3cc2deb47ccf50b7988239474"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a007ba9525cc536f29132ee8e320fa08a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a007ba9525cc536f29132ee8e320fa08a">ks_sort_wfi_by_boardtime</a> (<a class="el" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a> *a, int nitems)</td></tr>
<tr class="separator:a007ba9525cc536f29132ee8e320fa08a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a42180e710dc1f89e9a557683f8f58dda"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a42180e710dc1f89e9a557683f8f58dda">ks_sort_wfp_by_time</a> (WF_PULSE *a, int nitems)</td></tr>
<tr class="separator:a42180e710dc1f89e9a557683f8f58dda"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a768cbf2348344d4c2203bb79b821b2ff"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a768cbf2348344d4c2203bb79b821b2ff">ks_compare_pshort</a> (const void *v1, const void *v2)</td></tr>
<tr class="separator:a768cbf2348344d4c2203bb79b821b2ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad09ed4b8371bcc1dd3d873c1ee5587ed"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#ad09ed4b8371bcc1dd3d873c1ee5587ed">ks_compare_pint</a> (const void *v1, const void *v2)</td></tr>
<tr class="separator:ad09ed4b8371bcc1dd3d873c1ee5587ed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4fb225b10c94cbba0ea15b6a97848c3d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a4fb225b10c94cbba0ea15b6a97848c3d">ks_compare_pfloat</a> (const void *v1, const void *v2)</td></tr>
<tr class="separator:a4fb225b10c94cbba0ea15b6a97848c3d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7e439a9bad95e13f0909674391e7f0fc"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a7e439a9bad95e13f0909674391e7f0fc">ks_compare_short</a> (const void *v1, const void *v2)</td></tr>
<tr class="separator:a7e439a9bad95e13f0909674391e7f0fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3ba108e0606acf6fca3664f186be0289"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a3ba108e0606acf6fca3664f186be0289">ks_compare_int</a> (const void *v1, const void *v2)</td></tr>
<tr class="separator:a3ba108e0606acf6fca3664f186be0289"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a39ba8e8e94e7a55ea699b0f29c862016"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a39ba8e8e94e7a55ea699b0f29c862016">ks_compare_float</a> (const void *v1, const void *v2)</td></tr>
<tr class="separator:a39ba8e8e94e7a55ea699b0f29c862016"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a72adf83f1d9ed4592227259113eed4ea"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a72adf83f1d9ed4592227259113eed4ea">ks_sort_getsortedindx</a> (int *sortedindx, int *array, int n)</td></tr>
<tr class="separator:a72adf83f1d9ed4592227259113eed4ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a39b939060ef2d2772d6ab7a0817c0ec2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a39b939060ef2d2772d6ab7a0817c0ec2">ks_sort_getsortedindx_s</a> (int *sortedindx, short *array, int n)</td></tr>
<tr class="separator:a39b939060ef2d2772d6ab7a0817c0ec2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa8ba7c47c66d40b3df50e6228f66920d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#aa8ba7c47c66d40b3df50e6228f66920d">ks_sort_getsortedindx_f</a> (int *sortedindx, float *array, int n)</td></tr>
<tr class="separator:aa8ba7c47c66d40b3df50e6228f66920d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae136d8a2e504e06e8592185e85fecfde"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#ae136d8a2e504e06e8592185e85fecfde">ks_plot_slicetime_begin</a> ()</td></tr>
<tr class="separator:ae136d8a2e504e06e8592185e85fecfde"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a309a0d3b32c7f1325610f0dceed920bd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a309a0d3b32c7f1325610f0dceed920bd">ks_plot_slicetime</a> (<a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *ctrl, int nslices, float *slicepos_mm, float slthick_mm, <a class="el" href="_k_s_foundation_8h.html#a0ba82984ac3a22ad68cab5bce5224cf9">KS_PLOT_EXCITATION_MODE</a> excmode)</td></tr>
<tr class="separator:a309a0d3b32c7f1325610f0dceed920bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aedea7098cfed857c923844b3f1052037"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#aedea7098cfed857c923844b3f1052037">ks_plot_slicetime_endofpass</a> (<a class="el" href="_k_s_foundation_8h.html#a41f5719fe6c2d60e864572e00af44342">KS_PLOT_PASS_MODE</a> pass_mode)</td></tr>
<tr class="separator:aedea7098cfed857c923844b3f1052037"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aadb6109f3b3f75f81b46e153f9eb11f0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#aadb6109f3b3f75f81b46e153f9eb11f0">ks_plot_slicetime_endofslicegroup</a> (const char *desc)</td></tr>
<tr class="separator:aadb6109f3b3f75f81b46e153f9eb11f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6eab83ca87166f306eb449a94a354ec6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a6eab83ca87166f306eb449a94a354ec6">ks_plot_slicetime_end</a> ()</td></tr>
<tr class="separator:a6eab83ca87166f306eb449a94a354ec6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb36a5018815d55e357775e8515f220d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#abb36a5018815d55e357775e8515f220d">ks_plot_tgt_reset</a> (<a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *ctrl)</td></tr>
<tr class="separator:abb36a5018815d55e357775e8515f220d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa4d70e1b753a44f18ce002ecb84cd16e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#aa4d70e1b753a44f18ce002ecb84cd16e">ks_plot_tgt_addframe</a> (<a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *ctrl)</td></tr>
<tr class="separator:aa4d70e1b753a44f18ce002ecb84cd16e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a88386ac54f37a7fb0dc91302e585ccae"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a88386ac54f37a7fb0dc91302e585ccae">ks_eval_addtraptogradrfctrl</a> (<a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html">KS_GRADRFCTRL</a> *gradrfctrl, <a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> *trap)</td></tr>
<tr class="separator:a88386ac54f37a7fb0dc91302e585ccae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad92221de8b8b3281d9bf0794c50a34bb"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#ad92221de8b8b3281d9bf0794c50a34bb">ks_eval_addwavetogradrfctrl</a> (<a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html">KS_GRADRFCTRL</a> *gradrfctrl, <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave)</td></tr>
<tr class="separator:ad92221de8b8b3281d9bf0794c50a34bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a75283b5758c55ab4d0530fb9f05b22fd"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a75283b5758c55ab4d0530fb9f05b22fd">ks_eval_addrftogradrfctrl</a> (<a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html">KS_GRADRFCTRL</a> *gradrfctrl, <a class="el" href="struct_k_s___r_f.html">KS_RF</a> *rf)</td></tr>
<tr class="separator:a75283b5758c55ab4d0530fb9f05b22fd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a58400508a44d80fc140baeb987f7c435"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a58400508a44d80fc140baeb987f7c435">ks_eval_addreadtogradrfctrl</a> (<a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html">KS_GRADRFCTRL</a> *gradrfctrl, <a class="el" href="struct_k_s___r_e_a_d.html">KS_READ</a> *read)</td></tr>
<tr class="separator:a58400508a44d80fc140baeb987f7c435"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a48609b98dac5c8f7619bc0521f58d6e3"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a48609b98dac5c8f7619bc0521f58d6e3">ks_scan_rf_phase_spoiling</a> (int counter)</td></tr>
<tr class="separator:a48609b98dac5c8f7619bc0521f58d6e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ae202b6536335ff4d767690e182e8fc4f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#ae202b6536335ff4d767690e182e8fc4f">maxGradRes</a></td></tr>
<tr class="separator:ae202b6536335ff4d767690e182e8fc4f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a35c854f1f8f79b61a77569e84e172018"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a35c854f1f8f79b61a77569e84e172018">cfswgut</a></td></tr>
<tr class="separator:a35c854f1f8f79b61a77569e84e172018"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a49fda6ebed3a78faf1db4fcbfd412de4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a49fda6ebed3a78faf1db4fcbfd412de4">cfswrfut</a></td></tr>
<tr class="separator:a49fda6ebed3a78faf1db4fcbfd412de4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a636634b6eb50758af3826332f9180e9b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a636634b6eb50758af3826332f9180e9b">psd_rf_wait</a></td></tr>
<tr class="separator:a636634b6eb50758af3826332f9180e9b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa4225c3edfbcb8e85d91fc491a495058"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#aa4225c3edfbcb8e85d91fc491a495058">psd_grd_wait</a></td></tr>
<tr class="separator:aa4225c3edfbcb8e85d91fc491a495058"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2875ace95558531062d08465b2bcc282"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a></td></tr>
<tr class="separator:a2875ace95558531062d08465b2bcc282"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a08b87aaf68a5eef056188032b386db46"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a08b87aaf68a5eef056188032b386db46">cffield</a></td></tr>
<tr class="separator:a08b87aaf68a5eef056188032b386db46"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ccc8c2f78537b7bc8c8a63ee32ac83f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a2ccc8c2f78537b7bc8c8a63ee32ac83f">cfssctype</a></td></tr>
<tr class="separator:a2ccc8c2f78537b7bc8c8a63ee32ac83f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad3c11a6737769e103948d107c1263749"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#ad3c11a6737769e103948d107c1263749">opfov</a></td></tr>
<tr class="separator:ad3c11a6737769e103948d107c1263749"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a66aaa6a3300240048d37097ded69ba53"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a66aaa6a3300240048d37097ded69ba53">opxres</a></td></tr>
<tr class="separator:a66aaa6a3300240048d37097ded69ba53"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a62476b720a40200e94668beec660cac0"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a62476b720a40200e94668beec660cac0">opyres</a></td></tr>
<tr class="separator:a62476b720a40200e94668beec660cac0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a04f737cdd207318e145bbed14eb487ae"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a04f737cdd207318e145bbed14eb487ae">opslthick</a></td></tr>
<tr class="separator:a04f737cdd207318e145bbed14eb487ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2e788c6338615164f241b755f219c961"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a2e788c6338615164f241b755f219c961">rhkacq_uid</a></td></tr>
<tr class="separator:a2e788c6338615164f241b755f219c961"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adf724d7e25607bea3d8bf36bb6f8060d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#adf724d7e25607bea3d8bf36bb6f8060d">ks_plot_filefmt</a></td></tr>
<tr class="separator:adf724d7e25607bea3d8bf36bb6f8060d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af846b49be109f687e9863f2016029516"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#af846b49be109f687e9863f2016029516">ks_psdname</a> [256]</td></tr>
<tr class="separator:af846b49be109f687e9863f2016029516"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5fc997556910df5890ca1c407984674d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a5fc997556910df5890ca1c407984674d">abort_on_kserror</a> = <a class="el" href="_k_s_foundation__common_8c.html#a6d84b666d948d2167844ac88f05d8c8c">ABORT_ON_KSERROR</a></td></tr>
<tr class="separator:a5fc997556910df5890ca1c407984674d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4dcd93b4f67aeb25541105ec7953c67e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__common_8c.html#a4dcd93b4f67aeb25541105ec7953c67e">ks_rhoboard</a> = TYPRHO1</td></tr>
<tr class="separator:a4dcd93b4f67aeb25541105ec7953c67e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This file contains functions accessible on both HOST and TGT. </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a6d84b666d948d2167844ac88f05d8c8c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6d84b666d948d2167844ac88f05d8c8c">&#9670;&nbsp;</a></span>ABORT_ON_KSERROR</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ABORT_ON_KSERROR&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="abf203f668f25e2c05338fddeb1bb1434"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abf203f668f25e2c05338fddeb1bb1434">&#9670;&nbsp;</a></span>ks_error()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_error </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>format</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;                                         {</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="keywordtype">char</span> errstring[1000];</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  FILE *fp;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  time_t mytime;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="keywordtype">char</span> mydatestr[100];</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <span class="keyword">extern</span> <span class="keywordtype">char</span> <a class="code" href="_k_s_foundation__common_8c.html#af846b49be109f687e9863f2016029516">ks_psdname</a>[];</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  va_list args;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  va_start(args, format);</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  vsprintf(errstring, format, args);</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  va_end(args);</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  mytime = time(NULL);</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  sprintf(mydatestr, <span class="stringliteral">&quot;%s&quot;</span>, ctime(&amp;mytime));</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  mydatestr[strcspn(mydatestr, <span class="stringliteral">&quot;\n&quot;</span>)] = 0; <span class="comment">/* remove newline character */</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="preprocessor">#ifdef PSD_HW</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  <span class="comment">/* if on MR scanner (HOST and TGT/IPG, HW=hardware=MRscanner) */</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  fp = fopen(<span class="stringliteral">&quot;/usr/g/mrraw/ks_errors.txt&quot;</span>, <span class="stringliteral">&quot;a+&quot;</span>);</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <span class="comment">/* in WTools (simulation)  (HOST and TGT/IPG) */</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  fp = stdout;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <span class="comment">/* tgt.c: TGT/IPG side */</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;TGT ERROR %s [%s]: %s\n&quot;</span>, <a class="code" href="_k_s_foundation__common_8c.html#af846b49be109f687e9863f2016029516">ks_psdname</a>, mydatestr, errstring);</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  <span class="comment">/* host.c: HOST side */</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;HOST ERROR %s [%s]: %s\n&quot;</span>, <a class="code" href="_k_s_foundation__common_8c.html#af846b49be109f687e9863f2016029516">ks_psdname</a>, mydatestr, errstring);</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  fflush(fp);</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="preprocessor">#ifdef PSD_HW</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <span class="comment">/* if on MR scanner */</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  fclose(fp);</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="preprocessor">#if defined(HOST_TGT)</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <span class="comment">/* HOST_TGT: HOST for either WTools or MR scanner */</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  epic_error( 0, errstring, 0, EE_ARGS(0));</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#a5fc997556910df5890ca1c407984674d">abort_on_kserror</a>) {</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    abort();</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  }</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a5fc997556910df5890ca1c407984674d"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a5fc997556910df5890ca1c407984674d">abort_on_kserror</a></div><div class="ttdeci">int abort_on_kserror</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:44</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_af846b49be109f687e9863f2016029516"><div class="ttname"><a href="_k_s_foundation__common_8c.html#af846b49be109f687e9863f2016029516">ks_psdname</a></div><div class="ttdeci">char ks_psdname[256]</div><div class="ttdef"><b>Definition:</b> GERequired.e:218</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0077bec1cb7fd1cccf8f35a978242ff7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0077bec1cb7fd1cccf8f35a978242ff7">&#9670;&nbsp;</a></span>ks_dbg_reset()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_dbg_reset </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Clear debug file content</h4>
</p>
<div class="fragment"><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                    {</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  FILE *fp;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">/* if on MR scanner (HOST and TGT/IPG, HW=hardware=MRscanner) */</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="preprocessor">#ifdef PSD_HW</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  fp = fopen(<span class="stringliteral">&quot;/usr/g/mrraw/ks_debug.txt&quot;</span>, <span class="stringliteral">&quot;w&quot;</span>);</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  fp = fopen(<span class="stringliteral">&quot;./ks_debug.txt&quot;</span>, <span class="stringliteral">&quot;w&quot;</span>);</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;fclose(fp);</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="abdc1fc916ea7bfbc3ce222f646ee3ae9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abdc1fc916ea7bfbc3ce222f646ee3ae9">&#9670;&nbsp;</a></span>ks_dbg()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_dbg </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>format</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                                       {</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  <span class="keywordtype">char</span> fname[1000];</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <span class="keywordtype">char</span> <span class="keywordtype">string</span>[1000];</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  FILE *fp;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  time_t mytime;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <span class="keywordtype">char</span> mydatestr[100];</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="keyword">extern</span> <span class="keywordtype">char</span> <a class="code" href="_k_s_foundation__common_8c.html#af846b49be109f687e9863f2016029516">ks_psdname</a>[];</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  va_list args;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  va_start(args, format);</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  vsprintf(<span class="keywordtype">string</span>, format, args);</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  va_end(args);</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  mytime = time(NULL);</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  sprintf(mydatestr, <span class="stringliteral">&quot;%s&quot;</span>, ctime(&amp;mytime));</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  mydatestr[strcspn(mydatestr, <span class="stringliteral">&quot;\n&quot;</span>)] = 0; <span class="comment">/* remove newline character */</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="preprocessor">#ifdef PSD_HW</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="comment">/* MR scanner */</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  sprintf(fname, <span class="stringliteral">&quot;/usr/g/mrraw/ks_debug.txt&quot;</span>);</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <span class="comment">/* Simulation (WTools) */</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  sprintf(fname, <span class="stringliteral">&quot;./ks_debug.txt&quot;</span>);</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  fp = fopen(fname, <span class="stringliteral">&quot;a+&quot;</span>);</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;%s [%s]: %s\n&quot;</span>, <a class="code" href="_k_s_foundation__common_8c.html#af846b49be109f687e9863f2016029516">ks_psdname</a>, mydatestr, <span class="keywordtype">string</span>);</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  fflush(fp);</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  fclose(fp);</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_af846b49be109f687e9863f2016029516"><div class="ttname"><a href="_k_s_foundation__common_8c.html#af846b49be109f687e9863f2016029516">ks_psdname</a></div><div class="ttdeci">char ks_psdname[256]</div><div class="ttdef"><b>Definition:</b> GERequired.e:218</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a27447cc04cbace6c280b78bb72c5f5d8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a27447cc04cbace6c280b78bb72c5f5d8">&#9670;&nbsp;</a></span>ks_syslimits_hasICEhardware()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_syslimits_hasICEhardware </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Check for ICE Hardware (e.g. RX27+ on SIGNA Premier)</h4>
</p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">int</td><td>1: ICE 0: MGD </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                                  {</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <span class="keywordtype">int</span> isice = FALSE;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="preprocessor">#if EPIC_RELEASE &gt;= 27</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  isice = <a class="code" href="_k_s_foundation__common_8c.html#a2ccc8c2f78537b7bc8c8a63ee32ac83f">cfssctype</a>;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  <span class="keywordflow">return</span> isice;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a2ccc8c2f78537b7bc8c8a63ee32ac83f"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a2ccc8c2f78537b7bc8c8a63ee32ac83f">cfssctype</a></div><div class="ttdeci">int cfssctype</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a5c919c547ee396b18069ed505c695139"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5c919c547ee396b18069ed505c695139">&#9670;&nbsp;</a></span>ks_syslimits_ampmax()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_syslimits_ampmax </td>
          <td>(</td>
          <td class="paramtype">LOG_GRAD&#160;</td>
          <td class="paramname"><em>loggrd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the maximum gradient amplitude that can be used on all gradient boards simultaneously</h4>
</p>
<p>Since the waveform design (using <code>ks_eval_***()</code> functions) is separated from the placement of waveforms (using <code>ks_pg_***()</code> functions), the maximum gradient limit to use for gradient design must account for the least capable gradient board given the current slice angulation. <a class="el" href="_k_s_foundation_8h.html#a5c919c547ee396b18069ed505c695139" title="Returns the maximum gradient amplitude that can be used on all gradient boards simultaneously">ks_syslimits_ampmax()</a> assumes that all gradients may be on simultaneously</p>
<p>The return value from this function can be passed in as <code>ampmax</code> to all <code>ks_eval***_constrained()</code> functions</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">loggrd</td><td>GE's LOG_GRAD struct, dependent on the gradient system and current slice angulation </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">gradmax</td><td>Maximum gradient amplitude ([G/cm]) that can be used on all boards simultaneously </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                                           {</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <span class="keywordflow">return</span> (FMin(3, <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>.tx_xyz, <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>.ty_xyz, <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>.tz_xyz));</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4b3a3095702bf551f318ef9f03ff3403"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4b3a3095702bf551f318ef9f03ff3403">&#9670;&nbsp;</a></span>ks_syslimits_ampmax2()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_syslimits_ampmax2 </td>
          <td>(</td>
          <td class="paramtype">LOG_GRAD&#160;</td>
          <td class="paramname"><em>loggrd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the maximum gradient amplitude that can be used on two gradient boards simultaneously</h4>
</p>
<p>Since the waveform design (using <code>ks_eval_***()</code> functions) is separated from the placement of waveforms (using <code>ks_pg_***()</code> functions), the maximum gradient limit to use for gradient design must account for the least capable gradient board given the current slice angulation. <a class="el" href="_k_s_foundation_8h.html#a4b3a3095702bf551f318ef9f03ff3403" title="Returns the maximum gradient amplitude that can be used on two gradient boards simultaneously">ks_syslimits_ampmax2()</a> assumes that gradients are played out on at most one more board at the same time as the current trapezoid</p>
<p>The return value from this function can be passed in as <code>ampmax</code> to all <code>ks_eval***_constrained()</code> functions</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">loggrd</td><td>GE's LOG_GRAD struct, dependent on the gradient system and current slice angulation </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">gradmax</td><td>Maximum gradient amplitude ([G/cm]) that can be used on 2 boards simultaneously </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                                            {</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <span class="keywordflow">return</span> (FMin(6, <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>.tx_xy, <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>.tx_xz, <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>.ty_xy, <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>.ty_yz, <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>.tz_xz, <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>.tz_yz));</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a431729c0ecf331b33d84db72a80debaf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a431729c0ecf331b33d84db72a80debaf">&#9670;&nbsp;</a></span>ks_syslimits_ampmax1()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_syslimits_ampmax1 </td>
          <td>(</td>
          <td class="paramtype">LOG_GRAD&#160;</td>
          <td class="paramname"><em>loggrd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the maximum gradient amplitude that can be used on all gradient boards simultaneously</h4>
</p>
<p>Since the waveform design (using <code>ks_eval_***()</code> functions) is separated from the placement of waveforms (using <code>ks_pg_***()</code> functions), the maximum gradient limit to use for gradient design must account for the least capable gradient board given the current slice angulation. <a class="el" href="_k_s_foundation_8h.html#a431729c0ecf331b33d84db72a80debaf" title="Returns the maximum gradient amplitude that can be used on all gradient boards simultaneously">ks_syslimits_ampmax1()</a> assumes that no other gradient is played out on another board at the same time as the current trapezoid</p>
<p>The return value from this function can be passed in as <code>ampmax</code> to all <code>ks_eval***_constrained()</code> functions</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">loggrd</td><td>GE's LOG_GRAD struct, dependent on the gradient system and current slice angulation </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">gradmax</td><td>Maximum gradient amplitude ([G/cm]) that can be used on 2 boards simultaneously </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                                            {</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  <span class="keywordflow">return</span> (FMin(3, <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>.tx, <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>.ty, <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>.tz));</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa65115d54842eeffc47a1b324caa62ab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa65115d54842eeffc47a1b324caa62ab">&#9670;&nbsp;</a></span>ks_syslimits_gradtarget()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_syslimits_gradtarget </td>
          <td>(</td>
          <td class="paramtype">LOG_GRAD&#160;</td>
          <td class="paramname"><em>loggrd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">WF_PROCESSOR&#160;</td>
          <td class="paramname"><em>board</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the maximum target amplitude for a board (<em>internal use</em>)</h4>
</p>
<p>For gradient boards, the field <code>.tx</code>, <code>.ty</code> or <code>.tz</code> is returned. For non-gradient boards, 1.0 is returned. This function is used internally by <code>ks_pg_***()</code> functions and there should be no need to call it directly.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">loggrd</td><td>GE's LOG_GRAD struct, dependent on the gradient system and current slice angulation </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">board</td><td>The board on which the current trapezoid or waveform is to be played out on </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">gradamp</td><td>Maximum target amplitude for a board </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                                                                   {</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  <span class="keywordflow">switch</span> (board) {</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  <span class="keywordflow">case</span> XGRAD:</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>.tx;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  <span class="keywordflow">case</span> YGRAD:</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>.ty;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  <span class="keywordflow">case</span> ZGRAD:</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>.tz;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  <span class="keywordflow">default</span>:</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="keywordflow">return</span> 1.0;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  }</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a72446af13d4f4cd0dc9caf51bd58f88e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a72446af13d4f4cd0dc9caf51bd58f88e">&#9670;&nbsp;</a></span>ks_syslimits_ramptimemax()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_syslimits_ramptimemax </td>
          <td>(</td>
          <td class="paramtype">LOG_GRAD&#160;</td>
          <td class="paramname"><em>loggrd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the minimum ramp time to get from zero to full gradient scale</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">loggrd</td><td>GE's LOG_GRAD struct, dependent on the gradient system and current slice angulation </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">ramptime</td><td>Ramptime in [us] to get from zero to full gradient scale </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                                              {</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  <span class="comment">/* ramptime at full gradient scale */</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  <span class="keywordflow">return</span> IMax(3, <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>.xrt, <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>.yrt, <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>.zrt);</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a712d215e449900b4fc566fefff51b4e9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a712d215e449900b4fc566fefff51b4e9">&#9670;&nbsp;</a></span>ks_syslimits_slewrate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_syslimits_slewrate </td>
          <td>(</td>
          <td class="paramtype">LOG_GRAD&#160;</td>
          <td class="paramname"><em>loggrd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the maximum slewrate that can be used on all gradient boards simultaneously</h4>
</p>
<p>The return value from this function is the ratio of <a class="el" href="_k_s_foundation_8h.html#a5c919c547ee396b18069ed505c695139" title="Returns the maximum gradient amplitude that can be used on all gradient boards simultaneously">ks_syslimits_ampmax()</a> and <a class="el" href="_k_s_foundation_8h.html#a72446af13d4f4cd0dc9caf51bd58f88e" title="Returns the minimum ramp time to get from zero to full gradient scale">ks_syslimits_ramptimemax()</a> and can be passed in as <code>slewrate</code> to all <code>ks_eval***_constrained()</code> functions</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">loggrd</td><td>GE's LOG_GRAD struct, dependent on the gradient system and current slice angulation </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">slewrate</td><td>Maximum slewrate ([(G/cm) / us]) that can be used on all boards simultaneously </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                                             {</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  <span class="keywordflow">return</span> (<a class="code" href="_k_s_foundation__common_8c.html#a5c919c547ee396b18069ed505c695139">ks_syslimits_ampmax</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>) / <a class="code" href="_k_s_foundation__common_8c.html#a72446af13d4f4cd0dc9caf51bd58f88e">ks_syslimits_ramptimemax</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>));</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a5c919c547ee396b18069ed505c695139"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a5c919c547ee396b18069ed505c695139">ks_syslimits_ampmax</a></div><div class="ttdeci">float ks_syslimits_ampmax(LOG_GRAD loggrd)</div><div class="ttdoc">Returns the maximum gradient amplitude that can be used on all gradient boards simultaneously</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:163</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a72446af13d4f4cd0dc9caf51bd58f88e"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a72446af13d4f4cd0dc9caf51bd58f88e">ks_syslimits_ramptimemax</a></div><div class="ttdeci">int ks_syslimits_ramptimemax(LOG_GRAD loggrd)</div><div class="ttdoc">Returns the minimum ramp time to get from zero to full gradient scale</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:190</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a53d792432e1fd99fa597314576fa9e49"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a53d792432e1fd99fa597314576fa9e49">&#9670;&nbsp;</a></span>ks_syslimits_slewrate2()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_syslimits_slewrate2 </td>
          <td>(</td>
          <td class="paramtype">LOG_GRAD&#160;</td>
          <td class="paramname"><em>loggrd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the maximum slewrate that can be used on two gradient boards simultaneously</h4>
</p>
<p>The return value from this function is the ratio of <a class="el" href="_k_s_foundation_8h.html#a4b3a3095702bf551f318ef9f03ff3403" title="Returns the maximum gradient amplitude that can be used on two gradient boards simultaneously">ks_syslimits_ampmax2()</a> and <a class="el" href="_k_s_foundation_8h.html#a72446af13d4f4cd0dc9caf51bd58f88e" title="Returns the minimum ramp time to get from zero to full gradient scale">ks_syslimits_ramptimemax()</a> and can be passed in as <code>slewrate</code> to all <code>ks_eval***_constrained()</code> functions</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">loggrd</td><td>GE's LOG_GRAD struct, dependent on the gradient system and current slice angulation </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">slewrate</td><td>Maximum slewrate ([(G/cm) / us]) that can be used on all boards simultaneously </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                                              {</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  <span class="keywordflow">return</span> (<a class="code" href="_k_s_foundation__common_8c.html#a4b3a3095702bf551f318ef9f03ff3403">ks_syslimits_ampmax2</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>) / <a class="code" href="_k_s_foundation__common_8c.html#a72446af13d4f4cd0dc9caf51bd58f88e">ks_syslimits_ramptimemax</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>));</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a4b3a3095702bf551f318ef9f03ff3403"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a4b3a3095702bf551f318ef9f03ff3403">ks_syslimits_ampmax2</a></div><div class="ttdeci">float ks_syslimits_ampmax2(LOG_GRAD loggrd)</div><div class="ttdoc">Returns the maximum gradient amplitude that can be used on two gradient boards simultaneously</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:167</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a72446af13d4f4cd0dc9caf51bd58f88e"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a72446af13d4f4cd0dc9caf51bd58f88e">ks_syslimits_ramptimemax</a></div><div class="ttdeci">int ks_syslimits_ramptimemax(LOG_GRAD loggrd)</div><div class="ttdoc">Returns the minimum ramp time to get from zero to full gradient scale</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:190</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aaeea7c06ce455978cce287cf28c22a4f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaeea7c06ce455978cce287cf28c22a4f">&#9670;&nbsp;</a></span>ks_syslimits_slewrate1()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_syslimits_slewrate1 </td>
          <td>(</td>
          <td class="paramtype">LOG_GRAD&#160;</td>
          <td class="paramname"><em>loggrd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the maximum slewrate that can be used on one gradient board at a time</h4>
</p>
<p>The return value from this function is the ratio of <a class="el" href="_k_s_foundation_8h.html#a431729c0ecf331b33d84db72a80debaf" title="Returns the maximum gradient amplitude that can be used on all gradient boards simultaneously">ks_syslimits_ampmax1()</a> and <a class="el" href="_k_s_foundation_8h.html#a72446af13d4f4cd0dc9caf51bd58f88e" title="Returns the minimum ramp time to get from zero to full gradient scale">ks_syslimits_ramptimemax()</a> and can be passed in as <code>slewrate</code> to all <code>ks_eval***_constrained()</code> functions</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">loggrd</td><td>GE's LOG_GRAD struct, dependent on the gradient system and current slice angulation </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">slewrate</td><td>Maximum slewrate ([(G/cm) / us]) that can be used on all boards simultaneously </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                                              {</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <span class="keywordflow">return</span> (<a class="code" href="_k_s_foundation__common_8c.html#a431729c0ecf331b33d84db72a80debaf">ks_syslimits_ampmax1</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>) / <a class="code" href="_k_s_foundation__common_8c.html#a72446af13d4f4cd0dc9caf51bd58f88e">ks_syslimits_ramptimemax</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>));</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a431729c0ecf331b33d84db72a80debaf"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a431729c0ecf331b33d84db72a80debaf">ks_syslimits_ampmax1</a></div><div class="ttdeci">float ks_syslimits_ampmax1(LOG_GRAD loggrd)</div><div class="ttdoc">Returns the maximum gradient amplitude that can be used on all gradient boards simultaneously</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:171</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a72446af13d4f4cd0dc9caf51bd58f88e"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a72446af13d4f4cd0dc9caf51bd58f88e">ks_syslimits_ramptimemax</a></div><div class="ttdeci">int ks_syslimits_ramptimemax(LOG_GRAD loggrd)</div><div class="ttdoc">Returns the minimum ramp time to get from zero to full gradient scale</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:190</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a20bd7aa0fe253faf974ef414e91481a0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a20bd7aa0fe253faf974ef414e91481a0">&#9670;&nbsp;</a></span>ks_phase_radians2hw()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">short ks_phase_radians2hw </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>radphase</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the integer phase (<em>not in use</em>)</h4>
</p>
<p>All phase values in KSFoundation are in [degrees], including flip angles, RF/receive phases and THETA waveforms. This function is therefore currently not used. See instead <a class="el" href="_k_s_foundation_8h.html#acc2435255232dccd6cd217bc605422cd" title="Returns the integer phase (internal use)">ks_phase_degrees2hw()</a></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">radphase</td><td>Phase in radians </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">intphase</td><td>Integer phase to use on THETA board on hardware </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                                       {</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  <span class="keywordtype">short</span> iphase;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  UINT uiphase;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  <span class="keywordtype">double</span> dphase = (double) phase;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <span class="keywordtype">double</span> twopi = (double) 2.0 * PI;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  <span class="comment">/* Resolve angle to lie within range ( -2*pi &lt;= dphase &lt; 2*pi ) */</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  dphase = fmod(dphase, twopi);</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <span class="comment">/* Find the equivalent positive angle */</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <span class="keywordflow">if</span> (dphase &lt; 0.0)</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    dphase = twopi + dphase;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  <span class="comment">/* Convert the angle to exciter DDS phase representation where only the</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment">     upper 14 bits of 16 are used */</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  uiphase = (UINT) (dphase * 16384.0 / twopi + 0.5);</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <span class="keywordflow">if</span> (uiphase == 16384)</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    uiphase = 0;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <span class="comment">/* left shift the result by 2 bits */</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  iphase = (short) (uiphase &lt;&lt; 2);</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  <span class="keywordflow">return</span> iphase;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="aa875ce80cee0a35eb44d31f981de253a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa875ce80cee0a35eb44d31f981de253a">&#9670;&nbsp;</a></span>ks_phase_degrees2hw()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">short ks_phase_degrees2hw </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>degphase</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the integer phase (<em>internal use</em>)</h4>
</p>
<p>All phase values in KSFoundation are in [degrees], including flip angles, RF/receive phases and THETA waveforms. This function is used internally by another internal function <a class="el" href="_k_s_foundation_8h.html#a016372aaa6f16b986000c56b9792fefd" title="(Internal use) Conversion of waveform content in a KS_WAVE sequence object to a short int array for u...">ks_wave2iwave()</a>, which is in turn called by <a class="el" href="_k_s_foundation_8h.html#afc06ade569c7b85c1aa5026fc2e1c710" title="Places a KS_WAVE sequence object on a board at some position in the pulse sequence">ks_pg_wave()</a></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">degphase</td><td>Phase in degrees </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">intphase</td><td>Integer phase to use on THETA board on hardware </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                                       {</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#a20bd7aa0fe253faf974ef414e91481a0">ks_phase_radians2hw</a>(phase * PI / 180.0);</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a20bd7aa0fe253faf974ef414e91481a0"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a20bd7aa0fe253faf974ef414e91481a0">ks_phase_radians2hw</a></div><div class="ttdeci">short ks_phase_radians2hw(float phase)</div><div class="ttdoc">Returns the integer phase (not in use)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:209</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9261718b4f0e64bab0da0b9e9c2c02f0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9261718b4f0e64bab0da0b9e9c2c02f0">&#9670;&nbsp;</a></span>ks_calc_selgradamp()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_calc_selgradamp </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>rfbw</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>slthick</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the gradient amplitude in [G/cm] necessary for slice selection (<em>internal use</em>)</h4>
</p>
<p>Given an RF bandwidth in [Hz] and a slice thickness in [mm], this function calculates the gradient strength in [G/cm] necessary to produce a slice with the given slice thickness</p>
<p>This function is used by <a class="el" href="_k_s_foundation_8h.html#a0c7c713519f3218a3b1afcb6917540c0" title="(Internal use) Sets up a trapezoid for RF slice selection">ks_eval_seltrap()</a>, <a class="el" href="_k_s_foundation_8h.html#a91443aae8a97c4481ba841f1bf3dc13a" title="Sets up a KS_SELRF object for RF slice selection, subject to gradients constraints specified as input...">ks_eval_selrf_constrained()</a> and <a class="el" href="_k_s_foundation_8h.html#ae8766ce800f95dd75ca2eece6638326c" title="Updates the frequency and phase of one or all instances of a slice selective RF pulse (KS_SELRF)...">ks_scan_selrf_setfreqphase()</a></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">rfbw</td><td>The bandwidth of the RF pulse to use with the gradient </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">slthick</td><td>The desired slice thickness in [mm] </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">gradamp</td><td>Gradient amplitude to use [G/cm] </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                                                    {</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  <span class="keywordflow">if</span> (slthick &gt; 0 &amp;&amp; rfbw &gt; 0)</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="keywordflow">return</span> (rfbw / (<a class="code" href="_k_s_foundation__common_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a> * slthick / 10.0));</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="keywordflow">return</span> 0.0; <span class="comment">/* return zero amp if requested slice thickness is &lt;= 0 */</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a2875ace95558531062d08465b2bcc282"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a></div><div class="ttdeci">float GAM</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6ffabfee55fc92b35511d263092f6ea9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6ffabfee55fc92b35511d263092f6ea9">&#9670;&nbsp;</a></span>ks_calc_minfov()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_calc_minfov </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>ampmax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>tsp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Calculates the minimum readout FOV</h4>
</p>
<p>Given a maximum allowed gradient amplitude in [G/cm] and a dwell time in [us] (see <a class="el" href="_k_s_foundation_8h.html#a955f51280beb0915d42853ad14eee700" title="Convert receiver bandwidth to dwell time">ks_calc_bw2tsp()</a>), the minimum possible readout FOV in [mm] is calculated. This function is called internally by <a class="el" href="_k_s_foundation_8h.html#adbc5d161b21228ab4d53c03911916961" title="Sets up an acquisition window with a trapezoid, subject to gradient constraints specified as input ar...">ks_eval_readtrap_constrained()</a> when rampsampling is not used (<code>.rampsampling = 0</code>)</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ampmax</td><td>The maximum allowed gradient amplitude ([G/cm]) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tsp</td><td>Duration in [us] for each data sample in the acquisition window. Minimum: 2 [us] </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">minFOV</td><td>Minimum FOV in the readout direction </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                                            {</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  <span class="keywordtype">float</span> minfov;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  minfov = ((float) (2 * (1.0e3 / (tsp * 2.0)) * 1000 / <a class="code" href="_k_s_foundation__common_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a>) * (10.0 / ampmax));</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  <span class="keywordflow">return</span> minfov;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a2875ace95558531062d08465b2bcc282"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a></div><div class="ttdeci">float GAM</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a296e894800a7f533250c6ae58e625da9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a296e894800a7f533250c6ae58e625da9">&#9670;&nbsp;</a></span>ks_calc_minslthick()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_calc_minslthick </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>bw</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Calculates the minimum slice thickness [mm]</h4>
</p>
<p>Given an RF bandwidth in [kHz], this function returns the minimum slice thickness possible given the gradient max amplitude.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">bw</td><td>RF bandwidth in [kHz] </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">minSliceThickness</td><td>Minimum slice thickness in [mm] </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                                   {</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <span class="keywordflow">return</span> (bw  / (<a class="code" href="_k_s_foundation__common_8c.html#a5c919c547ee396b18069ed505c695139">ks_syslimits_ampmax</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>) * (0.1) * <a class="code" href="_k_s_foundation__common_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a>));</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a2875ace95558531062d08465b2bcc282"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a></div><div class="ttdeci">float GAM</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a5c919c547ee396b18069ed505c695139"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a5c919c547ee396b18069ed505c695139">ks_syslimits_ampmax</a></div><div class="ttdeci">float ks_syslimits_ampmax(LOG_GRAD loggrd)</div><div class="ttdoc">Returns the maximum gradient amplitude that can be used on all gradient boards simultaneously</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:163</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3957455e4a8980ae7cf4dc1edefa5a4e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3957455e4a8980ae7cf4dc1edefa5a4e">&#9670;&nbsp;</a></span>ks_calc_mintsp()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_calc_mintsp </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>ampmax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>fov</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Calculates the minimum dwell time</h4>
</p>
<p>Given a maximum allowed gradient amplitude in [G/cm] and a readout FOV in [mm], the smallest dwell time (i.e. largest rBW) in [us] is calculated.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ampmax</td><td>The maximum allowed gradient amplitude ([G/cm]) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fov</td><td>FOV in the readout direction </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">tsp</td><td>Duration in [us] for each data sample in the acquisition window </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                                            {</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <span class="keywordtype">int</span> mintsp;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <span class="keywordtype">int</span> sysmintsp = 2;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  mintsp = (int) ceil(1.0e3 / (fov / ((<span class="keywordtype">float</span>) (2 * 1000 / <a class="code" href="_k_s_foundation__common_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a>) * (10.0 / ampmax)) * 2.0));</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <span class="keywordflow">if</span> (mintsp &lt; sysmintsp)</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    mintsp = mintsp;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  <span class="keywordflow">return</span> mintsp;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a2875ace95558531062d08465b2bcc282"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a></div><div class="ttdeci">float GAM</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aeb07c1278254f0a40622fbbe10566f57"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeb07c1278254f0a40622fbbe10566f57">&#9670;&nbsp;</a></span>ks_calc_fov2gradareapixel()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_calc_fov2gradareapixel </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>fov</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Calculates the gradient area needed to move one pixel in k-space</h4>
</p>
<p>Given a readout FOV in [mm], the gradient area needed to move one pixel in a fully sampled k-space is calculated</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">fov</td><td>FOV in the readout direction </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">area</td><td>Gradient area in [(G/cm) * us] </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                                             {</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  <span class="keywordflow">if</span> (fov &gt; 0) {</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="comment">/* G/cm * us. Area needed to move one pixel in k-space corresponding to the input FOV */</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="keywordflow">return</span> (1.0e6 / (fov / 10.0 * <a class="code" href="_k_s_foundation__common_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a>));</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="keywordflow">return</span> (0.0);</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  }</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a2875ace95558531062d08465b2bcc282"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a></div><div class="ttdeci">float GAM</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6ab9211cdefcc0e167b71289e23829bc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6ab9211cdefcc0e167b71289e23829bc">&#9670;&nbsp;</a></span>ks_phaseencoding_init_tgt()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_phaseencoding_init_tgt </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *&#160;</td>
          <td class="paramname"><em>phaseenc_plan_ptr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Internal use for correct migration of <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> from HOST to TGT (IPG)</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">phaseenc_plan_ptr</td><td>Pointer to <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                                                                         {</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  <span class="keywordflow">if</span> (phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#af7f2aa8614e77ef8af0154c7e071ab0e">is_cleared_on_tgt</a> == FALSE) {</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a94a0ea2c005add8c48c0ce371cc15a76">entries</a> = NULL; <span class="comment">/* clear memory pointer from HOST (which is garbage to the TGT) */</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a706b4cec8ea7b1363975e556d74de924">phaser</a> = NULL; <span class="comment">/* clear memory pointer from HOST (which is garbage to the TGT) */</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a08736562d66b16003d4e795e95860cf7">zphaser</a> = NULL; <span class="comment">/* clear memory pointer from HOST (which is garbage to the TGT) */</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#af7f2aa8614e77ef8af0154c7e071ab0e">is_cleared_on_tgt</a> = TRUE;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  }</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  (void) (phaseenc_plan_ptr);</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;}</div><div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_af7f2aa8614e77ef8af0154c7e071ab0e"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#af7f2aa8614e77ef8af0154c7e071ab0e">KS_PHASEENCODING_PLAN::is_cleared_on_tgt</a></div><div class="ttdeci">int is_cleared_on_tgt</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1593</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a94a0ea2c005add8c48c0ce371cc15a76"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a94a0ea2c005add8c48c0ce371cc15a76">KS_PHASEENCODING_PLAN::entries</a></div><div class="ttdeci">KS_PHASEENCODING_COORD * entries</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1590</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a08736562d66b16003d4e795e95860cf7"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a08736562d66b16003d4e795e95860cf7">KS_PHASEENCODING_PLAN::zphaser</a></div><div class="ttdeci">KS_PHASER * zphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1592</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a706b4cec8ea7b1363975e556d74de924"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a706b4cec8ea7b1363975e556d74de924">KS_PHASEENCODING_PLAN::phaser</a></div><div class="ttdeci">KS_PHASER * phaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1591</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9712828cb11bdaf20671ac4e43c80d3a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9712828cb11bdaf20671ac4e43c80d3a">&#9670;&nbsp;</a></span>ks_phaseencoding_get()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html">KS_PHASEENCODING_COORD</a> ks_phaseencoding_get </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *&#160;</td>
          <td class="paramname"><em>phaseenc_plan_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>echo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>shot</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Get [ky,kz] coordinate from <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> for given echo and shot</h4>
</p>
<p>If the .ky and .kz values returned by this function is = KS_NOTSET (-1), it indicates that this echo/shot combination should have zero phase encoding and should be ignored. For 2D, .kz will always be KS_NOTSET</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">phaseenc_plan_ptr</td><td>Pointer to <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">echo</td><td>Echo index in the sequence ETL in range <code>[0,ETL-1]</code> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">shot</td><td>Shot index (i.e. how many times the sequence is played out per slice). For 3D, this is the combined number of shots over ky and kz </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">&lt;tt&gt;KS_PHASEENCODING_COORD&lt;/tt&gt;</td><td></td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                                                                                                                {</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  <span class="keywordtype">int</span> oktoset = ((phaseenc_plan_ptr != NULL) &amp;&amp; phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a> != <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>) &amp;&amp; (phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#af7f2aa8614e77ef8af0154c7e071ab0e">is_cleared_on_tgt</a>);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  <span class="keywordtype">int</span> oktoset = (phaseenc_plan_ptr != NULL) &amp;&amp; phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a> != <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;#endif</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  if (!oktoset || !(phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a94a0ea2c005add8c48c0ce371cc15a76">entries</a>) ||</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;      shot &lt; 0 || shot &gt;= phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#aa2f98be84137da8386df3fc88763823c">num_shots</a> ||</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      echo &lt; 0 || echo &gt;= phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a>) {</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html">KS_PHASEENCODING_COORD</a> fake_coords = <a class="code" href="_k_s_foundation_8h.html#ae5e9ce52cebc9a6543bc6e69e9a03148">KS_INIT_PHASEENCODING_COORD</a>;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="keywordflow">return</span> fake_coords;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  }</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  <span class="keywordflow">return</span> phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a94a0ea2c005add8c48c0ce371cc15a76">entries</a>[echo + phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a> * shot];</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_ae5e9ce52cebc9a6543bc6e69e9a03148"><div class="ttname"><a href="_k_s_foundation_8h.html#ae5e9ce52cebc9a6543bc6e69e9a03148">KS_INIT_PHASEENCODING_COORD</a></div><div class="ttdeci">#define KS_INIT_PHASEENCODING_COORD</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:139</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_af7f2aa8614e77ef8af0154c7e071ab0e"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#af7f2aa8614e77ef8af0154c7e071ab0e">KS_PHASEENCODING_PLAN::is_cleared_on_tgt</a></div><div class="ttdeci">int is_cleared_on_tgt</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1593</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_aa2f98be84137da8386df3fc88763823c"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#aa2f98be84137da8386df3fc88763823c">KS_PHASEENCODING_PLAN::num_shots</a></div><div class="ttdeci">int num_shots</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1587</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a94a0ea2c005add8c48c0ce371cc15a76"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a94a0ea2c005add8c48c0ce371cc15a76">KS_PHASEENCODING_PLAN::entries</a></div><div class="ttdeci">KS_PHASEENCODING_COORD * entries</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1590</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_afd953f31b866a09e0418967c2bf65a59"><div class="ttname"><a href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a></div><div class="ttdeci">#define KS_NOTSET</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:60</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d_html"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html">KS_PHASEENCODING_COORD</a></div><div class="ttdoc">Struct holding a 3D k-space phase encoding location (ky,kz)</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1552</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a7582325a159d8ec89a4a4ba0fb89e9a9"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">KS_PHASEENCODING_PLAN::etl</a></div><div class="ttdeci">int etl</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1588</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="abb524977b3e7a48a58dad2370166df9b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abb524977b3e7a48a58dad2370166df9b">&#9670;&nbsp;</a></span>ks_phaseencoding_set()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_phaseencoding_set </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *&#160;</td>
          <td class="paramname"><em>phaseenc_plan_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>echo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>shot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ky</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>kz</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Set [ky,kz] coordinate from <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> for given echo and shot</h4>
</p>
<p>If the .ky and .kz values passed to this function is = KS_NOTSET (-1), it indicates that this echo/shot combination should have zero phase encoding and should be ignored. However, ignored echo/shot combinations are not necessary since the etl*num_shots entries in <code>.entries</code> of <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> are always initialized to KS_NOTSET by <a class="el" href="_k_s_foundation_8h.html#ad3b39ba8c626f4580806078dc4f4b211" title="Reallocate memory for KS_PHASEENCODING_PLAN entries">ks_phaseencoding_resize()</a>. Hence, it is only necessary to explicitly set the echo/shot combination for ky/kz coordinates being acquired.</p>
<p>For 2D, kz (5th arg) should always be KS_NOTSET.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">phaseenc_plan_ptr</td><td>Pointer to <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">echo</td><td>Echo index in the sequence ETL in range <code>[0,ETL-1]</code> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">shot</td><td>Shot index (in range [0,how many times the sequence is played out per slice - 1]). For 3D, this is the combined number of shots over ky and kz </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ky</td><td>K-space coordinate along the first (only for 2D) phase encoding direction (integer) in range <code>[0, phaser.numlinestoacq-1]</code> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">kz</td><td>K-space coordinate along the second (use KS_NOTSET for 2D) phase encoding direction (integer) in range <code>[0, zphaser.numlinestoacq-1]</code> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                                                                                                        {</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  <span class="keywordtype">int</span> oktoset = (phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a> != <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>) &amp;&amp; (phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#af7f2aa8614e77ef8af0154c7e071ab0e">is_cleared_on_tgt</a>);</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;  <span class="keywordtype">int</span> oktoset = phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a> != <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  <span class="keywordflow">if</span> (!oktoset || !phaseenc_plan_ptr || !(phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a94a0ea2c005add8c48c0ce371cc15a76">entries</a>) ||</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      shot &lt; 0 || shot &gt;= phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#aa2f98be84137da8386df3fc88763823c">num_shots</a> ||</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      echo &lt; 0 || echo &gt;= phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a>) {</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  }</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  ky = (ky &lt; 0) ? <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a> : ky; <span class="comment">/* KS_NOTSET = shut off phase encoding */</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  kz = (kz &lt; 0) ? <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a> : kz;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a94a0ea2c005add8c48c0ce371cc15a76">entries</a>[echo + phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a> * shot].<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#ad097e95262501d52829d5cd9a827275c">ky</a> = ky;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a94a0ea2c005add8c48c0ce371cc15a76">entries</a>[echo + phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a> * shot].<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#a7894f45c2928e5a523eeafc5ef4ae8b7">kz</a> = kz;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;}</div><div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_af7f2aa8614e77ef8af0154c7e071ab0e"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#af7f2aa8614e77ef8af0154c7e071ab0e">KS_PHASEENCODING_PLAN::is_cleared_on_tgt</a></div><div class="ttdeci">int is_cleared_on_tgt</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1593</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_aa2f98be84137da8386df3fc88763823c"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#aa2f98be84137da8386df3fc88763823c">KS_PHASEENCODING_PLAN::num_shots</a></div><div class="ttdeci">int num_shots</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1587</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a94a0ea2c005add8c48c0ce371cc15a76"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a94a0ea2c005add8c48c0ce371cc15a76">KS_PHASEENCODING_PLAN::entries</a></div><div class="ttdeci">KS_PHASEENCODING_COORD * entries</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1590</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_afd953f31b866a09e0418967c2bf65a59"><div class="ttname"><a href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a></div><div class="ttdeci">#define KS_NOTSET</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:60</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d_html_ad097e95262501d52829d5cd9a827275c"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#ad097e95262501d52829d5cd9a827275c">KS_PHASEENCODING_COORD::ky</a></div><div class="ttdeci">int ky</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1553</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d_html_a7894f45c2928e5a523eeafc5ef4ae8b7"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#a7894f45c2928e5a523eeafc5ef4ae8b7">KS_PHASEENCODING_COORD::kz</a></div><div class="ttdeci">int kz</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1554</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a7582325a159d8ec89a4a4ba0fb89e9a9"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">KS_PHASEENCODING_PLAN::etl</a></div><div class="ttdeci">int etl</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1588</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab37bdbd70185618b80d077f99b253616"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab37bdbd70185618b80d077f99b253616">&#9670;&nbsp;</a></span>ks_phaseencoding_print()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_phaseencoding_print </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *&#160;</td>
          <td class="paramname"><em>phaseenc_plan_ptr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Print out <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> to a text file</h4>
</p>
<p>In SIM (WTools), a file ks_phaseencodingtable.txt will be generated in the current directory On HW (MR scanner), the same file will be located in /usr/g/mrraw</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">phaseenc_plan_ptr</td><td>Pointer to <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                                                                            {</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  <a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html">KS_PHASEENCODING_COORD</a> coord = <a class="code" href="_k_s_foundation_8h.html#ae5e9ce52cebc9a6543bc6e69e9a03148">KS_INIT_PHASEENCODING_COORD</a>;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  <span class="keywordtype">int</span> shot, echo;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="preprocessor">#ifdef PSD_HW</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  FILE *fp = fopen(<span class="stringliteral">&quot;/usr/g/mrraw/ks_phaseencodingtable.txt&quot;</span>, <span class="stringliteral">&quot;w&quot;</span>);</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  FILE *fp = fopen(<span class="stringliteral">&quot;./ks_phaseencodingtable.txt&quot;</span>, <span class="stringliteral">&quot;w&quot;</span>);</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  <span class="keywordflow">if</span> (phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a> == <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>) {</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="keywordflow">return</span>; <span class="comment">/* we haven&#39;t set it up yet */</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  }</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;numshots (vertical): %d, etl (horizontal): %d\n\n&quot;</span>, phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#aa2f98be84137da8386df3fc88763823c">num_shots</a>, phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a>);</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  <span class="keywordflow">for</span> (shot = 0; shot &lt; phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#aa2f98be84137da8386df3fc88763823c">num_shots</a>; shot++) {</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keywordflow">for</span> (echo = 0; echo &lt; phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a>; echo++) {</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        coord = <a class="code" href="_k_s_foundation__common_8c.html#a9712828cb11bdaf20671ac4e43c80d3a">ks_phaseencoding_get</a>(phaseenc_plan_ptr, echo, shot);</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        <span class="keywordflow">if</span> (coord.<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#ad097e95262501d52829d5cd9a827275c">ky</a> != <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>) {</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;[%03d&quot;</span>, coord.<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#ad097e95262501d52829d5cd9a827275c">ky</a>);</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;[***&quot;</span>);</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        }</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        <span class="keywordflow">if</span> (coord.<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#a7894f45c2928e5a523eeafc5ef4ae8b7">kz</a> != <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>) {</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;,%03d] &quot;</span>, coord.<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#a7894f45c2928e5a523eeafc5ef4ae8b7">kz</a>);</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;,***] &quot;</span>);</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        }</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;      }</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    fprintf(fp,<span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  }</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  fclose(fp);</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_ae5e9ce52cebc9a6543bc6e69e9a03148"><div class="ttname"><a href="_k_s_foundation_8h.html#ae5e9ce52cebc9a6543bc6e69e9a03148">KS_INIT_PHASEENCODING_COORD</a></div><div class="ttdeci">#define KS_INIT_PHASEENCODING_COORD</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:139</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_aa2f98be84137da8386df3fc88763823c"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#aa2f98be84137da8386df3fc88763823c">KS_PHASEENCODING_PLAN::num_shots</a></div><div class="ttdeci">int num_shots</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1587</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_afd953f31b866a09e0418967c2bf65a59"><div class="ttname"><a href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a></div><div class="ttdeci">#define KS_NOTSET</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:60</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d_html_ad097e95262501d52829d5cd9a827275c"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#ad097e95262501d52829d5cd9a827275c">KS_PHASEENCODING_COORD::ky</a></div><div class="ttdeci">int ky</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1553</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d_html_a7894f45c2928e5a523eeafc5ef4ae8b7"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#a7894f45c2928e5a523eeafc5ef4ae8b7">KS_PHASEENCODING_COORD::kz</a></div><div class="ttdeci">int kz</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1554</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d_html"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html">KS_PHASEENCODING_COORD</a></div><div class="ttdoc">Struct holding a 3D k-space phase encoding location (ky,kz)</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1552</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a7582325a159d8ec89a4a4ba0fb89e9a9"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">KS_PHASEENCODING_PLAN::etl</a></div><div class="ttdeci">int etl</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1588</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a9712828cb11bdaf20671ac4e43c80d3a"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a9712828cb11bdaf20671ac4e43c80d3a">ks_phaseencoding_get</a></div><div class="ttdeci">KS_PHASEENCODING_COORD ks_phaseencoding_get(const KS_PHASEENCODING_PLAN *phaseenc_plan_ptr, int echo, int shot)</div><div class="ttdoc">Get [ky,kz] coordinate from KS_PHASEENCODING_PLAN for given echo and shot</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:308</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad3b39ba8c626f4580806078dc4f4b211"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad3b39ba8c626f4580806078dc4f4b211">&#9670;&nbsp;</a></span>ks_phaseencoding_resize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_phaseencoding_resize </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *&#160;</td>
          <td class="paramname"><em>phaseenc_plan_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>etl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>num_shots</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Reallocate memory for <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> entries</h4>
</p>
<p>For every (and custom) ks_phaseencoding_generate_** functions, this function must be called before <a class="el" href="_k_s_foundation_8h.html#abb524977b3e7a48a58dad2370166df9b" title="Set [ky,kz] coordinate from KS_PHASEENCODING_PLAN for given echo and shot">ks_phaseencoding_set()</a> so that there is memory allocataed for the array of <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html" title="Struct holding a 3D k-space phase encoding location (ky,kz)">KS_PHASEENCODING_COORD</a></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">phaseenc_plan_ptr</td><td>Pointer to <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">etl</td><td>The number of acquisition window in the pulse sequence, or echo train length (ETL) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">num_shots</td><td>Number of shots (i.e. how many times the sequence is played out per slice). For 3D, shot is over both ky and kz </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                                                                                                 {</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  <span class="keywordtype">void</span> *ptr = NULL;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#a6ab9211cdefcc0e167b71289e23829bc">ks_phaseencoding_init_tgt</a>(phaseenc_plan_ptr);</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  ptr = realloc(phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a94a0ea2c005add8c48c0ce371cc15a76">entries</a>, etl * num_shots * <span class="keyword">sizeof</span>(<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html">KS_PHASEENCODING_COORD</a>));</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  <span class="keywordflow">if</span> (!ptr) {</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: failed reallocation&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  }</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a> = etl;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#aa2f98be84137da8386df3fc88763823c">num_shots</a> = num_shots;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;  phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a94a0ea2c005add8c48c0ce371cc15a76">entries</a> = (<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html">KS_PHASEENCODING_COORD</a> *) ptr;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; etl * num_shots; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a94a0ea2c005add8c48c0ce371cc15a76">entries</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#ad097e95262501d52829d5cd9a827275c">ky</a> = <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a94a0ea2c005add8c48c0ce371cc15a76">entries</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#a7894f45c2928e5a523eeafc5ef4ae8b7">kz</a> = <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  }</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;}</div><div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_aa2f98be84137da8386df3fc88763823c"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#aa2f98be84137da8386df3fc88763823c">KS_PHASEENCODING_PLAN::num_shots</a></div><div class="ttdeci">int num_shots</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1587</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a94a0ea2c005add8c48c0ce371cc15a76"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a94a0ea2c005add8c48c0ce371cc15a76">KS_PHASEENCODING_PLAN::entries</a></div><div class="ttdeci">KS_PHASEENCODING_COORD * entries</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1590</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_afd953f31b866a09e0418967c2bf65a59"><div class="ttname"><a href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a></div><div class="ttdeci">#define KS_NOTSET</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:60</div></div>
<div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d_html_ad097e95262501d52829d5cd9a827275c"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#ad097e95262501d52829d5cd9a827275c">KS_PHASEENCODING_COORD::ky</a></div><div class="ttdeci">int ky</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1553</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d_html_a7894f45c2928e5a523eeafc5ef4ae8b7"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#a7894f45c2928e5a523eeafc5ef4ae8b7">KS_PHASEENCODING_COORD::kz</a></div><div class="ttdeci">int kz</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1554</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d_html"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html">KS_PHASEENCODING_COORD</a></div><div class="ttdoc">Struct holding a 3D k-space phase encoding location (ky,kz)</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1552</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a7582325a159d8ec89a4a4ba0fb89e9a9"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">KS_PHASEENCODING_PLAN::etl</a></div><div class="ttdeci">int etl</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1588</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a6ab9211cdefcc0e167b71289e23829bc"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a6ab9211cdefcc0e167b71289e23829bc">ks_phaseencoding_init_tgt</a></div><div class="ttdeci">void ks_phaseencoding_init_tgt(KS_PHASEENCODING_PLAN *phaseenc_plan_ptr)</div><div class="ttdoc">Internal use for correct migration of KS_PHASEENCODING_PLAN from HOST to TGT (IPG)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:294</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa887db0578a0780ccd7ed143e858588c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa887db0578a0780ccd7ed143e858588c">&#9670;&nbsp;</a></span>ks_phaseencoding_generate_simple()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_phaseencoding_generate_simple </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *&#160;</td>
          <td class="paramname"><em>phaseenc_plan_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const&#160;</td>
          <td class="paramname"><em>desc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *&#160;</td>
          <td class="paramname"><em>phaser</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *&#160;</td>
          <td class="paramname"><em>zphaser</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Generation of a <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> for any sequence having only one echo (or same phasenc step for all echoes)</h4>
</p>
<p>For sequences having only one echo (ETL=1) or having more echoes but where all echoes have the same ky/kz coordinate, there is no special logic necessary regarding which order to traverse the ky-kz plane over shots.</p>
<p>Parallel imaging in ky (and kz for 3D), with acs lines, is set up as usual using <a class="el" href="_k_s_foundation_8h.html#acc45c24d1996acd3d95ae2866c5ffb2b" title="Sets up an acquisition window with a trapezoid with preset gradient constraints">ks_eval_phaser()</a> first before calling this function. For 2D, the phase encoding object (<a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a>) is then passed in as the 2nd arg to this function, with the 3rd arg being <code>NULL</code>. For 3D, both KS_PHASERs are passed in as 2nd and 3rd args, each with their own acceleration and resolution. For both 2D and 3D, the <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> will be set up based on the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER(s)</a>, but for 2D all entries.kz in the <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> will be KS_NOTSET (-1)</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">phaseenc_plan_ptr</td><td>Pointer to <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">desc</td><td>A description (text string) of the <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> object. This description is used in the psd plot. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">phaser</td><td>Pointer to the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object for the first (3D) / only (2D) phase encoding direction </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">zphaser</td><td>Pointer to the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object for the second phase encoding direction (NULL for 2D) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                                                                                                                                                  {</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  <span class="keywordtype">int</span> etl = 1;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  <span class="keywordtype">int</span> num_shots;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  <span class="keywordtype">int</span> shot, ky, kz;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  STATUS status;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  strncpy(phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, desc, <a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> - 1);</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>[<a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> - 1] = 0;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  <span class="comment">/* don&#39;t allow empty description or a description with leading space */</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  <span class="keywordflow">if</span> (phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a1c544bec41003a594ba4ec7d43a3a470">description</a> == NULL || phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>[0] == <span class="charliteral">&#39; &#39;</span>) {</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: description of phase encoding plan (2nd arg) cannot be NULL or leading space&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  }</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  num_shots = (zphaser != NULL) ? (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a> * zphaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a>) : phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a>;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  status = <a class="code" href="_k_s_foundation__common_8c.html#ad3b39ba8c626f4580806078dc4f4b211">ks_phaseencoding_resize</a>(phaseenc_plan_ptr, etl, num_shots);</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  <span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  shot = 0;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  <span class="keywordflow">if</span> (zphaser != NULL) { <span class="comment">/* 3D */</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <span class="keywordflow">for</span> (kz = 0; kz &lt; zphaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a>; kz++) {</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;      <span class="keywordflow">for</span> (ky = 0; ky &lt; phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a>; ky++) {</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        <a class="code" href="_k_s_foundation__common_8c.html#abb524977b3e7a48a58dad2370166df9b">ks_phaseencoding_set</a>(phaseenc_plan_ptr, 0, shot++, phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[ky], zphaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[kz]);</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;      }</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    }</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a08736562d66b16003d4e795e95860cf7">zphaser</a> = zphaser;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  } <span class="keywordflow">else</span> { <span class="comment">/* 2D */</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="keywordflow">for</span> (ky = 0; ky &lt; phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a>; ky++) {</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;      <a class="code" href="_k_s_foundation__common_8c.html#abb524977b3e7a48a58dad2370166df9b">ks_phaseencoding_set</a>(phaseenc_plan_ptr, 0, shot++, phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[ky], <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>);</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    }</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a08736562d66b16003d4e795e95860cf7">zphaser</a> = NULL;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  }</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;  phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a706b4cec8ea7b1363975e556d74de924">phaser</a> = phaser;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_abb524977b3e7a48a58dad2370166df9b"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abb524977b3e7a48a58dad2370166df9b">ks_phaseencoding_set</a></div><div class="ttdeci">void ks_phaseencoding_set(KS_PHASEENCODING_PLAN *phaseenc_plan_ptr, int echo, int shot, int ky, int kz)</div><div class="ttdoc">Set [ky,kz] coordinate from KS_PHASEENCODING_PLAN for given echo and shot</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:328</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_ad3b39ba8c626f4580806078dc4f4b211"><div class="ttname"><a href="_k_s_foundation__common_8c.html#ad3b39ba8c626f4580806078dc4f4b211">ks_phaseencoding_resize</a></div><div class="ttdeci">STATUS ks_phaseencoding_resize(KS_PHASEENCODING_PLAN *phaseenc_plan_ptr, int etl, int num_shots)</div><div class="ttdoc">Reallocate memory for KS_PHASEENCODING_PLAN entries</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:389</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_afd953f31b866a09e0418967c2bf65a59"><div class="ttname"><a href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a></div><div class="ttdeci">#define KS_NOTSET</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:60</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a09b1a7dc77a7cf8c4e8421a23608a42a"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">KS_PHASER::numlinestoacq</a></div><div class="ttdeci">int numlinestoacq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1532</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a090fbced834ec878a08eadc4f829b8a3"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">KS_PHASER::linetoacq</a></div><div class="ttdeci">int linetoacq[KS_MAX_PHASEDYN]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1533</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aacb2fe1d83c45e8d0525f363bdd6b8a6"><div class="ttname"><a href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a></div><div class="ttdeci">#define KS_DESCRIPTION_LENGTH</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:112</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a1c544bec41003a594ba4ec7d43a3a470">KS_PHASEENCODING_PLAN::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1589</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a08736562d66b16003d4e795e95860cf7"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a08736562d66b16003d4e795e95860cf7">KS_PHASEENCODING_PLAN::zphaser</a></div><div class="ttdeci">KS_PHASER * zphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1592</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a706b4cec8ea7b1363975e556d74de924"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a706b4cec8ea7b1363975e556d74de924">KS_PHASEENCODING_PLAN::phaser</a></div><div class="ttdeci">KS_PHASER * phaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1591</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa067bf0cb6e0bfc4a1d39f4fe760f213"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa067bf0cb6e0bfc4a1d39f4fe760f213">&#9670;&nbsp;</a></span>ks_phaseencoding_generate_simple_ellipse()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_phaseencoding_generate_simple_ellipse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *&#160;</td>
          <td class="paramname"><em>phaseenc_plan_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const&#160;</td>
          <td class="paramname"><em>desc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *&#160;</td>
          <td class="paramname"><em>phaser</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *&#160;</td>
          <td class="paramname"><em>zphaser</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Generation of a <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> for any sequence having only one echo (or same phasenc step for all echoes) - ellipse version</h4>
</p>
<p>For sequences having only one echo (ETL=1) or having more echoes but where all echoes have the same ky/kz coordinate, there is no special logic necessary regarding which order to traverse the ky-kz plane over shots.</p>
<p>Parallel imaging in ky (and kz for 3D), with acs lines, is set up as usual using <a class="el" href="_k_s_foundation_8h.html#acc45c24d1996acd3d95ae2866c5ffb2b" title="Sets up an acquisition window with a trapezoid with preset gradient constraints">ks_eval_phaser()</a> first before calling this function. For 2D, the phase encoding object (<a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a>) is then passed in as the 2nd arg to this function, with the 3rd arg being <code>NULL</code>. For 3D, both KS_PHASERs are passed in as 2nd and 3rd args, each with their own acceleration and resolution. For both 2D and 3D, the <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> will be set up based on the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER(s)</a>, but for 2D all entries.kz in the <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> will be KS_NOTSET (-1). This function will create an elliptical k-space in ky/kz. For rectangular k-space, use <code>ks_phaseencoding_generate_simple</code>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">phaseenc_plan_ptr</td><td>Pointer to <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">desc</td><td>A description (text string) of the <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> object. This description is used in the psd plot. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">phaser</td><td>Pointer to the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object for the first (3D) / only (2D) phase encoding direction </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">zphaser</td><td>Pointer to the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object for the second phase encoding direction (NULL for 2D) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                                                                                                                                                          {</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  <span class="keywordtype">int</span> etl = 1;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  <span class="keywordtype">int</span> ky, kz, <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  <span class="keywordtype">float</span> radius_ky, radius_kz, center_ky, center_kz;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  <span class="keywordtype">float</span> x1, x2;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  STATUS status;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  <span class="keywordtype">int</span> inellipse; <span class="comment">/* Number of ky,kz points in the ellipse */</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  strncpy(phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, desc, <a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> - 1);</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>[<a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> - 1] = 0;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  <span class="comment">/* don&#39;t allow empty description or a description with leading space */</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  <span class="keywordflow">if</span> (phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a1c544bec41003a594ba4ec7d43a3a470">description</a> == NULL || phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>[0] == <span class="charliteral">&#39; &#39;</span>) {</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: description of phase encoding plan (2nd arg) cannot be NULL or leading space&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  }</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  <span class="keywordflow">if</span> (zphaser == NULL) { <span class="comment">/* We can&#39;t do ellipse k-space coverage (ky,kz) in 2D */</span></div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#aa887db0578a0780ccd7ed143e858588c">ks_phaseencoding_generate_simple</a>(phaseenc_plan_ptr, desc, phaser, NULL);</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  }</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a706b4cec8ea7b1363975e556d74de924">phaser</a> = phaser;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  radius_ky = phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a>/2.0;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  center_ky = phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a>/2.0 - 0.5;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a08736562d66b16003d4e795e95860cf7">zphaser</a> = zphaser;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  radius_kz = zphaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a>/2.0;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  center_kz = zphaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a>/2.0 - 0.5;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; 2; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) { <span class="comment">/* i = 0: check how many. i = 1: set up coords */</span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> == 1) {</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;      status = <a class="code" href="_k_s_foundation__common_8c.html#ad3b39ba8c626f4580806078dc4f4b211">ks_phaseencoding_resize</a>(phaseenc_plan_ptr, etl, inellipse);</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;      <span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    }</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    inellipse = 0;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="keywordflow">for</span> (kz = 0; kz &lt; zphaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a>; kz++) {</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;      <span class="keywordflow">for</span> (ky = 0; ky &lt; phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a>; ky++) {</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;          x1 = (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[ky]  - center_ky) / (<span class="keywordtype">float</span>) radius_ky;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;          x2 = (zphaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[kz] - center_kz) / (<span class="keywordtype">float</span>) radius_kz;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;          <span class="keywordflow">if</span> ((x1 * x1 + x2 * x2) &lt;= 1.0) {</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> == 1) {</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;              <a class="code" href="_k_s_foundation__common_8c.html#abb524977b3e7a48a58dad2370166df9b">ks_phaseencoding_set</a>(phaseenc_plan_ptr, 0, inellipse, phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[ky], zphaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[kz]);</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;            }</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;            inellipse++;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;          }</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;      } <span class="comment">/* ky */</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    } <span class="comment">/* kz */</span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  } <span class="comment">/* i */</span></div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_abb524977b3e7a48a58dad2370166df9b"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abb524977b3e7a48a58dad2370166df9b">ks_phaseencoding_set</a></div><div class="ttdeci">void ks_phaseencoding_set(KS_PHASEENCODING_PLAN *phaseenc_plan_ptr, int echo, int shot, int ky, int kz)</div><div class="ttdoc">Set [ky,kz] coordinate from KS_PHASEENCODING_PLAN for given echo and shot</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:328</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_ad3b39ba8c626f4580806078dc4f4b211"><div class="ttname"><a href="_k_s_foundation__common_8c.html#ad3b39ba8c626f4580806078dc4f4b211">ks_phaseencoding_resize</a></div><div class="ttdeci">STATUS ks_phaseencoding_resize(KS_PHASEENCODING_PLAN *phaseenc_plan_ptr, int etl, int num_shots)</div><div class="ttdoc">Reallocate memory for KS_PHASEENCODING_PLAN entries</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:389</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">KS_PHASER::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1527</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a09b1a7dc77a7cf8c4e8421a23608a42a"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">KS_PHASER::numlinestoacq</a></div><div class="ttdeci">int numlinestoacq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1532</div></div>
<div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a090fbced834ec878a08eadc4f829b8a3"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">KS_PHASER::linetoacq</a></div><div class="ttdeci">int linetoacq[KS_MAX_PHASEDYN]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1533</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aacb2fe1d83c45e8d0525f363bdd6b8a6"><div class="ttname"><a href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a></div><div class="ttdeci">#define KS_DESCRIPTION_LENGTH</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:112</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a1c544bec41003a594ba4ec7d43a3a470">KS_PHASEENCODING_PLAN::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1589</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_aa887db0578a0780ccd7ed143e858588c"><div class="ttname"><a href="_k_s_foundation__common_8c.html#aa887db0578a0780ccd7ed143e858588c">ks_phaseencoding_generate_simple</a></div><div class="ttdeci">STATUS ks_phaseencoding_generate_simple(KS_PHASEENCODING_PLAN *phaseenc_plan_ptr, const char *const desc, KS_PHASER *phaser, KS_PHASER *zphaser)</div><div class="ttdoc">Generation of a KS_PHASEENCODING_PLAN for any sequence having only one echo (or same phasenc step for...</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:414</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a08736562d66b16003d4e795e95860cf7"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a08736562d66b16003d4e795e95860cf7">KS_PHASEENCODING_PLAN::zphaser</a></div><div class="ttdeci">KS_PHASER * zphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1592</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a706b4cec8ea7b1363975e556d74de924"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a706b4cec8ea7b1363975e556d74de924">KS_PHASEENCODING_PLAN::phaser</a></div><div class="ttdeci">KS_PHASER * phaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1591</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad6d4710baf0864b0e04ba55908a52666"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad6d4710baf0864b0e04ba55908a52666">&#9670;&nbsp;</a></span>ks_fse_calcecho()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_fse_calcecho </td>
          <td>(</td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>bestecho</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>optecho</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *&#160;</td>
          <td class="paramname"><em>pe</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>TE</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>etl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>esp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Calculates the ETL index corresponding the desired TE given a <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object and echo spacing</h4>
</p>
<p>Given the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object used in the FSE train (containing res and partial ky Fourier info), the desired effective echo time (<code>TE</code> [us]), the echo train length (<code>etl</code>) and the echo spacing between consecutive echoes (<code>esp</code> [us]), this function calculates two echo indices:</p>
<ul>
<li><code>bestecho</code>: is the 0-based index corresponding to the echo in the FSE train that should be placed in the center of k-space, i.e. the echo that most closely matches the desired TE. If <code>bestecho</code> is an integer value (although it is in double format), the data acquired for this echo should <em>straddle</em> the k-space center. <code>bestecho</code> can also be an interger + 0.5, indicating that there are two echo indices that should be placed around the k-space center. For example, floor(bestecho) corresponds to the echo index that should be placed just below the k-space center and ceil(bestecho) corresponds to the echo index that should be placed just above the k-space center. I.e. when <code>bestecho = *.5</code>, no single echo index will straddle the k-space center, and the k-space line located at ky position +0.5 will come from data acquired from echo #[floor(bestecho)] and ky position -0.5 correspondingly from echo #[ceil(bestecho)].</li>
<li><code>optecho</code>: is the 0-based index corresponding to an ideal TE choice that would allow the data from the echoes in the FSE train to be placed out linearly each time. Doing so will reduce ghosting and T2 blurring. Hence, <code>optecho</code> ignores the input TE value here, but the calling function can use this information to determine k-space acquisition order, but also to suggest a TE (optecho * esp) that would result in optimal image quality for the chosen ETL.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">bestecho</td><td>Pointer to the echo number in the train that should be placed at the center of k-space given the current ETL and ESP </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">optecho</td><td>Pointer to the optimal echo number in the train that would allow k-space to be sampled linearly (to reduce T2-blurring and ghosting) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pe</td><td>Pointer to a <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">TE</td><td>(Echo Time in [us]) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">etl</td><td>(EchoTrain Length) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">esp</td><td>(Echo Spacing in [us]) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                                                                                                   {</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  <span class="keywordtype">int</span> numshots, <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  <span class="keywordtype">int</span> nacqlines_earlyside;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  <span class="keywordflow">if</span> (etl &lt; 1) {</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ksfse_calc_echo: ETL (arg 5) must be at least 1&quot;</span>);</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  }</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  <span class="keywordflow">if</span> (pe-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a> &lt; 1) {</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ksfse_calc_echo: field &#39;.numlinestoacq&#39; in 3rd arg must be at least 1&quot;</span>);</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;  }</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  <span class="keywordflow">if</span> (etl &gt; pe-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a>) {</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ksfse_calc_echo: ETL (arg 5) cannot exceed number of lines to acquire&quot;</span>);</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  }</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  <span class="keywordflow">if</span> (esp &lt;= 0) {</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ksfse_calc_echo: ESP (arg 6) must be larger than 1&quot;</span>);</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  }</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  <span class="comment">/* Number of shots */</span></div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  numshots = CEIL_DIV(pe-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a>, etl);</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  <span class="comment">/* index &#39;i&#39; will stop incrementing as we pass the center of k-space */</span></div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; pe-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a> - 1; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="keywordflow">if</span> (((pe-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a> - 1) / 2.0 - pe-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>]) &lt; 0)</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;  }</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;  <span class="keywordflow">if</span> (pe-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a> &gt;= 0) {</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <span class="comment">/* bottom-up (i.e. early echoes are below k-space center) */</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    nacqlines_earlyside = pe-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a> - <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  }  <span class="keywordflow">else</span> {</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <span class="comment">/* top-down (i.e. early echoes are above k-space center) */</span></div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    nacqlines_earlyside = <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;  }</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  <span class="keywordflow">if</span> (etl % 2) {</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    <span class="comment">/* etl is odd. The optimal echo will straddle around the center of k-space */</span></div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <span class="keywordflow">if</span> (optecho != NULL)</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;      *optecho = (double) CEIL_DIV((nacqlines_earlyside + numshots / 2), numshots); <span class="comment">/* integer value since ETL is odd */</span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="keywordflow">if</span> (bestecho != NULL) {</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;      *bestecho = floor((<span class="keywordtype">double</span>) TE / (<span class="keywordtype">double</span>) esp + 0.5); <span class="comment">/* integer */</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;      <span class="keywordflow">if</span> (*bestecho &lt; 1)</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        *bestecho = 1;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;      <span class="keywordflow">if</span> (*bestecho &gt; etl)</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        *bestecho = etl;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    }</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    <span class="comment">/* etl is even. The optimal two echoes will be placed above and below k-space center, respectively */</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <span class="keywordflow">if</span> (optecho != NULL)</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;      *optecho = (double) CEIL_DIV(nacqlines_earlyside, numshots) + 0.5; <span class="comment">/* half-integer value since ETL is even */</span></div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <span class="keywordflow">if</span> (bestecho != NULL) {</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;      <span class="keywordflow">if</span> (etl == 2) {</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;        <span class="comment">/* special case for ETL = 2 */</span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;        <span class="keywordflow">if</span> (TE &lt; 1.25 * esp)</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;          *bestecho = 1; <span class="comment">/* 1st echo straddling around k-space center */</span></div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (TE &lt; 1.75 * esp)</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;          *bestecho = 1.5; <span class="comment">/* 1st/end echo below/above k-space center */</span></div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;          *bestecho = 2; <span class="comment">/* 2nd echo straddling around k-space center */</span></div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        *bestecho = floor((<span class="keywordtype">double</span>) TE / (<span class="keywordtype">double</span>) esp) + 0.5; <span class="comment">/* half-integer */</span></div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        <span class="keywordflow">if</span> (*bestecho &lt;= 1.5)</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;          *bestecho = 1; <span class="comment">/* minTE, back to integer &#39;bestecho&#39; for center-out encoding */</span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        <span class="keywordflow">if</span> (*bestecho &gt;= (etl - 0.5))</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;          *bestecho = etl; <span class="comment">/* max TE, back to integer &#39;bestecho&#39; for out-center encoding */</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;      }</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    }</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;  }</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  <span class="keywordflow">if</span> (optecho != NULL) {</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="comment">/* Partial Fourier MinTE case, regardless if ETL is even or odd */</span></div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <span class="keywordflow">if</span> ((pe-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a> &gt; 0) &amp;&amp; (nacqlines_earlyside &lt;= numshots / 2))</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;      *optecho = 1;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <span class="comment">/* Partial Fourier MaxTE case, regardless if ETL is even or odd */</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    <span class="keywordflow">if</span> ((pe-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a> &lt; 0) &amp;&amp; (nacqlines_earlyside &gt;= (pe-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] - numshots / 2)))</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;      *optecho = etl;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;  }</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;} <span class="comment">/* ks_fse_calcecho() */</span></div><div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">KS_PHASER::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1527</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a09b1a7dc77a7cf8c4e8421a23608a42a"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">KS_PHASER::numlinestoacq</a></div><div class="ttdeci">int numlinestoacq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1532</div></div>
<div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a090fbced834ec878a08eadc4f829b8a3"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">KS_PHASER::linetoacq</a></div><div class="ttdeci">int linetoacq[KS_MAX_PHASEDYN]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1533</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a29cf05caf131eb2c5915a41b18af16d0"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">KS_PHASER::nover</a></div><div class="ttdeci">int nover</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1528</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6101f1a037684c71a6c5d654671824f9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6101f1a037684c71a6c5d654671824f9">&#9670;&nbsp;</a></span>ks_phaseencoding_generate_2Dfse()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_phaseencoding_generate_2Dfse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *&#160;</td>
          <td class="paramname"><em>phaseenc_plan_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const&#160;</td>
          <td class="paramname"><em>desc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *&#160;</td>
          <td class="paramname"><em>phaser</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *&#160;</td>
          <td class="paramname"><em>zphaser</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>TE</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>etl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>esp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>2DFSE: Makes a <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> depending on etl, desired TE, and echo spacing (esp)</h4>
</p>
<p>This function is only executed on TGT and will return early when called on HOST.</p>
<p>The phase encoding sorting is depending on many factors. First, the desired TE will dictate which one (or two) of the echoes in the FSE train (of length <code>etl</code>) that should be placed in the center. This is determined based on the properties of the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object (phase encoding gradients in the FSE train), <code>TE</code> and <code>esp</code> by calling <a class="el" href="ksfse__implementation_8e.html#af287d52efc92c8e069e341c3eb00de99">ksfse_calc_echo()</a>.</p>
<p>Second, the sorting of the echoes will first of all depend on whether <code>bestecho</code> is equal to <code>optecho</code>. If it is, then the <code>etl</code> echoes can be placed out linearly in k-space (from the bottom-&gt;top of k-space, or vice versa). This will produce the best image quality with minimal T2-blurring and FSE ghosting.</p>
<p>As partial ky Fourier is allowed, this function first checks on which side (top or bottom half) of k-space that has more room for the echo indices that are either before or after the <code>bestecho</code> index corresponding to the desired <code>TE</code>. The goal with this is to try to sweep k-space as linearly as possible in as much of the center portion of k-space as possible when <code>bestecho != optecho</code>.</p>
<p>When <code>bestecho != optecho</code>, there will be data from either the first or last echo indices that won't fit in k-space if placed next to a neighboring index. If this data would be placed on the other size of k-space (that still needs lines to be filled in), where e.g. echo index #0 would be placed next to echo index #(etl-1), strong ghosting will occur due to the much strong signal from echo #0 compared to #(etl-1). With an echo train length of <code>etl</code>, k-space is filled in <code>numshots = ceil(numlinestoacq / etl</code>. Using half of the numshots lines for each echo index a linear sweep of the center half of k-space can is layed out. To avoid FSE ghosting, the numshots/2 remaining lines for each early or late echo index are placed such as neighboring ky lines will never have a change in echo index by more than one. For example if <code>etl = 8</code>, <code>esp = 10 ms</code> and <code>TE = 25</code>, then <code>bestecho = 1.5</code> and <code>optecho = 4.5</code>. We avoid to sort the echoes in the following k-space order for ghosting reasons: 7-6-0-1*2-3-4-5 (* = k-space center) since there will be a strong discontinuity between 6 and 0. Instead we use groups of numshots/2 per echo index (and get two groups per echo index in k-space): 5-4-3-2-1-0-0-1*2-3-4-5-6-7-6-5</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">phaseenc_plan_ptr</td><td>Pointer to <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">desc</td><td>A description (text string) of the <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> object. This description is used in the psd plot. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">phaser</td><td>Pointer to a <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">zphaser</td><td>Pointer to a <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> (3D) or NULL (2D) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">TE</td><td>(Echo Time in [us]) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">etl</td><td>(EchoTrain Length) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">esp</td><td>(Echo Spacing in [us]) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<p>Grouping shots for each of the ETL echoes in k-space: We don't place all shots for each echo together in k-space since we need to make a z-shaped pattern to avoid ghosting. Instead we let half of the shots be one group (of size 'cgroupsize') that we place in the central ~50% of k-space, which allows us to get a linear sweep in this central half of k-space using all 'etl' echoes, regardless of the chosen effective TE. The actual center-ness depends on TE, and the remaining of k-space is filled using the echoes belonging to the latter 'numshots-cgroupsize' number of shots. At the edges of k-space, numshots*etl seldom match up to the chosen opyres, but numshots*etl is always &gt;= opyres thanks to the CEIL_DIV at the beginning of this function. The surplus echoes we don't need are numshots*etl - opyres (for full Fourier and no ARC), and as they are already tagged as -1 = KS_NOTSET in the beginning of this function, they will be placed in baseline view (0) in the <a class="el" href="ksfse__implementation_8e.html#a1b80282dd477cfb811a5ca903a6616b1" title="Plays out all phase encodes for all slices belonging to one pass">ksfse_scan_acqloop()</a></p>
<div class="fragment"><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                                                                                                                                                                           {</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>, j, ky, kz;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  <span class="keywordtype">int</span> numshots, numkz;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;  <span class="keywordtype">double</span> bestecho, optecho;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;  <span class="keywordtype">int</span> nacqlines_earlyside;</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;  <span class="keywordtype">int</span> cgroupsize, halfgroupsize;</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;  <span class="keywordtype">int</span> bottomup = <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;  <span class="keywordtype">int</span> cstart, cshift;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;  STATUS status;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;  strncpy(phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, desc, <a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> - 1);</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;  phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>[<a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> - 1] = 0;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;  <span class="comment">/* don&#39;t allow empty description or a description with leading space */</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;  <span class="keywordflow">if</span> (phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a1c544bec41003a594ba4ec7d43a3a470">description</a> == NULL || phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>[0] == <span class="charliteral">&#39; &#39;</span>) {</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: description of phase encoding plan (2nd arg) cannot be NULL or leading space&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;  }</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;  <span class="keywordflow">if</span> (etl &lt; 1) {</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    <span class="keywordflow">return</span> SUCCESS; <span class="comment">/* we haven&#39;t set it up yet */</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;  }</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;  <span class="keywordflow">if</span> (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a> &lt; 2) {</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: field &#39;.numlinestoacq&#39; in 2nd arg must be at least 2&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;  }</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;  <span class="keywordflow">if</span> (etl &gt; phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a>) {</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: ETL cannot exceed number of lines to acquire&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;  }</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  <span class="comment">/* Number of shots (2D) */</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  numshots = CEIL_DIV(phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a>, etl);</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;  <span class="comment">/* Number of kz */</span></div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;  numkz = (zphaser != NULL) ? zphaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a> : 1;</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;  <span class="comment">/* allocate KS_PHASEENCODING_PLAN table (all entries will be initialized to KS_NOTSET) */</span></div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;  status = <a class="code" href="_k_s_foundation__common_8c.html#ad3b39ba8c626f4580806078dc4f4b211">ks_phaseencoding_resize</a>(phaseenc_plan_ptr, etl, numshots * numkz);</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;  phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a706b4cec8ea7b1363975e556d74de924">phaser</a> = phaser;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;  phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a08736562d66b16003d4e795e95860cf7">zphaser</a> = zphaser;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;  <span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;  <span class="keywordflow">for</span> (kz = 0; kz &lt; numkz; kz++) {</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    <span class="keywordflow">if</span> (etl == 1) {</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;      <span class="comment">/* Special case for ETL = 1. Just acquire the data in order */</span></div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;      <span class="keywordflow">for</span> (ky = 0; ky &lt; phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a>; ky++) {</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        <a class="code" href="_k_s_foundation__common_8c.html#abb524977b3e7a48a58dad2370166df9b">ks_phaseencoding_set</a>(phaseenc_plan_ptr,</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;                             0, ky + kz * phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a>,</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;                             phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[ky], (zphaser != NULL) ? zphaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[kz] : <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>);</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;      }</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;      <span class="comment">/* ETL &gt; 1 (this is a long else-statement) */</span></div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;      <span class="comment">/* index &#39;i&#39; will stop incrementing as we pass the center of k-space */</span></div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a> - 1; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;        <span class="keywordflow">if</span> (((phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a> - 1) / 2.0 - phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>]) &lt; 0)</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;      }</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;      <span class="keywordflow">if</span> (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a> &gt;= 0) {</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        <span class="comment">/* bottom-up (i.e. early echoes are below k-space center) */</span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;        nacqlines_earlyside = phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a> - <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;        bottomup = TRUE;</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;      }  <span class="keywordflow">else</span> {</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        <span class="comment">/* top-down (i.e. early echoes are above k-space center) */</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        nacqlines_earlyside = <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        bottomup = FALSE;</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;      }</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;      <span class="comment">/* get the best echo number for the given TE/ETL/ESP, and also the optimal echo number that would allow for a linear k-space sweep */</span></div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;      status = <a class="code" href="_k_s_foundation__common_8c.html#ad6d4710baf0864b0e04ba55908a52666">ks_fse_calcecho</a>(&amp;bestecho, &amp;optecho, phaser, TE, etl, esp);</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;      <span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;      <span class="keywordflow">if</span> (bestecho == optecho) {</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;        <span class="comment">/* we can place the echoes linearly in k-space in groups of &#39;numshots&#39; per echo given the current combination of TE, ETL and ESP */</span></div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;        cgroupsize = numshots;</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;        halfgroupsize = floor((<span class="keywordtype">float</span>) phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a> / (etl * 2.0) + 0.5);</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        cgroupsize = (int) ceil((<span class="keywordtype">float</span>) phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a> / (etl * 2.0)); <span class="comment">/* ~numshots/2 lines per etl in the central 50% of k-space */</span></div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;        halfgroupsize = floor((<span class="keywordtype">float</span>) phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a> / (etl * 4.0) + 0.5);</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;      }</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;      <span class="comment">/* if bestecho == optecho: Place out all echoes</span></div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;<span class="comment">        if bestecho != optecho: Place out the center half of lines */</span></div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;      <span class="keywordflow">if</span> (bestecho == 1) <span class="comment">/* minTE */</span></div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;        cshift = cgroupsize;</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bestecho == etl) <span class="comment">/* maxTE */</span></div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;        cshift = 0;</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;        cshift = halfgroupsize; <span class="comment">/* non-extreme TE */</span></div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;      cstart = (nacqlines_earlyside + cshift) - cgroupsize * bestecho;</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;      <span class="keywordflow">if</span> (bottomup == TRUE)</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;        cstart = phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a> - cstart - 1;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;      ky = cstart;</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; etl; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;        <span class="keywordflow">for</span> (j = 0; j &lt; cgroupsize; j++) {</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;          <span class="keywordflow">if</span> (ky &gt;= 0 &amp;&amp; ky &lt; phaser-&gt;numlinestoacq) {</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;            <a class="code" href="_k_s_foundation__common_8c.html#abb524977b3e7a48a58dad2370166df9b">ks_phaseencoding_set</a>(phaseenc_plan_ptr, <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>, j + kz * numshots, phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[ky], (zphaser != NULL) ? zphaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[kz] : <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>);</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;          }</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;          <span class="keywordflow">if</span> (bottomup == TRUE)</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;            ky--;</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;            ky++;</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;        }</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;      }</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;      <span class="keywordflow">if</span> (bestecho != optecho) {</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;        <span class="comment">/* remaining &#39;numshots-cgroupsize&#39; number of shots for late echoes */</span></div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;        <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = etl - 1;</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;        <span class="keywordflow">while</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &gt;= 0) {</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;          <span class="keywordflow">for</span> (j = cgroupsize; j &lt; numshots; j++) {</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;            <span class="keywordflow">if</span> (ky &gt;= 0 &amp;&amp; ky &lt; phaser-&gt;numlinestoacq) {</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;              <a class="code" href="_k_s_foundation__common_8c.html#abb524977b3e7a48a58dad2370166df9b">ks_phaseencoding_set</a>(phaseenc_plan_ptr, <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>, j + kz * numshots, phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[ky], (zphaser != NULL) ? zphaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[kz] : <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>);</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;            }</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;            <span class="keywordflow">if</span> (bottomup == TRUE)</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;              ky--;</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;              ky++;</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;          } <span class="comment">/* for j */</span></div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;          <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>--;</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;        }</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;        <span class="comment">/* remaining &#39;numshots-cgroupsize&#39; number of shots for early echoes */</span></div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;        <span class="keywordflow">if</span> (bottomup == TRUE)</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;          ky = cstart + 1;</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;          ky = cstart - 1;</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0;</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;        <span class="keywordflow">while</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; etl) {</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;          <span class="keywordflow">for</span> (j = cgroupsize; j &lt; numshots; j++) {</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;            <span class="keywordflow">if</span> (ky &gt;= 0 &amp;&amp; ky &lt; phaser-&gt;numlinestoacq) {</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;              <a class="code" href="_k_s_foundation__common_8c.html#abb524977b3e7a48a58dad2370166df9b">ks_phaseencoding_set</a>(phaseenc_plan_ptr, <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>, j + kz * numshots, phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[ky], (zphaser != NULL) ? zphaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[kz] : <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>);</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;            }</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;            <span class="keywordflow">if</span> (bottomup == TRUE)</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;              ky++;</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;              ky--;</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;          } <span class="comment">/* for j */</span></div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;          <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++;</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;        }</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;      } <span class="comment">/* bestecho != optecho */</span></div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    } <span class="comment">/* etl &gt; 1 */</span></div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;  } <span class="comment">/* numkz */</span></div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;} <span class="comment">/* ks_phaseencoding_generate_2Dfse() */</span></div><div class="ttc" id="_k_s_foundation__common_8c_html_abb524977b3e7a48a58dad2370166df9b"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abb524977b3e7a48a58dad2370166df9b">ks_phaseencoding_set</a></div><div class="ttdeci">void ks_phaseencoding_set(KS_PHASEENCODING_PLAN *phaseenc_plan_ptr, int echo, int shot, int ky, int kz)</div><div class="ttdoc">Set [ky,kz] coordinate from KS_PHASEENCODING_PLAN for given echo and shot</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:328</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_ad3b39ba8c626f4580806078dc4f4b211"><div class="ttname"><a href="_k_s_foundation__common_8c.html#ad3b39ba8c626f4580806078dc4f4b211">ks_phaseencoding_resize</a></div><div class="ttdeci">STATUS ks_phaseencoding_resize(KS_PHASEENCODING_PLAN *phaseenc_plan_ptr, int etl, int num_shots)</div><div class="ttdoc">Reallocate memory for KS_PHASEENCODING_PLAN entries</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:389</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">KS_PHASER::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1527</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_afd953f31b866a09e0418967c2bf65a59"><div class="ttname"><a href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a></div><div class="ttdeci">#define KS_NOTSET</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:60</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a09b1a7dc77a7cf8c4e8421a23608a42a"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">KS_PHASER::numlinestoacq</a></div><div class="ttdeci">int numlinestoacq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1532</div></div>
<div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a090fbced834ec878a08eadc4f829b8a3"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">KS_PHASER::linetoacq</a></div><div class="ttdeci">int linetoacq[KS_MAX_PHASEDYN]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1533</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_ad6d4710baf0864b0e04ba55908a52666"><div class="ttname"><a href="_k_s_foundation__common_8c.html#ad6d4710baf0864b0e04ba55908a52666">ks_fse_calcecho</a></div><div class="ttdeci">STATUS ks_fse_calcecho(double *bestecho, double *optecho, KS_PHASER *pe, int TE, int etl, int esp)</div><div class="ttdoc">Calculates the ETL index corresponding the desired TE given a KS_PHASER object and echo spacing...</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:513</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aacb2fe1d83c45e8d0525f363bdd6b8a6"><div class="ttname"><a href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a></div><div class="ttdeci">#define KS_DESCRIPTION_LENGTH</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:112</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a1c544bec41003a594ba4ec7d43a3a470">KS_PHASEENCODING_PLAN::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1589</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a29cf05caf131eb2c5915a41b18af16d0"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">KS_PHASER::nover</a></div><div class="ttdeci">int nover</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1528</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a08736562d66b16003d4e795e95860cf7"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a08736562d66b16003d4e795e95860cf7">KS_PHASEENCODING_PLAN::zphaser</a></div><div class="ttdeci">KS_PHASER * zphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1592</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a706b4cec8ea7b1363975e556d74de924"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a706b4cec8ea7b1363975e556d74de924">KS_PHASEENCODING_PLAN::phaser</a></div><div class="ttdeci">KS_PHASER * phaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1591</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab437a342f7b8f05dbe9efd90c6dd989f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab437a342f7b8f05dbe9efd90c6dd989f">&#9670;&nbsp;</a></span>ks_phaseencoding_generate_epi()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_phaseencoding_generate_epi </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *&#160;</td>
          <td class="paramname"><em>phaseenc_plan_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const&#160;</td>
          <td class="paramname"><em>desc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *&#160;</td>
          <td class="paramname"><em>epitrain</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>blipsign</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>numkyshots</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>numsegments</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>caipi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>EPI: Makes a <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> suitable for 2D or 3D epi</h4>
</p>
<p>The etl is the number of readouts in the EPI train, derived from the phaser. The number of ky shots is also given by the phaser, while the number of kz shots is given by zphaser. Any partial fourier is handled by the phasers, and acceleration and acs lines in the z direction is handled by zphaser. For 3D EPI, the number of shots in the phase encoding plan will be the product of the number of shots in the ky direction and the number of kz lines to acquire.</p>
<p>Each shot will be played out in a single kz plane. The shot order will be linear in ky and kz. The ky shots will be in the inner loop, unless kzshotsfirst is TRUE.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">phaseenc_plan_ptr</td><td>Pointer to the phase encoding plan </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">desc</td><td>A description (text string) of the <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> object. This description is used in the psd plot. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">epitrain</td><td>Pointer to a <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">blipsign</td><td>Should be either <code>KS_EPI_POSBLIPS</code> or <code>KS_EPI_NEGBLIPS</code> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">numkyshots</td><td>Number of ky shots to play. Must be within 1-R and evenly divisble with R. Set =1 for single-shot EPI. Set to phaser.R for full multi-shot EPI. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">numsegments</td><td>Number of kz encodes to play <br />
</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">caipi</td><td>Use CAIPIRINHA sampling pattern (affects 3D epi only) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;                                                                                                                                                                                          {</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;  <span class="keywordflow">if</span> (epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a> &lt; 2 &amp;&amp; (epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a> != epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a>)) {</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: field &#39;.numlinestoacq&#39; of epitrain-&gt;blipphaser must be at least 2, not %d&quot;</span>, __FUNCTION__, epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a>);</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;  }</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;  strncpy(phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, desc, <a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> - 1);</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;  phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>[<a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> - 1] = 0;</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;  <span class="comment">/* don&#39;t allow empty description or a description with leading space */</span></div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;  <span class="keywordflow">if</span> (phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a1c544bec41003a594ba4ec7d43a3a470">description</a> == NULL || phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>[0] == <span class="charliteral">&#39; &#39;</span>) {</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: description of phase encoding plan (2nd arg) cannot be NULL or leading space&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;  }</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;  <span class="keywordtype">int</span> readout, shot, kyshot, kyview, kzview, kzind;</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;  <span class="keywordtype">int</span> etl, numfullsegments, numshots, totalnumshots;</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;  <span class="keywordtype">int</span> shift;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;  STATUS status;</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;  <span class="comment">/* Number of shots (2D) */</span></div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;  <span class="keywordflow">if</span> (numkyshots &lt; 1 || numkyshots &gt; epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a> || (epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a> % numkyshots != 0)) {</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: numkyshots (=%d) must be in range 1-R and evenly divisible with R (=%d)&quot;</span>, __FUNCTION__, numkyshots, epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a>);</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;  }</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;  <span class="comment">/* Number of segments (3D) */</span></div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;  <span class="keywordflow">if</span> (epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a> != <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a> &amp;&amp; (numsegments &lt; 1 || numsegments &gt; epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a>)) {</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: numsegments (=%d) must be in range 1-zphaser.numlinestoacq (=%d)&quot;</span>, __FUNCTION__, numsegments, epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a>);</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;  }</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;  <span class="comment">/* Number of readouts per EPI train (etl) */</span></div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;  etl = epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a>;</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;  <span class="comment">/* Check number of kz segments and how many should be fully sampled (controlled by zphaser.nacslines) */</span></div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;  <span class="keywordflow">if</span> (epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a> == <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>) { <span class="comment">/* 2D epi */</span></div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    numsegments = 1;</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    numfullsegments = (numkyshots == epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a>);</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;  } <span class="keywordflow">else</span> { <span class="comment">/* 3D epi */</span></div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    <span class="keywordflow">if</span> (epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a> == 1) {</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;      numfullsegments = epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a4762b9a6307f0223b3d1dfde7e8ddce8">nacslines</a>; <span class="comment">/* special interpretation for zR=1 */</span></div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    } <span class="keywordflow">else</span> { <span class="comment">/* zR &gt; 1 */</span></div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;      <span class="keywordflow">if</span> (epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a4762b9a6307f0223b3d1dfde7e8ddce8">nacslines</a> &gt; 0) {</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;        numfullsegments = 1; <span class="comment">/* initialize */</span></div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        <span class="keywordflow">for</span> (kzind = 1; kzind &lt; numsegments; kzind++) {</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;          <span class="keywordflow">if</span> (abs(epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[kzind]-epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[kzind-1])==1) {</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;            numfullsegments++;</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;          }</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;        }</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;      } <span class="keywordflow">else</span> { <span class="comment">/* no kz &quot;acs lines&quot; */</span></div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;        numfullsegments = 0;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;      }</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    }</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;  }</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;  <span class="comment">/* allocate KS_PHASEENCODING_PLAN table (all entries will be initialized to KS_NOTSET) */</span></div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;  totalnumshots = numfullsegments * epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a> + (numsegments-numfullsegments) * numkyshots;</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;  status = <a class="code" href="_k_s_foundation__common_8c.html#ad3b39ba8c626f4580806078dc4f4b211">ks_phaseencoding_resize</a>(phaseenc_plan_ptr, etl, totalnumshots);</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;  phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a706b4cec8ea7b1363975e556d74de924">phaser</a> = &amp;epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>;</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;  phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a08736562d66b16003d4e795e95860cf7">zphaser</a> = &amp;epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>;</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;  <span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;  shot = 0; <span class="comment">/* initialize */</span></div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;  <span class="keywordflow">for</span> (kzind = 0; kzind &lt; numsegments; kzind++) {</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    kzview = (epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a> &gt; 0) ? epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[kzind] : <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>;</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    </div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    if (kzview != <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a> &amp;&amp; abs(kzview*2 - (epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a>-1)) &lt;= numfullsegments) {</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;      numshots = epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a>;</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;      numshots = numkyshots;</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;    }</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    <span class="keywordflow">for</span> (kyshot = 0; kyshot &lt; numshots; kyshot++) {</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;      <span class="keywordflow">for</span> (readout = 0; readout &lt; etl; readout++) {</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;        shift = kyshot * (epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a> / numshots); <span class="comment">/* ky shot shift */</span></div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;        shift = (shift + (kzview/epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a>) * caipi_delta) % epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a>; <span class="comment">/* CAIPIRINHA shift */</span></div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;        <span class="keywordflow">if</span> (blipsign == <a class="code" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811a5b332d904cae8d59fc2f85b49ada0ae4">KS_EPI_NEGBLIPS</a>) {</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;          kyview = epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[readout] + shift;</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (blipsign == <a class="code" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811ab36b1c8bcdbe924fc9d4a36cde9ba4dd">KS_EPI_POSBLIPS</a>) {</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;          kyview = epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[(etl - 1) - readout] + shift;</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: blipsign must be KS_EPI_POSBLIPS or KS_EPI_NEGBLIPS, not %d&quot;</span>, __FUNCTION__, blipsign);</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;        }</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;        <a class="code" href="_k_s_foundation__common_8c.html#abb524977b3e7a48a58dad2370166df9b">ks_phaseencoding_set</a>(phaseenc_plan_ptr, readout, shot, kyview, kzview);</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;      } <span class="comment">/* readout */</span></div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;      shot++;</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    } <span class="comment">/* kyshot */</span></div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;  } <span class="comment">/* kzind */</span></div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;} <span class="comment">/* ks_phaseencoding_generate_epi() */</span></div><div class="ttc" id="_k_s_foundation__common_8c_html_abb524977b3e7a48a58dad2370166df9b"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abb524977b3e7a48a58dad2370166df9b">ks_phaseencoding_set</a></div><div class="ttdeci">void ks_phaseencoding_set(KS_PHASEENCODING_PLAN *phaseenc_plan_ptr, int echo, int shot, int ky, int kz)</div><div class="ttdoc">Set [ky,kz] coordinate from KS_PHASEENCODING_PLAN for given echo and shot</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:328</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a3d90133d3051fbc4816d02efd9566d8e"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">KS_PHASER::R</a></div><div class="ttdeci">int R</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1529</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_ad3b39ba8c626f4580806078dc4f4b211"><div class="ttname"><a href="_k_s_foundation__common_8c.html#ad3b39ba8c626f4580806078dc4f4b211">ks_phaseencoding_resize</a></div><div class="ttdeci">STATUS ks_phaseencoding_resize(KS_PHASEENCODING_PLAN *phaseenc_plan_ptr, int etl, int num_shots)</div><div class="ttdoc">Reallocate memory for KS_PHASEENCODING_PLAN entries</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:389</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">KS_PHASER::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1527</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a4762b9a6307f0223b3d1dfde7e8ddce8"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a4762b9a6307f0223b3d1dfde7e8ddce8">KS_PHASER::nacslines</a></div><div class="ttdeci">int nacslines</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1530</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_afd953f31b866a09e0418967c2bf65a59"><div class="ttname"><a href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a></div><div class="ttdeci">#define KS_NOTSET</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:60</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a22cd0313e5ffabe8393f77745dba8d52"><div class="ttname"><a href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">KS_EPI::blipphaser</a></div><div class="ttdeci">KS_PHASER blipphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1688</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a09b1a7dc77a7cf8c4e8421a23608a42a"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">KS_PHASER::numlinestoacq</a></div><div class="ttdeci">int numlinestoacq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1532</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_ad76a5ac226f0d25f70349ef83b5bc38a"><div class="ttname"><a href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">KS_EPI::zphaser</a></div><div class="ttdeci">KS_PHASER zphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1689</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a090fbced834ec878a08eadc4f829b8a3"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">KS_PHASER::linetoacq</a></div><div class="ttdeci">int linetoacq[KS_MAX_PHASEDYN]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1533</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aacb2fe1d83c45e8d0525f363bdd6b8a6"><div class="ttname"><a href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a></div><div class="ttdeci">#define KS_DESCRIPTION_LENGTH</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:112</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a1c544bec41003a594ba4ec7d43a3a470">KS_PHASEENCODING_PLAN::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1589</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ae3a267da7c3c7e4e6e523dafba9b7811ab36b1c8bcdbe924fc9d4a36cde9ba4dd"><div class="ttname"><a href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811ab36b1c8bcdbe924fc9d4a36cde9ba4dd">KS_EPI_POSBLIPS</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1741</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a08736562d66b16003d4e795e95860cf7"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a08736562d66b16003d4e795e95860cf7">KS_PHASEENCODING_PLAN::zphaser</a></div><div class="ttdeci">KS_PHASER * zphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1592</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ae3a267da7c3c7e4e6e523dafba9b7811a5b332d904cae8d59fc2f85b49ada0ae4"><div class="ttname"><a href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811a5b332d904cae8d59fc2f85b49ada0ae4">KS_EPI_NEGBLIPS</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1741</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a706b4cec8ea7b1363975e556d74de924"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a706b4cec8ea7b1363975e556d74de924">KS_PHASEENCODING_PLAN::phaser</a></div><div class="ttdeci">KS_PHASER * phaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1591</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa672c7e32ce3bce20534fa814901e720"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa672c7e32ce3bce20534fa814901e720">&#9670;&nbsp;</a></span>ks_wave_res()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_wave_res </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the number of samples in a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> sequence object</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">wave</td><td><a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">res</td><td>Resolution (i.e. number of samples) in the <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;                                     {</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;  <span class="keywordflow">if</span> (wave == NULL) {</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_wave_res: wave is NULL&quot;</span>);</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>;</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;  }</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;  <span class="keywordflow">if</span> (wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a> == NULL || wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>[0] == <span class="charliteral">&#39; &#39;</span>) {</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_wave_res: wave description not initialized or has leading space&quot;</span>);</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>;</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;  }</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;  <span class="keywordflow">if</span> (wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> &lt; 2 || wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> &gt; <a class="code" href="_k_s_foundation_8h.html#a3c3e362198a193a273f436e9e392188b">KS_MAXWAVELEN</a>) {</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_wave_res(%s): &#39;res&#39; (%d) is out of valid range [2, %d]&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>, <a class="code" href="_k_s_foundation_8h.html#a3c3e362198a193a273f436e9e392188b">KS_MAXWAVELEN</a>);</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>;</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;  }</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;  <span class="keywordflow">if</span> (wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> % 2) {</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_wave_res(%s): &#39;res&#39; (%d) must be even&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>);</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>;</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;  }</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;  <span class="keywordflow">return</span> wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>;</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_afd953f31b866a09e0418967c2bf65a59"><div class="ttname"><a href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a></div><div class="ttdeci">#define KS_NOTSET</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:60</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">KS_WAVE::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:516</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a3c3e362198a193a273f436e9e392188b"><div class="ttname"><a href="_k_s_foundation_8h.html#a3c3e362198a193a273f436e9e392188b">KS_MAXWAVELEN</a></div><div class="ttdeci">#define KS_MAXWAVELEN</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:113</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="adf7aec11f0fecce133070402558215ff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adf7aec11f0fecce133070402558215ff">&#9670;&nbsp;</a></span>ks_waveform_max()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_waveform_max </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a>&#160;</td>
          <td class="paramname"><em>waveform</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>res</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the maximum value in a KS_WAVEFORM</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">waveform</td><td>KS_WAVEFORM (float array) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">res</td><td>Resolution (i.e. number of samples) in the KS_WAVEFORM </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">maxval</td><td>Maximum value </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;                                                           {</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;  <span class="keywordtype">float</span> maxv = -1.0e38;</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;  <span class="keywordflow">if</span> (waveform == NULL) {</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_waveform_max: wave is NULL&quot;</span>);</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    <span class="keywordflow">return</span> maxv;</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;  }</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;  <span class="keywordflow">if</span> (res &lt;= 0) {</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    <span class="keywordflow">return</span> maxv;</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;  }</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; res; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    <span class="keywordflow">if</span> (waveform[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] &gt; maxv)</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;      maxv = waveform[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>];</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;  }</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;  <span class="keywordflow">return</span> maxv;</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;}</div><div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8309ba456fc3e23a10111a1439b13e21"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8309ba456fc3e23a10111a1439b13e21">&#9670;&nbsp;</a></span>ks_wave_max()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_wave_max </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the maximum value in a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> sequence object</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">wave</td><td><a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">maxval</td><td>Maximum value </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;                                       {</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#adf7aec11f0fecce133070402558215ff">ks_waveform_max</a>(wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>);</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_adf7aec11f0fecce133070402558215ff"><div class="ttname"><a href="_k_s_foundation__common_8c.html#adf7aec11f0fecce133070402558215ff">ks_waveform_max</a></div><div class="ttdeci">float ks_waveform_max(const KS_WAVEFORM waveform, int res)</div><div class="ttdoc">Returns the maximum value in a KS_WAVEFORM</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:892</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a27640b66342aa92e2fecafb0e8471785"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">KS_WAVE::waveform</a></div><div class="ttdeci">KS_WAVEFORM waveform</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:519</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="abb6bc5f956fac809f44006a5b2698ee6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abb6bc5f956fac809f44006a5b2698ee6">&#9670;&nbsp;</a></span>ks_waveform_min()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_waveform_min </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a>&#160;</td>
          <td class="paramname"><em>waveform</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>res</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the minimum value in a KS_WAVEFORM</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">waveform</td><td>KS_WAVEFORM (float array) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">res</td><td>Resolution (i.e. number of samples) in the KS_WAVEFORM </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">minval</td><td>Minimum value </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;                                                           {</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;  <span class="keywordtype">float</span> minv = 1.0e38;</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;  <span class="keywordflow">if</span> (waveform == NULL) {</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_waveform_min: wave is NULL&quot;</span>);</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;    <span class="keywordflow">return</span> minv;</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;  }</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;  <span class="keywordflow">if</span> (res &lt;= 0) {</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    <span class="keywordflow">return</span> minv;</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;  }</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; res; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    <span class="keywordflow">if</span> (waveform[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] &lt; minv)</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;      minv = waveform[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>];</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;  }</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;  <span class="keywordflow">return</span> minv;</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;}</div><div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="adce100a7702e71bfb10377f1652465a2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adce100a7702e71bfb10377f1652465a2">&#9670;&nbsp;</a></span>ks_wave_min()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_wave_min </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the minimum value in a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> sequence object</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">wave</td><td><a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">minval</td><td>Minimum value </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;                                       {</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abb6bc5f956fac809f44006a5b2698ee6">ks_waveform_min</a>(wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>);</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;}</div><div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abb6bc5f956fac809f44006a5b2698ee6"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abb6bc5f956fac809f44006a5b2698ee6">ks_waveform_min</a></div><div class="ttdeci">float ks_waveform_min(const KS_WAVEFORM waveform, int res)</div><div class="ttdoc">Returns the minimum value in a KS_WAVEFORM</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:918</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a27640b66342aa92e2fecafb0e8471785"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">KS_WAVE::waveform</a></div><div class="ttdeci">KS_WAVEFORM waveform</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:519</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a838f4d91abbaf80203c3c6cc3797d036"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a838f4d91abbaf80203c3c6cc3797d036">&#9670;&nbsp;</a></span>ks_iwave_absmax()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">short ks_iwave_absmax </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#abba996c24da629eea72eecbd9a22a873">KS_IWAVE</a>&#160;</td>
          <td class="paramname"><em>waveform</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>res</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the maximum absolute value in a KS_IWAVE</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">waveform</td><td>KS_IWAVE (short int array) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">res</td><td>Resolution (i.e. number of samples) in the KS_IWAVE </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">absmaxval</td><td>Maximum absolute value </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;                                                        {</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;  <span class="keywordtype">short</span> maxv = 0;</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;  <span class="keywordflow">if</span> (waveform == NULL) {</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: wave is NULL&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;    <span class="keywordflow">return</span> maxv;</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;  }</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;  <span class="keywordflow">if</span> (res &lt;= 0) {</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    <span class="keywordflow">return</span> maxv;</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;  }</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; res; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    <span class="keywordflow">if</span> (abs(waveform[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>]) &gt; maxv)</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;      maxv = abs(waveform[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>]);</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;  }</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;  <span class="keywordflow">return</span> maxv;</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;}</div><div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="abf8e5bff3973c32360bc0e1505db61bc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abf8e5bff3973c32360bc0e1505db61bc">&#9670;&nbsp;</a></span>ks_waveform_absmax()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_waveform_absmax </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a>&#160;</td>
          <td class="paramname"><em>waveform</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>res</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the maximum absolute value in a KS_WAVEFORM</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">waveform</td><td>KS_WAVEFORM (float array) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">res</td><td>Resolution (i.e. number of samples) in the KS_WAVEFORM </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">absmaxval</td><td>Maximum absolute value </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;                                                              {</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;  <span class="keywordtype">float</span> maxv = -1.0e38;</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;  <span class="keywordflow">if</span> (waveform == NULL) {</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_waveform_absmax: wave is NULL&quot;</span>);</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    <span class="keywordflow">return</span> maxv;</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;  }</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;  <span class="keywordflow">if</span> (res &lt;= 0) {</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    <span class="keywordflow">return</span> maxv;</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;  }</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; res; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    <span class="keywordflow">if</span> (fabs(waveform[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>]) &gt; maxv)</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;      maxv = fabs(waveform[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>]);</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;  }</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;  <span class="keywordflow">return</span> maxv;</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;}</div><div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2bfec427bf5a8966edf279b2eba23396"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2bfec427bf5a8966edf279b2eba23396">&#9670;&nbsp;</a></span>ks_wave_absmax()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_wave_absmax </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the maximum absolute value in a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> sequence object</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">wave</td><td><a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">absmaxval</td><td>Maximum absolute value </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;                                          {</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf8e5bff3973c32360bc0e1505db61bc">ks_waveform_absmax</a>(wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>);</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_abf8e5bff3973c32360bc0e1505db61bc"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf8e5bff3973c32360bc0e1505db61bc">ks_waveform_absmax</a></div><div class="ttdeci">float ks_waveform_absmax(const KS_WAVEFORM waveform, int res)</div><div class="ttdoc">Returns the maximum absolute value in a KS_WAVEFORM</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:965</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a27640b66342aa92e2fecafb0e8471785"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">KS_WAVE::waveform</a></div><div class="ttdeci">KS_WAVEFORM waveform</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:519</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7e9a8aad6f58220e83c48dd10d9a5e3c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7e9a8aad6f58220e83c48dd10d9a5e3c">&#9670;&nbsp;</a></span>ks_waveform_area()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_waveform_area </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a>&#160;</td>
          <td class="paramname"><em>waveform</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dwelltime</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the area of a KS_WAVEFORM over a specified interval given in [us]</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">waveform</td><td>KS_WAVEFORM (float array) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">start</td><td>[us] Start position of area calculation in [us] (0 = start of waveform) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">end</td><td>[us] End position of area calculation in [us] (res * dwelltime = end of waveform) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dwelltime</td><td>[us] of each waveform point (duration/res) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">area</td><td>The area of the KS_WAVEFORM over the specified interval in [(G/cm) * us] </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;                                                                                            {</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;  <span class="keywordtype">double</span> area = 0;</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;  <span class="keywordtype">int</span> start_indx = CEIL_DIV(start, dwelltime);</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;  <span class="keywordtype">int</span> end_indx = end / dwelltime;</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;  <span class="keywordflow">if</span> (waveform == NULL) {</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: wave is NULL&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;  }</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;  <span class="keywordflow">if</span> (start_indx &lt; 0) {</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: start must be &gt;= 0&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;  }</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;  <span class="keywordflow">if</span> (end_indx &gt; <a class="code" href="_k_s_foundation_8h.html#a3c3e362198a193a273f436e9e392188b">KS_MAXWAVELEN</a>) {</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: end cannot exceed %d&quot;</span>, __FUNCTION__, <a class="code" href="_k_s_foundation_8h.html#a3c3e362198a193a273f436e9e392188b">KS_MAXWAVELEN</a>);</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;  }</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = start_indx; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; end_indx; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;    area += waveform[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] * dwelltime;</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;  }</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;  <span class="comment">/* add potential partial dwell time due to CEIL_DIV, when start [us] is not divisible by dwelltime */</span></div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;  <span class="keywordflow">if</span> ((start_indx * dwelltime) &gt; start &amp;&amp; start_indx &gt; 0) {</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    area += waveform[start_indx - 1] * (((double) start_indx * dwelltime) - (double) start);</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;  }</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;  <span class="comment">/* add potential partial dwell time due to (floor) integer division, when end [us] is not divisible by dwelltime */</span></div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;  <span class="keywordflow">if</span> ((end_indx * dwelltime) &lt; end &amp;&amp; (end_indx &lt; (<a class="code" href="_k_s_foundation_8h.html#a3c3e362198a193a273f436e9e392188b">KS_MAXWAVELEN</a> - 1))) {</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    area += waveform[end_indx + 1] * ((double) end - ((<span class="keywordtype">double</span>) end_indx * dwelltime));</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;  }</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;  <span class="keywordflow">return</span> ((<span class="keywordtype">float</span>) area);</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;}</div><div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a3c3e362198a193a273f436e9e392188b"><div class="ttname"><a href="_k_s_foundation_8h.html#a3c3e362198a193a273f436e9e392188b">KS_MAXWAVELEN</a></div><div class="ttdeci">#define KS_MAXWAVELEN</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:113</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1ed01e2c72db1252e516b9c2b098bbee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1ed01e2c72db1252e516b9c2b098bbee">&#9670;&nbsp;</a></span>ks_wave_area()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_wave_area </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>end</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the area of a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object over a specified interval given in [us]</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">wave</td><td><a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">start</td><td>[us] Start position of area calculation in [us] (0 = start of waveform) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">end</td><td>[us] End position of area calculation in <a href="`.duration` = end of waveform">us</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">area</td><td>The area of the <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object over the specified interval in [(G/cm) * us] </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;                                                                {</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;  <span class="keywordtype">int</span> dwelltime = wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> / wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>;</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#a7e9a8aad6f58220e83c48dd10d9a5e3c">ks_waveform_area</a>(wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, start, end, dwelltime);</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a7e9a8aad6f58220e83c48dd10d9a5e3c"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a7e9a8aad6f58220e83c48dd10d9a5e3c">ks_waveform_area</a></div><div class="ttdeci">float ks_waveform_area(const KS_WAVEFORM waveform, int start, int end, int dwelltime)</div><div class="ttdoc">Returns the area of a KS_WAVEFORM over a specified interval given in [us]</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:991</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a27640b66342aa92e2fecafb0e8471785"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">KS_WAVE::waveform</a></div><div class="ttdeci">KS_WAVEFORM waveform</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:519</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_WAVE::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:518</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a836fc0fca52fac39fbecc05b3f1b2329"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a836fc0fca52fac39fbecc05b3f1b2329">&#9670;&nbsp;</a></span>ks_waveform_sum()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_waveform_sum </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a>&#160;</td>
          <td class="paramname"><em>waveform</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>res</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the sum of a KS_WAVEFORM</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">waveform</td><td>KS_WAVEFORM (float array) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">res</td><td>Resolution (i.e. number of samples) in the KS_WAVEFORM </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">sum</td><td>The sum of the KS_WAVEFORM </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;                                                           {</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;  <span class="keywordtype">double</span> sum = 0;</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;  <span class="keywordflow">if</span> (waveform == NULL) {</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_waveform_sum: wave is NULL&quot;</span>);</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;  }</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;  <span class="keywordflow">if</span> (res &lt;= 0) {</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_waveform_sum: res must be positive&quot;</span>);</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;  }</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; res; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;    sum += waveform[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>];</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;  }</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;  <span class="keywordflow">return</span> (<span class="keywordtype">float</span>)sum;</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;}</div><div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a147f6b9c40c1978fde2395ac2a97a88f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a147f6b9c40c1978fde2395ac2a97a88f">&#9670;&nbsp;</a></span>ks_wave_sum()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_wave_sum </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the sum of a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> sequence object</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">wave</td><td><a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">sum</td><td>The sum of the KS_WAVEFORM </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;                                       {</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#a836fc0fca52fac39fbecc05b3f1b2329">ks_waveform_sum</a>(wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>);</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a836fc0fca52fac39fbecc05b3f1b2329"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a836fc0fca52fac39fbecc05b3f1b2329">ks_waveform_sum</a></div><div class="ttdeci">float ks_waveform_sum(const KS_WAVEFORM waveform, int res)</div><div class="ttdoc">Returns the sum of a KS_WAVEFORM</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1030</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a27640b66342aa92e2fecafb0e8471785"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">KS_WAVE::waveform</a></div><div class="ttdeci">KS_WAVEFORM waveform</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:519</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a5128fc94664d4d81425a461ea4a73b09"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5128fc94664d4d81425a461ea4a73b09">&#9670;&nbsp;</a></span>ks_waveform_norm()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_waveform_norm </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a>&#160;</td>
          <td class="paramname"><em>waveform</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>res</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the 2-norm of a KS_WAVEFORM</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">waveform</td><td>KS_WAVEFORM (float array) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">res</td><td>Resolution (i.e. number of samples) in the KS_WAVEFORM </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">norm2</td><td>The 2-norm of a KS_WAVEFORM </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;                                                            {</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;  <span class="keywordtype">double</span> sum = 0;</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;  <span class="keywordflow">if</span> (waveform == NULL) {</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_waveform_norm: wave is NULL&quot;</span>);</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;  }</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;  <span class="keywordflow">if</span> (res &lt;= 0) {</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_waveform_norm: res must be positive&quot;</span>);</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;  }</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; res; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    sum += pow(fabs(waveform[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>]), 2.0);</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;  }</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;  <span class="keywordflow">return</span> (<span class="keywordtype">float</span>)sqrt(sum);</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;}</div><div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4bc0ca8d038d6083ad28d01f37cb946c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4bc0ca8d038d6083ad28d01f37cb946c">&#9670;&nbsp;</a></span>ks_wave_norm()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_wave_norm </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the 2-norm of a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a></h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">wave</td><td><a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">norm2</td><td>The 2-norm of a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;                                        {</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#a5128fc94664d4d81425a461ea4a73b09">ks_waveform_norm</a>(wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>);</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a5128fc94664d4d81425a461ea4a73b09"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a5128fc94664d4d81425a461ea4a73b09">ks_waveform_norm</a></div><div class="ttdeci">float ks_waveform_norm(const KS_WAVEFORM waveform, int res)</div><div class="ttdoc">Returns the 2-norm of a KS_WAVEFORM</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1053</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a27640b66342aa92e2fecafb0e8471785"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">KS_WAVE::waveform</a></div><div class="ttdeci">KS_WAVEFORM waveform</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:519</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a01ad5d5e6870a3b956943a73b348d69d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a01ad5d5e6870a3b956943a73b348d69d">&#9670;&nbsp;</a></span>ks_waveform_cumsum()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_waveform_cumsum </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a>&#160;</td>
          <td class="paramname"><em>cumsumwaveform</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a>&#160;</td>
          <td class="paramname"><em>waveform</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>res</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Calculates a KS_WAVEFORM with the cumulative sum (i.e. integral) of a KS_WAVEFORM</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">cumsumwaveform</td><td>KS_WAVEFORM (float array) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">waveform</td><td>KS_WAVEFORM (float array) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">res</td><td>Resolution (i.e. number of samples) in the KS_WAVEFORM </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;                                                                                         {</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>, j;</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;  <span class="keywordflow">for</span> (j = 0; j &lt; res; j++) {</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;    <span class="keywordtype">double</span> sum = 0;</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; j; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;      sum += waveform[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>];</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    }</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;    cumsumwaveform[j] = (float)sum;</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;  }</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;}</div><div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af2f69e088a1a8833c9b3e1cad2119321"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af2f69e088a1a8833c9b3e1cad2119321">&#9670;&nbsp;</a></span>ks_wave_cumsum()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_wave_cumsum </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>cumsumwave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Calculates a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> with the cumulative sum (i.e. integral) of a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a></h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">cumsumwave</td><td><a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">wave</td><td><a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;                                                              {</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;  <span class="keywordtype">int</span> res;</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;  res = (cumsumwave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> &gt; wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>) ? wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> : cumsumwave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>; <span class="comment">/* smallest of the two */</span></div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#a01ad5d5e6870a3b956943a73b348d69d">ks_waveform_cumsum</a>(cumsumwave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, res);</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a01ad5d5e6870a3b956943a73b348d69d"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a01ad5d5e6870a3b956943a73b348d69d">ks_waveform_cumsum</a></div><div class="ttdeci">void ks_waveform_cumsum(KS_WAVEFORM cumsumwaveform, const KS_WAVEFORM waveform, int res)</div><div class="ttdoc">Calculates a KS_WAVEFORM with the cumulative sum (i.e. integral) of a KS_WAVEFORM</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1076</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a27640b66342aa92e2fecafb0e8471785"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">KS_WAVE::waveform</a></div><div class="ttdeci">KS_WAVEFORM waveform</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:519</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a183b6f1b3697030d122bb4a0cfda5619"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a183b6f1b3697030d122bb4a0cfda5619">&#9670;&nbsp;</a></span>ks_waveform_multiply()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_waveform_multiply </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a>&#160;</td>
          <td class="paramname"><em>waveform_mod</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a>&#160;</td>
          <td class="paramname"><em>waveform</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>res</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>In-place multiplication of one KS_WAVEFORM with another KS_WAVEFORM</h4>
</p>
<p>Multiplication of waveform <code>a</code> (arg 1) with waveform <code>b</code> (arg 2) as: <code>a *= b</code></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">waveform_mod</td><td><a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">waveform</td><td>KS_WAVEFORM (float array) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">res</td><td>Resolution (i.e. number of samples) in the KS_WAVEFORM </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;                                                                                         {</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; res; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;    waveform_mod[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] *= waveform[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>];</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;  }</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;}</div><div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a89145883bc5e8fcf4a93002535aa50a3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a89145883bc5e8fcf4a93002535aa50a3">&#9670;&nbsp;</a></span>ks_wave_multiply()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_wave_multiply </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave_mod</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>In-place multiplication of one <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> with another <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a></h4>
</p>
<p>Multiplication of waveform <code>a</code> (arg 1) with waveform <code>b</code> (arg 2) as: <code>a *= b</code></p>
<p>If the duration of the two <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> objects have different resolution, the shorter <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> will be multiplied with the first part of the longer <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">wave_mod</td><td><a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">wave</td><td><a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;                                                              {</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;  <span class="keywordtype">int</span> res;</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;  res = (wave_mod-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> &gt; wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>) ? wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> : wave_mod-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>; <span class="comment">/* smallest of the two */</span></div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#a183b6f1b3697030d122bb4a0cfda5619">ks_waveform_multiply</a>(wave_mod-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, res);</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a183b6f1b3697030d122bb4a0cfda5619"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a183b6f1b3697030d122bb4a0cfda5619">ks_waveform_multiply</a></div><div class="ttdeci">void ks_waveform_multiply(KS_WAVEFORM waveform_mod, const KS_WAVEFORM waveform, int res)</div><div class="ttdoc">In-place multiplication of one KS_WAVEFORM with another KS_WAVEFORM</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1097</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a27640b66342aa92e2fecafb0e8471785"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">KS_WAVE::waveform</a></div><div class="ttdeci">KS_WAVEFORM waveform</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:519</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0a23f59d14bb955dd5a9e19bb705cb70"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0a23f59d14bb955dd5a9e19bb705cb70">&#9670;&nbsp;</a></span>ks_waveform_add()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_waveform_add </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a>&#160;</td>
          <td class="paramname"><em>waveform_mod</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a>&#160;</td>
          <td class="paramname"><em>waveform</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>res</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>In-place addition of one KS_WAVEFORM with another KS_WAVEFORM</h4>
</p>
<p>Addition of waveform <code>a</code> (arg 1) with waveform <code>b</code> (arg 2) as: <code>a += b</code></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">waveform_mod</td><td>KS_WAVEFORM (float array) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">waveform</td><td>KS_WAVEFORM (float array) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">res</td><td>Resolution (i.e. number of samples) in the KS_WAVEFORM </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;                                                                                    {</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; res; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;    waveform_mod[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] += waveform[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>];</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;  }</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;}</div><div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a74cda06697c45a3c9914e6b091be5efb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a74cda06697c45a3c9914e6b091be5efb">&#9670;&nbsp;</a></span>ks_wave_add()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_wave_add </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave_mod</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>In-place addition of one <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> with another <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a></h4>
</p>
<p>Addition of waveform <code>a</code> (arg 1) with waveform <code>b</code> (arg 2) as: <code>a *= b</code></p>
<p>If the duration of the two <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> objects have different resolution, the shorter <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> will be added to the first part of the longer <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">wave_mod</td><td><a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">wave</td><td><a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;                                                         {</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;  <span class="keywordtype">int</span> res;</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;  res = (wave_mod-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> &gt; wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>) ? wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> : wave_mod-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>; <span class="comment">/* smallest of the two */</span></div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#a0a23f59d14bb955dd5a9e19bb705cb70">ks_waveform_add</a>(wave_mod-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, res);</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a0a23f59d14bb955dd5a9e19bb705cb70"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a0a23f59d14bb955dd5a9e19bb705cb70">ks_waveform_add</a></div><div class="ttdeci">void ks_waveform_add(KS_WAVEFORM waveform_mod, const KS_WAVEFORM waveform, int res)</div><div class="ttdoc">In-place addition of one KS_WAVEFORM with another KS_WAVEFORM</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1112</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a27640b66342aa92e2fecafb0e8471785"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">KS_WAVE::waveform</a></div><div class="ttdeci">KS_WAVEFORM waveform</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:519</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ace0cae3befbb3608319f34a61657bc26"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ace0cae3befbb3608319f34a61657bc26">&#9670;&nbsp;</a></span>ks_waveform_multiplyval()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_waveform_multiplyval </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a>&#160;</td>
          <td class="paramname"><em>waveform</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>val</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>res</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>In-place scalar multiplication of a KS_WAVEFORM</h4>
</p>
<p>The values in a KS_WAVEFORM are multiplied with a scalar value <code>val</code></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">waveform</td><td>KS_WAVEFORM (float array) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">val</td><td>Floating point value to multiply with </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">res</td><td>Resolution (i.e. number of samples) in the KS_WAVEFORM </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;                                                                       {</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; res; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;    waveform[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] *= val;</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;  }</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;}</div><div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a23b3d305df1e2ad0563f8a2fea2330df"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a23b3d305df1e2ad0563f8a2fea2330df">&#9670;&nbsp;</a></span>ks_wave_multiplyval()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_wave_multiplyval </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>val</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>In-place scalar multiplication of a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a></h4>
</p>
<p>The waveform values in a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> sequence object (<code>.waveform[]</code>) are multiplied with a scalar value <code>val</code></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">wave</td><td><a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">val</td><td>Floating point value to multiply with </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;                                                   {</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#ace0cae3befbb3608319f34a61657bc26">ks_waveform_multiplyval</a>(wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, val, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>);</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_ace0cae3befbb3608319f34a61657bc26"><div class="ttname"><a href="_k_s_foundation__common_8c.html#ace0cae3befbb3608319f34a61657bc26">ks_waveform_multiplyval</a></div><div class="ttdeci">void ks_waveform_multiplyval(KS_WAVEFORM waveform, float val, int res)</div><div class="ttdoc">In-place scalar multiplication of a KS_WAVEFORM</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1127</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a27640b66342aa92e2fecafb0e8471785"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">KS_WAVE::waveform</a></div><div class="ttdeci">KS_WAVEFORM waveform</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:519</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae029b50a84f55155fdca946ec828e3fc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae029b50a84f55155fdca946ec828e3fc">&#9670;&nbsp;</a></span>ks_waveform_addval()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_waveform_addval </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a>&#160;</td>
          <td class="paramname"><em>waveform</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>val</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>res</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>In-place scalar addition of a KS_WAVEFORM</h4>
</p>
<p>The values in a KS_WAVEFORM are added with a scalar value <code>val</code></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">waveform</td><td>KS_WAVEFORM (float array) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">val</td><td>Floating point value to add </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">res</td><td>Resolution (i.e. number of samples) in the KS_WAVEFORM </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;                                                                  {</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; res; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;    waveform[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] += val;</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;  }</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;}</div><div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a66a14bcaf8bf19a334866090c1f2ee49"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a66a14bcaf8bf19a334866090c1f2ee49">&#9670;&nbsp;</a></span>ks_wave_addval()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_wave_addval </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>val</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>In-place scalar addition of a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a></h4>
</p>
<p>The waveform values in a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> sequence object (<code>.waveform[]</code>) are added with a scalar value <code>val</code></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">wave</td><td><a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">val</td><td>Floating point value to add </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;                                              {</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#ae029b50a84f55155fdca946ec828e3fc">ks_waveform_addval</a>(wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, val, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>);</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_ae029b50a84f55155fdca946ec828e3fc"><div class="ttname"><a href="_k_s_foundation__common_8c.html#ae029b50a84f55155fdca946ec828e3fc">ks_waveform_addval</a></div><div class="ttdeci">void ks_waveform_addval(KS_WAVEFORM waveform, float val, int res)</div><div class="ttdoc">In-place scalar addition of a KS_WAVEFORM</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1140</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a27640b66342aa92e2fecafb0e8471785"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">KS_WAVE::waveform</a></div><div class="ttdeci">KS_WAVEFORM waveform</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:519</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8a25c2686e8915b6953cee6568ec69e3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8a25c2686e8915b6953cee6568ec69e3">&#9670;&nbsp;</a></span>ks_waveform2iwave()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_waveform2iwave </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_k_s_foundation_8h.html#abba996c24da629eea72eecbd9a22a873">KS_IWAVE</a>&#160;</td>
          <td class="paramname"><em>iwave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a>&#160;</td>
          <td class="paramname"><em>waveform</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>res</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>board</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>(<em>Internal use</em>) Conversion of a KS_WAVEFORM to a short int array for use on hardware</h4>
</p>
<p>This function is used internally by <a class="el" href="_k_s_foundation_8h.html#afc06ade569c7b85c1aa5026fc2e1c710" title="Places a KS_WAVE sequence object on a board at some position in the pulse sequence">ks_pg_wave()</a> and there should be no need to call this function directly.</p>
<p>For all boards except THETA, this function auto-scales the (float) values in KS_WAVEFORM so that the maximum absolute value becomes +/- 32766. The output short int (KS_IWAVE) array is to be copied to hardware. For a KS_WAVEFORM on the THETA board, the necessary phase wraps and scaling to short int format is performed using <a class="el" href="_k_s_foundation_8h.html#acc2435255232dccd6cd217bc605422cd" title="Returns the integer phase (internal use)">ks_phase_degrees2hw()</a>. GE's requirement of only having even numbers in the waveform except for a final odd value (end-of-waveform) is also taken care of here</p>
<p>Note that the preservation of the physical units are done in <a class="el" href="_k_s_foundation_8h.html#afc06ade569c7b85c1aa5026fc2e1c710" title="Places a KS_WAVE sequence object on a board at some position in the pulse sequence">ks_pg_wave()</a> by setting the correct instruction amplitude to multiply this auto-scaled waveform with in the sequence's hardware memory</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">iwave</td><td>KS_IWAVE (short int array) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">waveform</td><td>KS_WAVEFORM </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">res</td><td>Resolution (i.e. number of samples) in the KS_WAVEFORM </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">board</td><td>One of XGRAD, YGRAD, ZGRAD, RHO, THETA, OMEGA </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;                                                                                         {</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;  <span class="keywordflow">if</span> (board != THETA) {</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;    <span class="keywordtype">float</span> absmax = <a class="code" href="_k_s_foundation__common_8c.html#abf8e5bff3973c32360bc0e1505db61bc">ks_waveform_absmax</a>(waveform, res);</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; res; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;      iwave[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] = ((short) (max_pg_wamp * waveform[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] / absmax)) &amp; ~WEOS_BIT;</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;    }</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; res; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;      iwave[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] = ((short) <a class="code" href="_k_s_foundation__common_8c.html#aa875ce80cee0a35eb44d31f981de253a">ks_phase_degrees2hw</a>(waveform[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>])) &amp; ~WEOS_BIT;</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;    }</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;  }</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;  <span class="comment">/* set end-of-waveform flag */</span></div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;  iwave[res - 1] |= WEOS_BIT;</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;} <span class="comment">/* ks_wave2iwave() */</span></div><div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf8e5bff3973c32360bc0e1505db61bc"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf8e5bff3973c32360bc0e1505db61bc">ks_waveform_absmax</a></div><div class="ttdeci">float ks_waveform_absmax(const KS_WAVEFORM waveform, int res)</div><div class="ttdoc">Returns the maximum absolute value in a KS_WAVEFORM</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:965</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_aa875ce80cee0a35eb44d31f981de253a"><div class="ttname"><a href="_k_s_foundation__common_8c.html#aa875ce80cee0a35eb44d31f981de253a">ks_phase_degrees2hw</a></div><div class="ttdeci">short ks_phase_degrees2hw(float phase)</div><div class="ttdoc">Returns the integer phase (internal use)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:234</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9506a3d2dc5e084c69dda40e8e127a97"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9506a3d2dc5e084c69dda40e8e127a97">&#9670;&nbsp;</a></span>ks_wave2iwave()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_wave2iwave </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_k_s_foundation_8h.html#abba996c24da629eea72eecbd9a22a873">KS_IWAVE</a>&#160;</td>
          <td class="paramname"><em>iwave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>board</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>(<em>Internal use</em>) Conversion of waveform content in a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> sequence object to a short int array for use on hardware</h4>
</p>
<p>This function is used internally by <a class="el" href="_k_s_foundation_8h.html#afc06ade569c7b85c1aa5026fc2e1c710" title="Places a KS_WAVE sequence object on a board at some position in the pulse sequence">ks_pg_wave()</a> and there should be no need to call this function directly.</p>
<p>For all boards except THETA, this function auto-scales the (float) values in the <code>.waveform[]</code> field so that the maximum absolute value becomes +/- 32766. The output short int (KS_IWAVE) array is to be copied to hardware. For a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> on the THETA board, the necessary phase wraps and scaling to short int format is performed using <a class="el" href="_k_s_foundation_8h.html#acc2435255232dccd6cd217bc605422cd" title="Returns the integer phase (internal use)">ks_phase_degrees2hw()</a>. GE's requirement of only having even numbers in the waveform except for a final odd value (end-of-waveform) is also taken care of here</p>
<p>Note that the preservation of the physical units are done in <a class="el" href="_k_s_foundation_8h.html#afc06ade569c7b85c1aa5026fc2e1c710" title="Places a KS_WAVE sequence object on a board at some position in the pulse sequence">ks_pg_wave()</a> by setting the correct instruction amplitude to multiply this auto-scaled waveform with in the sequence's hardware memory</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">iwave</td><td>KS_IWAVE (short int array) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">wave</td><td><a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">board</td><td>One of XGRAD, YGRAD, ZGRAD, RHO, THETA, OMEGA </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;                                                                     {</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#a8a25c2686e8915b6953cee6568ec69e3">ks_waveform2iwave</a>(iwave, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>, board);</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a8a25c2686e8915b6953cee6568ec69e3"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a8a25c2686e8915b6953cee6568ec69e3">ks_waveform2iwave</a></div><div class="ttdeci">STATUS ks_waveform2iwave(KS_IWAVE iwave, const KS_WAVEFORM waveform, int res, int board)</div><div class="ttdoc">(Internal use) Conversion of a KS_WAVEFORM to a short int array for use on hardware</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1155</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a27640b66342aa92e2fecafb0e8471785"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">KS_WAVE::waveform</a></div><div class="ttdeci">KS_WAVEFORM waveform</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:519</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a220c36b2fe5f7910508f38d66cfd6335"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a220c36b2fe5f7910508f38d66cfd6335">&#9670;&nbsp;</a></span>ks_pg_echossp()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">WF_PULSE* ks_pg_echossp </td>
          <td>(</td>
          <td class="paramtype">WF_PULSE *&#160;</td>
          <td class="paramname"><em>echo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>suffix</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the pointer to XTR or RBA for an echo WF_PULSE (<em>internal use</em>)</h4>
</p>
<p>This function is used internally by <a class="el" href="_k_s_foundation_8h.html#a5b50d0ffcc69966c42bceb7e67c70cbf" title="Places a KS_READ sequence object at some position in the pulse sequence">ks_pg_read()</a> to get pointers to the XTR and RBA SSP packets for an acquisition window</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">echo</td><td>Pointer to an echo (WF_PULSE) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">suffix</td><td>String being "xtr", "rba", or empty </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">wfptr</td><td>Pointer to a WF_PULSE </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;                                                       {</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;  <span class="keywordflow">if</span> (!strcmp(suffix, <span class="stringliteral">&quot;xtr&quot;</span>)) {</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;    <span class="keywordflow">return</span> echo-&gt;assoc_pulse;</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(suffix, <span class="stringliteral">&quot;rba&quot;</span>)) {</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;    <span class="keywordflow">return</span> echo-&gt;assoc_pulse-&gt;assoc_pulse;</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;    <span class="keywordflow">return</span> echo;</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;  }</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="ab3341eea000c35a438dfeb3cfc1da103"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab3341eea000c35a438dfeb3cfc1da103">&#9670;&nbsp;</a></span>ks_pg_trap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_pg_trap </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> *&#160;</td>
          <td class="paramname"><em>trap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a>&#160;</td>
          <td class="paramname"><em>loc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>ctrl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Places a <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> sequence object on a board at some position in the pulse sequence</h4>
</p>
<p>This function should be called in the <code>@pg</code> section to place out a <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> sequence object that creates a static trapezoid in the pulse sequence. The same <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object can be freely placed on XGRAD, YGRAD and ZGRAD as many times as desired, by only changing the second argument each time (to avoid waveform overlaps). The second argument is a <a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> struct with three fields:</p><ul>
<li><code>.board</code>: Choose between XGRAD, YGRAD, ZGRAD (or OMEGA)</li>
<li><code>.pos</code>: Absolute time in [us] of the start of the attack ramp of the trapezoid</li>
<li><code>.ampscale</code>: A factor that must be in range [-1.0,1.0] that is multiplied with <code>.amp</code> to yield a per-instance (i.e. per-placement) amplitude ([G/cm]). The simplest is to use 1.0, which makes the <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object to be placed out on the board as initially designed using <a class="el" href="_k_s_foundation_8h.html#af40cc818066c7757959bf3712bfc5e6f" title="Sets up a trapezoid using a KS_TRAP sequence object with preset gradient constraints">ks_eval_trap()</a>. For the OMEGA board, this factor must be 1.0.</li>
</ul>
<p>Regardless of the order placed out in the <code>@pg</code> section, and on which boards (XGRAD, YGRAD, ZGRAD) the <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object is placed, the <em>instance</em> number of the <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> is automatically sorted in time. If two instances of one <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> occur at the same time (<code>.pos</code>) on different boards, XGRAD comes before YGRAD, which comes before ZGRAD. These abstract, sorted, instance numbers are used by <code>ks_scan_***()</code> functions in <a class="el" href="ksepi_8e.html#a1669428052472d00b1c55a1291f8032f">scan()</a> to refer to a specific instance of a <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object in the sequence</p>
<p>If the <code>.duration</code> field in the <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object is 0, <a class="el" href="_k_s_foundation_8h.html#a61651c54c4dfd4388fc939d804a9964b" title="Places a KS_TRAP sequence object on a board at some position in the pulse sequence">ks_pg_trap()</a> will return SUCCESS and quietly ignore placing it out. This is a part of the mechanism that setting the <code>.duration</code> field to 0 in <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code> should eliminate its existance in both timing calulations and in the pulse sequence generation in <code>@pg</code></p>
<p>When a trapezoid is placed on OMEGA, neither the designed amplitude (the <code>.amp</code> field in <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a>) nor the <code>.ampscale</code> (in <a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a>) has an effect on the final frequency modulation. Instead the run-time amplitude of a <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object on the OMEGA board is controlled in <a class="el" href="ksepi_8e.html#a1669428052472d00b1c55a1291f8032f">scan()</a> via a function called <a class="el" href="_k_s_foundation_8h.html#adbd649762fa938de96662bdc9a721863" title="Updates a KS_TRAP object on the OMEGA board to produce a frequency offset">ks_scan_omegatrap_hz()</a></p>
<p>GENERAL NOTE: It is a <b>requirement</b> that the function in the <code>@pg</code> section containing all <code>ks_pg_***()</code> calls is also called exactly once in <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code> after the calls to the corresponding <code>ks_eval_***()</code> functions that design the KS_*** sequence objects. Each <code>ks_pg_***()</code> will throw an error if this has not been done.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">trap</td><td>Pointer to a <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> sequence object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">loc</td><td><a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> struct to specify when and where to place the <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctrl</td><td>Pointer to the <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> struct corresponding to the sequence module for this <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;                                                                      {</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;  <span class="keywordtype">float</span> boardmax;</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;  <span class="keywordtype">char</span> boardc[7] = <span class="stringliteral">&quot;xyz---o&quot;</span>;</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;  boardmax = <a class="code" href="_k_s_foundation__common_8c.html#aa65115d54842eeffc47a1b324caa62ab">ks_syslimits_gradtarget</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>); <span class="comment">/* returns 1.0 for OMEGA board */</span></div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;  <span class="comment">/* checking for NULL pointers */</span></div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;  <span class="keywordflow">if</span> (trap == NULL) {</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_trap: First argument is NULL&quot;</span>);</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;  }</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;  <span class="comment">/* duration of 0 should not throw an error as this is a sign of that it has not been set up</span></div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;<span class="comment">     or has manually been disabled this way */</span></div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;  <span class="keywordflow">if</span> (trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> == 0) {</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;    <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;  }</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;  <span class="keywordflow">if</span> (trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a> == NULL || trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>[0] == 0 || trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>[0] == <span class="charliteral">&#39; &#39;</span>) {</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_trap: Invalid description (&#39;%s&#39;)&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;  }</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;  <span class="comment">/* TGT: Don&#39;t place anything on hardware if ctrl-&gt;duration = 0.</span></div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;<span class="comment">     This is in concert with:</span></div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;<span class="comment">     - not performing createseq() in KS_SEQLENGTH if seqctrl.duration = 0</span></div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;<span class="comment">     - not playing sequence modules in scan() using ks_scan_playsequence() if seqctrl.duration = 0</span></div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;  <span class="keywordflow">if</span> (ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> == 0) {</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s(%s): Refusing to place trap since seqctrl.duration = 0 (indicating `%s` not to be played in scan())&quot;</span>, __FUNCTION__, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;  }</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;  <span class="comment">/* input validation */</span></div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;  <span class="keywordflow">if</span> ((trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a> % 4) || (trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">plateautime</a> % 4) || (trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> % 4)) {</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_trap(%s): All timing parameters must be divisible by 4&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;  }</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;  <span class="keywordflow">if</span> ((trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a> &lt; 4) || (trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">plateautime</a> &lt; 4) || (trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> &lt; 4)) {</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_trap(%s): All timing parameters must be at least 4 us&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;  }</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> != loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a>) {</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_trap(%s): loc.ampscale NaN&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;  }</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> != loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>) {</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_trap(%s): loc.pos NaN&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;  }</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> != loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>) {</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_trap(%s): loc.board NaN&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;  }</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> &lt; GRAD_UPDATE_TIME || loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> &gt; 4e6) {</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_trap(%s): Invalid position %d, it must be between 4us and 4s&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>);</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;  }</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == OMEGA &amp;&amp; loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> != 1.0) {</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_trap(%s): ampscale must be +1.0 for OMEGA&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;  }</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> &lt; -1.0 || loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> &gt; 1.0) {</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_trap(%s): Invalid ampscale %g, it must be between -1.0 and 1.0&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a>);</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;  }</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> != XGRAD &amp;&amp; loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> != YGRAD &amp;&amp; loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> != ZGRAD &amp;&amp; loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> != OMEGA) {</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_trap(%s): Invalid board code %d, it must be %d (XGRAD), %d (YGRAD), %d (ZGRAD) or %d (OMEGA)&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>, XGRAD, YGRAD, ZGRAD, OMEGA);</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;  }</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;  <span class="keywordflow">if</span> (fabs(trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a> * loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a>) &gt; boardmax) {</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_trap(%s): trapezoid amplitude %g exceeds maximum (%g) for board %c&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a> * loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a>, boardmax, boardc[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>]);</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;  }</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;  loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> = RUP_GRD(loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>);</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;  {</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;    <span class="keywordtype">char</span> tmpstr[<a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> + 7];</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;    tmpstr[<a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> + 7 - 1] = 0;</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;    <span class="keywordflow">if</span> (trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a> &gt;= trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>) {</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;      <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_trap @tgt(%s): the number of instances generated on the target exceeds the number of ones generated on the host&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;      <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;    }</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;    <span class="keywordflow">if</span> (!ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#af7f2aa8614e77ef8af0154c7e071ab0e">is_cleared_on_tgt</a>) <span class="comment">/* Reset gradrfctrl on tgt to remove dead pointers copied from host. */</span></div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;    {</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;      <a class="code" href="_k_s_foundation_8h.html#a4ec679c0fb8eb62c1776e67434e25b77">ks_tgt_reset_gradrfctrl</a>(&amp;ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>);</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;    }</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;    <span class="comment">/* TODO: consider freeing memory if ngenerated is zero -- EA */</span></div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;    <span class="keywordflow">if</span> (trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a> == NULL) {</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;      WF_PULSE wfInit = INITPULSE;</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;      trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a> = (WF_PULSE **) AllocNode(8 * <span class="keyword">sizeof</span>(WF_PULSE *)); <span class="comment">/* X, Y, Z, (OMEGA = 6). Not applicable to other boards */</span></div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = XGRAD; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt;= OMEGA; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> == XGRAD || <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> == YGRAD || <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> == ZGRAD || <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> == OMEGA) {</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;          trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] = (WF_PULSE *) AllocNode(3 * <span class="keyword">sizeof</span>(WF_PULSE)); <span class="comment">/* attack, plateau, decay */</span></div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;          <span class="comment">/* init pulse structure */</span></div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;          trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>][<a class="code" href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5ae2ef535229a83f6deb239caa1ff7120e">G_ATTACK</a>] = wfInit;</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;          trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>][<a class="code" href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5ac00e089392912df36396789decb230a4">G_PLATEAU</a>] = wfInit;</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;          trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>][<a class="code" href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5a8b1103e672a6fc1aa616ac7f422410de">G_DECAY</a>] = wfInit;</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;          <span class="comment">/* Name for WF_PULSEs */</span></div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;          sprintf(tmpstr, <span class="stringliteral">&quot;%s.%ca&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, boardc[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>]); pulsename(&amp;(trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>][<a class="code" href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5ae2ef535229a83f6deb239caa1ff7120e">G_ATTACK</a>]), tmpstr);</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;          sprintf(tmpstr, <span class="stringliteral">&quot;%s.%c&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>,  boardc[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>]); pulsename(&amp;(trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>][<a class="code" href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5ac00e089392912df36396789decb230a4">G_PLATEAU</a>]), tmpstr);</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;          sprintf(tmpstr, <span class="stringliteral">&quot;%s.%cd&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, boardc[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>]); pulsename(&amp;(trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>][<a class="code" href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5a8b1103e672a6fc1aa616ac7f422410de">G_DECAY</a>]), tmpstr);</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;          createramp(&amp;(trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>][<a class="code" href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5ae2ef535229a83f6deb239caa1ff7120e">G_ATTACK</a>]), <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a>, 0, max_pg_wamp,</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;                     <a class="code" href="_k_s_foundation__common_8c.html#ae202b6536335ff4d767690e182e8fc4f">maxGradRes</a> * (trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a> / GRAD_UPDATE_TIME), 1.0);</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;          createconst(&amp;(trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>][<a class="code" href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5ac00e089392912df36396789decb230a4">G_PLATEAU</a>]), <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">plateautime</a>, max_pg_wamp);</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;          createramp(&amp;(trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>][<a class="code" href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5a8b1103e672a6fc1aa616ac7f422410de">G_DECAY</a>]), <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a>, max_pg_wamp, 0,</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;                     <a class="code" href="_k_s_foundation__common_8c.html#ae202b6536335ff4d767690e182e8fc4f">maxGradRes</a> * (trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a> / GRAD_UPDATE_TIME), 1.0);</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;          linkpulses(3, &amp;(trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>][<a class="code" href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5ac00e089392912df36396789decb230a4">G_PLATEAU</a>]), &amp;(trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>][<a class="code" href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5ae2ef535229a83f6deb239caa1ff7120e">G_ATTACK</a>]), &amp;(trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>][<a class="code" href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5a8b1103e672a6fc1aa616ac7f422410de">G_DECAY</a>]));</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;          trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] = NULL;</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;        }</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;      } <span class="comment">/* per board */</span></div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;    } <span class="comment">/* wfpulse == NULL */</span></div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;    <span class="comment">/* allocate the array of WFINSTANCE&#39;s if needed */</span></div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;    <span class="keywordflow">if</span> (!trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>) {</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;      trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">wfi</a> = (<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a> *) AllocNode(trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a> * <span class="keyword">sizeof</span>(<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a>));</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;    }</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;    <span class="comment">/* Set instruction amplitudes at the proper position and board */</span></div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;    {</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">int</span> corrected_pos = loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> + (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == OMEGA)*<a class="code" href="_k_s_foundation__common_8c.html#a636634b6eb50758af3826332f9180e9b">psd_rf_wait</a>;</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;      <span class="comment">/* creating new instructions */</span></div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;      createinstr(&amp;(trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>][<a class="code" href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5ae2ef535229a83f6deb239caa1ff7120e">G_ATTACK</a>]),</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;                  corrected_pos,</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;                  trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a>,</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;                  trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a> * loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> * MAX_PG_IAMP / boardmax);</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;      createinstr(&amp;(trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>][<a class="code" href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5ac00e089392912df36396789decb230a4">G_PLATEAU</a>]),</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;                  corrected_pos + trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a>,</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;                  trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">plateautime</a>,</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;                  trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a> * loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> * MAX_PG_IAMP / boardmax);</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;      createinstr(&amp;(trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>][<a class="code" href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5a8b1103e672a6fc1aa616ac7f422410de">G_DECAY</a>]),</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;                  corrected_pos + trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a> + trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">plateautime</a>,</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;                  trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a>,</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;                  trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a> * loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> * MAX_PG_IAMP / boardmax);</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;    }</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;    <span class="comment">/* initializing the corresponding KS_WFINSTANCE */</span></div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;    trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">boardinstance</a> = trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>][<a class="code" href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5ac00e089392912df36396789decb230a4">G_PLATEAU</a>].ninsts - 1; <span class="comment">/* zero based */</span></div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;    trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">wf</a> = &amp;(trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>][<a class="code" href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5ac00e089392912df36396789decb230a4">G_PLATEAU</a>]);</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;    trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a> = loc;</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;    trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>++;</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;    <span class="comment">/* sort after the last instance is generated */</span></div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;    <span class="keywordflow">if</span> (trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a> == trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>) {</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;      <a class="code" href="_k_s_foundation__common_8c.html#a0ae65ed3cc2deb47ccf50b7988239474">ks_sort_wfi_by_timeboard</a>(trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>);</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;    }</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;  }</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;<span class="preprocessor">#else </span><span class="comment">/* TGT(IPG) or HOST */</span><span class="preprocessor"></span></div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;  {</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;    <span class="comment">/* HOST */</span></div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;    trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a89785a274d251fd637bf40923ad5c345">locs</a>[trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>] = loc;</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;    <span class="comment">/* update instance counter on host only. This counter is used to allocate the right amount of WFINSTANCEs on IPG */</span></div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;    trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>++;</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;    <span class="comment">/* for trap, we also need to keep track of #instances per X, Y, Z for gradient heating calculations.</span></div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;<span class="comment">       As this needs to be done in HOST before the IPG (target), we can&#39;t use the wfi[...].boardinstance or .loc information above for this */</span></div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;    <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == XGRAD || loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == YGRAD || loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == ZGRAD)</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;      trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a3fb111f1302287e152078110b3b37d6f">gradnum</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>]++;</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;  }</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* IPG */</span><span class="preprocessor"></span></div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;    <span class="comment">/* register this KS_TRAP for later heating calculations */</span></div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;    {</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;      STATUS status = <a class="code" href="_k_s_foundation__common_8c.html#a88386ac54f37a7fb0dc91302e585ccae">ks_eval_addtraptogradrfctrl</a>(&amp;ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>, trap);</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;      <span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;    }</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;} <span class="comment">/* ks_pg_trap */</span></div><div class="ttc" id="_k_s_foundation__common_8c_html_a88386ac54f37a7fb0dc91302e585ccae"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a88386ac54f37a7fb0dc91302e585ccae">ks_eval_addtraptogradrfctrl</a></div><div class="ttdeci">STATUS ks_eval_addtraptogradrfctrl(KS_GRADRFCTRL *gradrfctrl, KS_TRAP *trap)</div><div class="ttdoc">*Internal use*. Adds a trapezoid (KS_TRAP) to the KS_GRADRFCTRL struct for later gradient heating cal...</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:3437</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a0ae65ed3cc2deb47ccf50b7988239474"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a0ae65ed3cc2deb47ccf50b7988239474">ks_sort_wfi_by_timeboard</a></div><div class="ttdeci">void ks_sort_wfi_by_timeboard(KS_WFINSTANCE *a, int nitems)</div><div class="ttdoc">Sort WF_INSTANCEs in time, then board</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2955</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a878bb367b07dc7dfb5fef5728d2e5b1d"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">KS_TRAP::plateautime</a></div><div class="ttdeci">int plateautime</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:436</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a42df2e3be0bda47009caae1a7042b522"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">KS_WFINSTANCE::boardinstance</a></div><div class="ttdeci">int boardinstance</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:251</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">KS_TRAP::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:431</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a1910d262855b71da353ed0d07a6c7823"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">KS_SEQLOC::pos</a></div><div class="ttdeci">int pos</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:242</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a></div><div class="ttdoc">(Internal use) Structure being a part of various sequence objects to sort them in time across boards...</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:250</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a72a22b96ff3908d2b9a20a3a02647a2f"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">KS_BASE::ninst</a></div><div class="ttdeci">int ninst</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:261</div></div>
<div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a2e3f5254967cadb9a41167c6fbf6743e"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">KS_SEQLOC::board</a></div><div class="ttdeci">int board</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:241</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_SEQ_CONTROL::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:984</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a606fbf556e8a297aa1f68b098f6ac2a2"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">KS_SEQLOC::ampscale</a></div><div class="ttdeci">float ampscale</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:243</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a51a2c4637bfcef5c062d3c794ed4ded5ac00e089392912df36396789decb230a4"><div class="ttname"><a href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5ac00e089392912df36396789decb230a4">G_PLATEAU</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1737</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a2573e18f36ab5c3d3fc97072edcfab16"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">KS_SEQ_CONTROL::gradrf</a></div><div class="ttdeci">KS_GRADRFCTRL gradrf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:992</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a15be3edad342a49398ca841c2745dc9e"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">KS_TRAP::wfi</a></div><div class="ttdeci">KS_WFINSTANCE * wfi</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:441</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aacb2fe1d83c45e8d0525f363bdd6b8a6"><div class="ttname"><a href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a></div><div class="ttdeci">#define KS_DESCRIPTION_LENGTH</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:112</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_ae202b6536335ff4d767690e182e8fc4f"><div class="ttname"><a href="_k_s_foundation__common_8c.html#ae202b6536335ff4d767690e182e8fc4f">maxGradRes</a></div><div class="ttdeci">int maxGradRes</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a78e529e1d86855310035845e03a4c107"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">KS_WFINSTANCE::loc</a></div><div class="ttdeci">KS_SEQLOC loc</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:253</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_af7f2aa8614e77ef8af0154c7e071ab0e"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#af7f2aa8614e77ef8af0154c7e071ab0e">KS_GRADRFCTRL::is_cleared_on_tgt</a></div><div class="ttdeci">int is_cleared_on_tgt</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:823</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_aa65115d54842eeffc47a1b324caa62ab"><div class="ttname"><a href="_k_s_foundation__common_8c.html#aa65115d54842eeffc47a1b324caa62ab">ks_syslimits_gradtarget</a></div><div class="ttdeci">float ks_syslimits_gradtarget(LOG_GRAD loggrd, WF_PROCESSOR board)</div><div class="ttdoc">Returns the maximum target amplitude for a board (internal use)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:176</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ab508ded41392ee86a2a619d3e93d2373"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">KS_TRAP::amp</a></div><div class="ttdeci">float amp</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:433</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a89785a274d251fd637bf40923ad5c345"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a89785a274d251fd637bf40923ad5c345">KS_TRAP::locs</a></div><div class="ttdeci">KS_SEQLOC locs[KS_MAXINSTANCES]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:439</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a558b0ff480e8db364962bd0f203d6958"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">KS_WFINSTANCE::wf</a></div><div class="ttdeci">WF_PULSE * wf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:252</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">KS_TRAP::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:432</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4ec679c0fb8eb62c1776e67434e25b77"><div class="ttname"><a href="_k_s_foundation_8h.html#a4ec679c0fb8eb62c1776e67434e25b77">ks_tgt_reset_gradrfctrl</a></div><div class="ttdeci">void ks_tgt_reset_gradrfctrl(KS_GRADRFCTRL *gradrfctrl)</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1402</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">KS_SEQ_CONTROL::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:990</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a51a2c4637bfcef5c062d3c794ed4ded5ae2ef535229a83f6deb239caa1ff7120e"><div class="ttname"><a href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5ae2ef535229a83f6deb239caa1ff7120e">G_ATTACK</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1737</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a9428be182c75f60d1b4e6fe36c888afa"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">KS_TRAP::wfpulse</a></div><div class="ttdeci">WF_PULSE ** wfpulse</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:440</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_TRAP::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:437</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a636634b6eb50758af3826332f9180e9b"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a636634b6eb50758af3826332f9180e9b">psd_rf_wait</a></div><div class="ttdeci">int psd_rf_wait</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a3fb111f1302287e152078110b3b37d6f"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a3fb111f1302287e152078110b3b37d6f">KS_TRAP::gradnum</a></div><div class="ttdeci">int gradnum[3]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:438</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a51a2c4637bfcef5c062d3c794ed4ded5a8b1103e672a6fc1aa616ac7f422410de"><div class="ttname"><a href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5a8b1103e672a6fc1aa616ac7f422410de">G_DECAY</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1737</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_acbc719dc4e48c2a2df0447875e4348ca"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">KS_TRAP::ramptime</a></div><div class="ttdeci">int ramptime</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:435</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a82a797ba7a2ddcd48502d834c2a067b6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a82a797ba7a2ddcd48502d834c2a067b6">&#9670;&nbsp;</a></span>ks_pg_phaser()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_pg_phaser </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *&#160;</td>
          <td class="paramname"><em>phaser</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a>&#160;</td>
          <td class="paramname"><em>loc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>ctrl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Places a <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> sequence object on a board at some position in the pulse sequence</h4>
</p>
<p>This function should be called in the <code>@pg</code> section to place out a <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> sequence object that creates a dynamic trapezoid for phase encoding. For 3D applications, two different <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> objects should have been designed by calling <a class="el" href="_k_s_foundation_8h.html#acc45c24d1996acd3d95ae2866c5ffb2b" title="Sets up an acquisition window with a trapezoid with preset gradient constraints">ks_eval_phaser()</a> on each <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> as FOV and resolution typically differ for the two phase encoding directions. The same <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object can be freely placed on XGRAD, YGRAD and ZGRAD as many times as desired, by only changing the second argument each time (to avoid waveform overlaps). For Cartesian applications, phase encoding gradients such as <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> are typically placed out on YGRAD (phase encoding axis), for 3D also on ZGRAD. For 3D, the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object may embed a slice rephaser (static trapezoid) by setting <code>.areaoffset</code> to a non-zero value (see <a class="el" href="_k_s_foundation_8h.html#acc45c24d1996acd3d95ae2866c5ffb2b" title="Sets up an acquisition window with a trapezoid with preset gradient constraints">ks_eval_phaser()</a>). The second argument is a <a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> struct with three fields:</p><ul>
<li><code>.board</code>: Choose between XGRAD, YGRAD, ZGRAD</li>
<li><code>.pos</code>: Absolute time in [us] of the start of the attack ramp of the phase encoding trapezoid</li>
<li><code>.ampscale</code>: For <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> objects, this must be 1.0. If not, <a class="el" href="_k_s_foundation_8h.html#a094595db960708064dc1b8b645c4be71" title="Places a KS_PHASER sequence object on a board at some position in the pulse sequence">ks_pg_phaser()</a> will throw an error. Amplitude control should solely be done in scan using <a class="el" href="_k_s_foundation_8h.html#aff91e4da3b6ccabd607ec0da04f774ce" title="Updates the amplitude of a KS_PHASER sequence object to move from the k-space center to a desired k-s...">ks_scan_phaser_toline()</a> and <a class="el" href="_k_s_foundation_8h.html#a81a97893a74af952d90181aa858e709b" title="Updates the amplitude of a KS_PHASER sequence object to move from a k-space line to the k-space cente...">ks_scan_phaser_fromline()</a>.</li>
</ul>
<p>Regardless of the order placed out in the <code>@pg</code> section, and on which boards (XGRAD, YGRAD, ZGRAD) the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object is placed, the <em>instance</em> number of the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> is automatically sorted in time. If two instances of one <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> occur at the same time (<code>.pos</code>) on different boards, XGRAD comes before YGRAD, which comes before ZGRAD. These abstract, sorted, instance numbers are used by <code>ks_scan_***()</code> functions in <a class="el" href="ksepi_8e.html#a1669428052472d00b1c55a1291f8032f">scan()</a> to refer to a specific instance of a <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object in the sequence</p>
<p>If the <code>.duration</code> field in the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object is 0, <a class="el" href="_k_s_foundation_8h.html#a094595db960708064dc1b8b645c4be71" title="Places a KS_PHASER sequence object on a board at some position in the pulse sequence">ks_pg_phaser()</a> will return SUCCESS and quietly ignore placing it out. This is a part of the mechanism that setting the <code>.duration</code> field to 0 in <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code> should eliminate its existance in both timing calulations and in the pulse sequence generation in <code>@pg</code></p>
<p>GENERAL NOTE: It is a <b>requirement</b> that the function in the <code>@pg</code> section containing all <code>ks_pg_***()</code> calls is also called exactly once in <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code> after the calls to the corresponding <code>ks_eval_***()</code> functions that design the KS_*** sequence objects. Each <code>ks_pg_***()</code> will throw an error if this has not been done.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">phaser</td><td>Pointer to a <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> sequence object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">loc</td><td><a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> struct to specify when and where to place the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctrl</td><td>Pointer to the <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> struct corresponding to the sequence module for this <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;                                                                            {</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;  <span class="comment">/* loc.ampscale != 1.0 is not allowed  */</span></div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> != 1.0) {</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_phaser(%s): field &#39;ampscale&#39; in 2nd arg must be 1.0&quot;</span>, phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;  }</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;  <span class="comment">/* loc.board must be one of XGRAD, YGRAD, ZGRAD  */</span></div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> != XGRAD &amp;&amp; loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> != YGRAD &amp;&amp; loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> != ZGRAD) {</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_phaser(%s): field &#39;board&#39; in 2nd arg must be XGRAD, YGRAD, or ZGRAD&quot;</span>, phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;  }</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#ab3341eea000c35a438dfeb3cfc1da103">ks_pg_trap</a>(&amp;phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>, loc, ctrl);</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;}</div><div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">KS_PHASER::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1525</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a2e3f5254967cadb9a41167c6fbf6743e"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">KS_SEQLOC::board</a></div><div class="ttdeci">int board</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:241</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a606fbf556e8a297aa1f68b098f6ac2a2"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">KS_SEQLOC::ampscale</a></div><div class="ttdeci">float ampscale</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:243</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">KS_TRAP::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:432</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_ab3341eea000c35a438dfeb3cfc1da103"><div class="ttname"><a href="_k_s_foundation__common_8c.html#ab3341eea000c35a438dfeb3cfc1da103">ks_pg_trap</a></div><div class="ttdeci">STATUS ks_pg_trap(KS_TRAP *trap, KS_SEQLOC loc, KS_SEQ_CONTROL *ctrl)</div><div class="ttdoc">Places a KS_TRAP sequence object on a board at some position in the pulse sequence</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1212</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3bed936c3bb14d2d25d5ddbaa3d54007"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3bed936c3bb14d2d25d5ddbaa3d54007">&#9670;&nbsp;</a></span>ks_pg_read()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_pg_read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_e_a_d.html">KS_READ</a> *&#160;</td>
          <td class="paramname"><em>read</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>ctrl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Places a <a class="el" href="struct_k_s___r_e_a_d.html" title="Core sequence object that handles a data acquisition window">KS_READ</a> sequence object at some position in the pulse sequence</h4>
</p>
<p>This function should be called in the <code>@pg</code> section to place out a <a class="el" href="struct_k_s___r_e_a_d.html" title="Core sequence object that handles a data acquisition window">KS_READ</a> sequence object that creates an acquisition window in the pulse sequence. The same <a class="el" href="struct_k_s___r_e_a_d.html" title="Core sequence object that handles a data acquisition window">KS_READ</a> object can be freely placed as many times as desired, by only changing the second argument each time (to avoid overlaps). The second argument is an integer with the absolute time in [us] of the start of the acquisition. System gradient delays are accounted for in <a class="el" href="_k_s_foundation_8h.html#a5b50d0ffcc69966c42bceb7e67c70cbf" title="Places a KS_READ sequence object at some position in the pulse sequence">ks_pg_read()</a> by internally adjusting the position by adding the system variable <code>psd_grd_wait</code> to the position value. This assures the gradients boards and acquisition window are in sync on the MR system.</p>
<p>Regardless of the order the acquisition windows are placed out in the <code>@pg</code> section, the <em>instance</em> number of the <a class="el" href="struct_k_s___r_e_a_d.html" title="Core sequence object that handles a data acquisition window">KS_READ</a> is automatically sorted in time</p>
<p>If the <code>.duration</code> field in the <a class="el" href="struct_k_s___r_e_a_d.html" title="Core sequence object that handles a data acquisition window">KS_READ</a> object is 0, <a class="el" href="_k_s_foundation_8h.html#a5b50d0ffcc69966c42bceb7e67c70cbf" title="Places a KS_READ sequence object at some position in the pulse sequence">ks_pg_read()</a> will return SUCCESS and quietly ignore placing it out. This is a part of the mechanism that setting the <code>.duration</code> field to 0 in <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code> should eliminate its existance in both timing calulations and in the pulse sequence generation in <code>@pg</code></p>
<p>GENERAL NOTE: It is a <b>requirement</b> that the function in the <code>@pg</code> section containing all <code>ks_pg_***()</code> calls is also called exactly once in <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code> after the calls to the corresponding <code>ks_eval_***()</code> functions that design the KS_*** sequence objects. Each <code>ks_pg_***()</code> will throw an error if this has not been done.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">read</td><td>Pointer to a <a class="el" href="struct_k_s___r_e_a_d.html" title="Core sequence object that handles a data acquisition window">KS_READ</a> sequence object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pos</td><td>Absolute time in [us] when to start data acquisition </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctrl</td><td>Pointer to the <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> struct corresponding to the sequence module for this <a class="el" href="struct_k_s___r_e_a_d.html" title="Core sequence object that handles a data acquisition window">KS_READ</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;                                                                {</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;  <span class="keywordtype">int</span> acqwin_start;</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;  <span class="keywordtype">int</span> placementindx;</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;  <span class="keywordtype">long</span> dab_pos;</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;  <span class="keywordtype">char</span> tmpstr[<a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> + 7];</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;  STATUS status;</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;  <span class="comment">/* duration of 0 should not throw an error as this is a sign of that it has not been set up or has manually been disabled this way */</span></div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;  <span class="keywordflow">if</span> (read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> == 0) {</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;    <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;  }</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;  {</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;    tmpstr[<a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> + 7 - 1] = 0;</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;    <span class="keywordflow">if</span> (read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a> &gt;= read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>) {</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;      <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_read @tgt(%s): the number of instances generated on the target exceeds the number of ones generated on the host&quot;</span>, read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;      <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;    }</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;    <span class="keywordflow">if</span> (!ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#af7f2aa8614e77ef8af0154c7e071ab0e">is_cleared_on_tgt</a>) { <span class="comment">/* Reset gradrfctrl on tgt to remove dead pointers copied from host. */</span></div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;      <a class="code" href="_k_s_foundation_8h.html#a4ec679c0fb8eb62c1776e67434e25b77">ks_tgt_reset_gradrfctrl</a>(&amp;ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>);</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;    }</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;    <span class="keywordflow">if</span> (read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a0e0bae3aa47ae5b8aae488fa0eb920ce">echo</a> == NULL) {</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;      <span class="comment">/* this relies on that we have run the sequence in cveval() (i.e. on host) before to get proper grad.ninst */</span></div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;      read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a0e0bae3aa47ae5b8aae488fa0eb920ce">echo</a> = (WF_PULSE *) AllocNode(read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a> * <span class="keyword">sizeof</span>(WF_PULSE));</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;    }</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;    placementindx = read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>; <span class="comment">/* not sorted in time, but in placement order */</span></div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;    acqwin_start = pos + <a class="code" href="_k_s_foundation__common_8c.html#aa4225c3edfbcb8e85d91fc491a495058">psd_grd_wait</a>;</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;    <span class="keywordflow">if</span> (placementindx == 0 || read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">filt</a>.tdaq &gt; 200) {</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;      dab_pos = DEFAULTPOS; <span class="comment">/* results in 200 us before RBA (DEFAULTPOS is defined as 0. See: /ESE_.../psd/include/private/pulsegen.h) */</span></div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;      <span class="comment">/* For small matrix sizes, the acq window is so short that the DAB packet</span></div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;<span class="comment">         for current lobe may collide with the RBA belonging to the previous lobe.</span></div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;<span class="comment">         We are not allowed to decrease the DAB-RBA distance below 200us. Instead,</span></div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;<span class="comment">         let&#39;s put it right after the end of the previous XTR pulse.</span></div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;<span class="comment">         With the default XTR-RBA offset of 143us, and since the RBA-RBA distance</span></div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;<span class="comment">         is equal to read-&gt;grad.duration, we will get a DAB-RBA offset of</span></div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;<span class="comment">      acqwin_duration + 143us - 17us (XTR duration)</span></div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;<span class="comment">      */</span></div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;      dab_pos = pbegallssp(<a class="code" href="_k_s_foundation__common_8c.html#a220c36b2fe5f7910508f38d66cfd6335">ks_pg_echossp</a>(&amp;read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a0e0bae3aa47ae5b8aae488fa0eb920ce">echo</a>[placementindx - 1], <span class="stringliteral">&quot;xtr&quot;</span>), 0) + 17;</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;      <span class="keywordflow">if</span> (dab_pos + 200 &gt; acqwin_start)</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;        dab_pos = DEFAULTPOS; <span class="comment">/* fallback to default pos. Perhaps the readouts were not placed out in time order in the PSD ? */</span></div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;    }</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;    <span class="comment">/* name the ACQ pulse */</span></div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;    sprintf(tmpstr, <span class="stringliteral">&quot;%s%03d&quot;</span>, read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, placementindx); pulsename(&amp;(read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a0e0bae3aa47ae5b8aae488fa0eb920ce">echo</a>[placementindx]), tmpstr);</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;    <span class="keywordflow">if</span> (read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">filt</a>.fslot == <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>) {</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;      <span class="comment">/* add &#39;return&#39; before ks_error once we&#39;ve got an answer from GE regarding acqq and setrfltrs() */</span></div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;      <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_read @tgt(%s): WARNING no filter slot assigned. First run setfilter(&amp;read.filt)&quot;</span>, read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;    }</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;    <span class="comment">/* place the ACQ pulse */</span></div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;    acqq(&amp;(read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a0e0bae3aa47ae5b8aae488fa0eb920ce">echo</a>[placementindx]),</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;         (<span class="keywordtype">long</span>) acqwin_start,</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;         (<span class="keywordtype">long</span>) dab_pos, <span class="comment">/* DAB */</span></div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;         (<span class="keywordtype">long</span>) DEFAULTPOS, <span class="comment">/* XTR */</span></div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;         read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">filt</a>.fslot, <span class="comment">/* filter slot */</span></div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;         (TYPDAB_PACKETS) DABNORM);</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;    read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>++;</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;    <span class="comment">/* sort after the last instance is generated */</span></div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;    <span class="keywordflow">if</span> (read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a> == read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>) {</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;      <a class="code" href="_k_s_foundation__common_8c.html#a42180e710dc1f89e9a557683f8f58dda">ks_sort_wfp_by_time</a>(read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a0e0bae3aa47ae5b8aae488fa0eb920ce">echo</a>, read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>);</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;    }</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;    <span class="comment">/* Associate this echo with a global filter slot number</span></div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;<span class="comment">       This number is generated by the GE function setfilter() in e.g. predownload(), before this function is called.</span></div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;<span class="comment">       For main sequences, there is also the wrapper function GEReq_predownload_setfilter() */</span></div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;    <span class="keywordflow">if</span> (read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">filt</a>.fslot &gt;= 0 &amp;&amp; read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">filt</a>.fslot &lt;= MAX_FILTER_SLOT) {</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;      setrfltrs((<span class="keywordtype">int</span>) read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">filt</a>.fslot, &amp;(read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a0e0bae3aa47ae5b8aae488fa0eb920ce">echo</a>[placementindx]));</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;    }</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;  }</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;<span class="preprocessor">#else </span><span class="comment">/* IPG */</span><span class="preprocessor"></span></div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;  {</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;    read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a94207eb79ef6154f75eb3f363bb5df0a">pos</a>[read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>] = pos;</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;    read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>++; <span class="comment">/* update acq counter on host */</span></div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;  }</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* IPG */</span><span class="preprocessor"></span></div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;  status = <a class="code" href="_k_s_foundation__common_8c.html#a58400508a44d80fc140baeb987f7c435">ks_eval_addreadtogradrfctrl</a>(&amp;ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>, read);</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;  <span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;}</div><div class="ttc" id="struct_k_s___r_e_a_d_html_a0e0bae3aa47ae5b8aae488fa0eb920ce"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a0e0bae3aa47ae5b8aae488fa0eb920ce">KS_READ::echo</a></div><div class="ttdeci">WF_PULSE * echo</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:587</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a42180e710dc1f89e9a557683f8f58dda"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a42180e710dc1f89e9a557683f8f58dda">ks_sort_wfp_by_time</a></div><div class="ttdeci">void ks_sort_wfp_by_time(WF_PULSE *a, int nitems)</div><div class="ttdoc">Sort WF_PULSEs in time</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2964</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_afd953f31b866a09e0418967c2bf65a59"><div class="ttname"><a href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a></div><div class="ttdeci">#define KS_NOTSET</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:60</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a72a22b96ff3908d2b9a20a3a02647a2f"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">KS_BASE::ninst</a></div><div class="ttdeci">int ninst</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:261</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a58400508a44d80fc140baeb987f7c435"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a58400508a44d80fc140baeb987f7c435">ks_eval_addreadtogradrfctrl</a></div><div class="ttdeci">STATUS ks_eval_addreadtogradrfctrl(KS_GRADRFCTRL *gradrfctrl, KS_READ *read)</div><div class="ttdoc">*Internal use*. Adds an acquisition to the KS_GRADRFCTRL struct. Used for plotting</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:3521</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a220c36b2fe5f7910508f38d66cfd6335"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a220c36b2fe5f7910508f38d66cfd6335">ks_pg_echossp</a></div><div class="ttdeci">WF_PULSE * ks_pg_echossp(WF_PULSE *echo, char *suffix)</div><div class="ttdoc">Returns the pointer to XTR or RBA for an echo WF_PULSE (internal use)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1195</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">KS_READ::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:581</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a2573e18f36ab5c3d3fc97072edcfab16"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">KS_SEQ_CONTROL::gradrf</a></div><div class="ttdeci">KS_GRADRFCTRL gradrf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:992</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a1c544bec41003a594ba4ec7d43a3a470">KS_READ::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:582</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aacb2fe1d83c45e8d0525f363bdd6b8a6"><div class="ttname"><a href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a></div><div class="ttdeci">#define KS_DESCRIPTION_LENGTH</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:112</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_af7f2aa8614e77ef8af0154c7e071ab0e"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#af7f2aa8614e77ef8af0154c7e071ab0e">KS_GRADRFCTRL::is_cleared_on_tgt</a></div><div class="ttdeci">int is_cleared_on_tgt</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:823</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_READ::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:583</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a292f93e48d34cda511fcfb72a05558c2"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">KS_READ::filt</a></div><div class="ttdeci">FILTER_INFO filt</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:585</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_aa4225c3edfbcb8e85d91fc491a495058"><div class="ttname"><a href="_k_s_foundation__common_8c.html#aa4225c3edfbcb8e85d91fc491a495058">psd_grd_wait</a></div><div class="ttdeci">int psd_grd_wait</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4ec679c0fb8eb62c1776e67434e25b77"><div class="ttname"><a href="_k_s_foundation_8h.html#a4ec679c0fb8eb62c1776e67434e25b77">ks_tgt_reset_gradrfctrl</a></div><div class="ttdeci">void ks_tgt_reset_gradrfctrl(KS_GRADRFCTRL *gradrfctrl)</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1402</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a94207eb79ef6154f75eb3f363bb5df0a"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a94207eb79ef6154f75eb3f363bb5df0a">KS_READ::pos</a></div><div class="ttdeci">int pos[KS_MAXUNIQUE_READ]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:586</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9310a853d09f6db581a771a9b274f01d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9310a853d09f6db581a771a9b274f01d">&#9670;&nbsp;</a></span>ks_pg_readtrap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_pg_readtrap </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a> *&#160;</td>
          <td class="paramname"><em>readtrap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a>&#160;</td>
          <td class="paramname"><em>loc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>ctrl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Places a <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> sequence object on a board at some position in the pulse sequence</h4>
</p>
<p>This function should be called in the <code>@pg</code> section to place out a <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> sequence object consisting of a trapezoid (<a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a>) and an acquisition window (<a class="el" href="struct_k_s___r_e_a_d.html" title="Core sequence object that handles a data acquisition window">KS_READ</a>). The same <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> object can be freely placed on XGRAD, YGRAD and ZGRAD as many times as desired, by only changing the second argument each time (to avoid waveform overlaps). For Cartesian applications, readouts such as <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> are typically placed on XGRAD (frequency encoding axis). The second argument is a <a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> struct with three fields:</p><ul>
<li><code>.board</code>: Choose between XGRAD, YGRAD, ZGRAD</li>
<li><code>.pos</code>: Absolute time in [us] of the start of the attack ramp of the readout trapezoid</li>
<li><code>.ampscale</code>: For <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> objects, this must be either +1.0 or -1.0 so that the FOV is not altered. Negative amplitudes will automatically be taken into account in <a class="el" href="_k_s_foundation_8h.html#a11a9b9d761ba64a74b88c222b2a949e3" title="Updates the frequency and phase of one or all instances of a KS_READTRAP to create a FOV shift...">ks_scan_offsetfov()</a> to create the necessary frequency offset</li>
</ul>
<p>Regardless of the order placed out in the <code>@pg</code> section, and on which boards (XGRAD, YGRAD, ZGRAD) the <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> object is placed, the <em>instance</em> number of the <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> is automatically sorted in time. If two instances of one <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> occur at the same time (<code>.pos</code>) on different boards, XGRAD comes before YGRAD, which comes before ZGRAD. These abstract, sorted, instance numbers are used by <code>ks_scan_***()</code> functions in <a class="el" href="ksepi_8e.html#a1669428052472d00b1c55a1291f8032f">scan()</a> to refer to a specific instance of a <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> object in the sequence.</p>
<p>If the <code>.duration</code> field in the <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> object is 0, <a class="el" href="_k_s_foundation_8h.html#a21198913d5b1603f03a5e5d61d00408c" title="Places a KS_READTRAP sequence object on a board at some position in the pulse sequence">ks_pg_readtrap()</a> will return SUCCESS and quietly ignore placing it out. This is a part of the mechanism that setting the <code>.duration</code> field to 0 in <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code> should eliminate its existance in both timing calulations and in the pulse sequence generation in <code>@pg</code></p>
<p>GENERAL NOTE: It is a <b>requirement</b> that the function in the <code>@pg</code> section containing all <code>ks_pg_***()</code> calls is also called exactly once in <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code> after the calls to the corresponding <code>ks_eval_***()</code> functions that design the KS_*** sequence objects. Each <code>ks_pg_***()</code> will throw an error if this has not been done.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">readtrap</td><td>Pointer to a <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> sequence object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">loc</td><td><a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> struct to specify when and where to place the <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctrl</td><td>Pointer to the <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> struct corresponding to the sequence module for this <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;                                                                                  {</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;  <a class="code" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> omegaloc;</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;  <span class="comment">/* checking for NULL pointers */</span></div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;  <span class="keywordflow">if</span> (readtrap == NULL) {</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: First argument is NULL&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;  }</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;  <span class="comment">/* duration of 0 should not throw an error as this is a sign of that it has not been set up</span></div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;<span class="comment">     or has manually been disabled this way */</span></div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;  <span class="keywordflow">if</span> (readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> == 0) {</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;    <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;  }</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;  <span class="keywordflow">if</span> (readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a> == NULL || readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>[0] == 0 || readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>[0] == <span class="charliteral">&#39; &#39;</span>) {</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: Invalid description (&#39;%s&#39;)&quot;</span>, __FUNCTION__, readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;  }</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;  <span class="comment">/* TGT (IPG): Don&#39;t place anything on hardware if ctrl-&gt;duration = 0.</span></div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;<span class="comment">      This is in concert with:</span></div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;<span class="comment">      - not performing createseq() in KS_SEQLENGTH if seqctrl.duration = 0</span></div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;<span class="comment">     - not playing sequence modules in scan() using ks_scan_playsequence() if seqctrl.duration = 0</span></div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;  <span class="keywordflow">if</span> (ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> == 0) {</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s(%s): Refusing to place readtrap since seqctrl.duration = 0 (indicating `%s` not to be played in scan())&quot;</span>, __FUNCTION__, readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;  }</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> != 1.0 &amp;&amp; loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> != -1.0) {</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s(%s): .ampscale %g must be exactly +1 or -1 for readout gradients&quot;</span>, __FUNCTION__, readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a>);</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;  }</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;  <span class="comment">/*** acq ***/</span></div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#a3bed936c3bb14d2d25d5ddbaa3d54007">ks_pg_read</a>(&amp;readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> + readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a13d3424b69abfaa66668757e06fed900">acqdelay</a>, ctrl) == FAILURE)</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;  <span class="comment">/*** trapezoid ***/</span></div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#ab3341eea000c35a438dfeb3cfc1da103">ks_pg_trap</a>(&amp;readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>, loc, ctrl) == FAILURE)</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;  <span class="comment">/* also place the omega wave form for rampsampled cases */</span></div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;  <span class="keywordflow">if</span> (readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#abd9ff216626c3fd76322a2a56dc606cc">omega</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> &gt; 0) {</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;    <span class="comment">/* omega trapezoid matching the readout lobe to allow for FOV offsets in freq dir. with ramp sampling */</span></div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;    omegaloc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> = OMEGA;</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;    omegaloc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> = loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>;</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;    omegaloc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> = 1.0; <span class="comment">/* just unity value for conformance. It does not matter during scanning, since ks_scan_omegahz() ignores this value */</span></div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#ab3341eea000c35a438dfeb3cfc1da103">ks_pg_trap</a>(&amp;readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#abd9ff216626c3fd76322a2a56dc606cc">omega</a>, omegaloc, ctrl) == FAILURE)</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;      <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;  }</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;} <span class="comment">/* ks_pg_readtrap */</span></div><div class="ttc" id="_k_s_foundation__common_8c_html_a3bed936c3bb14d2d25d5ddbaa3d54007"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a3bed936c3bb14d2d25d5ddbaa3d54007">ks_pg_read</a></div><div class="ttdeci">STATUS ks_pg_read(KS_READ *read, int pos, KS_SEQ_CONTROL *ctrl)</div><div class="ttdoc">Places a KS_READ sequence object at some position in the pulse sequence</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1431</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a1910d262855b71da353ed0d07a6c7823"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">KS_SEQLOC::pos</a></div><div class="ttdeci">int pos</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:242</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a2e3f5254967cadb9a41167c6fbf6743e"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">KS_SEQLOC::board</a></div><div class="ttdeci">int board</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:241</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_SEQ_CONTROL::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:984</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">KS_READTRAP::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1435</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a606fbf556e8a297aa1f68b098f6ac2a2"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">KS_SEQLOC::ampscale</a></div><div class="ttdeci">float ampscale</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:243</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_abd9ff216626c3fd76322a2a56dc606cc"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#abd9ff216626c3fd76322a2a56dc606cc">KS_READTRAP::omega</a></div><div class="ttdeci">KS_TRAP omega</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1436</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a></div><div class="ttdoc">typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:240</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">KS_TRAP::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:432</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">KS_SEQ_CONTROL::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:990</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_ac359c54a7c5f9e9a94105b3c0d0be9ea"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">KS_READTRAP::acq</a></div><div class="ttdeci">KS_READ acq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1423</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_TRAP::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:437</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_ab3341eea000c35a438dfeb3cfc1da103"><div class="ttname"><a href="_k_s_foundation__common_8c.html#ab3341eea000c35a438dfeb3cfc1da103">ks_pg_trap</a></div><div class="ttdeci">STATUS ks_pg_trap(KS_TRAP *trap, KS_SEQLOC loc, KS_SEQ_CONTROL *ctrl)</div><div class="ttdoc">Places a KS_TRAP sequence object on a board at some position in the pulse sequence</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1212</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_a13d3424b69abfaa66668757e06fed900"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#a13d3424b69abfaa66668757e06fed900">KS_READTRAP::acqdelay</a></div><div class="ttdeci">int acqdelay</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1429</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9c5ace140d91043230e2e5364a0be90b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9c5ace140d91043230e2e5364a0be90b">&#9670;&nbsp;</a></span>ks_pg_wave()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_pg_wave </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a>&#160;</td>
          <td class="paramname"><em>loc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>ctrl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Places a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> sequence object on a board at some position in the pulse sequence</h4>
</p>
<p>This function should be called in the <code>@pg</code> section to place out a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> sequence object that creates an arbitrary waveform in the pulse sequence. The same <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object can be placed on any board as many times as desired, by only changing the second argument each time (to avoid waveform overlaps). However, the RHO (RF) board should be avoided as this bypasses RF scaling and SAR calculations, providing no control over the flip angle. For RF waveforms, always use <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> (or <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a>). The second argument is a <a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> struct with three fields:</p><ul>
<li><code>.board</code>: Choose between XGRAD, YGRAD, ZGRAD, OMEGA, THETA</li>
<li><code>.pos</code>: Absolute time in [us] of the start of the waveform. For <code>RF</code>, OMEGA and THETA, <code>pos_rf_wait</code> will be added to this time to take system delays into account</li>
<li><code>.ampscale</code>: For gradient boards, this factor must be in range [-1.0,1.0] that is multiplied with the waveform to yield a per-instance (i.e. per-placement) amplitude ([G/cm]). For THETA, only values of +1.0 and -1.0 is allowed, and for OMEGA only 1.0 is allowed</li>
</ul>
<p>The <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> sequence object contains a KS_WAVEFORM (float[KS_MAXWAVELEN]) to hold the waveform. The physical unit of the waveform in the <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object depends the board on which it is placed using <a class="el" href="_k_s_foundation_8h.html#afc06ade569c7b85c1aa5026fc2e1c710" title="Places a KS_WAVE sequence object on a board at some position in the pulse sequence">ks_pg_wave()</a>. For the</p><ul>
<li>gradient boards (XGRAD, YGRAD, ZGRAD), the unit is [G/cm]</li>
<li>THETA board, the unit is [degrees]</li>
<li>RF (RHO) and OMEGA boards, the units are arbitrary (c.f. <a class="el" href="_k_s_foundation_8h.html#a187dd827bc0f2be7f9a00f20802fca91" title="Sets up a KS_RF object">ks_eval_rf()</a> and <a class="el" href="_k_s_foundation_8h.html#a3369441b24c1df15ba2193aae29d3e11" title="Sets up a KS_WAVE object based on a waveform (KS_WAVEFORM) in memory">ks_eval_wave()</a>). Don't call <a class="el" href="_k_s_foundation_8h.html#afc06ade569c7b85c1aa5026fc2e1c710" title="Places a KS_WAVE sequence object on a board at some position in the pulse sequence">ks_pg_wave()</a> directly to place a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> on the RF board</li>
</ul>
<p>When a waveform is placed on OMEGA, neither the waveform amplitude nor the <code>.ampscale</code> (in <a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a>) affects the final frequency modulation. Instead the run-time amplitude of a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object on the OMEGA board is controlled in <a class="el" href="ksepi_8e.html#a1669428052472d00b1c55a1291f8032f">scan()</a> via a function called <a class="el" href="_k_s_foundation_8h.html#a6c406ab72abe3eadd93f7e889e9afd32" title="Updates a KS_WAVE object on the OMEGA board to produce a frequency offset">ks_scan_omegawave_hz()</a>, where the largest value in the field <code>.waveform[]</code> in the <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> will correspond to the value in [Hz] provided.</p>
<p>If the <code>.duration</code> field in the <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object is 0, <a class="el" href="_k_s_foundation_8h.html#afc06ade569c7b85c1aa5026fc2e1c710" title="Places a KS_WAVE sequence object on a board at some position in the pulse sequence">ks_pg_wave()</a> will return SUCCESS and quietly ignore placing it out. This is a part of the mechanism that setting the <code>.duration</code> field to 0 in <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code> should eliminate its existance in both timing calulations and in the pulse sequence generation in <code>@pg</code></p>
<p>All <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> objects are double buffered in <a class="el" href="_k_s_foundation_8h.html#afc06ade569c7b85c1aa5026fc2e1c710" title="Places a KS_WAVE sequence object on a board at some position in the pulse sequence">ks_pg_wave()</a> so that waveforms can be replaced in run-time (<a class="el" href="ksepi_8e.html#a1669428052472d00b1c55a1291f8032f">scan()</a>) using <a class="el" href="_k_s_foundation_8h.html#a2e916337476b7566b3bf033824f964ba" title="Moves a waveform belonging to a KS_WAVE sequence object to hardware">ks_scan_wave2hardware()</a></p>
<p>Regardless of the order placed out in the <code>@pg</code> section, and on which boards (XGRAD, YGRAD, ZGRAD) the <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object is placed, the <em>instance</em> number of the <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> is automatically sorted in time. If two instances of one <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> occur at the same time (<code>.pos</code>) on different boards, XGRAD comes before YGRAD, which comes before ZGRAD. These abstract, sorted, instance numbers are used by <code>ks_scan_***()</code> functions in <a class="el" href="ksepi_8e.html#a1669428052472d00b1c55a1291f8032f">scan()</a> to refer to a specific instance of a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object in the sequence.</p>
<p>GENERAL NOTE: It is a <b>requirement</b> that the function in the <code>@pg</code> section containing all <code>ks_pg_***()</code> calls is also called exactly once in <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code> after the calls to the corresponding <code>ks_eval_***()</code> functions that design the KS_*** sequence objects. Each <code>ks_pg_***()</code> will throw an error if this has not been done.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">wave</td><td>Pointer to a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> sequence object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">loc</td><td><a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> struct to specify when and where to place the <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctrl</td><td>Pointer to the <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> struct corresponding to the sequence module for this <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;                                                                      {</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;  <span class="keywordtype">float</span> boardmax;</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;  <span class="keywordtype">char</span> boardc[7] = <span class="stringliteral">&quot;xyzrrto&quot;</span>; <span class="comment">/* x,y,z,rho1,rho2,theta,omega */</span></div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;  <span class="keywordtype">float</span> waveamp = <a class="code" href="_k_s_foundation__common_8c.html#a2bfec427bf5a8966edf279b2eba23396">ks_wave_absmax</a>(wave); <span class="comment">/* maximum amplitude in wave (in its own units, like e.g. [G/cm] or [degrees]) */</span></div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;  boardmax = <a class="code" href="_k_s_foundation__common_8c.html#aa65115d54842eeffc47a1b324caa62ab">ks_syslimits_gradtarget</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>); <span class="comment">/* returns 1.0 for non-gradients boards */</span></div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;  <span class="comment">/* checking for NULL pointers */</span></div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;  <span class="keywordflow">if</span> (wave == NULL) {</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wave: First argument is NULL&quot;</span>);</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;  }</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;  <span class="comment">/* duration of 0 should not throw an error as this is a sign of that it has not been set up</span></div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;<span class="comment">     or has manually been disabled this way */</span></div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;  <span class="keywordflow">if</span> (wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> == 0) {</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;    <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;  }</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;  <span class="keywordflow">if</span> (wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a> == NULL || wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>[0] == 0 || wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>[0] == <span class="charliteral">&#39; &#39;</span>) {</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wave: Invalid description (&#39;%s&#39;)&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;  }</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;  <span class="comment">/* TGT: Don&#39;t place anything on hardware if ctrl-&gt;duration = 0.</span></div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;<span class="comment">     This is in concert with:</span></div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;<span class="comment">     - not performing createseq() in KS_SEQLENGTH if seqctrl.duration = 0</span></div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;<span class="comment">     - not playing sequence modules in scan() using ks_scan_playsequence() if seqctrl.duration = 0</span></div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;  <span class="keywordflow">if</span> (ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> == 0) {</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s(%s): Refusing to place wave since seqctrl.duration = 0 (indicating `%s` not to be played in scan())&quot;</span>, __FUNCTION__, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;  }</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;  <span class="keywordflow">if</span> (!ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#af7f2aa8614e77ef8af0154c7e071ab0e">is_cleared_on_tgt</a>) <span class="comment">/* Reset gradrfctrl on tgt to remove dead pointers copied from host. */</span></div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;  {</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#a4ec679c0fb8eb62c1776e67434e25b77">ks_tgt_reset_gradrfctrl</a>(&amp;ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>);</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;  }</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;  <span class="comment">/* input validation */</span></div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;  <span class="keywordflow">if</span> (wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> % 4) {</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wave(%s): field &#39;duration&#39; (%d) must be divisible by 4&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>);</div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;  }</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;  <span class="keywordflow">if</span> (wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> == 0) {</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wave(%s): field &#39;res&#39; cannot be 0&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;  }</div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;  <span class="keywordflow">if</span> (wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> % 2) {</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wave(%s): field &#39;res&#39; (%d) must be even &quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>);</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;  }</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;  <span class="keywordflow">if</span> (wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> % wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>) {</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wave(%s): field &#39;duration&#39; (%d) must be divisible by &#39;res&#39; %d&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>);</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;  }</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == XGRAD || loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == YGRAD || loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == ZGRAD) {</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;    <span class="keywordflow">if</span> ((wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> / wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>) % GRAD_UPDATE_TIME) {</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wave(%s): field &#39;duration&#39; (%d) must a multiple of 4 times &#39;res&#39; (%d) for gradient boards&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>);</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;    }</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;    <span class="keywordflow">if</span> (wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a6aa33ad60a96c56283d44d989fe2d499">gradwave_units</a> == <a class="code" href="_k_s_foundation_8h.html#adfc20623c6ef26b08b99174a1a77323ca18c0e84d66e6f381b509ea483f7cc7fd">KS_GRADWAVE_ABSOLUTE</a> &amp;&amp; loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> != 1.0) {</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wave(%s): ampscale must be +1.0 for gradwave with absolute units&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;    }</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;    <span class="keywordflow">if</span> ((wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> / wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>) % RF_UPDATE_TIME) {</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wave(%s): field &#39;duration&#39; (%d) must a multiple of 2 times &#39;res&#39; (%d) for non-gradient boards&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>);</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;    }</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;  }</div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> != loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a>) {</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wave(%s): loc.ampscale NaN&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;  }</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> != loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>) {</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wave(%s): loc.pos NaN&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;  }</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> != loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>) {</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wave(%s): loc.board NaN&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;  }</div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> &lt; GRAD_UPDATE_TIME || loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> &gt; 4e6) {</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wave(%s): Invalid position %d, it must be between 4us and 4s&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>);</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;  }</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == OMEGA &amp;&amp; loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> != 1.0) {</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wave(%s): ampscale must be +1.0 for OMEGA&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;  }</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == THETA &amp;&amp; loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> != 1.0 &amp;&amp; loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> != -1.0) {</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wave(%s): ampscale must be +1.0 or -1.0 for THETA&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;  }</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> &lt; -1.0 || loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> &gt; 1.0) {</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wave(%s): Invalid ampscale %g, it must be between -1.0 and 1.0&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a>);</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;  }</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;  <span class="keywordflow">if</span> (fabs(waveamp * loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a>) &gt; boardmax &amp;&amp; loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> != THETA) {</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;    <span class="keywordflow">return</span>  <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wave(%s): wave amplitude (%.2f) exceeds maximum (%g) for board %c&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, waveamp * loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a>, boardmax, boardc[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>]);</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;  }</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;  loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> = RUP_GRD(loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>);</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;<span class="preprocessor">#ifdef HOST_TGT</span></div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;  <span class="comment">/* HOST */</span></div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;  wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a89785a274d251fd637bf40923ad5c345">locs</a>[wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>] = loc;</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;</div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;  <span class="comment">/* update instance counter on host only. This counter is used to allocate the right amount of WFINSTANCEs on IPG */</span></div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;  wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>++;</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;  <span class="comment">/* for wave, we also need to keep track of #instances per X, Y, Z for gradient heating calculations.</span></div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;<span class="comment">     As this needs to be done in HOST before the IPG (target), we can&#39;t use the wfi[...].boardinstance or .loc information above for this */</span></div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == XGRAD || loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == YGRAD || loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == ZGRAD) {</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;    wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a3fb111f1302287e152078110b3b37d6f">gradnum</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>]++;</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;  }</div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;</div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;  {</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;    <span class="keywordtype">int</span> wave_ptr, isrf, iamp;</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;    <span class="keywordtype">char</span> tmpstr[<a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> + 7];</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;    <span class="keywordflow">if</span> (wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a> &gt;= wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>) {</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;      <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wave @tgt(%s): the number of instances generated on the target exceeds the number of ones generated on the host&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;      <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;    }</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;    <span class="comment">/* first call on TGT, allocate WF_PULSE * array where each element corresponds to one board */</span></div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;    <span class="keywordflow">if</span> (wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a> == NULL) {</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;      wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a> = (WF_PULSE **) AllocNode(7 * <span class="keyword">sizeof</span>(WF_PULSE *)); <span class="comment">/* WF pointers for all boards (XGRAD-&gt;OMEGA) */</span></div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;    } <span class="comment">/* wfpulse == NULL */</span></div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;    <span class="comment">/* first call on TGT using this loc.board, make waveform memory (double buffered) */</span></div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;    <span class="keywordflow">if</span> (wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>] == NULL) {</div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;      WF_PULSE wfInit = INITPULSE;</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;      <a class="code" href="_k_s_foundation_8h.html#abba996c24da629eea72eecbd9a22a873">KS_IWAVE</a> iwave;</div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;      wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>] = (WF_PULSE *) AllocNode(<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1a6e84527e5ca18e299429a1d00297b47f">KS_WF_SIZE</a> * <span class="keyword">sizeof</span>(WF_PULSE)); <span class="comment">/* KS_WF_SIZE (3) to allow for double buffering */</span></div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = <a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a>; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; <a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1a6e84527e5ca18e299429a1d00297b47f">KS_WF_SIZE</a>; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++)</div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;        wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>][<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] = wfInit;</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;      sprintf(tmpstr, <span class="stringliteral">&quot;%s.%c&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, boardc[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>]);      pulsename(&amp;(wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>][<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a>]), tmpstr);</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;      sprintf(tmpstr, <span class="stringliteral">&quot;%s_buf1.%c&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, boardc[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>]); pulsename(&amp;(wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>][<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1acc45ff8f1dbeb7cef0129dd595e4031b">KS_WF_BUF1</a>]), tmpstr);</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;      sprintf(tmpstr, <span class="stringliteral">&quot;%s_buf2.%c&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, boardc[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>]); pulsename(&amp;(wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>][<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1a976ecf9c65bb6a43d7cb791d681f0adc">KS_WF_BUF2</a>]), tmpstr);</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;      <span class="comment">/* wave -&gt; short int wave for hardware use. All waveforms but THETA are autoscaled to +/- max_pg_wamp (32766)*/</span></div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#a9506a3d2dc5e084c69dda40e8e127a97">ks_wave2iwave</a>(iwave, wave, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>) == FAILURE)</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;        <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;      <span class="comment">/* reserve hardware memory to allow for double buffering */</span></div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = <a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a>; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt;= <a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1a976ecf9c65bb6a43d7cb791d681f0adc">KS_WF_BUF2</a>; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;        createreserve(&amp;wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>][<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>], loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>);</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;        wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>][<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].type = TYPEXTERNAL;</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;        movewaveimm(iwave, &amp;wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>][<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>], (<span class="keywordtype">int</span>) 0, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>, TOHARDWARE);</div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;      }</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;    } <span class="comment">/* wfpulse[loc.board] == NULL */</span></div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;    <span class="comment">/* create instruction at the current position */</span></div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;    isrf = loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == RHO || loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == RHO2 || loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == THETA || loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == OMEGA;</div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;</div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;    <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == THETA)</div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;      iamp = loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> * MAX_PG_IAMP;</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;      iamp = (waveamp * loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> / boardmax) * MAX_PG_IAMP;</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;    createinstr(&amp;wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>][<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a>],</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;                (<span class="keywordtype">long</span>) (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> + (<a class="code" href="_k_s_foundation__common_8c.html#a636634b6eb50758af3826332f9180e9b">psd_rf_wait</a> * isrf)),</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;                (<span class="keywordtype">long</span>) wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>,</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;                (<span class="keywordtype">long</span>) iamp);</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;    <span class="comment">/* WF instance bookkeeping */</span></div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;    <span class="keywordflow">if</span> (wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a> == NULL) {</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;      wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a> = (<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a> *) AllocNode(wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a> * <span class="keyword">sizeof</span>(<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a>));</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;    }</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;    wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">boardinstance</a> = wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>][<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a>].ninsts - 1;</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;    wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">wf</a> = wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>];</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;    wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a> = loc;</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;    <span class="comment">/* After instructions have been set, set the wfpulse[KS_WF_MAIN] to the first waveform buffer (_BUF1) */</span></div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;    getwave(&amp;wave_ptr, &amp;(wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>][<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1acc45ff8f1dbeb7cef0129dd595e4031b">KS_WF_BUF1</a>]));</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;    setwave(wave_ptr,  &amp;(wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>][<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a>]), wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">boardinstance</a>);</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;    wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>++;</div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;</div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;    <span class="comment">/* sort after the last instance is generated */</span></div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;    <span class="keywordflow">if</span> (wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a> == wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>) {</div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;      <a class="code" href="_k_s_foundation__common_8c.html#a0ae65ed3cc2deb47ccf50b7988239474">ks_sort_wfi_by_timeboard</a>(wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>);</div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;    }</div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;  }</div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* IPG or HOST */</span><span class="preprocessor"></span></div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;</div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;  <span class="comment">/* register this KS_WAVE for later heating calculations */</span></div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;  {</div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;    STATUS status = <a class="code" href="_k_s_foundation__common_8c.html#ad92221de8b8b3281d9bf0794c50a34bb">ks_eval_addwavetogradrfctrl</a>(&amp;ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>, wave);</div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;    <span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;  }</div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;</div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;} <span class="comment">/* ks_pg_wave */</span></div><div class="ttc" id="_k_s_foundation_8h_html_adfc20623c6ef26b08b99174a1a77323ca18c0e84d66e6f381b509ea483f7cc7fd"><div class="ttname"><a href="_k_s_foundation_8h.html#adfc20623c6ef26b08b99174a1a77323ca18c0e84d66e6f381b509ea483f7cc7fd">KS_GRADWAVE_ABSOLUTE</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1772</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a0ae65ed3cc2deb47ccf50b7988239474"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a0ae65ed3cc2deb47ccf50b7988239474">ks_sort_wfi_by_timeboard</a></div><div class="ttdeci">void ks_sort_wfi_by_timeboard(KS_WFINSTANCE *a, int nitems)</div><div class="ttdoc">Sort WF_INSTANCEs in time, then board</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2955</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_abba996c24da629eea72eecbd9a22a873"><div class="ttname"><a href="_k_s_foundation_8h.html#abba996c24da629eea72eecbd9a22a873">KS_IWAVE</a></div><div class="ttdeci">short KS_IWAVE[KS_MAXWAVELEN]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:180</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a42df2e3be0bda47009caae1a7042b522"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">KS_WFINSTANCE::boardinstance</a></div><div class="ttdeci">int boardinstance</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:251</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a2bfec427bf5a8966edf279b2eba23396"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a2bfec427bf5a8966edf279b2eba23396">ks_wave_absmax</a></div><div class="ttdeci">float ks_wave_absmax(const KS_WAVE *wave)</div><div class="ttdoc">Returns the maximum absolute value in a KS_WAVE sequence object</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:986</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ac91cb32048e29f6e58bbf2c1acb8fdf1acc45ff8f1dbeb7cef0129dd595e4031b"><div class="ttname"><a href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1acc45ff8f1dbeb7cef0129dd595e4031b">KS_WF_BUF1</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1754</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a1910d262855b71da353ed0d07a6c7823"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">KS_SEQLOC::pos</a></div><div class="ttdeci">int pos</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:242</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a89785a274d251fd637bf40923ad5c345"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a89785a274d251fd637bf40923ad5c345">KS_WAVE::locs</a></div><div class="ttdeci">KS_SEQLOC locs[KS_MAXINSTANCES]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:522</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a></div><div class="ttdoc">(Internal use) Structure being a part of various sequence objects to sort them in time across boards...</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:250</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a72a22b96ff3908d2b9a20a3a02647a2f"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">KS_BASE::ninst</a></div><div class="ttdeci">int ninst</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:261</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a6aa33ad60a96c56283d44d989fe2d499"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a6aa33ad60a96c56283d44d989fe2d499">KS_WAVE::gradwave_units</a></div><div class="ttdeci">int gradwave_units</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:521</div></div>
<div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a2e3f5254967cadb9a41167c6fbf6743e"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">KS_SEQLOC::board</a></div><div class="ttdeci">int board</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:241</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_SEQ_CONTROL::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:984</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a606fbf556e8a297aa1f68b098f6ac2a2"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">KS_SEQLOC::ampscale</a></div><div class="ttdeci">float ampscale</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:243</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a2573e18f36ab5c3d3fc97072edcfab16"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">KS_SEQ_CONTROL::gradrf</a></div><div class="ttdeci">KS_GRADRFCTRL gradrf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:992</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a15be3edad342a49398ca841c2745dc9e"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">KS_WAVE::wfi</a></div><div class="ttdeci">KS_WFINSTANCE * wfi</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:524</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aacb2fe1d83c45e8d0525f363bdd6b8a6"><div class="ttname"><a href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a></div><div class="ttdeci">#define KS_DESCRIPTION_LENGTH</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:112</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a3fb111f1302287e152078110b3b37d6f"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a3fb111f1302287e152078110b3b37d6f">KS_WAVE::gradnum</a></div><div class="ttdeci">int gradnum[3]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:520</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a78e529e1d86855310035845e03a4c107"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">KS_WFINSTANCE::loc</a></div><div class="ttdeci">KS_SEQLOC loc</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:253</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">KS_WAVE::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:516</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_af7f2aa8614e77ef8af0154c7e071ab0e"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#af7f2aa8614e77ef8af0154c7e071ab0e">KS_GRADRFCTRL::is_cleared_on_tgt</a></div><div class="ttdeci">int is_cleared_on_tgt</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:823</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_ad92221de8b8b3281d9bf0794c50a34bb"><div class="ttname"><a href="_k_s_foundation__common_8c.html#ad92221de8b8b3281d9bf0794c50a34bb">ks_eval_addwavetogradrfctrl</a></div><div class="ttdeci">STATUS ks_eval_addwavetogradrfctrl(KS_GRADRFCTRL *gradrfctrl, KS_WAVE *wave)</div><div class="ttdoc">*Internal use*. Adds a wave (KS_WAVE) - if it is not a part of a KS_RF object - to the KS_GRADRFCTRL ...</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:3462</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a9428be182c75f60d1b4e6fe36c888afa"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">KS_WAVE::wfpulse</a></div><div class="ttdeci">WF_PULSE ** wfpulse</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:523</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_aa65115d54842eeffc47a1b324caa62ab"><div class="ttname"><a href="_k_s_foundation__common_8c.html#aa65115d54842eeffc47a1b324caa62ab">ks_syslimits_gradtarget</a></div><div class="ttdeci">float ks_syslimits_gradtarget(LOG_GRAD loggrd, WF_PROCESSOR board)</div><div class="ttdoc">Returns the maximum target amplitude for a board (internal use)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:176</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">KS_WAVE::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:515</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a558b0ff480e8db364962bd0f203d6958"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">KS_WFINSTANCE::wf</a></div><div class="ttdeci">WF_PULSE * wf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:252</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32"><div class="ttname"><a href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1754</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4ec679c0fb8eb62c1776e67434e25b77"><div class="ttname"><a href="_k_s_foundation_8h.html#a4ec679c0fb8eb62c1776e67434e25b77">ks_tgt_reset_gradrfctrl</a></div><div class="ttdeci">void ks_tgt_reset_gradrfctrl(KS_GRADRFCTRL *gradrfctrl)</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1402</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a9506a3d2dc5e084c69dda40e8e127a97"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a9506a3d2dc5e084c69dda40e8e127a97">ks_wave2iwave</a></div><div class="ttdeci">STATUS ks_wave2iwave(KS_IWAVE iwave, const KS_WAVE *wave, int board)</div><div class="ttdoc">(Internal use) Conversion of waveform content in a KS_WAVE sequence object to a short int array for u...</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1177</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">KS_SEQ_CONTROL::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:990</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a636634b6eb50758af3826332f9180e9b"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a636634b6eb50758af3826332f9180e9b">psd_rf_wait</a></div><div class="ttdeci">int psd_rf_wait</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ac91cb32048e29f6e58bbf2c1acb8fdf1a6e84527e5ca18e299429a1d00297b47f"><div class="ttname"><a href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1a6e84527e5ca18e299429a1d00297b47f">KS_WF_SIZE</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1754</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_WAVE::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:518</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ac91cb32048e29f6e58bbf2c1acb8fdf1a976ecf9c65bb6a43d7cb791d681f0adc"><div class="ttname"><a href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1a976ecf9c65bb6a43d7cb791d681f0adc">KS_WF_BUF2</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1754</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="acc74b390428f6607e8c540f6b4182407"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acc74b390428f6607e8c540f6b4182407">&#9670;&nbsp;</a></span>ks_pg_rf()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_pg_rf </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_f.html">KS_RF</a> *&#160;</td>
          <td class="paramname"><em>rf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a>&#160;</td>
          <td class="paramname"><em>loc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>ctrl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Places a <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> sequence object on a board at some position in the pulse sequence</h4>
</p>
<p>This function should be called in the <code>@pg</code> section to place out a <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> sequence object that creates an RF pulse in the pulse sequence. The same <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object can be placed out as many times as desired, by only changing the second argument each time (to avoid waveform overlaps). The second argument is a <a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> struct with three fields:</p><ul>
<li><code>.board</code>: <em>Ignored</em>. <code>.rfwave</code> will always be placed on RHO. If the resolution of <code>.omegawave</code> is non-zero it will be placed on OMEGA, and correspondingly for <code>.thetawave</code> on THETA</li>
<li><code>.pos</code>: Absolute time in [us] of the start of the waveform</li>
<li><code>.ampscale</code>: A factor that must be in range [-1.0,1.0] that is multiplied with <code>.amp</code> to yield a per-instance (i.e. per-placement) amplitude. For <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> objects this will cause the flip angle to be reduced on a per-instance basis. This can be used to generate a variable flip-angle train of RF pulses using a single <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object. An <code>.ampscale</code> of -1.0 is equivalent to adding a 180 degree RF phase shift to the RF pulse</li>
</ul>
<p>If the <code>rfwave.duration</code> field in the <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object is 0, <a class="el" href="_k_s_foundation_8h.html#a853cff23395e570cc88aa3405b78c3a9" title="Places a KS_RF sequence object on a board at some position in the pulse sequence">ks_pg_rf()</a> will return SUCCESS and quietly ignore placing it out. This is a part of the mechanism that setting the <code>.duration</code> field to 0 in <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code> should eliminate its existance in both timing calulations and in the pulse sequence generation in <code>@pg</code></p>
<p>As <a class="el" href="_k_s_foundation_8h.html#a853cff23395e570cc88aa3405b78c3a9" title="Places a KS_RF sequence object on a board at some position in the pulse sequence">ks_pg_rf()</a> internally calls <a class="el" href="_k_s_foundation_8h.html#afc06ade569c7b85c1aa5026fc2e1c710" title="Places a KS_WAVE sequence object on a board at some position in the pulse sequence">ks_pg_wave()</a> for its KS_WAVEs, double buffering will be used for all hardware waveforms, allowing waveforms to be replaced in run-time (<a class="el" href="ksepi_8e.html#a1669428052472d00b1c55a1291f8032f">scan()</a>) using <a class="el" href="_k_s_foundation_8h.html#a2e916337476b7566b3bf033824f964ba" title="Moves a waveform belonging to a KS_WAVE sequence object to hardware">ks_scan_wave2hardware()</a></p>
<p>Regardless of the order placed out in the <code>@pg</code> section the <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object is placed, the <em>instance</em> number of the <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> is automatically sorted in time. These abstract, sorted, instance numbers are used by <code>ks_scan_***()</code> functions in <a class="el" href="ksepi_8e.html#a1669428052472d00b1c55a1291f8032f">scan()</a> to refer to a specific instance of a <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object in the sequence.</p>
<p>GENERAL NOTE: It is a <b>requirement</b> that the function in the <code>@pg</code> section containing all <code>ks_pg_***()</code> calls is also called exactly once in <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code> after the calls to the corresponding <code>ks_eval_***()</code> functions that design the KS_*** sequence objects. Each <code>ks_pg_***()</code> will throw an error if this has not been done.</p>
<p>When <a class="el" href="_k_s_foundation_8h.html#a853cff23395e570cc88aa3405b78c3a9" title="Places a KS_RF sequence object on a board at some position in the pulse sequence">ks_pg_rf()</a> is run in <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code> (on HOST), the field <code>.rfpulse.activity</code> that was first set to 0 by <a class="el" href="_k_s_foundation_8h.html#a187dd827bc0f2be7f9a00f20802fca91" title="Sets up a KS_RF object">ks_eval_rf()</a> is now set to <code>PSD_APS2_ON + PSD_MPS2_ON + PSD_SCAN_ON</code> by <a class="el" href="_k_s_foundation_8h.html#a853cff23395e570cc88aa3405b78c3a9" title="Places a KS_RF sequence object on a board at some position in the pulse sequence">ks_pg_rf()</a>. This triggers the RF functions used in <a class="el" href="_k_s_foundation_8h.html#ab4c6e9f82b55a3db56765fc22f21b7b5" title="Returns the time required to play out a certain number of sequence modules over some interval...">ks_eval_gradrflimits()</a> to include this <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object in RF scaling and SAR calculations. Each time <a class="el" href="_k_s_foundation_8h.html#a853cff23395e570cc88aa3405b78c3a9" title="Places a KS_RF sequence object on a board at some position in the pulse sequence">ks_pg_rf()</a> is called, the field <code>.rfpulse.num</code> is incremented after being first set to 0 by <a class="el" href="_k_s_foundation_8h.html#a187dd827bc0f2be7f9a00f20802fca91" title="Sets up a KS_RF object">ks_eval_rf()</a>. Hence, it is crucial that the <em>sequence generating</em> function (c.f. <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a>) containing all <code>ks_pg_***()</code> calls is executed between the <a class="el" href="_k_s_foundation_8h.html#a187dd827bc0f2be7f9a00f20802fca91" title="Sets up a KS_RF object">ks_eval_rf()</a> setup call and the call to <a class="el" href="_k_s_foundation_8h.html#ab4c6e9f82b55a3db56765fc22f21b7b5" title="Returns the time required to play out a certain number of sequence modules over some interval...">ks_eval_gradrflimits()</a></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">rf</td><td>Pointer to a <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> sequence object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">loc</td><td><a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> struct to specify when to place the <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctrl</td><td>Pointer to the <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> struct corresponding to the sequence module for this <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;                                                                {</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;  <span class="comment">/* input validation */</span></div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;  <span class="keywordflow">if</span> (rf == NULL) {</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: First argument is NULL&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;  }</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;</div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;  <span class="comment">/* duration of 0 should not throw an error as this is a sign of that it has not been set up</span></div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;<span class="comment">     or has manually been disabled this way */</span></div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;  <span class="keywordflow">if</span> (rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> == 0) {</div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;    <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;  }</div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;  <span class="keywordflow">if</span> (rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a> == NULL || rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>[0] == 0 || rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>[0] == <span class="charliteral">&#39; &#39;</span>) {</div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_rf: Invalid description (&#39;%s&#39;)&quot;</span>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;  }</div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;</div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;  <span class="comment">/* TGT: Don&#39;t place anything on hardware if ctrl-&gt;duration = 0.</span></div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;<span class="comment">     This is in concert with:</span></div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;<span class="comment">     - not performing createseq() in KS_SEQLENGTH if seqctrl.duration = 0</span></div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;<span class="comment">     - not playing sequence modules in scan() using ks_scan_playsequence() if seqctrl.duration = 0</span></div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;  <span class="keywordflow">if</span> (ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> == 0) {</div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s(%s): Refusing to place RF since seqctrl.duration = 0 (indicating `%s` not to be played in scan())&quot;</span>, __FUNCTION__, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;  }</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;  <span class="comment">/* TGT: make sure (the RF pulses in) the sequence module were a part of the seqcollection when GEReq_eval_rfscaling() was called */</span></div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;  <span class="keywordflow">if</span> (ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a729d02cb24cec9beeaf9a22ac9390754">rfscalingdone</a> == FALSE &amp;&amp; ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> &gt; 0) {</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s(%s): Missing RF scaling for sequence module with non-zero duration. Add `%s` to seqcollection *before* calling GEReq_eval_rfscaling(seqcollection)&quot;</span>, __FUNCTION__, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;  }</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;  <span class="keywordflow">if</span> (!ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#af7f2aa8614e77ef8af0154c7e071ab0e">is_cleared_on_tgt</a>) <span class="comment">/* Reset gradrfctrl on tgt to remove dead pointers copied from host. */</span></div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;  {</div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#a4ec679c0fb8eb62c1776e67434e25b77">ks_tgt_reset_gradrfctrl</a>(&amp;ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>);</div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;  }</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;  loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> = RUP_RF(loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>);</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;  RFEnvelopeWaveformGeneratorCheck(rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, <a class="code" href="_k_s_foundation__common_8c.html#a4dcd93b4f67aeb25541105ec7953c67e">ks_rhoboard</a>);</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;</div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;  <span class="keywordflow">if</span> (rf-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>) {</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;    <span class="keywordflow">if</span> (rf-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> != rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>) {</div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;      <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_rf (%s): The duration of the omega waveform must be equal to the RF duration&quot;</span>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;      <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;    }</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;  }</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;  <span class="keywordflow">if</span> (rf-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>) {</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;    <span class="keywordflow">if</span> (rf-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> != rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>) {</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;      <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_rf (%s): The duration of the theta waveform must be equal to the RF duration&quot;</span>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;      <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;    }</div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;  }</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;</div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;  <span class="comment">/* Set ctrl-&gt;momentstart if this is an excitation pulse */</span></div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;  <span class="keywordflow">if</span> (rf-&gt;<a class="code" href="struct_k_s___r_f.html#aea7921a9aa2757a88e843476848ddd55">role</a> == <a class="code" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedacc16dd3ca09dedaf6334a39ee4e46241">KS_RF_ROLE_EXC</a>) {</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;    ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ab9bf2aebde69b811853b4febc57ff5f8">momentstart</a> = RUP_GRD(loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> + rf-&gt;<a class="code" href="struct_k_s___r_f.html#af9bc4afb4579b2bf18259e70175090a3">start2iso</a>); <span class="comment">/* RUP_GRD: make sure it is on a 4us raster too for gradient timing calcs */</span></div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;  }</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;  <span class="comment">/* register this KS_RF for later heating calculations - and do this *before* calls to ks_pg_wave() below (in this function) to avoid double registrations (c.f. ks_eval_addwavetogradrfctrl()).</span></div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;<span class="comment">     N.B.: While RF/sar calcs (ks_eval_rfscaling()) are not affected by this, registering the rf-&gt;rfwave both as a part of the RF object and as a separate wave in ctrl-&gt;gradrf would otherwise lead to problems for</span></div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;<span class="comment">     ks_gnuplot_seqmodule(). This would cause the RF pulse to show up twice in the plot / pdf / image.</span></div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;<span class="comment">     ks_eval_addwavetogradrfctrl() is called in ks_pg_wave() and checks if this wave also belongs to a parent registered RF pulse in which case the wave will not be registered again */</span></div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;  {</div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;    STATUS status = <a class="code" href="_k_s_foundation__common_8c.html#a75283b5758c55ab4d0530fb9f05b22fd">ks_eval_addrftogradrfctrl</a>(&amp;ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>, rf);</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;    <span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;  }</div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;<span class="preprocessor">#ifdef HOST_TGT</span></div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;</div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;  <span class="comment">/* update rfpulse.num counter on host only. We can use this ninst variable as info</span></div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;<span class="comment">     for RF heating calculations */</span></div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.num++;</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;  <span class="comment">/* now that we have shown that we are really going to use this pulse, set its</span></div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;<span class="comment">     activity flag to SCAN, APS2, MPS2 */</span></div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.activity = PSD_APS2_ON + PSD_MPS2_ON + PSD_SCAN_ON;</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;  <span class="keywordflow">if</span> (rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.num == 0) {</div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_rf @tgt(%s): pulsegen was never run on HOST (rf-&gt;rfpulse.num = 0)&quot;</span>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;  }</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;  <span class="keywordflow">if</span> (rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.activity == 0) {</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_rf @tgt(%s): RF pulse with zero activity&quot;</span>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;  }</div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;</div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;  <span class="comment">/* The values in rf-&gt;rfwave.waveform[] are relative (unit-less). The actual amplitude of the RF wave</span></div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;<span class="comment">     is only controlled by rf-&gt;amp (which in turn is set by GE&#39;s setScale() and indirectly by peakB1()).</span></div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;<span class="comment">     Prepare RF waveform with correct amplitude on TGT side that can be used with ks_pg_wave() to give the right</span></div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;<span class="comment">     RF amplitude, after we have done RF scaling on HOST and hence have a final value for rf-&gt;amp.</span></div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;<span class="comment">     The units of this RF waveform, before and after calling ks_wave_multiplywal(), are relative (not [G])</span></div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;<span class="comment">     due to GE&#39;s RF scaling process involving e.g. xmtaddScan.</span></div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;<span class="comment">     Look in GERequired.e:GEReq_eval_gradrflimits() for more info on how peakB1() and setScale() are used. */</span></div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#a23b3d305df1e2ad0563f8a2fea2330df">ks_wave_multiplyval</a>(&amp;rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#ab508ded41392ee86a2a619d3e93d2373">amp</a> / <a class="code" href="_k_s_foundation__common_8c.html#a2bfec427bf5a8966edf279b2eba23396">ks_wave_absmax</a>(&amp;rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>));</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;</div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;  <span class="comment">/* place the RF wave */</span></div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;  loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> = RHO;</div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#a9c5ace140d91043230e2e5364a0be90b">ks_pg_wave</a>(&amp;rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>, loc, ctrl) == FAILURE)</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;  <span class="comment">/* add SSP RF bits that handles the frequency control and blanking/unblanking the receiver */</span></div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;  addrfbits(&amp;rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[RHO][<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a>], 0, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> + <a class="code" href="_k_s_foundation__common_8c.html#a636634b6eb50758af3826332f9180e9b">psd_rf_wait</a>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>);</div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;  <span class="comment">/* set RF frequency offset */</span></div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;  setfrequency(rf-&gt;<a class="code" href="struct_k_s___r_f.html#add1e81760153252b7f921b8f9118edb2">cf_offset</a> / TARDIS_FREQ_RES, &amp;rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[RHO][<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a>], INSTRALL);</div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;  <span class="comment">/* set ampscale to 1. If you want to scale the omega or theata board, do it seperatly */</span></div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;  loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> = 1;</div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;</div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;  <span class="comment">/* place the OMEGA wave */</span></div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;  loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> = OMEGA;</div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;  <span class="keywordflow">if</span> (rf-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>) {</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#a9c5ace140d91043230e2e5364a0be90b">ks_pg_wave</a>(&amp;rf-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>, loc, ctrl) == FAILURE)</div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;      <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;  }</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;  <span class="keywordflow">if</span> (rf-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>) {</div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;    <span class="comment">/* add SSP RF bits that handles the frequency control and blanking/unblanking the receiver */</span></div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;    addrfbits(&amp;rf-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[OMEGA][<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a>], 0, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> + <a class="code" href="_k_s_foundation__common_8c.html#a636634b6eb50758af3826332f9180e9b">psd_rf_wait</a>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>);</div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;  }</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;  <span class="comment">/* place the THETA wave */</span></div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;  loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> = THETA;</div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;  <span class="keywordflow">if</span> (rf-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>) {</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#a9c5ace140d91043230e2e5364a0be90b">ks_pg_wave</a>(&amp;rf-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>, loc, ctrl) == FAILURE)</div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;      <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;  }</div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;</div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;  <span class="keywordflow">if</span> (rf-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>) {</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;    <span class="comment">/* add SSP RF bits that handles the frequency control and blanking/unblanking the receiver */</span></div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;    addrfbits(&amp;rf-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[THETA][<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a>], 0, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> + <a class="code" href="_k_s_foundation__common_8c.html#a636634b6eb50758af3826332f9180e9b">psd_rf_wait</a>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>);</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;  }</div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;</div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;</div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;} <span class="comment">/* ks_pg_rf */</span></div><div class="ttc" id="_k_s_foundation__common_8c_html_a9c5ace140d91043230e2e5364a0be90b"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a9c5ace140d91043230e2e5364a0be90b">ks_pg_wave</a></div><div class="ttdeci">STATUS ks_pg_wave(KS_WAVE *wave, KS_SEQLOC loc, KS_SEQ_CONTROL *ctrl)</div><div class="ttdoc">Places a KS_WAVE sequence object on a board at some position in the pulse sequence</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1593</div></div>
<div class="ttc" id="struct_k_s___r_f_html_add1e81760153252b7f921b8f9118edb2"><div class="ttname"><a href="struct_k_s___r_f.html#add1e81760153252b7f921b8f9118edb2">KS_RF::cf_offset</a></div><div class="ttdeci">float cf_offset</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:791</div></div>
<div class="ttc" id="struct_k_s___r_f_html_af9bc4afb4579b2bf18259e70175090a3"><div class="ttname"><a href="struct_k_s___r_f.html#af9bc4afb4579b2bf18259e70175090a3">KS_RF::start2iso</a></div><div class="ttdeci">int start2iso</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:793</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a2bfec427bf5a8966edf279b2eba23396"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a2bfec427bf5a8966edf279b2eba23396">ks_wave_absmax</a></div><div class="ttdeci">float ks_wave_absmax(const KS_WAVE *wave)</div><div class="ttdoc">Returns the maximum absolute value in a KS_WAVE sequence object</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:986</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a1910d262855b71da353ed0d07a6c7823"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">KS_SEQLOC::pos</a></div><div class="ttdeci">int pos</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:242</div></div>
<div class="ttc" id="struct_k_s___r_f_html_aea7921a9aa2757a88e843476848ddd55"><div class="ttname"><a href="struct_k_s___r_f.html#aea7921a9aa2757a88e843476848ddd55">KS_RF::role</a></div><div class="ttdeci">int role</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:788</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a4dcd93b4f67aeb25541105ec7953c67e"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a4dcd93b4f67aeb25541105ec7953c67e">ks_rhoboard</a></div><div class="ttdeci">int ks_rhoboard</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:46</div></div>
<div class="ttc" id="struct_k_s___r_f_html_ae183c3e4095d1c6d14b3d59a0da97928"><div class="ttname"><a href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">KS_RF::rfpulse</a></div><div class="ttdeci">RF_PULSE rfpulse</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:797</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a729d02cb24cec9beeaf9a22ac9390754"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a729d02cb24cec9beeaf9a22ac9390754">KS_SEQ_CONTROL::rfscalingdone</a></div><div class="ttdeci">int rfscalingdone</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:988</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_ab9bf2aebde69b811853b4febc57ff5f8"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ab9bf2aebde69b811853b4febc57ff5f8">KS_SEQ_CONTROL::momentstart</a></div><div class="ttdeci">int momentstart</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:985</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a2e3f5254967cadb9a41167c6fbf6743e"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">KS_SEQLOC::board</a></div><div class="ttdeci">int board</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:241</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_SEQ_CONTROL::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:984</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aa324c3517656b8ec032523397a142bedacc16dd3ca09dedaf6334a39ee4e46241"><div class="ttname"><a href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedacc16dd3ca09dedaf6334a39ee4e46241">KS_RF_ROLE_EXC</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1750</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a606fbf556e8a297aa1f68b098f6ac2a2"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">KS_SEQLOC::ampscale</a></div><div class="ttdeci">float ampscale</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:243</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a2573e18f36ab5c3d3fc97072edcfab16"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">KS_SEQ_CONTROL::gradrf</a></div><div class="ttdeci">KS_GRADRFCTRL gradrf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:992</div></div>
<div class="ttc" id="struct_k_s___r_f_html_aecd8b68c159a31a28e2a2ec003b593e2"><div class="ttname"><a href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">KS_RF::thetawave</a></div><div class="ttdeci">KS_WAVE thetawave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:800</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">KS_WAVE::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:516</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_af7f2aa8614e77ef8af0154c7e071ab0e"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#af7f2aa8614e77ef8af0154c7e071ab0e">KS_GRADRFCTRL::is_cleared_on_tgt</a></div><div class="ttdeci">int is_cleared_on_tgt</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:823</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a9428be182c75f60d1b4e6fe36c888afa"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">KS_WAVE::wfpulse</a></div><div class="ttdeci">WF_PULSE ** wfpulse</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:523</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a2a9b610a78cdae3ac8ef682bd34f7e0d"><div class="ttname"><a href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">KS_RF::rfwave</a></div><div class="ttdeci">KS_WAVE rfwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:798</div></div>
<div class="ttc" id="struct_k_s___r_f_html_ab508ded41392ee86a2a619d3e93d2373"><div class="ttname"><a href="struct_k_s___r_f.html#ab508ded41392ee86a2a619d3e93d2373">KS_RF::amp</a></div><div class="ttdeci">float amp</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:792</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32"><div class="ttname"><a href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1754</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4ec679c0fb8eb62c1776e67434e25b77"><div class="ttname"><a href="_k_s_foundation_8h.html#a4ec679c0fb8eb62c1776e67434e25b77">ks_tgt_reset_gradrfctrl</a></div><div class="ttdeci">void ks_tgt_reset_gradrfctrl(KS_GRADRFCTRL *gradrfctrl)</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1402</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a75283b5758c55ab4d0530fb9f05b22fd"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a75283b5758c55ab4d0530fb9f05b22fd">ks_eval_addrftogradrfctrl</a></div><div class="ttdeci">STATUS ks_eval_addrftogradrfctrl(KS_GRADRFCTRL *gradrfctrl, KS_RF *rf)</div><div class="ttdoc">*Internal use*. Adds an RF pulse to the KS_GRADRFCTRL struct for later SAR &amp; RF power calculations in...</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:3496</div></div>
<div class="ttc" id="struct_k_s___r_f_html_aa283d0a503cfda1c25da9f9b9a0d8b1c"><div class="ttname"><a href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">KS_RF::omegawave</a></div><div class="ttdeci">KS_WAVE omegawave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:799</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">KS_SEQ_CONTROL::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:990</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a23b3d305df1e2ad0563f8a2fea2330df"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a23b3d305df1e2ad0563f8a2fea2330df">ks_wave_multiplyval</a></div><div class="ttdeci">void ks_wave_multiplyval(KS_WAVE *wave, float val)</div><div class="ttdoc">In-place scalar multiplication of a KS_WAVE</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1135</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a636634b6eb50758af3826332f9180e9b"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a636634b6eb50758af3826332f9180e9b">psd_rf_wait</a></div><div class="ttdeci">int psd_rf_wait</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_WAVE::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:518</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3ac7fbefbe1b3e6b8bca64e64a927130"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3ac7fbefbe1b3e6b8bca64e64a927130">&#9670;&nbsp;</a></span>ks_pg_selrf()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_pg_selrf </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *&#160;</td>
          <td class="paramname"><em>selrf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a>&#160;</td>
          <td class="paramname"><em>loc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>ctrl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Places a <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> sequence object on a gradient (and RF) board at some position in the pulse sequence</h4>
</p>
<p>This function should be called in the <code>@pg</code> section to place out a <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> sequence object that creates an RF pulse with associated trapezoids in the pulse sequence. The same <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> object can be placed out as many times as desired, by only changing the second argument each time (to avoid waveform overlaps). The second argument is a <a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> struct with three fields:</p><ul>
<li><code>.board</code>: Choose between XGRAD, YGRAD, ZGRAD for the board on which <code>.pregrad</code>, <code>.grad</code> (or <code>.gradwave</code>) and <code>.postgrad</code> should be placed</li>
<li><code>.pos</code>: Absolute time in [us] of the start of the <code>.pregrad</code> attack ramp. If <code>.pregrad</code> has zero duration, <code>.pos</code> will in effect refer to the start of the <code>.grad</code> attack ramp</li>
<li><code>.ampscale</code>: A factor that must be in range [-1.0,1.0] that is multiplied with <code>rf.rfwave.amp</code> to yield a per-instance (i.e. per-placement) amplitude. For <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> objects the <code>.ampscale</code> value will be passed on its internal call to <a class="el" href="_k_s_foundation_8h.html#a853cff23395e570cc88aa3405b78c3a9" title="Places a KS_RF sequence object on a board at some position in the pulse sequence">ks_pg_rf()</a>, but not to its internal <a class="el" href="_k_s_foundation_8h.html#a61651c54c4dfd4388fc939d804a9964b" title="Places a KS_TRAP sequence object on a board at some position in the pulse sequence">ks_pg_trap()</a> calls. Hence <code>.ampscale</code> will have the same effect for <a class="el" href="_k_s_foundation_8h.html#a6e727c3449c63278cbfc2e35cfcfa9fa" title="Places a KS_SELRF sequence object on a gradient (and RF) board at some position in the pulse sequence...">ks_pg_selrf()</a> as for <a class="el" href="_k_s_foundation_8h.html#a853cff23395e570cc88aa3405b78c3a9" title="Places a KS_RF sequence object on a board at some position in the pulse sequence">ks_pg_rf()</a>, with no per-instance control of the amplitude of the gradients involved. A reduced <code>.ampscale</code> will cause the flip angle to be reduced on a per-instance basis. This can be used to generate a variable flip-angle train of selective RF pulses using a single <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> object. An <code>.ampscale</code> of -1.0 is equivalent to adding a 180 degree RF phase shift to the RF pulse</li>
</ul>
<p>If the <code>.gradwave</code> field has a non-zero resolution, <a class="el" href="_k_s_foundation_8h.html#a6e727c3449c63278cbfc2e35cfcfa9fa" title="Places a KS_SELRF sequence object on a gradient (and RF) board at some position in the pulse sequence...">ks_pg_selrf()</a> will place out the <code>.gradwave</code> (<a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a>) instead of the <code>.grad</code> (<a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a>) during the time the RF pulse is played out. An error is thrown if <code>.gradwave.duration</code> (if <code>.gradwave.res</code> &gt; 0) is not equal to the <code>.rf.rfwave.duration</code>. If <code>.pregrad</code> or <code>.postgrad</code> has zero duration, they will not be placed out. The <em>existance</em> of non-zero <code>.pregrad</code> and <code>.postgrad</code> is determined by <a class="el" href="_k_s_foundation_8h.html#ad77a28d39f423bca930ee2f8f392de17" title="Sets up a KS_SELRF object for RF slice selection with preset gradient constraints">ks_eval_selrf()</a> based on <code>.rf.role</code></p>
<p>As <a class="el" href="_k_s_foundation_8h.html#a6e727c3449c63278cbfc2e35cfcfa9fa" title="Places a KS_SELRF sequence object on a gradient (and RF) board at some position in the pulse sequence...">ks_pg_selrf()</a> internally calls <a class="el" href="_k_s_foundation_8h.html#afc06ade569c7b85c1aa5026fc2e1c710" title="Places a KS_WAVE sequence object on a board at some position in the pulse sequence">ks_pg_wave()</a> for its KS_WAVEs, hardware double buffering will be used for all waveforms, allowing waveforms to be replaced in run-time (<a class="el" href="ksepi_8e.html#a1669428052472d00b1c55a1291f8032f">scan()</a>) using <a class="el" href="_k_s_foundation_8h.html#a2e916337476b7566b3bf033824f964ba" title="Moves a waveform belonging to a KS_WAVE sequence object to hardware">ks_scan_wave2hardware()</a></p>
<p>Regardless of the order placed out in the <code>@pg</code> section the <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> object is placed, the <em>instance</em> number of the <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> is automatically sorted in time. These abstract, sorted, instance numbers are used by <code>ks_scan_***()</code> functions in <a class="el" href="ksepi_8e.html#a1669428052472d00b1c55a1291f8032f">scan()</a> to refer to a specific instance of a <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> object in the sequence.</p>
<p>GENERAL NOTE: It is a <b>requirement</b> that the function in the <code>@pg</code> section containing all <code>ks_pg_***()</code> calls is also called exactly once in <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code> after the calls to the corresponding <code>ks_eval_***()</code> functions that design the KS_*** sequence objects. Each <code>ks_pg_***()</code> will throw an error if this has not been done.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">selrf</td><td>Pointer to a <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> sequence object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">loc</td><td><a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> struct to specify when and where to place the <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctrl</td><td>Pointer to the <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> struct corresponding to the sequence module for this <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;                                                                         {</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;  <a class="code" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> rfloc;</div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;  <a class="code" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> gradloc;</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;  <span class="keywordtype">float</span> gradmax;</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;</div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> != XGRAD &amp;&amp; loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> != YGRAD &amp;&amp; loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> != ZGRAD) {</div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s(%s): loc.board (2nd arg) must be a gradient board&quot;</span>, __FUNCTION__, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;  }</div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;  <span class="comment">/* gradient max on current logical board */</span></div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;  gradmax = <a class="code" href="_k_s_foundation__common_8c.html#aa65115d54842eeffc47a1b324caa62ab">ks_syslimits_gradtarget</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>);</div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;</div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;  <span class="comment">/* loc.ampscale should only affect the RF amp, not the gradients */</span></div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;  gradloc = loc; gradloc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> = 1.0;</div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;  rfloc = loc; rfloc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> = RHO;</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;  <span class="comment">/* RF starts after the preselgrad (if present) */</span></div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;  rfloc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> += selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a35145c98c931f54a8bf2b97edfb3e4c6">pregrad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>;</div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;  <span class="comment">/* delay the RF pulse start by the ramptime of the slice sel gradient</span></div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;<span class="comment">     when .gradwave is used, .grad.ramptime will be correctly zero  */</span></div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;  rfloc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> += selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a>;</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;</div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;  <span class="comment">/************* generate the RF (incl. optional THETA &amp; OMEGA) *************/</span></div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;</div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#acc74b390428f6607e8c540f6b4182407">ks_pg_rf</a>(&amp;selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>, rfloc, ctrl) == FAILURE)</div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;</div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;  <span class="comment">/************************ place gradients *********************************/</span></div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;  <span class="comment">/* Pre-slice sel gradient. Roles: e.g. left crusher or dephasing gradient in bSSFP */</span></div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#ab3341eea000c35a438dfeb3cfc1da103">ks_pg_trap</a>(&amp;selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a35145c98c931f54a8bf2b97edfb3e4c6">pregrad</a>, gradloc, ctrl) == FAILURE)</div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;  gradloc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> += selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a35145c98c931f54a8bf2b97edfb3e4c6">pregrad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>;</div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;</div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;</div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;</div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;  <span class="comment">/* slice select gradient */</span></div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;  <span class="keywordflow">if</span> (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>) {</div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;    <span class="comment">/* use gradwave (not trapezoid) */</span></div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;</div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;    <span class="keywordflow">if</span> (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> != (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>) || (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> * GRAD_UPDATE_TIME != selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>)) {</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s(%s): The duration of &#39;gradwave&#39; (%d [us]) must equal the RF duration (%d [us])&quot;</span>, __FUNCTION__,</div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;                      selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>);</div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;    }</div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;</div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#a9c5ace140d91043230e2e5364a0be90b">ks_pg_wave</a>(&amp;selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>, gradloc, ctrl) == FAILURE)</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;      <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;</div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;    gradloc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> += selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>;</div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;</div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;    <span class="comment">/* use trapezoid (not gradwave) */</span></div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;    <span class="keywordflow">if</span> (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">plateautime</a> != selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>) {</div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s(%s): Plateau time of slice select (%d) != RF duration (%d)&quot;</span>, __FUNCTION__, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">plateautime</a>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>);</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#ab3341eea000c35a438dfeb3cfc1da103">ks_pg_trap</a>(&amp;selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#af33317a98ade78e3ac252b33cbb794af">grad</a>, gradloc, ctrl) == FAILURE)</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;        <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;</div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;      gradloc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> += selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>;</div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;    }</div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;</div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;  } <span class="comment">/* slice select */</span></div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;</div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;  <span class="comment">/* post-slice sel gradient. Roles: e.g. right crusher or refocusing gradient */</span></div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#ab3341eea000c35a438dfeb3cfc1da103">ks_pg_trap</a>(&amp;selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a5ac7ed86029ab647ba0c9a656ae9fb37">postgrad</a>, gradloc, ctrl) == FAILURE)</div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;  gradloc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> += selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a5ac7ed86029ab647ba0c9a656ae9fb37">postgrad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>;</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;</div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;} <span class="comment">/* ks_pg_selrf */</span></div><div class="ttc" id="struct_k_s___t_r_a_p_html_a878bb367b07dc7dfb5fef5728d2e5b1d"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">KS_TRAP::plateautime</a></div><div class="ttdeci">int plateautime</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:436</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#af33317a98ade78e3ac252b33cbb794af">KS_SELRF::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1340</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a9c5ace140d91043230e2e5364a0be90b"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a9c5ace140d91043230e2e5364a0be90b">ks_pg_wave</a></div><div class="ttdeci">STATUS ks_pg_wave(KS_WAVE *wave, KS_SEQLOC loc, KS_SEQ_CONTROL *ctrl)</div><div class="ttdoc">Places a KS_WAVE sequence object on a board at some position in the pulse sequence</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1593</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a1910d262855b71da353ed0d07a6c7823"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">KS_SEQLOC::pos</a></div><div class="ttdeci">int pos</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:242</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_a607347e9c1c7a9eef21fff556faccc3f"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">KS_SELRF::gradwave</a></div><div class="ttdeci">KS_WAVE gradwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1342</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a2e3f5254967cadb9a41167c6fbf6743e"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">KS_SEQLOC::board</a></div><div class="ttdeci">int board</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:241</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a606fbf556e8a297aa1f68b098f6ac2a2"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">KS_SEQLOC::ampscale</a></div><div class="ttdeci">float ampscale</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:243</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_a35145c98c931f54a8bf2b97edfb3e4c6"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#a35145c98c931f54a8bf2b97edfb3e4c6">KS_SELRF::pregrad</a></div><div class="ttdeci">KS_TRAP pregrad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1339</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_acc74b390428f6607e8c540f6b4182407"><div class="ttname"><a href="_k_s_foundation__common_8c.html#acc74b390428f6607e8c540f6b4182407">ks_pg_rf</a></div><div class="ttdeci">STATUS ks_pg_rf(KS_RF *rf, KS_SEQLOC loc, KS_SEQ_CONTROL *ctrl)</div><div class="ttdoc">Places a KS_RF sequence object on a board at some position in the pulse sequence</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1799</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_adeab1cc34f1a7f20f41e8825d849981e"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">KS_SELRF::rf</a></div><div class="ttdeci">KS_RF rf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1334</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">KS_WAVE::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:516</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_aa65115d54842eeffc47a1b324caa62ab"><div class="ttname"><a href="_k_s_foundation__common_8c.html#aa65115d54842eeffc47a1b324caa62ab">ks_syslimits_gradtarget</a></div><div class="ttdeci">float ks_syslimits_gradtarget(LOG_GRAD loggrd, WF_PROCESSOR board)</div><div class="ttdoc">Returns the maximum target amplitude for a board (internal use)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:176</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a2a9b610a78cdae3ac8ef682bd34f7e0d"><div class="ttname"><a href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">KS_RF::rfwave</a></div><div class="ttdeci">KS_WAVE rfwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:798</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a></div><div class="ttdoc">typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:240</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_a5ac7ed86029ab647ba0c9a656ae9fb37"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#a5ac7ed86029ab647ba0c9a656ae9fb37">KS_SELRF::postgrad</a></div><div class="ttdeci">KS_TRAP postgrad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1341</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_TRAP::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:437</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_ab3341eea000c35a438dfeb3cfc1da103"><div class="ttname"><a href="_k_s_foundation__common_8c.html#ab3341eea000c35a438dfeb3cfc1da103">ks_pg_trap</a></div><div class="ttdeci">STATUS ks_pg_trap(KS_TRAP *trap, KS_SEQLOC loc, KS_SEQ_CONTROL *ctrl)</div><div class="ttdoc">Places a KS_TRAP sequence object on a board at some position in the pulse sequence</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1212</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_acbc719dc4e48c2a2df0447875e4348ca"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">KS_TRAP::ramptime</a></div><div class="ttdeci">int ramptime</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:435</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_WAVE::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:518</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aeea9a34f36ca48eda6882d9426a4e638"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeea9a34f36ca48eda6882d9426a4e638">&#9670;&nbsp;</a></span>ks_pg_wait()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_pg_wait </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___w_a_i_t.html">KS_WAIT</a> *&#160;</td>
          <td class="paramname"><em>wait</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a>&#160;</td>
          <td class="paramname"><em>loc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>ctrl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Places a <a class="el" href="struct_k_s___w_a_i_t.html" title="Core sequence object that adds wait periods in the pulse sequence (see ks_eval_wait(), ks_pg_wait()). Can be placed on any sequence board">KS_WAIT</a> sequence object on all boards at some position in the pulse sequence</h4>
</p>
<p>This function should be called in the <code>@pg</code> section to place out a <a class="el" href="struct_k_s___w_a_i_t.html" title="Core sequence object that adds wait periods in the pulse sequence (see ks_eval_wait(), ks_pg_wait()). Can be placed on any sequence board">KS_WAIT</a> sequence object that creates a wait pulse. The same <a class="el" href="struct_k_s___w_a_i_t.html" title="Core sequence object that adds wait periods in the pulse sequence (see ks_eval_wait(), ks_pg_wait()). Can be placed on any sequence board">KS_WAIT</a> object can be placed out as many times as desired, by only changing the second argument each time (to avoid waveform overlaps). The second argument is a <a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> struct with three fields:</p><ul>
<li><code>.board</code>: <em>Ignored</em></li>
<li><code>.pos</code>: Absolute time in [us] of the start of the wait pulse</li>
<li><code>.ampscale</code>: <em>Ignored</em></li>
</ul>
<p>This function will insert a deadtime of duration equal to the <code>.duration</code> field in the <a class="el" href="struct_k_s___w_a_i_t.html" title="Core sequence object that adds wait periods in the pulse sequence (see ks_eval_wait(), ks_pg_wait()). Can be placed on any sequence board">KS_WAIT</a> object at position <code>.pos</code>. This delay can be changed in run-time by calling <a class="el" href="_k_s_foundation_8h.html#a196a10609c8f75d0ff6d7a520d0b7c27" title="Updates the wait period of all instances of a KS_WAIT sequence object. The value of waitperiod must n...">ks_scan_wait()</a>.</p>
<p>GENERAL NOTE: It is a <b>requirement</b> that the function in the <code>@pg</code> section containing all <code>ks_pg_***()</code> calls is also called exactly once in <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code> after the calls to the corresponding <code>ks_eval_***()</code> functions that design the KS_*** sequence objects. Each <code>ks_pg_***()</code> will throw an error if this has not been done.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">wait</td><td>Pointer to a <a class="el" href="struct_k_s___w_a_i_t.html" title="Core sequence object that adds wait periods in the pulse sequence (see ks_eval_wait(), ks_pg_wait()). Can be placed on any sequence board">KS_WAIT</a> sequence object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">loc</td><td><a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> struct to specify when and where to place the <a class="el" href="struct_k_s___w_a_i_t.html" title="Core sequence object that adds wait periods in the pulse sequence (see ks_eval_wait(), ks_pg_wait()). Can be placed on any sequence board">KS_WAIT</a> </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctrl</td><td>Pointer to the <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> struct corresponding to the sequence module for this <a class="el" href="struct_k_s___w_a_i_t.html" title="Core sequence object that adds wait periods in the pulse sequence (see ks_eval_wait(), ks_pg_wait()). Can be placed on any sequence board">KS_WAIT</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;                                                                      {</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> first = loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a839a809fe0e8486a8cd3d41788349129">KS_ALL</a> ? XGRAD : loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>;</div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> last = loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a839a809fe0e8486a8cd3d41788349129">KS_ALL</a> ? SSP : loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>;</div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;  <span class="comment">/* checking for NULL pointers */</span></div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;  <span class="keywordflow">if</span> (wait == NULL) {</div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wait: First argument is NULL&quot;</span>);</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;  }</div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;</div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;  <span class="comment">/* duration of 0 should not throw an error as this is a sign of that it has not been set up</span></div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;<span class="comment">     or has manually been disabled this way */</span></div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;  <span class="keywordflow">if</span> (wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> == 0) {</div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;    <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;  }</div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;</div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;  <span class="keywordflow">if</span> (wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a1c544bec41003a594ba4ec7d43a3a470">description</a> == NULL || wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>[0] == 0 || wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>[0] == <span class="charliteral">&#39; &#39;</span>) {</div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wait: Invalid description (&#39;%s&#39;)&quot;</span>, wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;  }</div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;</div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;  <span class="comment">/* disallow EPI dual boards */</span></div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> &gt;= <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a6016c24e63f250c7e49d537c9b01dea1">KS_FREQX_PHASEY</a> &amp;&amp; loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> &lt;= <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a888d3c7138175390df8ccde3cf29c868">KS_XYZ</a>) {</div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wait(%s): Invalid board selection: %d&quot;</span>, wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>);</div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;  }</div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;</div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;  loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> = RUP_GRD(loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>);</div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;</div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;  {</div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;</div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;    <span class="comment">/* TGT: Don&#39;t place anything on hardware if ctrl-&gt;duration = 0.</span></div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;<span class="comment">       This is in concert with:</span></div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;<span class="comment">       - not performing createseq() in KS_SEQLENGTH if seqctrl.duration = 0</span></div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;<span class="comment">       - not playing sequence modules in scan() using ks_scan_playsequence() if seqctrl.duration = 0</span></div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;    <span class="keywordflow">if</span> (ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> == 0) {</div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;      <a class="code" href="_k_s_foundation__common_8c.html#abdc1fc916ea7bfbc3ce222f646ee3ae9">ks_dbg</a>(<span class="stringliteral">&quot;%s(%s): Refusing to place wait pulse since seqctrl.duration = 0 (indicating `%s` not to be played in scan())&quot;</span>, __FUNCTION__, wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;      <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;    }</div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;</div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;    <span class="keywordflow">if</span> (wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a> &gt;= wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>) {</div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wait @tgt(%s): the number of instances generated on the target exceed the number of ones generated on the host&quot;</span>, wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;    }</div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;</div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;    <span class="keywordflow">if</span> (wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#aeb311c3018cbffb0db0463280f3c4cd5">wfpulse</a> == NULL) {</div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;      WF_PULSE wfInit = INITPULSE;</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;</div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> boardc[8] = <span class="stringliteral">&quot;xyzrrtos&quot;</span>;</div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;      <span class="keywordtype">char</span> tmpstr[<a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> + 4];</div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;      tmpstr[<a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> + 4 - 1] = 0;</div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;</div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;      wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#aeb311c3018cbffb0db0463280f3c4cd5">wfpulse</a> = (WF_PULSE *) AllocNode(8 * <span class="keyword">sizeof</span>(WF_PULSE));</div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = XGRAD; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt;= SSP; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> != RHO2){</div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;          <span class="comment">/* init pulse structure */</span></div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;          wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#aeb311c3018cbffb0db0463280f3c4cd5">wfpulse</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] = wfInit;</div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;</div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;          <span class="comment">/* Name for WF_PULSEs */</span></div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;          sprintf(tmpstr, <span class="stringliteral">&quot;%s.w%c&quot;</span>, wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, boardc[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>]); pulsename(&amp;(wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#aeb311c3018cbffb0db0463280f3c4cd5">wfpulse</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>]), tmpstr);</div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;          createconst(&amp;(wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#aeb311c3018cbffb0db0463280f3c4cd5">wfpulse</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>]), <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>, wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>, 0);</div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;</div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;        } <span class="comment">/* per board */</span></div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;      }</div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;</div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;    } <span class="comment">/* wfpulse == NULL */</span></div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;</div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;    <span class="keywordflow">if</span> (!wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>) {</div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;      wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a15be3edad342a49398ca841c2745dc9e">wfi</a> = (<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a> *) AllocNode(wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a> * <span class="keyword">sizeof</span>(<a class="code" href="struct_k_s___w_a_i_t.html">KS_WAIT</a>));</div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;    }</div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;</div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = first; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt;= last; ++<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>) {</div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> == <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8aebefea71c9bec2b927545759821d6657">KS_RHO2</a>) <span class="keywordflow">continue</span>; <span class="comment">/* skip RHO2 */</span></div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;      </div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;      loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> = <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;      <span class="keywordtype">int</span> isrf = loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == RHO || loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == RHO2 || loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == THETA || loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == OMEGA;</div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;      <span class="keywordtype">int</span> isssp = loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == SSP;</div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;</div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;      createinstr(&amp;(wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#aeb311c3018cbffb0db0463280f3c4cd5">wfpulse</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>]), loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> + (isrf * <a class="code" href="_k_s_foundation__common_8c.html#a636634b6eb50758af3826332f9180e9b">psd_rf_wait</a>) + (isssp * <a class="code" href="_k_s_foundation__common_8c.html#aa4225c3edfbcb8e85d91fc491a495058">psd_grd_wait</a>), wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>, 0);</div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;      wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">boardinstance</a> = wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#aeb311c3018cbffb0db0463280f3c4cd5">wfpulse</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].ninsts - 1; <span class="comment">/* zero based */</span></div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;      wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">wf</a> = &amp;(wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#aeb311c3018cbffb0db0463280f3c4cd5">wfpulse</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>]);</div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;      wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a> = loc;</div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;      wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>++;</div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;    }</div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;</div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;    <span class="comment">/* sort after the last instance is generated */</span></div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;    <span class="keywordflow">if</span> (wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a> == wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>) {</div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;      <a class="code" href="_k_s_foundation__common_8c.html#a0ae65ed3cc2deb47ccf50b7988239474">ks_sort_wfi_by_timeboard</a>(wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>, wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>);</div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;    }</div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;  }</div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;  {</div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = first; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt;= last; ++<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>) {</div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> == <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8aebefea71c9bec2b927545759821d6657">KS_RHO2</a>) <span class="keywordflow">continue</span>; <span class="comment">/* skip RHO2 */</span></div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;      loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> = <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;      wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a89785a274d251fd637bf40923ad5c345">locs</a>[wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>] = loc;</div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;      wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>++;</div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;    }</div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;  }</div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;</div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;</div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;} <span class="comment">/* ks_pg_wait */</span></div><div class="ttc" id="_k_s_foundation__common_8c_html_a0ae65ed3cc2deb47ccf50b7988239474"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a0ae65ed3cc2deb47ccf50b7988239474">ks_sort_wfi_by_timeboard</a></div><div class="ttdeci">void ks_sort_wfi_by_timeboard(KS_WFINSTANCE *a, int nitems)</div><div class="ttdoc">Sort WF_INSTANCEs in time, then board</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2955</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8a6016c24e63f250c7e49d537c9b01dea1"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a6016c24e63f250c7e49d537c9b01dea1">KS_FREQX_PHASEY</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a42df2e3be0bda47009caae1a7042b522"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">KS_WFINSTANCE::boardinstance</a></div><div class="ttdeci">int boardinstance</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:251</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a1910d262855b71da353ed0d07a6c7823"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">KS_SEQLOC::pos</a></div><div class="ttdeci">int pos</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:242</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8aebefea71c9bec2b927545759821d6657"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8aebefea71c9bec2b927545759821d6657">KS_RHO2</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a></div><div class="ttdoc">(Internal use) Structure being a part of various sequence objects to sort them in time across boards...</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:250</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a72a22b96ff3908d2b9a20a3a02647a2f"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">KS_BASE::ninst</a></div><div class="ttdeci">int ninst</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:261</div></div>
<div class="ttc" id="struct_k_s___w_a_i_t_html"><div class="ttname"><a href="struct_k_s___w_a_i_t.html">KS_WAIT</a></div><div class="ttdoc">Core sequence object that adds wait periods in the pulse sequence (see ks_eval_wait(), ks_pg_wait()). Can be placed on any sequence board</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:308</div></div>
<div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abdc1fc916ea7bfbc3ce222f646ee3ae9"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abdc1fc916ea7bfbc3ce222f646ee3ae9">ks_dbg</a></div><div class="ttdeci">STATUS ks_dbg(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:114</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a2e3f5254967cadb9a41167c6fbf6743e"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">KS_SEQLOC::board</a></div><div class="ttdeci">int board</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:241</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8a888d3c7138175390df8ccde3cf29c868"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a888d3c7138175390df8ccde3cf29c868">KS_XYZ</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_SEQ_CONTROL::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:984</div></div>
<div class="ttc" id="struct_k_s___w_a_i_t_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___w_a_i_t.html#a1c544bec41003a594ba4ec7d43a3a470">KS_WAIT::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:310</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8a839a809fe0e8486a8cd3d41788349129"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a839a809fe0e8486a8cd3d41788349129">KS_ALL</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aacb2fe1d83c45e8d0525f363bdd6b8a6"><div class="ttname"><a href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a></div><div class="ttdeci">#define KS_DESCRIPTION_LENGTH</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:112</div></div>
<div class="ttc" id="struct_k_s___w_a_i_t_html_a89785a274d251fd637bf40923ad5c345"><div class="ttname"><a href="struct_k_s___w_a_i_t.html#a89785a274d251fd637bf40923ad5c345">KS_WAIT::locs</a></div><div class="ttdeci">KS_SEQLOC locs[KS_MAXINSTANCES]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:312</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a78e529e1d86855310035845e03a4c107"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">KS_WFINSTANCE::loc</a></div><div class="ttdeci">KS_SEQLOC loc</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:253</div></div>
<div class="ttc" id="struct_k_s___w_a_i_t_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">KS_WAIT::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:309</div></div>
<div class="ttc" id="struct_k_s___w_a_i_t_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___w_a_i_t.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_WAIT::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:311</div></div>
<div class="ttc" id="struct_k_s___w_a_i_t_html_a15be3edad342a49398ca841c2745dc9e"><div class="ttname"><a href="struct_k_s___w_a_i_t.html#a15be3edad342a49398ca841c2745dc9e">KS_WAIT::wfi</a></div><div class="ttdeci">KS_WFINSTANCE * wfi</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:314</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a558b0ff480e8db364962bd0f203d6958"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">KS_WFINSTANCE::wf</a></div><div class="ttdeci">WF_PULSE * wf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:252</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_aa4225c3edfbcb8e85d91fc491a495058"><div class="ttname"><a href="_k_s_foundation__common_8c.html#aa4225c3edfbcb8e85d91fc491a495058">psd_grd_wait</a></div><div class="ttdeci">int psd_grd_wait</div></div>
<div class="ttc" id="struct_k_s___w_a_i_t_html_aeb311c3018cbffb0db0463280f3c4cd5"><div class="ttname"><a href="struct_k_s___w_a_i_t.html#aeb311c3018cbffb0db0463280f3c4cd5">KS_WAIT::wfpulse</a></div><div class="ttdeci">WF_PULSE * wfpulse</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:313</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">KS_SEQ_CONTROL::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:990</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a636634b6eb50758af3826332f9180e9b"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a636634b6eb50758af3826332f9180e9b">psd_rf_wait</a></div><div class="ttdeci">int psd_rf_wait</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aada57f8dd7b50aacf95e65220950547f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aada57f8dd7b50aacf95e65220950547f">&#9670;&nbsp;</a></span>ks_pg_isirot()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_pg_isirot </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___i_s_i_r_o_t.html">KS_ISIROT</a> *&#160;</td>
          <td class="paramname"><em>isirot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SCAN_INFO&#160;</td>
          <td class="paramname"><em>scan_info</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>rotfun</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>ctrl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Places out an intersequence interrupt at a specific time in the sequence module</h4>
</p>
<p>This function connects the execution of a psd-specific rotation function in realtime when time passes this point in the sequence. This is done by two <a class="el" href="struct_k_s___w_a_i_t.html" title="Core sequence object that adds wait periods in the pulse sequence (see ks_eval_wait(), ks_pg_wait()). Can be placed on any sequence board">KS_WAIT</a> pulses (being part of <a class="el" href="struct_k_s___i_s_i_r_o_t.html" title="Struct for in-sequence rotations using ISI vector interupts">KS_ISIROT</a>) on the SSP board.</p>
<p>Example of use in a <code>myseqmodule_pg()</code> function of the sequence module (in <a class="el" href="ksepi_8e.html#a9229731c099971b90dbf7721bad586a9">pulsegen()</a>):</p>
<div class="fragment"><div class="line"><span class="comment">// add some padding time before the SSP pulses (not well tested how much of KS_ISI_predelay that is necessary)</span></div><div class="line">mypos += RUP_GRD(<a class="code" href="_k_s_foundation_8h.html#ab70ad63ae09d81e0c912e61d3fbef0fa">KS_ISI_predelay</a>);</div><div class="line"></div><div class="line">status = <a class="code" href="_k_s_foundation_8h.html#a67d0db25c6c69ee17a9b4b0ee79b7fb7">ks_pg_isirot</a>(&amp;myisirot, myscaninfo, mypos, myisirotatefun, myseqctrl);</div><div class="line"><span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"></div><div class="line"><span class="comment">// add some padding time after the SSP pulses (not well tested how much of KS_ISI_postdelay that is necessary)</span></div><div class="line">mypos += RUP_GRD(myisirot.duration + <a class="code" href="_k_s_foundation_8h.html#af1033833702a65e227f5dcd4b0e29e74">KS_ISI_postdelay</a>);</div></div><!-- fragment --><p>where the psd-specific rotation function is declared as:</p>
<div class="fragment"><div class="line"><span class="comment">// Intra sequence interrupts placed as WAIT pulses on the SSP board may be used to call for an immediate</span></div><div class="line"><span class="comment">// rotation of the logical coordinate system in real time as these WAIT pulses are played out, as</span></div><div class="line"><span class="comment">// opposed to during the SSI time for the sequence module.</span></div><div class="line"><span class="comment">// The WAIT pulse is assigned a control number (isi number) that is then connected to this void function</span></div><div class="line"><span class="comment">// using `isivector()` in ks_pg_isirot(). No input arguments can be passed to this function. Instead the</span></div><div class="line"><span class="comment">// rotation information specific to the sequence module is provided in `myscaninfo.oprot`. The acutal</span></div><div class="line"><span class="comment">// rotation work, incl. keeping track of number of isi pulses played out is done by ks_scan_isirotate().</span></div><div class="line"><span class="keywordtype">void</span> myisirotatefun() {</div><div class="line"></div><div class="line"><span class="preprocessor">#ifdef IPG</span></div><div class="line">  <a class="code" href="_k_s_foundation_8h.html#a520240c3153cf9ffe25a7617b2c72149">ks_scan_isirotate</a>(&amp;myisirot);</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line">}</div></div><!-- fragment --><p> Note that the only difference between the psd-specific <code>myisirotatefun()</code> and the general <a class="el" href="_k_s_foundation_8h.html#a520240c3153cf9ffe25a7617b2c72149" title="Performs an immediate rotation of the logical system on hardware (WARP)">ks_scan_isirotate()</a> is that <code>myisirotatefun()</code> has no input arguments. Input arguments cannot be used as it is called from an interrupt routine, not from some other parent function.</p>
<p>Care must be taken when mixing the use of <a class="el" href="_k_s_foundation_8h.html#a2fdfe2e655a76c4cd4fb1dac16d1834b" title="Performs a rotation of the logical system on hardware (WARP)">ks_scan_rotate()</a> (executing during the SSI time) and these ISI interrupts, so that they are executed in the correct order. One way is to consistently avoid the use of <a class="el" href="_k_s_foundation_8h.html#a2fdfe2e655a76c4cd4fb1dac16d1834b" title="Performs a rotation of the logical system on hardware (WARP)">ks_scan_rotate()</a> and instead return to the prescribed slice rotation by calling <a class="el" href="_k_s_foundation_8h.html#a67d0db25c6c69ee17a9b4b0ee79b7fb7" title="Places out an intersequence interrupt at a specific time in the sequence module">ks_pg_isirot()</a> again, last in the same <code>myseqmodule_pg()</code> function, this time using the prescribed scan_info struct:</p>
<div class="fragment"><div class="line">status = <a class="code" href="_k_s_foundation_8h.html#a67d0db25c6c69ee17a9b4b0ee79b7fb7">ks_pg_isirot</a>(&amp;myisirot, <a class="code" href="_g_e_required_8e.html#aedd5d7c8a00be480230531f3ab5f8bdb">ks_scan_info</a>[0], mypos, myisirotatefun, myseqctrl);</div><div class="line"><span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div></div><!-- fragment --><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">isirot</td><td>Pointer to a <a class="el" href="struct_k_s___i_s_i_r_o_t.html" title="Struct for in-sequence rotations using ISI vector interupts">KS_ISIROT</a> sequence object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">scan_info</td><td>SCAN_INFO struct holding an <code>.oprot</code> matrix to be used for real-time rotation </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pos</td><td>Absolute position in [us] in the pulse sequence when this rotation should occur </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rotfun</td><td>Function pointer to the psd-specific rotation function </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctrl</td><td>Pointer to the <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> struct corresponding to the sequence module </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;                                                                                                         {</div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;  <a class="code" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> tmploc = <a class="code" href="_k_s_foundation_8h.html#ad01dd4f06fe226a502e872d4173ba7ae">KS_INIT_SEQLOC</a>;</div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;</div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;  <span class="keywordflow">if</span> (! isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>) {</div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;    <span class="comment">/* must have called ks_eval_isirot() first */</span></div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;    <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;  }</div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;</div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;  <span class="keywordflow">if</span> (rotfun == NULL)</div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: 4th arg (rotfun) cannot be NULL&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;</div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;</div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;  <span class="comment">/* Set the ctrl_word to binary match the isi vector interupt number */</span></div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;  <span class="comment">/* /--------------------------------------------------------------\ */</span></div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;  <span class="comment">/* | interupt number | ctrl_word                                  | */</span></div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;  <span class="comment">/* |--------------------------------------------------------------| */</span></div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;  <span class="comment">/* | 4               | PSD_ISI2_BIT                               | */</span></div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;  <span class="comment">/* | 5               | PSD_ISI0_BIT + PSD_ISI2_BIT                | */</span></div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;  <span class="comment">/* | 6               | PSD_ISI1_BIT + PSD_ISI2_BIT                | */</span></div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;  <span class="comment">/* | 7               | PSD_ISI0_BIT + PSD_ISI1_BIT + PSD_ISI2_BIT | */</span></div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;  <span class="comment">/* \--------------------------------------------------------------/ */</span></div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;</div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;  tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> = SSP;</div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;  tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> = RUP_GRD(pos);</div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#aeea9a34f36ca48eda6882d9426a4e638">ks_pg_wait</a>(&amp;isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#ae1657bcc1ec96d5840d39d301f6f296c">waitfun</a>, tmploc, ctrl) == FAILURE)</div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;</div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;  tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> += RUP_GRD(isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#ae1657bcc1ec96d5840d39d301f6f296c">waitfun</a>.<a class="code" href="struct_k_s___w_a_i_t.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>);</div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;</div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#aeea9a34f36ca48eda6882d9426a4e638">ks_pg_wait</a>(&amp;isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#ad8daa9629fb2aa8f141f7be2fef5a62d">waitrot</a>, tmploc, ctrl) == FAILURE)</div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;</div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;</div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;  {</div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;    <span class="keywordtype">long</span> ctrl_word = 0;</div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;    <span class="keywordtype">int</span> placementindx = isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#ae1657bcc1ec96d5840d39d301f6f296c">waitfun</a>.<a class="code" href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a> - 1;</div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;</div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;    <span class="comment">/* SSP ISI number */</span></div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;    getctrl(&amp;ctrl_word, &amp;isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#ae1657bcc1ec96d5840d39d301f6f296c">waitfun</a>.<a class="code" href="struct_k_s___w_a_i_t.html#aeb311c3018cbffb0db0463280f3c4cd5">wfpulse</a>[SSP], isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#ae1657bcc1ec96d5840d39d301f6f296c">waitfun</a>.<a class="code" href="struct_k_s___w_a_i_t.html#aeb311c3018cbffb0db0463280f3c4cd5">wfpulse</a>[SSP].ninsts - 1);</div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;</div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;    <span class="keywordflow">if</span> (isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#a0e1954c05e7f29d42ad9f68ea2b38559">isinumber</a> == 4)</div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;      ctrl_word  = ctrl_word | PSD_ISI2_BIT;</div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#a0e1954c05e7f29d42ad9f68ea2b38559">isinumber</a> == 5)</div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;      ctrl_word  = ctrl_word | PSD_ISI0_BIT | PSD_ISI2_BIT;</div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#a0e1954c05e7f29d42ad9f68ea2b38559">isinumber</a> == 6)</div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;      ctrl_word  = ctrl_word | PSD_ISI1_BIT | PSD_ISI2_BIT;</div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#a0e1954c05e7f29d42ad9f68ea2b38559">isinumber</a> == 7)</div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;      ctrl_word  = ctrl_word | PSD_ISI0_BIT | PSD_ISI1_BIT | PSD_ISI2_BIT;</div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;</div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;    setctrl(ctrl_word, &amp;isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#ae1657bcc1ec96d5840d39d301f6f296c">waitfun</a>.<a class="code" href="struct_k_s___w_a_i_t.html#aeb311c3018cbffb0db0463280f3c4cd5">wfpulse</a>[SSP], isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#ae1657bcc1ec96d5840d39d301f6f296c">waitfun</a>.<a class="code" href="struct_k_s___w_a_i_t.html#aeb311c3018cbffb0db0463280f3c4cd5">wfpulse</a>[SSP].ninsts - 1);</div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;</div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;    <span class="comment">/* SSP Rotation */</span></div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;    getctrl(&amp;ctrl_word, &amp;isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#ad8daa9629fb2aa8f141f7be2fef5a62d">waitrot</a>.<a class="code" href="struct_k_s___w_a_i_t.html#aeb311c3018cbffb0db0463280f3c4cd5">wfpulse</a>[SSP], isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#ad8daa9629fb2aa8f141f7be2fef5a62d">waitrot</a>.<a class="code" href="struct_k_s___w_a_i_t.html#aeb311c3018cbffb0db0463280f3c4cd5">wfpulse</a>[SSP].ninsts - 1);</div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;    ctrl_word |= PSD_MTX_UPDT;</div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;    setctrl(ctrl_word, &amp;isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#ad8daa9629fb2aa8f141f7be2fef5a62d">waitrot</a>.<a class="code" href="struct_k_s___w_a_i_t.html#aeb311c3018cbffb0db0463280f3c4cd5">wfpulse</a>[SSP], isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#ad8daa9629fb2aa8f141f7be2fef5a62d">waitrot</a>.<a class="code" href="struct_k_s___w_a_i_t.html#aeb311c3018cbffb0db0463280f3c4cd5">wfpulse</a>[SSP].ninsts - 1);</div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;</div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;    <span class="comment">/* Allocate memory for scan info array */</span></div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;    <span class="keywordflow">if</span> (isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#a401a138c899d31df5f63f1971febe233">scan_info</a> == NULL) {</div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;      isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#a401a138c899d31df5f63f1971febe233">scan_info</a> = (SCAN_INFO *) AllocNode(isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#aa571b5a96556f71c84be339d2e9193b4">numinstances</a> * <span class="keyword">sizeof</span>(SCAN_INFO));</div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;    }</div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;</div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;    <span class="comment">/* Store the scan info for current ISI, where scan_info.oprot contains the rotation matrix */</span></div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;    isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#a401a138c899d31df5f63f1971febe233">scan_info</a>[placementindx] = scan_info;</div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;</div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;    <span class="comment">/* Reset num ISI and counter */</span></div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;    isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#a617a47c70795bcff659815ad0efd2266">counter</a> = 0; <span class="comment">/* make sure it is zero before scan starts */</span></div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;</div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;    <span class="comment">/* Connect ths isi number with the function pointer */</span></div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;    isivector((<span class="keywordtype">short</span>) isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#a0e1954c05e7f29d42ad9f68ea2b38559">isinumber</a>, rotfun, (<span class="keywordtype">short</span>) FALSE);</div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;</div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;  }</div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;</div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;  <span class="keywordflow">if</span> (0) { <span class="comment">/* make sure the WAIT pulses have been placed out in temporal order */</span></div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;    <span class="keywordtype">int</span> lastpos = -1;</div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;    WF_INSTR_HDR *instr = isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#ae1657bcc1ec96d5840d39d301f6f296c">waitfun</a>.<a class="code" href="struct_k_s___w_a_i_t.html#aeb311c3018cbffb0db0463280f3c4cd5">wfpulse</a>[SSP].inst_hdr_tail;</div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; (isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#ae1657bcc1ec96d5840d39d301f6f296c">waitfun</a>.<a class="code" href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a> - 1); <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;      <span class="keywordflow">if</span> (lastpos &gt; instr-&gt;start) {</div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: Must place the ISI pulses in temporal order&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;        lastpos = instr-&gt;start;</div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;        instr = instr-&gt;next;</div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;      }</div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;    }</div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;  }</div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;</div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;  <span class="comment">/* copy for convenience */</span></div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;  isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#aa571b5a96556f71c84be339d2e9193b4">numinstances</a> = isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#ae1657bcc1ec96d5840d39d301f6f296c">waitfun</a>.<a class="code" href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>;</div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;</div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;</div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;    <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;</div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;} <span class="comment">/* ks_pg_isirot() */</span></div><div class="ttc" id="struct_k_s___i_s_i_r_o_t_html_a0e1954c05e7f29d42ad9f68ea2b38559"><div class="ttname"><a href="struct_k_s___i_s_i_r_o_t.html#a0e1954c05e7f29d42ad9f68ea2b38559">KS_ISIROT::isinumber</a></div><div class="ttdeci">int isinumber</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:325</div></div>
<div class="ttc" id="struct_k_s___i_s_i_r_o_t_html_a401a138c899d31df5f63f1971febe233"><div class="ttname"><a href="struct_k_s___i_s_i_r_o_t.html#a401a138c899d31df5f63f1971febe233">KS_ISIROT::scan_info</a></div><div class="ttdeci">SCAN_INFO * scan_info</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:324</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a1910d262855b71da353ed0d07a6c7823"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">KS_SEQLOC::pos</a></div><div class="ttdeci">int pos</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:242</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a72a22b96ff3908d2b9a20a3a02647a2f"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">KS_BASE::ninst</a></div><div class="ttdeci">int ninst</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:261</div></div>
<div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a2e3f5254967cadb9a41167c6fbf6743e"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">KS_SEQLOC::board</a></div><div class="ttdeci">int board</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:241</div></div>
<div class="ttc" id="struct_k_s___i_s_i_r_o_t_html_ae1657bcc1ec96d5840d39d301f6f296c"><div class="ttname"><a href="struct_k_s___i_s_i_r_o_t.html#ae1657bcc1ec96d5840d39d301f6f296c">KS_ISIROT::waitfun</a></div><div class="ttdeci">KS_WAIT waitfun</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:322</div></div>
<div class="ttc" id="struct_k_s___w_a_i_t_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">KS_WAIT::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:309</div></div>
<div class="ttc" id="struct_k_s___i_s_i_r_o_t_html_a617a47c70795bcff659815ad0efd2266"><div class="ttname"><a href="struct_k_s___i_s_i_r_o_t.html#a617a47c70795bcff659815ad0efd2266">KS_ISIROT::counter</a></div><div class="ttdeci">int counter</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:327</div></div>
<div class="ttc" id="struct_k_s___w_a_i_t_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___w_a_i_t.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_WAIT::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:311</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a></div><div class="ttdoc">typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:240</div></div>
<div class="ttc" id="struct_k_s___i_s_i_r_o_t_html_aa571b5a96556f71c84be339d2e9193b4"><div class="ttname"><a href="struct_k_s___i_s_i_r_o_t.html#aa571b5a96556f71c84be339d2e9193b4">KS_ISIROT::numinstances</a></div><div class="ttdeci">int numinstances</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:328</div></div>
<div class="ttc" id="struct_k_s___i_s_i_r_o_t_html_ad8daa9629fb2aa8f141f7be2fef5a62d"><div class="ttname"><a href="struct_k_s___i_s_i_r_o_t.html#ad8daa9629fb2aa8f141f7be2fef5a62d">KS_ISIROT::waitrot</a></div><div class="ttdeci">KS_WAIT waitrot</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:323</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_aeea9a34f36ca48eda6882d9426a4e638"><div class="ttname"><a href="_k_s_foundation__common_8c.html#aeea9a34f36ca48eda6882d9426a4e638">ks_pg_wait</a></div><div class="ttdeci">STATUS ks_pg_wait(KS_WAIT *wait, KS_SEQLOC loc, KS_SEQ_CONTROL *ctrl)</div><div class="ttdoc">Places a KS_WAIT sequence object on all boards at some position in the pulse sequence</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2038</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ad01dd4f06fe226a502e872d4173ba7ae"><div class="ttname"><a href="_k_s_foundation_8h.html#ad01dd4f06fe226a502e872d4173ba7ae">KS_INIT_SEQLOC</a></div><div class="ttdeci">#define KS_INIT_SEQLOC</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:128</div></div>
<div class="ttc" id="struct_k_s___w_a_i_t_html_aeb311c3018cbffb0db0463280f3c4cd5"><div class="ttname"><a href="struct_k_s___w_a_i_t.html#aeb311c3018cbffb0db0463280f3c4cd5">KS_WAIT::wfpulse</a></div><div class="ttdeci">WF_PULSE * wfpulse</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:313</div></div>
<div class="ttc" id="struct_k_s___i_s_i_r_o_t_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___i_s_i_r_o_t.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_ISIROT::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:326</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a5f4f5dedf466061d2d764c1a11e2b06c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5f4f5dedf466061d2d764c1a11e2b06c">&#9670;&nbsp;</a></span>ks_pg_epi_dephasers()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_pg_epi_dephasers </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *&#160;</td>
          <td class="paramname"><em>epi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a>&#160;</td>
          <td class="paramname"><em>loc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>ctrl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Places out the dephasing gradients of a <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> object (<em>used by <a class="el" href="_k_s_foundation_8h.html#a804f4f4b870338386e1dea3a877f5bd2" title="Places out a KS_EPI object (EPI train including dephaser and rephaser gradients)">ks_pg_epi()</a></em>)</h4>
</p>
<p>This function is called internally by <a class="el" href="_k_s_foundation_8h.html#a804f4f4b870338386e1dea3a877f5bd2" title="Places out a KS_EPI object (EPI train including dephaser and rephaser gradients)">ks_pg_epi()</a> to place out the dephasing gradients of a <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> object. See <a class="el" href="_k_s_foundation_8h.html#a804f4f4b870338386e1dea3a877f5bd2" title="Places out a KS_EPI object (EPI train including dephaser and rephaser gradients)">ks_pg_epi()</a> for more details</p>
<p>For advanced usage of <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a>, it is possible to call ks_pg_epi_dephaser(), <a class="el" href="_k_s_foundation_8h.html#a0d7fe8d68dfb536eb3e903b1ab58e615" title="Places out the core part a KS_EPI object (used by ks_pg_epi())">ks_pg_epi_echo()</a> and <a class="el" href="_k_s_foundation_8h.html#aeaa0bf154295359cf8e84cedfbfdbe8b" title="Places out the rephasing gradients of a KS_EPI object (used by ks_pg_epi())">ks_pg_epi_rephasers()</a> separately instead of the single call to <a class="el" href="_k_s_foundation_8h.html#a804f4f4b870338386e1dea3a877f5bd2" title="Places out a KS_EPI object (EPI train including dephaser and rephaser gradients)">ks_pg_epi()</a>. This allows the dephasing and rephasing gradients to be detached from the core EPI readout part</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">epi</td><td>Pointer to a <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> sequence object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">loc</td><td><a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> struct to specify when and where to place the dephasers of the <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ctrl</td><td>Pointer to the <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> struct corresponding to the sequence module for this <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;                                                                             {</div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;  <span class="keywordtype">int</span> readaxis, blipaxis, sliceaxis;</div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;  <a class="code" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> tmploc = <a class="code" href="_k_s_foundation_8h.html#ad01dd4f06fe226a502e872d4173ba7ae">KS_INIT_SEQLOC</a>;</div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;  <span class="keywordtype">int</span> maxduration;</div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;</div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;  <span class="keywordflow">if</span> (!epi) { <span class="keywordflow">return</span> FAILURE; }</div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;</div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;  <span class="comment">/* loc.ampscale may only be +1 or -1 and will control the read polarity.</span></div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;<span class="comment">   The blip polarity is controlled in run time with ks_scan_epi_shotcontrol() */</span></div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> != 1.0 &amp;&amp; loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> != -1.0) {</div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_epi_dephasers: loc.ampscale must be +1 or -1 (controls read polarity)&quot;</span>);</div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;  }</div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;</div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;  loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> = RDN_GRD(loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>);</div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;</div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;  <span class="keywordflow">switch</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>) {</div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a6016c24e63f250c7e49d537c9b01dea1">KS_FREQX_PHASEY</a>:</div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;    readaxis = XGRAD; blipaxis = YGRAD; sliceaxis = ZGRAD; <span class="keywordflow">break</span>;</div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a9bc0b0996e2ac9c6a131209ae4c88629">KS_FREQY_PHASEX</a>:</div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;    readaxis = YGRAD; blipaxis = XGRAD; sliceaxis = ZGRAD; <span class="keywordflow">break</span>;</div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ae0b83b9295764e027abbf88b95b09879">KS_FREQX_PHASEZ</a>:</div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;    readaxis = XGRAD; blipaxis = ZGRAD; sliceaxis = YGRAD; <span class="keywordflow">break</span>;</div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ae2467923eda691b22f68ca96bd7e1c1f">KS_FREQZ_PHASEX</a>:</div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;    readaxis = ZGRAD; blipaxis = XGRAD; sliceaxis = YGRAD; <span class="keywordflow">break</span>;</div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8afa622a33dd2854dfe97a4056ecec5b67">KS_FREQY_PHASEZ</a>:</div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;    readaxis = YGRAD; blipaxis = ZGRAD; sliceaxis = XGRAD; <span class="keywordflow">break</span>;</div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ad53040a098477496911fa2b1850a2d93">KS_FREQZ_PHASEY</a>:</div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;    readaxis = ZGRAD; blipaxis = YGRAD; sliceaxis = XGRAD; <span class="keywordflow">break</span>;</div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;  <span class="keywordflow">default</span>:</div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_epi_dephasers: loc.board is not valid: %d&quot;</span>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>);</div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;  }</div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;</div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;  <span class="comment">/* allocate time corresponding to the longest of the three, but push the dephasers to the right below */</span></div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;  maxduration = IMax(3, epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#abc81c5867684b6e31b65459ec9431269">readphaser</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>, epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>, epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>);</div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;</div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;  <span class="comment">/* read phaser (same KS_TRAP for DE/REphasing =&gt; 2 instances per EPI) */</span></div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;  <span class="keywordflow">if</span> (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#abc81c5867684b6e31b65459ec9431269">readphaser</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> &gt; 0) {</div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;    tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> = readaxis;</div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;    tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> = loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a>;</div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;    tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> = loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> + maxduration - epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#abc81c5867684b6e31b65459ec9431269">readphaser</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>;</div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#ab3341eea000c35a438dfeb3cfc1da103">ks_pg_trap</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#abc81c5867684b6e31b65459ec9431269">readphaser</a>, tmploc, ctrl) == FAILURE)</div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;      <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;  }</div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;</div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;  <span class="comment">/* blip phaser (same KS_PHASER for DE/REphasing =&gt; 2 instances per EPI) */</span></div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;  <span class="keywordflow">if</span> (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> &gt; 0) {</div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;    tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> = blipaxis;</div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;    tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> = 1.0;</div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;    tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> = loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> + maxduration - epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>;</div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#a82a797ba7a2ddcd48502d834c2a067b6">ks_pg_phaser</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>, tmploc, ctrl) == FAILURE)</div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;      <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;  }</div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;</div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;  <span class="comment">/* slice phaser (same KS_PHASER for DE/REphasing =&gt; 2 instances per EPI) */</span></div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;  <span class="keywordflow">if</span> (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> &gt; 0) {</div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;    tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> = sliceaxis;</div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;    tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> = 1.0;</div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;    tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> = loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> + maxduration - epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>;</div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#a82a797ba7a2ddcd48502d834c2a067b6">ks_pg_phaser</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>, tmploc, ctrl) == FAILURE)</div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;      <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;  }</div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;</div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;} <span class="comment">/* ks_pg_epi_dephasers */</span></div><div class="ttc" id="_k_s_foundation__common_8c_html_a82a797ba7a2ddcd48502d834c2a067b6"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a82a797ba7a2ddcd48502d834c2a067b6">ks_pg_phaser</a></div><div class="ttdeci">STATUS ks_pg_phaser(KS_PHASER *phaser, KS_SEQLOC loc, KS_SEQ_CONTROL *ctrl)</div><div class="ttdoc">Places a KS_PHASER sequence object on a board at some position in the pulse sequence</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1412</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8a6016c24e63f250c7e49d537c9b01dea1"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a6016c24e63f250c7e49d537c9b01dea1">KS_FREQX_PHASEY</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">KS_PHASER::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1525</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a1910d262855b71da353ed0d07a6c7823"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">KS_SEQLOC::pos</a></div><div class="ttdeci">int pos</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:242</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8ae0b83b9295764e027abbf88b95b09879"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ae0b83b9295764e027abbf88b95b09879">KS_FREQX_PHASEZ</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a22cd0313e5ffabe8393f77745dba8d52"><div class="ttname"><a href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">KS_EPI::blipphaser</a></div><div class="ttdeci">KS_PHASER blipphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1688</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a2e3f5254967cadb9a41167c6fbf6743e"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">KS_SEQLOC::board</a></div><div class="ttdeci">int board</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:241</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_ad76a5ac226f0d25f70349ef83b5bc38a"><div class="ttname"><a href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">KS_EPI::zphaser</a></div><div class="ttdeci">KS_PHASER zphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1689</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8ad53040a098477496911fa2b1850a2d93"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ad53040a098477496911fa2b1850a2d93">KS_FREQZ_PHASEY</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a606fbf556e8a297aa1f68b098f6ac2a2"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">KS_SEQLOC::ampscale</a></div><div class="ttdeci">float ampscale</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:243</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8ae2467923eda691b22f68ca96bd7e1c1f"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ae2467923eda691b22f68ca96bd7e1c1f">KS_FREQZ_PHASEX</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8a9bc0b0996e2ac9c6a131209ae4c88629"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a9bc0b0996e2ac9c6a131209ae4c88629">KS_FREQY_PHASEX</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a></div><div class="ttdoc">typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:240</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8afa622a33dd2854dfe97a4056ecec5b67"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8afa622a33dd2854dfe97a4056ecec5b67">KS_FREQY_PHASEZ</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_abc81c5867684b6e31b65459ec9431269"><div class="ttname"><a href="struct_k_s___e_p_i.html#abc81c5867684b6e31b65459ec9431269">KS_EPI::readphaser</a></div><div class="ttdeci">KS_TRAP readphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1686</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ad01dd4f06fe226a502e872d4173ba7ae"><div class="ttname"><a href="_k_s_foundation_8h.html#ad01dd4f06fe226a502e872d4173ba7ae">KS_INIT_SEQLOC</a></div><div class="ttdeci">#define KS_INIT_SEQLOC</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:128</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_TRAP::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:437</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_ab3341eea000c35a438dfeb3cfc1da103"><div class="ttname"><a href="_k_s_foundation__common_8c.html#ab3341eea000c35a438dfeb3cfc1da103">ks_pg_trap</a></div><div class="ttdeci">STATUS ks_pg_trap(KS_TRAP *trap, KS_SEQLOC loc, KS_SEQ_CONTROL *ctrl)</div><div class="ttdoc">Places a KS_TRAP sequence object on a board at some position in the pulse sequence</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1212</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a14fed222bd2a857b8e1514f2e8e958c8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a14fed222bd2a857b8e1514f2e8e958c8">&#9670;&nbsp;</a></span>ks_pg_epi_rephasers()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_pg_epi_rephasers </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *&#160;</td>
          <td class="paramname"><em>epi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a>&#160;</td>
          <td class="paramname"><em>loc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>ctrl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Places out the rephasing gradients of a <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> object (<em>used by <a class="el" href="_k_s_foundation_8h.html#a804f4f4b870338386e1dea3a877f5bd2" title="Places out a KS_EPI object (EPI train including dephaser and rephaser gradients)">ks_pg_epi()</a></em>)</h4>
</p>
<p>This function is called internally by <a class="el" href="_k_s_foundation_8h.html#a804f4f4b870338386e1dea3a877f5bd2" title="Places out a KS_EPI object (EPI train including dephaser and rephaser gradients)">ks_pg_epi()</a> to place out the rephasing gradients of a <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> object. See <a class="el" href="_k_s_foundation_8h.html#a804f4f4b870338386e1dea3a877f5bd2" title="Places out a KS_EPI object (EPI train including dephaser and rephaser gradients)">ks_pg_epi()</a> for more details</p>
<p>For advanced usage of <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a>, it is possible to call ks_pg_epi_dephaser(), <a class="el" href="_k_s_foundation_8h.html#a0d7fe8d68dfb536eb3e903b1ab58e615" title="Places out the core part a KS_EPI object (used by ks_pg_epi())">ks_pg_epi_echo()</a> and <a class="el" href="_k_s_foundation_8h.html#aeaa0bf154295359cf8e84cedfbfdbe8b" title="Places out the rephasing gradients of a KS_EPI object (used by ks_pg_epi())">ks_pg_epi_rephasers()</a> separately instead of the single call to <a class="el" href="_k_s_foundation_8h.html#a804f4f4b870338386e1dea3a877f5bd2" title="Places out a KS_EPI object (EPI train including dephaser and rephaser gradients)">ks_pg_epi()</a>. This allows the dephasing and rephasing gradients to be detached from the core EPI readout part</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">epi</td><td>Pointer to a <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> sequence object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">loc</td><td><a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> struct to specify when to place the rephasers of the <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ctrl</td><td>Pointer to the <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> struct corresponding to the sequence module for this <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;                                                                             {</div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;  <span class="keywordtype">int</span> readaxis, blipaxis, sliceaxis;</div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;  <a class="code" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> tmploc = <a class="code" href="_k_s_foundation_8h.html#ad01dd4f06fe226a502e872d4173ba7ae">KS_INIT_SEQLOC</a>;</div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;</div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;  <span class="keywordflow">if</span> (!epi) { <span class="keywordflow">return</span> FAILURE; }</div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;</div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;  <span class="comment">/* loc.ampscale may only be +1 or -1 and will control the read polarity.</span></div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;<span class="comment">    The blip polarity is controlled in run time with ks_scan_epi_shotcontrol() */</span></div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> != 1.0 &amp;&amp; loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> != -1.0) {</div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_epi_rephasers: loc.ampscale must be +1 or -1 (controls read polarity)&quot;</span>);</div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;  }</div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;</div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;  loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> = RDN_GRD(loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>);</div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;</div><div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;  <span class="keywordflow">switch</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>) {</div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a6016c24e63f250c7e49d537c9b01dea1">KS_FREQX_PHASEY</a>:</div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;    readaxis = XGRAD; blipaxis = YGRAD; sliceaxis = ZGRAD; <span class="keywordflow">break</span>;</div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a9bc0b0996e2ac9c6a131209ae4c88629">KS_FREQY_PHASEX</a>:</div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;    readaxis = YGRAD; blipaxis = XGRAD; sliceaxis = ZGRAD; <span class="keywordflow">break</span>;</div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ae0b83b9295764e027abbf88b95b09879">KS_FREQX_PHASEZ</a>:</div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;    readaxis = XGRAD; blipaxis = ZGRAD; sliceaxis = YGRAD; <span class="keywordflow">break</span>;</div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ae2467923eda691b22f68ca96bd7e1c1f">KS_FREQZ_PHASEX</a>:</div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;    readaxis = ZGRAD; blipaxis = XGRAD; sliceaxis = YGRAD; <span class="keywordflow">break</span>;</div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8afa622a33dd2854dfe97a4056ecec5b67">KS_FREQY_PHASEZ</a>:</div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;    readaxis = YGRAD; blipaxis = ZGRAD; sliceaxis = XGRAD; <span class="keywordflow">break</span>;</div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ad53040a098477496911fa2b1850a2d93">KS_FREQZ_PHASEY</a>:</div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;    readaxis = ZGRAD; blipaxis = YGRAD; sliceaxis = XGRAD; <span class="keywordflow">break</span>;</div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;  <span class="keywordflow">default</span>:</div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_epi_rephasers: loc.board is not valid: %d&quot;</span>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>);</div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;  }</div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;</div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;  <span class="comment">/* read phaser (same KS_TRAP for DE/REphasing =&gt; 2 instances per EPI) */</span></div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;  <span class="keywordflow">if</span> (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#abc81c5867684b6e31b65459ec9431269">readphaser</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> &gt; 0) {</div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;    tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> = readaxis;</div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;    tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> = loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>;</div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;    <span class="keywordflow">if</span> (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a> % 2) <span class="comment">/* same polarity of rephaser as dephaser if odd ETL */</span></div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;      tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> = loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a>;</div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;      tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> = -loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a>;</div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#ab3341eea000c35a438dfeb3cfc1da103">ks_pg_trap</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#abc81c5867684b6e31b65459ec9431269">readphaser</a>, tmploc, ctrl) == FAILURE)</div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;      <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;  }</div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;</div><div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;  <span class="comment">/* blip phaser (same KS_PHASER for DE/REphasing =&gt; 2 instances per EPI) */</span></div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;  <span class="keywordflow">if</span> (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> &gt; 0) {</div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;    tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> = blipaxis;</div><div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;    tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> = loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>;</div><div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;    tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> = 1.0;</div><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#a82a797ba7a2ddcd48502d834c2a067b6">ks_pg_phaser</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>, tmploc, ctrl) == FAILURE)</div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;      <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;  }</div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;</div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;  <span class="comment">/* slice phaser (same KS_PHASER for DE/REphasing =&gt; 2 instances per EPI) */</span></div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;  <span class="keywordflow">if</span> (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> &gt; 0) {</div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;    tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> = sliceaxis;</div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;    tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> = loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>;</div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;    tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> = 1.0;</div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#a82a797ba7a2ddcd48502d834c2a067b6">ks_pg_phaser</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>, tmploc, ctrl) == FAILURE)</div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;      <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;  }</div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;</div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;} <span class="comment">/* ks_pg_epi_rephasers */</span></div><div class="ttc" id="_k_s_foundation__common_8c_html_a82a797ba7a2ddcd48502d834c2a067b6"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a82a797ba7a2ddcd48502d834c2a067b6">ks_pg_phaser</a></div><div class="ttdeci">STATUS ks_pg_phaser(KS_PHASER *phaser, KS_SEQLOC loc, KS_SEQ_CONTROL *ctrl)</div><div class="ttdoc">Places a KS_PHASER sequence object on a board at some position in the pulse sequence</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1412</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8a6016c24e63f250c7e49d537c9b01dea1"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a6016c24e63f250c7e49d537c9b01dea1">KS_FREQX_PHASEY</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">KS_PHASER::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1525</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a1910d262855b71da353ed0d07a6c7823"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">KS_SEQLOC::pos</a></div><div class="ttdeci">int pos</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:242</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8ae0b83b9295764e027abbf88b95b09879"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ae0b83b9295764e027abbf88b95b09879">KS_FREQX_PHASEZ</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a22cd0313e5ffabe8393f77745dba8d52"><div class="ttname"><a href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">KS_EPI::blipphaser</a></div><div class="ttdeci">KS_PHASER blipphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1688</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a2e3f5254967cadb9a41167c6fbf6743e"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">KS_SEQLOC::board</a></div><div class="ttdeci">int board</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:241</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_ad76a5ac226f0d25f70349ef83b5bc38a"><div class="ttname"><a href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">KS_EPI::zphaser</a></div><div class="ttdeci">KS_PHASER zphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1689</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8ad53040a098477496911fa2b1850a2d93"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ad53040a098477496911fa2b1850a2d93">KS_FREQZ_PHASEY</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a606fbf556e8a297aa1f68b098f6ac2a2"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">KS_SEQLOC::ampscale</a></div><div class="ttdeci">float ampscale</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:243</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8ae2467923eda691b22f68ca96bd7e1c1f"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ae2467923eda691b22f68ca96bd7e1c1f">KS_FREQZ_PHASEX</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a7582325a159d8ec89a4a4ba0fb89e9a9"><div class="ttname"><a href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">KS_EPI::etl</a></div><div class="ttdeci">int etl</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1690</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8a9bc0b0996e2ac9c6a131209ae4c88629"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a9bc0b0996e2ac9c6a131209ae4c88629">KS_FREQY_PHASEX</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a></div><div class="ttdoc">typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:240</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8afa622a33dd2854dfe97a4056ecec5b67"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8afa622a33dd2854dfe97a4056ecec5b67">KS_FREQY_PHASEZ</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_abc81c5867684b6e31b65459ec9431269"><div class="ttname"><a href="struct_k_s___e_p_i.html#abc81c5867684b6e31b65459ec9431269">KS_EPI::readphaser</a></div><div class="ttdeci">KS_TRAP readphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1686</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ad01dd4f06fe226a502e872d4173ba7ae"><div class="ttname"><a href="_k_s_foundation_8h.html#ad01dd4f06fe226a502e872d4173ba7ae">KS_INIT_SEQLOC</a></div><div class="ttdeci">#define KS_INIT_SEQLOC</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:128</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_TRAP::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:437</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_ab3341eea000c35a438dfeb3cfc1da103"><div class="ttname"><a href="_k_s_foundation__common_8c.html#ab3341eea000c35a438dfeb3cfc1da103">ks_pg_trap</a></div><div class="ttdeci">STATUS ks_pg_trap(KS_TRAP *trap, KS_SEQLOC loc, KS_SEQ_CONTROL *ctrl)</div><div class="ttdoc">Places a KS_TRAP sequence object on a board at some position in the pulse sequence</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1212</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a57a2d3f6e79ef085c2918652d22a3296"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a57a2d3f6e79ef085c2918652d22a3296">&#9670;&nbsp;</a></span>ks_pg_epi_echo()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_pg_epi_echo </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *&#160;</td>
          <td class="paramname"><em>epi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a>&#160;</td>
          <td class="paramname"><em>loc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>ctrl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Places out the core part a <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> object (<em>used by <a class="el" href="_k_s_foundation_8h.html#a804f4f4b870338386e1dea3a877f5bd2" title="Places out a KS_EPI object (EPI train including dephaser and rephaser gradients)">ks_pg_epi()</a></em>)</h4>
</p>
<p>This function is called internally by <a class="el" href="_k_s_foundation_8h.html#a804f4f4b870338386e1dea3a877f5bd2" title="Places out a KS_EPI object (EPI train including dephaser and rephaser gradients)">ks_pg_epi()</a> to place out the core part of a <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> object. The core part is the EPI train without leading dephaser gradients or trailing rephaser gradients. See <a class="el" href="_k_s_foundation_8h.html#a804f4f4b870338386e1dea3a877f5bd2" title="Places out a KS_EPI object (EPI train including dephaser and rephaser gradients)">ks_pg_epi()</a> for more details</p>
<p>For advanced usage of <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a>, it is possible to call ks_pg_epi_dephaser(), <a class="el" href="_k_s_foundation_8h.html#a0d7fe8d68dfb536eb3e903b1ab58e615" title="Places out the core part a KS_EPI object (used by ks_pg_epi())">ks_pg_epi_echo()</a> and <a class="el" href="_k_s_foundation_8h.html#aeaa0bf154295359cf8e84cedfbfdbe8b" title="Places out the rephasing gradients of a KS_EPI object (used by ks_pg_epi())">ks_pg_epi_rephasers()</a> separately instead of the single call to <a class="el" href="_k_s_foundation_8h.html#a804f4f4b870338386e1dea3a877f5bd2" title="Places out a KS_EPI object (EPI train including dephaser and rephaser gradients)">ks_pg_epi()</a>. This allows the dephasing and rephasing gradients to be detached from the core EPI readout part</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">epi</td><td>Pointer to a <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> sequence object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">loc</td><td><a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> struct to specify when to place the core part of the <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ctrl</td><td>Pointer to the <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> struct corresponding to the sequence module for this <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;                                                                        {</div><div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;  <span class="keywordtype">int</span> readaxis, blipaxis;</div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;  <a class="code" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> readloc, bliploc;</div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;</div><div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;  <span class="keywordflow">if</span> (!epi || !epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>) { <span class="keywordflow">return</span> FAILURE; }</div><div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;</div><div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;  <span class="comment">/* loc.ampscale may only be +1 or -1 and will control the read polarity.&lt;/</span></div><div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;<span class="comment">     The blip polarity is controlled in run time with ks_scan_epi_shotcontrol() */</span></div><div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> != 1.0 &amp;&amp; loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> != -1.0) {</div><div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_epi_echo: loc.ampscale must be +1 or -1 (controls read polarity)&quot;</span>);</div><div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;  }</div><div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;</div><div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;  loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> = RUP_GRD(loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>);</div><div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;</div><div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;  readloc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> = loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>;</div><div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;</div><div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;  <span class="keywordflow">switch</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>) {</div><div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a6016c24e63f250c7e49d537c9b01dea1">KS_FREQX_PHASEY</a>:</div><div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;    readaxis = XGRAD; blipaxis = YGRAD; <span class="keywordflow">break</span>;</div><div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a9bc0b0996e2ac9c6a131209ae4c88629">KS_FREQY_PHASEX</a>:</div><div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;    readaxis = YGRAD; blipaxis = XGRAD; <span class="keywordflow">break</span>;</div><div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ae0b83b9295764e027abbf88b95b09879">KS_FREQX_PHASEZ</a>:</div><div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;    readaxis = XGRAD; blipaxis = ZGRAD; <span class="keywordflow">break</span>;</div><div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ae2467923eda691b22f68ca96bd7e1c1f">KS_FREQZ_PHASEX</a>:</div><div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;    readaxis = ZGRAD; blipaxis = XGRAD; <span class="keywordflow">break</span>;</div><div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8afa622a33dd2854dfe97a4056ecec5b67">KS_FREQY_PHASEZ</a>:</div><div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;    readaxis = YGRAD; blipaxis = ZGRAD; <span class="keywordflow">break</span>;</div><div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ad53040a098477496911fa2b1850a2d93">KS_FREQZ_PHASEY</a>:</div><div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;    readaxis = ZGRAD; blipaxis = YGRAD; <span class="keywordflow">break</span>;</div><div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;  <span class="keywordflow">default</span>:</div><div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_epi_echo: field &#39;board&#39; in 2nd arg is not valid: %d&quot;</span>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>);</div><div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;  }</div><div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;</div><div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;  <span class="keywordflow">if</span> (fabs(loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a>) != 1.0) {</div><div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_epi_echo: field &#39;ampscale&#39; in 2nd arg must be +1 or -1 (controls read lobe polarity)&quot;</span>);</div><div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;  }</div><div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;</div><div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;</div><div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a>; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;</div><div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;    <span class="comment">/* read trapezoid */</span></div><div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;    readloc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> = readaxis;</div><div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;    readloc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> = (float) (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> % 2) ? -loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> : loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a>; <span class="comment">/* +1 or -1 */</span></div><div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#a9310a853d09f6db581a771a9b274f01d">ks_pg_readtrap</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>, readloc, ctrl) == FAILURE)</div><div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;      <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;</div><div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;    <span class="comment">/* phase encoding blip */</span></div><div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;    <span class="keywordflow">if</span> (i &lt; epi-&gt;etl - 1) {</div><div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;      <span class="comment">/* etl-1, since no blip after the last read lobe */</span></div><div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;      bliploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> = blipaxis;</div><div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;      bliploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> = RUP_GRD(readloc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> + epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> - epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#aaa0021ab8174eb7806de89d599769a9b">blip</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> / 2 + epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a035bb76f8cc944eff7afd9333c2688e3">read_spacing</a> / 2);</div><div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;      bliploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> = 1.0;</div><div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#ab3341eea000c35a438dfeb3cfc1da103">ks_pg_trap</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#aaa0021ab8174eb7806de89d599769a9b">blip</a>, bliploc, ctrl) == FAILURE)</div><div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;        <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;    }</div><div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;</div><div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;    <span class="comment">/* read_spacing is additional gap between lobes (normally 0) */</span></div><div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;    readloc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> += RUP_GRD(epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> + epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a035bb76f8cc944eff7afd9333c2688e3">read_spacing</a>);</div><div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;</div><div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;  } <span class="comment">/* etl */</span></div><div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;</div><div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;</div><div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;</div><div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;} <span class="comment">/* ks_pg_epi_echo */</span></div><div class="ttc" id="struct_k_s___e_p_i_html_aaa0021ab8174eb7806de89d599769a9b"><div class="ttname"><a href="struct_k_s___e_p_i.html#aaa0021ab8174eb7806de89d599769a9b">KS_EPI::blip</a></div><div class="ttdeci">KS_TRAP blip</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1687</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8a6016c24e63f250c7e49d537c9b01dea1"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a6016c24e63f250c7e49d537c9b01dea1">KS_FREQX_PHASEY</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a1910d262855b71da353ed0d07a6c7823"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">KS_SEQLOC::pos</a></div><div class="ttdeci">int pos</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:242</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8ae0b83b9295764e027abbf88b95b09879"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ae0b83b9295764e027abbf88b95b09879">KS_FREQX_PHASEZ</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a2e3f5254967cadb9a41167c6fbf6743e"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">KS_SEQLOC::board</a></div><div class="ttdeci">int board</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:241</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8ad53040a098477496911fa2b1850a2d93"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ad53040a098477496911fa2b1850a2d93">KS_FREQZ_PHASEY</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">KS_READTRAP::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1435</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a606fbf556e8a297aa1f68b098f6ac2a2"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">KS_SEQLOC::ampscale</a></div><div class="ttdeci">float ampscale</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:243</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8ae2467923eda691b22f68ca96bd7e1c1f"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ae2467923eda691b22f68ca96bd7e1c1f">KS_FREQZ_PHASEX</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a7582325a159d8ec89a4a4ba0fb89e9a9"><div class="ttname"><a href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">KS_EPI::etl</a></div><div class="ttdeci">int etl</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1690</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a03d42c44e323f3203fe5beabcefa47a5"><div class="ttname"><a href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">KS_EPI::read</a></div><div class="ttdeci">KS_READTRAP read</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1685</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8a9bc0b0996e2ac9c6a131209ae4c88629"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a9bc0b0996e2ac9c6a131209ae4c88629">KS_FREQY_PHASEX</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a></div><div class="ttdoc">typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:240</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">KS_TRAP::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:432</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8afa622a33dd2854dfe97a4056ecec5b67"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8afa622a33dd2854dfe97a4056ecec5b67">KS_FREQY_PHASEZ</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a035bb76f8cc944eff7afd9333c2688e3"><div class="ttname"><a href="struct_k_s___e_p_i.html#a035bb76f8cc944eff7afd9333c2688e3">KS_EPI::read_spacing</a></div><div class="ttdeci">int read_spacing</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1691</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_TRAP::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:437</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a9310a853d09f6db581a771a9b274f01d"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a9310a853d09f6db581a771a9b274f01d">ks_pg_readtrap</a></div><div class="ttdeci">STATUS ks_pg_readtrap(KS_READTRAP *readtrap, KS_SEQLOC loc, KS_SEQ_CONTROL *ctrl)</div><div class="ttdoc">Places a KS_READTRAP sequence object on a board at some position in the pulse sequence</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1529</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_ab3341eea000c35a438dfeb3cfc1da103"><div class="ttname"><a href="_k_s_foundation__common_8c.html#ab3341eea000c35a438dfeb3cfc1da103">ks_pg_trap</a></div><div class="ttdeci">STATUS ks_pg_trap(KS_TRAP *trap, KS_SEQLOC loc, KS_SEQ_CONTROL *ctrl)</div><div class="ttdoc">Places a KS_TRAP sequence object on a board at some position in the pulse sequence</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1212</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a491c005da937fd4ae3469a26ce87fabb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a491c005da937fd4ae3469a26ce87fabb">&#9670;&nbsp;</a></span>ks_pg_epi()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_pg_epi </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *&#160;</td>
          <td class="paramname"><em>epi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a>&#160;</td>
          <td class="paramname"><em>loc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>ctrl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Places out a <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> object (EPI train including dephaser and rephaser gradients)</h4>
</p>
<p>This function should be called in the <code>@pg</code> section to place out a <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> sequence object that creates an EPI readout including dephaser and rephaser gradients. The moments of all trapezoids in the <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> object sum to zero on the two axes the <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> object is placed on. The <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> object is to be placed on two out of three gradients, why special values for the field <code>loc.board</code> must be used. The value should state which logical board (X,Y or Z) that should be used for the readout lobes (FREQ) and which logical board (X, Y or Z) that should be used for the blips (PHASE). One example is KS_FREQX_PHASEY, which will put the EPI readout lobes on XGRAD and the phase encoding blips on YGRAD</p>
<p>The same <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> object can be placed out 16 times per sequence. This limitation is due to the hard limitation on the number of echoes (i.e. different k-spaces per image plane and image volume) that can be acquired per scan. Each time an instance of the <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> object is placed out using <a class="el" href="_k_s_foundation_8h.html#a804f4f4b870338386e1dea3a877f5bd2" title="Places out a KS_EPI object (EPI train including dephaser and rephaser gradients)">ks_pg_epi()</a>, the second argument (the <a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> struct) should be modified:</p><ul>
<li><code>.board</code>: Choose between <code>KS_FREQX_PHASEY</code>, <code>KS_FREQY_PHASEX</code>, <code>KS_FREQX_PHASEZ</code>, <code>KS_FREQZ_PHASEX</code>, <code>KS_FREQY_PHASEZ</code>, <code>KS_FREQZ_PHASEY</code></li>
<li><code>.pos</code>: Absolute time in [us] of the start of the first dephaser gradient</li>
<li><code>.ampscale</code>: For <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> objects, valid values are only +1.0 and -1.0, and this will control the polarity of the first readout gradient. This is rarely needed, and 1.0 should be the standard choice as this does only affect gradient delays and Nyquist ghosting, not the geometric distortion direction.</li>
</ul>
<p>The <em>sign</em> of the EPI blips will control the direction of the geometric distortions, and this is <em>not</em> done via <code>.ampscale</code> but in run-time using <a class="el" href="_k_s_foundation_8h.html#a0d83cf730d82612a87abc0f024bea336" title="Changes the gradient state of a KS_EPI object for the given slice information">ks_scan_epi_shotcontrol()</a></p>
<p>For advanced usage of <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a>, it is possible to call ks_pg_epi_dephaser(), <a class="el" href="_k_s_foundation_8h.html#a0d7fe8d68dfb536eb3e903b1ab58e615" title="Places out the core part a KS_EPI object (used by ks_pg_epi())">ks_pg_epi_echo()</a> and <a class="el" href="_k_s_foundation_8h.html#aeaa0bf154295359cf8e84cedfbfdbe8b" title="Places out the rephasing gradients of a KS_EPI object (used by ks_pg_epi())">ks_pg_epi_rephasers()</a> separately instead of the single call to <a class="el" href="_k_s_foundation_8h.html#a804f4f4b870338386e1dea3a877f5bd2" title="Places out a KS_EPI object (EPI train including dephaser and rephaser gradients)">ks_pg_epi()</a>. This allows the dephasing and rephasing gradients to be detached from the core EPI readout part</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">epi</td><td>Pointer to a <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> sequence object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">loc</td><td><a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> struct to specify when to place the core part of the <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ctrl</td><td>Pointer to the <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> struct corresponding to the sequence module for this <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;                                                                   {</div><div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;  <a class="code" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> tmploc = loc;</div><div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;</div><div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;  <span class="comment">/* loc.ampscale may only be +1 or -1 and will control the read polarity.</span></div><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;<span class="comment">    The blip polarity is controlled in run time with ks_scan_epi_shotcontrol() */</span></div><div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> != 1.0 &amp;&amp; loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> != -1.0) {</div><div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_epi: loc.ampscale must be +1 or -1 (controls read polarity)&quot;</span>);</div><div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;  }</div><div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;</div><div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#a5f4f5dedf466061d2d764c1a11e2b06c">ks_pg_epi_dephasers</a>(epi, tmploc, ctrl) == FAILURE)</div><div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;</div><div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;  tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> += IMax(3, epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#abc81c5867684b6e31b65459ec9431269">readphaser</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>, epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>, epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>);</div><div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;</div><div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#a57a2d3f6e79ef085c2918652d22a3296">ks_pg_epi_echo</a>(epi, tmploc, ctrl) == FAILURE) <span class="comment">/* main epi train (w/o DE/REphasers) */</span></div><div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;</div><div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;  tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> += epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> * epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a>;</div><div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#a14fed222bd2a857b8e1514f2e8e958c8">ks_pg_epi_rephasers</a>(epi, tmploc, ctrl) == FAILURE)</div><div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;</div><div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;} <span class="comment">/* ks_pg_epi */</span></div><div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">KS_PHASER::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1525</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a1910d262855b71da353ed0d07a6c7823"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">KS_SEQLOC::pos</a></div><div class="ttdeci">int pos</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:242</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a57a2d3f6e79ef085c2918652d22a3296"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a57a2d3f6e79ef085c2918652d22a3296">ks_pg_epi_echo</a></div><div class="ttdeci">STATUS ks_pg_epi_echo(KS_EPI *epi, KS_SEQLOC loc, KS_SEQ_CONTROL *ctrl)</div><div class="ttdoc">Places out the core part a KS_EPI object (used by ks_pg_epi())</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2384</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a22cd0313e5ffabe8393f77745dba8d52"><div class="ttname"><a href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">KS_EPI::blipphaser</a></div><div class="ttdeci">KS_PHASER blipphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1688</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_ad76a5ac226f0d25f70349ef83b5bc38a"><div class="ttname"><a href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">KS_EPI::zphaser</a></div><div class="ttdeci">KS_PHASER zphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1689</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">KS_READTRAP::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1435</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a606fbf556e8a297aa1f68b098f6ac2a2"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">KS_SEQLOC::ampscale</a></div><div class="ttdeci">float ampscale</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:243</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a7582325a159d8ec89a4a4ba0fb89e9a9"><div class="ttname"><a href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">KS_EPI::etl</a></div><div class="ttdeci">int etl</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1690</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a03d42c44e323f3203fe5beabcefa47a5"><div class="ttname"><a href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">KS_EPI::read</a></div><div class="ttdeci">KS_READTRAP read</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1685</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a5f4f5dedf466061d2d764c1a11e2b06c"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a5f4f5dedf466061d2d764c1a11e2b06c">ks_pg_epi_dephasers</a></div><div class="ttdeci">STATUS ks_pg_epi_dephasers(KS_EPI *epi, KS_SEQLOC loc, KS_SEQ_CONTROL *ctrl)</div><div class="ttdoc">Places out the dephasing gradients of a KS_EPI object (used by ks_pg_epi())</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2247</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a></div><div class="ttdoc">typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:240</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_abc81c5867684b6e31b65459ec9431269"><div class="ttname"><a href="struct_k_s___e_p_i.html#abc81c5867684b6e31b65459ec9431269">KS_EPI::readphaser</a></div><div class="ttdeci">KS_TRAP readphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1686</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_TRAP::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:437</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a14fed222bd2a857b8e1514f2e8e958c8"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a14fed222bd2a857b8e1514f2e8e958c8">ks_pg_epi_rephasers</a></div><div class="ttdeci">STATUS ks_pg_epi_rephasers(KS_EPI *epi, KS_SEQLOC loc, KS_SEQ_CONTROL *ctrl)</div><div class="ttdoc">Places out the rephasing gradients of a KS_EPI object (used by ks_pg_epi())</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2316</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a43efb5f9eb84e0ace408cd1a74825f3f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a43efb5f9eb84e0ace408cd1a74825f3f">&#9670;&nbsp;</a></span>ks_pg_mod_fse_rfpulse_structs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_pg_mod_fse_rfpulse_structs </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *&#160;</td>
          <td class="paramname"><em>rf1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *&#160;</td>
          <td class="paramname"><em>rf2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *&#160;</td>
          <td class="paramname"><em>rf3</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double *&#160;</td>
          <td class="paramname"><em>flip_angles</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>etl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;                                                  {</div><div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;</div><div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;  <span class="keywordtype">float</span> SAR_scale_1 = 0.0;</div><div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;  <span class="keywordtype">float</span> SAR_scale_2 = 0.0;</div><div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;  <span class="keywordtype">float</span> SAR_scale_3 = 0.0;</div><div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;</div><div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;  SAR_scale_1 = pow(flip_angles[0] / rf1-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a7ab9fec3ad0848d2dff5db7279f1a806">flip</a>, 2.0);</div><div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;  SAR_scale_2 = pow(flip_angles[1] / rf2-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a7ab9fec3ad0848d2dff5db7279f1a806">flip</a>, 2.0);</div><div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 2; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; etl; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;    SAR_scale_3 += pow(flip_angles[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] / rf3-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a7ab9fec3ad0848d2dff5db7279f1a806">flip</a>, 2.0);</div><div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;  }</div><div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;  SAR_scale_3 /= etl - 2;</div><div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;</div><div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;  rf1-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.effwidth *= SAR_scale_1;</div><div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;  rf1-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.max_rms_b1 *= sqrt(SAR_scale_1);</div><div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;  rf1-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.abswidth *= sqrt(SAR_scale_1);</div><div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;</div><div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;  rf2-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.effwidth *= SAR_scale_2;</div><div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;  rf2-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.max_rms_b1 *= sqrt(SAR_scale_2);</div><div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;  rf2-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.abswidth *= sqrt(SAR_scale_2);</div><div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;</div><div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;  rf3-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.effwidth *= SAR_scale_3;</div><div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;  rf3-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.max_rms_b1 *= sqrt(SAR_scale_3);</div><div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;  rf3-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.abswidth *= sqrt(SAR_scale_3);</div><div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;</div><div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;} <span class="comment">/* ks_pg_mod_fse_rfpulse_structs */</span></div><div class="ttc" id="struct_k_s___r_f_html_ae183c3e4095d1c6d14b3d59a0da97928"><div class="ttname"><a href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">KS_RF::rfpulse</a></div><div class="ttdeci">RF_PULSE rfpulse</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:797</div></div>
<div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a7ab9fec3ad0848d2dff5db7279f1a806"><div class="ttname"><a href="struct_k_s___r_f.html#a7ab9fec3ad0848d2dff5db7279f1a806">KS_RF::flip</a></div><div class="ttdeci">float flip</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:789</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_adeab1cc34f1a7f20f41e8825d849981e"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">KS_SELRF::rf</a></div><div class="ttdeci">KS_RF rf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1334</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="adee331638310d0a0ed1c726c02051e1b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adee331638310d0a0ed1c726c02051e1b">&#9670;&nbsp;</a></span>ks_pg_fse_flip_angle_taperoff()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_pg_fse_flip_angle_taperoff </td>
          <td>(</td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>flip_angles</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>etl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>flip1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>flip2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>flip3</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>target_flip</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>start_middle</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;                                                       {</div><div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;</div><div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;</div><div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;  flip_angles[0] = flip1;</div><div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;  flip_angles[1] = flip2;</div><div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 2; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; etl; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;    flip_angles[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] = flip3;</div><div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;  }</div><div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;</div><div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;  <span class="keywordflow">if</span> (flip3 &lt;= target_flip || etl &lt; 5) {</div><div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;    <span class="comment">/* flip3 must be larger than target_flip and etl must be larger than 4 */</span></div><div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;    <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;  }</div><div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;</div><div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;  <span class="comment">/* after half of the echo train or third pulse, ramp down flip angles to last_flip */</span></div><div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;  <span class="keywordtype">double</span> first_flip = flip3;</div><div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;  <span class="keywordtype">double</span> last_flip = target_flip;</div><div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;  <span class="keywordtype">int</span> start_pulse = start_middle ? etl/2 : 2;</div><div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = start_pulse; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; etl; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;    flip_angles[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] = first_flip + (((last_flip - first_flip)/(etl - start_pulse - 1)) * (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> - start_pulse));</div><div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;  }</div><div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;</div><div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;</div><div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;} <span class="comment">/* ks_pg_fse_flip_angle_taperoff */</span></div><div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad4f6f11e79e686edc745fb372307da07"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad4f6f11e79e686edc745fb372307da07">&#9670;&nbsp;</a></span>ks_instancereset_trap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_instancereset_trap </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> *&#160;</td>
          <td class="paramname"><em>trap</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Resets the usage counters on TGT for a <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> sequence object (<em>advanced use</em>)</h4>
</p>
<p>This function is for <em>advanced use</em> where a single <em>sequence generating</em> function is used in parallel in multiple sequences (i.e. in different SEQLENGTH()). This should be called after calling <a class="el" href="_k_s_foundation_8h.html#a8d73c466af30e53064824044894067a9" title="Create a copy of any sequence object with a KS_BASE as first member">ks_copy_and_reset_obj()</a></p>
<p>The function sets <code>.base.ngenerated</code> to 0 (counter for number of times placed out on TGT), and sets <code>.wfpulse</code> and <code>.wfi</code> to NULL to trigger the allocation of new hardware memory, before running the <em>sequence generating</em> function again.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">trap</td><td>Pointer to a <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> sequence object </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;                                          {</div><div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;  <span class="keywordflow">if</span> (!trap) { <span class="keywordflow">return</span>; }</div><div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;</div><div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;  trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a> = 0;</div><div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;  trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a> = NULL;</div><div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;  trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">wfi</a> = NULL;</div><div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;}</div><div class="ttc" id="struct_k_s___t_r_a_p_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">KS_TRAP::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:431</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a15be3edad342a49398ca841c2745dc9e"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">KS_TRAP::wfi</a></div><div class="ttdeci">KS_WFINSTANCE * wfi</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:441</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a9428be182c75f60d1b4e6fe36c888afa"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">KS_TRAP::wfpulse</a></div><div class="ttdeci">WF_PULSE ** wfpulse</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:440</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6ef78e75e7d598cbd08cf10cb31f0220"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6ef78e75e7d598cbd08cf10cb31f0220">&#9670;&nbsp;</a></span>ks_instancereset_wave()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_instancereset_wave </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;                                          {</div><div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;  <span class="keywordflow">if</span> (!wave) { <span class="keywordflow">return</span>; }</div><div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;</div><div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;  wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a> = 0;</div><div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;  wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a> = NULL;</div><div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;  wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a> = NULL;</div><div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;}</div><div class="ttc" id="struct_k_s___w_a_v_e_html_a15be3edad342a49398ca841c2745dc9e"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">KS_WAVE::wfi</a></div><div class="ttdeci">KS_WFINSTANCE * wfi</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:524</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a9428be182c75f60d1b4e6fe36c888afa"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">KS_WAVE::wfpulse</a></div><div class="ttdeci">WF_PULSE ** wfpulse</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:523</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">KS_WAVE::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:515</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aad9c2e7d88da5870c5326fff22fef2b8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aad9c2e7d88da5870c5326fff22fef2b8">&#9670;&nbsp;</a></span>ks_instancereset_wait()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_instancereset_wait </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___w_a_i_t.html">KS_WAIT</a> *&#160;</td>
          <td class="paramname"><em>wait</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Resets the usage counters on TGT for a <a class="el" href="struct_k_s___w_a_i_t.html" title="Core sequence object that adds wait periods in the pulse sequence (see ks_eval_wait(), ks_pg_wait()). Can be placed on any sequence board">KS_WAIT</a> sequence object (<em>advanced use</em>)</h4>
</p>
<p>This function is for <em>advanced use</em> where a single <em>sequence generating</em> function is used in parallel in multiple sequences (i.e. in different SEQLENGTH()). This should be called after calling <a class="el" href="_k_s_foundation_8h.html#a8d73c466af30e53064824044894067a9" title="Create a copy of any sequence object with a KS_BASE as first member">ks_copy_and_reset_obj()</a></p>
<p>The function sets <code>.base.ngenerated</code> to 0 (counter for number of times placed out on TGT), and sets <code>.wfpulse</code> and <code>.wfi</code> to NULL to trigger the allocation of new hardware memory, before running the <em>sequence generating</em> function again.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">wait</td><td>Pointer to a <a class="el" href="struct_k_s___w_a_i_t.html" title="Core sequence object that adds wait periods in the pulse sequence (see ks_eval_wait(), ks_pg_wait()). Can be placed on any sequence board">KS_WAIT</a> sequence object </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;                                          {</div><div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;  <span class="keywordflow">if</span> (!wait) { <span class="keywordflow">return</span>; }</div><div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;</div><div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;  wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a> = 0;</div><div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;  wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#aeb311c3018cbffb0db0463280f3c4cd5">wfpulse</a> = NULL;</div><div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;  wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a15be3edad342a49398ca841c2745dc9e">wfi</a> = NULL;</div><div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;}</div><div class="ttc" id="struct_k_s___w_a_i_t_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">KS_WAIT::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:309</div></div>
<div class="ttc" id="struct_k_s___w_a_i_t_html_a15be3edad342a49398ca841c2745dc9e"><div class="ttname"><a href="struct_k_s___w_a_i_t.html#a15be3edad342a49398ca841c2745dc9e">KS_WAIT::wfi</a></div><div class="ttdeci">KS_WFINSTANCE * wfi</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:314</div></div>
<div class="ttc" id="struct_k_s___w_a_i_t_html_aeb311c3018cbffb0db0463280f3c4cd5"><div class="ttname"><a href="struct_k_s___w_a_i_t.html#aeb311c3018cbffb0db0463280f3c4cd5">KS_WAIT::wfpulse</a></div><div class="ttdeci">WF_PULSE * wfpulse</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:313</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ace40879ab8ead831e2cb4813d0c129c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ace40879ab8ead831e2cb4813d0c129c7">&#9670;&nbsp;</a></span>ks_instancereset_phaser()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_instancereset_phaser </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *&#160;</td>
          <td class="paramname"><em>phaser</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Resets the usage counters on TGT for a <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> sequence object (<em>advanced use</em>)</h4>
</p>
<p>This function is for <em>advanced use</em> where a single <em>sequence generating</em> function is used in parallel in multiple sequences (i.e. in different SEQLENGTH()). This should be called after calling <a class="el" href="_k_s_foundation_8h.html#a8d73c466af30e53064824044894067a9" title="Create a copy of any sequence object with a KS_BASE as first member">ks_copy_and_reset_obj()</a></p>
<p>The function sets <code>.base.ngenerated</code> to 0 (counter for number of times placed out on TGT), and sets <code>.wfpulse</code> and <code>.wfi</code> to NULL to trigger the allocation of new hardware memory, before running the <em>sequence generating</em> function again.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">phaser</td><td>Pointer to a <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> sequence object </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;                                                {</div><div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;  <span class="keywordflow">if</span> (!phaser) { <span class="keywordflow">return</span>; }</div><div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;</div><div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#ad4f6f11e79e686edc745fb372307da07">ks_instancereset_trap</a>(&amp;phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>);</div><div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;}</div><div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">KS_PHASER::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1525</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_ad4f6f11e79e686edc745fb372307da07"><div class="ttname"><a href="_k_s_foundation__common_8c.html#ad4f6f11e79e686edc745fb372307da07">ks_instancereset_trap</a></div><div class="ttdeci">void ks_instancereset_trap(KS_TRAP *trap)</div><div class="ttdoc">Resets the usage counters on TGT for a KS_TRAP sequence object (advanced use)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2548</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aeb15e81750dea5de7e46585faf05cdc7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeb15e81750dea5de7e46585faf05cdc7">&#9670;&nbsp;</a></span>ks_instancereset_readtrap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_instancereset_readtrap </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a> *&#160;</td>
          <td class="paramname"><em>readtrap</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Resets the usage counters on TGT for a <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> sequence object (<em>advanced use</em>)</h4>
</p>
<p>This function is for <em>advanced use</em> where a single <em>sequence generating</em> function is used in parallel in multiple sequences (i.e. in different SEQLENGTH()). This should be called after calling <a class="el" href="_k_s_foundation_8h.html#a8d73c466af30e53064824044894067a9" title="Create a copy of any sequence object with a KS_BASE as first member">ks_copy_and_reset_obj()</a></p>
<p>The function sets <code>.base.ngenerated</code> to 0 (counter for number of times placed out on TGT), and sets <code>.wfpulse</code> and <code>.wfi</code> to NULL to trigger the allocation of new hardware memory, before running the <em>sequence generating</em> function again.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">readtrap</td><td>Pointer to a <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> sequence object </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;                                                  {</div><div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;  <span class="keywordflow">if</span> (!read) { <span class="keywordflow">return</span>; }</div><div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;</div><div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;  read-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a> = 0;</div><div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;  read-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a0e0bae3aa47ae5b8aae488fa0eb920ce">echo</a> = NULL;</div><div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;</div><div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#ad4f6f11e79e686edc745fb372307da07">ks_instancereset_trap</a>(&amp;read-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>);</div><div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#ad4f6f11e79e686edc745fb372307da07">ks_instancereset_trap</a>(&amp;read-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#abd9ff216626c3fd76322a2a56dc606cc">omega</a>);</div><div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;}</div><div class="ttc" id="struct_k_s___r_e_a_d_html_a0e0bae3aa47ae5b8aae488fa0eb920ce"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a0e0bae3aa47ae5b8aae488fa0eb920ce">KS_READ::echo</a></div><div class="ttdeci">WF_PULSE * echo</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:587</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">KS_READTRAP::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1435</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">KS_READ::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:581</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_abd9ff216626c3fd76322a2a56dc606cc"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#abd9ff216626c3fd76322a2a56dc606cc">KS_READTRAP::omega</a></div><div class="ttdeci">KS_TRAP omega</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1436</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_ad4f6f11e79e686edc745fb372307da07"><div class="ttname"><a href="_k_s_foundation__common_8c.html#ad4f6f11e79e686edc745fb372307da07">ks_instancereset_trap</a></div><div class="ttdeci">void ks_instancereset_trap(KS_TRAP *trap)</div><div class="ttdoc">Resets the usage counters on TGT for a KS_TRAP sequence object (advanced use)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2548</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_ac359c54a7c5f9e9a94105b3c0d0be9ea"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">KS_READTRAP::acq</a></div><div class="ttdeci">KS_READ acq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1423</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7f71a623c82d573e0418c143e8ecec56"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7f71a623c82d573e0418c143e8ecec56">&#9670;&nbsp;</a></span>ks_instancereset_rf()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_instancereset_rf </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_f.html">KS_RF</a> *&#160;</td>
          <td class="paramname"><em>rf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Resets the usage counters on TGT for a <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> sequence object (<em>advanced use</em>)</h4>
</p>
<p>This function is for <em>advanced use</em> where a single <em>sequence generating</em> function is used in parallel in multiple sequences (i.e. in different SEQLENGTH()). This should be called after calling <a class="el" href="_k_s_foundation_8h.html#a8d73c466af30e53064824044894067a9" title="Create a copy of any sequence object with a KS_BASE as first member">ks_copy_and_reset_obj()</a></p>
<p>The function sets <code>.base.ngenerated</code> to 0 (counter for number of times placed out on TGT), and sets <code>.wfpulse</code> and <code>.wfi</code> to NULL to trigger the allocation of new hardware memory, before running the <em>sequence generating</em> function again.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">rf</td><td>Pointer to a <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> sequence object </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;                                    {</div><div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;  <span class="keywordflow">if</span> (!rf) { <span class="keywordflow">return</span>; }</div><div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;</div><div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#a6ef78e75e7d598cbd08cf10cb31f0220">ks_instancereset_wave</a>(&amp;rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>);</div><div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#a6ef78e75e7d598cbd08cf10cb31f0220">ks_instancereset_wave</a>(&amp;rf-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>);</div><div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#a6ef78e75e7d598cbd08cf10cb31f0220">ks_instancereset_wave</a>(&amp;rf-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>);</div><div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;</div><div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;}</div><div class="ttc" id="struct_k_s___r_f_html_aecd8b68c159a31a28e2a2ec003b593e2"><div class="ttname"><a href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">KS_RF::thetawave</a></div><div class="ttdeci">KS_WAVE thetawave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:800</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a2a9b610a78cdae3ac8ef682bd34f7e0d"><div class="ttname"><a href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">KS_RF::rfwave</a></div><div class="ttdeci">KS_WAVE rfwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:798</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a6ef78e75e7d598cbd08cf10cb31f0220"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a6ef78e75e7d598cbd08cf10cb31f0220">ks_instancereset_wave</a></div><div class="ttdeci">void ks_instancereset_wave(KS_WAVE *wave)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2557</div></div>
<div class="ttc" id="struct_k_s___r_f_html_aa283d0a503cfda1c25da9f9b9a0d8b1c"><div class="ttname"><a href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">KS_RF::omegawave</a></div><div class="ttdeci">KS_WAVE omegawave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:799</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ace7a321746aada2f87551d05f5a4a77f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ace7a321746aada2f87551d05f5a4a77f">&#9670;&nbsp;</a></span>ks_instancereset_selrf()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_instancereset_selrf </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *&#160;</td>
          <td class="paramname"><em>selrf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Resets the usage counters on TGT for a <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> sequence object (<em>advanced use</em>)</h4>
</p>
<p>This function is for <em>advanced use</em> where a single <em>sequence generating</em> function is used in parallel in multiple sequences (i.e. in different SEQLENGTH()). This should be called after calling <a class="el" href="_k_s_foundation_8h.html#a8d73c466af30e53064824044894067a9" title="Create a copy of any sequence object with a KS_BASE as first member">ks_copy_and_reset_obj()</a></p>
<p>The function sets <code>.base.ngenerated</code> to 0 (counter for number of times placed out on TGT), and sets <code>.wfpulse</code> and <code>.wfi</code> to NULL to trigger the allocation of new hardware memory, before running the <em>sequence generating</em> function again.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">selrf</td><td>Pointer to a <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> sequence object </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;                                             {</div><div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;  <span class="keywordflow">if</span> (!selrf) { <span class="keywordflow">return</span>; }</div><div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;</div><div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#a7f71a623c82d573e0418c143e8ecec56">ks_instancereset_rf</a>(&amp;selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>);</div><div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#ad4f6f11e79e686edc745fb372307da07">ks_instancereset_trap</a>(&amp;selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a35145c98c931f54a8bf2b97edfb3e4c6">pregrad</a>);</div><div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#ad4f6f11e79e686edc745fb372307da07">ks_instancereset_trap</a>(&amp;selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#af33317a98ade78e3ac252b33cbb794af">grad</a>);</div><div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#ad4f6f11e79e686edc745fb372307da07">ks_instancereset_trap</a>(&amp;selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a5ac7ed86029ab647ba0c9a656ae9fb37">postgrad</a>);</div><div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;</div><div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#a6ef78e75e7d598cbd08cf10cb31f0220">ks_instancereset_wave</a>(&amp;selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>);</div><div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;</div><div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;}</div><div class="ttc" id="struct_k_s___s_e_l_r_f_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#af33317a98ade78e3ac252b33cbb794af">KS_SELRF::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1340</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_a607347e9c1c7a9eef21fff556faccc3f"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">KS_SELRF::gradwave</a></div><div class="ttdeci">KS_WAVE gradwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1342</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_a35145c98c931f54a8bf2b97edfb3e4c6"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#a35145c98c931f54a8bf2b97edfb3e4c6">KS_SELRF::pregrad</a></div><div class="ttdeci">KS_TRAP pregrad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1339</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_adeab1cc34f1a7f20f41e8825d849981e"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">KS_SELRF::rf</a></div><div class="ttdeci">KS_RF rf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1334</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a6ef78e75e7d598cbd08cf10cb31f0220"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a6ef78e75e7d598cbd08cf10cb31f0220">ks_instancereset_wave</a></div><div class="ttdeci">void ks_instancereset_wave(KS_WAVE *wave)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2557</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a7f71a623c82d573e0418c143e8ecec56"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a7f71a623c82d573e0418c143e8ecec56">ks_instancereset_rf</a></div><div class="ttdeci">void ks_instancereset_rf(KS_RF *rf)</div><div class="ttdoc">Resets the usage counters on TGT for a KS_RF sequence object (advanced use)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2590</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_a5ac7ed86029ab647ba0c9a656ae9fb37"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#a5ac7ed86029ab647ba0c9a656ae9fb37">KS_SELRF::postgrad</a></div><div class="ttdeci">KS_TRAP postgrad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1341</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_ad4f6f11e79e686edc745fb372307da07"><div class="ttname"><a href="_k_s_foundation__common_8c.html#ad4f6f11e79e686edc745fb372307da07">ks_instancereset_trap</a></div><div class="ttdeci">void ks_instancereset_trap(KS_TRAP *trap)</div><div class="ttdoc">Resets the usage counters on TGT for a KS_TRAP sequence object (advanced use)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2548</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3944bb2736d992be3c1b512d8dfb0ce8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3944bb2736d992be3c1b512d8dfb0ce8">&#9670;&nbsp;</a></span>ks_instancereset_epi()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_instancereset_epi </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *&#160;</td>
          <td class="paramname"><em>epi</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Resets the usage counters on TGT for a <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> sequence object (<em>advanced use</em>)</h4>
</p>
<p>This function is for <em>advanced use</em> where a single <em>sequence generating</em> function is used in parallel in multiple sequences (i.e. in different SEQLENGTH()). This should be called after calling <a class="el" href="_k_s_foundation_8h.html#a8d73c466af30e53064824044894067a9" title="Create a copy of any sequence object with a KS_BASE as first member">ks_copy_and_reset_obj()</a></p>
<p>The function sets <code>.base.ngenerated</code> to 0 (counter for number of times placed out on TGT), and sets <code>.wfpulse</code> and <code>.wfi</code> to NULL to trigger the allocation of new hardware memory, before running the <em>sequence generating</em> function again.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">epi</td><td>Pointer to a <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> sequence object </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;                                       {</div><div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;  <span class="keywordflow">if</span> (!epi) { <span class="keywordflow">return</span>; }</div><div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;</div><div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#aeb15e81750dea5de7e46585faf05cdc7">ks_instancereset_readtrap</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>);</div><div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#ad4f6f11e79e686edc745fb372307da07">ks_instancereset_trap</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#abc81c5867684b6e31b65459ec9431269">readphaser</a>);</div><div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#ad4f6f11e79e686edc745fb372307da07">ks_instancereset_trap</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#aaa0021ab8174eb7806de89d599769a9b">blip</a>);</div><div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#ace40879ab8ead831e2cb4813d0c129c7">ks_instancereset_phaser</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>);</div><div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;}</div><div class="ttc" id="struct_k_s___e_p_i_html_aaa0021ab8174eb7806de89d599769a9b"><div class="ttname"><a href="struct_k_s___e_p_i.html#aaa0021ab8174eb7806de89d599769a9b">KS_EPI::blip</a></div><div class="ttdeci">KS_TRAP blip</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1687</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_ace40879ab8ead831e2cb4813d0c129c7"><div class="ttname"><a href="_k_s_foundation__common_8c.html#ace40879ab8ead831e2cb4813d0c129c7">ks_instancereset_phaser</a></div><div class="ttdeci">void ks_instancereset_phaser(KS_PHASER *phaser)</div><div class="ttdoc">Resets the usage counters on TGT for a KS_PHASER sequence object (advanced use)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2574</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a22cd0313e5ffabe8393f77745dba8d52"><div class="ttname"><a href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">KS_EPI::blipphaser</a></div><div class="ttdeci">KS_PHASER blipphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1688</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_aeb15e81750dea5de7e46585faf05cdc7"><div class="ttname"><a href="_k_s_foundation__common_8c.html#aeb15e81750dea5de7e46585faf05cdc7">ks_instancereset_readtrap</a></div><div class="ttdeci">void ks_instancereset_readtrap(KS_READTRAP *read)</div><div class="ttdoc">Resets the usage counters on TGT for a KS_READTRAP sequence object (advanced use)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2580</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a03d42c44e323f3203fe5beabcefa47a5"><div class="ttname"><a href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">KS_EPI::read</a></div><div class="ttdeci">KS_READTRAP read</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1685</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_abc81c5867684b6e31b65459ec9431269"><div class="ttname"><a href="struct_k_s___e_p_i.html#abc81c5867684b6e31b65459ec9431269">KS_EPI::readphaser</a></div><div class="ttdeci">KS_TRAP readphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1686</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_ad4f6f11e79e686edc745fb372307da07"><div class="ttname"><a href="_k_s_foundation__common_8c.html#ad4f6f11e79e686edc745fb372307da07">ks_instancereset_trap</a></div><div class="ttdeci">void ks_instancereset_trap(KS_TRAP *trap)</div><div class="ttdoc">Resets the usage counters on TGT for a KS_TRAP sequence object (advanced use)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2548</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7a01a25fab5445b8ba0d31def1d8eb22"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7a01a25fab5445b8ba0d31def1d8eb22">&#9670;&nbsp;</a></span>ks_mat4_zero()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_mat4_zero </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a>&#160;</td>
          <td class="paramname"><em>m</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Makes a 4x4 zero matrix</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">m</td><td>Matrix (KS_MAT4x4) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;                               {</div><div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; 16; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;    m[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] = 0.0;</div><div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;  }</div><div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;}</div><div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3cf10f4e08ef58cf5122ed6bbef18cd8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3cf10f4e08ef58cf5122ed6bbef18cd8">&#9670;&nbsp;</a></span>ks_mat4_identity()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_mat4_identity </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a>&#160;</td>
          <td class="paramname"><em>m</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Creates a 4x4 identity matrix</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">m</td><td>Matrix (KS_MAT4x4) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;                                   {</div><div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#a7a01a25fab5445b8ba0d31def1d8eb22">ks_mat4_zero</a>(m);</div><div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; 4; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;    m[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> + (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> * 4)] = 1.0;</div><div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;  }</div><div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a7a01a25fab5445b8ba0d31def1d8eb22"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a7a01a25fab5445b8ba0d31def1d8eb22">ks_mat4_zero</a></div><div class="ttdeci">void ks_mat4_zero(KS_MAT4x4 m)</div><div class="ttdoc">Makes a 4x4 zero matrix</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2628</div></div>
<div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af4ff614f0e15263516162ae891a85e3b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af4ff614f0e15263516162ae891a85e3b">&#9670;&nbsp;</a></span>ks_mat4_print()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_mat4_print </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a>&#160;</td>
          <td class="paramname"><em>m</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Prints a 4x4 matrix to stdout</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">m</td><td>Matrix (KS_MAT4x4) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;                                      {</div><div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; 4; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;    printf(<span class="stringliteral">&quot;| %0.4f %0.4f %0.4f %0.4f |\n&quot;</span>, m[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>], m[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> + 4], m[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> + 8], m[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> + 12]);</div><div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;  }</div><div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;  fflush(stdout);</div><div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;}</div><div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7860cb28ef3d14b565548f0cf546ef9b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7860cb28ef3d14b565548f0cf546ef9b">&#9670;&nbsp;</a></span>ks_mat4_multiply()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_mat4_multiply </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a>&#160;</td>
          <td class="paramname"><em>lhs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a>&#160;</td>
          <td class="paramname"><em>rhs_left</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a>&#160;</td>
          <td class="paramname"><em>rhs_right</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Multiplication of two 4x4 matrices</h4>
</p>
<p>Matrix product: [rhs_left] * [rhs_right]</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">lhs</td><td>Matrix product (KS_MAT4x4) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rhs_left</td><td>Left matrix (KS_MAT4x4) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rhs_right</td><td>Right matrix (KS_MAT4x4) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;                                                                                          {</div><div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;</div><div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;  <span class="comment">/* Define local variables */</span></div><div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;  <span class="keywordtype">int</span> m, n, k;</div><div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;  <span class="keywordtype">int</span> msize = 4;</div><div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a> Mtmp;</div><div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;  <span class="keywordtype">double</span> *ptr;</div><div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;</div><div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;  <span class="keywordflow">if</span> (lhs == rhs_left || lhs == rhs_right) { <span class="comment">/* Check if output is equal to any input */</span></div><div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;    ptr = Mtmp;</div><div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;    ptr = lhs;</div><div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;  }</div><div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;  <span class="keywordflow">for</span> (k = 0; k &lt; (msize * msize); k++) { <span class="comment">/* Zero left-hand side*/</span></div><div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;    ptr[k] = 0.0;</div><div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;  }</div><div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;</div><div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;  <span class="comment">/* Multiply the matrices*/</span></div><div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;  <span class="keywordflow">for</span> (n = 0; n &lt; msize; n++) {</div><div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;    <span class="keywordflow">for</span> (m = 0; m &lt; msize; m++) {</div><div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;      <span class="keywordflow">for</span> (k = 0; k &lt; msize; k++) {</div><div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;        ptr[m + (n * msize)] += rhs_left[m + (k * msize)] * rhs_right[k + (n * msize)];</div><div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;      }</div><div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;    }</div><div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;  }</div><div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;</div><div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;  <span class="keywordflow">if</span> (lhs == rhs_left || lhs == rhs_right ) { <span class="comment">/* Write back (if needed) */</span></div><div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;    <span class="keywordflow">for</span> (k = 0; k &lt; (msize * msize); k++) {</div><div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;      lhs[k] = ptr[k];</div><div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;    }</div><div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;  }</div><div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_a7b8e8b52358de55dd1fb64ef924b2f48"><div class="ttname"><a href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a></div><div class="ttdeci">double KS_MAT4x4[16]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:182</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa73a59f910febec479331b756b4e0b0b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa73a59f910febec479331b756b4e0b0b">&#9670;&nbsp;</a></span>ks_mat4_invert()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_mat4_invert </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a>&#160;</td>
          <td class="paramname"><em>lhs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a>&#160;</td>
          <td class="paramname"><em>rhs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Inversion of a 4x4 matrix</h4>
</p>
<p>4x4 matrix inversion (<a href="http://download.intel.com/design/PentiumIII/sml/24504301.pdf">http://download.intel.com/design/PentiumIII/sml/24504301.pdf</a></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">lhs</td><td>Inverted matrix (KS_MAT4x4) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rhs</td><td>Matrix to be inverted (KS_MAT4x4) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;                                                        {</div><div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;  <span class="keywordtype">double</span> tmp[12]; <span class="comment">/* temp array for pairs */</span></div><div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;  <span class="keywordtype">double</span> src[16]; <span class="comment">/* array of transpose source rhsrix */</span></div><div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;  <span class="keywordtype">double</span> det; <span class="comment">/* determinant */</span></div><div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>, j;</div><div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;</div><div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;  <span class="comment">/* transpose rhsrix */</span></div><div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; 4; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;    src[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] = rhs[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> * 4];</div><div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;    src[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> + 4] = rhs[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> * 4 + 1];</div><div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;    src[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> + 8] = rhs[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> * 4 + 2];</div><div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;    src[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> + 12] = rhs[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> * 4 + 3];</div><div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;  }</div><div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;</div><div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;  <span class="comment">/* calculate pairs for first 8 elements (cofactors) */</span></div><div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;  tmp[0] = src[10] * src[15];</div><div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;  tmp[1] = src[11] * src[14];</div><div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;  tmp[2] = src[9] * src[15];</div><div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;  tmp[3] = src[11] * src[13];</div><div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;  tmp[4] = src[9] * src[14];</div><div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;  tmp[5] = src[10] * src[13];</div><div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;  tmp[6] = src[8] * src[15];</div><div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;  tmp[7] = src[11] * src[12];</div><div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;  tmp[8] = src[8] * src[14];</div><div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;  tmp[9] = src[10] * src[12];</div><div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;  tmp[10] = src[8] * src[13];</div><div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;  tmp[11] = src[9] * src[12];</div><div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;</div><div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;  <span class="comment">/* calculate first 8 elements (cofactors) */</span></div><div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;  lhs[0] = tmp[0] * src[5] + tmp[3] * src[6] + tmp[4] * src[7];</div><div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;  lhs[0] -= tmp[1] * src[5] + tmp[2] * src[6] + tmp[5] * src[7];</div><div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;  lhs[1] = tmp[1] * src[4] + tmp[6] * src[6] + tmp[9] * src[7];</div><div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;  lhs[1] -= tmp[0] * src[4] + tmp[7] * src[6] + tmp[8] * src[7];</div><div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;  lhs[2] = tmp[2] * src[4] + tmp[7] * src[5] + tmp[10] * src[7];</div><div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;  lhs[2] -= tmp[3] * src[4] + tmp[6] * src[5] + tmp[11] * src[7];</div><div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;  lhs[3] = tmp[5] * src[4] + tmp[8] * src[5] + tmp[11] * src[6];</div><div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;  lhs[3] -= tmp[4] * src[4] + tmp[9] * src[5] + tmp[10] * src[6];</div><div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;  lhs[4] = tmp[1] * src[1] + tmp[2] * src[2] + tmp[5] * src[3];</div><div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;  lhs[4] -= tmp[0] * src[1] + tmp[3] * src[2] + tmp[4] * src[3];</div><div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;  lhs[5] = tmp[0] * src[0] + tmp[7] * src[2] + tmp[8] * src[3];</div><div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;  lhs[5] -= tmp[1] * src[0] + tmp[6] * src[2] + tmp[9] * src[3];</div><div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;  lhs[6] = tmp[3] * src[0] + tmp[6] * src[1] + tmp[11] * src[3];</div><div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;  lhs[6] -= tmp[2] * src[0] + tmp[7] * src[1] + tmp[10] * src[3];</div><div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;  lhs[7] = tmp[4] * src[0] + tmp[9] * src[1] + tmp[10] * src[2];</div><div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;  lhs[7] -= tmp[5] * src[0] + tmp[8] * src[1] + tmp[11] * src[2];</div><div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;</div><div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;  <span class="comment">/* calculate pairs for second 8 elements (cofactors) */</span></div><div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;  tmp[0] = src[2] * src[7];</div><div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;  tmp[1] = src[3] * src[6];</div><div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;  tmp[2] = src[1] * src[7];</div><div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;  tmp[3] = src[3] * src[5];</div><div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;  tmp[4] = src[1] * src[6];</div><div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;  tmp[5] = src[2] * src[5];</div><div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;  tmp[6] = src[0] * src[7];</div><div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;  tmp[7] = src[3] * src[4];</div><div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;  tmp[8] = src[0] * src[6];</div><div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;  tmp[9] = src[2] * src[4];</div><div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;  tmp[10] = src[0] * src[5];</div><div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;  tmp[11] = src[1] * src[4];</div><div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;</div><div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;  <span class="comment">/* calculate second 8 elements (cofactors) */</span></div><div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;  lhs[8] = tmp[0] * src[13] + tmp[3] * src[14] + tmp[4] * src[15];</div><div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;  lhs[8] -= tmp[1] * src[13] + tmp[2] * src[14] + tmp[5] * src[15];</div><div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;  lhs[9] = tmp[1] * src[12] + tmp[6] * src[14] + tmp[9] * src[15];</div><div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;  lhs[9] -= tmp[0] * src[12] + tmp[7] * src[14] + tmp[8] * src[15];</div><div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;  lhs[10] = tmp[2] * src[12] + tmp[7] * src[13] + tmp[10] * src[15];</div><div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;  lhs[10] -= tmp[3] * src[12] + tmp[6] * src[13] + tmp[11] * src[15];</div><div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;  lhs[11] = tmp[5] * src[12] + tmp[8] * src[13] + tmp[11] * src[14];</div><div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;  lhs[11] -= tmp[4] * src[12] + tmp[9] * src[13] + tmp[10] * src[14];</div><div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;  lhs[12] = tmp[2] * src[10] + tmp[5] * src[11] + tmp[1] * src[9];</div><div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;  lhs[12] -= tmp[4] * src[11] + tmp[0] * src[9] + tmp[3] * src[10];</div><div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;  lhs[13] = tmp[8] * src[11] + tmp[0] * src[8] + tmp[7] * src[10];</div><div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;  lhs[13] -= tmp[6] * src[10] + tmp[9] * src[11] + tmp[1] * src[8];</div><div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;  lhs[14] = tmp[6] * src[9] + tmp[11] * src[11] + tmp[3] * src[8];</div><div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;  lhs[14] -= tmp[10] * src[11] + tmp[2] * src[8] + tmp[7] * src[9];</div><div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;  lhs[15] = tmp[10] * src[10] + tmp[4] * src[8] + tmp[9] * src[9];</div><div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;  lhs[15] -= tmp[8] * src[9] + tmp[11] * src[10] + tmp[5] * src[8];</div><div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;</div><div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;  <span class="comment">/* calculate determinant */</span></div><div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;  det = src[0] * lhs[0] + src[1] * lhs[1] + src[2] * lhs[2] + src[3] * lhs[3];</div><div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;</div><div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;  <span class="comment">/* calculate rhsrix inverse */</span></div><div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;  det = 1 / det;</div><div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;  <span class="keywordflow">for</span> (j = 0; j &lt; 16; j++)</div><div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;    lhs[j] *= det;</div><div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;}</div><div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a72637d90aca1ebbbbc0fa6b9fa905070"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a72637d90aca1ebbbbc0fa6b9fa905070">&#9670;&nbsp;</a></span>ks_mat4_setgeometry()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_mat4_setgeometry </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a>&#160;</td>
          <td class="paramname"><em>lhs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>z</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>xr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>yr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>zr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Set geometry for KS_MAT4x4</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">lhs</td><td>set matrix (KS_MAT4x4) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">x</td><td>displacement (mm) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">y</td><td>displacement (mm) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">z</td><td>displacement (mm) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">xr</td><td>rotation (deg) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">yr</td><td>rotation (deg) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">zr</td><td>rotation (deg) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;                                                                                                             {</div><div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;  <span class="keywordtype">double</span> cosa;</div><div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;  <span class="keywordtype">double</span> sina;</div><div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;  <span class="keywordtype">double</span> cosb;</div><div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;  <span class="keywordtype">double</span> sinb;</div><div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;  <span class="keywordtype">double</span> cosg;</div><div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;  <span class="keywordtype">double</span> sing;</div><div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;</div><div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#a3cf10f4e08ef58cf5122ed6bbef18cd8">ks_mat4_identity</a>(lhs);</div><div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;</div><div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;  xr *= PI / 180.0;</div><div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;  yr *= PI / 180.0;</div><div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;  zr *= PI / 180.0;</div><div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;</div><div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;<span class="comment">  Rotation matrices for positive counterclockwise angles about the positive</span></div><div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;<span class="comment">  coordinate axis for a right handed coordinate system:</span></div><div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;<span class="comment">                | 1      0       0    |</span></div><div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;<span class="comment">    R1(xr) =    | 0  cos(xr)  -sin(xr)|</span></div><div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;<span class="comment">                | 0  sin(xr)   cos(xr)|</span></div><div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;<span class="comment">                | cos(yr)   0   sin(yr) |</span></div><div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;<span class="comment">    R2(yr)  =   | 0         1     0     |</span></div><div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;<span class="comment">                | -sin(yr)  0   cos(yr) |</span></div><div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;<span class="comment">                | cos(zr) -sin(zr)  0 |</span></div><div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;<span class="comment">    R3(zr) =    | sin(zr)  cos(zr)  0 |</span></div><div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;<span class="comment">                |   0        0      1 |</span></div><div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;</div><div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;  cosa = cos(xr);</div><div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;  sina = sin(xr);</div><div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;  cosb = cos(yr);</div><div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;  sinb = sin(yr);</div><div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;  cosg = cos(zr);</div><div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;  sing = sin(zr);</div><div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;</div><div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;  <span class="comment">/* Rotations: R_z * R_y * R_x */</span></div><div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;  lhs[ 0] =  cosb * cosg;</div><div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;  lhs[ 1] =  sina * sinb * cosg - cosa * sing;</div><div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;  lhs[ 2] =  cosa * sinb * cosg + sina * sing;</div><div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;  lhs[ 4] =  cosb * sing;</div><div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;  lhs[ 5] =  sina * sinb * sing + cosa * cosg;</div><div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;  lhs[ 6] =  cosa * sinb * sing - sina * cosg;</div><div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;  lhs[ 8] =  -sinb;</div><div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;  lhs[ 9] =  sina * cosb;</div><div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;  lhs[10] =  cosa * cosb;</div><div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;</div><div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;  <span class="comment">/* Translations */</span></div><div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;  lhs[ 3] = x;</div><div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;  lhs[ 7] = y;</div><div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;  lhs[11] = z;</div><div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a3cf10f4e08ef58cf5122ed6bbef18cd8"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a3cf10f4e08ef58cf5122ed6bbef18cd8">ks_mat4_identity</a></div><div class="ttdeci">void ks_mat4_identity(KS_MAT4x4 m)</div><div class="ttdoc">Creates a 4x4 identity matrix</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2636</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a52b5ac8e52a9813764edfb25fc43842e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a52b5ac8e52a9813764edfb25fc43842e">&#9670;&nbsp;</a></span>ks_mat4_setrotation1axis()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_mat4_setrotation1axis </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a>&#160;</td>
          <td class="paramname"><em>rhs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>rot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&#160;</td>
          <td class="paramname"><em>axis</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Create a new 4x4 matrix with a rotation around a single axis</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">rhs</td><td>Rotation matrix (KS_MAT4x4) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rot</td><td>Amount of rotation around <code>axis</code> [degrees] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">axis</td><td>One of (include the quotes): 'x', 'y', 'z' </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;                                                                   {</div><div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#a3cf10f4e08ef58cf5122ed6bbef18cd8">ks_mat4_identity</a>(rhs);</div><div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;</div><div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;  rot *= PI / 180.0; <span class="comment">/* deg-&gt;rad */</span></div><div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;</div><div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;  <span class="keywordflow">switch</span> (axis) {</div><div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;  <span class="keywordflow">case</span> <span class="charliteral">&#39;x&#39;</span>:</div><div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;    rhs[5]  =  cos(rot);</div><div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;    rhs[6]  =  sin(rot);</div><div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;    rhs[9]  = -sin(rot);</div><div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;    rhs[10] =  cos(rot);</div><div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;  <span class="keywordflow">case</span> <span class="charliteral">&#39;y&#39;</span>:</div><div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;    rhs[0]  =  cos(rot);</div><div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;    rhs[2]  =  sin(rot);</div><div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;    rhs[8]  = -sin(rot);</div><div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;    rhs[10] =  cos(rot);</div><div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;  <span class="keywordflow">case</span> <span class="charliteral">&#39;z&#39;</span>:</div><div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;    rhs[0]  =  cos(rot);</div><div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;    rhs[1]  =  sin(rot);</div><div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;    rhs[4]  = -sin(rot);</div><div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;    rhs[5]  =  cos(rot);</div><div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;  }</div><div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;</div><div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a3cf10f4e08ef58cf5122ed6bbef18cd8"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a3cf10f4e08ef58cf5122ed6bbef18cd8">ks_mat4_identity</a></div><div class="ttdeci">void ks_mat4_identity(KS_MAT4x4 m)</div><div class="ttdoc">Creates a 4x4 identity matrix</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2636</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ace371e00b197f1e2810b8d113b367266"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ace371e00b197f1e2810b8d113b367266">&#9670;&nbsp;</a></span>ks_mat4_extractrotation()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_mat4_extractrotation </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a>&#160;</td>
          <td class="paramname"><em>R</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a>&#160;</td>
          <td class="paramname"><em>M</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Extract a 3x3 rotation matrix from a 4x4 transformation matrix</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">R</td><td>3x3 rotation matrix (KS_MAT3x3), row major </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">M</td><td>Transformation matrix (KS_MAT4x4), row major </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;                                                             {</div><div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>, j;</div><div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; 3; ++<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>) {</div><div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;    <span class="keywordflow">for</span> (j = 0; j &lt; 3; ++j) {</div><div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;      R[3 * <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> + j] = M[4 * <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> + j];</div><div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;    }</div><div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;  }</div><div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;}</div><div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a5367cf93c8126b5e1ebe7af1455bd12f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5367cf93c8126b5e1ebe7af1455bd12f">&#9670;&nbsp;</a></span>ks_mat4_extracttranslation()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_mat4_extracttranslation </td>
          <td>(</td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>T</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a>&#160;</td>
          <td class="paramname"><em>M</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Extract a 3 element array with translations from a 4x4 transformation matrix</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">T</td><td>Float array with 3 elements (must be allocated) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">M</td><td>Transformation matrix (KS_MAT4x4), row major </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;                                                              {</div><div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; 3; ++<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>) {</div><div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;    T[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] = M[4 * <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> + 3];</div><div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;  }</div><div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;}</div><div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a90b2a40a2ec0d6386acd1a882826db29"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a90b2a40a2ec0d6386acd1a882826db29">&#9670;&nbsp;</a></span>ks_mat3_identity()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_mat3_identity </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a>&#160;</td>
          <td class="paramname"><em>m</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Creates a 3x3 identity matrix</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">m</td><td>Matrix (KS_MAT3x3) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;                                   {</div><div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; 9; ++<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>) {</div><div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;    m[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] = 0;</div><div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;  }</div><div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;  m[0] = 1;</div><div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;  m[4] = 1;</div><div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;  m[8] = 1;</div><div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;}</div><div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aef9748ef561f24658a823f99823bf9f3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aef9748ef561f24658a823f99823bf9f3">&#9670;&nbsp;</a></span>ks_mat3_multiply()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_mat3_multiply </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a>&#160;</td>
          <td class="paramname"><em>lhs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a>&#160;</td>
          <td class="paramname"><em>rhs_left</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a>&#160;</td>
          <td class="paramname"><em>rhs_right</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Multiplication of two 3x3 matrices</h4>
</p>
<p>Matrix product: [rhs_left] * [rhs_right]</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">lhs</td><td>Matrix product (KS_MAT3x3) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rhs_left</td><td>Left matrix (KS_MAT3x3) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rhs_right</td><td>Right matrix (KS_MAT3x3) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;                                                                                          {</div><div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;</div><div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;  <span class="comment">/* TODO: add checks for overlapping arrays */</span></div><div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;</div><div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>, j, k;</div><div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; 3; ++<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>) {</div><div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;    <span class="keywordflow">for</span> (j = 0; j &lt; 3; ++j) {</div><div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;      <span class="keywordtype">double</span> acc = 0;</div><div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;      <span class="keywordflow">for</span> (k = 0; k &lt; 3; ++k) {</div><div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;        acc += rhs_left[3 * <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> + k] * rhs_right[3 * k + j];</div><div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;      }</div><div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;      lhs[3 * <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> + j] = acc;</div><div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;    }</div><div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;  }</div><div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;}</div><div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa256047bba2d4ee8f8b0244323dc4d65"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa256047bba2d4ee8f8b0244323dc4d65">&#9670;&nbsp;</a></span>ks_mat3_print()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_mat3_print </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a>&#160;</td>
          <td class="paramname"><em>m</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Prints a 3x3 matrix to stdout</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">m</td><td>Matrix (KS_MAT3x3) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;                                      {</div><div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; 3; ++<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>) {</div><div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;    fprintf(stderr, <span class="stringliteral">&quot;|%.2f,\t%.2f\t%.2f|\n&quot;</span>, m[3 * <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>], m[3 * <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> + 1], m[3 * <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> + 2]);</div><div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;  }</div><div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;  fprintf(stderr, <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;}</div><div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a028d9a1107a86d282f556e43658ada9b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a028d9a1107a86d282f556e43658ada9b">&#9670;&nbsp;</a></span>ks_mat3_apply()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_mat3_apply </td>
          <td>(</td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>w</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a>&#160;</td>
          <td class="paramname"><em>R</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double *&#160;</td>
          <td class="paramname"><em>v</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Rotate a 3x1 vector by a 3x3 rotation matrix (alibi)</h4>
</p>
<p>Apply an active (alibi) rotation &ndash; i.e w = R * v</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">w</td><td>Output vector (float array with 3 elements) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">R</td><td>Rotation matrix (KS_MAT3x3) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">v</td><td>Input vector (float array with 3 elements) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;                                                                  {</div><div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>, j;</div><div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; 3; ++<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>) {</div><div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;    <span class="keywordtype">double</span> acc = 0;</div><div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;    <span class="keywordflow">for</span> (j = 0; j &lt; 3; ++j) {</div><div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;      acc += R[3 * <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> + j] * v[j];</div><div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;    }</div><div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;    w[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] = acc;</div><div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;  }</div><div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;}</div><div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a22ac65cbd45dee4eec9f4f2612af92a8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a22ac65cbd45dee4eec9f4f2612af92a8">&#9670;&nbsp;</a></span>ks_mat3_invapply()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_mat3_invapply </td>
          <td>(</td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>w</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a>&#160;</td>
          <td class="paramname"><em>R</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double *&#160;</td>
          <td class="paramname"><em>v</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Rotate a 3x1 vector by the inverse of 3x3 rotation matrix (alias)</h4>
</p>
<p>Apply a passive (alias) rotation &ndash; i.e w = R' * v = R^-1 * v</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">w</td><td>Output vector (float array with 3 elements) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">R</td><td>Rotation matrix (KS_MAT3x3) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">v</td><td>Input vector (float array with 3 elements) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;                                                                     {</div><div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>, j;</div><div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; 3; ++<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>) {</div><div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;    <span class="keywordtype">double</span> acc = 0;</div><div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;    <span class="keywordflow">for</span> (j = 0; j &lt; 3; ++j) {</div><div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;      acc += v[j] * R[3 * j + <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>];</div><div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;    }</div><div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;    w[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] = acc;</div><div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;  }</div><div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;}</div><div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="acee69d0d4db843c9923ab78fd3939009"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acee69d0d4db843c9923ab78fd3939009">&#9670;&nbsp;</a></span>ks_compare_wfi_by_timeboard()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_compare_wfi_by_timeboard </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a> *&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a> *&#160;</td>
          <td class="paramname"><em>b</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Compares two WF_INSTANCEs by time, then board</h4>
</p>
<p>This function is used by the qsort() routine in <a class="el" href="_k_s_foundation_8h.html#acee69d0d4db843c9923ab78fd3939009" title="Compares two WF_INSTANCEs by time, then board">ks_compare_wfi_by_timeboard()</a></p>
<p>If two WF_INSTANCEs occur at the same time, XGRAD will come before YGRAD and YGRAD before ZGRAD</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">a</td><td>Pointer to the first <a class="el" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html" title="(Internal use) Structure being a part of various sequence objects to sort them in time across boards...">KS_WFINSTANCE</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">b</td><td>Pointer to the second <a class="el" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html" title="(Internal use) Structure being a part of various sequence objects to sort them in time across boards...">KS_WFINSTANCE</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">value</td><td>Larger or less than 0 depending on sorting order </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;                                                                                {</div><div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;</div><div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;  <span class="keywordflow">return</span> (a-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> &gt; b-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>) - (a-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> &lt; b-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>) +</div><div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;         (a-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> == b-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>) * ((a-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> &gt; b-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>) - (a-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> &lt; b-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>));</div><div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;}</div><div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a1910d262855b71da353ed0d07a6c7823"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">KS_SEQLOC::pos</a></div><div class="ttdeci">int pos</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:242</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a2e3f5254967cadb9a41167c6fbf6743e"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">KS_SEQLOC::board</a></div><div class="ttdeci">int board</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:241</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a78e529e1d86855310035845e03a4c107"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">KS_WFINSTANCE::loc</a></div><div class="ttdeci">KS_SEQLOC loc</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:253</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="addfe7afa496fc5757c450680db49dc5f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#addfe7afa496fc5757c450680db49dc5f">&#9670;&nbsp;</a></span>ks_compare_wfi_by_boardtime()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_compare_wfi_by_boardtime </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a> *&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a> *&#160;</td>
          <td class="paramname"><em>b</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Compares two WF_INSTANCES by board, then time</h4>
</p>
<p>This function is used by the qsort() routine in <a class="el" href="_k_s_foundation_8h.html#addfe7afa496fc5757c450680db49dc5f" title="Compares two WF_INSTANCES by board, then time">ks_compare_wfi_by_boardtime()</a></p>
<p>WF_INSTANCEs are sorted first by board. If two WF_INSTANCEs occur on the same board, t they will be sorted in time</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">a</td><td>Pointer to the first <a class="el" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html" title="(Internal use) Structure being a part of various sequence objects to sort them in time across boards...">KS_WFINSTANCE</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">b</td><td>Pointer to the second <a class="el" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html" title="(Internal use) Structure being a part of various sequence objects to sort them in time across boards...">KS_WFINSTANCE</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">value</td><td>Larger or less than 0 depending on sorting order </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;                                                                                {</div><div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;</div><div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;  <span class="keywordflow">return</span> (a-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> &gt; b-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>) - (a-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> &lt; b-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>) +</div><div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;         (a-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == b-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>) * ((a-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> &gt; b-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>) - (a-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> &lt; b-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>));</div><div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;}</div><div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a1910d262855b71da353ed0d07a6c7823"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">KS_SEQLOC::pos</a></div><div class="ttdeci">int pos</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:242</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a2e3f5254967cadb9a41167c6fbf6743e"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">KS_SEQLOC::board</a></div><div class="ttdeci">int board</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:241</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a78e529e1d86855310035845e03a4c107"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">KS_WFINSTANCE::loc</a></div><div class="ttdeci">KS_SEQLOC loc</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:253</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3d24ff69a16ddb94bd6317e6c5594fe1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3d24ff69a16ddb94bd6317e6c5594fe1">&#9670;&nbsp;</a></span>ks_compare_wfp_by_time()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_compare_wfp_by_time </td>
          <td>(</td>
          <td class="paramtype">const WF_PULSE *&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const WF_PULSE *&#160;</td>
          <td class="paramname"><em>b</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Compares two WF_PULSES in time</h4>
</p>
<p>This function is used by the qsort() routine in <a class="el" href="_k_s_foundation_8h.html#a42180e710dc1f89e9a557683f8f58dda" title="Sort WF_PULSEs in time">ks_sort_wfp_by_time()</a>, which is called from <a class="el" href="_k_s_foundation_8h.html#a5b50d0ffcc69966c42bceb7e67c70cbf" title="Places a KS_READ sequence object at some position in the pulse sequence">ks_pg_read()</a> for data acquisition sorting purposes. It is assumed both WF_PULSEs have only one instance</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">a</td><td>Pointer to the first WF_PULSE </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">b</td><td>Pointer to the second WF_PULSE </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">value</td><td>Larger or less than 0 depending on sorting order </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;                                                                 {</div><div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;</div><div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;  <span class="keywordflow">return</span> (a-&gt;inst_hdr_head-&gt;start &gt; b-&gt;inst_hdr_head-&gt;start) - (a-&gt;inst_hdr_head-&gt;start &lt; b-&gt;inst_hdr_head-&gt;start);</div><div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a0ae65ed3cc2deb47ccf50b7988239474"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0ae65ed3cc2deb47ccf50b7988239474">&#9670;&nbsp;</a></span>ks_sort_wfi_by_timeboard()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_sort_wfi_by_timeboard </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a> *&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nitems</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sort WF_INSTANCEs in time, then board</h4>
</p>
<p>This is the sorting method used in all ks_pg_***() functions</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">a</td><td>Array of <a class="el" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html" title="(Internal use) Structure being a part of various sequence objects to sort them in time across boards...">KS_WFINSTANCE</a> elements </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nitems</td><td>Number of elements in array </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;                                                            {</div><div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;  qsort(a, nitems, <span class="keyword">sizeof</span>(<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a>),</div><div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;        (<span class="keywordtype">int</span>(*)(<span class="keyword">const</span> <span class="keywordtype">void</span> *, <span class="keyword">const</span> <span class="keywordtype">void</span> *))<a class="code" href="_k_s_foundation__common_8c.html#acee69d0d4db843c9923ab78fd3939009">ks_compare_wfi_by_timeboard</a>);</div><div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;}</div><div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a></div><div class="ttdoc">(Internal use) Structure being a part of various sequence objects to sort them in time across boards...</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:250</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_acee69d0d4db843c9923ab78fd3939009"><div class="ttname"><a href="_k_s_foundation__common_8c.html#acee69d0d4db843c9923ab78fd3939009">ks_compare_wfi_by_timeboard</a></div><div class="ttdeci">int ks_compare_wfi_by_timeboard(const KS_WFINSTANCE *a, const KS_WFINSTANCE *b)</div><div class="ttdoc">Compares two WF_INSTANCEs by time, then board</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2937</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a007ba9525cc536f29132ee8e320fa08a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a007ba9525cc536f29132ee8e320fa08a">&#9670;&nbsp;</a></span>ks_sort_wfi_by_boardtime()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_sort_wfi_by_boardtime </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a> *&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nitems</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sort WF_INSTANCEs by board, then time</h4>
</p>
<p>This function is an alternative to <a class="el" href="_k_s_foundation_8h.html#a0ae65ed3cc2deb47ccf50b7988239474" title="Sort WF_INSTANCEs in time, then board">ks_sort_wfi_by_timeboard()</a>, which is <em>not</em> used at the moment</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">a</td><td>Array of <a class="el" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html" title="(Internal use) Structure being a part of various sequence objects to sort them in time across boards...">KS_WFINSTANCE</a> elements </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nitems</td><td>Number of elements in array </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;                                                            {</div><div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;  qsort(a, nitems, <span class="keyword">sizeof</span>(<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a>), (<span class="keywordtype">int</span>(*)(<span class="keyword">const</span> <span class="keywordtype">void</span> *, <span class="keyword">const</span> <span class="keywordtype">void</span> *))<a class="code" href="_k_s_foundation__common_8c.html#addfe7afa496fc5757c450680db49dc5f">ks_compare_wfi_by_boardtime</a>);</div><div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;}</div><div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a></div><div class="ttdoc">(Internal use) Structure being a part of various sequence objects to sort them in time across boards...</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:250</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_addfe7afa496fc5757c450680db49dc5f"><div class="ttname"><a href="_k_s_foundation__common_8c.html#addfe7afa496fc5757c450680db49dc5f">ks_compare_wfi_by_boardtime</a></div><div class="ttdeci">int ks_compare_wfi_by_boardtime(const KS_WFINSTANCE *a, const KS_WFINSTANCE *b)</div><div class="ttdoc">Compares two WF_INSTANCES by board, then time</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2944</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a42180e710dc1f89e9a557683f8f58dda"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a42180e710dc1f89e9a557683f8f58dda">&#9670;&nbsp;</a></span>ks_sort_wfp_by_time()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_sort_wfp_by_time </td>
          <td>(</td>
          <td class="paramtype">WF_PULSE *&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nitems</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sort WF_PULSEs in time</h4>
</p>
<p>This is the sorting method used in <a class="el" href="_k_s_foundation_8h.html#a5b50d0ffcc69966c42bceb7e67c70cbf" title="Places a KS_READ sequence object at some position in the pulse sequence">ks_pg_read()</a></p>
<p>It is assumed that all a[idx] for idx in [0,nitems) have only one instance each</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">a</td><td>Array of WF_PULSE elements </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nitems</td><td>Number of elements in array </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;                                                  {</div><div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;  qsort(a, nitems, <span class="keyword">sizeof</span>(WF_PULSE),</div><div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;        (<span class="keywordtype">int</span>(*)(<span class="keyword">const</span> <span class="keywordtype">void</span> *, <span class="keyword">const</span> <span class="keywordtype">void</span> *))<a class="code" href="_k_s_foundation__common_8c.html#a3d24ff69a16ddb94bd6317e6c5594fe1">ks_compare_wfp_by_time</a>);</div><div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a3d24ff69a16ddb94bd6317e6c5594fe1"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a3d24ff69a16ddb94bd6317e6c5594fe1">ks_compare_wfp_by_time</a></div><div class="ttdeci">int ks_compare_wfp_by_time(const WF_PULSE *a, const WF_PULSE *b)</div><div class="ttdoc">Compares two WF_PULSES in time</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2950</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a768cbf2348344d4c2203bb79b821b2ff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a768cbf2348344d4c2203bb79b821b2ff">&#9670;&nbsp;</a></span>ks_compare_pshort()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_compare_pshort </td>
          <td>(</td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>v1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>v2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Compares two short pointers</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">v1</td><td>Pointer to the first short pointer </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">v2</td><td>Pointer to the second shot pointer </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">value</td><td>Larger or less than 0 depending on sorting order </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;                                                      {</div><div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">short</span> i1 = **(<span class="keyword">const</span> <span class="keywordtype">short</span> **) v1;</div><div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">short</span> i2 = **(<span class="keyword">const</span> <span class="keywordtype">short</span> **) v2;</div><div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;</div><div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;  <span class="keywordflow">return</span> i1 &lt; i2 ? -1 : (i1 &gt; i2);</div><div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="ad09ed4b8371bcc1dd3d873c1ee5587ed"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad09ed4b8371bcc1dd3d873c1ee5587ed">&#9670;&nbsp;</a></span>ks_compare_pint()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_compare_pint </td>
          <td>(</td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>v1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>v2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Compares two int pointers</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">v1</td><td>Pointer to the first int pointer </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">v2</td><td>Pointer to the second int pointer </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">value</td><td>Larger or less than 0 depending on sorting order </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;                                                    {</div><div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> i1 = **(<span class="keyword">const</span> <span class="keywordtype">int</span> **) v1;</div><div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> i2 = **(<span class="keyword">const</span> <span class="keywordtype">int</span> **) v2;</div><div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;</div><div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;  <span class="keywordflow">return</span> i1 &lt; i2 ? -1 : (i1 &gt; i2);</div><div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a4fb225b10c94cbba0ea15b6a97848c3d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4fb225b10c94cbba0ea15b6a97848c3d">&#9670;&nbsp;</a></span>ks_compare_pfloat()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_compare_pfloat </td>
          <td>(</td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>v1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>v2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Compares two float pointers</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">v1</td><td>Pointer to the first float pointer </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">v2</td><td>Pointer to the second float pointer </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">value</td><td>Larger or less than 0 depending on sorting order </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;                                                      {</div><div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">float</span> i1 = **(<span class="keyword">const</span> <span class="keywordtype">float</span> **) v1;</div><div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">float</span> i2 = **(<span class="keyword">const</span> <span class="keywordtype">float</span> **) v2;</div><div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;</div><div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;  <span class="keywordflow">return</span> i1 &lt; i2 ? -1 : (i1 &gt; i2);</div><div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a7e439a9bad95e13f0909674391e7f0fc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7e439a9bad95e13f0909674391e7f0fc">&#9670;&nbsp;</a></span>ks_compare_short()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_compare_short </td>
          <td>(</td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>v1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>v2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Compares two integers (short)</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">v1</td><td>Pointer to the first short </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">v2</td><td>Pointer to the second short </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">value</td><td>Larger or less than 0 depending on sorting order </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;                                                     {</div><div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">short</span> i1 = *(<span class="keyword">const</span> <span class="keywordtype">short</span> *) v1;</div><div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">short</span> i2 = *(<span class="keyword">const</span> <span class="keywordtype">short</span> *) v2;</div><div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;</div><div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;  <span class="keywordflow">return</span> i1 &lt; i2 ? -1 : (i1 &gt; i2);</div><div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a3ba108e0606acf6fca3664f186be0289"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3ba108e0606acf6fca3664f186be0289">&#9670;&nbsp;</a></span>ks_compare_int()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_compare_int </td>
          <td>(</td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>v1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>v2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Compares two integers (int)</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">v1</td><td>Pointer to the first int </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">v2</td><td>Pointer to the second int </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">value</td><td>Larger or less than 0 depending on sorting order </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;                                                   {</div><div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> i1 = *(<span class="keyword">const</span> <span class="keywordtype">int</span> *) v1;</div><div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> i2 = *(<span class="keyword">const</span> <span class="keywordtype">int</span> *) v2;</div><div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;</div><div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;  <span class="keywordflow">return</span> i1 &lt; i2 ? -1 : (i1 &gt; i2);</div><div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a39ba8e8e94e7a55ea699b0f29c862016"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a39ba8e8e94e7a55ea699b0f29c862016">&#9670;&nbsp;</a></span>ks_compare_float()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_compare_float </td>
          <td>(</td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>v1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>v2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Compares two floats</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">v1</td><td>Pointer to the first float </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">v2</td><td>Pointer to the second float </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">value</td><td>Larger or less than 0 depending on sorting order </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;                                                     {</div><div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">float</span> i1 = *(<span class="keyword">const</span> <span class="keywordtype">float</span> *) v1;</div><div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">float</span> i2 = *(<span class="keyword">const</span> <span class="keywordtype">float</span> *) v2;</div><div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;</div><div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;  <span class="keywordflow">return</span> i1 &lt; i2 ? -1 : (i1 &gt; i2);</div><div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a72adf83f1d9ed4592227259113eed4ea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a72adf83f1d9ed4592227259113eed4ea">&#9670;&nbsp;</a></span>ks_sort_getsortedindx()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_sort_getsortedindx </td>
          <td>(</td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>sortedindx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>array</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sort an array of integers (int)</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">sortedindx</td><td>Array of indices into the <code>array</code> to make it sorted </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">array</td><td>Array to be sorted </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">n</td><td>Number of elements in array </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;                                                               {</div><div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;  <span class="keywordtype">int</span> *parray[n];</div><div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;</div><div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; n; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++)</div><div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;    parray[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] = &amp;array[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>];</div><div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;</div><div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;  qsort(parray, n, <span class="keyword">sizeof</span> * parray, <a class="code" href="_k_s_foundation__common_8c.html#ad09ed4b8371bcc1dd3d873c1ee5587ed">ks_compare_pint</a>);</div><div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;</div><div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; n; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++)</div><div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;    sortedindx[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] = parray[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] - array;</div><div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;</div><div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;}</div><div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_ad09ed4b8371bcc1dd3d873c1ee5587ed"><div class="ttname"><a href="_k_s_foundation__common_8c.html#ad09ed4b8371bcc1dd3d873c1ee5587ed">ks_compare_pint</a></div><div class="ttdeci">int ks_compare_pint(const void *v1, const void *v2)</div><div class="ttdoc">Compares two int pointers</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2980</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a39b939060ef2d2772d6ab7a0817c0ec2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a39b939060ef2d2772d6ab7a0817c0ec2">&#9670;&nbsp;</a></span>ks_sort_getsortedindx_s()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_sort_getsortedindx_s </td>
          <td>(</td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>sortedindx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">short *&#160;</td>
          <td class="paramname"><em>array</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sort an array of integers (short)</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">sortedindx</td><td>Array of indices into the <code>array</code> to make it sorted </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">array</td><td>Array to be sorted </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">n</td><td>Number of elements in array </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;                                                                   {</div><div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;  <span class="keywordtype">short</span> *parray[n];</div><div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;</div><div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; n; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++)</div><div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;    parray[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] = &amp;array[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>];</div><div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;</div><div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;  qsort(parray, n, <span class="keyword">sizeof</span> * parray, <a class="code" href="_k_s_foundation__common_8c.html#a768cbf2348344d4c2203bb79b821b2ff">ks_compare_pshort</a>);</div><div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;</div><div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; n; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++)</div><div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;    sortedindx[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] = parray[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] - array;</div><div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;</div><div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;}</div><div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a768cbf2348344d4c2203bb79b821b2ff"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a768cbf2348344d4c2203bb79b821b2ff">ks_compare_pshort</a></div><div class="ttdeci">int ks_compare_pshort(const void *v1, const void *v2)</div><div class="ttdoc">Compares two short pointers</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2972</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa8ba7c47c66d40b3df50e6228f66920d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa8ba7c47c66d40b3df50e6228f66920d">&#9670;&nbsp;</a></span>ks_sort_getsortedindx_f()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_sort_getsortedindx_f </td>
          <td>(</td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>sortedindx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>array</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sort an array of floats</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">sortedindx</td><td>Array of indices into the <code>array</code> to make it sorted </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">array</td><td>Array to be sorted </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">n</td><td>Number of elements in array </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;                                                                   {</div><div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;  <span class="keywordtype">float</span> *parray[n];</div><div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;</div><div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; n; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++)</div><div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;    parray[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] = &amp;array[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>];</div><div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;</div><div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;  qsort(parray, n, <span class="keyword">sizeof</span> * parray, <a class="code" href="_k_s_foundation__common_8c.html#a4fb225b10c94cbba0ea15b6a97848c3d">ks_compare_pfloat</a>);</div><div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;</div><div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; n; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++)</div><div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;    sortedindx[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] = parray[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] - array;</div><div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;</div><div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a4fb225b10c94cbba0ea15b6a97848c3d"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a4fb225b10c94cbba0ea15b6a97848c3d">ks_compare_pfloat</a></div><div class="ttdeci">int ks_compare_pfloat(const void *v1, const void *v2)</div><div class="ttdoc">Compares two float pointers</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2988</div></div>
<div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae136d8a2e504e06e8592185e85fecfde"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae136d8a2e504e06e8592185e85fecfde">&#9670;&nbsp;</a></span>ks_plot_slicetime_begin()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_plot_slicetime_begin </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;                               {</div><div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;  <span class="keywordflow">return</span>;</div><div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a5e19e5d936d4f3c39078da5b6e6ed7f1">ks_plot_host_slicetime_begin</a>();</div><div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_a5e19e5d936d4f3c39078da5b6e6ed7f1"><div class="ttname"><a href="_k_s_foundation_8h.html#a5e19e5d936d4f3c39078da5b6e6ed7f1">ks_plot_host_slicetime_begin</a></div><div class="ttdeci">void ks_plot_host_slicetime_begin()</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3901</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a309a0d3b32c7f1325610f0dceed920bd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a309a0d3b32c7f1325610f0dceed920bd">&#9670;&nbsp;</a></span>ks_plot_slicetime()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_plot_slicetime </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>ctrl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nslices</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>slicepos_mm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>slthick_mm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_k_s_foundation_8h.html#a0ba82984ac3a22ad68cab5bce5224cf9">KS_PLOT_EXCITATION_MODE</a>&#160;</td>
          <td class="paramname"><em>excmode</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;                                                                                                                                 {</div><div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;  <span class="keywordflow">return</span>;</div><div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a2cc0a4e9542bfa5b8a93ca3a12a81c24">ks_plot_host_slicetime</a>(ctrl, nslices, slicepos_mm, slthick_mm, excmode);</div><div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_a2cc0a4e9542bfa5b8a93ca3a12a81c24"><div class="ttname"><a href="_k_s_foundation_8h.html#a2cc0a4e9542bfa5b8a93ca3a12a81c24">ks_plot_host_slicetime</a></div><div class="ttdeci">void ks_plot_host_slicetime(KS_SEQ_CONTROL *ctrl, int nslices, float *slicepos_mm, float slthick_mm, KS_PLOT_EXCITATION_MODE exctype)</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3980</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aedea7098cfed857c923844b3f1052037"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aedea7098cfed857c923844b3f1052037">&#9670;&nbsp;</a></span>ks_plot_slicetime_endofpass()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_plot_slicetime_endofpass </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_k_s_foundation_8h.html#a41f5719fe6c2d60e864572e00af44342">KS_PLOT_PASS_MODE</a>&#160;</td>
          <td class="paramname"><em>pass_mode</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;                                                              {</div><div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;  <span class="keywordflow">return</span>;</div><div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#af2d5190dc4e1ba1de783916a4c66fc96">ks_plot_host_slicetime_endofpass</a>(pass_mode);</div><div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_af2d5190dc4e1ba1de783916a4c66fc96"><div class="ttname"><a href="_k_s_foundation_8h.html#af2d5190dc4e1ba1de783916a4c66fc96">ks_plot_host_slicetime_endofpass</a></div><div class="ttdeci">void ks_plot_host_slicetime_endofpass()</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aadb6109f3b3f75f81b46e153f9eb11f0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aadb6109f3b3f75f81b46e153f9eb11f0">&#9670;&nbsp;</a></span>ks_plot_slicetime_endofslicegroup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_plot_slicetime_endofslicegroup </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>desc</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;                                                         {</div><div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;  <span class="keywordflow">return</span>;</div><div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#afaafc1f357c7766042d78af3c456380a">ks_plot_host_slicetime_endofslicegroup</a>(desc);</div><div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_afaafc1f357c7766042d78af3c456380a"><div class="ttname"><a href="_k_s_foundation_8h.html#afaafc1f357c7766042d78af3c456380a">ks_plot_host_slicetime_endofslicegroup</a></div><div class="ttdeci">void ks_plot_host_slicetime_endofslicegroup(const char *desc)</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3932</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6eab83ca87166f306eb449a94a354ec6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6eab83ca87166f306eb449a94a354ec6">&#9670;&nbsp;</a></span>ks_plot_slicetime_end()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_plot_slicetime_end </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;                             {</div><div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;  <span class="keywordflow">return</span>;</div><div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#ad67bd9fb00d294b98a0a3a7fbaac8550">ks_plot_host_slicetime_end</a>();</div><div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_ad67bd9fb00d294b98a0a3a7fbaac8550"><div class="ttname"><a href="_k_s_foundation_8h.html#ad67bd9fb00d294b98a0a3a7fbaac8550">ks_plot_host_slicetime_end</a></div><div class="ttdeci">void ks_plot_host_slicetime_end()</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:4031</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="abb36a5018815d55e357775e8515f220d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abb36a5018815d55e357775e8515f220d">&#9670;&nbsp;</a></span>ks_plot_tgt_reset()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_plot_tgt_reset </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>ctrl</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;                                             {</div><div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;  FILE *fp;</div><div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;  <span class="keywordtype">char</span> fname_json[1000];</div><div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;  <span class="keywordtype">char</span> cmd[200];</div><div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;<span class="preprocessor">  #ifdef PSD_HW</span></div><div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;<span class="preprocessor">  #endif</span></div><div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;</div><div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;</div><div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#adf724d7e25607bea3d8bf36bb6f8060d">ks_plot_filefmt</a> == <a class="code" href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5fadd75ba7d05d9527ea99f8643787d46ac">KS_PLOT_OFF</a>) {</div><div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;  }</div><div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;</div><div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;  system(<span class="stringliteral">&quot;mkdir -p ./plot/tgt/&quot;</span>);</div><div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;  sprintf(fname_json, <span class="stringliteral">&quot;./plot/tgt/psdplot_tgt_%s_%s.json&quot;</span>, <a class="code" href="_k_s_foundation__common_8c.html#af846b49be109f687e9863f2016029516">ks_psdname</a>, ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;  sprintf(cmd, <span class="stringliteral">&quot;rm -f %s ./plot/tgt/%s_%s_*_tgt.*&quot;</span>,</div><div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;          fname_json, <a class="code" href="_k_s_foundation__common_8c.html#af846b49be109f687e9863f2016029516">ks_psdname</a>, ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;  system(cmd);</div><div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;  fp = fopen(fname_json, <span class="stringliteral">&quot;w&quot;</span>);</div><div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;{\n&quot;</span></div><div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;              <span class="stringliteral">&quot;\&quot;metadata\&quot;: {\n&quot;</span></div><div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;              <span class="stringliteral">&quot;\t\&quot;mode\&quot;: \&quot;tgt\&quot;,\n&quot;</span></div><div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;              <span class="stringliteral">&quot;\t\&quot;psdname\&quot;:  \&quot;%s\&quot;,\n&quot;</span></div><div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;              <span class="stringliteral">&quot;\t\&quot;sequence\&quot;: \&quot;%s\&quot;,\n&quot;</span></div><div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;              <span class="stringliteral">&quot;\t\&quot;duration\&quot;: %0.3f,\n&quot;</span></div><div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;              <span class="stringliteral">&quot;\t\&quot;min_duration\&quot;: %0.3f,\n&quot;</span></div><div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;              <span class="stringliteral">&quot;\t\&quot;ssi_time\&quot;: %0.3f,\n&quot;</span></div><div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;              <span class="stringliteral">&quot;\t\&quot;momentstart\&quot;: %.3f\n&quot;</span></div><div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;              <span class="stringliteral">&quot;},\n&quot;</span></div><div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;              <span class="stringliteral">&quot;\&quot;frames\&quot;: [\n&quot;</span></div><div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;              <span class="stringliteral">&quot;{}]}&quot;</span>,</div><div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;              <a class="code" href="_k_s_foundation__common_8c.html#af846b49be109f687e9863f2016029516">ks_psdname</a>,</div><div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;              ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>,</div><div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;              ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>/1000.0,</div><div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;              ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a901ce6fe6b2fa774dc95ea6bab219bd0">min_duration</a>/1000.0,</div><div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;              ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6037d68ff7b6f66735a92611628df57">ssi_time</a>/1000.0,</div><div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;              ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ab9bf2aebde69b811853b4febc57ff5f8">momentstart</a>/1000.0</div><div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;          );</div><div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;  fclose(fp);</div><div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_a0af3c4f49a609b3bc02c7be25b9c7c5fadd75ba7d05d9527ea99f8643787d46ac"><div class="ttname"><a href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5fadd75ba7d05d9527ea99f8643787d46ac">KS_PLOT_OFF</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:188</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_ab9bf2aebde69b811853b4febc57ff5f8"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ab9bf2aebde69b811853b4febc57ff5f8">KS_SEQ_CONTROL::momentstart</a></div><div class="ttdeci">int momentstart</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:985</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_SEQ_CONTROL::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:984</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_adf724d7e25607bea3d8bf36bb6f8060d"><div class="ttname"><a href="_k_s_foundation__common_8c.html#adf724d7e25607bea3d8bf36bb6f8060d">ks_plot_filefmt</a></div><div class="ttdeci">int ks_plot_filefmt</div><div class="ttdef"><b>Definition:</b> GERequired.e:242</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a901ce6fe6b2fa774dc95ea6bab219bd0"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a901ce6fe6b2fa774dc95ea6bab219bd0">KS_SEQ_CONTROL::min_duration</a></div><div class="ttdeci">int min_duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:981</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_ac6037d68ff7b6f66735a92611628df57"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6037d68ff7b6f66735a92611628df57">KS_SEQ_CONTROL::ssi_time</a></div><div class="ttdeci">int ssi_time</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:983</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_af846b49be109f687e9863f2016029516"><div class="ttname"><a href="_k_s_foundation__common_8c.html#af846b49be109f687e9863f2016029516">ks_psdname</a></div><div class="ttdeci">char ks_psdname[256]</div><div class="ttdef"><b>Definition:</b> GERequired.e:218</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">KS_SEQ_CONTROL::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:990</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa4d70e1b753a44f18ce002ecb84cd16e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa4d70e1b753a44f18ce002ecb84cd16e">&#9670;&nbsp;</a></span>ks_plot_tgt_addframe()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_plot_tgt_addframe </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>ctrl</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Writes a plot frame to file </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ctrl</td><td>Pointer to sequence control </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;                                                {</div><div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;<span class="preprocessor">  #if (!(defined(SIM) &amp;&amp; defined(IPG)))</span></div><div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;<span class="preprocessor">  #endif</span></div><div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;</div><div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#adf724d7e25607bea3d8bf36bb6f8060d">ks_plot_filefmt</a> == <a class="code" href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5fadd75ba7d05d9527ea99f8643787d46ac">KS_PLOT_OFF</a>) {</div><div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;  }</div><div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;</div><div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;  <span class="keywordtype">char</span> boardc[7] = <span class="stringliteral">&quot;xyzrRto&quot;</span>; <span class="comment">/* x,y,z,rho1, rho2, theta, omega*/</span></div><div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;  <span class="keywordtype">char</span> fname[1000];</div><div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;  sprintf(fname, <span class="stringliteral">&quot;./plot/tgt/psdplot_tgt_%s_%s.json&quot;</span>, <a class="code" href="_k_s_foundation__common_8c.html#af846b49be109f687e9863f2016029516">ks_psdname</a>, ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;  FILE *fp;</div><div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>, w, inst, dwell, boardinstance;</div><div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;  <a class="code" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> loc;</div><div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;  fp = fopen(fname, <span class="stringliteral">&quot;r+&quot;</span>);</div><div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;  fseek(fp, -2, SEEK_END);</div><div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;  fputs(<span class="stringliteral">&quot;,{\n&quot;</span>, fp);</div><div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;  <span class="keywordtype">short</span> iamp, gradmax;</div><div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;  <span class="keywordtype">float</span> amp;</div><div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;</div><div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;  <span class="comment">/* TRAPEZOIDS */</span></div><div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;\&quot;trapz\&quot;: {\n&quot;</span>);</div><div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;  fflush(fp);</div><div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;  <a class="code" href="struct_k_s___t_r_a_p.html">KS_TRAP</a>* trap;</div><div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a576774535b3b72525cf3821a0ded5124">numtrap</a>; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) { <span class="comment">/* Each unique trap object */</span></div><div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;    trap = ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a218dab0fa00815bec264cb1170a615ef">trapptr</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>];</div><div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;\t\&quot;%s\&quot;: {\n&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;ramptime\&quot;: %0.3f,\n&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a> / 1000.0);</div><div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;plateautime\&quot;: %0.3f,\n&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">plateautime</a> / 1000.0);</div><div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;duration\&quot;: %0.3f,\n&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> / 1000.0);</div><div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;amp\&quot;: %0.6f,\n&quot;</span>, 1.0);</div><div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;instances\&quot;: [{\n&quot;</span>);</div><div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;    fflush(fp);</div><div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;    <span class="keywordflow">for</span> (inst = 0; inst &lt; ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a218dab0fa00815bec264cb1170a615ef">trapptr</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>]-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>; inst++) { <span class="comment">/* Each instance of this trap */</span></div><div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;      loc = trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a89785a274d251fd637bf40923ad5c345">locs</a>[inst];</div><div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;board\&quot;: \&quot;%c\&quot;,\n&quot;</span>, boardc[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>]);</div><div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;time\&quot;: %0.3f,\n&quot;</span>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> / 1000.0);</div><div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;</div><div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;      WF_PULSE* plateau_ptr = trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[inst].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">wf</a>;</div><div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;      boardinstance = trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[inst].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">boardinstance</a>;</div><div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;       <span class="comment">/* Get the linked list of the plateau (used to get the position of all wf instances) */</span></div><div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;      <span class="comment">/* WF_INSTR_HDR instr_plateau = plateau_ptr-&gt;inst_hdr_tail; */</span></div><div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;      <span class="comment">/* WF_INSTR_HDR instr_attack = plateau_ptr-&gt;assoc_pulse-&gt;inst_hdr_tail; */</span> <span class="comment">/* Attack is the associated pulse of the plateau */</span></div><div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;      <span class="comment">/* WF_INSTR_HDR instr_decay = plateau_ptr-&gt;assoc_pulse-&gt;assoc_pulse-&gt;inst_hdr_tail; */</span> <span class="comment">/* Decay is the associated pulse of the attack */</span></div><div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;<span class="comment">      for (idx = 0; idx &lt; (boardinstance); idx++) {</span></div><div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;<span class="comment">        instr_plateau = instr_plateau-&gt;next;</span></div><div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;<span class="comment">        instr_attack = instr_attack-&gt;next;</span></div><div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;<span class="comment">        instr_decay = instr_decay-&gt;next;</span></div><div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;<span class="comment">      }</span></div><div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;<span class="comment">      */</span></div><div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;      <span class="comment">/* Plateau amplitude is written in G/cm */</span></div><div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;      getiamp(&amp;iamp, plateau_ptr, boardinstance);</div><div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;ampscale\&quot;: 1.0,\n&quot;</span>);</div><div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;      gradmax = <a class="code" href="_k_s_foundation__common_8c.html#aa65115d54842eeffc47a1b324caa62ab">ks_syslimits_gradtarget</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[inst].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>);</div><div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;      <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == OMEGA || loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == THETA) {</div><div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;        gradmax = 1;</div><div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;      }</div><div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;      amp = gradmax * (float)iamp / MAX_PG_IAMP;</div><div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;rtscale\&quot;: %.12f\n&quot;</span>, amp);</div><div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;</div><div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;      <span class="comment">/* char pulsename[100]; */</span></div><div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;      <span class="comment">/* (float)pbeg(plateau_ptr, pulsename, boardinstance)/1000.0 */</span></div><div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;      <span class="comment">/* sprintf(pulsename, &quot;%s%s&quot;, plateau_ptr-&gt;pulsename, &quot;a&quot;); */</span></div><div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;</div><div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;      <span class="keywordflow">if</span> (inst == (trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a> -1)) {</div><div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t}]\n&quot;</span>);</div><div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t},{\n&quot;</span>);</div><div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;      }</div><div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;    } <span class="comment">/* inst */</span></div><div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> == (ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a576774535b3b72525cf3821a0ded5124">numtrap</a> -1)) {</div><div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t}\n&quot;</span>);</div><div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t},\n&quot;</span>);</div><div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;    }</div><div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;  }</div><div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;},\n&quot;</span>); <span class="comment">/* Trapezoids */</span></div><div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;</div><div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;\&quot;acquisitions\&quot;: [\n&quot;</span>);</div><div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;  <span class="comment">/* ACQUISITIONS */</span></div><div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#abe25ffea5925df8869e60f527ce583b4">numacq</a>; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) { <span class="comment">/* Each unique KS_READ object */</span></div><div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;    <a class="code" href="struct_k_s___r_e_a_d.html">KS_READ</a>* acq = ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a2389836ad299458a5470e252c06b91dd">readptr</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>];</div><div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;\t{\n&quot;</span>);</div><div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;description\&quot;: \&quot;%s\&quot;,\n&quot;</span>, acq-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;duration\&quot;: %0.3f,\n&quot;</span>, acq-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> / 1000.0);</div><div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;rbw\&quot;: %0.3f,\n&quot;</span>, acq-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a544d58cc06d73e0f73e464114f6e5318">rbw</a>);</div><div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;samples\&quot;: %d,\n&quot;</span>, acq-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">filt</a>.outputs);</div><div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;time\&quot;: [&quot;</span>);</div><div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;    <span class="keywordflow">for</span> (inst = 0; inst &lt; acq-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>; ++inst) {</div><div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;%0.3f&quot;</span>, acq-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a94207eb79ef6154f75eb3f363bb5df0a">pos</a>[inst] / 1000.0);</div><div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;      <span class="keywordflow">if</span> (inst == (acq-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a> -1)) {</div><div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;]\n&quot;</span>);</div><div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;, &quot;</span>);</div><div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;      }</div><div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;    } <span class="comment">/* inst */</span></div><div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> == (ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#abe25ffea5925df8869e60f527ce583b4">numacq</a> -1)) {</div><div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t}\n&quot;</span>);</div><div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t},\n&quot;</span>);</div><div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;    }</div><div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;  } <span class="comment">/* ACQUISITIONS */</span></div><div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;],\n&quot;</span>); <span class="comment">/* End acquisitions */</span></div><div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;</div><div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;  <span class="comment">/* RF */</span></div><div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;  WF_PULSE* rf_wf;</div><div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;  WF_PULSE* omega_wf;</div><div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;  WF_PULSE* theta_wf;</div><div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;  <span class="keywordtype">short</span> new_wave_iamp;</div><div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#abba996c24da629eea72eecbd9a22a873">KS_IWAVE</a> acquired_wave; <span class="comment">/* short int array */</span></div><div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;\&quot;rf\&quot;: {\n&quot;</span>);</div><div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ad1471d1cbc5ed7e8b1bc9d0987bf6eed">numrf</a>; ++<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>) { <span class="comment">/* Each unique KS_RF object */</span></div><div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;    <a class="code" href="struct_k_s___r_f.html">KS_RF</a>* rfptr = ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a753f71c73d8169393fcbe8a9b3f4d2c2">rfptr</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>];</div><div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;</div><div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;    <span class="keywordflow">if</span> (rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> &gt; 0) {</div><div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;      dwell = rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> / rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>;</div><div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;      <span class="comment">/* RHO */</span></div><div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;      <span class="keywordtype">char</span> roledesc[50];</div><div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;      <span class="keywordflow">if</span> (rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aea7921a9aa2757a88e843476848ddd55">role</a> == <a class="code" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedacc16dd3ca09dedaf6334a39ee4e46241">KS_RF_ROLE_EXC</a>) {</div><div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;        strcpy(roledesc,<span class="stringliteral">&quot;KS_RF_ROLE_EXC&quot;</span>);</div><div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aea7921a9aa2757a88e843476848ddd55">role</a> ==  <a class="code" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142beda8f1b938816b04ffdeb45de47204252fd">KS_RF_ROLE_REF</a>) {</div><div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;        strcpy(roledesc,<span class="stringliteral">&quot;KS_RF_ROLE_REF&quot;</span>);</div><div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aea7921a9aa2757a88e843476848ddd55">role</a> == <a class="code" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedaff51a67bd02398ae045fb3ebafa40abb">KS_RF_ROLE_CHEMSAT</a>) {</div><div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;        strcpy(roledesc, <span class="stringliteral">&quot;KS_RF_ROLE_CHEMSAT&quot;</span>);</div><div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aea7921a9aa2757a88e843476848ddd55">role</a> == <a class="code" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedac6b698b041a6da12fb9194c4947ec6e8">KS_RF_ROLE_INV</a>) {</div><div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;        strcpy(roledesc, <span class="stringliteral">&quot;KS_RF_ROLE_INV&quot;</span>);</div><div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aea7921a9aa2757a88e843476848ddd55">role</a> == <a class="code" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142beda2e9a4ba49720b15631440951968c2865">KS_RF_ROLE_SPSAT</a>) {</div><div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;        strcpy(roledesc, <span class="stringliteral">&quot;KS_RF_ROLE_SPSAT&quot;</span>);</div><div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;        strcpy(roledesc,<span class="stringliteral">&quot;NONE&quot;</span>);</div><div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;      }</div><div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\&quot;%s\&quot;: {\n&quot;</span>, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;description\&quot;: \&quot;%s\&quot;,\n&quot;</span>, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;flipangle\&quot;: %0.3f,\n&quot;</span>, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#a7ab9fec3ad0848d2dff5db7279f1a806">flip</a>);</div><div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;nominal_flipangle\&quot;: %0.3f,\n&quot;</span>, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.nom_fa);</div><div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;max_b1\&quot;: %0.6f,\n&quot;</span>, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.max_b1);</div><div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;isodelay\&quot;: %0.3f,\n&quot;</span>, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#af9bc4afb4579b2bf18259e70175090a3">start2iso</a> / 1000.0);</div><div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;duration\&quot;: %0.3f,\n&quot;</span>, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> / 1000.0);</div><div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;role\&quot;: \&quot;%s\&quot;,\n&quot;</span>, roledesc);</div><div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;amp\&quot;: %.3f,\n&quot;</span>, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#ab508ded41392ee86a2a619d3e93d2373">amp</a>);</div><div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;      <span class="comment">/* OMEGA */</span></div><div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;omega\&quot;: {\n&quot;</span>);</div><div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;      <span class="keywordflow">if</span> (rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> &gt; 0) {</div><div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;description\&quot;: \&quot;%s\&quot;,\n&quot;</span>, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;duration\&quot;: %0.3f,\n&quot;</span>, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> / 1000.0);</div><div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;instances\&quot;: [{\n&quot;</span>);</div><div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;        <span class="keywordflow">for</span> (inst = 0; inst &lt; rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>; ++inst) {</div><div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;          loc = rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a89785a274d251fd637bf40923ad5c345">locs</a>[inst];</div><div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;          boardinstance = rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[inst].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">boardinstance</a>;</div><div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;          omega_wf = &amp;(rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[OMEGA][<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a>]);</div><div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;          movewaveimm(acquired_wave, omega_wf, boardinstance, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>, FROMHARDWARE);</div><div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;          getiamp(&amp;new_wave_iamp, omega_wf, boardinstance);</div><div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;\t\t\t\t\&quot;waveform\&quot;: [0,&quot;</span>);</div><div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;          <span class="keywordflow">for</span> (w = 0; w &lt; rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>; w++) {</div><div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;            fprintf(fp, <span class="stringliteral">&quot;%d,&quot;</span>, acquired_wave[w]);</div><div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;          }</div><div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;0],\n&quot;</span>);</div><div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;\t\t\t\t\&quot;time\&quot;: %0.3f,\n&quot;</span>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>/1000.0);</div><div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;\t\t\t\t\&quot;board\&quot;: \&quot;%c\&quot;,\n&quot;</span>, boardc[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>]);</div><div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;\t\t\t\t\&quot;ampscale\&quot;: 1.0,\n&quot;</span>);</div><div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;\t\t\t\t\&quot;rtscale\&quot;: %0.12f\n&quot;</span>, (<span class="keywordtype">float</span>)(new_wave_iamp) / (max_pg_wamp * max_pg_wamp));</div><div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;          <span class="keywordflow">if</span> (inst == (rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a> -1)) {</div><div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;            fprintf(fp, <span class="stringliteral">&quot;\t\t\t}]\n&quot;</span>);</div><div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;          } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;            fprintf(fp, <span class="stringliteral">&quot;\t\t\t},{\n&quot;</span>);</div><div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;          }</div><div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;        }</div><div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;      }</div><div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t},\n&quot;</span>); <span class="comment">/* Omega */</span></div><div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;</div><div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;      <span class="comment">/* THETA */</span></div><div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;theta\&quot;: {\n&quot;</span>);</div><div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;      <span class="keywordflow">if</span> (rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> &gt; 0) {</div><div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;description\&quot;: \&quot;%s\&quot;,\n&quot;</span>, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;duration\&quot;: %0.3f,\n&quot;</span>, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> / 1000.0);</div><div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;instances\&quot;: [{\n&quot;</span>);</div><div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;        <span class="keywordflow">for</span> (inst = 0; inst &lt; rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>; ++inst) {</div><div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;          loc = rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a89785a274d251fd637bf40923ad5c345">locs</a>[inst];</div><div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;          boardinstance = rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[inst].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">boardinstance</a>;</div><div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;          theta_wf = &amp;(rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[THETA][<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a>]);</div><div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;          movewaveimm(acquired_wave, theta_wf, boardinstance, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>, FROMHARDWARE);</div><div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;          getiamp(&amp;new_wave_iamp, theta_wf, boardinstance);</div><div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;\t\t\t\t\&quot;waveform\&quot;: [0&quot;</span>);</div><div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;          <span class="keywordflow">for</span> (w = 0; w &lt; rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>; w++) {</div><div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;            fprintf(fp, <span class="stringliteral">&quot;%d,&quot;</span>, acquired_wave[w]);</div><div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;          }</div><div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;0],\n&quot;</span>);</div><div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;\t\t\t\t\&quot;time\&quot;: %0.3f,\n&quot;</span>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>/1000.0);</div><div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;\t\t\t\t\&quot;board\&quot;: \&quot;%c\&quot;,\n&quot;</span>, boardc[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>]);</div><div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;\t\t\t\t\&quot;ampscale\&quot;: 1.0,\n&quot;</span>);</div><div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;\t\t\t\t\&quot;rtscale\&quot;: %0.12f\n&quot;</span>, (<span class="keywordtype">float</span>)(new_wave_iamp) / (max_pg_wamp * max_pg_wamp));</div><div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;          <span class="keywordflow">if</span> (inst == (rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a> -1)) {</div><div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;            fprintf(fp, <span class="stringliteral">&quot;\t\t\t}]\n&quot;</span>);</div><div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;          } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;            fprintf(fp, <span class="stringliteral">&quot;\t\t\t},{\n&quot;</span>);</div><div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;          }</div><div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;        }</div><div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;      }</div><div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t},\n&quot;</span>); <span class="comment">/* Theta */</span></div><div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;</div><div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;instances\&quot;: [{\n&quot;</span>);</div><div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;      <span class="keywordflow">for</span> (inst = 0; inst &lt; rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>; ++inst) {</div><div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;        loc = rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a89785a274d251fd637bf40923ad5c345">locs</a>[inst];</div><div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;        boardinstance = rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[inst].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">boardinstance</a>;</div><div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;        rf_wf = &amp;(rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[RHO][<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a>]);</div><div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;        <span class="comment">/* Get waveform from hardware */</span></div><div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;        movewaveimm(acquired_wave, rf_wf, boardinstance, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>, FROMHARDWARE);</div><div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;        <span class="comment">/* B1max recalculations */</span></div><div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;        getiamp(&amp;new_wave_iamp, rf_wf, boardinstance);</div><div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;waveform\&quot;: [0,&quot;</span>);</div><div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;        <span class="keywordflow">for</span> (w = 0; w &lt; rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>; w++) {</div><div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;%d,&quot;</span>, acquired_wave[w]);</div><div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;        }</div><div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;0],\n&quot;</span>);</div><div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;board\&quot;: \&quot;%c\&quot;,\n&quot;</span>, boardc[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>]);</div><div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;time\&quot;: %0.3f,\n&quot;</span>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>/1000.0);</div><div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;ampscale\&quot;: 1.0,\n&quot;</span>);</div><div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;rtscale\&quot;: %0.12f\n&quot;</span>, (<span class="keywordtype">float</span>)new_wave_iamp / (rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#ab508ded41392ee86a2a619d3e93d2373">amp</a> * max_pg_wamp * max_pg_wamp));</div><div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;        <span class="keywordflow">if</span> (inst == (rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a> -1)) {</div><div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;\t\t}]\n&quot;</span>);</div><div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;\t\t},{\n&quot;</span>);</div><div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;        }</div><div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;      }</div><div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> == (ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ad1471d1cbc5ed7e8b1bc9d0987bf6eed">numrf</a> -1)) {</div><div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t}\n&quot;</span>);</div><div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t},\n&quot;</span>);</div><div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;      }</div><div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;    } <span class="comment">/* res &gt; 0 */</span></div><div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;</div><div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;</div><div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;  } <span class="comment">/* End RF */</span></div><div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;},\n&quot;</span>); <span class="comment">/* End RF */</span></div><div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;  <span class="comment">/* other (non-RF) waves */</span></div><div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;\&quot;waves\&quot;: {\n&quot;</span>);</div><div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;</div><div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a176c1433ab0ff244ebdc3806d77fc3c9">numwave</a>; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) { <span class="comment">/* each unique wave object */</span></div><div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;    <a class="code" href="struct_k_s___w_a_v_e.html">KS_WAVE</a>* waveptr = ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ac44d46e0aeb2f3842bf0cfc1e14ebadc">waveptr</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>];</div><div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;    dwell = waveptr-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> / waveptr-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>;</div><div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;    <span class="keywordflow">if</span> (waveptr-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> &gt; 0) {</div><div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\&quot;%s\&quot;: {\n&quot;</span>, waveptr-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;description\&quot;: \&quot;%s\&quot;,\n&quot;</span>, waveptr-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;duration\&quot;: %0.3f,\n&quot;</span>, waveptr-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> / 1000.0);</div><div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;instances\&quot;: [{\n&quot;</span>);</div><div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;      <span class="keywordflow">for</span> (inst = 0; inst &lt; waveptr-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>; inst++) { <span class="comment">/* each instance of the wave */</span></div><div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;        loc = waveptr-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a89785a274d251fd637bf40923ad5c345">locs</a>[inst];</div><div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;        boardinstance = waveptr-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">boardinstance</a>;</div><div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;        WF_PULSE* other_wf = &amp;(waveptr-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>][<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a>]);</div><div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;        movewaveimm(acquired_wave, other_wf, boardinstance, waveptr-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>, FROMHARDWARE);</div><div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;        getiamp(&amp;new_wave_iamp, other_wf, boardinstance);</div><div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;waveform\&quot;: [0,&quot;</span>);</div><div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;        <span class="keywordflow">for</span> (w = 0; w &lt; waveptr-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>; w++) {</div><div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;%d,&quot;</span>, acquired_wave[w]); <span class="comment">/* Or just waveptr-&gt;waveform[w] ? */</span></div><div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;        }</div><div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;0],\n&quot;</span>);</div><div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;board\&quot;: \&quot;%c\&quot;,\n&quot;</span>, boardc[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>]);</div><div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;time\&quot;: %0.3f,\n&quot;</span>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>/1000.0);</div><div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;ampscale\&quot;: 1.0,\n&quot;</span>);</div><div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;rtscale\&quot;: %0.12f\n&quot;</span>, (<span class="keywordtype">float</span>)new_wave_iamp / (max_pg_wamp * max_pg_wamp));</div><div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;        <span class="keywordflow">if</span> (inst == (waveptr-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a> -1)) {</div><div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;\t\t}]\n&quot;</span>);</div><div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;\t\t},{\n&quot;</span>);</div><div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;        }</div><div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;      }</div><div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> == (ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a176c1433ab0ff244ebdc3806d77fc3c9">numwave</a> -1)) {</div><div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t}\n&quot;</span>);</div><div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t},\n&quot;</span>);</div><div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;      }</div><div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;    } <span class="comment">/* res &gt; 0 */</span></div><div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;  }</div><div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;}\n&quot;</span>); <span class="comment">/* End waves */</span></div><div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;}\n&quot;</span>); <span class="comment">/* End frame */</span></div><div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;  fprintf(fp,<span class="stringliteral">&quot;]}&quot;</span>); <span class="comment">/* End frames*/</span></div><div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;</div><div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;  fflush(fp);</div><div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;  fclose(fp);</div><div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;  <span class="keywordflow">return</span>;</div><div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;}</div><div class="ttc" id="struct_k_s___t_r_a_p_html_a878bb367b07dc7dfb5fef5728d2e5b1d"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">KS_TRAP::plateautime</a></div><div class="ttdeci">int plateautime</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:436</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_abba996c24da629eea72eecbd9a22a873"><div class="ttname"><a href="_k_s_foundation_8h.html#abba996c24da629eea72eecbd9a22a873">KS_IWAVE</a></div><div class="ttdeci">short KS_IWAVE[KS_MAXWAVELEN]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:180</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a42df2e3be0bda47009caae1a7042b522"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">KS_WFINSTANCE::boardinstance</a></div><div class="ttdeci">int boardinstance</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:251</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html"><div class="ttname"><a href="struct_k_s___t_r_a_p.html">KS_TRAP</a></div><div class="ttdoc">Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:430</div></div>
<div class="ttc" id="struct_k_s___r_f_html_af9bc4afb4579b2bf18259e70175090a3"><div class="ttname"><a href="struct_k_s___r_f.html#af9bc4afb4579b2bf18259e70175090a3">KS_RF::start2iso</a></div><div class="ttdeci">int start2iso</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:793</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">KS_TRAP::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:431</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a0af3c4f49a609b3bc02c7be25b9c7c5fadd75ba7d05d9527ea99f8643787d46ac"><div class="ttname"><a href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5fadd75ba7d05d9527ea99f8643787d46ac">KS_PLOT_OFF</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:188</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a1910d262855b71da353ed0d07a6c7823"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">KS_SEQLOC::pos</a></div><div class="ttdeci">int pos</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:242</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a753f71c73d8169393fcbe8a9b3f4d2c2"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a753f71c73d8169393fcbe8a9b3f4d2c2">KS_GRADRFCTRL::rfptr</a></div><div class="ttdeci">KS_RF * rfptr[KS_MAXUNIQUE_RF]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:815</div></div>
<div class="ttc" id="struct_k_s___r_f_html_aea7921a9aa2757a88e843476848ddd55"><div class="ttname"><a href="struct_k_s___r_f.html#aea7921a9aa2757a88e843476848ddd55">KS_RF::role</a></div><div class="ttdeci">int role</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:788</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html"><div class="ttname"><a href="struct_k_s___w_a_v_e.html">KS_WAVE</a></div><div class="ttdoc">Core sequence object making arbitrary waveforms on any board (using float data format)</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:514</div></div>
<div class="ttc" id="struct_k_s___r_f_html_ae183c3e4095d1c6d14b3d59a0da97928"><div class="ttname"><a href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">KS_RF::rfpulse</a></div><div class="ttdeci">RF_PULSE rfpulse</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:797</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a89785a274d251fd637bf40923ad5c345"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a89785a274d251fd637bf40923ad5c345">KS_WAVE::locs</a></div><div class="ttdeci">KS_SEQLOC locs[KS_MAXINSTANCES]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:522</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aa324c3517656b8ec032523397a142beda8f1b938816b04ffdeb45de47204252fd"><div class="ttname"><a href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142beda8f1b938816b04ffdeb45de47204252fd">KS_RF_ROLE_REF</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1750</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aa324c3517656b8ec032523397a142bedac6b698b041a6da12fb9194c4947ec6e8"><div class="ttname"><a href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedac6b698b041a6da12fb9194c4947ec6e8">KS_RF_ROLE_INV</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1750</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a576774535b3b72525cf3821a0ded5124"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a576774535b3b72525cf3821a0ded5124">KS_GRADRFCTRL::numtrap</a></div><div class="ttdeci">int numtrap</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:818</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a72a22b96ff3908d2b9a20a3a02647a2f"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">KS_BASE::ninst</a></div><div class="ttdeci">int ninst</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:261</div></div>
<div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a2e3f5254967cadb9a41167c6fbf6743e"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">KS_SEQLOC::board</a></div><div class="ttdeci">int board</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:241</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a544d58cc06d73e0f73e464114f6e5318"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a544d58cc06d73e0f73e464114f6e5318">KS_READ::rbw</a></div><div class="ttdeci">float rbw</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:584</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aa324c3517656b8ec032523397a142bedacc16dd3ca09dedaf6334a39ee4e46241"><div class="ttname"><a href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedacc16dd3ca09dedaf6334a39ee4e46241">KS_RF_ROLE_EXC</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1750</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_ad1471d1cbc5ed7e8b1bc9d0987bf6eed"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ad1471d1cbc5ed7e8b1bc9d0987bf6eed">KS_GRADRFCTRL::numrf</a></div><div class="ttdeci">int numrf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:816</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a7ab9fec3ad0848d2dff5db7279f1a806"><div class="ttname"><a href="struct_k_s___r_f.html#a7ab9fec3ad0848d2dff5db7279f1a806">KS_RF::flip</a></div><div class="ttdeci">float flip</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:789</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">KS_READ::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:581</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a2573e18f36ab5c3d3fc97072edcfab16"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">KS_SEQ_CONTROL::gradrf</a></div><div class="ttdeci">KS_GRADRFCTRL gradrf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:992</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a15be3edad342a49398ca841c2745dc9e"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">KS_TRAP::wfi</a></div><div class="ttdeci">KS_WFINSTANCE * wfi</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:441</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a1c544bec41003a594ba4ec7d43a3a470">KS_READ::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:582</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a15be3edad342a49398ca841c2745dc9e"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">KS_WAVE::wfi</a></div><div class="ttdeci">KS_WFINSTANCE * wfi</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:524</div></div>
<div class="ttc" id="struct_k_s___r_f_html"><div class="ttname"><a href="struct_k_s___r_f.html">KS_RF</a></div><div class="ttdoc">Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:787</div></div>
<div class="ttc" id="struct_k_s___r_f_html_aecd8b68c159a31a28e2a2ec003b593e2"><div class="ttname"><a href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">KS_RF::thetawave</a></div><div class="ttdeci">KS_WAVE thetawave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:800</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a78e529e1d86855310035845e03a4c107"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">KS_WFINSTANCE::loc</a></div><div class="ttdeci">KS_SEQLOC loc</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:253</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_ac44d46e0aeb2f3842bf0cfc1e14ebadc"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ac44d46e0aeb2f3842bf0cfc1e14ebadc">KS_GRADRFCTRL::waveptr</a></div><div class="ttdeci">KS_WAVE * waveptr[KS_MAXUNIQUE_WAVE]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:819</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">KS_WAVE::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:516</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a9428be182c75f60d1b4e6fe36c888afa"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">KS_WAVE::wfpulse</a></div><div class="ttdeci">WF_PULSE ** wfpulse</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:523</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_aa65115d54842eeffc47a1b324caa62ab"><div class="ttname"><a href="_k_s_foundation__common_8c.html#aa65115d54842eeffc47a1b324caa62ab">ks_syslimits_gradtarget</a></div><div class="ttdeci">float ks_syslimits_gradtarget(LOG_GRAD loggrd, WF_PROCESSOR board)</div><div class="ttdoc">Returns the maximum target amplitude for a board (internal use)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:176</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a2a9b610a78cdae3ac8ef682bd34f7e0d"><div class="ttname"><a href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">KS_RF::rfwave</a></div><div class="ttdeci">KS_WAVE rfwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:798</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_adf724d7e25607bea3d8bf36bb6f8060d"><div class="ttname"><a href="_k_s_foundation__common_8c.html#adf724d7e25607bea3d8bf36bb6f8060d">ks_plot_filefmt</a></div><div class="ttdeci">int ks_plot_filefmt</div><div class="ttdef"><b>Definition:</b> GERequired.e:242</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">KS_WAVE::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:515</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html"><div class="ttname"><a href="struct_k_s___r_e_a_d.html">KS_READ</a></div><div class="ttdoc">Core sequence object that handles a data acquisition window</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:580</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_READ::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:583</div></div>
<div class="ttc" id="struct_k_s___r_f_html_ab508ded41392ee86a2a619d3e93d2373"><div class="ttname"><a href="struct_k_s___r_f.html#ab508ded41392ee86a2a619d3e93d2373">KS_RF::amp</a></div><div class="ttdeci">float amp</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:792</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a></div><div class="ttdoc">typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:240</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a558b0ff480e8db364962bd0f203d6958"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">KS_WFINSTANCE::wf</a></div><div class="ttdeci">WF_PULSE * wf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:252</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a89785a274d251fd637bf40923ad5c345"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a89785a274d251fd637bf40923ad5c345">KS_TRAP::locs</a></div><div class="ttdeci">KS_SEQLOC locs[KS_MAXINSTANCES]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:439</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a218dab0fa00815bec264cb1170a615ef"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a218dab0fa00815bec264cb1170a615ef">KS_GRADRFCTRL::trapptr</a></div><div class="ttdeci">KS_TRAP * trapptr[KS_MAXUNIQUE_TRAP]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:817</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32"><div class="ttname"><a href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1754</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">KS_TRAP::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:432</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a176c1433ab0ff244ebdc3806d77fc3c9"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a176c1433ab0ff244ebdc3806d77fc3c9">KS_GRADRFCTRL::numwave</a></div><div class="ttdeci">int numwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:820</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aa324c3517656b8ec032523397a142bedaff51a67bd02398ae045fb3ebafa40abb"><div class="ttname"><a href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedaff51a67bd02398ae045fb3ebafa40abb">KS_RF_ROLE_CHEMSAT</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1750</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a292f93e48d34cda511fcfb72a05558c2"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">KS_READ::filt</a></div><div class="ttdeci">FILTER_INFO filt</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:585</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_af846b49be109f687e9863f2016029516"><div class="ttname"><a href="_k_s_foundation__common_8c.html#af846b49be109f687e9863f2016029516">ks_psdname</a></div><div class="ttdeci">char ks_psdname[256]</div><div class="ttdef"><b>Definition:</b> GERequired.e:218</div></div>
<div class="ttc" id="struct_k_s___r_f_html_aa283d0a503cfda1c25da9f9b9a0d8b1c"><div class="ttname"><a href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">KS_RF::omegawave</a></div><div class="ttdeci">KS_WAVE omegawave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:799</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">KS_SEQ_CONTROL::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:990</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_TRAP::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:437</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a2389836ad299458a5470e252c06b91dd"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a2389836ad299458a5470e252c06b91dd">KS_GRADRFCTRL::readptr</a></div><div class="ttdeci">KS_READ * readptr[KS_MAXUNIQUE_READ]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:821</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aa324c3517656b8ec032523397a142beda2e9a4ba49720b15631440951968c2865"><div class="ttname"><a href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142beda2e9a4ba49720b15631440951968c2865">KS_RF_ROLE_SPSAT</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1750</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_acbc719dc4e48c2a2df0447875e4348ca"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">KS_TRAP::ramptime</a></div><div class="ttdeci">int ramptime</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:435</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_WAVE::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:518</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_abe25ffea5925df8869e60f527ce583b4"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#abe25ffea5925df8869e60f527ce583b4">KS_GRADRFCTRL::numacq</a></div><div class="ttdeci">int numacq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:822</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a94207eb79ef6154f75eb3f363bb5df0a"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a94207eb79ef6154f75eb3f363bb5df0a">KS_READ::pos</a></div><div class="ttdeci">int pos[KS_MAXUNIQUE_READ]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:586</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a88386ac54f37a7fb0dc91302e585ccae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a88386ac54f37a7fb0dc91302e585ccae">&#9670;&nbsp;</a></span>ks_eval_addtraptogradrfctrl()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_addtraptogradrfctrl </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html">KS_GRADRFCTRL</a> *&#160;</td>
          <td class="paramname"><em>gradrfctrl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> *&#160;</td>
          <td class="paramname"><em>trap</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>*Internal use*. Adds a trapezoid (<a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a>) to the <a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html" title="typedef struct that is a part of the KS_SEQ_CONTROL typedef struct, used internally to collect gradie...">KS_GRADRFCTRL</a> struct for later gradient heating calculations in <a class="el" href="_k_s_foundation_8h.html#ab4c6e9f82b55a3db56765fc22f21b7b5" title="Returns the time required to play out a certain number of sequence modules over some interval...">ks_eval_gradrflimits()</a></h4>
</p>
<p>The <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object will be ignored if added previously</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">gradrfctrl</td><td>Pointer to the <a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html" title="typedef struct that is a part of the KS_SEQ_CONTROL typedef struct, used internally to collect gradie...">KS_GRADRFCTRL</a> for the sequence </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">trap</td><td>Pointer to <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;                                                                             {</div><div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;  <span class="keywordflow">if</span> (trap == NULL) <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;</div><div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;  <span class="keywordflow">if</span> (gradrfctrl == NULL) {</div><div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: gradrfctrl is NULL&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;  }</div><div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;</div><div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;  <span class="keywordflow">if</span> (gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a576774535b3b72525cf3821a0ded5124">numtrap</a> &gt;= <a class="code" href="_k_s_foundation_8h.html#a034073abe489e0f26ff7693e11abbb02">KS_MAXUNIQUE_TRAP</a>) {</div><div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: ERROR - too many unique KS_TRAP in sequence&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;  }</div><div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;</div><div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;  <span class="comment">/* check for previous registrations of this trap&#39;s memory address.  If found, return */</span></div><div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;  <span class="keywordflow">if</span> (gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a576774535b3b72525cf3821a0ded5124">numtrap</a> &gt; 0) {</div><div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a576774535b3b72525cf3821a0ded5124">numtrap</a>; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;      <span class="keywordflow">if</span> (gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a218dab0fa00815bec264cb1170a615ef">trapptr</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] == trap)</div><div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;        <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;    }</div><div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;  }</div><div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;</div><div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;  gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a218dab0fa00815bec264cb1170a615ef">trapptr</a>[gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a576774535b3b72525cf3821a0ded5124">numtrap</a>++] = trap;</div><div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;</div><div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;}</div><div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a576774535b3b72525cf3821a0ded5124"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a576774535b3b72525cf3821a0ded5124">KS_GRADRFCTRL::numtrap</a></div><div class="ttdeci">int numtrap</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:818</div></div>
<div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a034073abe489e0f26ff7693e11abbb02"><div class="ttname"><a href="_k_s_foundation_8h.html#a034073abe489e0f26ff7693e11abbb02">KS_MAXUNIQUE_TRAP</a></div><div class="ttdeci">#define KS_MAXUNIQUE_TRAP</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:115</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a218dab0fa00815bec264cb1170a615ef"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a218dab0fa00815bec264cb1170a615ef">KS_GRADRFCTRL::trapptr</a></div><div class="ttdeci">KS_TRAP * trapptr[KS_MAXUNIQUE_TRAP]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:817</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad92221de8b8b3281d9bf0794c50a34bb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad92221de8b8b3281d9bf0794c50a34bb">&#9670;&nbsp;</a></span>ks_eval_addwavetogradrfctrl()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_addwavetogradrfctrl </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html">KS_GRADRFCTRL</a> *&#160;</td>
          <td class="paramname"><em>gradrfctrl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>*Internal use*. Adds a wave (<a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a>) - if it is not a part of a <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object - to the <a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html" title="typedef struct that is a part of the KS_SEQ_CONTROL typedef struct, used internally to collect gradie...">KS_GRADRFCTRL</a> struct for later gradient heating calculations in <a class="el" href="_k_s_foundation_8h.html#ab4c6e9f82b55a3db56765fc22f21b7b5" title="Returns the time required to play out a certain number of sequence modules over some interval...">ks_eval_gradrflimits()</a></h4>
</p>
<p>The <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object will be ignored if added previously</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">gradrfctrl</td><td>Pointer to the <a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html" title="typedef struct that is a part of the KS_SEQ_CONTROL typedef struct, used internally to collect gradie...">KS_GRADRFCTRL</a> for the sequence </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">wave</td><td>Pointer to <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;                                                                             {</div><div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;  <span class="keywordflow">if</span> (wave == NULL) <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;</div><div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;  <span class="keywordflow">if</span> (gradrfctrl == NULL) {</div><div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: gradrfctrl is NULL&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;  }</div><div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;</div><div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;  <span class="keywordflow">if</span> (gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a176c1433ab0ff244ebdc3806d77fc3c9">numwave</a> &gt;= <a class="code" href="_k_s_foundation_8h.html#a4a92ef54385807dc82f7a5113156f31e">KS_MAXUNIQUE_WAVE</a>) {</div><div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: ERROR - too many unique KS_WAVE in sequence&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;  }</div><div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;</div><div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;  <span class="comment">/* check for previous registrations of this trap&#39;s memory address.  If found, return */</span></div><div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;  <span class="keywordflow">if</span> (gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a176c1433ab0ff244ebdc3806d77fc3c9">numwave</a> &gt; 0) {</div><div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a176c1433ab0ff244ebdc3806d77fc3c9">numwave</a>; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;      <span class="keywordflow">if</span> (gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ac44d46e0aeb2f3842bf0cfc1e14ebadc">waveptr</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] == wave)</div><div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;        <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;    }</div><div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;  }</div><div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;</div><div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;  <span class="comment">/* check also for previous waves in KS_RF (rfwave, omegawave, thetawave). If found, return */</span></div><div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;  <span class="keywordflow">if</span> (gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ad1471d1cbc5ed7e8b1bc9d0987bf6eed">numrf</a> &gt; 0) {</div><div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ad1471d1cbc5ed7e8b1bc9d0987bf6eed">numrf</a>; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;      <span class="keywordflow">if</span> (&amp;(gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a753f71c73d8169393fcbe8a9b3f4d2c2">rfptr</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>]-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>) == wave || &amp;(gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a753f71c73d8169393fcbe8a9b3f4d2c2">rfptr</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>]-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>) == wave || &amp;(gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a753f71c73d8169393fcbe8a9b3f4d2c2">rfptr</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>]-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>) == wave)</div><div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;        <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;    }</div><div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;  }</div><div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;</div><div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;  gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ac44d46e0aeb2f3842bf0cfc1e14ebadc">waveptr</a>[gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a176c1433ab0ff244ebdc3806d77fc3c9">numwave</a>++] = wave;</div><div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;</div><div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;}</div><div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a753f71c73d8169393fcbe8a9b3f4d2c2"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a753f71c73d8169393fcbe8a9b3f4d2c2">KS_GRADRFCTRL::rfptr</a></div><div class="ttdeci">KS_RF * rfptr[KS_MAXUNIQUE_RF]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:815</div></div>
<div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_ad1471d1cbc5ed7e8b1bc9d0987bf6eed"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ad1471d1cbc5ed7e8b1bc9d0987bf6eed">KS_GRADRFCTRL::numrf</a></div><div class="ttdeci">int numrf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:816</div></div>
<div class="ttc" id="struct_k_s___r_f_html_aecd8b68c159a31a28e2a2ec003b593e2"><div class="ttname"><a href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">KS_RF::thetawave</a></div><div class="ttdeci">KS_WAVE thetawave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:800</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_ac44d46e0aeb2f3842bf0cfc1e14ebadc"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ac44d46e0aeb2f3842bf0cfc1e14ebadc">KS_GRADRFCTRL::waveptr</a></div><div class="ttdeci">KS_WAVE * waveptr[KS_MAXUNIQUE_WAVE]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:819</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a2a9b610a78cdae3ac8ef682bd34f7e0d"><div class="ttname"><a href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">KS_RF::rfwave</a></div><div class="ttdeci">KS_WAVE rfwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:798</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4a92ef54385807dc82f7a5113156f31e"><div class="ttname"><a href="_k_s_foundation_8h.html#a4a92ef54385807dc82f7a5113156f31e">KS_MAXUNIQUE_WAVE</a></div><div class="ttdeci">#define KS_MAXUNIQUE_WAVE</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:116</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a176c1433ab0ff244ebdc3806d77fc3c9"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a176c1433ab0ff244ebdc3806d77fc3c9">KS_GRADRFCTRL::numwave</a></div><div class="ttdeci">int numwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:820</div></div>
<div class="ttc" id="struct_k_s___r_f_html_aa283d0a503cfda1c25da9f9b9a0d8b1c"><div class="ttname"><a href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">KS_RF::omegawave</a></div><div class="ttdeci">KS_WAVE omegawave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:799</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a75283b5758c55ab4d0530fb9f05b22fd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a75283b5758c55ab4d0530fb9f05b22fd">&#9670;&nbsp;</a></span>ks_eval_addrftogradrfctrl()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_addrftogradrfctrl </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html">KS_GRADRFCTRL</a> *&#160;</td>
          <td class="paramname"><em>gradrfctrl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_f.html">KS_RF</a> *&#160;</td>
          <td class="paramname"><em>rf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>*Internal use*. Adds an RF pulse to the <a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html" title="typedef struct that is a part of the KS_SEQ_CONTROL typedef struct, used internally to collect gradie...">KS_GRADRFCTRL</a> struct for later SAR &amp; RF power calculations in <a class="el" href="_k_s_foundation_8h.html#ab4c6e9f82b55a3db56765fc22f21b7b5" title="Returns the time required to play out a certain number of sequence modules over some interval...">ks_eval_gradrflimits()</a></h4>
</p>
<p>The RF object will be ignored if added previously</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">gradrfctrl</td><td>Pointer to the <a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html" title="typedef struct that is a part of the KS_SEQ_CONTROL typedef struct, used internally to collect gradie...">KS_GRADRFCTRL</a> for the sequence </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rf</td><td>Pointer to <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;                                                                       {</div><div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;  <span class="keywordflow">if</span> (rf == NULL) <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;</div><div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160;  <span class="keywordflow">if</span> (gradrfctrl == NULL) {</div><div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: gradrfctrl is NULL&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;  }</div><div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;</div><div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;  <span class="keywordflow">if</span> (gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ad1471d1cbc5ed7e8b1bc9d0987bf6eed">numrf</a> &gt;= <a class="code" href="_k_s_foundation_8h.html#a4becfb20a2ad2227c16c4ce772ed8d51">KS_MAXUNIQUE_RF</a>) {</div><div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: ERROR - too many unique KS_RF in sequence&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;  }</div><div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;</div><div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;  <span class="comment">/* check for previous registrations of this rf&#39;s memory address. If found, return */</span></div><div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;  <span class="keywordflow">if</span> (gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ad1471d1cbc5ed7e8b1bc9d0987bf6eed">numrf</a> &gt; 0) {</div><div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ad1471d1cbc5ed7e8b1bc9d0987bf6eed">numrf</a>; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;      <span class="keywordflow">if</span> (gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a753f71c73d8169393fcbe8a9b3f4d2c2">rfptr</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] == rf)</div><div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;        <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;    }</div><div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;  }</div><div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;</div><div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;  gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a753f71c73d8169393fcbe8a9b3f4d2c2">rfptr</a>[gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ad1471d1cbc5ed7e8b1bc9d0987bf6eed">numrf</a>++] = rf;</div><div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;</div><div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_a4becfb20a2ad2227c16c4ce772ed8d51"><div class="ttname"><a href="_k_s_foundation_8h.html#a4becfb20a2ad2227c16c4ce772ed8d51">KS_MAXUNIQUE_RF</a></div><div class="ttdeci">#define KS_MAXUNIQUE_RF</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:114</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a753f71c73d8169393fcbe8a9b3f4d2c2"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a753f71c73d8169393fcbe8a9b3f4d2c2">KS_GRADRFCTRL::rfptr</a></div><div class="ttdeci">KS_RF * rfptr[KS_MAXUNIQUE_RF]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:815</div></div>
<div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_ad1471d1cbc5ed7e8b1bc9d0987bf6eed"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ad1471d1cbc5ed7e8b1bc9d0987bf6eed">KS_GRADRFCTRL::numrf</a></div><div class="ttdeci">int numrf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:816</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a58400508a44d80fc140baeb987f7c435"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a58400508a44d80fc140baeb987f7c435">&#9670;&nbsp;</a></span>ks_eval_addreadtogradrfctrl()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_addreadtogradrfctrl </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html">KS_GRADRFCTRL</a> *&#160;</td>
          <td class="paramname"><em>gradrfctrl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_e_a_d.html">KS_READ</a> *&#160;</td>
          <td class="paramname"><em>read</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>*Internal use*. Adds an acquisition to the <a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html" title="typedef struct that is a part of the KS_SEQ_CONTROL typedef struct, used internally to collect gradie...">KS_GRADRFCTRL</a> struct. Used for plotting</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">gradrfctrl</td><td>Pointer to the <a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html" title="typedef struct that is a part of the KS_SEQ_CONTROL typedef struct, used internally to collect gradie...">KS_GRADRFCTRL</a> for the sequence </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">read</td><td>Pointer to acquisition object. </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;                                                                             {</div><div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;  <span class="keywordflow">if</span> (read == NULL) <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;</div><div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;  <span class="keywordflow">if</span> (gradrfctrl == NULL) {</div><div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: gradrfctrl is NULL&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;  }</div><div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;</div><div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;  <span class="keywordflow">if</span> (gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#abe25ffea5925df8869e60f527ce583b4">numacq</a> &gt;= <a class="code" href="_k_s_foundation_8h.html#a8b4a19e776c83d9477d2d4135a564aeb">KS_MAXUNIQUE_READ</a>) {</div><div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: ERROR - too many readouts in sequence&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;  }</div><div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;</div><div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;  <span class="comment">/* check for previous registrations of the pointer. If found, return */</span></div><div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;  <span class="keywordflow">if</span> (gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#abe25ffea5925df8869e60f527ce583b4">numacq</a> &gt; 0) {</div><div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#abe25ffea5925df8869e60f527ce583b4">numacq</a>; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;      <span class="keywordflow">if</span> (gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a2389836ad299458a5470e252c06b91dd">readptr</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] == read)</div><div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;        <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;    }</div><div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;  }</div><div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;</div><div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;  gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a2389836ad299458a5470e252c06b91dd">readptr</a>[gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#abe25ffea5925df8869e60f527ce583b4">numacq</a>++] = read;</div><div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;</div><div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;}</div><div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a8b4a19e776c83d9477d2d4135a564aeb"><div class="ttname"><a href="_k_s_foundation_8h.html#a8b4a19e776c83d9477d2d4135a564aeb">KS_MAXUNIQUE_READ</a></div><div class="ttdeci">#define KS_MAXUNIQUE_READ</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:119</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a2389836ad299458a5470e252c06b91dd"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a2389836ad299458a5470e252c06b91dd">KS_GRADRFCTRL::readptr</a></div><div class="ttdeci">KS_READ * readptr[KS_MAXUNIQUE_READ]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:821</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_abe25ffea5925df8869e60f527ce583b4"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#abe25ffea5925df8869e60f527ce583b4">KS_GRADRFCTRL::numacq</a></div><div class="ttdeci">int numacq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:822</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a48609b98dac5c8f7619bc0521f58d6e3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a48609b98dac5c8f7619bc0521f58d6e3">&#9670;&nbsp;</a></span>ks_scan_rf_phase_spoiling()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_scan_rf_phase_spoiling </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>counter</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns spoiling phase for a given RF counter</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">counter</td><td>[RF number] </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>phase [Phase in degrees] </dd></dl>
<div class="fragment"><div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;                                             {</div><div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;  <span class="keywordtype">double</span> phase = 117.0 * ((double) counter * ((<span class="keywordtype">double</span>) counter + 1.0)) / 2.0;</div><div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;</div><div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;  <span class="comment">/* fmod() does not seem to work on TGT on hardware (MR scanner) */</span></div><div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;</div><div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;  <span class="keywordtype">int</span> phase_fulllaps = (int) (phase / 360.0);</div><div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;</div><div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;  phase = phase - (phase_fulllaps * 360.0);</div><div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;</div><div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;  <span class="keywordflow">return</span> ((<span class="keywordtype">float</span>) phase);</div><div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="ae202b6536335ff4d767690e182e8fc4f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae202b6536335ff4d767690e182e8fc4f">&#9670;&nbsp;</a></span>maxGradRes</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int maxGradRes</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a35c854f1f8f79b61a77569e84e172018"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a35c854f1f8f79b61a77569e84e172018">&#9670;&nbsp;</a></span>cfswgut</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cfswgut</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a49fda6ebed3a78faf1db4fcbfd412de4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a49fda6ebed3a78faf1db4fcbfd412de4">&#9670;&nbsp;</a></span>cfswrfut</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cfswrfut</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a636634b6eb50758af3826332f9180e9b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a636634b6eb50758af3826332f9180e9b">&#9670;&nbsp;</a></span>psd_rf_wait</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int psd_rf_wait</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="aa4225c3edfbcb8e85d91fc491a495058"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa4225c3edfbcb8e85d91fc491a495058">&#9670;&nbsp;</a></span>psd_grd_wait</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int psd_grd_wait</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a2875ace95558531062d08465b2bcc282"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2875ace95558531062d08465b2bcc282">&#9670;&nbsp;</a></span>GAM</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float GAM</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a08b87aaf68a5eef056188032b386db46"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a08b87aaf68a5eef056188032b386db46">&#9670;&nbsp;</a></span>cffield</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float cffield</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a2ccc8c2f78537b7bc8c8a63ee32ac83f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2ccc8c2f78537b7bc8c8a63ee32ac83f">&#9670;&nbsp;</a></span>cfssctype</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cfssctype</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ad3c11a6737769e103948d107c1263749"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad3c11a6737769e103948d107c1263749">&#9670;&nbsp;</a></span>opfov</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float opfov</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a66aaa6a3300240048d37097ded69ba53"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a66aaa6a3300240048d37097ded69ba53">&#9670;&nbsp;</a></span>opxres</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int opxres</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a62476b720a40200e94668beec660cac0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a62476b720a40200e94668beec660cac0">&#9670;&nbsp;</a></span>opyres</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int opyres</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a04f737cdd207318e145bbed14eb487ae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a04f737cdd207318e145bbed14eb487ae">&#9670;&nbsp;</a></span>opslthick</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float opslthick</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a2e788c6338615164f241b755f219c961"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2e788c6338615164f241b755f219c961">&#9670;&nbsp;</a></span>rhkacq_uid</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rhkacq_uid</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="adf724d7e25607bea3d8bf36bb6f8060d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adf724d7e25607bea3d8bf36bb6f8060d">&#9670;&nbsp;</a></span>ks_plot_filefmt</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_plot_filefmt</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="af846b49be109f687e9863f2016029516"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af846b49be109f687e9863f2016029516">&#9670;&nbsp;</a></span>ks_psdname</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char ks_psdname[256]</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a5fc997556910df5890ca1c407984674d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5fc997556910df5890ca1c407984674d">&#9670;&nbsp;</a></span>abort_on_kserror</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int abort_on_kserror = <a class="el" href="_k_s_foundation__common_8c.html#a6d84b666d948d2167844ac88f05d8c8c">ABORT_ON_KSERROR</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a4dcd93b4f67aeb25541105ec7953c67e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4dcd93b4f67aeb25541105ec7953c67e">&#9670;&nbsp;</a></span>ks_rhoboard</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_rhoboard = TYPRHO1</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_edd0b46848e1966a9ba471eaad9abcfd.html">tmpfiles</a></li><li class="navelem"><a class="el" href="_k_s_foundation__common_8c.html">KSFoundation_common.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
