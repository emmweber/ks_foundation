<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>KSFoundation: KSFoundation.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="KarolinskaLogo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">KSFoundation
   &#160;<span id="projectnumber">[Feb-2019]</span>
   </div>
   <div id="projectbrief">A platform for simpler EPIC programming on GE MR systems</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_k_s_foundation_8h.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">KSFoundation.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___b_a_s_e.html">KS_BASE</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___w_a_i_t.html">KS_WAIT</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___i_s_i_r_o_t.html">KS_ISIROT</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___r_e_a_d.html">KS_READ</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___r_f.html">KS_RF</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html">KS_GRADRFCTRL</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___s_e_q___h_a_n_d_l_e.html">KS_SEQ_HANDLE</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html">KS_SEQ_COLLECTION</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___s_a_r.html">KS_SAR</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___s_l_i_c_e___p_l_a_n.html">KS_SLICE_PLAN</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___s_m_s___i_n_f_o.html">KS_SMS_INFO</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___r_e_a_d_w_a_v_e.html">KS_READWAVE</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html">KS_PHASEENCODING_COORD</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___d_i_x_o_n___d_u_a_l_r_e_a_d_t_r_a_p.html">KS_DIXON_DUALREADTRAP</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a4e0e2d9e1ee0f401844b5b6ff8338f82"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:a4e0e2d9e1ee0f401844b5b6ff8338f82"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afd953f31b866a09e0418967c2bf65a59"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>&#160;&#160;&#160;-1</td></tr>
<tr class="separator:afd953f31b866a09e0418967c2bf65a59"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5803c0ce57f2100cd4a3665fdedf3ede"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a5803c0ce57f2100cd4a3665fdedf3ede">KS_INFINITY</a>&#160;&#160;&#160;(1.0/0.0)</td></tr>
<tr class="separator:a5803c0ce57f2100cd4a3665fdedf3ede"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abd2839fe562821c8a76cc9c65d4dfae4"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#abd2839fe562821c8a76cc9c65d4dfae4">_cvdesc</a>(cv,  string)</td></tr>
<tr class="separator:abd2839fe562821c8a76cc9c65d4dfae4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab70ad63ae09d81e0c912e61d3fbef0fa"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ab70ad63ae09d81e0c912e61d3fbef0fa">KS_ISI_predelay</a>&#160;&#160;&#160;256</td></tr>
<tr class="separator:ab70ad63ae09d81e0c912e61d3fbef0fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:addf010deada78e27501476388abad0be"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#addf010deada78e27501476388abad0be">KS_ISI_time</a>&#160;&#160;&#160;256</td></tr>
<tr class="separator:addf010deada78e27501476388abad0be"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a191c8595f093c9d5b27a408e6a2dc1ab"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a191c8595f093c9d5b27a408e6a2dc1ab">KS_ISI_rotupdatetime</a>&#160;&#160;&#160;12</td></tr>
<tr class="separator:a191c8595f093c9d5b27a408e6a2dc1ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af1033833702a65e227f5dcd4b0e29e74"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#af1033833702a65e227f5dcd4b0e29e74">KS_ISI_postdelay</a>&#160;&#160;&#160;256</td></tr>
<tr class="separator:af1033833702a65e227f5dcd4b0e29e74"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5a7fb5c0417f7e99c97bef1765558e0c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a5a7fb5c0417f7e99c97bef1765558e0c">KS_MINPLATEAUTIME</a>&#160;&#160;&#160;8</td></tr>
<tr class="separator:a5a7fb5c0417f7e99c97bef1765558e0c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3bb177070dbeb44d2386c268d781fe61"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a3bb177070dbeb44d2386c268d781fe61">KS_RFSSP_PRETIME</a>&#160;&#160;&#160;64</td></tr>
<tr class="separator:a3bb177070dbeb44d2386c268d781fe61"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aba7bb21f100b12eda8151516fcb12461"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#aba7bb21f100b12eda8151516fcb12461">KS_RFSSP_POSTTIME</a>&#160;&#160;&#160;56</td></tr>
<tr class="separator:aba7bb21f100b12eda8151516fcb12461"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a76daa37aac330cbb2ccf7261d25a771a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a76daa37aac330cbb2ccf7261d25a771a">KS_RF_STANDARD_CRUSHERAREA</a>&#160;&#160;&#160;2000.0</td></tr>
<tr class="separator:a76daa37aac330cbb2ccf7261d25a771a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a91a1de90c6dacdfe76a5df3dd536bd20"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a91a1de90c6dacdfe76a5df3dd536bd20">KS_EPI_MIN_INTERTRAIN_SSPGAP</a>&#160;&#160;&#160;80</td></tr>
<tr class="separator:a91a1de90c6dacdfe76a5df3dd536bd20"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a631e009fae4e6280b5fade1634356188"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a631e009fae4e6280b5fade1634356188">L_REF</a>&#160;&#160;&#160;10</td></tr>
<tr class="separator:a631e009fae4e6280b5fade1634356188"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a51e32d6a9800bdbb4ecf0546f1f92a0e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a51e32d6a9800bdbb4ecf0546f1f92a0e">PSD_HRMW_COIL</a>&#160;&#160;&#160;13</td></tr>
<tr class="separator:a51e32d6a9800bdbb4ecf0546f1f92a0e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad5e48066a235f175d67cee2fc68dc474"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ad5e48066a235f175d67cee2fc68dc474">HAVE_PREMIER_GRADIENTS</a>&#160;&#160;&#160;(<a class="el" href="_k_s_foundation__host_8c.html#af18437b2347fb8d8a16a7668f4a7a768">cfgcoiltype</a> == <a class="el" href="_k_s_foundation_8h.html#a51e32d6a9800bdbb4ecf0546f1f92a0e">PSD_HRMW_COIL</a>)</td></tr>
<tr class="separator:ad5e48066a235f175d67cee2fc68dc474"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a819a610c08191625f85e59018a882b33"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a819a610c08191625f85e59018a882b33">KS_SAVEPFILES</a>&#160;&#160;&#160;RHXC_AUTO_LOCK</td></tr>
<tr class="separator:a819a610c08191625f85e59018a882b33"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a53099695cca4c5bbb28cebe74bb6c635"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a53099695cca4c5bbb28cebe74bb6c635">KS_GERECON</a>&#160;&#160;&#160;(RHXC_AUTO_DISPLAY+RHXC_XFER_IM)</td></tr>
<tr class="separator:a53099695cca4c5bbb28cebe74bb6c635"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a969816ef84367f11542f3473473260dc"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a969816ef84367f11542f3473473260dc">KS_3D_SELECTED</a>&#160;&#160;&#160;(opimode == PSD_3D || opimode == PSD_3DM)</td></tr>
<tr class="separator:a969816ef84367f11542f3473473260dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ada5de92a8a4f7f10055beadff483e5f6"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ada5de92a8a4f7f10055beadff483e5f6">KS_3D_SINGLESLAB_SELECTED</a>&#160;&#160;&#160;(opimode == PSD_3D)</td></tr>
<tr class="separator:ada5de92a8a4f7f10055beadff483e5f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac16ec5a7d1513b0fcb01dc7a730b3360"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ac16ec5a7d1513b0fcb01dc7a730b3360">KS_3D_MULTISLAB_SELECTED</a>&#160;&#160;&#160;(opimode == PSD_3DM)</td></tr>
<tr class="separator:ac16ec5a7d1513b0fcb01dc7a730b3360"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aacb2fe1d83c45e8d0525f363bdd6b8a6"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a>&#160;&#160;&#160;128</td></tr>
<tr class="separator:aacb2fe1d83c45e8d0525f363bdd6b8a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c3e362198a193a273f436e9e392188b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a3c3e362198a193a273f436e9e392188b">KS_MAXWAVELEN</a>&#160;&#160;&#160;10000</td></tr>
<tr class="separator:a3c3e362198a193a273f436e9e392188b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4becfb20a2ad2227c16c4ce772ed8d51"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a4becfb20a2ad2227c16c4ce772ed8d51">KS_MAXUNIQUE_RF</a>&#160;&#160;&#160;20</td></tr>
<tr class="separator:a4becfb20a2ad2227c16c4ce772ed8d51"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a034073abe489e0f26ff7693e11abbb02"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a034073abe489e0f26ff7693e11abbb02">KS_MAXUNIQUE_TRAP</a>&#160;&#160;&#160;200</td></tr>
<tr class="separator:a034073abe489e0f26ff7693e11abbb02"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4a92ef54385807dc82f7a5113156f31e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a4a92ef54385807dc82f7a5113156f31e">KS_MAXUNIQUE_WAVE</a>&#160;&#160;&#160;200</td></tr>
<tr class="separator:a4a92ef54385807dc82f7a5113156f31e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a92ed0352c04ca279b44bf62d253b143a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a92ed0352c04ca279b44bf62d253b143a">KS_MAXUNIQUE_SEQUENCES</a>&#160;&#160;&#160;200</td></tr>
<tr class="separator:a92ed0352c04ca279b44bf62d253b143a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab48aef2b031ba0ae2572616c42e6890c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ab48aef2b031ba0ae2572616c42e6890c">KS_MAX_PHASEDYN</a>&#160;&#160;&#160;1025</td></tr>
<tr class="separator:ab48aef2b031ba0ae2572616c42e6890c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b4a19e776c83d9477d2d4135a564aeb"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a8b4a19e776c83d9477d2d4135a564aeb">KS_MAXUNIQUE_READ</a>&#160;&#160;&#160;500</td></tr>
<tr class="separator:a8b4a19e776c83d9477d2d4135a564aeb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab088ee3b5494b35ca60219f0b4e46e3b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ab088ee3b5494b35ca60219f0b4e46e3b">KS_MAXINSTANCES</a>&#160;&#160;&#160;500</td></tr>
<tr class="separator:ab088ee3b5494b35ca60219f0b4e46e3b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae89776067b59066dc231b6a75d1d6c00"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ae89776067b59066dc231b6a75d1d6c00">KS_EPI_MINBLIPAREA</a>&#160;&#160;&#160;100</td></tr>
<tr class="separator:ae89776067b59066dc231b6a75d1d6c00"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5adde8c85d3d00e22516df96c55f4eb7"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a5adde8c85d3d00e22516df96c55f4eb7">KS_INITZEROS</a>(n)&#160;&#160;&#160;{[0 ... (n-1)] = 0}</td></tr>
<tr class="separator:a5adde8c85d3d00e22516df96c55f4eb7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b43f6a2290a9e0d94c660d62f17941e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a8b43f6a2290a9e0d94c660d62f17941e">KS_INITVALUE</a>(n,  a)&#160;&#160;&#160;{[0 ... (n-1)] = a}</td></tr>
<tr class="separator:a8b43f6a2290a9e0d94c660d62f17941e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a747ea3d02a820c7b57b76773d39f55d5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a747ea3d02a820c7b57b76773d39f55d5">KS_INIT_DESC</a>&#160;&#160;&#160;<a class="el" href="_k_s_foundation_8h.html#a5adde8c85d3d00e22516df96c55f4eb7">KS_INITZEROS</a>(<a class="el" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a>)</td></tr>
<tr class="separator:a747ea3d02a820c7b57b76773d39f55d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad01dd4f06fe226a502e872d4173ba7ae"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ad01dd4f06fe226a502e872d4173ba7ae">KS_INIT_SEQLOC</a>&#160;&#160;&#160;{<a class="el" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>, <a class="el" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>, 1.0}</td></tr>
<tr class="separator:ad01dd4f06fe226a502e872d4173ba7ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1dffdf4233029d2ce0ab9a6d5a82aae5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a1dffdf4233029d2ce0ab9a6d5a82aae5">KS_INIT_WFINSTANCE</a>&#160;&#160;&#160;{NULL, 0, NULL, {<a class="el" href="_k_s_foundation_8h.html#ad01dd4f06fe226a502e872d4173ba7ae">KS_INIT_SEQLOC</a>}}</td></tr>
<tr class="separator:a1dffdf4233029d2ce0ab9a6d5a82aae5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed050d8d7344db4d7ae33ba974855b8a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#aed050d8d7344db4d7ae33ba974855b8a">KS_INIT_WAIT</a>&#160;&#160;&#160;{{0,0,NULL,sizeof(<a class="el" href="struct_k_s___w_a_i_t.html">KS_WAIT</a>)}, <a class="el" href="_k_s_foundation_8h.html#a747ea3d02a820c7b57b76773d39f55d5">KS_INIT_DESC</a>, 0, <a class="el" href="_k_s_foundation_8h.html#a8b43f6a2290a9e0d94c660d62f17941e">KS_INITVALUE</a>(<a class="el" href="_k_s_foundation_8h.html#ab088ee3b5494b35ca60219f0b4e46e3b">KS_MAXINSTANCES</a>, <a class="el" href="_k_s_foundation_8h.html#ad01dd4f06fe226a502e872d4173ba7ae">KS_INIT_SEQLOC</a>), NULL, NULL}</td></tr>
<tr class="separator:aed050d8d7344db4d7ae33ba974855b8a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ff7b57939cfc085f2d08b592137c26c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a4ff7b57939cfc085f2d08b592137c26c">KS_INIT_ISIROT</a>&#160;&#160;&#160;{<a class="el" href="_k_s_foundation_8h.html#aed050d8d7344db4d7ae33ba974855b8a">KS_INIT_WAIT</a>, <a class="el" href="_k_s_foundation_8h.html#aed050d8d7344db4d7ae33ba974855b8a">KS_INIT_WAIT</a>, NULL, 0, 0, 0, 0}</td></tr>
<tr class="separator:a4ff7b57939cfc085f2d08b592137c26c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ba17433713316fa65385237ebb0fb67"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a1ba17433713316fa65385237ebb0fb67">KS_INIT_TRAP</a>&#160;&#160;&#160;{{0,0,NULL,sizeof(<a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a>)}, <a class="el" href="_k_s_foundation_8h.html#a747ea3d02a820c7b57b76773d39f55d5">KS_INIT_DESC</a>, 0.0, 0.0, 0, 0, 0, {0, 0, 0}, <a class="el" href="_k_s_foundation_8h.html#a8b43f6a2290a9e0d94c660d62f17941e">KS_INITVALUE</a>(<a class="el" href="_k_s_foundation_8h.html#ab088ee3b5494b35ca60219f0b4e46e3b">KS_MAXINSTANCES</a>,<a class="el" href="_k_s_foundation_8h.html#ad01dd4f06fe226a502e872d4173ba7ae">KS_INIT_SEQLOC</a>), NULL, NULL, NULL}</td></tr>
<tr class="separator:a1ba17433713316fa65385237ebb0fb67"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2670dc2db110e2ab1ef9551b987d0bb6"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a2670dc2db110e2ab1ef9551b987d0bb6">KS_INIT_READ</a>&#160;&#160;&#160;{{0,0,NULL,sizeof(<a class="el" href="struct_k_s___r_e_a_d.html">KS_READ</a>)}, <a class="el" href="_k_s_foundation_8h.html#a747ea3d02a820c7b57b76773d39f55d5">KS_INIT_DESC</a>, 0, <a class="el" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>, {0.0, 0, 0.0, 0.0, <a class="el" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>, 0, 0, 0}, <a class="el" href="_k_s_foundation_8h.html#a8b43f6a2290a9e0d94c660d62f17941e">KS_INITVALUE</a>(<a class="el" href="_k_s_foundation_8h.html#ab088ee3b5494b35ca60219f0b4e46e3b">KS_MAXINSTANCES</a>,<a class="el" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>), NULL}</td></tr>
<tr class="separator:a2670dc2db110e2ab1ef9551b987d0bb6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac2eb269cadbe7324d2836fe2ed0d9e34"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ac2eb269cadbe7324d2836fe2ed0d9e34">KS_INIT_READ_EPI</a>&#160;&#160;&#160;{{0,0,NULL,sizeof(<a class="el" href="struct_k_s___r_e_a_d.html">KS_READ</a>)}, <a class="el" href="_k_s_foundation_8h.html#a747ea3d02a820c7b57b76773d39f55d5">KS_INIT_DESC</a>, 0, 250.0, {0.0, 0, 0.0, 0.0, <a class="el" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>, 0, 0, 0}, <a class="el" href="_k_s_foundation_8h.html#a8b43f6a2290a9e0d94c660d62f17941e">KS_INITVALUE</a>(<a class="el" href="_k_s_foundation_8h.html#ab088ee3b5494b35ca60219f0b4e46e3b">KS_MAXINSTANCES</a>,<a class="el" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>), NULL}</td></tr>
<tr class="separator:ac2eb269cadbe7324d2836fe2ed0d9e34"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a01108d382b19492c2178b6bedbfcbc4b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a01108d382b19492c2178b6bedbfcbc4b">KS_INIT_READTRAP</a>&#160;&#160;&#160;{<a class="el" href="_k_s_foundation_8h.html#a2670dc2db110e2ab1ef9551b987d0bb6">KS_INIT_READ</a>, 240.0, 256, 0, 0, 0, 0.0, 0.0, 0.0, 0, <a class="el" href="_k_s_foundation_8h.html#a1ba17433713316fa65385237ebb0fb67">KS_INIT_TRAP</a>, <a class="el" href="_k_s_foundation_8h.html#a1ba17433713316fa65385237ebb0fb67">KS_INIT_TRAP</a>}</td></tr>
<tr class="separator:a01108d382b19492c2178b6bedbfcbc4b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68b8d9096b683a787cea61e142c8c7ec"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a68b8d9096b683a787cea61e142c8c7ec">KS_INIT_READTRAP_EPI</a>&#160;&#160;&#160;{<a class="el" href="_k_s_foundation_8h.html#ac2eb269cadbe7324d2836fe2ed0d9e34">KS_INIT_READ_EPI</a>, 240.0, 64, 0, 0, 0, 0.0, 0.0, 0.0, 0,  <a class="el" href="_k_s_foundation_8h.html#a1ba17433713316fa65385237ebb0fb67">KS_INIT_TRAP</a>, <a class="el" href="_k_s_foundation_8h.html#a1ba17433713316fa65385237ebb0fb67">KS_INIT_TRAP</a>}</td></tr>
<tr class="separator:a68b8d9096b683a787cea61e142c8c7ec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abc7dd035a692079d48dc6f0228c69715"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#abc7dd035a692079d48dc6f0228c69715">KS_INIT_PHASEENCTABLE</a>&#160;&#160;&#160;<a class="el" href="_k_s_foundation_8h.html#a5adde8c85d3d00e22516df96c55f4eb7">KS_INITZEROS</a>(<a class="el" href="_k_s_foundation_8h.html#ab48aef2b031ba0ae2572616c42e6890c">KS_MAX_PHASEDYN</a>)</td></tr>
<tr class="separator:abc7dd035a692079d48dc6f0228c69715"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5e620158a577fbdc94013a3f761a5a22"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a5e620158a577fbdc94013a3f761a5a22">KS_INIT_PHASER</a>&#160;&#160;&#160;{<a class="el" href="_k_s_foundation_8h.html#a1ba17433713316fa65385237ebb0fb67">KS_INIT_TRAP</a>, 240.0, <a class="el" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>, 0, 1, 0, 0.0, 0, <a class="el" href="_k_s_foundation_8h.html#abc7dd035a692079d48dc6f0228c69715">KS_INIT_PHASEENCTABLE</a>}</td></tr>
<tr class="separator:a5e620158a577fbdc94013a3f761a5a22"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae5e9ce52cebc9a6543bc6e69e9a03148"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ae5e9ce52cebc9a6543bc6e69e9a03148">KS_INIT_PHASEENCODING_COORD</a>&#160;&#160;&#160;{<a class="el" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>, <a class="el" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>}</td></tr>
<tr class="separator:ae5e9ce52cebc9a6543bc6e69e9a03148"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9cf630986b9344177e80b7d9644bfb81"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a9cf630986b9344177e80b7d9644bfb81">KS_INIT_PHASEENCODING_PLAN</a>&#160;&#160;&#160;{<a class="el" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>, <a class="el" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>, <a class="el" href="_k_s_foundation_8h.html#a747ea3d02a820c7b57b76773d39f55d5">KS_INIT_DESC</a>, NULL, NULL, NULL, FALSE}</td></tr>
<tr class="separator:a9cf630986b9344177e80b7d9644bfb81"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e677786bcadd601f03988f59cc20549"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a3e677786bcadd601f03988f59cc20549">KS_INIT_EPI</a>&#160;&#160;&#160;{<a class="el" href="_k_s_foundation_8h.html#a68b8d9096b683a787cea61e142c8c7ec">KS_INIT_READTRAP_EPI</a>, <a class="el" href="_k_s_foundation_8h.html#a1ba17433713316fa65385237ebb0fb67">KS_INIT_TRAP</a>, <a class="el" href="_k_s_foundation_8h.html#a1ba17433713316fa65385237ebb0fb67">KS_INIT_TRAP</a>, <a class="el" href="_k_s_foundation_8h.html#a5e620158a577fbdc94013a3f761a5a22">KS_INIT_PHASER</a>, <a class="el" href="_k_s_foundation_8h.html#a5e620158a577fbdc94013a3f761a5a22">KS_INIT_PHASER</a>, 0, 0, 0, 0, 1.0, <a class="el" href="_k_s_foundation_8h.html#ae89776067b59066dc231b6a75d1d6c00">KS_EPI_MINBLIPAREA</a>}</td></tr>
<tr class="separator:a3e677786bcadd601f03988f59cc20549"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0e79a34b0ca2dc4338e03528d858105c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a0e79a34b0ca2dc4338e03528d858105c">KS_INIT_WAVEVALUE</a>&#160;&#160;&#160;0</td></tr>
<tr class="separator:a0e79a34b0ca2dc4338e03528d858105c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f3115cf4ed2b225acc3a46df223ba7c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a6f3115cf4ed2b225acc3a46df223ba7c">KS_INIT_WAVEFORM</a>&#160;&#160;&#160;<a class="el" href="_k_s_foundation_8h.html#a8b43f6a2290a9e0d94c660d62f17941e">KS_INITVALUE</a>(<a class="el" href="_k_s_foundation_8h.html#a3c3e362198a193a273f436e9e392188b">KS_MAXWAVELEN</a>, <a class="el" href="_k_s_foundation_8h.html#a0e79a34b0ca2dc4338e03528d858105c">KS_INIT_WAVEVALUE</a>)</td></tr>
<tr class="separator:a6f3115cf4ed2b225acc3a46df223ba7c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae837f68085b812e9e22a659cc26a42cc"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ae837f68085b812e9e22a659cc26a42cc">KS_INIT_WAVE</a>&#160;&#160;&#160;{{0,0,NULL,sizeof(<a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a>)}, <a class="el" href="_k_s_foundation_8h.html#a747ea3d02a820c7b57b76773d39f55d5">KS_INIT_DESC</a>, 0, 0, <a class="el" href="_k_s_foundation_8h.html#a6f3115cf4ed2b225acc3a46df223ba7c">KS_INIT_WAVEFORM</a>, {0,0,0}, <a class="el" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>, <a class="el" href="_k_s_foundation_8h.html#a8b43f6a2290a9e0d94c660d62f17941e">KS_INITVALUE</a>(<a class="el" href="_k_s_foundation_8h.html#ab088ee3b5494b35ca60219f0b4e46e3b">KS_MAXINSTANCES</a>,<a class="el" href="_k_s_foundation_8h.html#ad01dd4f06fe226a502e872d4173ba7ae">KS_INIT_SEQLOC</a>), NULL, NULL, NULL}</td></tr>
<tr class="separator:ae837f68085b812e9e22a659cc26a42cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae4276b7972921313441cea1236c5f9d1"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ae4276b7972921313441cea1236c5f9d1">KS_INIT_READWAVE</a>&#160;&#160;&#160;{<a class="el" href="_k_s_foundation_8h.html#a8b43f6a2290a9e0d94c660d62f17941e">KS_INITVALUE</a>(3,<a class="el" href="_k_s_foundation_8h.html#ae837f68085b812e9e22a659cc26a42cc">KS_INIT_WAVE</a>), <a class="el" href="_k_s_foundation_8h.html#ae837f68085b812e9e22a659cc26a42cc">KS_INIT_WAVE</a>, <a class="el" href="_k_s_foundation_8h.html#ae837f68085b812e9e22a659cc26a42cc">KS_INIT_WAVE</a>, <a class="el" href="_k_s_foundation_8h.html#a2670dc2db110e2ab1ef9551b987d0bb6">KS_INIT_READ</a>, <a class="el" href="_k_s_foundation_8h.html#a8b43f6a2290a9e0d94c660d62f17941e">KS_INITVALUE</a>(3, 0), <a class="el" href="_k_s_foundation_8h.html#a8b43f6a2290a9e0d94c660d62f17941e">KS_INITVALUE</a>(3, 0.0), 0.0, 0.0, 0, 0}</td></tr>
<tr class="separator:ae4276b7972921313441cea1236c5f9d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a25dd0df16b0ebe005df84081dd4f051b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a25dd0df16b0ebe005df84081dd4f051b">KS_INIT_DIXON_DUALREADTRAP</a>&#160;&#160;&#160;{<a class="el" href="_k_s_foundation_8h.html#ae4276b7972921313441cea1236c5f9d1">KS_INIT_READWAVE</a>, <a class="el" href="_k_s_foundation_8h.html#a747ea3d02a820c7b57b76773d39f55d5">KS_INIT_DESC</a>, 0,0,0,0,0.0,0, <a class="el" href="_k_s_foundation_8h.html#a8b43f6a2290a9e0d94c660d62f17941e">KS_INITVALUE</a>(2,0),0,0.0,0,0,0,0.0,0.0, <a class="el" href="_k_s_foundation_8h.html#a8b43f6a2290a9e0d94c660d62f17941e">KS_INITVALUE</a>(4,0)}</td></tr>
<tr class="separator:a25dd0df16b0ebe005df84081dd4f051b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8e0023e45a895db380f6e50698a76c07"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a8e0023e45a895db380f6e50698a76c07">RX27_APPLY_HADAMARD</a></td></tr>
<tr class="separator:a8e0023e45a895db380f6e50698a76c07"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a579993d04a8e73022461a6cc976d683a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a579993d04a8e73022461a6cc976d683a">KS_INIT_RFPULSE</a>&#160;&#160;&#160;{NULL, NULL, 0.0,0.0,0.0,0.0,0.0,0,0.0,0.0,0.0,0.0,NULL,0.0,0.0,0,0,-1,0.0,NULL,0,NULL <a class="el" href="_k_s_foundation_8h.html#a8e0023e45a895db380f6e50698a76c07">RX27_APPLY_HADAMARD</a>}</td></tr>
<tr class="separator:a579993d04a8e73022461a6cc976d683a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc1615558f21efc6020df64ade026467"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#afc1615558f21efc6020df64ade026467">KS_INIT_RF</a>&#160;&#160;&#160;{<a class="el" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedace0db3ff9bb8cad071dc42579e9aadaf">KS_RF_ROLE_NOTSET</a>, <a class="el" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>, <a class="el" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>, 0.0, 0.0, <a class="el" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>, <a class="el" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>, <a class="el" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>, <a class="el" href="_k_s_foundation_8h.html#a747ea3d02a820c7b57b76773d39f55d5">KS_INIT_DESC</a>, <a class="el" href="_k_s_foundation_8h.html#a579993d04a8e73022461a6cc976d683a">KS_INIT_RFPULSE</a>, <a class="el" href="_k_s_foundation_8h.html#ae837f68085b812e9e22a659cc26a42cc">KS_INIT_WAVE</a>, <a class="el" href="_k_s_foundation_8h.html#ae837f68085b812e9e22a659cc26a42cc">KS_INIT_WAVE</a>, <a class="el" href="_k_s_foundation_8h.html#ae837f68085b812e9e22a659cc26a42cc">KS_INIT_WAVE</a>}</td></tr>
<tr class="separator:afc1615558f21efc6020df64ade026467"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d8030715d634067abc0732b5507ce14"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a8d8030715d634067abc0732b5507ce14">KS_INIT_SELRF</a>&#160;&#160;&#160;{<a class="el" href="_k_s_foundation_8h.html#afc1615558f21efc6020df64ade026467">KS_INIT_RF</a>, <a class="el" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>, 1.0, <a class="el" href="_k_s_foundation_8h.html#a1ba17433713316fa65385237ebb0fb67">KS_INIT_TRAP</a>, <a class="el" href="_k_s_foundation_8h.html#a1ba17433713316fa65385237ebb0fb67">KS_INIT_TRAP</a>, <a class="el" href="_k_s_foundation_8h.html#a1ba17433713316fa65385237ebb0fb67">KS_INIT_TRAP</a>, <a class="el" href="_k_s_foundation_8h.html#ae837f68085b812e9e22a659cc26a42cc">KS_INIT_WAVE</a>, <a class="el" href="_k_s_foundation_8h.html#aad777b22fb342c595fed2578676d9c05">KS_INIT_SMS_INFO</a>}</td></tr>
<tr class="separator:a8d8030715d634067abc0732b5507ce14"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad4fa24a8bda2c4137b3ae52f7e479df6"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ad4fa24a8bda2c4137b3ae52f7e479df6">KS_INIT_GRADRFCTRL</a>&#160;&#160;&#160;{<a class="el" href="_k_s_foundation_8h.html#a5adde8c85d3d00e22516df96c55f4eb7">KS_INITZEROS</a>(<a class="el" href="_k_s_foundation_8h.html#a4becfb20a2ad2227c16c4ce772ed8d51">KS_MAXUNIQUE_RF</a>), 0, <a class="el" href="_k_s_foundation_8h.html#a5adde8c85d3d00e22516df96c55f4eb7">KS_INITZEROS</a>(<a class="el" href="_k_s_foundation_8h.html#a034073abe489e0f26ff7693e11abbb02">KS_MAXUNIQUE_TRAP</a>), 0, <a class="el" href="_k_s_foundation_8h.html#a5adde8c85d3d00e22516df96c55f4eb7">KS_INITZEROS</a>(<a class="el" href="_k_s_foundation_8h.html#a4a92ef54385807dc82f7a5113156f31e">KS_MAXUNIQUE_WAVE</a>), 0, <a class="el" href="_k_s_foundation_8h.html#a5adde8c85d3d00e22516df96c55f4eb7">KS_INITZEROS</a>(<a class="el" href="_k_s_foundation_8h.html#a8b4a19e776c83d9477d2d4135a564aeb">KS_MAXUNIQUE_READ</a>), 0, FALSE /* is_cleared_on_tgt */ }</td></tr>
<tr class="separator:ad4fa24a8bda2c4137b3ae52f7e479df6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a34187a64ff37224714ad49aa2dd9b2e0"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a34187a64ff37224714ad49aa2dd9b2e0">KS_INIT_SEQ_HANDLE</a>&#160;&#160;&#160;{NULL, 0, NULL}</td></tr>
<tr class="separator:a34187a64ff37224714ad49aa2dd9b2e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a232cf810c71aebfeadc56a82f472a1ad"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a232cf810c71aebfeadc56a82f472a1ad">KS_INIT_SEQ_CONTROL</a>&#160;&#160;&#160;{0, 0, 1000, 0, <a class="el" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>, FALSE, <a class="el" href="_k_s_foundation_8h.html#a747ea3d02a820c7b57b76773d39f55d5">KS_INIT_DESC</a>, <a class="el" href="_k_s_foundation_8h.html#a34187a64ff37224714ad49aa2dd9b2e0">KS_INIT_SEQ_HANDLE</a>, <a class="el" href="_k_s_foundation_8h.html#ad4fa24a8bda2c4137b3ae52f7e479df6">KS_INIT_GRADRFCTRL</a>}</td></tr>
<tr class="separator:a232cf810c71aebfeadc56a82f472a1ad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1e2fc6159630ad04bd9d5756cd8620b0"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a1e2fc6159630ad04bd9d5756cd8620b0">KS_INIT_SEQ_COLLECTION</a>&#160;&#160;&#160;{0, <a class="el" href="_k_s_foundation_8h.html#a99fb83031ce9923c84392b4e92f956b5a634591f5e0e6042c3ed95c0ae543b402">KS_SEQ_COLLECTION_ALLOWNEW</a>, FALSE, <a class="el" href="_k_s_foundation_8h.html#a8b43f6a2290a9e0d94c660d62f17941e">KS_INITVALUE</a>(<a class="el" href="_k_s_foundation_8h.html#a92ed0352c04ca279b44bf62d253b143a">KS_MAXUNIQUE_SEQUENCES</a>, NULL)}</td></tr>
<tr class="separator:a1e2fc6159630ad04bd9d5756cd8620b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a71d461ee537a1b66b623d50cd4126fbf"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a71d461ee537a1b66b623d50cd4126fbf">KS_INIT_SAR</a>&#160;&#160;&#160;{0, 0, 0, 0}</td></tr>
<tr class="separator:a71d461ee537a1b66b623d50cd4126fbf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a46bcd22394cbabe45e76cc0d4af01aa9"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a46bcd22394cbabe45e76cc0d4af01aa9">KS_INIT_SLICEPLAN</a>&#160;&#160;&#160;{0,0,0,{{0,0,0}}};</td></tr>
<tr class="separator:a46bcd22394cbabe45e76cc0d4af01aa9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aad777b22fb342c595fed2578676d9c05"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#aad777b22fb342c595fed2578676d9c05">KS_INIT_SMS_INFO</a>&#160;&#160;&#160;{1, 0, 0}</td></tr>
<tr class="separator:aad777b22fb342c595fed2578676d9c05"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a24fd14eec35d384b79cda944db13cab1"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a24fd14eec35d384b79cda944db13cab1">KS_INIT_LOGGRD</a>&#160;&#160;&#160;{0,0,0,0,0,0,{0,0,0,0,0,0},{0,0,0,0},{0,0,0,0},{0,0,0,0},{0,0,0,0},{0,0,0,0},{0,0,0,0},0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 }</td></tr>
<tr class="separator:a24fd14eec35d384b79cda944db13cab1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a686ba26d7cfe588e72fbb19a2c13a5e0"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a686ba26d7cfe588e72fbb19a2c13a5e0">KS_INIT_PHYSGRD</a>&#160;&#160;&#160;{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 }</td></tr>
<tr class="separator:a686ba26d7cfe588e72fbb19a2c13a5e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a53c3358d8072b5398809231c87ee7b43"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a53c3358d8072b5398809231c87ee7b43">KS_MAT3x3_IDENTITY</a>&#160;&#160;&#160;{1,0,0,0,1,0,0,0,1}</td></tr>
<tr class="separator:a53c3358d8072b5398809231c87ee7b43"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afdbaf673741ec0d6d5ebb7ab5974338e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#afdbaf673741ec0d6d5ebb7ab5974338e">KS_MAT4x4_IDENTITY</a>&#160;&#160;&#160;{1,0,0,0, 0,1,0,0, 0,0,1,0, 0,0,0,1}</td></tr>
<tr class="separator:afdbaf673741ec0d6d5ebb7ab5974338e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a06d5868fa630d1c05faea3350dbf045c"><td class="memItemLeft" align="right" valign="top">typedef char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a06d5868fa630d1c05faea3350dbf045c">KS_DESCRIPTION</a>[<a class="el" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a>]</td></tr>
<tr class="separator:a06d5868fa630d1c05faea3350dbf045c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a98d69b5689c184e4f57ab124e726f964"><td class="memItemLeft" align="right" valign="top">typedef float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a>[<a class="el" href="_k_s_foundation_8h.html#a3c3e362198a193a273f436e9e392188b">KS_MAXWAVELEN</a>]</td></tr>
<tr class="separator:a98d69b5689c184e4f57ab124e726f964"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abba996c24da629eea72eecbd9a22a873"><td class="memItemLeft" align="right" valign="top">typedef short&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#abba996c24da629eea72eecbd9a22a873">KS_IWAVE</a>[<a class="el" href="_k_s_foundation_8h.html#a3c3e362198a193a273f436e9e392188b">KS_MAXWAVELEN</a>]</td></tr>
<tr class="separator:abba996c24da629eea72eecbd9a22a873"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeecaa16a2b55b6aa37e125536b565657"><td class="memItemLeft" align="right" valign="top">typedef double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a>[9]</td></tr>
<tr class="separator:aeecaa16a2b55b6aa37e125536b565657"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7b8e8b52358de55dd1fb64ef924b2f48"><td class="memItemLeft" align="right" valign="top">typedef double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a>[16]</td></tr>
<tr class="separator:a7b8e8b52358de55dd1fb64ef924b2f48"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:a0af3c4f49a609b3bc02c7be25b9c7c5f"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5f">KS_PLOT_FILEFORMATS</a> { <a class="el" href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5fadd75ba7d05d9527ea99f8643787d46ac">KS_PLOT_OFF</a>, 
<a class="el" href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5faac5f8bbc7e8971122b8a663e191d381f">KS_PLOT_MAKEPDF</a>, 
<a class="el" href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5fa79f80dc07b43457247759abc36002038">KS_PLOT_MAKESVG</a>, 
<a class="el" href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5fae199cefaae88fb3ffc5eee3109bbe3d7">KS_PLOT_MAKEPNG</a>
 }</td></tr>
<tr class="separator:a0af3c4f49a609b3bc02c7be25b9c7c5f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ba82984ac3a22ad68cab5bce5224cf9"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a0ba82984ac3a22ad68cab5bce5224cf9">KS_PLOT_EXCITATION_MODE</a> { <a class="el" href="_k_s_foundation_8h.html#a0ba82984ac3a22ad68cab5bce5224cf9a31ef5b1dd7ca976daa060cd0bb7aa679">KS_PLOT_STANDARD</a>, 
<a class="el" href="_k_s_foundation_8h.html#a0ba82984ac3a22ad68cab5bce5224cf9adbb6a4373075b4e441df71373a3d55ad">KS_PLOT_NO_EXCITATION</a>
 }</td></tr>
<tr class="separator:a0ba82984ac3a22ad68cab5bce5224cf9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a41f5719fe6c2d60e864572e00af44342"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a41f5719fe6c2d60e864572e00af44342">KS_PLOT_PASS_MODE</a> { <a class="el" href="_k_s_foundation_8h.html#a41f5719fe6c2d60e864572e00af44342a676278a26cf0540ba967faa440461dc4">KS_PLOT_PASS_WAS_DUMMY</a>, 
<a class="el" href="_k_s_foundation_8h.html#a41f5719fe6c2d60e864572e00af44342a720101fc6fb1f89f445b01ac1083214e">KS_PLOT_PASS_WAS_CALIBRATION</a>, 
<a class="el" href="_k_s_foundation_8h.html#a41f5719fe6c2d60e864572e00af44342a1850e2f2b51731a0e043855f5991dda2">KS_PLOT_PASS_WAS_STANDARD</a>
 }</td></tr>
<tr class="separator:a41f5719fe6c2d60e864572e00af44342"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a51a2c4637bfcef5c062d3c794ed4ded5"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5">ks_enum_trapparts</a> { <a class="el" href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5ae2ef535229a83f6deb239caa1ff7120e">G_ATTACK</a>, 
<a class="el" href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5ac00e089392912df36396789decb230a4">G_PLATEAU</a>, 
<a class="el" href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5a8b1103e672a6fc1aa616ac7f422410de">G_DECAY</a>
 }</td></tr>
<tr class="separator:a51a2c4637bfcef5c062d3c794ed4ded5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5a6c30061dd7a6d943e51c3697727ba8"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8">ks_enum_boarddef</a> { <br />
&#160;&#160;<a class="el" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a8bf7786da83ee7a9acda99954f5ddb18">KS_X</a>, 
<a class="el" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a9068d2f1c6396f6637e79e9efc9c78d6">KS_Y</a>, 
<a class="el" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a863875ce8883958892a50da6912137e5">KS_Z</a>, 
<a class="el" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ab2a1257fd51cfddbee0232e96de42a28">KS_RHO</a>, 
<br />
&#160;&#160;<a class="el" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8aebefea71c9bec2b927545759821d6657">KS_RHO2</a>, 
<a class="el" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a5f69543fc085b8edd07121876aaecfde">KS_THETA</a>, 
<a class="el" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a4097e54f46e0ea6bd57250be6ca4e967">KS_OMEGA</a>, 
<a class="el" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a8aa6618ed15d4c8f40d8cc5f3426e89d">KS_SSP</a>, 
<br />
&#160;&#160;<a class="el" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a6016c24e63f250c7e49d537c9b01dea1">KS_FREQX_PHASEY</a>, 
<a class="el" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a9bc0b0996e2ac9c6a131209ae4c88629">KS_FREQY_PHASEX</a>, 
<a class="el" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ae0b83b9295764e027abbf88b95b09879">KS_FREQX_PHASEZ</a>, 
<a class="el" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ae2467923eda691b22f68ca96bd7e1c1f">KS_FREQZ_PHASEX</a>, 
<br />
&#160;&#160;<a class="el" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8afa622a33dd2854dfe97a4056ecec5b67">KS_FREQY_PHASEZ</a>, 
<a class="el" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ad53040a098477496911fa2b1850a2d93">KS_FREQZ_PHASEY</a>, 
<a class="el" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a888d3c7138175390df8ccde3cf29c868">KS_XYZ</a>, 
<a class="el" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a839a809fe0e8486a8cd3d41788349129">KS_ALL</a>
<br />
 }</td></tr>
<tr class="separator:a5a6c30061dd7a6d943e51c3697727ba8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae3a267da7c3c7e4e6e523dafba9b7811"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811">ks_enum_epiblipsign</a> { <a class="el" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811ab36b1c8bcdbe924fc9d4a36cde9ba4dd">KS_EPI_POSBLIPS</a> = 1, 
<a class="el" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811a38ffa981f0cb6b0e4660575afb14f751">KS_EPI_NOBLIPS</a> = 0, 
<a class="el" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811a5b332d904cae8d59fc2f85b49ada0ae4">KS_EPI_NEGBLIPS</a> = -1
 }</td></tr>
<tr class="separator:ae3a267da7c3c7e4e6e523dafba9b7811"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a11a05c3ea650ef64c6421ced6c56bff4"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a11a05c3ea650ef64c6421ced6c56bff4">ks_enum_diffusion</a> { <a class="el" href="_k_s_foundation_8h.html#a11a05c3ea650ef64c6421ced6c56bff4ae83a7b8e0bbdb066112c5c807293e176">KS_EPI_DIFFUSION_OFF</a>, 
<a class="el" href="_k_s_foundation_8h.html#a11a05c3ea650ef64c6421ced6c56bff4a74ba4041bf3d1545f9bfdba233bddb7b">KS_EPI_DIFFUSION_ON</a>, 
<a class="el" href="_k_s_foundation_8h.html#a11a05c3ea650ef64c6421ced6c56bff4aa4576cd2d3b8dc8631cc85b1c4a7edaf">KS_EPI_DIFFUSION_PRETEND_FOR_RECON</a>
 }</td></tr>
<tr class="separator:a11a05c3ea650ef64c6421ced6c56bff4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae418ab3d6fe87794cd978b12d10ed699"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ae418ab3d6fe87794cd978b12d10ed699">ks_enum_imsize</a> { <a class="el" href="_k_s_foundation_8h.html#ae418ab3d6fe87794cd978b12d10ed699ae462c5cfa8631a66d48604d1c04a0af4">KS_IMSIZE_NATIVE</a>, 
<a class="el" href="_k_s_foundation_8h.html#ae418ab3d6fe87794cd978b12d10ed699a27dfe464db7e9579482065d43f0d9118">KS_IMSIZE_POW2</a>, 
<a class="el" href="_k_s_foundation_8h.html#ae418ab3d6fe87794cd978b12d10ed699ad8ee9fcfbd4ce48b046b2c6bd8557bb0">KS_IMSIZE_MIN256</a>
 }</td></tr>
<tr class="separator:ae418ab3d6fe87794cd978b12d10ed699"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9bc8f5648b2e1f445829e3fd9aa40723"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a9bc8f5648b2e1f445829e3fd9aa40723">ks_enum_datadestination</a> { <a class="el" href="_k_s_foundation_8h.html#a9bc8f5648b2e1f445829e3fd9aa40723a3fe5c598e210f2c3e54ae034d0a09f5c">KS_DONT_SEND</a> = -1, 
<a class="el" href="_k_s_foundation_8h.html#a9bc8f5648b2e1f445829e3fd9aa40723a3617a36eb1321eb833a9352f12b498a6">KS_SENDTOBAM</a> = 0, 
<a class="el" href="_k_s_foundation_8h.html#a9bc8f5648b2e1f445829e3fd9aa40723aaec2dc7b1ce397d8413c922b551596d7">KS_SENDTORTP</a> = 1
 }</td></tr>
<tr class="separator:a9bc8f5648b2e1f445829e3fd9aa40723"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ada6f4a9dd77c3d0d85845fbaceae04ef"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ada6f4a9dd77c3d0d85845fbaceae04ef">ks_enum_accelmenu</a> { <a class="el" href="_k_s_foundation_8h.html#ada6f4a9dd77c3d0d85845fbaceae04efaf1ab60443a3f1764b91d306bec1112ae">KS_ACCELMENU_FRACT</a>, 
<a class="el" href="_k_s_foundation_8h.html#ada6f4a9dd77c3d0d85845fbaceae04efa384a6dbf705a5fdf85efd0fb9fe33317">KS_ACCELMENU_INT</a>
 }</td></tr>
<tr class="separator:ada6f4a9dd77c3d0d85845fbaceae04ef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa324c3517656b8ec032523397a142bed"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bed">ks_enum_rfrole</a> { <br />
&#160;&#160;<a class="el" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedace0db3ff9bb8cad071dc42579e9aadaf">KS_RF_ROLE_NOTSET</a>, 
<a class="el" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedacc16dd3ca09dedaf6334a39ee4e46241">KS_RF_ROLE_EXC</a>, 
<a class="el" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142beda8f1b938816b04ffdeb45de47204252fd">KS_RF_ROLE_REF</a>, 
<a class="el" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedaff51a67bd02398ae045fb3ebafa40abb">KS_RF_ROLE_CHEMSAT</a>, 
<br />
&#160;&#160;<a class="el" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142beda2e9a4ba49720b15631440951968c2865">KS_RF_ROLE_SPSAT</a>, 
<a class="el" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedac6b698b041a6da12fb9194c4947ec6e8">KS_RF_ROLE_INV</a>
<br />
 }</td></tr>
<tr class="separator:aa324c3517656b8ec032523397a142bed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a86ae493647e9688c942bc9e0bb396313"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a86ae493647e9688c942bc9e0bb396313">ks_enum_sincwin</a> { <br />
&#160;&#160;<a class="el" href="_k_s_foundation_8h.html#a86ae493647e9688c942bc9e0bb396313a3152aefa9a54b3b3fa102a2674ff64eb">KS_RF_SINCWIN_OFF</a>, 
<a class="el" href="_k_s_foundation_8h.html#a86ae493647e9688c942bc9e0bb396313a3bc8b5d8517c5b1a3b852ee492ae293a">KS_RF_SINCWIN_HAMMING</a>, 
<a class="el" href="_k_s_foundation_8h.html#a86ae493647e9688c942bc9e0bb396313a594d1a1254b32274c42975552d65184a">KS_RF_SINCWIN_HANNING</a>, 
<a class="el" href="_k_s_foundation_8h.html#a86ae493647e9688c942bc9e0bb396313a2ba60a518ac45656a0a55b26fe053836">KS_RF_SINCWIN_BLACKMAN</a>, 
<br />
&#160;&#160;<a class="el" href="_k_s_foundation_8h.html#a86ae493647e9688c942bc9e0bb396313a09905442fe84127c23f592ca3af03dd2">KS_RF_SINCWIN_BARTLETT</a>
<br />
 }</td></tr>
<tr class="separator:a86ae493647e9688c942bc9e0bb396313"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac91cb32048e29f6e58bbf2c1acb8fdf1"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1">ks_enum_wavebuf</a> { <a class="el" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a>, 
<a class="el" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1acc45ff8f1dbeb7cef0129dd595e4031b">KS_WF_BUF1</a>, 
<a class="el" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1a976ecf9c65bb6a43d7cb791d681f0adc">KS_WF_BUF2</a>, 
<a class="el" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1a6e84527e5ca18e299429a1d00297b47f">KS_WF_SIZE</a>
 }</td></tr>
<tr class="separator:ac91cb32048e29f6e58bbf2c1acb8fdf1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af968d7d6e4fa1359fba5550fc39ae172"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#af968d7d6e4fa1359fba5550fc39ae172">ks_enum_smstype</a> { <br />
&#160;&#160;<a class="el" href="_k_s_foundation_8h.html#af968d7d6e4fa1359fba5550fc39ae172ae28e1f22fff3b271570f3b9ec916bf58">KS_SELRF_SMS_MB</a>, 
<a class="el" href="_k_s_foundation_8h.html#af968d7d6e4fa1359fba5550fc39ae172aad24beb62524f381a37c7edad4cde495">KS_SELRF_SMS_PINS</a>, 
<a class="el" href="_k_s_foundation_8h.html#af968d7d6e4fa1359fba5550fc39ae172a27d5a473a532b02775bf36bd99857980">KS_SELRF_SMS_PINS_DANTE</a>, 
<a class="el" href="_k_s_foundation_8h.html#af968d7d6e4fa1359fba5550fc39ae172a6456ba09b2ddd9973c583d71ec96d1f7">KS_SELRF_SMS_MULTI_PINS</a>, 
<br />
&#160;&#160;<a class="el" href="_k_s_foundation_8h.html#af968d7d6e4fa1359fba5550fc39ae172ab340e6fbe544562ee4b5cf8075ca20a2">KS_SELRF_SMSTYPE_SIZE</a>
<br />
 }</td></tr>
<tr class="separator:af968d7d6e4fa1359fba5550fc39ae172"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afbfc330f4f27194b4e27753383464227"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#afbfc330f4f27194b4e27753383464227">ks_enum_sms_phase_mod</a> { <br />
&#160;&#160;<a class="el" href="_k_s_foundation_8h.html#afbfc330f4f27194b4e27753383464227ae3bd201ec523ddd720faf6625365aae7">KS_SELRF_SMS_PHAS_MOD_OFF</a>, 
<a class="el" href="_k_s_foundation_8h.html#afbfc330f4f27194b4e27753383464227a1918b5929560ca3eaa2f054f855d5659">KS_SELRF_SMS_PHAS_MOD_PHAS</a>, 
<a class="el" href="_k_s_foundation_8h.html#afbfc330f4f27194b4e27753383464227a385b4332bc937b39f58986df5422adba">KS_SELRF_SMS_PHAS_MOD_AMPL</a>, 
<a class="el" href="_k_s_foundation_8h.html#afbfc330f4f27194b4e27753383464227a4053b2f4fe4f8d2d7031cdb0041966fc">KS_SELRF_SMS_PHAS_MOD_QUAD</a>, 
<br />
&#160;&#160;<a class="el" href="_k_s_foundation_8h.html#afbfc330f4f27194b4e27753383464227a33b64b0c37b4cb048ce208a9c1cf2598">KS_SELRF_SMS_PHAS_MOD_SIZE</a>
<br />
 }</td></tr>
<tr class="separator:afbfc330f4f27194b4e27753383464227"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a99fb83031ce9923c84392b4e92f956b5"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom">{ <a class="el" href="_k_s_foundation_8h.html#a99fb83031ce9923c84392b4e92f956b5a634591f5e0e6042c3ed95c0ae543b402">KS_SEQ_COLLECTION_ALLOWNEW</a>, 
<a class="el" href="_k_s_foundation_8h.html#a99fb83031ce9923c84392b4e92f956b5af64c78cedb5f88bb17738bcf993a7755">KS_SEQ_COLLECTION_LOCKED</a>
 }</td></tr>
<tr class="separator:a99fb83031ce9923c84392b4e92f956b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adfc20623c6ef26b08b99174a1a77323c"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#adfc20623c6ef26b08b99174a1a77323c">ks_enum_grad_scaling_policy</a> { <a class="el" href="_k_s_foundation_8h.html#adfc20623c6ef26b08b99174a1a77323ca18c0e84d66e6f381b509ea483f7cc7fd">KS_GRADWAVE_ABSOLUTE</a>, 
<a class="el" href="_k_s_foundation_8h.html#adfc20623c6ef26b08b99174a1a77323caafce08e3915c706e0851da5f4977192c">KS_GRADWAVE_RELATIVE</a>
 }</td></tr>
<tr class="separator:adfc20623c6ef26b08b99174a1a77323c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a3f102bd49ae8d18baede6827db227e41"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a3f102bd49ae8d18baede6827db227e41">ks_init_read</a> (<a class="el" href="struct_k_s___r_e_a_d.html">KS_READ</a> *read)</td></tr>
<tr class="separator:a3f102bd49ae8d18baede6827db227e41"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8efdbce2fbb4bf21a6fd8983fdd6d5c7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a8efdbce2fbb4bf21a6fd8983fdd6d5c7">ks_init_trap</a> (<a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> *trap)</td></tr>
<tr class="separator:a8efdbce2fbb4bf21a6fd8983fdd6d5c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad0d05a33cfe5de925f28709883a37abc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ad0d05a33cfe5de925f28709883a37abc">ks_init_wait</a> (<a class="el" href="struct_k_s___w_a_i_t.html">KS_WAIT</a> *wait)</td></tr>
<tr class="separator:ad0d05a33cfe5de925f28709883a37abc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa2b37fa5aa0bffff1de8ca29e7c19cc1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#aa2b37fa5aa0bffff1de8ca29e7c19cc1">ks_init_wave</a> (<a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave)</td></tr>
<tr class="separator:aa2b37fa5aa0bffff1de8ca29e7c19cc1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a708ba4291820da3460f6b2c7be287f06"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a708ba4291820da3460f6b2c7be287f06">ks_init_rf</a> (<a class="el" href="struct_k_s___r_f.html">KS_RF</a> *rf)</td></tr>
<tr class="separator:a708ba4291820da3460f6b2c7be287f06"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a784f028a220f82adb610919a51c09abb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a784f028a220f82adb610919a51c09abb">ks_init_sms_info</a> (<a class="el" href="struct_k_s___s_m_s___i_n_f_o.html">KS_SMS_INFO</a> *sms_info)</td></tr>
<tr class="separator:a784f028a220f82adb610919a51c09abb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3cb1d6e472e9061b0f4768d8985a442e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a3cb1d6e472e9061b0f4768d8985a442e">ks_init_selrf</a> (<a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *selrf)</td></tr>
<tr class="separator:a3cb1d6e472e9061b0f4768d8985a442e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0b31ea2b6ff49aa791e7a6cb72c645b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ac0b31ea2b6ff49aa791e7a6cb72c645b">ks_init_readtrap</a> (<a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a> *readtrap)</td></tr>
<tr class="separator:ac0b31ea2b6ff49aa791e7a6cb72c645b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a38e859809526b8d07b17999dc6bbdbe9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a38e859809526b8d07b17999dc6bbdbe9">ks_init_phaser</a> (<a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *phaser)</td></tr>
<tr class="separator:a38e859809526b8d07b17999dc6bbdbe9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad06a3c6b22c54585d66b17eae440e6f7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ad06a3c6b22c54585d66b17eae440e6f7">ks_init_epi</a> (<a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *epi)</td></tr>
<tr class="separator:ad06a3c6b22c54585d66b17eae440e6f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a12bc11f81cb70202d41d89e2bfe245dc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a12bc11f81cb70202d41d89e2bfe245dc">ks_init_dixon_dualreadtrap</a> (<a class="el" href="struct_k_s___d_i_x_o_n___d_u_a_l_r_e_a_d_t_r_a_p.html">KS_DIXON_DUALREADTRAP</a> *dual_readtrap)</td></tr>
<tr class="separator:a12bc11f81cb70202d41d89e2bfe245dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a78c293e0ef0d90d5f8b000bca449a822"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a78c293e0ef0d90d5f8b000bca449a822">ks_init_gradrfctrl</a> (<a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html">KS_GRADRFCTRL</a> *gradrfctrl)</td></tr>
<tr class="separator:a78c293e0ef0d90d5f8b000bca449a822"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae789f20604371eec8036d0a63555d514"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ae789f20604371eec8036d0a63555d514">ks_init_seqcontrol</a> (<a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *seqcontrol)</td></tr>
<tr class="separator:ae789f20604371eec8036d0a63555d514"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a343ddedf4a968d5b4c8d4a17adf95125"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a343ddedf4a968d5b4c8d4a17adf95125">ks_init_seqcollection</a> (<a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html">KS_SEQ_COLLECTION</a> *<a class="el" href="ksgre_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>)</td></tr>
<tr class="separator:a343ddedf4a968d5b4c8d4a17adf95125"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a71229f8ff8869fa6d2c44f34559876ae"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a71229f8ff8869fa6d2c44f34559876ae">ks_init_slewratecontrol</a> (LOG_GRAD *<a class="el" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>, PHYS_GRAD *<a class="el" href="_k_s_foundation_8h.html#af51ba165cbaf874219789beaa48f2464">phygrd</a>, float srfact) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:a71229f8ff8869fa6d2c44f34559876ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9c627057bb753177d7b74e5cd9ba1a46"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a9c627057bb753177d7b74e5cd9ba1a46">ks_eval_addtoseqcollection</a> (<a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html">KS_SEQ_COLLECTION</a> *<a class="el" href="ksgre_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>, <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *seqctrl) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:a9c627057bb753177d7b74e5cd9ba1a46"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae97e87753919a932924b1f4dfcc5ef9c"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ae97e87753919a932924b1f4dfcc5ef9c">ks_eval_addtraptogradrfctrl</a> (<a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html">KS_GRADRFCTRL</a> *gradrfctrl, <a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> *trap) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:ae97e87753919a932924b1f4dfcc5ef9c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a66fd3b5f652cc4cdfd3f99376e365e94"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a66fd3b5f652cc4cdfd3f99376e365e94">ks_eval_addwavetogradrfctrl</a> (<a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html">KS_GRADRFCTRL</a> *gradrfctrl, <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:a66fd3b5f652cc4cdfd3f99376e365e94"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a42bd45a73d5b9e14d8970301a3087de2"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a42bd45a73d5b9e14d8970301a3087de2">ks_eval_addrftogradrfctrl</a> (<a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html">KS_GRADRFCTRL</a> *gradrfctrl, <a class="el" href="struct_k_s___r_f.html">KS_RF</a> *rf) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:a42bd45a73d5b9e14d8970301a3087de2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac984f42cf505d04293f08e4c8286707c"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ac984f42cf505d04293f08e4c8286707c">ks_eval_addreadtogradrfctrl</a> (<a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html">KS_GRADRFCTRL</a> *gradrfctrl, <a class="el" href="struct_k_s___r_e_a_d.html">KS_READ</a> *read) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:ac984f42cf505d04293f08e4c8286707c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aabacf1e670ae0faa4af8cd75d02778e7"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#aabacf1e670ae0faa4af8cd75d02778e7">ks_eval_wait</a> (<a class="el" href="struct_k_s___w_a_i_t.html">KS_WAIT</a> *wait, const char *const desc, int maxduration) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:aabacf1e670ae0faa4af8cd75d02778e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1d053f6867254f3b3acfc0589e490b5f"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a1d053f6867254f3b3acfc0589e490b5f">ks_eval_isirot</a> (<a class="el" href="struct_k_s___i_s_i_r_o_t.html">KS_ISIROT</a> *isirot, const char *const desc, int isinumber) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:a1d053f6867254f3b3acfc0589e490b5f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae51f5ee899509ee52c23002bc1883cac"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ae51f5ee899509ee52c23002bc1883cac">ks_eval_read</a> (<a class="el" href="struct_k_s___r_e_a_d.html">KS_READ</a> *read, const char *const desc) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:ae51f5ee899509ee52c23002bc1883cac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a984e0201828c0e74696118ff6487a303"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a984e0201828c0e74696118ff6487a303">ks_eval_trap_constrained</a> (<a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> *trap, const char *const desc, float ampmax, float slewrate, int minduration) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:a984e0201828c0e74696118ff6487a303"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af40cc818066c7757959bf3712bfc5e6f"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#af40cc818066c7757959bf3712bfc5e6f">ks_eval_trap</a> (<a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> *trap, const char *const desc) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:af40cc818066c7757959bf3712bfc5e6f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb3161153227b411c0518439c243a1ca"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#abb3161153227b411c0518439c243a1ca">ks_eval_trap2</a> (<a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> *trap, const char *const desc) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:abb3161153227b411c0518439c243a1ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ade1d9d7d9be1c9e537b39ef98af04cfe"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ade1d9d7d9be1c9e537b39ef98af04cfe">ks_eval_trap1</a> (<a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> *trap, const char *const desc) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:ade1d9d7d9be1c9e537b39ef98af04cfe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adbc5d161b21228ab4d53c03911916961"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#adbc5d161b21228ab4d53c03911916961">ks_eval_readtrap_constrained</a> (<a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a> *readtrap, const char *const desc, float ampmax, float slewrate) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:adbc5d161b21228ab4d53c03911916961"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0e06bd2e4433a2b508c7610d7056050f"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a0e06bd2e4433a2b508c7610d7056050f">ks_eval_readtrap</a> (<a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a> *readtrap, const char *const desc) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:a0e06bd2e4433a2b508c7610d7056050f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0b3f7a7cc038b40ea4fd457751acd4ff"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a0b3f7a7cc038b40ea4fd457751acd4ff">ks_eval_readtrap2</a> (<a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a> *readtrap, const char *const desc) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:a0b3f7a7cc038b40ea4fd457751acd4ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a203432ea0305ff401753b90d25e41b13"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a203432ea0305ff401753b90d25e41b13">ks_eval_readtrap1</a> (<a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a> *readtrap, const char *const desc) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:a203432ea0305ff401753b90d25e41b13"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a92f07eb83de68841171693b2041cee66"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a92f07eb83de68841171693b2041cee66">ks_eval_phaseviewtable</a> (<a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *phaser)</td></tr>
<tr class="separator:a92f07eb83de68841171693b2041cee66"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7ee5e825257b0e249ac013ba61413755"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a7ee5e825257b0e249ac013ba61413755">ks_eval_phaser_adjustres</a> (<a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *phaser, const char *const desc) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:a7ee5e825257b0e249ac013ba61413755"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a13aea1e02502f8276373928c87d0da3f"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a13aea1e02502f8276373928c87d0da3f">ks_eval_phaser_setaccel</a> (<a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *phaser, int min_acslines, float R) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:a13aea1e02502f8276373928c87d0da3f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af0032a7ae290e65a958fa32c590d0fbf"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#af0032a7ae290e65a958fa32c590d0fbf">ks_eval_phaser_constrained</a> (<a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *phaser, const char *const desc, float ampmax, float slewrate, int minplateautime) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:af0032a7ae290e65a958fa32c590d0fbf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc45c24d1996acd3d95ae2866c5ffb2b"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#acc45c24d1996acd3d95ae2866c5ffb2b">ks_eval_phaser</a> (<a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *phaser, const char *const desc) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:acc45c24d1996acd3d95ae2866c5ffb2b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1977830e4c131a769f095e386ee372f6"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a1977830e4c131a769f095e386ee372f6">ks_eval_phaser2</a> (<a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *phaser, const char *const desc) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:a1977830e4c131a769f095e386ee372f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a89b964cc50ce19bc364370f56b143309"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a89b964cc50ce19bc364370f56b143309">ks_eval_phaser1</a> (<a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *phaser, const char *const desc) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:a89b964cc50ce19bc364370f56b143309"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3369441b24c1df15ba2193aae29d3e11"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a3369441b24c1df15ba2193aae29d3e11">ks_eval_wave</a> (<a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave, const char *const desc, int res, int duration, <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a> waveform) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:a3369441b24c1df15ba2193aae29d3e11"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab970a46d592fc615a856f469532b7de1"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ab970a46d592fc615a856f469532b7de1">ks_eval_mirrorwave</a> (<a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave)</td></tr>
<tr class="separator:ab970a46d592fc615a856f469532b7de1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf06af6c18f52a777919eaef76d6c617"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#aaf06af6c18f52a777919eaef76d6c617">ks_eval_wave_file</a> (<a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave, const char *const desc, int res, int duration, const char *const filename, const char *const format) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:aaf06af6c18f52a777919eaef76d6c617"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad09d10d506854e0913b9f1a30f6f26cc"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ad09d10d506854e0913b9f1a30f6f26cc">ks_eval_rf_sinc</a> (<a class="el" href="struct_k_s___r_f.html">KS_RF</a> *rf, const char *const desc, double bw, double tbw, float flip, int wintype) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:ad09d10d506854e0913b9f1a30f6f26cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a242ef57a69ccff033c43fada5ed0172f"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a242ef57a69ccff033c43fada5ed0172f">ks_eval_rf_secant</a> (<a class="el" href="struct_k_s___r_f.html">KS_RF</a> *rf, const char *const desc, float A0, float tbw, float bw)</td></tr>
<tr class="separator:a242ef57a69ccff033c43fada5ed0172f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae907ed47938039d14cf25b9a9a1b3eb8"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ae907ed47938039d14cf25b9a9a1b3eb8">ks_eval_rf_hard</a> (<a class="el" href="struct_k_s___r_f.html">KS_RF</a> *rf, const char *const desc, int duration, float flip) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:ae907ed47938039d14cf25b9a9a1b3eb8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c0a2264659da3604aca0fdb6429a245"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a3c0a2264659da3604aca0fdb6429a245">ks_eval_rf_hard_optimal_duration</a> (<a class="el" href="struct_k_s___r_f.html">KS_RF</a> *rf, const char *const desc, int order, float flip, float offsetFreq) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:a3c0a2264659da3604aca0fdb6429a245"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af7e14a08fa48500dfc6546b1b3bbad35"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#af7e14a08fa48500dfc6546b1b3bbad35">ks_eval_rf_binomial</a> (<a class="el" href="struct_k_s___r_f.html">KS_RF</a> *rf, const char *const desc, int offResExc, int nPulses, float flip, float offsetFreq) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:af7e14a08fa48500dfc6546b1b3bbad35"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a380824e8f0a73be90f4f4afa69d1d07e"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a380824e8f0a73be90f4f4afa69d1d07e">ks_eval_rfstat</a> (<a class="el" href="struct_k_s___r_f.html">KS_RF</a> *rf) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:a380824e8f0a73be90f4f4afa69d1d07e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a187dd827bc0f2be7f9a00f20802fca91"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a187dd827bc0f2be7f9a00f20802fca91">ks_eval_rf</a> (<a class="el" href="struct_k_s___r_f.html">KS_RF</a> *rf, const char *const desc) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:a187dd827bc0f2be7f9a00f20802fca91"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acb5bc476c9416f2a3d9c975dd80fbb23"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#acb5bc476c9416f2a3d9c975dd80fbb23">ks_eval_rf_relink</a> (<a class="el" href="struct_k_s___r_f.html">KS_RF</a> *rf)</td></tr>
<tr class="separator:acb5bc476c9416f2a3d9c975dd80fbb23"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a38e6cbd20c6ca7972e583360a1fb67c3"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a38e6cbd20c6ca7972e583360a1fb67c3">ks_eval_stretch_rf</a> (<a class="el" href="struct_k_s___r_f.html">KS_RF</a> *rf, float stretch_factor)</td></tr>
<tr class="separator:a38e6cbd20c6ca7972e583360a1fb67c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0c7c713519f3218a3b1afcb6917540c0"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a0c7c713519f3218a3b1afcb6917540c0">ks_eval_seltrap</a> (<a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> *trap, const char *const desc, float slewrate, float slthick, float bw, int rfduration) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:a0c7c713519f3218a3b1afcb6917540c0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a91443aae8a97c4481ba841f1bf3dc13a"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a91443aae8a97c4481ba841f1bf3dc13a">ks_eval_selrf_constrained</a> (<a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *selrf, const char *const desc, float ampmax, float slewrate) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:a91443aae8a97c4481ba841f1bf3dc13a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad77a28d39f423bca930ee2f8f392de17"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ad77a28d39f423bca930ee2f8f392de17">ks_eval_selrf</a> (<a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *selrf, const char *const desc) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:ad77a28d39f423bca930ee2f8f392de17"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:add0c1222947d803bcb4ea5ddcc144749"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#add0c1222947d803bcb4ea5ddcc144749">ks_eval_selrf2</a> (<a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *selrf, const char *const desc) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:add0c1222947d803bcb4ea5ddcc144749"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a86e5857ac625807c2dedd669cb11ede9"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a86e5857ac625807c2dedd669cb11ede9">ks_eval_selrf1</a> (<a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *selrf, const char *const desc) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:a86e5857ac625807c2dedd669cb11ede9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5040306d860c46da494963303f88cab9"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a5040306d860c46da494963303f88cab9">ks_eval_sms_get_phase_modulation</a> (float *sms_phase_modulation, const int sms_multiband_factor, const int sms_phase_modulation_mode) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:a5040306d860c46da494963303f88cab9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f3aa6f06724f8fb3675f7b18600d747"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a6f3aa6f06724f8fb3675f7b18600d747">ks_eval_findb1</a> (<a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *selrf, float max_b1, double scaleFactor, int sms_multiband_factor, int sms_phase_modulation_mode, float sms_slice_gap)</td></tr>
<tr class="separator:a6f3aa6f06724f8fb3675f7b18600d747"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a281427bd4e486330c9f0fc20ed848f19"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a281427bd4e486330c9f0fc20ed848f19">ks_eval_sms_make_multiband</a> (<a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *selrfMB, const <a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *selrf, const int sms_multiband_factor, const int sms_phase_modulation_mode, const float sms_slice_gap, int <a class="el" href="_g_e_required_8e.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:a281427bd4e486330c9f0fc20ed848f19"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abd0ec7d0d685aa5fc55d4a0d109543d3"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#abd0ec7d0d685aa5fc55d4a0d109543d3">ks_eval_sms_calc_slice_gap</a> (int sms_multiband_factor, const SCAN_INFO *org_slice_positions, int nslices, float slthick, float slspace)</td></tr>
<tr class="separator:abd0ec7d0d685aa5fc55d4a0d109543d3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afd7835fa3e8d6eaabd8e53397923eb93"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#afd7835fa3e8d6eaabd8e53397923eb93">ks_eval_sms_calc_caipi_area</a> (int caipi_fov_shift, float sms_slice_gap)</td></tr>
<tr class="separator:afd7835fa3e8d6eaabd8e53397923eb93"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a831be67afd29ffe6449edd3ddd27813f"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a831be67afd29ffe6449edd3ddd27813f">ks_eval_sms_make_pins</a> (<a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *selrfPINS, const <a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *selrf, float sms_slice_gap)</td></tr>
<tr class="separator:a831be67afd29ffe6449edd3ddd27813f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afb0829ca1ee5754e87491f63e872dd15"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#afb0829ca1ee5754e87491f63e872dd15">ks_eval_sms_make_pins_dante</a> (<a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *selrfPINS, const <a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *selrf, float sms_slice_gap)</td></tr>
<tr class="separator:afb0829ca1ee5754e87491f63e872dd15"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aceaba65eaa064b90ef16da5c2cd9591e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#aceaba65eaa064b90ef16da5c2cd9591e">ks_eval_findNearestNeighbourIndex</a> (float value, const float *x, int length)</td></tr>
<tr class="separator:aceaba65eaa064b90ef16da5c2cd9591e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abff3210ecf672ab9eaa08d4bd2316825"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#abff3210ecf672ab9eaa08d4bd2316825">ks_eval_linear_interp1</a> (const float *x, int x_length, const float *y, const float *xx, int xx_length, float *yy)</td></tr>
<tr class="separator:abff3210ecf672ab9eaa08d4bd2316825"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac98e5860a08220295e2a2150b4313c82"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ac98e5860a08220295e2a2150b4313c82">ks_eval_trap2wave</a> (<a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave, const <a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> *trap) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:ac98e5860a08220295e2a2150b4313c82"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a807960a15af4f90154ef8cd8985120ec"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a807960a15af4f90154ef8cd8985120ec">ks_eval_append_two_waves</a> (<a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *first_wave, <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *second_wave) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:a807960a15af4f90154ef8cd8985120ec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3dcaceb00be089a696fc8297573d3ca9"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a3dcaceb00be089a696fc8297573d3ca9">ks_eval_concatenate_waves</a> (int num_waves, <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *target_wave, <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> **waves_to_append) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:a3dcaceb00be089a696fc8297573d3ca9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a36356d324c41fd3b1446443e15d54815"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a36356d324c41fd3b1446443e15d54815">ks_eval_epi_constrained</a> (<a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *epi, const char *const desc, float ampmax, float slewrate) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:a36356d324c41fd3b1446443e15d54815"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a91f5845d9f812af4f2072deefb1823fa"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a91f5845d9f812af4f2072deefb1823fa">ks_eval_epi_setinfo</a> (<a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *epi)</td></tr>
<tr class="separator:a91f5845d9f812af4f2072deefb1823fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a90a2291a373ec98692e078d145473ec9"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a90a2291a373ec98692e078d145473ec9">ks_eval_epi_maxamp_slewrate</a> (float *ampmax, float *slewrate, int xres, float quietnessfactor)</td></tr>
<tr class="separator:a90a2291a373ec98692e078d145473ec9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a77fb9dea403599e8fbbf1fed426ff66e"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a77fb9dea403599e8fbbf1fed426ff66e">ks_eval_epi</a> (<a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *epi, const char *const desc, float quietnessfactor) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:a77fb9dea403599e8fbbf1fed426ff66e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab4c6e9f82b55a3db56765fc22f21b7b5"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ab4c6e9f82b55a3db56765fc22f21b7b5">ks_eval_gradrflimits</a> (<a class="el" href="struct_k_s___s_a_r.html">KS_SAR</a> *sar, <a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html">KS_SEQ_COLLECTION</a> *<a class="el" href="ksgre_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>, float gheatfact)</td></tr>
<tr class="separator:ab4c6e9f82b55a3db56765fc22f21b7b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af38e51235c90bff510cae4ee1955dd95"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#af38e51235c90bff510cae4ee1955dd95">ks_eval_mintr</a> (int nslices, <a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html">KS_SEQ_COLLECTION</a> *<a class="el" href="ksgre_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>, float gheatfact, int(*play_loop)(int, int, void **), int nargs, void **args)</td></tr>
<tr class="separator:af38e51235c90bff510cae4ee1955dd95"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a86ab45a04531e1e9353667c9ca6d5fbd"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a86ab45a04531e1e9353667c9ca6d5fbd">ks_eval_maxslicespertr</a> (int TR, <a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html">KS_SEQ_COLLECTION</a> *<a class="el" href="ksgre_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>, float gheatfact, int(*play_loop)(int, int, void **), int nargs, void **args)</td></tr>
<tr class="separator:a86ab45a04531e1e9353667c9ca6d5fbd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a75c403072633f5a42fe364af4454b245"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a75c403072633f5a42fe364af4454b245">ks_eval_seqctrl_setminduration</a> (<a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *seqctrl, int mindur)</td></tr>
<tr class="separator:a75c403072633f5a42fe364af4454b245"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a607b7d799ca95db1431027fe74b4586b"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a607b7d799ca95db1431027fe74b4586b">ks_eval_seqctrl_setduration</a> (<a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *seqctrl, int dur)</td></tr>
<tr class="separator:a607b7d799ca95db1431027fe74b4586b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab5e4f217425665a562737662e46f1ba1"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ab5e4f217425665a562737662e46f1ba1">ks_eval_seqcollection_durations_setminimum</a> (<a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html">KS_SEQ_COLLECTION</a> *<a class="el" href="ksgre_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:ab5e4f217425665a562737662e46f1ba1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3de8410411e4caddbabb57b40fc3abe1"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a3de8410411e4caddbabb57b40fc3abe1">ks_eval_seqcollection_durations_atleastminimum</a> (<a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html">KS_SEQ_COLLECTION</a> *<a class="el" href="ksgre_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:a3de8410411e4caddbabb57b40fc3abe1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acb34cd9d6c99193829696596b4d0271f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#acb34cd9d6c99193829696596b4d0271f">ks_eval_seqcollection_resetninst</a> (<a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html">KS_SEQ_COLLECTION</a> *<a class="el" href="ksgre_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>)</td></tr>
<tr class="separator:acb34cd9d6c99193829696596b4d0271f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac39743a45d5ad00147e24218523f88c8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ac39743a45d5ad00147e24218523f88c8">ks_print_seqcollection</a> (<a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html">KS_SEQ_COLLECTION</a> *<a class="el" href="ksgre_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>, FILE *fp)</td></tr>
<tr class="separator:ac39743a45d5ad00147e24218523f88c8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeb213f86f7f6172f91b3ab69a518afe7"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#aeb213f86f7f6172f91b3ab69a518afe7">ks_eval_seqcollection_gettotalduration</a> (<a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html">KS_SEQ_COLLECTION</a> *<a class="el" href="ksgre_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>)</td></tr>
<tr class="separator:aeb213f86f7f6172f91b3ab69a518afe7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0613fe6eed79703a67f679dec6a19b50"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a0613fe6eed79703a67f679dec6a19b50">ks_eval_seqcollection_gettotalminduration</a> (<a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html">KS_SEQ_COLLECTION</a> *<a class="el" href="ksgre_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>)</td></tr>
<tr class="separator:a0613fe6eed79703a67f679dec6a19b50"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a736f7a360ad913bc8295ee2bddc6525e"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a736f7a360ad913bc8295ee2bddc6525e">ks_eval_seqcollection2rfpulse</a> (RF_PULSE *<a class="el" href="grad__rf__empty_8h.html#a53f2690e6af35d559b80182016987d22">rfpulse</a>, <a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html">KS_SEQ_COLLECTION</a> *<a class="el" href="ksgre_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>)</td></tr>
<tr class="separator:a736f7a360ad913bc8295ee2bddc6525e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acf397088ddce91c4fc821e59fa0a321d"><td class="memItemLeft" align="right" valign="top">GRAD_PULSE&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#acf397088ddce91c4fc821e59fa0a321d">ks_eval_makegradpulse</a> (<a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> *trp, int gradchoice)</td></tr>
<tr class="separator:acf397088ddce91c4fc821e59fa0a321d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad4a047990c5929bff018d4ed06a28116"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ad4a047990c5929bff018d4ed06a28116">ks_read_header_pool</a> (int *exam_number, int *series_number, int *run_number)</td></tr>
<tr class="separator:ad4a047990c5929bff018d4ed06a28116"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac43539de32839ff2bf2166f69c04e44d"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ac43539de32839ff2bf2166f69c04e44d">ks_calc_nextpow2</a> (unsigned int x)</td></tr>
<tr class="separator:ac43539de32839ff2bf2166f69c04e44d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0b690996b2c3e240bfa03e435feb4bc9"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a0b690996b2c3e240bfa03e435feb4bc9">ks_calc_roundupms</a> (int time)</td></tr>
<tr class="separator:a0b690996b2c3e240bfa03e435feb4bc9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa6f2602e2b975430d4fb39788d82ba9d"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#aa6f2602e2b975430d4fb39788d82ba9d">ks_calc_filter</a> (FILTER_INFO *echo_filter, int tsp, int duration) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:aa6f2602e2b975430d4fb39788d82ba9d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a955f51280beb0915d42853ad14eee700"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a955f51280beb0915d42853ad14eee700">ks_calc_bw2tsp</a> (float bw)</td></tr>
<tr class="separator:a955f51280beb0915d42853ad14eee700"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae93598f859077f2c60de6be3953dc33c"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ae93598f859077f2c60de6be3953dc33c">ks_calc_tsp2bw</a> (int tsp)</td></tr>
<tr class="separator:ae93598f859077f2c60de6be3953dc33c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a02dad9317286e1cb7c4a9660f5e524ea"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a02dad9317286e1cb7c4a9660f5e524ea">ks_calc_trap_time2area</a> (<a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> *trap, float area)</td></tr>
<tr class="separator:a02dad9317286e1cb7c4a9660f5e524ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c1c3b628e3f08dca4a169d80b7d6361"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a7c1c3b628e3f08dca4a169d80b7d6361">ks_calc_nearestbw</a> (float bw)</td></tr>
<tr class="separator:a7c1c3b628e3f08dca4a169d80b7d6361"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2a7dd481805414088d844758e9b40419"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a2a7dd481805414088d844758e9b40419">ks_calc_max_rbw</a> (float ampmax, float fov)</td></tr>
<tr class="separator:a2a7dd481805414088d844758e9b40419"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ffabfee55fc92b35511d263092f6ea9"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a6ffabfee55fc92b35511d263092f6ea9">ks_calc_minfov</a> (float ampmax, int tsp)</td></tr>
<tr class="separator:a6ffabfee55fc92b35511d263092f6ea9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a296e894800a7f533250c6ae58e625da9"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a296e894800a7f533250c6ae58e625da9">ks_calc_minslthick</a> (float bw)</td></tr>
<tr class="separator:a296e894800a7f533250c6ae58e625da9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3957455e4a8980ae7cf4dc1edefa5a4e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a3957455e4a8980ae7cf4dc1edefa5a4e">ks_calc_mintsp</a> (float ampmax, float fov)</td></tr>
<tr class="separator:a3957455e4a8980ae7cf4dc1edefa5a4e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeb07c1278254f0a40622fbbe10566f57"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#aeb07c1278254f0a40622fbbe10566f57">ks_calc_fov2gradareapixel</a> (float fov)</td></tr>
<tr class="separator:aeb07c1278254f0a40622fbbe10566f57"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ab9211cdefcc0e167b71289e23829bc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a6ab9211cdefcc0e167b71289e23829bc">ks_phaseencoding_init_tgt</a> (<a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *phaseenc_plan_ptr)</td></tr>
<tr class="separator:a6ab9211cdefcc0e167b71289e23829bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9712828cb11bdaf20671ac4e43c80d3a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html">KS_PHASEENCODING_COORD</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a9712828cb11bdaf20671ac4e43c80d3a">ks_phaseencoding_get</a> (const <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *phaseenc_plan_ptr, int echo, int shot)</td></tr>
<tr class="separator:a9712828cb11bdaf20671ac4e43c80d3a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb524977b3e7a48a58dad2370166df9b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#abb524977b3e7a48a58dad2370166df9b">ks_phaseencoding_set</a> (<a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *phaseenc_plan_ptr, int echo, int shot, int ky, int kz)</td></tr>
<tr class="separator:abb524977b3e7a48a58dad2370166df9b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab37bdbd70185618b80d077f99b253616"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ab37bdbd70185618b80d077f99b253616">ks_phaseencoding_print</a> (const <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *phaseenc_plan_ptr)</td></tr>
<tr class="separator:ab37bdbd70185618b80d077f99b253616"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad3b39ba8c626f4580806078dc4f4b211"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ad3b39ba8c626f4580806078dc4f4b211">ks_phaseencoding_resize</a> (<a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *phaseenc_plan_ptr, int etl, int num_shots)</td></tr>
<tr class="separator:ad3b39ba8c626f4580806078dc4f4b211"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa887db0578a0780ccd7ed143e858588c"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#aa887db0578a0780ccd7ed143e858588c">ks_phaseencoding_generate_simple</a> (<a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *phaseenc_plan_ptr, const char *const desc, <a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *phaser, <a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *zphaser)</td></tr>
<tr class="separator:aa887db0578a0780ccd7ed143e858588c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa067bf0cb6e0bfc4a1d39f4fe760f213"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#aa067bf0cb6e0bfc4a1d39f4fe760f213">ks_phaseencoding_generate_simple_ellipse</a> (<a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *phaseenc_plan_ptr, const char *const desc, <a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *phaser, <a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *zphaser)</td></tr>
<tr class="separator:aa067bf0cb6e0bfc4a1d39f4fe760f213"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad6d4710baf0864b0e04ba55908a52666"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ad6d4710baf0864b0e04ba55908a52666">ks_fse_calcecho</a> (double *bestecho, double *optecho, <a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *pe, int TE, int etl, int esp)</td></tr>
<tr class="separator:ad6d4710baf0864b0e04ba55908a52666"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6101f1a037684c71a6c5d654671824f9"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a6101f1a037684c71a6c5d654671824f9">ks_phaseencoding_generate_2Dfse</a> (<a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *phaseenc_plan_ptr, const char *const desc, <a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *phaser, <a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *zphaser, int TE, int etl, int esp)</td></tr>
<tr class="separator:a6101f1a037684c71a6c5d654671824f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af63cac5b01cd2842a511f6e8e99472e9"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#af63cac5b01cd2842a511f6e8e99472e9">ks_phaseencoding_generate_epi</a> (<a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *phaseenc_plan_ptr, const char *const desc, <a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *epitrain, int blipsign, int numkyshots, int numsegments, int caipi)</td></tr>
<tr class="separator:af63cac5b01cd2842a511f6e8e99472e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a99557514f220cf0e97668286792e79cb"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a99557514f220cf0e97668286792e79cb">ks_calc_sliceplan</a> (<a class="el" href="struct_k_s___s_l_i_c_e___p_l_a_n.html">KS_SLICE_PLAN</a> *slice_plan, int nslices, int slperpass)</td></tr>
<tr class="separator:a99557514f220cf0e97668286792e79cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7f48f728f188959481f3a203f7ffe853"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a7f48f728f188959481f3a203f7ffe853">ks_calc_sliceplan_interleaved</a> (<a class="el" href="struct_k_s___s_l_i_c_e___p_l_a_n.html">KS_SLICE_PLAN</a> *slice_plan, int nslices, int slperpass, int inpass_interleaves)</td></tr>
<tr class="separator:a7f48f728f188959481f3a203f7ffe853"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aac2f0903f17dde40e22ddbf22cbd6986"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#aac2f0903f17dde40e22ddbf22cbd6986">ks_calc_sliceplan_sms</a> (<a class="el" href="struct_k_s___s_l_i_c_e___p_l_a_n.html">KS_SLICE_PLAN</a> *slice_plan, int nslices, int slperpass, int multiband_factor)</td></tr>
<tr class="separator:aac2f0903f17dde40e22ddbf22cbd6986"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8f3e58077353097578c86efc198e8a6a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a8f3e58077353097578c86efc198e8a6a">ks_calc_slice_acquisition_order_smssingleacq</a> (DATA_ACQ_ORDER *dacq, int nslices)</td></tr>
<tr class="separator:a8f3e58077353097578c86efc198e8a6a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1b518a3194e4b40d969342a8c6c87357"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a1b518a3194e4b40d969342a8c6c87357">ks_calc_sms_min_gap</a> (DATA_ACQ_ORDER *dacq, int nslices)</td></tr>
<tr class="separator:a1b518a3194e4b40d969342a8c6c87357"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4052b13d56c45955a6bd6c8f57f4cbc6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a4052b13d56c45955a6bd6c8f57f4cbc6">ks_print_sliceplan</a> (const <a class="el" href="struct_k_s___s_l_i_c_e___p_l_a_n.html">KS_SLICE_PLAN</a> slice_plan, FILE *fp)</td></tr>
<tr class="separator:a4052b13d56c45955a6bd6c8f57f4cbc6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a01d67d3faa8f2088f82af10aa0a28af0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a01d67d3faa8f2088f82af10aa0a28af0">ks_print_waveform</a> (const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a> waveform, char *filename, int res)</td></tr>
<tr class="separator:a01d67d3faa8f2088f82af10aa0a28af0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3f19152aa56909ba2178e0266cce0928"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a3f19152aa56909ba2178e0266cce0928">ks_print_read</a> (<a class="el" href="struct_k_s___r_e_a_d.html">KS_READ</a> read, FILE *fp)</td></tr>
<tr class="separator:a3f19152aa56909ba2178e0266cce0928"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1abdbad21b51b6554580840ef8376e0d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a1abdbad21b51b6554580840ef8376e0d">ks_print_trap</a> (<a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> trap, FILE *fp)</td></tr>
<tr class="separator:a1abdbad21b51b6554580840ef8376e0d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a13a8f8b8bd8fccfc5bae9cef555053ad"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a13a8f8b8bd8fccfc5bae9cef555053ad">ks_print_readtrap</a> (<a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a> readtrap, FILE *fp)</td></tr>
<tr class="separator:a13a8f8b8bd8fccfc5bae9cef555053ad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f5dffeec30279ac23c5f12ecb868575"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a4f5dffeec30279ac23c5f12ecb868575">ks_print_phaser</a> (<a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> phaser, FILE *fp)</td></tr>
<tr class="separator:a4f5dffeec30279ac23c5f12ecb868575"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a11d7a5bdd7f74891cb50bff1401a339a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a11d7a5bdd7f74891cb50bff1401a339a">ks_print_epi</a> (<a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> epi, FILE *fp)</td></tr>
<tr class="separator:a11d7a5bdd7f74891cb50bff1401a339a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af2b15d59387f060a3efb5841db53b1fe"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#af2b15d59387f060a3efb5841db53b1fe">ks_print_rf</a> (<a class="el" href="struct_k_s___r_f.html">KS_RF</a> rf, FILE *fp)</td></tr>
<tr class="separator:af2b15d59387f060a3efb5841db53b1fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a609ddd32fdfbfa689c413d494a55d62c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a609ddd32fdfbfa689c413d494a55d62c">ks_print_rfpulse</a> (RF_PULSE <a class="el" href="grad__rf__empty_8h.html#a53f2690e6af35d559b80182016987d22">rfpulse</a>, FILE *fp)</td></tr>
<tr class="separator:a609ddd32fdfbfa689c413d494a55d62c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a29a4c870ed4dcbee78d35bbbce9722b4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a29a4c870ed4dcbee78d35bbbce9722b4">ks_print_selrf</a> (<a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> selrf, FILE *fp)</td></tr>
<tr class="separator:a29a4c870ed4dcbee78d35bbbce9722b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a707df661a5fd67b70fa6da357573133c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a707df661a5fd67b70fa6da357573133c">ks_print_gradrfctrl</a> (<a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html">KS_GRADRFCTRL</a> gradrfctrl, FILE *fp)</td></tr>
<tr class="separator:a707df661a5fd67b70fa6da357573133c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab08efc665b1013671852ab756840e1a5"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a> (const char *format,...) __attribute__((format(printf</td></tr>
<tr class="separator:ab08efc665b1013671852ab756840e1a5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a763989ed463b618658bef9c2485051eb"><td class="memItemLeft" align="right" valign="top">STATUS STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a763989ed463b618658bef9c2485051eb">ks_dbg</a> (const char *format,...) __attribute__((format(printf</td></tr>
<tr class="separator:a763989ed463b618658bef9c2485051eb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4fe0c2fc567d0a9be5ec8d7e55b21a42"><td class="memItemLeft" align="right" valign="top">STATUS STATUS int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a4fe0c2fc567d0a9be5ec8d7e55b21a42">ks_syslimits_hasICEhardware</a> ()</td></tr>
<tr class="separator:a4fe0c2fc567d0a9be5ec8d7e55b21a42"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0077bec1cb7fd1cccf8f35a978242ff7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a0077bec1cb7fd1cccf8f35a978242ff7">ks_dbg_reset</a> ()</td></tr>
<tr class="separator:a0077bec1cb7fd1cccf8f35a978242ff7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5c919c547ee396b18069ed505c695139"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a5c919c547ee396b18069ed505c695139">ks_syslimits_ampmax</a> (LOG_GRAD <a class="el" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>)</td></tr>
<tr class="separator:a5c919c547ee396b18069ed505c695139"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4b3a3095702bf551f318ef9f03ff3403"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a4b3a3095702bf551f318ef9f03ff3403">ks_syslimits_ampmax2</a> (LOG_GRAD <a class="el" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>)</td></tr>
<tr class="separator:a4b3a3095702bf551f318ef9f03ff3403"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a431729c0ecf331b33d84db72a80debaf"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a431729c0ecf331b33d84db72a80debaf">ks_syslimits_ampmax1</a> (LOG_GRAD <a class="el" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>)</td></tr>
<tr class="separator:a431729c0ecf331b33d84db72a80debaf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a72446af13d4f4cd0dc9caf51bd58f88e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a72446af13d4f4cd0dc9caf51bd58f88e">ks_syslimits_ramptimemax</a> (LOG_GRAD <a class="el" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>)</td></tr>
<tr class="separator:a72446af13d4f4cd0dc9caf51bd58f88e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a712d215e449900b4fc566fefff51b4e9"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a712d215e449900b4fc566fefff51b4e9">ks_syslimits_slewrate</a> (LOG_GRAD <a class="el" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>)</td></tr>
<tr class="separator:a712d215e449900b4fc566fefff51b4e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a53d792432e1fd99fa597314576fa9e49"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a53d792432e1fd99fa597314576fa9e49">ks_syslimits_slewrate2</a> (LOG_GRAD <a class="el" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>)</td></tr>
<tr class="separator:a53d792432e1fd99fa597314576fa9e49"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaeea7c06ce455978cce287cf28c22a4f"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#aaeea7c06ce455978cce287cf28c22a4f">ks_syslimits_slewrate1</a> (LOG_GRAD <a class="el" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>)</td></tr>
<tr class="separator:aaeea7c06ce455978cce287cf28c22a4f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa65115d54842eeffc47a1b324caa62ab"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#aa65115d54842eeffc47a1b324caa62ab">ks_syslimits_gradtarget</a> (LOG_GRAD <a class="el" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>, WF_PROCESSOR board)</td></tr>
<tr class="separator:aa65115d54842eeffc47a1b324caa62ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a10d9f68352843144a68fb95081780b7a"><td class="memItemLeft" align="right" valign="top">short&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a10d9f68352843144a68fb95081780b7a">ks_phase_radians2hw</a> (float radphase)</td></tr>
<tr class="separator:a10d9f68352843144a68fb95081780b7a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc2435255232dccd6cd217bc605422cd"><td class="memItemLeft" align="right" valign="top">short&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#acc2435255232dccd6cd217bc605422cd">ks_phase_degrees2hw</a> (float degphase)</td></tr>
<tr class="separator:acc2435255232dccd6cd217bc605422cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9261718b4f0e64bab0da0b9e9c2c02f0"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a9261718b4f0e64bab0da0b9e9c2c02f0">ks_calc_selgradamp</a> (float rfbw, float slthick)</td></tr>
<tr class="separator:a9261718b4f0e64bab0da0b9e9c2c02f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa672c7e32ce3bce20534fa814901e720"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#aa672c7e32ce3bce20534fa814901e720">ks_wave_res</a> (const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave)</td></tr>
<tr class="separator:aa672c7e32ce3bce20534fa814901e720"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adf7aec11f0fecce133070402558215ff"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#adf7aec11f0fecce133070402558215ff">ks_waveform_max</a> (const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a> waveform, int res)</td></tr>
<tr class="separator:adf7aec11f0fecce133070402558215ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8309ba456fc3e23a10111a1439b13e21"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a8309ba456fc3e23a10111a1439b13e21">ks_wave_max</a> (const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave)</td></tr>
<tr class="separator:a8309ba456fc3e23a10111a1439b13e21"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb6bc5f956fac809f44006a5b2698ee6"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#abb6bc5f956fac809f44006a5b2698ee6">ks_waveform_min</a> (const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a> waveform, int res)</td></tr>
<tr class="separator:abb6bc5f956fac809f44006a5b2698ee6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adce100a7702e71bfb10377f1652465a2"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#adce100a7702e71bfb10377f1652465a2">ks_wave_min</a> (const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave)</td></tr>
<tr class="separator:adce100a7702e71bfb10377f1652465a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf8e5bff3973c32360bc0e1505db61bc"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#abf8e5bff3973c32360bc0e1505db61bc">ks_waveform_absmax</a> (const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a> waveform, int res)</td></tr>
<tr class="separator:abf8e5bff3973c32360bc0e1505db61bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a838f4d91abbaf80203c3c6cc3797d036"><td class="memItemLeft" align="right" valign="top">short&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a838f4d91abbaf80203c3c6cc3797d036">ks_iwave_absmax</a> (const <a class="el" href="_k_s_foundation_8h.html#abba996c24da629eea72eecbd9a22a873">KS_IWAVE</a> waveform, int res)</td></tr>
<tr class="separator:a838f4d91abbaf80203c3c6cc3797d036"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2bfec427bf5a8966edf279b2eba23396"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a2bfec427bf5a8966edf279b2eba23396">ks_wave_absmax</a> (const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave)</td></tr>
<tr class="separator:a2bfec427bf5a8966edf279b2eba23396"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7e9a8aad6f58220e83c48dd10d9a5e3c"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a7e9a8aad6f58220e83c48dd10d9a5e3c">ks_waveform_area</a> (const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a> waveform, int start, int end, int dwelltime)</td></tr>
<tr class="separator:a7e9a8aad6f58220e83c48dd10d9a5e3c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ed01e2c72db1252e516b9c2b098bbee"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a1ed01e2c72db1252e516b9c2b098bbee">ks_wave_area</a> (const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave, int start, int end)</td></tr>
<tr class="separator:a1ed01e2c72db1252e516b9c2b098bbee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a836fc0fca52fac39fbecc05b3f1b2329"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a836fc0fca52fac39fbecc05b3f1b2329">ks_waveform_sum</a> (const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a> waveform, int res)</td></tr>
<tr class="separator:a836fc0fca52fac39fbecc05b3f1b2329"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a147f6b9c40c1978fde2395ac2a97a88f"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a147f6b9c40c1978fde2395ac2a97a88f">ks_wave_sum</a> (const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave)</td></tr>
<tr class="separator:a147f6b9c40c1978fde2395ac2a97a88f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5128fc94664d4d81425a461ea4a73b09"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a5128fc94664d4d81425a461ea4a73b09">ks_waveform_norm</a> (const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a> waveform, int res)</td></tr>
<tr class="separator:a5128fc94664d4d81425a461ea4a73b09"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4bc0ca8d038d6083ad28d01f37cb946c"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a4bc0ca8d038d6083ad28d01f37cb946c">ks_wave_norm</a> (const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave)</td></tr>
<tr class="separator:a4bc0ca8d038d6083ad28d01f37cb946c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a01ad5d5e6870a3b956943a73b348d69d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a01ad5d5e6870a3b956943a73b348d69d">ks_waveform_cumsum</a> (<a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a> cumsumwaveform, const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a> waveform, int res)</td></tr>
<tr class="separator:a01ad5d5e6870a3b956943a73b348d69d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af2f69e088a1a8833c9b3e1cad2119321"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#af2f69e088a1a8833c9b3e1cad2119321">ks_wave_cumsum</a> (<a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *cumsumwave, const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave)</td></tr>
<tr class="separator:af2f69e088a1a8833c9b3e1cad2119321"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a183b6f1b3697030d122bb4a0cfda5619"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a183b6f1b3697030d122bb4a0cfda5619">ks_waveform_multiply</a> (<a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a> waveform_mod, const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a> waveform, int res)</td></tr>
<tr class="separator:a183b6f1b3697030d122bb4a0cfda5619"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a89145883bc5e8fcf4a93002535aa50a3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a89145883bc5e8fcf4a93002535aa50a3">ks_wave_multiply</a> (<a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave_mod, const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave)</td></tr>
<tr class="separator:a89145883bc5e8fcf4a93002535aa50a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a23f59d14bb955dd5a9e19bb705cb70"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a0a23f59d14bb955dd5a9e19bb705cb70">ks_waveform_add</a> (<a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a> waveform_mod, const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a> waveform, int res)</td></tr>
<tr class="separator:a0a23f59d14bb955dd5a9e19bb705cb70"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a74cda06697c45a3c9914e6b091be5efb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a74cda06697c45a3c9914e6b091be5efb">ks_wave_add</a> (<a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave_mod, const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave)</td></tr>
<tr class="separator:a74cda06697c45a3c9914e6b091be5efb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ace0cae3befbb3608319f34a61657bc26"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ace0cae3befbb3608319f34a61657bc26">ks_waveform_multiplyval</a> (<a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a> waveform, float val, int res)</td></tr>
<tr class="separator:ace0cae3befbb3608319f34a61657bc26"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a23b3d305df1e2ad0563f8a2fea2330df"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a23b3d305df1e2ad0563f8a2fea2330df">ks_wave_multiplyval</a> (<a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave, float val)</td></tr>
<tr class="separator:a23b3d305df1e2ad0563f8a2fea2330df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae029b50a84f55155fdca946ec828e3fc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ae029b50a84f55155fdca946ec828e3fc">ks_waveform_addval</a> (<a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a> waveform, float val, int res)</td></tr>
<tr class="separator:ae029b50a84f55155fdca946ec828e3fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a66a14bcaf8bf19a334866090c1f2ee49"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a66a14bcaf8bf19a334866090c1f2ee49">ks_wave_addval</a> (<a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave, float val)</td></tr>
<tr class="separator:a66a14bcaf8bf19a334866090c1f2ee49"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acce0c0e51575bd8ce71eafcf92e153e0"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#acce0c0e51575bd8ce71eafcf92e153e0">ks_waveform2iwave</a> (<a class="el" href="_k_s_foundation_8h.html#abba996c24da629eea72eecbd9a22a873">KS_IWAVE</a> iwave, const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a> waveform, int res, int board) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:acce0c0e51575bd8ce71eafcf92e153e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a016372aaa6f16b986000c56b9792fefd"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a016372aaa6f16b986000c56b9792fefd">ks_wave2iwave</a> (<a class="el" href="_k_s_foundation_8h.html#abba996c24da629eea72eecbd9a22a873">KS_IWAVE</a> iwave, const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave, int board) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:a016372aaa6f16b986000c56b9792fefd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a220c36b2fe5f7910508f38d66cfd6335"><td class="memItemLeft" align="right" valign="top">WF_PULSE *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a220c36b2fe5f7910508f38d66cfd6335">ks_pg_echossp</a> (WF_PULSE *echo, char *suffix)</td></tr>
<tr class="separator:a220c36b2fe5f7910508f38d66cfd6335"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a61651c54c4dfd4388fc939d804a9964b"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a61651c54c4dfd4388fc939d804a9964b">ks_pg_trap</a> (<a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> *trap, <a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> loc, <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *ctrl) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:a61651c54c4dfd4388fc939d804a9964b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5b50d0ffcc69966c42bceb7e67c70cbf"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a5b50d0ffcc69966c42bceb7e67c70cbf">ks_pg_read</a> (<a class="el" href="struct_k_s___r_e_a_d.html">KS_READ</a> *read, int pos, <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *ctrl) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:a5b50d0ffcc69966c42bceb7e67c70cbf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a094595db960708064dc1b8b645c4be71"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a094595db960708064dc1b8b645c4be71">ks_pg_phaser</a> (<a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *phaser, <a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> loc, <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *ctrl) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:a094595db960708064dc1b8b645c4be71"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a21198913d5b1603f03a5e5d61d00408c"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a21198913d5b1603f03a5e5d61d00408c">ks_pg_readtrap</a> (<a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a> *readtrap, <a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> loc, <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *ctrl) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:a21198913d5b1603f03a5e5d61d00408c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc06ade569c7b85c1aa5026fc2e1c710"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#afc06ade569c7b85c1aa5026fc2e1c710">ks_pg_wave</a> (<a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave, <a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> loc, <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *ctrl) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:afc06ade569c7b85c1aa5026fc2e1c710"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a853cff23395e570cc88aa3405b78c3a9"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a853cff23395e570cc88aa3405b78c3a9">ks_pg_rf</a> (<a class="el" href="struct_k_s___r_f.html">KS_RF</a> *rf, <a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> loc, <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *ctrl) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:a853cff23395e570cc88aa3405b78c3a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6e727c3449c63278cbfc2e35cfcfa9fa"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a6e727c3449c63278cbfc2e35cfcfa9fa">ks_pg_selrf</a> (<a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *selrf, <a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> loc, <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *ctrl) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:a6e727c3449c63278cbfc2e35cfcfa9fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af03615e60a63da6332e04a37aa801984"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#af03615e60a63da6332e04a37aa801984">ks_pg_wait</a> (<a class="el" href="struct_k_s___w_a_i_t.html">KS_WAIT</a> *wait, <a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> loc, <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *ctrl) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:af03615e60a63da6332e04a37aa801984"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a67d0db25c6c69ee17a9b4b0ee79b7fb7"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a67d0db25c6c69ee17a9b4b0ee79b7fb7">ks_pg_isirot</a> (<a class="el" href="struct_k_s___i_s_i_r_o_t.html">KS_ISIROT</a> *isirot, SCAN_INFO scan_info, int pos, void *rotfun, <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *ctrl) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:a67d0db25c6c69ee17a9b4b0ee79b7fb7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f4a69e9025fa9af8593354660731487"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a4f4a69e9025fa9af8593354660731487">ks_pg_epi_dephasers</a> (<a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *epi, <a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> loc, <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *ctrl) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:a4f4a69e9025fa9af8593354660731487"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeaa0bf154295359cf8e84cedfbfdbe8b"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#aeaa0bf154295359cf8e84cedfbfdbe8b">ks_pg_epi_rephasers</a> (<a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *epi, <a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> loc, <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *ctrl) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:aeaa0bf154295359cf8e84cedfbfdbe8b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0d7fe8d68dfb536eb3e903b1ab58e615"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a0d7fe8d68dfb536eb3e903b1ab58e615">ks_pg_epi_echo</a> (<a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *epi, <a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> loc, <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *ctrl) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:a0d7fe8d68dfb536eb3e903b1ab58e615"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a804f4f4b870338386e1dea3a877f5bd2"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a804f4f4b870338386e1dea3a877f5bd2">ks_pg_epi</a> (<a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *epi, <a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> loc, <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *ctrl) <a class="el" href="_k_s_foundation_8h.html#a4e0e2d9e1ee0f401844b5b6ff8338f82">WARN_UNUSED_RESULT</a></td></tr>
<tr class="separator:a804f4f4b870338386e1dea3a877f5bd2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7a01a25fab5445b8ba0d31def1d8eb22"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a7a01a25fab5445b8ba0d31def1d8eb22">ks_mat4_zero</a> (<a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a> m)</td></tr>
<tr class="separator:a7a01a25fab5445b8ba0d31def1d8eb22"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3cf10f4e08ef58cf5122ed6bbef18cd8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a3cf10f4e08ef58cf5122ed6bbef18cd8">ks_mat4_identity</a> (<a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a> m)</td></tr>
<tr class="separator:a3cf10f4e08ef58cf5122ed6bbef18cd8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af4ff614f0e15263516162ae891a85e3b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#af4ff614f0e15263516162ae891a85e3b">ks_mat4_print</a> (const <a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a> m)</td></tr>
<tr class="separator:af4ff614f0e15263516162ae891a85e3b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7860cb28ef3d14b565548f0cf546ef9b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a7860cb28ef3d14b565548f0cf546ef9b">ks_mat4_multiply</a> (<a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a> lhs, const <a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a> rhs_left, const <a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a> rhs_right)</td></tr>
<tr class="separator:a7860cb28ef3d14b565548f0cf546ef9b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa73a59f910febec479331b756b4e0b0b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#aa73a59f910febec479331b756b4e0b0b">ks_mat4_invert</a> (<a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a> lhs, const <a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a> rhs)</td></tr>
<tr class="separator:aa73a59f910febec479331b756b4e0b0b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a72637d90aca1ebbbbc0fa6b9fa905070"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a72637d90aca1ebbbbc0fa6b9fa905070">ks_mat4_setgeometry</a> (<a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a> lhs, float x, float y, float z, float xr, float yr, float zr)</td></tr>
<tr class="separator:a72637d90aca1ebbbbc0fa6b9fa905070"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a52b5ac8e52a9813764edfb25fc43842e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a52b5ac8e52a9813764edfb25fc43842e">ks_mat4_setrotation1axis</a> (<a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a> rhs, float rot, char axis)</td></tr>
<tr class="separator:a52b5ac8e52a9813764edfb25fc43842e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ace371e00b197f1e2810b8d113b367266"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ace371e00b197f1e2810b8d113b367266">ks_mat4_extractrotation</a> (<a class="el" href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a> R, const <a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a> M)</td></tr>
<tr class="separator:ace371e00b197f1e2810b8d113b367266"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5367cf93c8126b5e1ebe7af1455bd12f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a5367cf93c8126b5e1ebe7af1455bd12f">ks_mat4_extracttranslation</a> (double *T, const <a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a> M)</td></tr>
<tr class="separator:a5367cf93c8126b5e1ebe7af1455bd12f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a90b2a40a2ec0d6386acd1a882826db29"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a90b2a40a2ec0d6386acd1a882826db29">ks_mat3_identity</a> (<a class="el" href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a> m)</td></tr>
<tr class="separator:a90b2a40a2ec0d6386acd1a882826db29"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef9748ef561f24658a823f99823bf9f3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#aef9748ef561f24658a823f99823bf9f3">ks_mat3_multiply</a> (<a class="el" href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a> lhs, const <a class="el" href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a> rhs_left, const <a class="el" href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a> rhs_right)</td></tr>
<tr class="separator:aef9748ef561f24658a823f99823bf9f3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa256047bba2d4ee8f8b0244323dc4d65"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#aa256047bba2d4ee8f8b0244323dc4d65">ks_mat3_print</a> (const <a class="el" href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a> m)</td></tr>
<tr class="separator:aa256047bba2d4ee8f8b0244323dc4d65"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a028d9a1107a86d282f556e43658ada9b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a028d9a1107a86d282f556e43658ada9b">ks_mat3_apply</a> (double *w, const <a class="el" href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a> R, const double *v)</td></tr>
<tr class="separator:a028d9a1107a86d282f556e43658ada9b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a22ac65cbd45dee4eec9f4f2612af92a8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a22ac65cbd45dee4eec9f4f2612af92a8">ks_mat3_invapply</a> (double *w, const <a class="el" href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a> R, const double *v)</td></tr>
<tr class="separator:a22ac65cbd45dee4eec9f4f2612af92a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1a51b640b1005f02c4475a1c5f673adb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a1a51b640b1005f02c4475a1c5f673adb">ks_scan_update_slice_location</a> (SCAN_INFO *new_loc, const SCAN_INFO orig_loc, const <a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a> M_physical, const <a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a> M_logical)</td></tr>
<tr class="separator:a1a51b640b1005f02c4475a1c5f673adb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2fdfe2e655a76c4cd4fb1dac16d1834b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a2fdfe2e655a76c4cd4fb1dac16d1834b">ks_scan_rotate</a> (SCAN_INFO slice_info)</td></tr>
<tr class="separator:a2fdfe2e655a76c4cd4fb1dac16d1834b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a520240c3153cf9ffe25a7617b2c72149"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a520240c3153cf9ffe25a7617b2c72149">ks_scan_isirotate</a> (<a class="el" href="struct_k_s___i_s_i_r_o_t.html">KS_ISIROT</a> *isirot)</td></tr>
<tr class="separator:a520240c3153cf9ffe25a7617b2c72149"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adee331638310d0a0ed1c726c02051e1b"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#adee331638310d0a0ed1c726c02051e1b">ks_pg_fse_flip_angle_taperoff</a> (double *flip_angles, int etl, double flip1, double flip2, double flip3, double target_flip, int start_middle)</td></tr>
<tr class="separator:adee331638310d0a0ed1c726c02051e1b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43efb5f9eb84e0ace408cd1a74825f3f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a43efb5f9eb84e0ace408cd1a74825f3f">ks_pg_mod_fse_rfpulse_structs</a> (<a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *rf1, <a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *rf2, <a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *rf3, const double *flip_angles, const int etl)</td></tr>
<tr class="separator:a43efb5f9eb84e0ace408cd1a74825f3f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad4f6f11e79e686edc745fb372307da07"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ad4f6f11e79e686edc745fb372307da07">ks_instancereset_trap</a> (<a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> *trap)</td></tr>
<tr class="separator:ad4f6f11e79e686edc745fb372307da07"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aad9c2e7d88da5870c5326fff22fef2b8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#aad9c2e7d88da5870c5326fff22fef2b8">ks_instancereset_wait</a> (<a class="el" href="struct_k_s___w_a_i_t.html">KS_WAIT</a> *wait)</td></tr>
<tr class="separator:aad9c2e7d88da5870c5326fff22fef2b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ace40879ab8ead831e2cb4813d0c129c7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ace40879ab8ead831e2cb4813d0c129c7">ks_instancereset_phaser</a> (<a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *phaser)</td></tr>
<tr class="separator:ace40879ab8ead831e2cb4813d0c129c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa383b0d8b9fefba159e34ed921350522"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#aa383b0d8b9fefba159e34ed921350522">ks_instancereset_readtrap</a> (<a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a> *readtrap)</td></tr>
<tr class="separator:aa383b0d8b9fefba159e34ed921350522"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7f71a623c82d573e0418c143e8ecec56"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a7f71a623c82d573e0418c143e8ecec56">ks_instancereset_rf</a> (<a class="el" href="struct_k_s___r_f.html">KS_RF</a> *rf)</td></tr>
<tr class="separator:a7f71a623c82d573e0418c143e8ecec56"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ace7a321746aada2f87551d05f5a4a77f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ace7a321746aada2f87551d05f5a4a77f">ks_instancereset_selrf</a> (<a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *selrf)</td></tr>
<tr class="separator:ace7a321746aada2f87551d05f5a4a77f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3944bb2736d992be3c1b512d8dfb0ce8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a3944bb2736d992be3c1b512d8dfb0ce8">ks_instancereset_epi</a> (<a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *epi)</td></tr>
<tr class="separator:a3944bb2736d992be3c1b512d8dfb0ce8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acee69d0d4db843c9923ab78fd3939009"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#acee69d0d4db843c9923ab78fd3939009">ks_compare_wfi_by_timeboard</a> (const <a class="el" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a> *a, const <a class="el" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a> *b)</td></tr>
<tr class="separator:acee69d0d4db843c9923ab78fd3939009"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:addfe7afa496fc5757c450680db49dc5f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#addfe7afa496fc5757c450680db49dc5f">ks_compare_wfi_by_boardtime</a> (const <a class="el" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a> *a, const <a class="el" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a> *b)</td></tr>
<tr class="separator:addfe7afa496fc5757c450680db49dc5f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d24ff69a16ddb94bd6317e6c5594fe1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a3d24ff69a16ddb94bd6317e6c5594fe1">ks_compare_wfp_by_time</a> (const WF_PULSE *a, const WF_PULSE *b)</td></tr>
<tr class="separator:a3d24ff69a16ddb94bd6317e6c5594fe1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad09ed4b8371bcc1dd3d873c1ee5587ed"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ad09ed4b8371bcc1dd3d873c1ee5587ed">ks_compare_pint</a> (const void *v1, const void *v2)</td></tr>
<tr class="separator:ad09ed4b8371bcc1dd3d873c1ee5587ed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a768cbf2348344d4c2203bb79b821b2ff"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a768cbf2348344d4c2203bb79b821b2ff">ks_compare_pshort</a> (const void *v1, const void *v2)</td></tr>
<tr class="separator:a768cbf2348344d4c2203bb79b821b2ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4fb225b10c94cbba0ea15b6a97848c3d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a4fb225b10c94cbba0ea15b6a97848c3d">ks_compare_pfloat</a> (const void *v1, const void *v2)</td></tr>
<tr class="separator:a4fb225b10c94cbba0ea15b6a97848c3d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3ba108e0606acf6fca3664f186be0289"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a3ba108e0606acf6fca3664f186be0289">ks_compare_int</a> (const void *v1, const void *v2)</td></tr>
<tr class="separator:a3ba108e0606acf6fca3664f186be0289"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7e439a9bad95e13f0909674391e7f0fc"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a7e439a9bad95e13f0909674391e7f0fc">ks_compare_short</a> (const void *v1, const void *v2)</td></tr>
<tr class="separator:a7e439a9bad95e13f0909674391e7f0fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a39ba8e8e94e7a55ea699b0f29c862016"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a39ba8e8e94e7a55ea699b0f29c862016">ks_compare_float</a> (const void *v1, const void *v2)</td></tr>
<tr class="separator:a39ba8e8e94e7a55ea699b0f29c862016"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a72adf83f1d9ed4592227259113eed4ea"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a72adf83f1d9ed4592227259113eed4ea">ks_sort_getsortedindx</a> (int *sortedindx, int *array, int n)</td></tr>
<tr class="separator:a72adf83f1d9ed4592227259113eed4ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a39b939060ef2d2772d6ab7a0817c0ec2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a39b939060ef2d2772d6ab7a0817c0ec2">ks_sort_getsortedindx_s</a> (int *sortedindx, short *array, int n)</td></tr>
<tr class="separator:a39b939060ef2d2772d6ab7a0817c0ec2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa8ba7c47c66d40b3df50e6228f66920d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#aa8ba7c47c66d40b3df50e6228f66920d">ks_sort_getsortedindx_f</a> (int *sortedindx, float *array, int n)</td></tr>
<tr class="separator:aa8ba7c47c66d40b3df50e6228f66920d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ae65ed3cc2deb47ccf50b7988239474"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a0ae65ed3cc2deb47ccf50b7988239474">ks_sort_wfi_by_timeboard</a> (<a class="el" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a> *a, int nitems)</td></tr>
<tr class="separator:a0ae65ed3cc2deb47ccf50b7988239474"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a007ba9525cc536f29132ee8e320fa08a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a007ba9525cc536f29132ee8e320fa08a">ks_sort_wfi_by_boardtime</a> (<a class="el" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a> *a, int nitems)</td></tr>
<tr class="separator:a007ba9525cc536f29132ee8e320fa08a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a42180e710dc1f89e9a557683f8f58dda"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a42180e710dc1f89e9a557683f8f58dda">ks_sort_wfp_by_time</a> (WF_PULSE *a, int nitems)</td></tr>
<tr class="separator:a42180e710dc1f89e9a557683f8f58dda"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae136d8a2e504e06e8592185e85fecfde"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ae136d8a2e504e06e8592185e85fecfde">ks_plot_slicetime_begin</a> ()</td></tr>
<tr class="separator:ae136d8a2e504e06e8592185e85fecfde"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0c669d4d641190116b6886e0976fd47"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ac0c669d4d641190116b6886e0976fd47">ks_plot_slicetime</a> (<a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *ctrl, int nslices, float *slicepos_mm, float slthick_mm, <a class="el" href="_k_s_foundation_8h.html#a0ba82984ac3a22ad68cab5bce5224cf9">KS_PLOT_EXCITATION_MODE</a> exctype)</td></tr>
<tr class="separator:ac0c669d4d641190116b6886e0976fd47"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aadb6109f3b3f75f81b46e153f9eb11f0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#aadb6109f3b3f75f81b46e153f9eb11f0">ks_plot_slicetime_endofslicegroup</a> (const char *desc)</td></tr>
<tr class="separator:aadb6109f3b3f75f81b46e153f9eb11f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab8c26ea9ee8534faf737bbc61223253e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ab8c26ea9ee8534faf737bbc61223253e">ks_plot_slicetime_endofpass</a> ()</td></tr>
<tr class="separator:ab8c26ea9ee8534faf737bbc61223253e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6eab83ca87166f306eb449a94a354ec6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a6eab83ca87166f306eb449a94a354ec6">ks_plot_slicetime_end</a> ()</td></tr>
<tr class="separator:a6eab83ca87166f306eb449a94a354ec6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5e19e5d936d4f3c39078da5b6e6ed7f1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a5e19e5d936d4f3c39078da5b6e6ed7f1">ks_plot_host_slicetime_begin</a> ()</td></tr>
<tr class="separator:a5e19e5d936d4f3c39078da5b6e6ed7f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2cc0a4e9542bfa5b8a93ca3a12a81c24"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a2cc0a4e9542bfa5b8a93ca3a12a81c24">ks_plot_host_slicetime</a> (<a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *ctrl, int nslices, float *slicepos_mm, float slthick_mm, <a class="el" href="_k_s_foundation_8h.html#a0ba82984ac3a22ad68cab5bce5224cf9">KS_PLOT_EXCITATION_MODE</a> exctype)</td></tr>
<tr class="separator:a2cc0a4e9542bfa5b8a93ca3a12a81c24"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afaafc1f357c7766042d78af3c456380a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#afaafc1f357c7766042d78af3c456380a">ks_plot_host_slicetime_endofslicegroup</a> (const char *desc)</td></tr>
<tr class="separator:afaafc1f357c7766042d78af3c456380a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af2d5190dc4e1ba1de783916a4c66fc96"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#af2d5190dc4e1ba1de783916a4c66fc96">ks_plot_host_slicetime_endofpass</a> ()</td></tr>
<tr class="separator:af2d5190dc4e1ba1de783916a4c66fc96"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad67bd9fb00d294b98a0a3a7fbaac8550"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ad67bd9fb00d294b98a0a3a7fbaac8550">ks_plot_host_slicetime_end</a> ()</td></tr>
<tr class="separator:ad67bd9fb00d294b98a0a3a7fbaac8550"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9cc16cc637cbb032a1df9434ab3ae900"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a9cc16cc637cbb032a1df9434ab3ae900">ks_plot_host</a> (<a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html">KS_SEQ_COLLECTION</a> *<a class="el" href="ksgre_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>, <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *plan)</td></tr>
<tr class="separator:a9cc16cc637cbb032a1df9434ab3ae900"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8f60bc64f5da613130a7b7bfec468476"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a8f60bc64f5da613130a7b7bfec468476">ks_plot_host_seqctrl</a> (<a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *ctrl, <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *plan)</td></tr>
<tr class="separator:a8f60bc64f5da613130a7b7bfec468476"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad673a4b23913c3c006b3b0052b98e0df"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ad673a4b23913c3c006b3b0052b98e0df">ks_plot_host_seqctrl_manyplans</a> (<a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *ctrl, <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> **plan, const int num_plans)</td></tr>
<tr class="separator:ad673a4b23913c3c006b3b0052b98e0df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb36a5018815d55e357775e8515f220d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#abb36a5018815d55e357775e8515f220d">ks_plot_tgt_reset</a> (<a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *ctrl)</td></tr>
<tr class="separator:abb36a5018815d55e357775e8515f220d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa4d70e1b753a44f18ce002ecb84cd16e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#aa4d70e1b753a44f18ce002ecb84cd16e">ks_plot_tgt_addframe</a> (<a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *ctrl)</td></tr>
<tr class="separator:aa4d70e1b753a44f18ce002ecb84cd16e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aefb58d645ca29e4cfa68403df396e53f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#aefb58d645ca29e4cfa68403df396e53f">ks_scan_rf_ampscale</a> (<a class="el" href="struct_k_s___r_f.html">KS_RF</a> *rf, int instanceno, float ampscale)</td></tr>
<tr class="separator:aefb58d645ca29e4cfa68403df396e53f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ada6d1910f42394dc7fb363d85bd6e9c5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ada6d1910f42394dc7fb363d85bd6e9c5">ks_scan_rf_on</a> (<a class="el" href="struct_k_s___r_f.html">KS_RF</a> *rf, int instanceno)</td></tr>
<tr class="separator:ada6d1910f42394dc7fb363d85bd6e9c5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa67267b854dda4b52334ba189f876bd7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#aa67267b854dda4b52334ba189f876bd7">ks_scan_rf_on_chop</a> (<a class="el" href="struct_k_s___r_f.html">KS_RF</a> *rf, int instanceno)</td></tr>
<tr class="separator:aa67267b854dda4b52334ba189f876bd7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a99675ab672242a3f37444f01b1246bda"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a99675ab672242a3f37444f01b1246bda">ks_scan_rf_off</a> (<a class="el" href="struct_k_s___r_f.html">KS_RF</a> *rf, int instanceno)</td></tr>
<tr class="separator:a99675ab672242a3f37444f01b1246bda"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae8766ce800f95dd75ca2eece6638326c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ae8766ce800f95dd75ca2eece6638326c">ks_scan_selrf_setfreqphase</a> (<a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *selrf, int instanceno, SCAN_INFO sliceinfo, float rfphase)</td></tr>
<tr class="separator:ae8766ce800f95dd75ca2eece6638326c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb1b77a3c2cb4a699081c3ba79ba428c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#adb1b77a3c2cb4a699081c3ba79ba428c">ks_scan_selrf_setfreqphase_pins</a> (<a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *selrf, int instanceno, SCAN_INFO sliceinfo, int sms_multiband_factor, float sms_slice_gap, float rfphase)</td></tr>
<tr class="separator:adb1b77a3c2cb4a699081c3ba79ba428c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abaf9de92fbb264944d41ef719f5bc438"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#abaf9de92fbb264944d41ef719f5bc438">ks_scan_rf_setphase</a> (<a class="el" href="struct_k_s___r_f.html">KS_RF</a> *rf, int instanceno, float rfphase)</td></tr>
<tr class="separator:abaf9de92fbb264944d41ef719f5bc438"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2e916337476b7566b3bf033824f964ba"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a2e916337476b7566b3bf033824f964ba">ks_scan_wave2hardware</a> (<a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave, const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a> newwave)</td></tr>
<tr class="separator:a2e916337476b7566b3bf033824f964ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a27f5cab084726434159934c2b1594eb6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a27f5cab084726434159934c2b1594eb6">ks_scan_offsetfov_iso</a> (<a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a> *readtrap, int instanceno, SCAN_INFO sliceinfo, double ky, double kz, double rcvphase)</td></tr>
<tr class="separator:a27f5cab084726434159934c2b1594eb6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a11a9b9d761ba64a74b88c222b2a949e3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a11a9b9d761ba64a74b88c222b2a949e3">ks_scan_offsetfov</a> (<a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a> *readtrap, int instanceno, SCAN_INFO sliceinfo, int <a class="el" href="_g_e_required_8e.html#a1cb6f035a0e9565bbf12c3ef04c3c229">view</a>, float phasefovratio, float rcvphase)</td></tr>
<tr class="separator:a11a9b9d761ba64a74b88c222b2a949e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a368695617a7edf4fdba05325573efb12"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a368695617a7edf4fdba05325573efb12">ks_scan_offsetfov3D</a> (<a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a> *readtrap, int instanceno, SCAN_INFO sliceinfo, int kyview, float phasefovratio, int kzview, float zphasefovratio, float rcvphase)</td></tr>
<tr class="separator:a368695617a7edf4fdba05325573efb12"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af21da495bf5fc72d19915129fdcbebe4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#af21da495bf5fc72d19915129fdcbebe4">ks_scan_offsetfov_readwave</a> (<a class="el" href="struct_k_s___r_e_a_d_w_a_v_e.html">KS_READWAVE</a> *readwave, int instanceno, SCAN_INFO sliceinfo, int kyview, float phasefovratio, float rcvphase)</td></tr>
<tr class="separator:af21da495bf5fc72d19915129fdcbebe4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adbd649762fa938de96662bdc9a721863"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#adbd649762fa938de96662bdc9a721863">ks_scan_omegatrap_hz</a> (<a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> *trap, int instanceno, float Hz)</td></tr>
<tr class="separator:adbd649762fa938de96662bdc9a721863"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6c406ab72abe3eadd93f7e889e9afd32"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a6c406ab72abe3eadd93f7e889e9afd32">ks_scan_omegawave_hz</a> (<a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave, int instanceno, float Hz)</td></tr>
<tr class="separator:a6c406ab72abe3eadd93f7e889e9afd32"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a196a10609c8f75d0ff6d7a520d0b7c27"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a196a10609c8f75d0ff6d7a520d0b7c27">ks_scan_wait</a> (<a class="el" href="struct_k_s___w_a_i_t.html">KS_WAIT</a> *wait, int waitperiod)</td></tr>
<tr class="separator:a196a10609c8f75d0ff6d7a520d0b7c27"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2c01e4ef0737a46f9c973b77ca284424"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a2c01e4ef0737a46f9c973b77ca284424">ks_scan_trap_ampscale</a> (<a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> *trap, int instanceno, float ampscale)</td></tr>
<tr class="separator:a2c01e4ef0737a46f9c973b77ca284424"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae825e40f6c103ac27a1d1c309e8e8835"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ae825e40f6c103ac27a1d1c309e8e8835">ks_scan_trap_ampscale_slice</a> (<a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> *trap, int start, int skip, int count, float ampscale)</td></tr>
<tr class="separator:ae825e40f6c103ac27a1d1c309e8e8835"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a183aef5f28e9491f792465e4b6d2b112"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a183aef5f28e9491f792465e4b6d2b112">ks_scan_phaser_kmove</a> (<a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *phaser, int instanceno, double pixelunits)</td></tr>
<tr class="separator:a183aef5f28e9491f792465e4b6d2b112"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aff91e4da3b6ccabd607ec0da04f774ce"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#aff91e4da3b6ccabd607ec0da04f774ce">ks_scan_phaser_toline</a> (<a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *phaser, int instanceno, int <a class="el" href="_g_e_required_8e.html#a1cb6f035a0e9565bbf12c3ef04c3c229">view</a>)</td></tr>
<tr class="separator:aff91e4da3b6ccabd607ec0da04f774ce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a81a97893a74af952d90181aa858e709b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a81a97893a74af952d90181aa858e709b">ks_scan_phaser_fromline</a> (<a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *phaser, int instanceno, int <a class="el" href="_g_e_required_8e.html#a1cb6f035a0e9565bbf12c3ef04c3c229">view</a>)</td></tr>
<tr class="separator:a81a97893a74af952d90181aa858e709b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa3ed2adea6f1023e3f926978e9a7b856"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#aa3ed2adea6f1023e3f926978e9a7b856">ks_scan_getsliceloc</a> (const <a class="el" href="struct_k_s___s_l_i_c_e___p_l_a_n.html">KS_SLICE_PLAN</a> *slice_plan, int <a class="el" href="ksgre__implementation_8e.html#aae477e374b559bf16a475321797d62cb">passindx</a>, int sltimeinpass)</td></tr>
<tr class="separator:aa3ed2adea6f1023e3f926978e9a7b856"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8fd0ecd6b54b0baaa731127c4520a3dd"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a8fd0ecd6b54b0baaa731127c4520a3dd">ks_scan_getslicetime</a> (const <a class="el" href="struct_k_s___s_l_i_c_e___p_l_a_n.html">KS_SLICE_PLAN</a> *slice_plan, int <a class="el" href="ksgre__implementation_8e.html#aae477e374b559bf16a475321797d62cb">passindx</a>, int slloc)</td></tr>
<tr class="separator:a8fd0ecd6b54b0baaa731127c4520a3dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a27071ced949f926058771246110c119c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811">ks_enum_epiblipsign</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a27071ced949f926058771246110c119c">ks_scan_epi_verify_phaseenc_plan</a> (<a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *epi, <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *phaseenc_plan, int shot)</td></tr>
<tr class="separator:a27071ced949f926058771246110c119c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0d83cf730d82612a87abc0f024bea336"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a0d83cf730d82612a87abc0f024bea336">ks_scan_epi_shotcontrol</a> (<a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *epi, int echo, SCAN_INFO sliceinfo, <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *phaseenc_plan, int shot, float rcvphase)</td></tr>
<tr class="separator:a0d83cf730d82612a87abc0f024bea336"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a27b64905234db826096802c5a1f5bd6e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a27b64905234db826096802c5a1f5bd6e">ks_scan_epi_loadecho</a> (<a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *epi, int echo, int storeecho, int slice, <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *phaseenc_plan, int shot)</td></tr>
<tr class="separator:a27b64905234db826096802c5a1f5bd6e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab251dc87ba751fcc5be656cf3cc5037f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#ab251dc87ba751fcc5be656cf3cc5037f">ks_scan_acq_to_rtp</a> (<a class="el" href="struct_k_s___r_e_a_d.html">KS_READ</a> *read, TYPDAB_PACKETS dabacqctrl, float fatoffset)</td></tr>
<tr class="separator:ab251dc87ba751fcc5be656cf3cc5037f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a595f599c90a3cb1f300c3c83b5fa116d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a595f599c90a3cb1f300c3c83b5fa116d">ks_scan_switch_to_sequence</a> (<a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *ctrl)</td></tr>
<tr class="separator:a595f599c90a3cb1f300c3c83b5fa116d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a02e188307a4bd9dfdb00d37688c0487e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a02e188307a4bd9dfdb00d37688c0487e">ks_scan_playsequence</a> (<a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *ctrl)</td></tr>
<tr class="separator:a02e188307a4bd9dfdb00d37688c0487e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3a09974d212d39bdc19d41b3fb3f1535"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a3a09974d212d39bdc19d41b3fb3f1535">ks_scan_loaddabwithindices</a> (WF_PULSE_ADDR pulse, LONG slice, LONG echo, LONG <a class="el" href="_g_e_required_8e.html#a1cb6f035a0e9565bbf12c3ef04c3c229">view</a>, uint8_t acq, uint8_t vol, TYPDAB_PACKETS acqon_flag)</td></tr>
<tr class="separator:a3a09974d212d39bdc19d41b3fb3f1535"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa4c29e21c8d521ebb578246daeb29178"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#aa4c29e21c8d521ebb578246daeb29178">ks_scan_loaddabwithindices_nex</a> (WF_PULSE_ADDR pulse, LONG slice, LONG echo, LONG <a class="el" href="_g_e_required_8e.html#a1cb6f035a0e9565bbf12c3ef04c3c229">view</a>, uint8_t acq, uint8_t vol, LONG operation, TYPDAB_PACKETS acqon_flag)</td></tr>
<tr class="separator:aa4c29e21c8d521ebb578246daeb29178"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a95c41e5b4697083f1c9840f70b157c31"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a95c41e5b4697083f1c9840f70b157c31">ks_scan_wait_for_rtp</a> (void *rtpmsg, int maxmsgsize, int maxwait, <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *waitctrl)</td></tr>
<tr class="separator:a95c41e5b4697083f1c9840f70b157c31"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d73c466af30e53064824044894067a9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a8d73c466af30e53064824044894067a9">ks_copy_and_reset_obj</a> (void *pobj)</td></tr>
<tr class="separator:a8d73c466af30e53064824044894067a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa5b257c3f42fff01e0a368d6c60e5919"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#aa5b257c3f42fff01e0a368d6c60e5919">ks_show_clock</a> (FLOAT scantime)</td></tr>
<tr class="separator:aa5b257c3f42fff01e0a368d6c60e5919"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a48609b98dac5c8f7619bc0521f58d6e3"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a48609b98dac5c8f7619bc0521f58d6e3">ks_scan_rf_phase_spoiling</a> (int counter)</td></tr>
<tr class="separator:a48609b98dac5c8f7619bc0521f58d6e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ec679c0fb8eb62c1776e67434e25b77"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a4ec679c0fb8eb62c1776e67434e25b77">ks_tgt_reset_gradrfctrl</a> (<a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html">KS_GRADRFCTRL</a> *gradrfctrl)</td></tr>
<tr class="separator:a4ec679c0fb8eb62c1776e67434e25b77"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7fa5f9c7d6c866530c0fe422c9b7cbdb"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a7fa5f9c7d6c866530c0fe422c9b7cbdb">ks_eval_clear_readwave</a> (<a class="el" href="struct_k_s___r_e_a_d_w_a_v_e.html">KS_READWAVE</a> *readwave)</td></tr>
<tr class="separator:a7fa5f9c7d6c866530c0fe422c9b7cbdb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a20cde73a2d93c278b92a33cf3b2848ad"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a20cde73a2d93c278b92a33cf3b2848ad">ks_eval_clear_dualreadtrap</a> (<a class="el" href="struct_k_s___d_i_x_o_n___d_u_a_l_r_e_a_d_t_r_a_p.html">KS_DIXON_DUALREADTRAP</a> *dual_read)</td></tr>
<tr class="separator:a20cde73a2d93c278b92a33cf3b2848ad"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a5fc997556910df5890ca1c407984674d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a5fc997556910df5890ca1c407984674d">abort_on_kserror</a></td></tr>
<tr class="separator:a5fc997556910df5890ca1c407984674d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4dcd93b4f67aeb25541105ec7953c67e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a4dcd93b4f67aeb25541105ec7953c67e">ks_rhoboard</a></td></tr>
<tr class="separator:a4dcd93b4f67aeb25541105ec7953c67e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4bd8f92bd97315429605430e234dceb4"><td class="memItemLeft" align="right" valign="top">LOG_GRAD&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></td></tr>
<tr class="separator:a4bd8f92bd97315429605430e234dceb4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af51ba165cbaf874219789beaa48f2464"><td class="memItemLeft" align="right" valign="top">PHYS_GRAD&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation_8h.html#af51ba165cbaf874219789beaa48f2464">phygrd</a></td></tr>
<tr class="separator:af51ba165cbaf874219789beaa48f2464"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This file contains the most documentation, and contains all definitions, sequence objects (typedef structs) and function prototypes for KSFoundation. <code>@inline</code> this file in the main sequence. </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a4e0e2d9e1ee0f401844b5b6ff8338f82"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4e0e2d9e1ee0f401844b5b6ff8338f82">&#9670;&nbsp;</a></span>WARN_UNUSED_RESULT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define WARN_UNUSED_RESULT</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Compiler flag for DV25 and higher, causing a compiler error if the returned function value is not used by the calling function </p>

</div>
</div>
<a id="afd953f31b866a09e0418967c2bf65a59"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afd953f31b866a09e0418967c2bf65a59">&#9670;&nbsp;</a></span>KS_NOTSET</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_NOTSET&#160;&#160;&#160;-1</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Unrealistic value used on some variables to trigger errors </p>

</div>
</div>
<a id="a5803c0ce57f2100cd4a3665fdedf3ede"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5803c0ce57f2100cd4a3665fdedf3ede">&#9670;&nbsp;</a></span>KS_INFINITY</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_INFINITY&#160;&#160;&#160;(1.0/0.0)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Infinity </p>

</div>
</div>
<a id="abd2839fe562821c8a76cc9c65d4dfae4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abd2839fe562821c8a76cc9c65d4dfae4">&#9670;&nbsp;</a></span>_cvdesc</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _cvdesc</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">cv, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">string&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">{\</div><div class="line">    if( NULL != <span class="keywordtype">string</span> ) {\</div><div class="line">        if( FALSE == (cv)-&gt;staticdescrflag ) {\</div><div class="line">            free( (<span class="keywordtype">void</span> *)((cv)-&gt;descr) );\</div><div class="line">        }\</div><div class="line">        (cv)-&gt;descr = strdup( <span class="keywordtype">string</span> );\</div><div class="line">        (cv)-&gt;staticdescrflag = FALSE;\</div><div class="line">    }\</div><div class="line">}</div></div><!-- fragment -->
</div>
</div>
<a id="ab70ad63ae09d81e0c912e61d3fbef0fa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab70ad63ae09d81e0c912e61d3fbef0fa">&#9670;&nbsp;</a></span>KS_ISI_predelay</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_ISI_predelay&#160;&#160;&#160;256</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="addf010deada78e27501476388abad0be"></a>
<h2 class="memtitle"><span class="permalink"><a href="#addf010deada78e27501476388abad0be">&#9670;&nbsp;</a></span>KS_ISI_time</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_ISI_time&#160;&#160;&#160;256</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a191c8595f093c9d5b27a408e6a2dc1ab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a191c8595f093c9d5b27a408e6a2dc1ab">&#9670;&nbsp;</a></span>KS_ISI_rotupdatetime</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_ISI_rotupdatetime&#160;&#160;&#160;12</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="af1033833702a65e227f5dcd4b0e29e74"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af1033833702a65e227f5dcd4b0e29e74">&#9670;&nbsp;</a></span>KS_ISI_postdelay</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_ISI_postdelay&#160;&#160;&#160;256</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a5a7fb5c0417f7e99c97bef1765558e0c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5a7fb5c0417f7e99c97bef1765558e0c">&#9670;&nbsp;</a></span>KS_MINPLATEAUTIME</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_MINPLATEAUTIME&#160;&#160;&#160;8</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Shortest plateautime of a trapezoid (<a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a>) </p>

</div>
</div>
<a id="a3bb177070dbeb44d2386c268d781fe61"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3bb177070dbeb44d2386c268d781fe61">&#9670;&nbsp;</a></span>KS_RFSSP_PRETIME</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_RFSSP_PRETIME&#160;&#160;&#160;64</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Time in [us] before an RF pulse that is needed for SSP packets. May sometimes be taken into account </p>

</div>
</div>
<a id="aba7bb21f100b12eda8151516fcb12461"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aba7bb21f100b12eda8151516fcb12461">&#9670;&nbsp;</a></span>KS_RFSSP_POSTTIME</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_RFSSP_POSTTIME&#160;&#160;&#160;56</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Time in [us] after an RF pulse that is needed for SSP packets. May sometimes be taken into account </p>

</div>
</div>
<a id="a76daa37aac330cbb2ccf7261d25a771a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a76daa37aac330cbb2ccf7261d25a771a">&#9670;&nbsp;</a></span>KS_RF_STANDARD_CRUSHERAREA</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_RF_STANDARD_CRUSHERAREA&#160;&#160;&#160;2000.0</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a91a1de90c6dacdfe76a5df3dd536bd20"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a91a1de90c6dacdfe76a5df3dd536bd20">&#9670;&nbsp;</a></span>KS_EPI_MIN_INTERTRAIN_SSPGAP</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_EPI_MIN_INTERTRAIN_SSPGAP&#160;&#160;&#160;80</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>EXPERIMENTAL. Check how the SSP packets in the beginning/end of the EPI train can be packed to minimize this one for all possible acq. parameters </p>

</div>
</div>
<a id="a631e009fae4e6280b5fade1634356188"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a631e009fae4e6280b5fade1634356188">&#9670;&nbsp;</a></span>L_REF</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define L_REF&#160;&#160;&#160;10</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a51e32d6a9800bdbb4ecf0546f1f92a0e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a51e32d6a9800bdbb4ecf0546f1f92a0e">&#9670;&nbsp;</a></span>PSD_HRMW_COIL</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PSD_HRMW_COIL&#160;&#160;&#160;13</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ad5e48066a235f175d67cee2fc68dc474"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad5e48066a235f175d67cee2fc68dc474">&#9670;&nbsp;</a></span>HAVE_PREMIER_GRADIENTS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define HAVE_PREMIER_GRADIENTS&#160;&#160;&#160;(<a class="el" href="_k_s_foundation__host_8c.html#af18437b2347fb8d8a16a7668f4a7a768">cfgcoiltype</a> == <a class="el" href="_k_s_foundation_8h.html#a51e32d6a9800bdbb4ecf0546f1f92a0e">PSD_HRMW_COIL</a>)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a819a610c08191625f85e59018a882b33"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a819a610c08191625f85e59018a882b33">&#9670;&nbsp;</a></span>KS_SAVEPFILES</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_SAVEPFILES&#160;&#160;&#160;RHXC_AUTO_LOCK</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Bit for <code>rhexecctrl</code> to dump Pfiles </p>

</div>
</div>
<a id="a53099695cca4c5bbb28cebe74bb6c635"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a53099695cca4c5bbb28cebe74bb6c635">&#9670;&nbsp;</a></span>KS_GERECON</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_GERECON&#160;&#160;&#160;(RHXC_AUTO_DISPLAY+RHXC_XFER_IM)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Bit for <code>rhexecctrl</code> for GE product image reconstruction </p>

</div>
</div>
<a id="a969816ef84367f11542f3473473260dc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a969816ef84367f11542f3473473260dc">&#9670;&nbsp;</a></span>KS_3D_SELECTED</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_3D_SELECTED&#160;&#160;&#160;(opimode == PSD_3D || opimode == PSD_3DM)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ada5de92a8a4f7f10055beadff483e5f6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ada5de92a8a4f7f10055beadff483e5f6">&#9670;&nbsp;</a></span>KS_3D_SINGLESLAB_SELECTED</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_3D_SINGLESLAB_SELECTED&#160;&#160;&#160;(opimode == PSD_3D)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ac16ec5a7d1513b0fcb01dc7a730b3360"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac16ec5a7d1513b0fcb01dc7a730b3360">&#9670;&nbsp;</a></span>KS_3D_MULTISLAB_SELECTED</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_3D_MULTISLAB_SELECTED&#160;&#160;&#160;(opimode == PSD_3DM)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="aacb2fe1d83c45e8d0525f363bdd6b8a6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aacb2fe1d83c45e8d0525f363bdd6b8a6">&#9670;&nbsp;</a></span>KS_DESCRIPTION_LENGTH</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_DESCRIPTION_LENGTH&#160;&#160;&#160;128</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Max # of characters in the description of the various sequence objects </p>

</div>
</div>
<a id="a3c3e362198a193a273f436e9e392188b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c3e362198a193a273f436e9e392188b">&#9670;&nbsp;</a></span>KS_MAXWAVELEN</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_MAXWAVELEN&#160;&#160;&#160;10000</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>KS_MAXWAVELEN (10000) sample points </p>

</div>
</div>
<a id="a4becfb20a2ad2227c16c4ce772ed8d51"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4becfb20a2ad2227c16c4ce772ed8d51">&#9670;&nbsp;</a></span>KS_MAXUNIQUE_RF</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_MAXUNIQUE_RF&#160;&#160;&#160;20</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Maximum number of <em>different</em> RF pulses in the sequence (c.f. also grad_rf_empty**.h) </p>

</div>
</div>
<a id="a034073abe489e0f26ff7693e11abbb02"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a034073abe489e0f26ff7693e11abbb02">&#9670;&nbsp;</a></span>KS_MAXUNIQUE_TRAP</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_MAXUNIQUE_TRAP&#160;&#160;&#160;200</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Maximum number of <em>different</em> KS_TRAPs in the sequence </p>

</div>
</div>
<a id="a4a92ef54385807dc82f7a5113156f31e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4a92ef54385807dc82f7a5113156f31e">&#9670;&nbsp;</a></span>KS_MAXUNIQUE_WAVE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_MAXUNIQUE_WAVE&#160;&#160;&#160;200</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Maximum number of <em>different</em> KS_WAVEs in the sequence </p>

</div>
</div>
<a id="a92ed0352c04ca279b44bf62d253b143a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a92ed0352c04ca279b44bf62d253b143a">&#9670;&nbsp;</a></span>KS_MAXUNIQUE_SEQUENCES</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_MAXUNIQUE_SEQUENCES&#160;&#160;&#160;200</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Maximum number of pulses sequence modules, including core, (i.e. with own SEQLENGTH/bofffset()) in this pulse sequence </p>

</div>
</div>
<a id="ab48aef2b031ba0ae2572616c42e6890c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab48aef2b031ba0ae2572616c42e6890c">&#9670;&nbsp;</a></span>KS_MAX_PHASEDYN</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_MAX_PHASEDYN&#160;&#160;&#160;1025</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Maximum number of phase encoding steps in a <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> sequence object </p>

</div>
</div>
<a id="a8b4a19e776c83d9477d2d4135a564aeb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8b4a19e776c83d9477d2d4135a564aeb">&#9670;&nbsp;</a></span>KS_MAXUNIQUE_READ</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_MAXUNIQUE_READ&#160;&#160;&#160;500</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Maximum number of readout instances </p>

</div>
</div>
<a id="ab088ee3b5494b35ca60219f0b4e46e3b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab088ee3b5494b35ca60219f0b4e46e3b">&#9670;&nbsp;</a></span>KS_MAXINSTANCES</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_MAXINSTANCES&#160;&#160;&#160;500</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ae89776067b59066dc231b6a75d1d6c00"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae89776067b59066dc231b6a75d1d6c00">&#9670;&nbsp;</a></span>KS_EPI_MINBLIPAREA</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_EPI_MINBLIPAREA&#160;&#160;&#160;100</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Default value of lowest EPI blip area until blip is made wider to avoid discretization errors </p>

</div>
</div>
<a id="a5adde8c85d3d00e22516df96c55f4eb7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5adde8c85d3d00e22516df96c55f4eb7">&#9670;&nbsp;</a></span>KS_INITZEROS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_INITZEROS</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">n</td><td>)</td>
          <td>&#160;&#160;&#160;{[0 ... (n-1)] = 0}</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>C macro to initialize arrays with zeros at declaration </p>

</div>
</div>
<a id="a8b43f6a2290a9e0d94c660d62f17941e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8b43f6a2290a9e0d94c660d62f17941e">&#9670;&nbsp;</a></span>KS_INITVALUE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_INITVALUE</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">n, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">a&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;{[0 ... (n-1)] = a}</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>C macro to initialize each element in an array with a number at declaration </p>

</div>
</div>
<a id="a747ea3d02a820c7b57b76773d39f55d5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a747ea3d02a820c7b57b76773d39f55d5">&#9670;&nbsp;</a></span>KS_INIT_DESC</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_INIT_DESC&#160;&#160;&#160;<a class="el" href="_k_s_foundation_8h.html#a5adde8c85d3d00e22516df96c55f4eb7">KS_INITZEROS</a>(<a class="el" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a>)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Default values for KS_DESCRIPTION strings </p>

</div>
</div>
<a id="ad01dd4f06fe226a502e872d4173ba7ae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad01dd4f06fe226a502e872d4173ba7ae">&#9670;&nbsp;</a></span>KS_INIT_SEQLOC</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_INIT_SEQLOC&#160;&#160;&#160;{<a class="el" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>, <a class="el" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>, 1.0}</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Default values for <a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> structs </p>

</div>
</div>
<a id="a1dffdf4233029d2ce0ab9a6d5a82aae5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1dffdf4233029d2ce0ab9a6d5a82aae5">&#9670;&nbsp;</a></span>KS_INIT_WFINSTANCE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_INIT_WFINSTANCE&#160;&#160;&#160;{NULL, 0, NULL, {<a class="el" href="_k_s_foundation_8h.html#ad01dd4f06fe226a502e872d4173ba7ae">KS_INIT_SEQLOC</a>}}</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Default values for <a class="el" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html" title="(Internal use) Structure being a part of various sequence objects to sort them in time across boards...">KS_WFINSTANCE</a> structs (internal use) </p>

</div>
</div>
<a id="aed050d8d7344db4d7ae33ba974855b8a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aed050d8d7344db4d7ae33ba974855b8a">&#9670;&nbsp;</a></span>KS_INIT_WAIT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_INIT_WAIT&#160;&#160;&#160;{{0,0,NULL,sizeof(<a class="el" href="struct_k_s___w_a_i_t.html">KS_WAIT</a>)}, <a class="el" href="_k_s_foundation_8h.html#a747ea3d02a820c7b57b76773d39f55d5">KS_INIT_DESC</a>, 0, <a class="el" href="_k_s_foundation_8h.html#a8b43f6a2290a9e0d94c660d62f17941e">KS_INITVALUE</a>(<a class="el" href="_k_s_foundation_8h.html#ab088ee3b5494b35ca60219f0b4e46e3b">KS_MAXINSTANCES</a>, <a class="el" href="_k_s_foundation_8h.html#ad01dd4f06fe226a502e872d4173ba7ae">KS_INIT_SEQLOC</a>), NULL, NULL}</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Default values for <a class="el" href="struct_k_s___w_a_i_t.html" title="Core sequence object that adds wait periods in the pulse sequence (see ks_eval_wait(), ks_pg_wait()). Can be placed on any sequence board">KS_WAIT</a> sequence objects </p>

</div>
</div>
<a id="a4ff7b57939cfc085f2d08b592137c26c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4ff7b57939cfc085f2d08b592137c26c">&#9670;&nbsp;</a></span>KS_INIT_ISIROT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_INIT_ISIROT&#160;&#160;&#160;{<a class="el" href="_k_s_foundation_8h.html#aed050d8d7344db4d7ae33ba974855b8a">KS_INIT_WAIT</a>, <a class="el" href="_k_s_foundation_8h.html#aed050d8d7344db4d7ae33ba974855b8a">KS_INIT_WAIT</a>, NULL, 0, 0, 0, 0}</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a1ba17433713316fa65385237ebb0fb67"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1ba17433713316fa65385237ebb0fb67">&#9670;&nbsp;</a></span>KS_INIT_TRAP</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_INIT_TRAP&#160;&#160;&#160;{{0,0,NULL,sizeof(<a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a>)}, <a class="el" href="_k_s_foundation_8h.html#a747ea3d02a820c7b57b76773d39f55d5">KS_INIT_DESC</a>, 0.0, 0.0, 0, 0, 0, {0, 0, 0}, <a class="el" href="_k_s_foundation_8h.html#a8b43f6a2290a9e0d94c660d62f17941e">KS_INITVALUE</a>(<a class="el" href="_k_s_foundation_8h.html#ab088ee3b5494b35ca60219f0b4e46e3b">KS_MAXINSTANCES</a>,<a class="el" href="_k_s_foundation_8h.html#ad01dd4f06fe226a502e872d4173ba7ae">KS_INIT_SEQLOC</a>), NULL, NULL, NULL}</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Default values for <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> sequence objects </p>

</div>
</div>
<a id="a2670dc2db110e2ab1ef9551b987d0bb6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2670dc2db110e2ab1ef9551b987d0bb6">&#9670;&nbsp;</a></span>KS_INIT_READ</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_INIT_READ&#160;&#160;&#160;{{0,0,NULL,sizeof(<a class="el" href="struct_k_s___r_e_a_d.html">KS_READ</a>)}, <a class="el" href="_k_s_foundation_8h.html#a747ea3d02a820c7b57b76773d39f55d5">KS_INIT_DESC</a>, 0, <a class="el" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>, {0.0, 0, 0.0, 0.0, <a class="el" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>, 0, 0, 0}, <a class="el" href="_k_s_foundation_8h.html#a8b43f6a2290a9e0d94c660d62f17941e">KS_INITVALUE</a>(<a class="el" href="_k_s_foundation_8h.html#ab088ee3b5494b35ca60219f0b4e46e3b">KS_MAXINSTANCES</a>,<a class="el" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>), NULL}</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Default values for <a class="el" href="struct_k_s___r_e_a_d.html" title="Core sequence object that handles a data acquisition window">KS_READ</a> sequence objects </p>

</div>
</div>
<a id="ac2eb269cadbe7324d2836fe2ed0d9e34"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac2eb269cadbe7324d2836fe2ed0d9e34">&#9670;&nbsp;</a></span>KS_INIT_READ_EPI</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_INIT_READ_EPI&#160;&#160;&#160;{{0,0,NULL,sizeof(<a class="el" href="struct_k_s___r_e_a_d.html">KS_READ</a>)}, <a class="el" href="_k_s_foundation_8h.html#a747ea3d02a820c7b57b76773d39f55d5">KS_INIT_DESC</a>, 0, 250.0, {0.0, 0, 0.0, 0.0, <a class="el" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>, 0, 0, 0}, <a class="el" href="_k_s_foundation_8h.html#a8b43f6a2290a9e0d94c660d62f17941e">KS_INITVALUE</a>(<a class="el" href="_k_s_foundation_8h.html#ab088ee3b5494b35ca60219f0b4e46e3b">KS_MAXINSTANCES</a>,<a class="el" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>), NULL}</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Default values for <a class="el" href="struct_k_s___r_e_a_d.html" title="Core sequence object that handles a data acquisition window">KS_READ</a> sequence objects in <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> </p>

</div>
</div>
<a id="a01108d382b19492c2178b6bedbfcbc4b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a01108d382b19492c2178b6bedbfcbc4b">&#9670;&nbsp;</a></span>KS_INIT_READTRAP</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_INIT_READTRAP&#160;&#160;&#160;{<a class="el" href="_k_s_foundation_8h.html#a2670dc2db110e2ab1ef9551b987d0bb6">KS_INIT_READ</a>, 240.0, 256, 0, 0, 0, 0.0, 0.0, 0.0, 0, <a class="el" href="_k_s_foundation_8h.html#a1ba17433713316fa65385237ebb0fb67">KS_INIT_TRAP</a>, <a class="el" href="_k_s_foundation_8h.html#a1ba17433713316fa65385237ebb0fb67">KS_INIT_TRAP</a>}</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Default values for <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> sequence objects </p>

</div>
</div>
<a id="a68b8d9096b683a787cea61e142c8c7ec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a68b8d9096b683a787cea61e142c8c7ec">&#9670;&nbsp;</a></span>KS_INIT_READTRAP_EPI</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_INIT_READTRAP_EPI&#160;&#160;&#160;{<a class="el" href="_k_s_foundation_8h.html#ac2eb269cadbe7324d2836fe2ed0d9e34">KS_INIT_READ_EPI</a>, 240.0, 64, 0, 0, 0, 0.0, 0.0, 0.0, 0,  <a class="el" href="_k_s_foundation_8h.html#a1ba17433713316fa65385237ebb0fb67">KS_INIT_TRAP</a>, <a class="el" href="_k_s_foundation_8h.html#a1ba17433713316fa65385237ebb0fb67">KS_INIT_TRAP</a>}</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Default values for the <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> sequence objects in <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> </p>

</div>
</div>
<a id="abc7dd035a692079d48dc6f0228c69715"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abc7dd035a692079d48dc6f0228c69715">&#9670;&nbsp;</a></span>KS_INIT_PHASEENCTABLE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_INIT_PHASEENCTABLE&#160;&#160;&#160;<a class="el" href="_k_s_foundation_8h.html#a5adde8c85d3d00e22516df96c55f4eb7">KS_INITZEROS</a>(<a class="el" href="_k_s_foundation_8h.html#ab48aef2b031ba0ae2572616c42e6890c">KS_MAX_PHASEDYN</a>)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Default values for the phase encoding table *.linetoacq* in the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> sequence object </p>

</div>
</div>
<a id="a5e620158a577fbdc94013a3f761a5a22"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5e620158a577fbdc94013a3f761a5a22">&#9670;&nbsp;</a></span>KS_INIT_PHASER</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_INIT_PHASER&#160;&#160;&#160;{<a class="el" href="_k_s_foundation_8h.html#a1ba17433713316fa65385237ebb0fb67">KS_INIT_TRAP</a>, 240.0, <a class="el" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>, 0, 1, 0, 0.0, 0, <a class="el" href="_k_s_foundation_8h.html#abc7dd035a692079d48dc6f0228c69715">KS_INIT_PHASEENCTABLE</a>}</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Default values for <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> sequence objects </p>

</div>
</div>
<a id="ae5e9ce52cebc9a6543bc6e69e9a03148"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae5e9ce52cebc9a6543bc6e69e9a03148">&#9670;&nbsp;</a></span>KS_INIT_PHASEENCODING_COORD</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_INIT_PHASEENCODING_COORD&#160;&#160;&#160;{<a class="el" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>, <a class="el" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>}</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a9cf630986b9344177e80b7d9644bfb81"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9cf630986b9344177e80b7d9644bfb81">&#9670;&nbsp;</a></span>KS_INIT_PHASEENCODING_PLAN</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_INIT_PHASEENCODING_PLAN&#160;&#160;&#160;{<a class="el" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>, <a class="el" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>, <a class="el" href="_k_s_foundation_8h.html#a747ea3d02a820c7b57b76773d39f55d5">KS_INIT_DESC</a>, NULL, NULL, NULL, FALSE}</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a3e677786bcadd601f03988f59cc20549"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3e677786bcadd601f03988f59cc20549">&#9670;&nbsp;</a></span>KS_INIT_EPI</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_INIT_EPI&#160;&#160;&#160;{<a class="el" href="_k_s_foundation_8h.html#a68b8d9096b683a787cea61e142c8c7ec">KS_INIT_READTRAP_EPI</a>, <a class="el" href="_k_s_foundation_8h.html#a1ba17433713316fa65385237ebb0fb67">KS_INIT_TRAP</a>, <a class="el" href="_k_s_foundation_8h.html#a1ba17433713316fa65385237ebb0fb67">KS_INIT_TRAP</a>, <a class="el" href="_k_s_foundation_8h.html#a5e620158a577fbdc94013a3f761a5a22">KS_INIT_PHASER</a>, <a class="el" href="_k_s_foundation_8h.html#a5e620158a577fbdc94013a3f761a5a22">KS_INIT_PHASER</a>, 0, 0, 0, 0, 1.0, <a class="el" href="_k_s_foundation_8h.html#ae89776067b59066dc231b6a75d1d6c00">KS_EPI_MINBLIPAREA</a>}</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Default values for <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> sequence objects </p>

</div>
</div>
<a id="a0e79a34b0ca2dc4338e03528d858105c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0e79a34b0ca2dc4338e03528d858105c">&#9670;&nbsp;</a></span>KS_INIT_WAVEVALUE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_INIT_WAVEVALUE&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Default value for one element in a KS_WAVEFORM </p>

</div>
</div>
<a id="a6f3115cf4ed2b225acc3a46df223ba7c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6f3115cf4ed2b225acc3a46df223ba7c">&#9670;&nbsp;</a></span>KS_INIT_WAVEFORM</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_INIT_WAVEFORM&#160;&#160;&#160;<a class="el" href="_k_s_foundation_8h.html#a8b43f6a2290a9e0d94c660d62f17941e">KS_INITVALUE</a>(<a class="el" href="_k_s_foundation_8h.html#a3c3e362198a193a273f436e9e392188b">KS_MAXWAVELEN</a>, <a class="el" href="_k_s_foundation_8h.html#a0e79a34b0ca2dc4338e03528d858105c">KS_INIT_WAVEVALUE</a>)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Default values for KS_WAVEFORM </p>

</div>
</div>
<a id="ae837f68085b812e9e22a659cc26a42cc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae837f68085b812e9e22a659cc26a42cc">&#9670;&nbsp;</a></span>KS_INIT_WAVE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_INIT_WAVE&#160;&#160;&#160;{{0,0,NULL,sizeof(<a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a>)}, <a class="el" href="_k_s_foundation_8h.html#a747ea3d02a820c7b57b76773d39f55d5">KS_INIT_DESC</a>, 0, 0, <a class="el" href="_k_s_foundation_8h.html#a6f3115cf4ed2b225acc3a46df223ba7c">KS_INIT_WAVEFORM</a>, {0,0,0}, <a class="el" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>, <a class="el" href="_k_s_foundation_8h.html#a8b43f6a2290a9e0d94c660d62f17941e">KS_INITVALUE</a>(<a class="el" href="_k_s_foundation_8h.html#ab088ee3b5494b35ca60219f0b4e46e3b">KS_MAXINSTANCES</a>,<a class="el" href="_k_s_foundation_8h.html#ad01dd4f06fe226a502e872d4173ba7ae">KS_INIT_SEQLOC</a>), NULL, NULL, NULL}</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Default values for <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> sequence objects </p>

</div>
</div>
<a id="ae4276b7972921313441cea1236c5f9d1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae4276b7972921313441cea1236c5f9d1">&#9670;&nbsp;</a></span>KS_INIT_READWAVE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_INIT_READWAVE&#160;&#160;&#160;{<a class="el" href="_k_s_foundation_8h.html#a8b43f6a2290a9e0d94c660d62f17941e">KS_INITVALUE</a>(3,<a class="el" href="_k_s_foundation_8h.html#ae837f68085b812e9e22a659cc26a42cc">KS_INIT_WAVE</a>), <a class="el" href="_k_s_foundation_8h.html#ae837f68085b812e9e22a659cc26a42cc">KS_INIT_WAVE</a>, <a class="el" href="_k_s_foundation_8h.html#ae837f68085b812e9e22a659cc26a42cc">KS_INIT_WAVE</a>, <a class="el" href="_k_s_foundation_8h.html#a2670dc2db110e2ab1ef9551b987d0bb6">KS_INIT_READ</a>, <a class="el" href="_k_s_foundation_8h.html#a8b43f6a2290a9e0d94c660d62f17941e">KS_INITVALUE</a>(3, 0), <a class="el" href="_k_s_foundation_8h.html#a8b43f6a2290a9e0d94c660d62f17941e">KS_INITVALUE</a>(3, 0.0), 0.0, 0.0, 0, 0}</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a25dd0df16b0ebe005df84081dd4f051b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a25dd0df16b0ebe005df84081dd4f051b">&#9670;&nbsp;</a></span>KS_INIT_DIXON_DUALREADTRAP</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_INIT_DIXON_DUALREADTRAP&#160;&#160;&#160;{<a class="el" href="_k_s_foundation_8h.html#ae4276b7972921313441cea1236c5f9d1">KS_INIT_READWAVE</a>, <a class="el" href="_k_s_foundation_8h.html#a747ea3d02a820c7b57b76773d39f55d5">KS_INIT_DESC</a>, 0,0,0,0,0.0,0, <a class="el" href="_k_s_foundation_8h.html#a8b43f6a2290a9e0d94c660d62f17941e">KS_INITVALUE</a>(2,0),0,0.0,0,0,0,0.0,0.0, <a class="el" href="_k_s_foundation_8h.html#a8b43f6a2290a9e0d94c660d62f17941e">KS_INITVALUE</a>(4,0)}</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Default values for <a class="el" href="struct_k_s___d_i_x_o_n___d_u_a_l_r_e_a_d_t_r_a_p.html">KS_DIXON_DUALREADTRAP</a> sequence objects </p>

</div>
</div>
<a id="a8e0023e45a895db380f6e50698a76c07"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8e0023e45a895db380f6e50698a76c07">&#9670;&nbsp;</a></span>RX27_APPLY_HADAMARD</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RX27_APPLY_HADAMARD</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a579993d04a8e73022461a6cc976d683a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a579993d04a8e73022461a6cc976d683a">&#9670;&nbsp;</a></span>KS_INIT_RFPULSE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_INIT_RFPULSE&#160;&#160;&#160;{NULL, NULL, 0.0,0.0,0.0,0.0,0.0,0,0.0,0.0,0.0,0.0,NULL,0.0,0.0,0,0,-1,0.0,NULL,0,NULL <a class="el" href="_k_s_foundation_8h.html#a8e0023e45a895db380f6e50698a76c07">RX27_APPLY_HADAMARD</a>}</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Default values for GE's RF_PULSE structure </p>

</div>
</div>
<a id="afc1615558f21efc6020df64ade026467"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afc1615558f21efc6020df64ade026467">&#9670;&nbsp;</a></span>KS_INIT_RF</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_INIT_RF&#160;&#160;&#160;{<a class="el" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedace0db3ff9bb8cad071dc42579e9aadaf">KS_RF_ROLE_NOTSET</a>, <a class="el" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>, <a class="el" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>, 0.0, 0.0, <a class="el" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>, <a class="el" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>, <a class="el" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>, <a class="el" href="_k_s_foundation_8h.html#a747ea3d02a820c7b57b76773d39f55d5">KS_INIT_DESC</a>, <a class="el" href="_k_s_foundation_8h.html#a579993d04a8e73022461a6cc976d683a">KS_INIT_RFPULSE</a>, <a class="el" href="_k_s_foundation_8h.html#ae837f68085b812e9e22a659cc26a42cc">KS_INIT_WAVE</a>, <a class="el" href="_k_s_foundation_8h.html#ae837f68085b812e9e22a659cc26a42cc">KS_INIT_WAVE</a>, <a class="el" href="_k_s_foundation_8h.html#ae837f68085b812e9e22a659cc26a42cc">KS_INIT_WAVE</a>}</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Default values for <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> sequence objects </p>

</div>
</div>
<a id="a8d8030715d634067abc0732b5507ce14"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8d8030715d634067abc0732b5507ce14">&#9670;&nbsp;</a></span>KS_INIT_SELRF</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_INIT_SELRF&#160;&#160;&#160;{<a class="el" href="_k_s_foundation_8h.html#afc1615558f21efc6020df64ade026467">KS_INIT_RF</a>, <a class="el" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>, 1.0, <a class="el" href="_k_s_foundation_8h.html#a1ba17433713316fa65385237ebb0fb67">KS_INIT_TRAP</a>, <a class="el" href="_k_s_foundation_8h.html#a1ba17433713316fa65385237ebb0fb67">KS_INIT_TRAP</a>, <a class="el" href="_k_s_foundation_8h.html#a1ba17433713316fa65385237ebb0fb67">KS_INIT_TRAP</a>, <a class="el" href="_k_s_foundation_8h.html#ae837f68085b812e9e22a659cc26a42cc">KS_INIT_WAVE</a>, <a class="el" href="_k_s_foundation_8h.html#aad777b22fb342c595fed2578676d9c05">KS_INIT_SMS_INFO</a>}</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Default values for <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> sequence objects </p>

</div>
</div>
<a id="ad4fa24a8bda2c4137b3ae52f7e479df6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad4fa24a8bda2c4137b3ae52f7e479df6">&#9670;&nbsp;</a></span>KS_INIT_GRADRFCTRL</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_INIT_GRADRFCTRL&#160;&#160;&#160;{<a class="el" href="_k_s_foundation_8h.html#a5adde8c85d3d00e22516df96c55f4eb7">KS_INITZEROS</a>(<a class="el" href="_k_s_foundation_8h.html#a4becfb20a2ad2227c16c4ce772ed8d51">KS_MAXUNIQUE_RF</a>), 0, <a class="el" href="_k_s_foundation_8h.html#a5adde8c85d3d00e22516df96c55f4eb7">KS_INITZEROS</a>(<a class="el" href="_k_s_foundation_8h.html#a034073abe489e0f26ff7693e11abbb02">KS_MAXUNIQUE_TRAP</a>), 0, <a class="el" href="_k_s_foundation_8h.html#a5adde8c85d3d00e22516df96c55f4eb7">KS_INITZEROS</a>(<a class="el" href="_k_s_foundation_8h.html#a4a92ef54385807dc82f7a5113156f31e">KS_MAXUNIQUE_WAVE</a>), 0, <a class="el" href="_k_s_foundation_8h.html#a5adde8c85d3d00e22516df96c55f4eb7">KS_INITZEROS</a>(<a class="el" href="_k_s_foundation_8h.html#a8b4a19e776c83d9477d2d4135a564aeb">KS_MAXUNIQUE_READ</a>), 0, FALSE /* is_cleared_on_tgt */ }</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Default values for <a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html" title="typedef struct that is a part of the KS_SEQ_CONTROL typedef struct, used internally to collect gradie...">KS_GRADRFCTRL</a> control handler </p>

</div>
</div>
<a id="a34187a64ff37224714ad49aa2dd9b2e0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a34187a64ff37224714ad49aa2dd9b2e0">&#9670;&nbsp;</a></span>KS_INIT_SEQ_HANDLE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_INIT_SEQ_HANDLE&#160;&#160;&#160;{NULL, 0, NULL}</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Default values for the <a class="el" href="struct_k_s___s_e_q___h_a_n_d_l_e.html" title="Internal typedef struct that is a part of the KS_SEQ_CONTROL typedef struct. Should not be used direc...">KS_SEQ_HANDLE</a> struct </p>

</div>
</div>
<a id="a232cf810c71aebfeadc56a82f472a1ad"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a232cf810c71aebfeadc56a82f472a1ad">&#9670;&nbsp;</a></span>KS_INIT_SEQ_CONTROL</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_INIT_SEQ_CONTROL&#160;&#160;&#160;{0, 0, 1000, 0, <a class="el" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>, FALSE, <a class="el" href="_k_s_foundation_8h.html#a747ea3d02a820c7b57b76773d39f55d5">KS_INIT_DESC</a>, <a class="el" href="_k_s_foundation_8h.html#a34187a64ff37224714ad49aa2dd9b2e0">KS_INIT_SEQ_HANDLE</a>, <a class="el" href="_k_s_foundation_8h.html#ad4fa24a8bda2c4137b3ae52f7e479df6">KS_INIT_GRADRFCTRL</a>}</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Default values for the <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> struct </p>

</div>
</div>
<a id="a1e2fc6159630ad04bd9d5756cd8620b0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1e2fc6159630ad04bd9d5756cd8620b0">&#9670;&nbsp;</a></span>KS_INIT_SEQ_COLLECTION</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_INIT_SEQ_COLLECTION&#160;&#160;&#160;{0, <a class="el" href="_k_s_foundation_8h.html#a99fb83031ce9923c84392b4e92f956b5a634591f5e0e6042c3ed95c0ae543b402">KS_SEQ_COLLECTION_ALLOWNEW</a>, FALSE, <a class="el" href="_k_s_foundation_8h.html#a8b43f6a2290a9e0d94c660d62f17941e">KS_INITVALUE</a>(<a class="el" href="_k_s_foundation_8h.html#a92ed0352c04ca279b44bf62d253b143a">KS_MAXUNIQUE_SEQUENCES</a>, NULL)}</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Default values for the <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> struct </p>

</div>
</div>
<a id="a71d461ee537a1b66b623d50cd4126fbf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a71d461ee537a1b66b623d50cd4126fbf">&#9670;&nbsp;</a></span>KS_INIT_SAR</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_INIT_SAR&#160;&#160;&#160;{0, 0, 0, 0}</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Default values for the <a class="el" href="struct_k_s___s_a_r.html" title="Struct to keep SAR parameters together. Used in ks_eval_gradrflimits() and GEReq_eval_checkTR_SAR_cal...">KS_SAR</a> struct </p>

</div>
</div>
<a id="a46bcd22394cbabe45e76cc0d4af01aa9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a46bcd22394cbabe45e76cc0d4af01aa9">&#9670;&nbsp;</a></span>KS_INIT_SLICEPLAN</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_INIT_SLICEPLAN&#160;&#160;&#160;{0,0,0,{{0,0,0}}};</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Default values for the <a class="el" href="struct_k_s___s_l_i_c_e___p_l_a_n.html" title="Struct holding all information about slice locations and aquisition order">KS_SLICE_PLAN</a> struct </p>

</div>
</div>
<a id="aad777b22fb342c595fed2578676d9c05"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aad777b22fb342c595fed2578676d9c05">&#9670;&nbsp;</a></span>KS_INIT_SMS_INFO</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_INIT_SMS_INFO&#160;&#160;&#160;{1, 0, 0}</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Default values for the KS_INIT_SMS_INFO struct </p>

</div>
</div>
<a id="a24fd14eec35d384b79cda944db13cab1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a24fd14eec35d384b79cda944db13cab1">&#9670;&nbsp;</a></span>KS_INIT_LOGGRD</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_INIT_LOGGRD&#160;&#160;&#160;{0,0,0,0,0,0,{0,0,0,0,0,0},{0,0,0,0},{0,0,0,0},{0,0,0,0},{0,0,0,0},{0,0,0,0},{0,0,0,0},0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 }</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Default values for GE's loggrd struct </p>

</div>
</div>
<a id="a686ba26d7cfe588e72fbb19a2c13a5e0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a686ba26d7cfe588e72fbb19a2c13a5e0">&#9670;&nbsp;</a></span>KS_INIT_PHYSGRD</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_INIT_PHYSGRD&#160;&#160;&#160;{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 }</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Default values for GE's phygrd struct </p>

</div>
</div>
<a id="a53c3358d8072b5398809231c87ee7b43"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a53c3358d8072b5398809231c87ee7b43">&#9670;&nbsp;</a></span>KS_MAT3x3_IDENTITY</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_MAT3x3_IDENTITY&#160;&#160;&#160;{1,0,0,0,1,0,0,0,1}</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Identity matrix initialization for KS_MAT3x3 </p>

</div>
</div>
<a id="afdbaf673741ec0d6d5ebb7ab5974338e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afdbaf673741ec0d6d5ebb7ab5974338e">&#9670;&nbsp;</a></span>KS_MAT4x4_IDENTITY</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_MAT4x4_IDENTITY&#160;&#160;&#160;{1,0,0,0, 0,1,0,0, 0,0,1,0, 0,0,0,1}</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Identity matrix initialization for KS_MAT4x4 </p>

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="a06d5868fa630d1c05faea3350dbf045c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a06d5868fa630d1c05faea3350dbf045c">&#9670;&nbsp;</a></span>KS_DESCRIPTION</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef char KS_DESCRIPTION[<a class="el" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a>]</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Char array used in all KS_**** sequence objects </p>

</div>
</div>
<a id="a98d69b5689c184e4f57ab124e726f964"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a98d69b5689c184e4f57ab124e726f964">&#9670;&nbsp;</a></span>KS_WAVEFORM</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef float KS_WAVEFORM[<a class="el" href="_k_s_foundation_8h.html#a3c3e362198a193a273f436e9e392188b">KS_MAXWAVELEN</a>]</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Waveform array for RF, Theta or custom gradients </p>

</div>
</div>
<a id="abba996c24da629eea72eecbd9a22a873"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abba996c24da629eea72eecbd9a22a873">&#9670;&nbsp;</a></span>KS_IWAVE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef short KS_IWAVE[<a class="el" href="_k_s_foundation_8h.html#a3c3e362198a193a273f436e9e392188b">KS_MAXWAVELEN</a>]</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Interim short integer array to copy to hardware (internal use) </p>

</div>
</div>
<a id="aeecaa16a2b55b6aa37e125536b565657"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeecaa16a2b55b6aa37e125536b565657">&#9670;&nbsp;</a></span>KS_MAT3x3</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef double KS_MAT3x3[9]</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Array to store a row major 3x3 matrix </p>

</div>
</div>
<a id="a7b8e8b52358de55dd1fb64ef924b2f48"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7b8e8b52358de55dd1fb64ef924b2f48">&#9670;&nbsp;</a></span>KS_MAT4x4</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef double KS_MAT4x4[16]</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Array to store a row major 4x4 matrix </p>

</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="a0af3c4f49a609b3bc02c7be25b9c7c5f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0af3c4f49a609b3bc02c7be25b9c7c5f">&#9670;&nbsp;</a></span>KS_PLOT_FILEFORMATS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5f">KS_PLOT_FILEFORMATS</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a0af3c4f49a609b3bc02c7be25b9c7c5fadd75ba7d05d9527ea99f8643787d46ac"></a>KS_PLOT_OFF&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a0af3c4f49a609b3bc02c7be25b9c7c5faac5f8bbc7e8971122b8a663e191d381f"></a>KS_PLOT_MAKEPDF&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a0af3c4f49a609b3bc02c7be25b9c7c5fa79f80dc07b43457247759abc36002038"></a>KS_PLOT_MAKESVG&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a0af3c4f49a609b3bc02c7be25b9c7c5fae199cefaae88fb3ffc5eee3109bbe3d7"></a>KS_PLOT_MAKEPNG&#160;</td><td class="fielddoc"></td></tr>
</table>
<div class="fragment"><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;             {</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5fadd75ba7d05d9527ea99f8643787d46ac">KS_PLOT_OFF</a>,</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5faac5f8bbc7e8971122b8a663e191d381f">KS_PLOT_MAKEPDF</a>,</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5fa79f80dc07b43457247759abc36002038">KS_PLOT_MAKESVG</a>,</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5fae199cefaae88fb3ffc5eee3109bbe3d7">KS_PLOT_MAKEPNG</a></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;} <a class="code" href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5f">KS_PLOT_FILEFORMATS</a>;</div><div class="ttc" id="_k_s_foundation_8h_html_a0af3c4f49a609b3bc02c7be25b9c7c5fadd75ba7d05d9527ea99f8643787d46ac"><div class="ttname"><a href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5fadd75ba7d05d9527ea99f8643787d46ac">KS_PLOT_OFF</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:188</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a0af3c4f49a609b3bc02c7be25b9c7c5fae199cefaae88fb3ffc5eee3109bbe3d7"><div class="ttname"><a href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5fae199cefaae88fb3ffc5eee3109bbe3d7">KS_PLOT_MAKEPNG</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:191</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a0af3c4f49a609b3bc02c7be25b9c7c5f"><div class="ttname"><a href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5f">KS_PLOT_FILEFORMATS</a></div><div class="ttdeci">KS_PLOT_FILEFORMATS</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:187</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a0af3c4f49a609b3bc02c7be25b9c7c5faac5f8bbc7e8971122b8a663e191d381f"><div class="ttname"><a href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5faac5f8bbc7e8971122b8a663e191d381f">KS_PLOT_MAKEPDF</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:189</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a0af3c4f49a609b3bc02c7be25b9c7c5fa79f80dc07b43457247759abc36002038"><div class="ttname"><a href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5fa79f80dc07b43457247759abc36002038">KS_PLOT_MAKESVG</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:190</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0ba82984ac3a22ad68cab5bce5224cf9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0ba82984ac3a22ad68cab5bce5224cf9">&#9670;&nbsp;</a></span>KS_PLOT_EXCITATION_MODE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="_k_s_foundation_8h.html#a0ba82984ac3a22ad68cab5bce5224cf9">KS_PLOT_EXCITATION_MODE</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a0ba82984ac3a22ad68cab5bce5224cf9a31ef5b1dd7ca976daa060cd0bb7aa679"></a>KS_PLOT_STANDARD&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a0ba82984ac3a22ad68cab5bce5224cf9adbb6a4373075b4e441df71373a3d55ad"></a>KS_PLOT_NO_EXCITATION&#160;</td><td class="fielddoc"></td></tr>
</table>
<div class="fragment"><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;             {</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a0ba82984ac3a22ad68cab5bce5224cf9a31ef5b1dd7ca976daa060cd0bb7aa679">KS_PLOT_STANDARD</a>,</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a0ba82984ac3a22ad68cab5bce5224cf9adbb6a4373075b4e441df71373a3d55ad">KS_PLOT_NO_EXCITATION</a></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;} <a class="code" href="_k_s_foundation_8h.html#a0ba82984ac3a22ad68cab5bce5224cf9">KS_PLOT_EXCITATION_MODE</a>;</div><div class="ttc" id="_k_s_foundation_8h_html_a0ba82984ac3a22ad68cab5bce5224cf9"><div class="ttname"><a href="_k_s_foundation_8h.html#a0ba82984ac3a22ad68cab5bce5224cf9">KS_PLOT_EXCITATION_MODE</a></div><div class="ttdeci">KS_PLOT_EXCITATION_MODE</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:193</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a0ba82984ac3a22ad68cab5bce5224cf9adbb6a4373075b4e441df71373a3d55ad"><div class="ttname"><a href="_k_s_foundation_8h.html#a0ba82984ac3a22ad68cab5bce5224cf9adbb6a4373075b4e441df71373a3d55ad">KS_PLOT_NO_EXCITATION</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:195</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a0ba82984ac3a22ad68cab5bce5224cf9a31ef5b1dd7ca976daa060cd0bb7aa679"><div class="ttname"><a href="_k_s_foundation_8h.html#a0ba82984ac3a22ad68cab5bce5224cf9a31ef5b1dd7ca976daa060cd0bb7aa679">KS_PLOT_STANDARD</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:194</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a41f5719fe6c2d60e864572e00af44342"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a41f5719fe6c2d60e864572e00af44342">&#9670;&nbsp;</a></span>KS_PLOT_PASS_MODE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="_k_s_foundation_8h.html#a41f5719fe6c2d60e864572e00af44342">KS_PLOT_PASS_MODE</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a41f5719fe6c2d60e864572e00af44342a676278a26cf0540ba967faa440461dc4"></a>KS_PLOT_PASS_WAS_DUMMY&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a41f5719fe6c2d60e864572e00af44342a720101fc6fb1f89f445b01ac1083214e"></a>KS_PLOT_PASS_WAS_CALIBRATION&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a41f5719fe6c2d60e864572e00af44342a1850e2f2b51731a0e043855f5991dda2"></a>KS_PLOT_PASS_WAS_STANDARD&#160;</td><td class="fielddoc"></td></tr>
</table>
<div class="fragment"><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;             {</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a41f5719fe6c2d60e864572e00af44342a676278a26cf0540ba967faa440461dc4">KS_PLOT_PASS_WAS_DUMMY</a>,</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a41f5719fe6c2d60e864572e00af44342a720101fc6fb1f89f445b01ac1083214e">KS_PLOT_PASS_WAS_CALIBRATION</a>,</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a41f5719fe6c2d60e864572e00af44342a1850e2f2b51731a0e043855f5991dda2">KS_PLOT_PASS_WAS_STANDARD</a></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;} <a class="code" href="_k_s_foundation_8h.html#a41f5719fe6c2d60e864572e00af44342">KS_PLOT_PASS_MODE</a>;</div><div class="ttc" id="_k_s_foundation_8h_html_a41f5719fe6c2d60e864572e00af44342a676278a26cf0540ba967faa440461dc4"><div class="ttname"><a href="_k_s_foundation_8h.html#a41f5719fe6c2d60e864572e00af44342a676278a26cf0540ba967faa440461dc4">KS_PLOT_PASS_WAS_DUMMY</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:198</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a41f5719fe6c2d60e864572e00af44342"><div class="ttname"><a href="_k_s_foundation_8h.html#a41f5719fe6c2d60e864572e00af44342">KS_PLOT_PASS_MODE</a></div><div class="ttdeci">KS_PLOT_PASS_MODE</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:197</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a41f5719fe6c2d60e864572e00af44342a1850e2f2b51731a0e043855f5991dda2"><div class="ttname"><a href="_k_s_foundation_8h.html#a41f5719fe6c2d60e864572e00af44342a1850e2f2b51731a0e043855f5991dda2">KS_PLOT_PASS_WAS_STANDARD</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:200</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a41f5719fe6c2d60e864572e00af44342a720101fc6fb1f89f445b01ac1083214e"><div class="ttname"><a href="_k_s_foundation_8h.html#a41f5719fe6c2d60e864572e00af44342a720101fc6fb1f89f445b01ac1083214e">KS_PLOT_PASS_WAS_CALIBRATION</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:199</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a51a2c4637bfcef5c062d3c794ed4ded5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a51a2c4637bfcef5c062d3c794ed4ded5">&#9670;&nbsp;</a></span>ks_enum_trapparts</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5">ks_enum_trapparts</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a51a2c4637bfcef5c062d3c794ed4ded5ae2ef535229a83f6deb239caa1ff7120e"></a>G_ATTACK&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a51a2c4637bfcef5c062d3c794ed4ded5ac00e089392912df36396789decb230a4"></a>G_PLATEAU&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a51a2c4637bfcef5c062d3c794ed4ded5a8b1103e672a6fc1aa616ac7f422410de"></a>G_DECAY&#160;</td><td class="fielddoc"></td></tr>
</table>
<div class="fragment"><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;{<a class="code" href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5ae2ef535229a83f6deb239caa1ff7120e">G_ATTACK</a>, <a class="code" href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5ac00e089392912df36396789decb230a4">G_PLATEAU</a>, <a class="code" href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5a8b1103e672a6fc1aa616ac7f422410de">G_DECAY</a>};</div><div class="ttc" id="_k_s_foundation_8h_html_a51a2c4637bfcef5c062d3c794ed4ded5ac00e089392912df36396789decb230a4"><div class="ttname"><a href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5ac00e089392912df36396789decb230a4">G_PLATEAU</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1737</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a51a2c4637bfcef5c062d3c794ed4ded5ae2ef535229a83f6deb239caa1ff7120e"><div class="ttname"><a href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5ae2ef535229a83f6deb239caa1ff7120e">G_ATTACK</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1737</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a51a2c4637bfcef5c062d3c794ed4ded5a8b1103e672a6fc1aa616ac7f422410de"><div class="ttname"><a href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5a8b1103e672a6fc1aa616ac7f422410de">G_DECAY</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1737</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a5a6c30061dd7a6d943e51c3697727ba8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5a6c30061dd7a6d943e51c3697727ba8">&#9670;&nbsp;</a></span>ks_enum_boarddef</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8">ks_enum_boarddef</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a5a6c30061dd7a6d943e51c3697727ba8a8bf7786da83ee7a9acda99954f5ddb18"></a>KS_X&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a5a6c30061dd7a6d943e51c3697727ba8a9068d2f1c6396f6637e79e9efc9c78d6"></a>KS_Y&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a5a6c30061dd7a6d943e51c3697727ba8a863875ce8883958892a50da6912137e5"></a>KS_Z&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a5a6c30061dd7a6d943e51c3697727ba8ab2a1257fd51cfddbee0232e96de42a28"></a>KS_RHO&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a5a6c30061dd7a6d943e51c3697727ba8aebefea71c9bec2b927545759821d6657"></a>KS_RHO2&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a5a6c30061dd7a6d943e51c3697727ba8a5f69543fc085b8edd07121876aaecfde"></a>KS_THETA&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a5a6c30061dd7a6d943e51c3697727ba8a4097e54f46e0ea6bd57250be6ca4e967"></a>KS_OMEGA&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a5a6c30061dd7a6d943e51c3697727ba8a8aa6618ed15d4c8f40d8cc5f3426e89d"></a>KS_SSP&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a5a6c30061dd7a6d943e51c3697727ba8a6016c24e63f250c7e49d537c9b01dea1"></a>KS_FREQX_PHASEY&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a5a6c30061dd7a6d943e51c3697727ba8a9bc0b0996e2ac9c6a131209ae4c88629"></a>KS_FREQY_PHASEX&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a5a6c30061dd7a6d943e51c3697727ba8ae0b83b9295764e027abbf88b95b09879"></a>KS_FREQX_PHASEZ&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a5a6c30061dd7a6d943e51c3697727ba8ae2467923eda691b22f68ca96bd7e1c1f"></a>KS_FREQZ_PHASEX&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a5a6c30061dd7a6d943e51c3697727ba8afa622a33dd2854dfe97a4056ecec5b67"></a>KS_FREQY_PHASEZ&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a5a6c30061dd7a6d943e51c3697727ba8ad53040a098477496911fa2b1850a2d93"></a>KS_FREQZ_PHASEY&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a5a6c30061dd7a6d943e51c3697727ba8a888d3c7138175390df8ccde3cf29c868"></a>KS_XYZ&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a5a6c30061dd7a6d943e51c3697727ba8a839a809fe0e8486a8cd3d41788349129"></a>KS_ALL&#160;</td><td class="fielddoc"></td></tr>
</table>
<div class="fragment"><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;{<a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a8bf7786da83ee7a9acda99954f5ddb18">KS_X</a>, <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a9068d2f1c6396f6637e79e9efc9c78d6">KS_Y</a>, <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a863875ce8883958892a50da6912137e5">KS_Z</a>, <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ab2a1257fd51cfddbee0232e96de42a28">KS_RHO</a>, <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8aebefea71c9bec2b927545759821d6657">KS_RHO2</a>, <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a5f69543fc085b8edd07121876aaecfde">KS_THETA</a>, <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a4097e54f46e0ea6bd57250be6ca4e967">KS_OMEGA</a>, <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a8aa6618ed15d4c8f40d8cc5f3426e89d">KS_SSP</a>, <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a6016c24e63f250c7e49d537c9b01dea1">KS_FREQX_PHASEY</a>, <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a9bc0b0996e2ac9c6a131209ae4c88629">KS_FREQY_PHASEX</a>, <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ae0b83b9295764e027abbf88b95b09879">KS_FREQX_PHASEZ</a>, <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ae2467923eda691b22f68ca96bd7e1c1f">KS_FREQZ_PHASEX</a>, <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8afa622a33dd2854dfe97a4056ecec5b67">KS_FREQY_PHASEZ</a>, <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ad53040a098477496911fa2b1850a2d93">KS_FREQZ_PHASEY</a>, <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a888d3c7138175390df8ccde3cf29c868">KS_XYZ</a>, <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a839a809fe0e8486a8cd3d41788349129">KS_ALL</a>};</div><div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8a6016c24e63f250c7e49d537c9b01dea1"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a6016c24e63f250c7e49d537c9b01dea1">KS_FREQX_PHASEY</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8a9068d2f1c6396f6637e79e9efc9c78d6"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a9068d2f1c6396f6637e79e9efc9c78d6">KS_Y</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8ae0b83b9295764e027abbf88b95b09879"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ae0b83b9295764e027abbf88b95b09879">KS_FREQX_PHASEZ</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8aebefea71c9bec2b927545759821d6657"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8aebefea71c9bec2b927545759821d6657">KS_RHO2</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8a4097e54f46e0ea6bd57250be6ca4e967"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a4097e54f46e0ea6bd57250be6ca4e967">KS_OMEGA</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8ab2a1257fd51cfddbee0232e96de42a28"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ab2a1257fd51cfddbee0232e96de42a28">KS_RHO</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8a8bf7786da83ee7a9acda99954f5ddb18"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a8bf7786da83ee7a9acda99954f5ddb18">KS_X</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8a5f69543fc085b8edd07121876aaecfde"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a5f69543fc085b8edd07121876aaecfde">KS_THETA</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8a888d3c7138175390df8ccde3cf29c868"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a888d3c7138175390df8ccde3cf29c868">KS_XYZ</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8ad53040a098477496911fa2b1850a2d93"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ad53040a098477496911fa2b1850a2d93">KS_FREQZ_PHASEY</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8a863875ce8883958892a50da6912137e5"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a863875ce8883958892a50da6912137e5">KS_Z</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8a839a809fe0e8486a8cd3d41788349129"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a839a809fe0e8486a8cd3d41788349129">KS_ALL</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8ae2467923eda691b22f68ca96bd7e1c1f"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ae2467923eda691b22f68ca96bd7e1c1f">KS_FREQZ_PHASEX</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8a9bc0b0996e2ac9c6a131209ae4c88629"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a9bc0b0996e2ac9c6a131209ae4c88629">KS_FREQY_PHASEX</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8a8aa6618ed15d4c8f40d8cc5f3426e89d"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a8aa6618ed15d4c8f40d8cc5f3426e89d">KS_SSP</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8afa622a33dd2854dfe97a4056ecec5b67"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8afa622a33dd2854dfe97a4056ecec5b67">KS_FREQY_PHASEZ</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae3a267da7c3c7e4e6e523dafba9b7811"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae3a267da7c3c7e4e6e523dafba9b7811">&#9670;&nbsp;</a></span>ks_enum_epiblipsign</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811">ks_enum_epiblipsign</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="ae3a267da7c3c7e4e6e523dafba9b7811ab36b1c8bcdbe924fc9d4a36cde9ba4dd"></a>KS_EPI_POSBLIPS&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="ae3a267da7c3c7e4e6e523dafba9b7811a38ffa981f0cb6b0e4660575afb14f751"></a>KS_EPI_NOBLIPS&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="ae3a267da7c3c7e4e6e523dafba9b7811a5b332d904cae8d59fc2f85b49ada0ae4"></a>KS_EPI_NEGBLIPS&#160;</td><td class="fielddoc"></td></tr>
</table>
<div class="fragment"><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;{<a class="code" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811ab36b1c8bcdbe924fc9d4a36cde9ba4dd">KS_EPI_POSBLIPS</a> = 1, <a class="code" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811a38ffa981f0cb6b0e4660575afb14f751">KS_EPI_NOBLIPS</a> = 0, <a class="code" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811a5b332d904cae8d59fc2f85b49ada0ae4">KS_EPI_NEGBLIPS</a> = -1} <a class="code" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811">ks_enum_epiblipsign</a>; <span class="comment">/* positive or negative blips. Don&#39;t change the enum values (+1, -1)! */</span></div><div class="ttc" id="_k_s_foundation_8h_html_ae3a267da7c3c7e4e6e523dafba9b7811ab36b1c8bcdbe924fc9d4a36cde9ba4dd"><div class="ttname"><a href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811ab36b1c8bcdbe924fc9d4a36cde9ba4dd">KS_EPI_POSBLIPS</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1741</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ae3a267da7c3c7e4e6e523dafba9b7811"><div class="ttname"><a href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811">ks_enum_epiblipsign</a></div><div class="ttdeci">ks_enum_epiblipsign</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1741</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ae3a267da7c3c7e4e6e523dafba9b7811a38ffa981f0cb6b0e4660575afb14f751"><div class="ttname"><a href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811a38ffa981f0cb6b0e4660575afb14f751">KS_EPI_NOBLIPS</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1741</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ae3a267da7c3c7e4e6e523dafba9b7811a5b332d904cae8d59fc2f85b49ada0ae4"><div class="ttname"><a href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811a5b332d904cae8d59fc2f85b49ada0ae4">KS_EPI_NEGBLIPS</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1741</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a11a05c3ea650ef64c6421ced6c56bff4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a11a05c3ea650ef64c6421ced6c56bff4">&#9670;&nbsp;</a></span>ks_enum_diffusion</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="_k_s_foundation_8h.html#a11a05c3ea650ef64c6421ced6c56bff4">ks_enum_diffusion</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a11a05c3ea650ef64c6421ced6c56bff4ae83a7b8e0bbdb066112c5c807293e176"></a>KS_EPI_DIFFUSION_OFF&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a11a05c3ea650ef64c6421ced6c56bff4a74ba4041bf3d1545f9bfdba233bddb7b"></a>KS_EPI_DIFFUSION_ON&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a11a05c3ea650ef64c6421ced6c56bff4aa4576cd2d3b8dc8631cc85b1c4a7edaf"></a>KS_EPI_DIFFUSION_PRETEND_FOR_RECON&#160;</td><td class="fielddoc"></td></tr>
</table>
<div class="fragment"><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;{<a class="code" href="_k_s_foundation_8h.html#a11a05c3ea650ef64c6421ced6c56bff4ae83a7b8e0bbdb066112c5c807293e176">KS_EPI_DIFFUSION_OFF</a>, <a class="code" href="_k_s_foundation_8h.html#a11a05c3ea650ef64c6421ced6c56bff4a74ba4041bf3d1545f9bfdba233bddb7b">KS_EPI_DIFFUSION_ON</a>, <a class="code" href="_k_s_foundation_8h.html#a11a05c3ea650ef64c6421ced6c56bff4aa4576cd2d3b8dc8631cc85b1c4a7edaf">KS_EPI_DIFFUSION_PRETEND_FOR_RECON</a>};</div><div class="ttc" id="_k_s_foundation_8h_html_a11a05c3ea650ef64c6421ced6c56bff4ae83a7b8e0bbdb066112c5c807293e176"><div class="ttname"><a href="_k_s_foundation_8h.html#a11a05c3ea650ef64c6421ced6c56bff4ae83a7b8e0bbdb066112c5c807293e176">KS_EPI_DIFFUSION_OFF</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1742</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a11a05c3ea650ef64c6421ced6c56bff4a74ba4041bf3d1545f9bfdba233bddb7b"><div class="ttname"><a href="_k_s_foundation_8h.html#a11a05c3ea650ef64c6421ced6c56bff4a74ba4041bf3d1545f9bfdba233bddb7b">KS_EPI_DIFFUSION_ON</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1742</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a11a05c3ea650ef64c6421ced6c56bff4aa4576cd2d3b8dc8631cc85b1c4a7edaf"><div class="ttname"><a href="_k_s_foundation_8h.html#a11a05c3ea650ef64c6421ced6c56bff4aa4576cd2d3b8dc8631cc85b1c4a7edaf">KS_EPI_DIFFUSION_PRETEND_FOR_RECON</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1742</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae418ab3d6fe87794cd978b12d10ed699"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae418ab3d6fe87794cd978b12d10ed699">&#9670;&nbsp;</a></span>ks_enum_imsize</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="_k_s_foundation_8h.html#ae418ab3d6fe87794cd978b12d10ed699">ks_enum_imsize</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="ae418ab3d6fe87794cd978b12d10ed699ae462c5cfa8631a66d48604d1c04a0af4"></a>KS_IMSIZE_NATIVE&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="ae418ab3d6fe87794cd978b12d10ed699a27dfe464db7e9579482065d43f0d9118"></a>KS_IMSIZE_POW2&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="ae418ab3d6fe87794cd978b12d10ed699ad8ee9fcfbd4ce48b046b2c6bd8557bb0"></a>KS_IMSIZE_MIN256&#160;</td><td class="fielddoc"></td></tr>
</table>
<div class="fragment"><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;{<a class="code" href="_k_s_foundation_8h.html#ae418ab3d6fe87794cd978b12d10ed699ae462c5cfa8631a66d48604d1c04a0af4">KS_IMSIZE_NATIVE</a>, <a class="code" href="_k_s_foundation_8h.html#ae418ab3d6fe87794cd978b12d10ed699a27dfe464db7e9579482065d43f0d9118">KS_IMSIZE_POW2</a>, <a class="code" href="_k_s_foundation_8h.html#ae418ab3d6fe87794cd978b12d10ed699ad8ee9fcfbd4ce48b046b2c6bd8557bb0">KS_IMSIZE_MIN256</a>};</div><div class="ttc" id="_k_s_foundation_8h_html_ae418ab3d6fe87794cd978b12d10ed699a27dfe464db7e9579482065d43f0d9118"><div class="ttname"><a href="_k_s_foundation_8h.html#ae418ab3d6fe87794cd978b12d10ed699a27dfe464db7e9579482065d43f0d9118">KS_IMSIZE_POW2</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1745</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ae418ab3d6fe87794cd978b12d10ed699ad8ee9fcfbd4ce48b046b2c6bd8557bb0"><div class="ttname"><a href="_k_s_foundation_8h.html#ae418ab3d6fe87794cd978b12d10ed699ad8ee9fcfbd4ce48b046b2c6bd8557bb0">KS_IMSIZE_MIN256</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1745</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ae418ab3d6fe87794cd978b12d10ed699ae462c5cfa8631a66d48604d1c04a0af4"><div class="ttname"><a href="_k_s_foundation_8h.html#ae418ab3d6fe87794cd978b12d10ed699ae462c5cfa8631a66d48604d1c04a0af4">KS_IMSIZE_NATIVE</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1745</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9bc8f5648b2e1f445829e3fd9aa40723"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9bc8f5648b2e1f445829e3fd9aa40723">&#9670;&nbsp;</a></span>ks_enum_datadestination</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="_k_s_foundation_8h.html#a9bc8f5648b2e1f445829e3fd9aa40723">ks_enum_datadestination</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a9bc8f5648b2e1f445829e3fd9aa40723a3fe5c598e210f2c3e54ae034d0a09f5c"></a>KS_DONT_SEND&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a9bc8f5648b2e1f445829e3fd9aa40723a3617a36eb1321eb833a9352f12b498a6"></a>KS_SENDTOBAM&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a9bc8f5648b2e1f445829e3fd9aa40723aaec2dc7b1ce397d8413c922b551596d7"></a>KS_SENDTORTP&#160;</td><td class="fielddoc"></td></tr>
</table>
<div class="fragment"><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;{<a class="code" href="_k_s_foundation_8h.html#a9bc8f5648b2e1f445829e3fd9aa40723a3fe5c598e210f2c3e54ae034d0a09f5c">KS_DONT_SEND</a> = -1, <a class="code" href="_k_s_foundation_8h.html#a9bc8f5648b2e1f445829e3fd9aa40723a3617a36eb1321eb833a9352f12b498a6">KS_SENDTOBAM</a> = 0, <a class="code" href="_k_s_foundation_8h.html#a9bc8f5648b2e1f445829e3fd9aa40723aaec2dc7b1ce397d8413c922b551596d7">KS_SENDTORTP</a> = 1};</div><div class="ttc" id="_k_s_foundation_8h_html_a9bc8f5648b2e1f445829e3fd9aa40723aaec2dc7b1ce397d8413c922b551596d7"><div class="ttname"><a href="_k_s_foundation_8h.html#a9bc8f5648b2e1f445829e3fd9aa40723aaec2dc7b1ce397d8413c922b551596d7">KS_SENDTORTP</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1746</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a9bc8f5648b2e1f445829e3fd9aa40723a3617a36eb1321eb833a9352f12b498a6"><div class="ttname"><a href="_k_s_foundation_8h.html#a9bc8f5648b2e1f445829e3fd9aa40723a3617a36eb1321eb833a9352f12b498a6">KS_SENDTOBAM</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1746</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a9bc8f5648b2e1f445829e3fd9aa40723a3fe5c598e210f2c3e54ae034d0a09f5c"><div class="ttname"><a href="_k_s_foundation_8h.html#a9bc8f5648b2e1f445829e3fd9aa40723a3fe5c598e210f2c3e54ae034d0a09f5c">KS_DONT_SEND</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1746</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ada6f4a9dd77c3d0d85845fbaceae04ef"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ada6f4a9dd77c3d0d85845fbaceae04ef">&#9670;&nbsp;</a></span>ks_enum_accelmenu</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="_k_s_foundation_8h.html#ada6f4a9dd77c3d0d85845fbaceae04ef">ks_enum_accelmenu</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="ada6f4a9dd77c3d0d85845fbaceae04efaf1ab60443a3f1764b91d306bec1112ae"></a>KS_ACCELMENU_FRACT&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="ada6f4a9dd77c3d0d85845fbaceae04efa384a6dbf705a5fdf85efd0fb9fe33317"></a>KS_ACCELMENU_INT&#160;</td><td class="fielddoc"></td></tr>
</table>
<div class="fragment"><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;{<a class="code" href="_k_s_foundation_8h.html#ada6f4a9dd77c3d0d85845fbaceae04efaf1ab60443a3f1764b91d306bec1112ae">KS_ACCELMENU_FRACT</a>, <a class="code" href="_k_s_foundation_8h.html#ada6f4a9dd77c3d0d85845fbaceae04efa384a6dbf705a5fdf85efd0fb9fe33317">KS_ACCELMENU_INT</a>};</div><div class="ttc" id="_k_s_foundation_8h_html_ada6f4a9dd77c3d0d85845fbaceae04efa384a6dbf705a5fdf85efd0fb9fe33317"><div class="ttname"><a href="_k_s_foundation_8h.html#ada6f4a9dd77c3d0d85845fbaceae04efa384a6dbf705a5fdf85efd0fb9fe33317">KS_ACCELMENU_INT</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1747</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ada6f4a9dd77c3d0d85845fbaceae04efaf1ab60443a3f1764b91d306bec1112ae"><div class="ttname"><a href="_k_s_foundation_8h.html#ada6f4a9dd77c3d0d85845fbaceae04efaf1ab60443a3f1764b91d306bec1112ae">KS_ACCELMENU_FRACT</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1747</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa324c3517656b8ec032523397a142bed"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa324c3517656b8ec032523397a142bed">&#9670;&nbsp;</a></span>ks_enum_rfrole</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bed">ks_enum_rfrole</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="aa324c3517656b8ec032523397a142bedace0db3ff9bb8cad071dc42579e9aadaf"></a>KS_RF_ROLE_NOTSET&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="aa324c3517656b8ec032523397a142bedacc16dd3ca09dedaf6334a39ee4e46241"></a>KS_RF_ROLE_EXC&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="aa324c3517656b8ec032523397a142beda8f1b938816b04ffdeb45de47204252fd"></a>KS_RF_ROLE_REF&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="aa324c3517656b8ec032523397a142bedaff51a67bd02398ae045fb3ebafa40abb"></a>KS_RF_ROLE_CHEMSAT&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="aa324c3517656b8ec032523397a142beda2e9a4ba49720b15631440951968c2865"></a>KS_RF_ROLE_SPSAT&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="aa324c3517656b8ec032523397a142bedac6b698b041a6da12fb9194c4947ec6e8"></a>KS_RF_ROLE_INV&#160;</td><td class="fielddoc"></td></tr>
</table>
<div class="fragment"><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;{<a class="code" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedace0db3ff9bb8cad071dc42579e9aadaf">KS_RF_ROLE_NOTSET</a>, <a class="code" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedacc16dd3ca09dedaf6334a39ee4e46241">KS_RF_ROLE_EXC</a>, <a class="code" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142beda8f1b938816b04ffdeb45de47204252fd">KS_RF_ROLE_REF</a>, <a class="code" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedaff51a67bd02398ae045fb3ebafa40abb">KS_RF_ROLE_CHEMSAT</a>, <a class="code" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142beda2e9a4ba49720b15631440951968c2865">KS_RF_ROLE_SPSAT</a>, <a class="code" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedac6b698b041a6da12fb9194c4947ec6e8">KS_RF_ROLE_INV</a>};</div><div class="ttc" id="_k_s_foundation_8h_html_aa324c3517656b8ec032523397a142beda8f1b938816b04ffdeb45de47204252fd"><div class="ttname"><a href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142beda8f1b938816b04ffdeb45de47204252fd">KS_RF_ROLE_REF</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1750</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aa324c3517656b8ec032523397a142bedac6b698b041a6da12fb9194c4947ec6e8"><div class="ttname"><a href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedac6b698b041a6da12fb9194c4947ec6e8">KS_RF_ROLE_INV</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1750</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aa324c3517656b8ec032523397a142bedacc16dd3ca09dedaf6334a39ee4e46241"><div class="ttname"><a href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedacc16dd3ca09dedaf6334a39ee4e46241">KS_RF_ROLE_EXC</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1750</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aa324c3517656b8ec032523397a142bedace0db3ff9bb8cad071dc42579e9aadaf"><div class="ttname"><a href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedace0db3ff9bb8cad071dc42579e9aadaf">KS_RF_ROLE_NOTSET</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1750</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aa324c3517656b8ec032523397a142bedaff51a67bd02398ae045fb3ebafa40abb"><div class="ttname"><a href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedaff51a67bd02398ae045fb3ebafa40abb">KS_RF_ROLE_CHEMSAT</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1750</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aa324c3517656b8ec032523397a142beda2e9a4ba49720b15631440951968c2865"><div class="ttname"><a href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142beda2e9a4ba49720b15631440951968c2865">KS_RF_ROLE_SPSAT</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1750</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a86ae493647e9688c942bc9e0bb396313"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a86ae493647e9688c942bc9e0bb396313">&#9670;&nbsp;</a></span>ks_enum_sincwin</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="_k_s_foundation_8h.html#a86ae493647e9688c942bc9e0bb396313">ks_enum_sincwin</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a86ae493647e9688c942bc9e0bb396313a3152aefa9a54b3b3fa102a2674ff64eb"></a>KS_RF_SINCWIN_OFF&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a86ae493647e9688c942bc9e0bb396313a3bc8b5d8517c5b1a3b852ee492ae293a"></a>KS_RF_SINCWIN_HAMMING&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a86ae493647e9688c942bc9e0bb396313a594d1a1254b32274c42975552d65184a"></a>KS_RF_SINCWIN_HANNING&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a86ae493647e9688c942bc9e0bb396313a2ba60a518ac45656a0a55b26fe053836"></a>KS_RF_SINCWIN_BLACKMAN&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a86ae493647e9688c942bc9e0bb396313a09905442fe84127c23f592ca3af03dd2"></a>KS_RF_SINCWIN_BARTLETT&#160;</td><td class="fielddoc"></td></tr>
</table>
<div class="fragment"><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;{<a class="code" href="_k_s_foundation_8h.html#a86ae493647e9688c942bc9e0bb396313a3152aefa9a54b3b3fa102a2674ff64eb">KS_RF_SINCWIN_OFF</a>, <a class="code" href="_k_s_foundation_8h.html#a86ae493647e9688c942bc9e0bb396313a3bc8b5d8517c5b1a3b852ee492ae293a">KS_RF_SINCWIN_HAMMING</a>, <a class="code" href="_k_s_foundation_8h.html#a86ae493647e9688c942bc9e0bb396313a594d1a1254b32274c42975552d65184a">KS_RF_SINCWIN_HANNING</a>, <a class="code" href="_k_s_foundation_8h.html#a86ae493647e9688c942bc9e0bb396313a2ba60a518ac45656a0a55b26fe053836">KS_RF_SINCWIN_BLACKMAN</a>, <a class="code" href="_k_s_foundation_8h.html#a86ae493647e9688c942bc9e0bb396313a09905442fe84127c23f592ca3af03dd2">KS_RF_SINCWIN_BARTLETT</a>};</div><div class="ttc" id="_k_s_foundation_8h_html_a86ae493647e9688c942bc9e0bb396313a3bc8b5d8517c5b1a3b852ee492ae293a"><div class="ttname"><a href="_k_s_foundation_8h.html#a86ae493647e9688c942bc9e0bb396313a3bc8b5d8517c5b1a3b852ee492ae293a">KS_RF_SINCWIN_HAMMING</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1751</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a86ae493647e9688c942bc9e0bb396313a3152aefa9a54b3b3fa102a2674ff64eb"><div class="ttname"><a href="_k_s_foundation_8h.html#a86ae493647e9688c942bc9e0bb396313a3152aefa9a54b3b3fa102a2674ff64eb">KS_RF_SINCWIN_OFF</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1751</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a86ae493647e9688c942bc9e0bb396313a09905442fe84127c23f592ca3af03dd2"><div class="ttname"><a href="_k_s_foundation_8h.html#a86ae493647e9688c942bc9e0bb396313a09905442fe84127c23f592ca3af03dd2">KS_RF_SINCWIN_BARTLETT</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1751</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a86ae493647e9688c942bc9e0bb396313a2ba60a518ac45656a0a55b26fe053836"><div class="ttname"><a href="_k_s_foundation_8h.html#a86ae493647e9688c942bc9e0bb396313a2ba60a518ac45656a0a55b26fe053836">KS_RF_SINCWIN_BLACKMAN</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1751</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a86ae493647e9688c942bc9e0bb396313a594d1a1254b32274c42975552d65184a"><div class="ttname"><a href="_k_s_foundation_8h.html#a86ae493647e9688c942bc9e0bb396313a594d1a1254b32274c42975552d65184a">KS_RF_SINCWIN_HANNING</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1751</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac91cb32048e29f6e58bbf2c1acb8fdf1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac91cb32048e29f6e58bbf2c1acb8fdf1">&#9670;&nbsp;</a></span>ks_enum_wavebuf</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1">ks_enum_wavebuf</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32"></a>KS_WF_MAIN&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="ac91cb32048e29f6e58bbf2c1acb8fdf1acc45ff8f1dbeb7cef0129dd595e4031b"></a>KS_WF_BUF1&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="ac91cb32048e29f6e58bbf2c1acb8fdf1a976ecf9c65bb6a43d7cb791d681f0adc"></a>KS_WF_BUF2&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="ac91cb32048e29f6e58bbf2c1acb8fdf1a6e84527e5ca18e299429a1d00297b47f"></a>KS_WF_SIZE&#160;</td><td class="fielddoc"></td></tr>
</table>
<div class="fragment"><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;{<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a>, <a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1acc45ff8f1dbeb7cef0129dd595e4031b">KS_WF_BUF1</a>, <a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1a976ecf9c65bb6a43d7cb791d681f0adc">KS_WF_BUF2</a>, <a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1a6e84527e5ca18e299429a1d00297b47f">KS_WF_SIZE</a>};</div><div class="ttc" id="_k_s_foundation_8h_html_ac91cb32048e29f6e58bbf2c1acb8fdf1acc45ff8f1dbeb7cef0129dd595e4031b"><div class="ttname"><a href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1acc45ff8f1dbeb7cef0129dd595e4031b">KS_WF_BUF1</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1754</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32"><div class="ttname"><a href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1754</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ac91cb32048e29f6e58bbf2c1acb8fdf1a6e84527e5ca18e299429a1d00297b47f"><div class="ttname"><a href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1a6e84527e5ca18e299429a1d00297b47f">KS_WF_SIZE</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1754</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ac91cb32048e29f6e58bbf2c1acb8fdf1a976ecf9c65bb6a43d7cb791d681f0adc"><div class="ttname"><a href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1a976ecf9c65bb6a43d7cb791d681f0adc">KS_WF_BUF2</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1754</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af968d7d6e4fa1359fba5550fc39ae172"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af968d7d6e4fa1359fba5550fc39ae172">&#9670;&nbsp;</a></span>ks_enum_smstype</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="_k_s_foundation_8h.html#af968d7d6e4fa1359fba5550fc39ae172">ks_enum_smstype</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="af968d7d6e4fa1359fba5550fc39ae172ae28e1f22fff3b271570f3b9ec916bf58"></a>KS_SELRF_SMS_MB&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="af968d7d6e4fa1359fba5550fc39ae172aad24beb62524f381a37c7edad4cde495"></a>KS_SELRF_SMS_PINS&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="af968d7d6e4fa1359fba5550fc39ae172a27d5a473a532b02775bf36bd99857980"></a>KS_SELRF_SMS_PINS_DANTE&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="af968d7d6e4fa1359fba5550fc39ae172a6456ba09b2ddd9973c583d71ec96d1f7"></a>KS_SELRF_SMS_MULTI_PINS&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="af968d7d6e4fa1359fba5550fc39ae172ab340e6fbe544562ee4b5cf8075ca20a2"></a>KS_SELRF_SMSTYPE_SIZE&#160;</td><td class="fielddoc"></td></tr>
</table>
<div class="fragment"><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;                     {</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#af968d7d6e4fa1359fba5550fc39ae172ae28e1f22fff3b271570f3b9ec916bf58">KS_SELRF_SMS_MB</a>,</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#af968d7d6e4fa1359fba5550fc39ae172aad24beb62524f381a37c7edad4cde495">KS_SELRF_SMS_PINS</a>,</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#af968d7d6e4fa1359fba5550fc39ae172a27d5a473a532b02775bf36bd99857980">KS_SELRF_SMS_PINS_DANTE</a>,</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#af968d7d6e4fa1359fba5550fc39ae172a6456ba09b2ddd9973c583d71ec96d1f7">KS_SELRF_SMS_MULTI_PINS</a>,</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#af968d7d6e4fa1359fba5550fc39ae172ab340e6fbe544562ee4b5cf8075ca20a2">KS_SELRF_SMSTYPE_SIZE</a>};</div><div class="ttc" id="_k_s_foundation_8h_html_af968d7d6e4fa1359fba5550fc39ae172a27d5a473a532b02775bf36bd99857980"><div class="ttname"><a href="_k_s_foundation_8h.html#af968d7d6e4fa1359fba5550fc39ae172a27d5a473a532b02775bf36bd99857980">KS_SELRF_SMS_PINS_DANTE</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1760</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_af968d7d6e4fa1359fba5550fc39ae172ab340e6fbe544562ee4b5cf8075ca20a2"><div class="ttname"><a href="_k_s_foundation_8h.html#af968d7d6e4fa1359fba5550fc39ae172ab340e6fbe544562ee4b5cf8075ca20a2">KS_SELRF_SMSTYPE_SIZE</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1762</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_af968d7d6e4fa1359fba5550fc39ae172a6456ba09b2ddd9973c583d71ec96d1f7"><div class="ttname"><a href="_k_s_foundation_8h.html#af968d7d6e4fa1359fba5550fc39ae172a6456ba09b2ddd9973c583d71ec96d1f7">KS_SELRF_SMS_MULTI_PINS</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1761</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_af968d7d6e4fa1359fba5550fc39ae172ae28e1f22fff3b271570f3b9ec916bf58"><div class="ttname"><a href="_k_s_foundation_8h.html#af968d7d6e4fa1359fba5550fc39ae172ae28e1f22fff3b271570f3b9ec916bf58">KS_SELRF_SMS_MB</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1758</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_af968d7d6e4fa1359fba5550fc39ae172aad24beb62524f381a37c7edad4cde495"><div class="ttname"><a href="_k_s_foundation_8h.html#af968d7d6e4fa1359fba5550fc39ae172aad24beb62524f381a37c7edad4cde495">KS_SELRF_SMS_PINS</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1759</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="afbfc330f4f27194b4e27753383464227"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afbfc330f4f27194b4e27753383464227">&#9670;&nbsp;</a></span>ks_enum_sms_phase_mod</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="_k_s_foundation_8h.html#afbfc330f4f27194b4e27753383464227">ks_enum_sms_phase_mod</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="afbfc330f4f27194b4e27753383464227ae3bd201ec523ddd720faf6625365aae7"></a>KS_SELRF_SMS_PHAS_MOD_OFF&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="afbfc330f4f27194b4e27753383464227a1918b5929560ca3eaa2f054f855d5659"></a>KS_SELRF_SMS_PHAS_MOD_PHAS&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="afbfc330f4f27194b4e27753383464227a385b4332bc937b39f58986df5422adba"></a>KS_SELRF_SMS_PHAS_MOD_AMPL&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="afbfc330f4f27194b4e27753383464227a4053b2f4fe4f8d2d7031cdb0041966fc"></a>KS_SELRF_SMS_PHAS_MOD_QUAD&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="afbfc330f4f27194b4e27753383464227a33b64b0c37b4cb048ce208a9c1cf2598"></a>KS_SELRF_SMS_PHAS_MOD_SIZE&#160;</td><td class="fielddoc"></td></tr>
</table>
<div class="fragment"><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;                           {</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#afbfc330f4f27194b4e27753383464227ae3bd201ec523ddd720faf6625365aae7">KS_SELRF_SMS_PHAS_MOD_OFF</a>,</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#afbfc330f4f27194b4e27753383464227a1918b5929560ca3eaa2f054f855d5659">KS_SELRF_SMS_PHAS_MOD_PHAS</a>,</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#afbfc330f4f27194b4e27753383464227a385b4332bc937b39f58986df5422adba">KS_SELRF_SMS_PHAS_MOD_AMPL</a>,</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#afbfc330f4f27194b4e27753383464227a4053b2f4fe4f8d2d7031cdb0041966fc">KS_SELRF_SMS_PHAS_MOD_QUAD</a>,</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#afbfc330f4f27194b4e27753383464227a33b64b0c37b4cb048ce208a9c1cf2598">KS_SELRF_SMS_PHAS_MOD_SIZE</a>};</div><div class="ttc" id="_k_s_foundation_8h_html_afbfc330f4f27194b4e27753383464227a1918b5929560ca3eaa2f054f855d5659"><div class="ttname"><a href="_k_s_foundation_8h.html#afbfc330f4f27194b4e27753383464227a1918b5929560ca3eaa2f054f855d5659">KS_SELRF_SMS_PHAS_MOD_PHAS</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1766</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_afbfc330f4f27194b4e27753383464227a33b64b0c37b4cb048ce208a9c1cf2598"><div class="ttname"><a href="_k_s_foundation_8h.html#afbfc330f4f27194b4e27753383464227a33b64b0c37b4cb048ce208a9c1cf2598">KS_SELRF_SMS_PHAS_MOD_SIZE</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1769</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_afbfc330f4f27194b4e27753383464227a385b4332bc937b39f58986df5422adba"><div class="ttname"><a href="_k_s_foundation_8h.html#afbfc330f4f27194b4e27753383464227a385b4332bc937b39f58986df5422adba">KS_SELRF_SMS_PHAS_MOD_AMPL</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1767</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_afbfc330f4f27194b4e27753383464227ae3bd201ec523ddd720faf6625365aae7"><div class="ttname"><a href="_k_s_foundation_8h.html#afbfc330f4f27194b4e27753383464227ae3bd201ec523ddd720faf6625365aae7">KS_SELRF_SMS_PHAS_MOD_OFF</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1765</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_afbfc330f4f27194b4e27753383464227a4053b2f4fe4f8d2d7031cdb0041966fc"><div class="ttname"><a href="_k_s_foundation_8h.html#afbfc330f4f27194b4e27753383464227a4053b2f4fe4f8d2d7031cdb0041966fc">KS_SELRF_SMS_PHAS_MOD_QUAD</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1768</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a99fb83031ce9923c84392b4e92f956b5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a99fb83031ce9923c84392b4e92f956b5">&#9670;&nbsp;</a></span>anonymous enum</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">anonymous enum</td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a99fb83031ce9923c84392b4e92f956b5a634591f5e0e6042c3ed95c0ae543b402"></a>KS_SEQ_COLLECTION_ALLOWNEW&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a99fb83031ce9923c84392b4e92f956b5af64c78cedb5f88bb17738bcf993a7755"></a>KS_SEQ_COLLECTION_LOCKED&#160;</td><td class="fielddoc"></td></tr>
</table>
<div class="fragment"><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;{<a class="code" href="_k_s_foundation_8h.html#a99fb83031ce9923c84392b4e92f956b5a634591f5e0e6042c3ed95c0ae543b402">KS_SEQ_COLLECTION_ALLOWNEW</a>, <a class="code" href="_k_s_foundation_8h.html#a99fb83031ce9923c84392b4e92f956b5af64c78cedb5f88bb17738bcf993a7755">KS_SEQ_COLLECTION_LOCKED</a>};</div><div class="ttc" id="_k_s_foundation_8h_html_a99fb83031ce9923c84392b4e92f956b5a634591f5e0e6042c3ed95c0ae543b402"><div class="ttname"><a href="_k_s_foundation_8h.html#a99fb83031ce9923c84392b4e92f956b5a634591f5e0e6042c3ed95c0ae543b402">KS_SEQ_COLLECTION_ALLOWNEW</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1771</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a99fb83031ce9923c84392b4e92f956b5af64c78cedb5f88bb17738bcf993a7755"><div class="ttname"><a href="_k_s_foundation_8h.html#a99fb83031ce9923c84392b4e92f956b5af64c78cedb5f88bb17738bcf993a7755">KS_SEQ_COLLECTION_LOCKED</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1771</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="adfc20623c6ef26b08b99174a1a77323c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adfc20623c6ef26b08b99174a1a77323c">&#9670;&nbsp;</a></span>ks_enum_grad_scaling_policy</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="_k_s_foundation_8h.html#adfc20623c6ef26b08b99174a1a77323c">ks_enum_grad_scaling_policy</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="adfc20623c6ef26b08b99174a1a77323ca18c0e84d66e6f381b509ea483f7cc7fd"></a>KS_GRADWAVE_ABSOLUTE&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="adfc20623c6ef26b08b99174a1a77323caafce08e3915c706e0851da5f4977192c"></a>KS_GRADWAVE_RELATIVE&#160;</td><td class="fielddoc"></td></tr>
</table>
<div class="fragment"><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;{<a class="code" href="_k_s_foundation_8h.html#adfc20623c6ef26b08b99174a1a77323ca18c0e84d66e6f381b509ea483f7cc7fd">KS_GRADWAVE_ABSOLUTE</a>, <a class="code" href="_k_s_foundation_8h.html#adfc20623c6ef26b08b99174a1a77323caafce08e3915c706e0851da5f4977192c">KS_GRADWAVE_RELATIVE</a>};</div><div class="ttc" id="_k_s_foundation_8h_html_adfc20623c6ef26b08b99174a1a77323ca18c0e84d66e6f381b509ea483f7cc7fd"><div class="ttname"><a href="_k_s_foundation_8h.html#adfc20623c6ef26b08b99174a1a77323ca18c0e84d66e6f381b509ea483f7cc7fd">KS_GRADWAVE_ABSOLUTE</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1772</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_adfc20623c6ef26b08b99174a1a77323caafce08e3915c706e0851da5f4977192c"><div class="ttname"><a href="_k_s_foundation_8h.html#adfc20623c6ef26b08b99174a1a77323caafce08e3915c706e0851da5f4977192c">KS_GRADWAVE_RELATIVE</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1772</div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a3f102bd49ae8d18baede6827db227e41"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3f102bd49ae8d18baede6827db227e41">&#9670;&nbsp;</a></span>ks_init_read()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_init_read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_e_a_d.html">KS_READ</a> *&#160;</td>
          <td class="paramname"><em>read</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Resets a <a class="el" href="struct_k_s___r_e_a_d.html" title="Core sequence object that handles a data acquisition window">KS_READ</a> sequence object to its default value (KS_INIT_READ)</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">read</td><td>Pointer to <a class="el" href="struct_k_s___r_e_a_d.html" title="Core sequence object that handles a data acquisition window">KS_READ</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;                                 {</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  <a class="code" href="struct_k_s___r_e_a_d.html">KS_READ</a> defacq = <a class="code" href="_k_s_foundation_8h.html#a2670dc2db110e2ab1ef9551b987d0bb6">KS_INIT_READ</a>;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  *read = defacq;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;}</div><div class="ttc" id="struct_k_s___r_e_a_d_html"><div class="ttname"><a href="struct_k_s___r_e_a_d.html">KS_READ</a></div><div class="ttdoc">Core sequence object that handles a data acquisition window</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:580</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a2670dc2db110e2ab1ef9551b987d0bb6"><div class="ttname"><a href="_k_s_foundation_8h.html#a2670dc2db110e2ab1ef9551b987d0bb6">KS_INIT_READ</a></div><div class="ttdeci">#define KS_INIT_READ</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:133</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8efdbce2fbb4bf21a6fd8983fdd6d5c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8efdbce2fbb4bf21a6fd8983fdd6d5c7">&#9670;&nbsp;</a></span>ks_init_trap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_init_trap </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> *&#160;</td>
          <td class="paramname"><em>trap</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Resets a <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> sequence object to its default value (KS_INIT_TRAP)</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">trap</td><td>Pointer to <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;                                 {</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  <a class="code" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> deftrap = <a class="code" href="_k_s_foundation_8h.html#a1ba17433713316fa65385237ebb0fb67">KS_INIT_TRAP</a>;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  *trap = deftrap;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;}</div><div class="ttc" id="struct_k_s___t_r_a_p_html"><div class="ttname"><a href="struct_k_s___t_r_a_p.html">KS_TRAP</a></div><div class="ttdoc">Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:430</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a1ba17433713316fa65385237ebb0fb67"><div class="ttname"><a href="_k_s_foundation_8h.html#a1ba17433713316fa65385237ebb0fb67">KS_INIT_TRAP</a></div><div class="ttdeci">#define KS_INIT_TRAP</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:132</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad0d05a33cfe5de925f28709883a37abc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad0d05a33cfe5de925f28709883a37abc">&#9670;&nbsp;</a></span>ks_init_wait()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_init_wait </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___w_a_i_t.html">KS_WAIT</a> *&#160;</td>
          <td class="paramname"><em>wait</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Resets a <a class="el" href="struct_k_s___w_a_i_t.html" title="Core sequence object that adds wait periods in the pulse sequence (see ks_eval_wait(), ks_pg_wait()). Can be placed on any sequence board">KS_WAIT</a> sequence object to its default value (KS_INIT_WAIT)</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">wait</td><td>Pointer to <a class="el" href="struct_k_s___w_a_i_t.html" title="Core sequence object that adds wait periods in the pulse sequence (see ks_eval_wait(), ks_pg_wait()). Can be placed on any sequence board">KS_WAIT</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;                                 {</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <a class="code" href="struct_k_s___w_a_i_t.html">KS_WAIT</a> defwait = <a class="code" href="_k_s_foundation_8h.html#aed050d8d7344db4d7ae33ba974855b8a">KS_INIT_WAIT</a>;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  *wait = defwait;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;}</div><div class="ttc" id="struct_k_s___w_a_i_t_html"><div class="ttname"><a href="struct_k_s___w_a_i_t.html">KS_WAIT</a></div><div class="ttdoc">Core sequence object that adds wait periods in the pulse sequence (see ks_eval_wait(), ks_pg_wait()). Can be placed on any sequence board</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:308</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aed050d8d7344db4d7ae33ba974855b8a"><div class="ttname"><a href="_k_s_foundation_8h.html#aed050d8d7344db4d7ae33ba974855b8a">KS_INIT_WAIT</a></div><div class="ttdeci">#define KS_INIT_WAIT</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:130</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa2b37fa5aa0bffff1de8ca29e7c19cc1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa2b37fa5aa0bffff1de8ca29e7c19cc1">&#9670;&nbsp;</a></span>ks_init_wave()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_init_wave </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Resets a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> sequence object to its default value (KS_INIT_WAVE)</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">wave</td><td>Pointer to <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;                                 {</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <a class="code" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> defwave = <a class="code" href="_k_s_foundation_8h.html#ae837f68085b812e9e22a659cc26a42cc">KS_INIT_WAVE</a>;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  *wave = defwave;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;}</div><div class="ttc" id="struct_k_s___w_a_v_e_html"><div class="ttname"><a href="struct_k_s___w_a_v_e.html">KS_WAVE</a></div><div class="ttdoc">Core sequence object making arbitrary waveforms on any board (using float data format)</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:514</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ae837f68085b812e9e22a659cc26a42cc"><div class="ttname"><a href="_k_s_foundation_8h.html#ae837f68085b812e9e22a659cc26a42cc">KS_INIT_WAVE</a></div><div class="ttdeci">#define KS_INIT_WAVE</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:145</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a708ba4291820da3460f6b2c7be287f06"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a708ba4291820da3460f6b2c7be287f06">&#9670;&nbsp;</a></span>ks_init_rf()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_init_rf </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_f.html">KS_RF</a> *&#160;</td>
          <td class="paramname"><em>rf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Resets a <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> sequence object to its default value (KS_INIT_RF)</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">rf</td><td>Pointer to <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;                           {</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <a class="code" href="struct_k_s___r_f.html">KS_RF</a> defrf = <a class="code" href="_k_s_foundation_8h.html#afc1615558f21efc6020df64ade026467">KS_INIT_RF</a>;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  *rf = defrf;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_afc1615558f21efc6020df64ade026467"><div class="ttname"><a href="_k_s_foundation_8h.html#afc1615558f21efc6020df64ade026467">KS_INIT_RF</a></div><div class="ttdeci">#define KS_INIT_RF</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:156</div></div>
<div class="ttc" id="struct_k_s___r_f_html"><div class="ttname"><a href="struct_k_s___r_f.html">KS_RF</a></div><div class="ttdoc">Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:787</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a784f028a220f82adb610919a51c09abb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a784f028a220f82adb610919a51c09abb">&#9670;&nbsp;</a></span>ks_init_sms_info()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_init_sms_info </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_m_s___i_n_f_o.html">KS_SMS_INFO</a> *&#160;</td>
          <td class="paramname"><em>sms_info</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Resets a <a class="el" href="struct_k_s___s_m_s___i_n_f_o.html" title="Internal typedef struct that is a part of the KS_SELRF typedef struct, used to store information abou...">KS_SMS_INFO</a> sequence object to its default value (KS_INIT_SMS_INFO)</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">sms_info</td><td>Pointer to <a class="el" href="struct_k_s___s_m_s___i_n_f_o.html" title="Internal typedef struct that is a part of the KS_SELRF typedef struct, used to store information abou...">KS_SMS_INFO</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;                                             {</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <a class="code" href="struct_k_s___s_m_s___i_n_f_o.html">KS_SMS_INFO</a> defsms_info = <a class="code" href="_k_s_foundation_8h.html#aad777b22fb342c595fed2578676d9c05">KS_INIT_SMS_INFO</a>;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  *sms_info = defsms_info;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;}</div><div class="ttc" id="struct_k_s___s_m_s___i_n_f_o_html"><div class="ttname"><a href="struct_k_s___s_m_s___i_n_f_o.html">KS_SMS_INFO</a></div><div class="ttdoc">Internal typedef struct that is a part of the KS_SELRF typedef struct, used to store information abou...</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1216</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aad777b22fb342c595fed2578676d9c05"><div class="ttname"><a href="_k_s_foundation_8h.html#aad777b22fb342c595fed2578676d9c05">KS_INIT_SMS_INFO</a></div><div class="ttdeci">#define KS_INIT_SMS_INFO</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:167</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3cb1d6e472e9061b0f4768d8985a442e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3cb1d6e472e9061b0f4768d8985a442e">&#9670;&nbsp;</a></span>ks_init_selrf()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_init_selrf </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *&#160;</td>
          <td class="paramname"><em>selrf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Resets a <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> sequence object to its default value (KS_INIT_SELRF)</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">selrf</td><td>Pointer to <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;                                    {</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  <a class="code" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> defselrf = <a class="code" href="_k_s_foundation_8h.html#a8d8030715d634067abc0732b5507ce14">KS_INIT_SELRF</a>;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  *selrf = defselrf;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;}</div><div class="ttc" id="struct_k_s___s_e_l_r_f_html"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a></div><div class="ttdoc">Composite sequence object for slice-selective RF</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1333</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a8d8030715d634067abc0732b5507ce14"><div class="ttname"><a href="_k_s_foundation_8h.html#a8d8030715d634067abc0732b5507ce14">KS_INIT_SELRF</a></div><div class="ttdeci">#define KS_INIT_SELRF</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:157</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac0b31ea2b6ff49aa791e7a6cb72c645b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac0b31ea2b6ff49aa791e7a6cb72c645b">&#9670;&nbsp;</a></span>ks_init_readtrap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_init_readtrap </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a> *&#160;</td>
          <td class="paramname"><em>readtrap</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Resets a <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> sequence object to its default value (KS_INIT_READTRAP)</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">readtrap</td><td>Pointer to <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;                                             {</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a> defread = <a class="code" href="_k_s_foundation_8h.html#a01108d382b19492c2178b6bedbfcbc4b">KS_INIT_READTRAP</a>;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  *readtrap = defread;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_a01108d382b19492c2178b6bedbfcbc4b"><div class="ttname"><a href="_k_s_foundation_8h.html#a01108d382b19492c2178b6bedbfcbc4b">KS_INIT_READTRAP</a></div><div class="ttdeci">#define KS_INIT_READTRAP</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:135</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a></div><div class="ttdoc">Composite sequence object for data readout using a trapezoid gradient</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1422</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a38e859809526b8d07b17999dc6bbdbe9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a38e859809526b8d07b17999dc6bbdbe9">&#9670;&nbsp;</a></span>ks_init_phaser()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_init_phaser </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *&#160;</td>
          <td class="paramname"><em>phaser</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Resets a <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> sequence object to its default value (KS_INIT_PHASER)</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">phaser</td><td>Pointer to <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;                                       {</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <a class="code" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> defphaser = <a class="code" href="_k_s_foundation_8h.html#a5e620158a577fbdc94013a3f761a5a22">KS_INIT_PHASER</a>;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  *phaser = defphaser;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_a5e620158a577fbdc94013a3f761a5a22"><div class="ttname"><a href="_k_s_foundation_8h.html#a5e620158a577fbdc94013a3f761a5a22">KS_INIT_PHASER</a></div><div class="ttdeci">#define KS_INIT_PHASER</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:138</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a></div><div class="ttdoc">Composite sequence object for phase encoding using a trapezoid gradient</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1524</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad06a3c6b22c54585d66b17eae440e6f7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad06a3c6b22c54585d66b17eae440e6f7">&#9670;&nbsp;</a></span>ks_init_epi()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_init_epi </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *&#160;</td>
          <td class="paramname"><em>epi</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Resets a <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> sequence object to its default value (KS_INIT_EPI)</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">epi</td><td>Pointer to <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;                              {</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  <a class="code" href="struct_k_s___e_p_i.html">KS_EPI</a> defepi = <a class="code" href="_k_s_foundation_8h.html#a3e677786bcadd601f03988f59cc20549">KS_INIT_EPI</a>;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  *epi = defepi;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_a3e677786bcadd601f03988f59cc20549"><div class="ttname"><a href="_k_s_foundation_8h.html#a3e677786bcadd601f03988f59cc20549">KS_INIT_EPI</a></div><div class="ttdeci">#define KS_INIT_EPI</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:141</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html"><div class="ttname"><a href="struct_k_s___e_p_i.html">KS_EPI</a></div><div class="ttdoc">Composite sequence object for EPI readout</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1684</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a12bc11f81cb70202d41d89e2bfe245dc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a12bc11f81cb70202d41d89e2bfe245dc">&#9670;&nbsp;</a></span>ks_init_dixon_dualreadtrap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_init_dixon_dualreadtrap </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___d_i_x_o_n___d_u_a_l_r_e_a_d_t_r_a_p.html">KS_DIXON_DUALREADTRAP</a> *&#160;</td>
          <td class="paramname"><em>dual_readtrap</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Resets a <a class="el" href="struct_k_s___d_i_x_o_n___d_u_a_l_r_e_a_d_t_r_a_p.html">KS_DIXON_DUALREADTRAP</a> sequence object to its default value (KS_INIT_DIXON_DUALREADTRAP)</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">dual_readtrap</td><td>Pointer to <a class="el" href="struct_k_s___d_i_x_o_n___d_u_a_l_r_e_a_d_t_r_a_p.html">KS_DIXON_DUALREADTRAP</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                                                                      {</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <a class="code" href="struct_k_s___d_i_x_o_n___d_u_a_l_r_e_a_d_t_r_a_p.html">KS_DIXON_DUALREADTRAP</a> def_dual_readtrap = <a class="code" href="_k_s_foundation_8h.html#a25dd0df16b0ebe005df84081dd4f051b">KS_INIT_DIXON_DUALREADTRAP</a>;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  *dual_readtrap = def_dual_readtrap;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_a25dd0df16b0ebe005df84081dd4f051b"><div class="ttname"><a href="_k_s_foundation_8h.html#a25dd0df16b0ebe005df84081dd4f051b">KS_INIT_DIXON_DUALREADTRAP</a></div><div class="ttdeci">#define KS_INIT_DIXON_DUALREADTRAP</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:148</div></div>
<div class="ttc" id="struct_k_s___d_i_x_o_n___d_u_a_l_r_e_a_d_t_r_a_p_html"><div class="ttname"><a href="struct_k_s___d_i_x_o_n___d_u_a_l_r_e_a_d_t_r_a_p.html">KS_DIXON_DUALREADTRAP</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1699</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a78c293e0ef0d90d5f8b000bca449a822"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a78c293e0ef0d90d5f8b000bca449a822">&#9670;&nbsp;</a></span>ks_init_gradrfctrl()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_init_gradrfctrl </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html">KS_GRADRFCTRL</a> *&#160;</td>
          <td class="paramname"><em>gradrfctrl</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Resets <a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html" title="typedef struct that is a part of the KS_SEQ_CONTROL typedef struct, used internally to collect gradie...">KS_GRADRFCTRL</a> to its default value (KS_INIT_GRADRFCTRL)</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">gradrfctrl</td><td>Pointer to <a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html" title="typedef struct that is a part of the KS_SEQ_CONTROL typedef struct, used internally to collect gradie...">KS_GRADRFCTRL</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                                                   {</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html">KS_GRADRFCTRL</a> defgradrf = <a class="code" href="_k_s_foundation_8h.html#ad4fa24a8bda2c4137b3ae52f7e479df6">KS_INIT_GRADRFCTRL</a>;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  *gradrfctrl = defgradrf;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;}</div><div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html">KS_GRADRFCTRL</a></div><div class="ttdoc">typedef struct that is a part of the KS_SEQ_CONTROL typedef struct, used internally to collect gradie...</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:814</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ad4fa24a8bda2c4137b3ae52f7e479df6"><div class="ttname"><a href="_k_s_foundation_8h.html#ad4fa24a8bda2c4137b3ae52f7e479df6">KS_INIT_GRADRFCTRL</a></div><div class="ttdeci">#define KS_INIT_GRADRFCTRL</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:160</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae789f20604371eec8036d0a63555d514"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae789f20604371eec8036d0a63555d514">&#9670;&nbsp;</a></span>ks_init_seqcontrol()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_init_seqcontrol </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>seqcontrol</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Resets <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> to its default value (KS_INIT_SEQ_CONTROL)</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">seqcontrol</td><td>Pointer to KS_INIT_SEQ_CONTROL </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;                                                    {</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> defseqcontrol = <a class="code" href="_k_s_foundation_8h.html#a232cf810c71aebfeadc56a82f472a1ad">KS_INIT_SEQ_CONTROL</a>;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  *seqcontrol = defseqcontrol;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_a232cf810c71aebfeadc56a82f472a1ad"><div class="ttname"><a href="_k_s_foundation_8h.html#a232cf810c71aebfeadc56a82f472a1ad">KS_INIT_SEQ_CONTROL</a></div><div class="ttdeci">#define KS_INIT_SEQ_CONTROL</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:162</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a></div><div class="ttdoc">A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:980</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a343ddedf4a968d5b4c8d4a17adf95125"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a343ddedf4a968d5b4c8d4a17adf95125">&#9670;&nbsp;</a></span>ks_init_seqcollection()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_init_seqcollection </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html">KS_SEQ_COLLECTION</a> *&#160;</td>
          <td class="paramname"><em>seqcollection</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Resets <a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html" title="Collection handle of all sequence modules involved in the pulse sequence, used for RF scaling...">KS_SEQ_COLLECTION</a> to its default value (KS_INIT_SEQ_COLLECTION)</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">seqcollection</td><td>Pointer to KS_INIT_SEQ_COLLECTION </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                                                             {</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  <a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html">KS_SEQ_COLLECTION</a> defseqcollection = <a class="code" href="_k_s_foundation_8h.html#a1e2fc6159630ad04bd9d5756cd8620b0">KS_INIT_SEQ_COLLECTION</a>;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  *<a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a> = defseqcollection;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;}</div><div class="ttc" id="ksepi_8e_html_ab5adb9efc118dc1cc8a0dc3c32cb73bf"><div class="ttname"><a href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a></div><div class="ttdeci">KS_SEQ_COLLECTION seqcollection</div><div class="ttdef"><b>Definition:</b> ksepi.e:79</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a1e2fc6159630ad04bd9d5756cd8620b0"><div class="ttname"><a href="_k_s_foundation_8h.html#a1e2fc6159630ad04bd9d5756cd8620b0">KS_INIT_SEQ_COLLECTION</a></div><div class="ttdeci">#define KS_INIT_SEQ_COLLECTION</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:164</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n_html"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html">KS_SEQ_COLLECTION</a></div><div class="ttdoc">Collection handle of all sequence modules involved in the pulse sequence, used for RF scaling...</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1148</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a71229f8ff8869fa6d2c44f34559876ae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a71229f8ff8869fa6d2c44f34559876ae">&#9670;&nbsp;</a></span>ks_init_slewratecontrol()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_init_slewratecontrol </td>
          <td>(</td>
          <td class="paramtype">LOG_GRAD *&#160;</td>
          <td class="paramname"><em>loggrd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PHYS_GRAD *&#160;</td>
          <td class="paramname"><em>phygrd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>srfact</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Changes existing (globally used) loggrd and phygrd structs (set up by <code>inittargets()</code> in e.g. <a class="el" href="_g_e_required_8e.html#aae6f05f5a408ae64a91705d67071e064" title="Initialize logical and physical gradient specifications">GEReq_init_gradspecs()</a>)</h4>
</p>
<p>If <code>srfact</code> &lt; 1.0, both <code>phygrd</code> and <code>loggrd</code> are updated, and the gradients will be switched propotionally slower. This can be used to make the acquistion quieter. If <code>srfact</code> &gt; 1.0, only <code>loggrd</code> will be updated. This could be used as an attempt to switch the gradients faster, but should be used with care as the risk for peripheral nerve stimulation (PNS) increases and the gradients may trip.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">loggrd</td><td>Pointer to LOG_GRAD </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">phygrd</td><td>Pointer to PHYS_GRAD </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">srfact</td><td>Slewrate factor (&lt; 1.0 means less acquistic noise and reduced risk for PNS) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                                                                                  {</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  <span class="keywordflow">if</span> (fabs(srfact) &lt; FLT_EPSILON) {</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: slewrate factor can not be zero&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  }</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <span class="keywordflow">if</span> (srfact &lt; 1.0 &amp;&amp; <a class="code" href="_k_s_foundation_8h.html#af51ba165cbaf874219789beaa48f2464">phygrd</a> != NULL) {</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#af51ba165cbaf874219789beaa48f2464">phygrd</a>-&gt;xrt = (int) ((<span class="keywordtype">float</span>) <a class="code" href="_k_s_foundation_8h.html#af51ba165cbaf874219789beaa48f2464">phygrd</a>-&gt;xrt / srfact);</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#af51ba165cbaf874219789beaa48f2464">phygrd</a>-&gt;yrt = (int) ((<span class="keywordtype">float</span>) <a class="code" href="_k_s_foundation_8h.html#af51ba165cbaf874219789beaa48f2464">phygrd</a>-&gt;yrt / srfact);</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#af51ba165cbaf874219789beaa48f2464">phygrd</a>-&gt;zrt = (int) ((<span class="keywordtype">float</span>) <a class="code" href="_k_s_foundation_8h.html#af51ba165cbaf874219789beaa48f2464">phygrd</a>-&gt;zrt / srfact);</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  }</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a> != NULL) {</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>-&gt;xrt = (int) ((<span class="keywordtype">float</span>) <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>-&gt;xrt / srfact);</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>-&gt;yrt = (int) ((<span class="keywordtype">float</span>) <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>-&gt;yrt / srfact);</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>-&gt;zrt = (int) ((<span class="keywordtype">float</span>) <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>-&gt;zrt / srfact);</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  }</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_af51ba165cbaf874219789beaa48f2464"><div class="ttname"><a href="_k_s_foundation_8h.html#af51ba165cbaf874219789beaa48f2464">phygrd</a></div><div class="ttdeci">PHYS_GRAD phygrd</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9c627057bb753177d7b74e5cd9ba1a46"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9c627057bb753177d7b74e5cd9ba1a46">&#9670;&nbsp;</a></span>ks_eval_addtoseqcollection()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_addtoseqcollection </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html">KS_SEQ_COLLECTION</a> *&#160;</td>
          <td class="paramname"><em>seqcollection</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>seqctrl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Adds a sequence module (<a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a>) to the <a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html" title="Collection handle of all sequence modules involved in the pulse sequence, used for RF scaling...">KS_SEQ_COLLECTION</a> struct for later RF scaling and SAR calculations</h4>
</p>
<p>The <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> object will be ignored if added previously or if its <code>.duration</code> field is zero. A zero duration of a <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> indicates that this sequence module should not be used with the current settings</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">seqcollection</td><td>Pointer to the <a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html" title="Collection handle of all sequence modules involved in the pulse sequence, used for RF scaling...">KS_SEQ_COLLECTION</a> for the sequence </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">seqctrl</td><td>Pointer to <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                                                                                             {</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a> == NULL) {</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: seqcollection is NULL&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  }</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="keywordflow">if</span> (seqctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> == 0) {</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="comment">/* Return early if seqctrl.duration = 0 so we are not adding sequence modules with zero duration to the collection.</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">       This is in concert with:</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">       - not performing createseq() in KS_SEQLENGTH if seqctrl.duration = 0</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment">       - not playing sequence modules in scan() using ks_scan_playsequence() if seqctrl.duration = 0</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">       It is the task of the PG function (e.g. &lt;seqmodule&gt;_pg()) of the current sequence module to set seqctrl.duration &gt; 0 based on the waveform content in that module</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">       and &lt;seqmodule&gt;_pg() should therefore be called before this function.</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment">       Preferred method is to add the following to the end of &lt;seqmodule&gt;_pg():</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">       #ifndef IPG</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">        // HOST only:</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">        ks_eval_seqctrl_setminduration(&amp;seqctrl, tmploc.pos); // tmploc.pos now corresponds to the end of last gradient in the sequence</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">       #endif</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  }</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a65c4aa433169274a52c448793e82e12e">numseq</a> &gt; <a class="code" href="_k_s_foundation_8h.html#a92ed0352c04ca279b44bf62d253b143a">KS_MAXUNIQUE_SEQUENCES</a>) {</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: Number of sequence modules has been exceeded (max: %d)&quot;</span>, __FUNCTION__, <a class="code" href="_k_s_foundation_8h.html#a92ed0352c04ca279b44bf62d253b143a">KS_MAXUNIQUE_SEQUENCES</a>);</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  }</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a1ea5d0cb93f22f7d0fdf804bd68c3326">mode</a> == <a class="code" href="_k_s_foundation_8h.html#a99fb83031ce9923c84392b4e92f956b5af64c78cedb5f88bb17738bcf993a7755">KS_SEQ_COLLECTION_LOCKED</a>) {</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s - (%s): seqcollection.mode = KS_SEQ_COLLECTION_LOCKED. Module must be added before GEReq_eval_TR(), GEReq_eval_rfscaling(), and GEReq_eval_checkTR_SAR()&quot;</span>, __FUNCTION__, seqctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  }</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;   <span class="comment">/* check for previous registrations of this sequence module.  If found, return */</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a65c4aa433169274a52c448793e82e12e">numseq</a> &gt; 0) {</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a65c4aa433169274a52c448793e82e12e">numseq</a>; i++) {</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">seqctrlptr</a>[i] == seqctrl)</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    }</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  }</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  <span class="comment">/* register the sequence module */</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">seqctrlptr</a>[<a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a65c4aa433169274a52c448793e82e12e">numseq</a>++] = seqctrl;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n_html_a1ea5d0cb93f22f7d0fdf804bd68c3326"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a1ea5d0cb93f22f7d0fdf804bd68c3326">KS_SEQ_COLLECTION::mode</a></div><div class="ttdeci">int mode</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1150</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_SEQ_CONTROL::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:984</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n_html_a8ab39b275ee333fc1e568a0994db98d1"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">KS_SEQ_COLLECTION::seqctrlptr</a></div><div class="ttdeci">KS_SEQ_CONTROL * seqctrlptr[KS_MAXUNIQUE_SEQUENCES]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1155</div></div>
<div class="ttc" id="ksepi_8e_html_ab5adb9efc118dc1cc8a0dc3c32cb73bf"><div class="ttname"><a href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a></div><div class="ttdeci">KS_SEQ_COLLECTION seqcollection</div><div class="ttdef"><b>Definition:</b> ksepi.e:79</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a92ed0352c04ca279b44bf62d253b143a"><div class="ttname"><a href="_k_s_foundation_8h.html#a92ed0352c04ca279b44bf62d253b143a">KS_MAXUNIQUE_SEQUENCES</a></div><div class="ttdeci">#define KS_MAXUNIQUE_SEQUENCES</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:117</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">KS_SEQ_CONTROL::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:990</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a99fb83031ce9923c84392b4e92f956b5af64c78cedb5f88bb17738bcf993a7755"><div class="ttname"><a href="_k_s_foundation_8h.html#a99fb83031ce9923c84392b4e92f956b5af64c78cedb5f88bb17738bcf993a7755">KS_SEQ_COLLECTION_LOCKED</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1771</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n_html_a65c4aa433169274a52c448793e82e12e"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a65c4aa433169274a52c448793e82e12e">KS_SEQ_COLLECTION::numseq</a></div><div class="ttdeci">int numseq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1149</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae97e87753919a932924b1f4dfcc5ef9c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae97e87753919a932924b1f4dfcc5ef9c">&#9670;&nbsp;</a></span>ks_eval_addtraptogradrfctrl()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_addtraptogradrfctrl </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html">KS_GRADRFCTRL</a> *&#160;</td>
          <td class="paramname"><em>gradrfctrl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> *&#160;</td>
          <td class="paramname"><em>trap</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>*Internal use*. Adds a trapezoid (<a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a>) to the <a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html" title="typedef struct that is a part of the KS_SEQ_CONTROL typedef struct, used internally to collect gradie...">KS_GRADRFCTRL</a> struct for later gradient heating calculations in <a class="el" href="_k_s_foundation_8h.html#ab4c6e9f82b55a3db56765fc22f21b7b5" title="Returns the time required to play out a certain number of sequence modules over some interval...">ks_eval_gradrflimits()</a></h4>
</p>
<p>The <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object will be ignored if added previously</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">gradrfctrl</td><td>Pointer to the <a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html" title="typedef struct that is a part of the KS_SEQ_CONTROL typedef struct, used internally to collect gradie...">KS_GRADRFCTRL</a> for the sequence </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">trap</td><td>Pointer to <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;                                                                             {</div><div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;  <span class="keywordflow">if</span> (trap == NULL) <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;</div><div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;  <span class="keywordflow">if</span> (gradrfctrl == NULL) {</div><div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: gradrfctrl is NULL&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;  }</div><div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;</div><div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;  <span class="keywordflow">if</span> (gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a576774535b3b72525cf3821a0ded5124">numtrap</a> &gt;= <a class="code" href="_k_s_foundation_8h.html#a034073abe489e0f26ff7693e11abbb02">KS_MAXUNIQUE_TRAP</a>) {</div><div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: ERROR - too many unique KS_TRAP in sequence&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;  }</div><div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;</div><div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;  <span class="comment">/* check for previous registrations of this trap&#39;s memory address.  If found, return */</span></div><div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;  <span class="keywordflow">if</span> (gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a576774535b3b72525cf3821a0ded5124">numtrap</a> &gt; 0) {</div><div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a576774535b3b72525cf3821a0ded5124">numtrap</a>; i++) {</div><div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;      <span class="keywordflow">if</span> (gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a218dab0fa00815bec264cb1170a615ef">trapptr</a>[i] == trap)</div><div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;        <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;    }</div><div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;  }</div><div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;</div><div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;  gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a218dab0fa00815bec264cb1170a615ef">trapptr</a>[gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a576774535b3b72525cf3821a0ded5124">numtrap</a>++] = trap;</div><div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;</div><div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;}</div><div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a576774535b3b72525cf3821a0ded5124"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a576774535b3b72525cf3821a0ded5124">KS_GRADRFCTRL::numtrap</a></div><div class="ttdeci">int numtrap</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:818</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a034073abe489e0f26ff7693e11abbb02"><div class="ttname"><a href="_k_s_foundation_8h.html#a034073abe489e0f26ff7693e11abbb02">KS_MAXUNIQUE_TRAP</a></div><div class="ttdeci">#define KS_MAXUNIQUE_TRAP</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:115</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a218dab0fa00815bec264cb1170a615ef"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a218dab0fa00815bec264cb1170a615ef">KS_GRADRFCTRL::trapptr</a></div><div class="ttdeci">KS_TRAP * trapptr[KS_MAXUNIQUE_TRAP]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:817</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a66fd3b5f652cc4cdfd3f99376e365e94"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a66fd3b5f652cc4cdfd3f99376e365e94">&#9670;&nbsp;</a></span>ks_eval_addwavetogradrfctrl()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_addwavetogradrfctrl </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html">KS_GRADRFCTRL</a> *&#160;</td>
          <td class="paramname"><em>gradrfctrl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>*Internal use*. Adds a wave (<a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a>) - if it is not a part of a <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object - to the <a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html" title="typedef struct that is a part of the KS_SEQ_CONTROL typedef struct, used internally to collect gradie...">KS_GRADRFCTRL</a> struct for later gradient heating calculations in <a class="el" href="_k_s_foundation_8h.html#ab4c6e9f82b55a3db56765fc22f21b7b5" title="Returns the time required to play out a certain number of sequence modules over some interval...">ks_eval_gradrflimits()</a></h4>
</p>
<p>The <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object will be ignored if added previously</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">gradrfctrl</td><td>Pointer to the <a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html" title="typedef struct that is a part of the KS_SEQ_CONTROL typedef struct, used internally to collect gradie...">KS_GRADRFCTRL</a> for the sequence </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">wave</td><td>Pointer to <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;                                                                             {</div><div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;  <span class="keywordflow">if</span> (wave == NULL) <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;</div><div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;  <span class="keywordflow">if</span> (gradrfctrl == NULL) {</div><div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: gradrfctrl is NULL&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;  }</div><div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;</div><div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;  <span class="keywordflow">if</span> (gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a176c1433ab0ff244ebdc3806d77fc3c9">numwave</a> &gt;= <a class="code" href="_k_s_foundation_8h.html#a4a92ef54385807dc82f7a5113156f31e">KS_MAXUNIQUE_WAVE</a>) {</div><div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: ERROR - too many unique KS_WAVE in sequence&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;  }</div><div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;</div><div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;  <span class="comment">/* check for previous registrations of this trap&#39;s memory address.  If found, return */</span></div><div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;  <span class="keywordflow">if</span> (gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a176c1433ab0ff244ebdc3806d77fc3c9">numwave</a> &gt; 0) {</div><div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a176c1433ab0ff244ebdc3806d77fc3c9">numwave</a>; i++) {</div><div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;      <span class="keywordflow">if</span> (gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ac44d46e0aeb2f3842bf0cfc1e14ebadc">waveptr</a>[i] == wave)</div><div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;        <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;    }</div><div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;  }</div><div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;</div><div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;  <span class="comment">/* check also for previous waves in KS_RF (rfwave, omegawave, thetawave). If found, return */</span></div><div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;  <span class="keywordflow">if</span> (gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ad1471d1cbc5ed7e8b1bc9d0987bf6eed">numrf</a> &gt; 0) {</div><div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ad1471d1cbc5ed7e8b1bc9d0987bf6eed">numrf</a>; i++) {</div><div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;      <span class="keywordflow">if</span> (&amp;(gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a753f71c73d8169393fcbe8a9b3f4d2c2">rfptr</a>[i]-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>) == wave || &amp;(gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a753f71c73d8169393fcbe8a9b3f4d2c2">rfptr</a>[i]-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>) == wave || &amp;(gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a753f71c73d8169393fcbe8a9b3f4d2c2">rfptr</a>[i]-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>) == wave)</div><div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;        <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;    }</div><div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;  }</div><div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;</div><div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;  gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ac44d46e0aeb2f3842bf0cfc1e14ebadc">waveptr</a>[gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a176c1433ab0ff244ebdc3806d77fc3c9">numwave</a>++] = wave;</div><div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;</div><div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;}</div><div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a753f71c73d8169393fcbe8a9b3f4d2c2"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a753f71c73d8169393fcbe8a9b3f4d2c2">KS_GRADRFCTRL::rfptr</a></div><div class="ttdeci">KS_RF * rfptr[KS_MAXUNIQUE_RF]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:815</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_ad1471d1cbc5ed7e8b1bc9d0987bf6eed"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ad1471d1cbc5ed7e8b1bc9d0987bf6eed">KS_GRADRFCTRL::numrf</a></div><div class="ttdeci">int numrf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:816</div></div>
<div class="ttc" id="struct_k_s___r_f_html_aecd8b68c159a31a28e2a2ec003b593e2"><div class="ttname"><a href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">KS_RF::thetawave</a></div><div class="ttdeci">KS_WAVE thetawave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:800</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_ac44d46e0aeb2f3842bf0cfc1e14ebadc"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ac44d46e0aeb2f3842bf0cfc1e14ebadc">KS_GRADRFCTRL::waveptr</a></div><div class="ttdeci">KS_WAVE * waveptr[KS_MAXUNIQUE_WAVE]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:819</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a2a9b610a78cdae3ac8ef682bd34f7e0d"><div class="ttname"><a href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">KS_RF::rfwave</a></div><div class="ttdeci">KS_WAVE rfwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:798</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4a92ef54385807dc82f7a5113156f31e"><div class="ttname"><a href="_k_s_foundation_8h.html#a4a92ef54385807dc82f7a5113156f31e">KS_MAXUNIQUE_WAVE</a></div><div class="ttdeci">#define KS_MAXUNIQUE_WAVE</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:116</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a176c1433ab0ff244ebdc3806d77fc3c9"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a176c1433ab0ff244ebdc3806d77fc3c9">KS_GRADRFCTRL::numwave</a></div><div class="ttdeci">int numwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:820</div></div>
<div class="ttc" id="struct_k_s___r_f_html_aa283d0a503cfda1c25da9f9b9a0d8b1c"><div class="ttname"><a href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">KS_RF::omegawave</a></div><div class="ttdeci">KS_WAVE omegawave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:799</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a42bd45a73d5b9e14d8970301a3087de2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a42bd45a73d5b9e14d8970301a3087de2">&#9670;&nbsp;</a></span>ks_eval_addrftogradrfctrl()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_addrftogradrfctrl </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html">KS_GRADRFCTRL</a> *&#160;</td>
          <td class="paramname"><em>gradrfctrl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_f.html">KS_RF</a> *&#160;</td>
          <td class="paramname"><em>rf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>*Internal use*. Adds an RF pulse to the <a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html" title="typedef struct that is a part of the KS_SEQ_CONTROL typedef struct, used internally to collect gradie...">KS_GRADRFCTRL</a> struct for later SAR &amp; RF power calculations in <a class="el" href="_k_s_foundation_8h.html#ab4c6e9f82b55a3db56765fc22f21b7b5" title="Returns the time required to play out a certain number of sequence modules over some interval...">ks_eval_gradrflimits()</a></h4>
</p>
<p>The RF object will be ignored if added previously</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">gradrfctrl</td><td>Pointer to the <a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html" title="typedef struct that is a part of the KS_SEQ_CONTROL typedef struct, used internally to collect gradie...">KS_GRADRFCTRL</a> for the sequence </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rf</td><td>Pointer to <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;                                                                       {</div><div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;  <span class="keywordflow">if</span> (rf == NULL) <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;</div><div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160;  <span class="keywordflow">if</span> (gradrfctrl == NULL) {</div><div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: gradrfctrl is NULL&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;  }</div><div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;</div><div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;  <span class="keywordflow">if</span> (gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ad1471d1cbc5ed7e8b1bc9d0987bf6eed">numrf</a> &gt;= <a class="code" href="_k_s_foundation_8h.html#a4becfb20a2ad2227c16c4ce772ed8d51">KS_MAXUNIQUE_RF</a>) {</div><div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: ERROR - too many unique KS_RF in sequence&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;  }</div><div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;</div><div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;  <span class="comment">/* check for previous registrations of this rf&#39;s memory address. If found, return */</span></div><div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;  <span class="keywordflow">if</span> (gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ad1471d1cbc5ed7e8b1bc9d0987bf6eed">numrf</a> &gt; 0) {</div><div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ad1471d1cbc5ed7e8b1bc9d0987bf6eed">numrf</a>; i++) {</div><div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;      <span class="keywordflow">if</span> (gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a753f71c73d8169393fcbe8a9b3f4d2c2">rfptr</a>[i] == rf)</div><div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;        <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;    }</div><div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;  }</div><div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;</div><div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;  gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a753f71c73d8169393fcbe8a9b3f4d2c2">rfptr</a>[gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ad1471d1cbc5ed7e8b1bc9d0987bf6eed">numrf</a>++] = rf;</div><div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;</div><div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_a4becfb20a2ad2227c16c4ce772ed8d51"><div class="ttname"><a href="_k_s_foundation_8h.html#a4becfb20a2ad2227c16c4ce772ed8d51">KS_MAXUNIQUE_RF</a></div><div class="ttdeci">#define KS_MAXUNIQUE_RF</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:114</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a753f71c73d8169393fcbe8a9b3f4d2c2"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a753f71c73d8169393fcbe8a9b3f4d2c2">KS_GRADRFCTRL::rfptr</a></div><div class="ttdeci">KS_RF * rfptr[KS_MAXUNIQUE_RF]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:815</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_ad1471d1cbc5ed7e8b1bc9d0987bf6eed"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ad1471d1cbc5ed7e8b1bc9d0987bf6eed">KS_GRADRFCTRL::numrf</a></div><div class="ttdeci">int numrf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:816</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac984f42cf505d04293f08e4c8286707c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac984f42cf505d04293f08e4c8286707c">&#9670;&nbsp;</a></span>ks_eval_addreadtogradrfctrl()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_addreadtogradrfctrl </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html">KS_GRADRFCTRL</a> *&#160;</td>
          <td class="paramname"><em>gradrfctrl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_e_a_d.html">KS_READ</a> *&#160;</td>
          <td class="paramname"><em>read</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>*Internal use*. Adds an acquisition to the <a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html" title="typedef struct that is a part of the KS_SEQ_CONTROL typedef struct, used internally to collect gradie...">KS_GRADRFCTRL</a> struct. Used for plotting</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">gradrfctrl</td><td>Pointer to the <a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html" title="typedef struct that is a part of the KS_SEQ_CONTROL typedef struct, used internally to collect gradie...">KS_GRADRFCTRL</a> for the sequence </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">read</td><td>Pointer to acquisition object. </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;                                                                             {</div><div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;  <span class="keywordflow">if</span> (read == NULL) <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;</div><div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;  <span class="keywordflow">if</span> (gradrfctrl == NULL) {</div><div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: gradrfctrl is NULL&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;  }</div><div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;</div><div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;  <span class="keywordflow">if</span> (gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#abe25ffea5925df8869e60f527ce583b4">numacq</a> &gt;= <a class="code" href="_k_s_foundation_8h.html#a8b4a19e776c83d9477d2d4135a564aeb">KS_MAXUNIQUE_READ</a>) {</div><div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: ERROR - too many readouts in sequence&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;  }</div><div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;</div><div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;  <span class="comment">/* check for previous registrations of the pointer. If found, return */</span></div><div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;  <span class="keywordflow">if</span> (gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#abe25ffea5925df8869e60f527ce583b4">numacq</a> &gt; 0) {</div><div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#abe25ffea5925df8869e60f527ce583b4">numacq</a>; i++) {</div><div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;      <span class="keywordflow">if</span> (gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a2389836ad299458a5470e252c06b91dd">readptr</a>[i] == read)</div><div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;        <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;    }</div><div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;  }</div><div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;</div><div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;  gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a2389836ad299458a5470e252c06b91dd">readptr</a>[gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#abe25ffea5925df8869e60f527ce583b4">numacq</a>++] = read;</div><div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;</div><div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a8b4a19e776c83d9477d2d4135a564aeb"><div class="ttname"><a href="_k_s_foundation_8h.html#a8b4a19e776c83d9477d2d4135a564aeb">KS_MAXUNIQUE_READ</a></div><div class="ttdeci">#define KS_MAXUNIQUE_READ</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:119</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a2389836ad299458a5470e252c06b91dd"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a2389836ad299458a5470e252c06b91dd">KS_GRADRFCTRL::readptr</a></div><div class="ttdeci">KS_READ * readptr[KS_MAXUNIQUE_READ]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:821</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_abe25ffea5925df8869e60f527ce583b4"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#abe25ffea5925df8869e60f527ce583b4">KS_GRADRFCTRL::numacq</a></div><div class="ttdeci">int numacq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:822</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aabacf1e670ae0faa4af8cd75d02778e7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aabacf1e670ae0faa4af8cd75d02778e7">&#9670;&nbsp;</a></span>ks_eval_wait()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_wait </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___w_a_i_t.html">KS_WAIT</a> *&#160;</td>
          <td class="paramname"><em>wait</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const&#160;</td>
          <td class="paramname"><em>desc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>maxduration</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets up a wait pulse using a <a class="el" href="struct_k_s___w_a_i_t.html" title="Core sequence object that adds wait periods in the pulse sequence (see ks_eval_wait(), ks_pg_wait()). Can be placed on any sequence board">KS_WAIT</a> sequence object</h4>
</p>
<p>This function should be called in <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code> and defines a wait pulse whose duration can be changed at scan-time up to <code>.duration</code> [us].</p>
<p>If <a class="el" href="_k_s_foundation_8h.html#aabacf1e670ae0faa4af8cd75d02778e7" title="Sets up a wait pulse using a KS_WAIT sequence object">ks_eval_wait()</a> returns FAILURE, one must also make sure <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code> returns FAILURE, otherwise an error message created in <a class="el" href="_k_s_foundation_8h.html#aabacf1e670ae0faa4af8cd75d02778e7" title="Sets up a wait pulse using a KS_WAIT sequence object">ks_eval_wait()</a> will not be seen in the UI.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">wait</td><td>Pointer to the <a class="el" href="struct_k_s___w_a_i_t.html" title="Core sequence object that adds wait periods in the pulse sequence (see ks_eval_wait(), ks_pg_wait()). Can be placed on any sequence board">KS_WAIT</a> object to be set up </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">desc</td><td>A description (text string) of the <a class="el" href="struct_k_s___w_a_i_t.html" title="Core sequence object that adds wait periods in the pulse sequence (see ks_eval_wait(), ks_pg_wait()). Can be placed on any sequence board">KS_WAIT</a> object. This description is used for pulse sequence generation (seen in the file generated by <em>TimeHist</em> in <em>MGD Sim/WTools</em>) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">maxduration</td><td>The desired maximum duration in [us] of the <a class="el" href="struct_k_s___w_a_i_t.html" title="Core sequence object that adds wait periods in the pulse sequence (see ks_eval_wait(), ks_pg_wait()). Can be placed on any sequence board">KS_WAIT</a> object </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                                                                          {</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#ad0d05a33cfe5de925f28709883a37abc">ks_init_wait</a>(wait);</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  <span class="keywordflow">if</span> (desc == NULL || desc[0] == <span class="charliteral">&#39; &#39;</span>) {</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_wait desc (2nd arg) cannot be NULL or begin with a space&quot;</span>);</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    strncpy(wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, desc, <a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> - 1);</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  }</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> = duration;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  <span class="comment">/* initialize counters to 0 */</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a> = 0;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a> = 0;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a75b19ffcca77bfc647ff02695958fd95">next</a> = NULL;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;}</div><div class="ttc" id="_k_s_foundation__host_8c_html_ad0d05a33cfe5de925f28709883a37abc"><div class="ttname"><a href="_k_s_foundation__host_8c.html#ad0d05a33cfe5de925f28709883a37abc">ks_init_wait</a></div><div class="ttdeci">void ks_init_wait(KS_WAIT *wait)</div><div class="ttdoc">Resets a KS_WAIT sequence object to its default value (KS_INIT_WAIT)</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:49</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a72a22b96ff3908d2b9a20a3a02647a2f"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">KS_BASE::ninst</a></div><div class="ttdeci">int ninst</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:261</div></div>
<div class="ttc" id="struct_k_s___w_a_i_t_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___w_a_i_t.html#a1c544bec41003a594ba4ec7d43a3a470">KS_WAIT::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:310</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aacb2fe1d83c45e8d0525f363bdd6b8a6"><div class="ttname"><a href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a></div><div class="ttdeci">#define KS_DESCRIPTION_LENGTH</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:112</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a75b19ffcca77bfc647ff02695958fd95"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a75b19ffcca77bfc647ff02695958fd95">KS_BASE::next</a></div><div class="ttdeci">void * next</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:263</div></div>
<div class="ttc" id="struct_k_s___w_a_i_t_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">KS_WAIT::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:309</div></div>
<div class="ttc" id="struct_k_s___w_a_i_t_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___w_a_i_t.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_WAIT::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:311</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1d053f6867254f3b3acfc0589e490b5f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1d053f6867254f3b3acfc0589e490b5f">&#9670;&nbsp;</a></span>ks_eval_isirot()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_isirot </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___i_s_i_r_o_t.html">KS_ISIROT</a> *&#160;</td>
          <td class="paramname"><em>isirot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const&#160;</td>
          <td class="paramname"><em>desc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>isinumber</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets up a <a class="el" href="struct_k_s___i_s_i_r_o_t.html" title="Struct for in-sequence rotations using ISI vector interupts">KS_ISIROT</a> object to be used for real-time coordinate rotations</h4>
</p>
<p>See also <a class="el" href="_k_s_foundation_8h.html#a67d0db25c6c69ee17a9b4b0ee79b7fb7" title="Places out an intersequence interrupt at a specific time in the sequence module">ks_pg_isirot()</a> and <a class="el" href="_k_s_foundation_8h.html#a520240c3153cf9ffe25a7617b2c72149" title="Performs an immediate rotation of the logical system on hardware (WARP)">ks_scan_isirotate()</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">isirot</td><td>Pointer to the <a class="el" href="struct_k_s___i_s_i_r_o_t.html" title="Struct for in-sequence rotations using ISI vector interupts">KS_ISIROT</a> object to be set up </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">desc</td><td>A description (text string) of the <a class="el" href="struct_k_s___i_s_i_r_o_t.html" title="Struct for in-sequence rotations using ISI vector interupts">KS_ISIROT</a> object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">isinumber</td><td>A free ISI interrupt number in range [4,7] </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                                                                                 {</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  STATUS status;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  <span class="keywordtype">char</span> tmpdesc[<a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a>];</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  <span class="keywordflow">if</span> ((isinumber &lt; 4) || (isinumber &gt; 7)) {</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: ISI number out of range (should be 4-7)&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  }</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  sprintf(tmpdesc, <span class="stringliteral">&quot;%s_isirotfun&quot;</span>, desc);</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  status = <a class="code" href="_k_s_foundation__host_8c.html#aebbad9db5997d55fc8825e0d0e8e763e">ks_eval_wait</a>(&amp;isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#ae1657bcc1ec96d5840d39d301f6f296c">waitfun</a>, tmpdesc, RUP_GRD(<a class="code" href="_k_s_foundation_8h.html#addf010deada78e27501476388abad0be">KS_ISI_time</a>));</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  <span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  sprintf(tmpdesc, <span class="stringliteral">&quot;%s_isirotupdate&quot;</span>, desc);</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  status = <a class="code" href="_k_s_foundation__host_8c.html#aebbad9db5997d55fc8825e0d0e8e763e">ks_eval_wait</a>(&amp;isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#ad8daa9629fb2aa8f141f7be2fef5a62d">waitrot</a>, tmpdesc, RUP_GRD(<a class="code" href="_k_s_foundation_8h.html#a191c8595f093c9d5b27a408e6a2dc1ab">KS_ISI_rotupdatetime</a>));</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  <span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#a0e1954c05e7f29d42ad9f68ea2b38559">isinumber</a> = isinumber;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> = isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#ae1657bcc1ec96d5840d39d301f6f296c">waitfun</a>.<a class="code" href="struct_k_s___w_a_i_t.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> + isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#ad8daa9629fb2aa8f141f7be2fef5a62d">waitrot</a>.<a class="code" href="struct_k_s___w_a_i_t.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#a617a47c70795bcff659815ad0efd2266">counter</a> = 0;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#aa571b5a96556f71c84be339d2e9193b4">numinstances</a> = 0;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;}</div><div class="ttc" id="struct_k_s___i_s_i_r_o_t_html_a0e1954c05e7f29d42ad9f68ea2b38559"><div class="ttname"><a href="struct_k_s___i_s_i_r_o_t.html#a0e1954c05e7f29d42ad9f68ea2b38559">KS_ISIROT::isinumber</a></div><div class="ttdeci">int isinumber</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:325</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aacb2fe1d83c45e8d0525f363bdd6b8a6"><div class="ttname"><a href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a></div><div class="ttdeci">#define KS_DESCRIPTION_LENGTH</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:112</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a191c8595f093c9d5b27a408e6a2dc1ab"><div class="ttname"><a href="_k_s_foundation_8h.html#a191c8595f093c9d5b27a408e6a2dc1ab">KS_ISI_rotupdatetime</a></div><div class="ttdeci">#define KS_ISI_rotupdatetime</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:77</div></div>
<div class="ttc" id="struct_k_s___i_s_i_r_o_t_html_ae1657bcc1ec96d5840d39d301f6f296c"><div class="ttname"><a href="struct_k_s___i_s_i_r_o_t.html#ae1657bcc1ec96d5840d39d301f6f296c">KS_ISIROT::waitfun</a></div><div class="ttdeci">KS_WAIT waitfun</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:322</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_aebbad9db5997d55fc8825e0d0e8e763e"><div class="ttname"><a href="_k_s_foundation__host_8c.html#aebbad9db5997d55fc8825e0d0e8e763e">ks_eval_wait</a></div><div class="ttdeci">STATUS ks_eval_wait(KS_WAIT *wait, const char *const desc, int duration)</div><div class="ttdoc">Sets up a wait pulse using a KS_WAIT sequence object</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:179</div></div>
<div class="ttc" id="struct_k_s___i_s_i_r_o_t_html_a617a47c70795bcff659815ad0efd2266"><div class="ttname"><a href="struct_k_s___i_s_i_r_o_t.html#a617a47c70795bcff659815ad0efd2266">KS_ISIROT::counter</a></div><div class="ttdeci">int counter</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:327</div></div>
<div class="ttc" id="struct_k_s___w_a_i_t_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___w_a_i_t.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_WAIT::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:311</div></div>
<div class="ttc" id="struct_k_s___i_s_i_r_o_t_html_aa571b5a96556f71c84be339d2e9193b4"><div class="ttname"><a href="struct_k_s___i_s_i_r_o_t.html#aa571b5a96556f71c84be339d2e9193b4">KS_ISIROT::numinstances</a></div><div class="ttdeci">int numinstances</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:328</div></div>
<div class="ttc" id="struct_k_s___i_s_i_r_o_t_html_ad8daa9629fb2aa8f141f7be2fef5a62d"><div class="ttname"><a href="struct_k_s___i_s_i_r_o_t.html#ad8daa9629fb2aa8f141f7be2fef5a62d">KS_ISIROT::waitrot</a></div><div class="ttdeci">KS_WAIT waitrot</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:323</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_addf010deada78e27501476388abad0be"><div class="ttname"><a href="_k_s_foundation_8h.html#addf010deada78e27501476388abad0be">KS_ISI_time</a></div><div class="ttdeci">#define KS_ISI_time</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:76</div></div>
<div class="ttc" id="struct_k_s___i_s_i_r_o_t_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___i_s_i_r_o_t.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_ISIROT::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:326</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae51f5ee899509ee52c23002bc1883cac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae51f5ee899509ee52c23002bc1883cac">&#9670;&nbsp;</a></span>ks_eval_read()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_e_a_d.html">KS_READ</a> *&#160;</td>
          <td class="paramname"><em>read</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const&#160;</td>
          <td class="paramname"><em>desc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets up a data acquisition window using a <a class="el" href="struct_k_s___r_e_a_d.html" title="Core sequence object that handles a data acquisition window">KS_READ</a> sequence object</h4>
</p>
<p>This function should be called in <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code> and defines a data acquisition window of a certain duration with some receiver bandwidth. Before calling this function, the following fields in the <a class="el" href="struct_k_s___r_e_a_d.html" title="Core sequence object that handles a data acquisition window">KS_READ</a> object must be set:</p><ul>
<li><code>.rbw</code>: The desired receiver bandwidth / FOV in [kHz] (max: 250)</li>
<li><code>.duration</code>: The duration in [us]</li>
</ul>
<p><a class="el" href="_k_s_foundation_8h.html#ae51f5ee899509ee52c23002bc1883cac" title="Sets up a data acquisition window using a KS_READ sequence object">ks_eval_read()</a> will validate the desired rBW and round it to the nearest valid value. Also the duration will be rounded up to fit a whole number of samples in the acquisition window.</p>
<p>To use an acquisition window <em>with</em> a gradient, see <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> and <a class="el" href="_k_s_foundation_8h.html#a0e06bd2e4433a2b508c7610d7056050f" title="Sets up an acquisition window with a trapezoid with preset gradient constraints">ks_eval_readtrap()</a></p>
<p>If <a class="el" href="_k_s_foundation_8h.html#ae51f5ee899509ee52c23002bc1883cac" title="Sets up a data acquisition window using a KS_READ sequence object">ks_eval_read()</a> returns FAILURE, one must also make sure <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code> returns FAILURE, otherwise an error message created in <a class="el" href="_k_s_foundation_8h.html#ae51f5ee899509ee52c23002bc1883cac" title="Sets up a data acquisition window using a KS_READ sequence object">ks_eval_read()</a> will not be seen in the UI.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">read</td><td>Pointer to the <a class="el" href="struct_k_s___r_e_a_d.html" title="Core sequence object that handles a data acquisition window">KS_READ</a> object to be set up </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">desc</td><td>A description (text string) of the <a class="el" href="struct_k_s___r_e_a_d.html" title="Core sequence object that handles a data acquisition window">KS_READ</a> object. This description is used for pulse sequence generation (seen in the file generated by <em>TimeHist</em> in <em>MGD Sim/WTools</em>) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                                                            {</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  <span class="keywordtype">char</span> tmpdesc[<a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a>];</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  <span class="keywordtype">int</span> duration;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <span class="keywordtype">float</span> rbw;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  <span class="keywordtype">int</span> tsp;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <span class="keywordtype">int</span> noutputs;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <span class="comment">/* store desired inputs before resetting */</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  duration = read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  rbw = read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a544d58cc06d73e0f73e464114f6e5318">rbw</a>;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  strcpy(tmpdesc, desc); <span class="comment">/* copy in case the read-&gt;description has been passed in before ks_init_read wipes it */</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  <span class="comment">/* Reset all fields (after saving the desired info) */</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#a3f102bd49ae8d18baede6827db227e41">ks_init_read</a>(read);</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="comment">/* put back the input fields */</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> = duration;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a544d58cc06d73e0f73e464114f6e5318">rbw</a> = <a class="code" href="_k_s_foundation__host_8c.html#a7c1c3b628e3f08dca4a169d80b7d6361">ks_calc_nearestbw</a>(rbw);  <span class="comment">/* round to nearest valid rBW */</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  tsp = <a class="code" href="_k_s_foundation__host_8c.html#a955f51280beb0915d42853ad14eee700">ks_calc_bw2tsp</a>(read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a544d58cc06d73e0f73e464114f6e5318">rbw</a>);</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  strncpy(read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, tmpdesc, <a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> - 1);</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>[<a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> - 1] = 0;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  <span class="comment">/* don&#39;t allow empty description or a description with leading space */</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  <span class="keywordflow">if</span> (read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a1c544bec41003a594ba4ec7d43a3a470">description</a> == NULL || read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>[0] == <span class="charliteral">&#39; &#39;</span>) {</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_read: read name (2nd arg) cannot be NULL or leading space&quot;</span>);</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  }</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  <span class="keywordflow">if</span> (read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a544d58cc06d73e0f73e464114f6e5318">rbw</a> &lt;= 0) {</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_read: field &#39;rbw&#39; (1st arg) is not set&quot;</span>);</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  }</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <span class="keywordflow">if</span> (read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> &lt;= 2) {</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_read: field &#39;duration&#39; (1st arg) must be a positive number in [us]&quot;</span>);</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  }</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  noutputs = CEIL_DIV(read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>, tsp);</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> = noutputs * tsp;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <span class="comment">/* calculate read-&gt;filter (FILTER_INFO) */</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__host_8c.html#a0ac6edfa5f7859ab7c89c77c1bc43df0">ks_calc_filter</a>(&amp;read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">filt</a>, tsp, read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>) == FAILURE)</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;}</div><div class="ttc" id="_k_s_foundation__host_8c_html_a7c1c3b628e3f08dca4a169d80b7d6361"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a7c1c3b628e3f08dca4a169d80b7d6361">ks_calc_nearestbw</a></div><div class="ttdeci">float ks_calc_nearestbw(float bw)</div><div class="ttdoc">Round receiver bandwidth to nearest valid value</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3385</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a3f102bd49ae8d18baede6827db227e41"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a3f102bd49ae8d18baede6827db227e41">ks_init_read</a></div><div class="ttdeci">void ks_init_read(KS_READ *read)</div><div class="ttdoc">Resets a KS_READ sequence object to its default value (KS_INIT_READ)</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:41</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a0ac6edfa5f7859ab7c89c77c1bc43df0"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a0ac6edfa5f7859ab7c89c77c1bc43df0">ks_calc_filter</a></div><div class="ttdeci">STATUS ks_calc_filter(FILTER_INFO *echortf, int tsp, int duration)</div><div class="ttdoc">Sets up GE&amp;#39;s FILTER_INFO struct based on dwell (sample point) time and duration of an acquisition win...</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3346</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a544d58cc06d73e0f73e464114f6e5318"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a544d58cc06d73e0f73e464114f6e5318">KS_READ::rbw</a></div><div class="ttdeci">float rbw</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:584</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a1c544bec41003a594ba4ec7d43a3a470">KS_READ::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:582</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aacb2fe1d83c45e8d0525f363bdd6b8a6"><div class="ttname"><a href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a></div><div class="ttdeci">#define KS_DESCRIPTION_LENGTH</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:112</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a955f51280beb0915d42853ad14eee700"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a955f51280beb0915d42853ad14eee700">ks_calc_bw2tsp</a></div><div class="ttdeci">int ks_calc_bw2tsp(float bw)</div><div class="ttdoc">Convert receiver bandwidth to dwell time</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3367</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_READ::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:583</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a292f93e48d34cda511fcfb72a05558c2"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">KS_READ::filt</a></div><div class="ttdeci">FILTER_INFO filt</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:585</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a984e0201828c0e74696118ff6487a303"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a984e0201828c0e74696118ff6487a303">&#9670;&nbsp;</a></span>ks_eval_trap_constrained()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_trap_constrained </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> *&#160;</td>
          <td class="paramname"><em>trap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const&#160;</td>
          <td class="paramname"><em>desc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>ampmax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>slewrate</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>minduration</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets up a trapezoid using a <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> sequence object with gradient constraints specified as input arguments</h4>
</p>
<p>Before calling this function, the following field in the <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object must be set:</p><ul>
<li><code>.area</code>: Desired gradient area in units of [(G/cm) * us]</li>
</ul>
<p><a class="el" href="_k_s_foundation_8h.html#a984e0201828c0e74696118ff6487a303" title="Sets up a trapezoid using a KS_TRAP sequence object with gradient constraints specified as input argu...">ks_eval_trap_constrained()</a> will make a trapezoid pulse with the desired area, constrained by the specified maximum gradient amplitude, slewrate, and minimum plateau time (args 3-5).</p>
<p>If <a class="el" href="_k_s_foundation_8h.html#a984e0201828c0e74696118ff6487a303" title="Sets up a trapezoid using a KS_TRAP sequence object with gradient constraints specified as input argu...">ks_eval_trap_constrained()</a> returns FAILURE, one must also make sure <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code> returns FAILURE, otherwise an error message created in <a class="el" href="_k_s_foundation_8h.html#a984e0201828c0e74696118ff6487a303" title="Sets up a trapezoid using a KS_TRAP sequence object with gradient constraints specified as input argu...">ks_eval_trap_constrained()</a> will not be seen in the UI.</p>
<p>There are three wrapper functions to this function (<a class="el" href="_k_s_foundation_8h.html#af40cc818066c7757959bf3712bfc5e6f" title="Sets up a trapezoid using a KS_TRAP sequence object with preset gradient constraints">ks_eval_trap()</a>, <a class="el" href="_k_s_foundation_8h.html#ade1d9d7d9be1c9e537b39ef98af04cfe" title="Sets up a trapezoid using a KS_TRAP sequence object with preset gradient constraints">ks_eval_trap1()</a>, <a class="el" href="_k_s_foundation_8h.html#abb3161153227b411c0518439c243a1ca" title="Sets up a trapezoid using a KS_TRAP sequence object with preset gradient constraints">ks_eval_trap2()</a>) that have reduced number of input arguments, and calls <a class="el" href="_k_s_foundation_8h.html#a984e0201828c0e74696118ff6487a303" title="Sets up a trapezoid using a KS_TRAP sequence object with gradient constraints specified as input argu...">ks_eval_trap_constrained()</a> with different preset gradient constraints. <a class="el" href="_k_s_foundation_8h.html#af40cc818066c7757959bf3712bfc5e6f" title="Sets up a trapezoid using a KS_TRAP sequence object with preset gradient constraints">ks_eval_trap()</a> makes fewest assumptions, making it the most general choice.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">trap</td><td>Pointer to the <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object to be set up </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">desc</td><td>A description (text string) of the <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object. This description is used for pulse sequence generation (seen in the file generated by <em>TimeHist</em> in <em>MGD Sim/WTools</em>) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ampmax</td><td>The maximum allowed gradient amplitude ([G/cm]) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">slewrate</td><td>The maximum allowed slewrate ([(G/cm) / us]). Value of 0.01 corresponds to 100 mT/m/s </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">minduration</td><td>Optional minimum duration ([us]). A zero value is used to disregard this constraint </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                                                                                                                       {</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  <span class="keywordtype">double</span> triangletrapezoid_area;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <span class="keywordtype">double</span> maxramp_area;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <span class="keywordtype">double</span> requested_area;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  <span class="keywordtype">int</span> maxramp_duration;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <span class="keywordtype">int</span> sign_reqarea;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <span class="keywordtype">int</span> minplateautime = <a class="code" href="_k_s_foundation_8h.html#a5a7fb5c0417f7e99c97bef1765558e0c">KS_MINPLATEAUTIME</a>;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <span class="keywordtype">char</span> tmpdesc[<a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a>];</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  <span class="comment">/* store desired inputs before resetting the trap object */</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  requested_area = (double) trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a97ab43f6fd28920a42d987c8fec4afec">area</a>;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  strcpy(tmpdesc, desc); <span class="comment">/* copy in case the trap-&gt;description has been passed in before ks_init_trap wipes it */</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  <span class="comment">/* Reset all fields and waveforms (after saving the desired area) */</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#a8efdbce2fbb4bf21a6fd8983fdd6d5c7">ks_init_trap</a>(trap);</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <span class="comment">/* put back the input fields */</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a97ab43f6fd28920a42d987c8fec4afec">area</a> = requested_area;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  strncpy(trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, tmpdesc, <a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> - 1);</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>[<a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> - 1] = 0;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  <span class="comment">/* don&#39;t allow empty description or a description with leading space */</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  <span class="keywordflow">if</span> (trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a> == NULL || trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>[0] == <span class="charliteral">&#39; &#39;</span>) {</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_trap: trap name (2nd arg) cannot be NULL or leading space&quot;</span>);</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  }</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  <span class="keywordflow">if</span> (requested_area == 0) {</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  }</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  <span class="comment">/* sign control: Store the sign of the requested area. Ignore all other signs */</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  sign_reqarea = (requested_area &lt; 0) ? -1 : 1;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  requested_area = fabs(requested_area);</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  slewrate = fabs(slewrate);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  ampmax = fabs(ampmax);</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  <span class="comment">/* make sure the minimum duration is divisible by 8us */</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  minduration = RUP_FACTOR(minduration, 2 * GRAD_UPDATE_TIME);</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  <span class="comment">/* area for one ramp from zero to max amplitude (&#39;ampmax&#39;) */</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  maxramp_duration = RUP_GRD(ceil((<span class="keywordtype">double</span>) ampmax / (<span class="keywordtype">double</span>) slewrate)); <span class="comment">/* [usec] */</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  maxramp_area = (double) ampmax * ((<span class="keywordtype">double</span>) maxramp_duration) / 2.0; <span class="comment">/* [G/cm * usec] */</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  <span class="comment">/* area for a trapezoid with a plateau time of &#39;minplateautime&#39; and maximum amplitude (&#39;ampmax&#39;) */</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  triangletrapezoid_area = ((double) minplateautime * (<span class="keywordtype">double</span>) ampmax) + (2.0 * maxramp_area);</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  <span class="keywordflow">if</span> (requested_area &gt; triangletrapezoid_area) {</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <span class="comment">/*      ________......ampmax</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment">           /        \</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment">          /          \</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment">         /            \</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">      __/              \__</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment">      We need max target amplitude and use a plateau time &gt; minplateautime to reach required area. [amp = ampmax] */</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a> = maxramp_duration;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">plateautime</a> = (int) ceil((requested_area - 2.0 * maxramp_area) / (double) ampmax);</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="comment">/* Round *up* to nearest 8us to make the plateau contain an even # of points (which is always nice) */</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">plateautime</a> = RUP_FACTOR(trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">plateautime</a>, 2 * GRAD_UPDATE_TIME);</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment">      ......... ampmax</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment">          _ amp</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment">         / \</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment">        /   \</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="comment">     __/     \__</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="comment">      We don&#39;t need max amplitude and will use a minimum plateau time of minplateautime</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="comment">      [amp = ramptime * slewrate] */</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">plateautime</a> = minplateautime; <span class="comment">/* Our minimum plateau time */</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="comment">/* Quadratic solution in &#39;ramptime&#39;:</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="comment">       slewrate*(ramptime)^2 + slewrate*minplateautime*(ramptime) - requested_area = 0</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment">       ...where: ramptime = unknownamp / slewrate &lt;=&gt; unknownamp = ramptime * slewrate   */</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a> = ((int) ceil(pow(requested_area / (<span class="keywordtype">double</span>) slewrate + ((<span class="keywordtype">double</span>) minplateautime * (<span class="keywordtype">double</span>) minplateautime) / 4.0, 0.5))) - minplateautime / 2;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="comment">/* Round *up* to nearest GRAD_UPDATE_TIME (unit: usec) */</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a> = RUP_GRD(trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a>);</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  }</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  <span class="comment">/* amp (G/cm). Make the sign of the amp equal to that of the requested_area */</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a> = (float) (sign_reqarea * requested_area / ((<span class="keywordtype">double</span>) (trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a> + trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">plateautime</a>)));</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  <span class="comment">/* amp watchdog */</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  <span class="keywordflow">if</span> (fabs(trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a>) &gt; ampmax)</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_trap: amp (%.3f) of trap &#39;%s&#39; exceeds ampmax (%.3f)&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, ampmax);</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  <span class="comment">/* store the duration */</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> = trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a> * 2 + trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">plateautime</a>;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  <span class="comment">/* if the duration is smaller than the minimum duration, increase the ramp times and reduce the gradient amp accordingly */</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;  <span class="keywordflow">if</span> (trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> &lt; minduration) {</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a> += (minduration - trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>)/2;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> = trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a> * 2 + trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">plateautime</a>;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a> = (float) (sign_reqarea * requested_area / ((<span class="keywordtype">double</span>) (trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a> + trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">plateautime</a>)));</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  }</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;}</div><div class="ttc" id="struct_k_s___t_r_a_p_html_a878bb367b07dc7dfb5fef5728d2e5b1d"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">KS_TRAP::plateautime</a></div><div class="ttdeci">int plateautime</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:436</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a8efdbce2fbb4bf21a6fd8983fdd6d5c7"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a8efdbce2fbb4bf21a6fd8983fdd6d5c7">ks_init_trap</a></div><div class="ttdeci">void ks_init_trap(KS_TRAP *trap)</div><div class="ttdoc">Resets a KS_TRAP sequence object to its default value (KS_INIT_TRAP)</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:45</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aacb2fe1d83c45e8d0525f363bdd6b8a6"><div class="ttname"><a href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a></div><div class="ttdeci">#define KS_DESCRIPTION_LENGTH</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:112</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a97ab43f6fd28920a42d987c8fec4afec"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a97ab43f6fd28920a42d987c8fec4afec">KS_TRAP::area</a></div><div class="ttdeci">float area</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:434</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ab508ded41392ee86a2a619d3e93d2373"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">KS_TRAP::amp</a></div><div class="ttdeci">float amp</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:433</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">KS_TRAP::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:432</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a7fb5c0417f7e99c97bef1765558e0c"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a7fb5c0417f7e99c97bef1765558e0c">KS_MINPLATEAUTIME</a></div><div class="ttdeci">#define KS_MINPLATEAUTIME</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:81</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_TRAP::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:437</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_acbc719dc4e48c2a2df0447875e4348ca"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">KS_TRAP::ramptime</a></div><div class="ttdeci">int ramptime</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:435</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af40cc818066c7757959bf3712bfc5e6f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af40cc818066c7757959bf3712bfc5e6f">&#9670;&nbsp;</a></span>ks_eval_trap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_trap </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> *&#160;</td>
          <td class="paramname"><em>trap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const&#160;</td>
          <td class="paramname"><em>desc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets up a trapezoid using a <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> sequence object with preset gradient constraints</h4>
</p>
<p>Before calling this function, the following field in the <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object must be set:</p><ul>
<li><code>.area</code>: Desired gradient area in units of [(G/cm) * us]</li>
</ul>
<p>This is a wrapper function to <a class="el" href="_k_s_foundation_8h.html#a984e0201828c0e74696118ff6487a303" title="Sets up a trapezoid using a KS_TRAP sequence object with gradient constraints specified as input argu...">ks_eval_trap_constrained()</a> with gradient constraints set to allow this <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> to be simultaneously played on XGRAD, YGRAD, ZGRAD for any slice angulation.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">trap</td><td>Pointer to the <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object to be set up </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">desc</td><td>A description (text string) of the <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object. This description is used for pulse sequence generation (seen in the file generated by <em>TimeHist</em> in <em>MGD Sim/WTools</em>) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                                                            {</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__host_8c.html#ace858b7b1e7182259bcaa098147e5956">ks_eval_trap_constrained</a>(trap, desc, <a class="code" href="_k_s_foundation_8h.html#a5c919c547ee396b18069ed505c695139">ks_syslimits_ampmax</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>), <a class="code" href="_k_s_foundation_8h.html#a712d215e449900b4fc566fefff51b4e9">ks_syslimits_slewrate</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>), 0);</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_a5c919c547ee396b18069ed505c695139"><div class="ttname"><a href="_k_s_foundation_8h.html#a5c919c547ee396b18069ed505c695139">ks_syslimits_ampmax</a></div><div class="ttdeci">float ks_syslimits_ampmax(LOG_GRAD loggrd)</div><div class="ttdoc">Returns the maximum gradient amplitude that can be used on all gradient boards simultaneously</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:163</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_ace858b7b1e7182259bcaa098147e5956"><div class="ttname"><a href="_k_s_foundation__host_8c.html#ace858b7b1e7182259bcaa098147e5956">ks_eval_trap_constrained</a></div><div class="ttdeci">STATUS ks_eval_trap_constrained(KS_TRAP *trap, const char *const desc, float ampmax, float slewrate, int minduration)</div><div class="ttdoc">Sets up a trapezoid using a KS_TRAP sequence object with gradient constraints specified as input argu...</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:276</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a712d215e449900b4fc566fefff51b4e9"><div class="ttname"><a href="_k_s_foundation_8h.html#a712d215e449900b4fc566fefff51b4e9">ks_syslimits_slewrate</a></div><div class="ttdeci">float ks_syslimits_slewrate(LOG_GRAD loggrd)</div><div class="ttdoc">Returns the maximum slewrate that can be used on all gradient boards simultaneously</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:196</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="abb3161153227b411c0518439c243a1ca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abb3161153227b411c0518439c243a1ca">&#9670;&nbsp;</a></span>ks_eval_trap2()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_trap2 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> *&#160;</td>
          <td class="paramname"><em>trap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const&#160;</td>
          <td class="paramname"><em>desc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets up a trapezoid using a <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> sequence object with preset gradient constraints</h4>
</p>
<p>Before calling this function, the following field in the <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object must be set:</p><ul>
<li><code>.area</code>: Desired gradient area in units of [(G/cm) * us]</li>
</ul>
<p>This is a wrapper function to <a class="el" href="_k_s_foundation_8h.html#a984e0201828c0e74696118ff6487a303" title="Sets up a trapezoid using a KS_TRAP sequence object with gradient constraints specified as input argu...">ks_eval_trap_constrained()</a> with gradient constraints set to allow this <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> to be simultaneously played on up to two (2) logical gradients for any slice angulation.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">trap</td><td>Pointer to the <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object to be set up </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">desc</td><td>A description (text string) of the <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object. This description is used for pulse sequence generation (seen in the file generated by <em>TimeHist</em> in <em>MGD Sim/WTools</em>) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                                                             {</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__host_8c.html#ace858b7b1e7182259bcaa098147e5956">ks_eval_trap_constrained</a>(trap, desc, <a class="code" href="_k_s_foundation_8h.html#a4b3a3095702bf551f318ef9f03ff3403">ks_syslimits_ampmax2</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>), <a class="code" href="_k_s_foundation_8h.html#a53d792432e1fd99fa597314576fa9e49">ks_syslimits_slewrate2</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>), 0);</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;}</div><div class="ttc" id="_k_s_foundation__host_8c_html_ace858b7b1e7182259bcaa098147e5956"><div class="ttname"><a href="_k_s_foundation__host_8c.html#ace858b7b1e7182259bcaa098147e5956">ks_eval_trap_constrained</a></div><div class="ttdeci">STATUS ks_eval_trap_constrained(KS_TRAP *trap, const char *const desc, float ampmax, float slewrate, int minduration)</div><div class="ttdoc">Sets up a trapezoid using a KS_TRAP sequence object with gradient constraints specified as input argu...</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:276</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4b3a3095702bf551f318ef9f03ff3403"><div class="ttname"><a href="_k_s_foundation_8h.html#a4b3a3095702bf551f318ef9f03ff3403">ks_syslimits_ampmax2</a></div><div class="ttdeci">float ks_syslimits_ampmax2(LOG_GRAD loggrd)</div><div class="ttdoc">Returns the maximum gradient amplitude that can be used on two gradient boards simultaneously</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:167</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a53d792432e1fd99fa597314576fa9e49"><div class="ttname"><a href="_k_s_foundation_8h.html#a53d792432e1fd99fa597314576fa9e49">ks_syslimits_slewrate2</a></div><div class="ttdeci">float ks_syslimits_slewrate2(LOG_GRAD loggrd)</div><div class="ttdoc">Returns the maximum slewrate that can be used on two gradient boards simultaneously</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:200</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ade1d9d7d9be1c9e537b39ef98af04cfe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ade1d9d7d9be1c9e537b39ef98af04cfe">&#9670;&nbsp;</a></span>ks_eval_trap1()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_trap1 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> *&#160;</td>
          <td class="paramname"><em>trap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const&#160;</td>
          <td class="paramname"><em>desc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets up a trapezoid using a <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> sequence object with preset gradient constraints</h4>
</p>
<p>Before calling this function, the following field in the <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object must be set:</p><ul>
<li><code>.area</code>: Desired gradient area in units of [(G/cm) * us]</li>
</ul>
<p>This is a wrapper function to <a class="el" href="_k_s_foundation_8h.html#a984e0201828c0e74696118ff6487a303" title="Sets up a trapezoid using a KS_TRAP sequence object with gradient constraints specified as input argu...">ks_eval_trap_constrained()</a> with gradient constraints set to allow this <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> to only be played out on one (1) logical gradient at a time. No gradient may be active on another board while this trapezoid is played out.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">trap</td><td>Pointer to the <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object to be set up </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">desc</td><td>A description (text string) of the <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object. This description is used for pulse sequence generation (seen in the file generated by <em>TimeHist</em> in <em>MGD Sim/WTools</em>) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                                                             {</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__host_8c.html#ace858b7b1e7182259bcaa098147e5956">ks_eval_trap_constrained</a>(trap, desc, <a class="code" href="_k_s_foundation_8h.html#a431729c0ecf331b33d84db72a80debaf">ks_syslimits_ampmax1</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>), <a class="code" href="_k_s_foundation_8h.html#aaeea7c06ce455978cce287cf28c22a4f">ks_syslimits_slewrate1</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>), 0);</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;}</div><div class="ttc" id="_k_s_foundation__host_8c_html_ace858b7b1e7182259bcaa098147e5956"><div class="ttname"><a href="_k_s_foundation__host_8c.html#ace858b7b1e7182259bcaa098147e5956">ks_eval_trap_constrained</a></div><div class="ttdeci">STATUS ks_eval_trap_constrained(KS_TRAP *trap, const char *const desc, float ampmax, float slewrate, int minduration)</div><div class="ttdoc">Sets up a trapezoid using a KS_TRAP sequence object with gradient constraints specified as input argu...</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:276</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aaeea7c06ce455978cce287cf28c22a4f"><div class="ttname"><a href="_k_s_foundation_8h.html#aaeea7c06ce455978cce287cf28c22a4f">ks_syslimits_slewrate1</a></div><div class="ttdeci">float ks_syslimits_slewrate1(LOG_GRAD loggrd)</div><div class="ttdoc">Returns the maximum slewrate that can be used on one gradient board at a time</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:204</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a431729c0ecf331b33d84db72a80debaf"><div class="ttname"><a href="_k_s_foundation_8h.html#a431729c0ecf331b33d84db72a80debaf">ks_syslimits_ampmax1</a></div><div class="ttdeci">float ks_syslimits_ampmax1(LOG_GRAD loggrd)</div><div class="ttdoc">Returns the maximum gradient amplitude that can be used on all gradient boards simultaneously</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:171</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="adbc5d161b21228ab4d53c03911916961"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adbc5d161b21228ab4d53c03911916961">&#9670;&nbsp;</a></span>ks_eval_readtrap_constrained()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_readtrap_constrained </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a> *&#160;</td>
          <td class="paramname"><em>readtrap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const&#160;</td>
          <td class="paramname"><em>desc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>ampmax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>slewrate</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets up an acquisition window with a trapezoid, subject to gradient constraints specified as input arguments</h4>
</p>
<p>Before calling this function, the following fields in the <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> object must be set:</p><ol type="1">
<li><code>.fov</code>: Desired image Field-of-View (FOV) in [mm] along the sequence board one intends to place the <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> on (typically XGRAD)</li>
<li><code>.res</code>: Number of pixels within the FOV</li>
<li><code>.acq.rbw</code>: Receiver bandwidth (rBW) in [kHz/FOV]. Maximum is 250</li>
<li><code>.rampsampling</code>: If non-zero, data acquisition will be performed on the ramps of the trapezoid as well. This reduces the readout time, especially for high rBWs.</li>
<li><code>.acqdelay</code>: Needs to be set only if <code>.rampsampling = 1</code>. The <code>.acqdelay</code> (in [us]) will dictate the time from the start of the ramp-up until data acquisition will begin</li>
<li><code>.nover</code>: Number of 'overscans'. If 0, a full echo will be generated (filling k-space). If &gt; 0, fractional echo (i.e. shorter TE) will be set up with <code>.nover</code> number of extra sample points beyond <code>.res/2</code>. The total number of samples will be <code>.res/2 + .nover</code>. Values of <code>.nover</code> between 1 and about 16 should be avoided since half Fourier reconstruction methods will likely have difficulties.</li>
</ol>
<p>If the <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> object is initialized with KS_INIT_READTRAP, the fields <code>.nover</code>, <code>.rampsampling</code> and <code>.acqdelay</code> will all be zero (steps 4-6 can be skipped)</p>
<p>Based on the information in the <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> object, <a class="el" href="_k_s_foundation_8h.html#adbc5d161b21228ab4d53c03911916961" title="Sets up an acquisition window with a trapezoid, subject to gradient constraints specified as input ar...">ks_eval_readtrap_constrained()</a> will set up its <code>.grad</code> trapezoid (<a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a>) and its acquisition window <code>.acq</code> (<a class="el" href="struct_k_s___r_e_a_d.html" title="Core sequence object that handles a data acquisition window">KS_READ</a>), constrained by the specified maximum gradient amplitude, slewrate, and minimum plateau time (args 3-5).</p>
<p>If <code>.rampsampling = 1</code>, <a class="el" href="_k_s_foundation_8h.html#adbc5d161b21228ab4d53c03911916961" title="Sets up an acquisition window with a trapezoid, subject to gradient constraints specified as input ar...">ks_eval_readtrap_constrained()</a> will also copy the shape of <code>.grad</code> to <code>.omega</code> (also a <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a>). This is needed for FOV-offsets in the readout direction when data acquisition is done on both the ramps and on the plateau, and <a class="el" href="_k_s_foundation_8h.html#a21198913d5b1603f03a5e5d61d00408c" title="Places a KS_READTRAP sequence object on a board at some position in the pulse sequence">ks_pg_readtrap()</a> and <a class="el" href="_k_s_foundation_8h.html#a11a9b9d761ba64a74b88c222b2a949e3" title="Updates the frequency and phase of one or all instances of a KS_READTRAP to create a FOV shift...">ks_scan_offsetfov()</a> will handle the <code>.omega</code> <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> so that the intended FOV shift in [mm] will be performed.</p>
<p><a class="el" href="_k_s_foundation_8h.html#adbc5d161b21228ab4d53c03911916961" title="Sets up an acquisition window with a trapezoid, subject to gradient constraints specified as input ar...">ks_eval_readtrap_constrained()</a> will also fill in the convenience fields <code>.area2center</code> and <code>.time2center</code> properly. <code>.area2center</code> is useful to use as <code>.area</code> for a read dephaser, and <code>.time2center</code> makes sequence timing calculations easier. Both fields take partial/full Fourier (<code>.nover</code>) into account.</p>
<p>If <a class="el" href="_k_s_foundation_8h.html#adbc5d161b21228ab4d53c03911916961" title="Sets up an acquisition window with a trapezoid, subject to gradient constraints specified as input ar...">ks_eval_readtrap_constrained()</a> returns FAILURE, one must also make sure <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code> returns FAILURE, otherwise an error message created in <a class="el" href="_k_s_foundation_8h.html#adbc5d161b21228ab4d53c03911916961" title="Sets up an acquisition window with a trapezoid, subject to gradient constraints specified as input ar...">ks_eval_readtrap_constrained()</a> will not be seen in the UI.</p>
<p>There are three wrapper functions to this function (<a class="el" href="_k_s_foundation_8h.html#a0e06bd2e4433a2b508c7610d7056050f" title="Sets up an acquisition window with a trapezoid with preset gradient constraints">ks_eval_readtrap()</a>, <a class="el" href="_k_s_foundation_8h.html#a203432ea0305ff401753b90d25e41b13" title="Sets up an acquisition window with a trapezoid with preset gradient constraints">ks_eval_readtrap1()</a>, <a class="el" href="_k_s_foundation_8h.html#a0b3f7a7cc038b40ea4fd457751acd4ff" title="Sets up an acquisition window with a trapezoid with preset gradient constraints">ks_eval_readtrap2()</a>) that have reduced number of input arguments, and calls <a class="el" href="_k_s_foundation_8h.html#adbc5d161b21228ab4d53c03911916961" title="Sets up an acquisition window with a trapezoid, subject to gradient constraints specified as input ar...">ks_eval_readtrap_constrained()</a> with different preset gradient constraints. <a class="el" href="_k_s_foundation_8h.html#a0e06bd2e4433a2b508c7610d7056050f" title="Sets up an acquisition window with a trapezoid with preset gradient constraints">ks_eval_readtrap()</a> makes fewest assumptions, making it the most general choice.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">readtrap</td><td>Pointer to the <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> object to be set up </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">desc</td><td>A description (text string) of the <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> object. This description is used for pulse sequence generation (seen in the file generated by <em>TimeHist</em> in <em>MGD Sim/WTools</em>) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ampmax</td><td>The maximum allowed gradient amplitude ([G/cm]) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">slewrate</td><td>The maximum allowed slewrate ([(G/cm) / us]). Value of 0.01 corresponds to 100 mT/m/s </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                                                                                                                  {</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  <span class="keywordtype">float</span> minfov;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  <span class="keywordtype">int</span> tsp = 0;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  <span class="keywordtype">float</span> readpixelarea;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  <span class="keywordtype">int</span> nreadpixels;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  <span class="keywordtype">float</span> nonacq_readarea;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  <span class="keywordtype">float</span> ampmax_kspace_speedlimit;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  <span class="comment">/* This function is for setting up readout trapezoid with fixed amplitude based on FOV and rBW */</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  <span class="keywordflow">if</span> (desc == NULL || desc[0] == <span class="charliteral">&#39; &#39;</span>) {</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_readtrap: desc (2nd arg) cannot be NULL&quot;</span>);</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  }</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  <span class="keywordflow">if</span> (readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a544d58cc06d73e0f73e464114f6e5318">rbw</a> == 0 || readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a544d58cc06d73e0f73e464114f6e5318">rbw</a> == <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>) {</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_readtrap: field &#39;acq.rbw&#39; (1st arg) is not set&quot;</span>);</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  }</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  <span class="comment">/* reset KS_TRAP&#39;s */</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#a8efdbce2fbb4bf21a6fd8983fdd6d5c7">ks_init_trap</a>(&amp;readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>);</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#a8efdbce2fbb4bf21a6fd8983fdd6d5c7">ks_init_trap</a>(&amp;readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#abd9ff216626c3fd76322a2a56dc606cc">omega</a>);</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  <span class="comment">/* round rBW to nearest valid value */</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a544d58cc06d73e0f73e464114f6e5318">rbw</a> = <a class="code" href="_k_s_foundation__host_8c.html#a7c1c3b628e3f08dca4a169d80b7d6361">ks_calc_nearestbw</a>(readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a544d58cc06d73e0f73e464114f6e5318">rbw</a>);</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  tsp = <a class="code" href="_k_s_foundation__host_8c.html#a955f51280beb0915d42853ad14eee700">ks_calc_bw2tsp</a>(readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a544d58cc06d73e0f73e464114f6e5318">rbw</a>); <span class="comment">/* us per sample point */</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  minfov = <a class="code" href="_k_s_foundation_8h.html#a6ffabfee55fc92b35511d263092f6ea9">ks_calc_minfov</a>(ampmax, tsp);</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  <span class="comment">/* Programmer&#39;s error */</span></div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;  <span class="keywordflow">if</span> (readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#aac31eb68bff694554a182bd796b2f1c5">res</a> % 2 || readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#aac31eb68bff694554a182bd796b2f1c5">res</a> &lt;= 0 || readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#aac31eb68bff694554a182bd796b2f1c5">res</a> &gt; 2048) {</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_readtrap(%s): field &#39;res&#39; must be even and in the range 2-2048&quot;</span>, desc);</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  }</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  <span class="keywordflow">if</span> (readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#abfd94a01fc71278021802ca0d1e25e16">fov</a> &lt; 10 || readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#abfd94a01fc71278021802ca0d1e25e16">fov</a> &gt; 600) {</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_readtrap(%s): field &#39;fov&#39; must be in the range 10-600 mm&quot;</span>, desc);</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  }</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  <span class="keywordflow">if</span> (abs(readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a>) &gt; readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#aac31eb68bff694554a182bd796b2f1c5">res</a> / 2) {</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_readtrap(%s): field &#39;nover&#39; may not exceed res/2&quot;</span>, desc);</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;  }</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  <span class="keywordflow">if</span> (readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a544d58cc06d73e0f73e464114f6e5318">rbw</a> &gt; 250) {</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_readtrap(%s): rBW cannot exceed +/- 250 kHz/FOV&quot;</span>, desc);</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  }</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  <span class="comment">/* Operator&#39;s error */</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  <span class="keywordflow">if</span> (readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#abfd94a01fc71278021802ca0d1e25e16">fov</a> &lt; minfov &amp;&amp; readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a6a2cc013660b66a4c7793c6e55bfcaa8">rampsampling</a> == 0) {</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: Please increase the FOV to %.1f [cm] or decrease the rBW&quot;</span>, desc, minfov / 10.0);</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  }</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  <span class="keywordflow">if</span> (abs(readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a>)) {</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    nreadpixels = readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#aac31eb68bff694554a182bd796b2f1c5">res</a> / 2 + abs(readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a>);</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    nreadpixels = readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#aac31eb68bff694554a182bd796b2f1c5">res</a>;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  }</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  <span class="keywordflow">if</span> (nreadpixels % 2) {</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_readtrap(%s): number of sampling points must be even (%d)&quot;</span>, desc, nreadpixels);</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  }</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  <span class="keywordflow">if</span> (readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a6a2cc013660b66a4c7793c6e55bfcaa8">rampsampling</a> == 1) { <span class="comment">/* rampsampling */</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="comment">/* Gradient area necessary to move one pixel in k-space in the read direction */</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    readpixelarea = <a class="code" href="_k_s_foundation_8h.html#aeb07c1278254f0a40622fbbe10566f57">ks_calc_fov2gradareapixel</a>(readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#abfd94a01fc71278021802ca0d1e25e16">fov</a>); <span class="comment">/* [(G/cm)*usec] */</span></div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="comment">/* Speed limit the readout (i.e. put a cap on the readout amplitude) based on the FOV and the chosen rBW */</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    ampmax_kspace_speedlimit = FMin(2, readpixelarea / tsp, ampmax);</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="comment">/* delay of ACQ start relative to the beginning of the attack ramp.</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="comment">       For rampsampled cases, this value should be at least one dwell time (tsp) */</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="keywordflow">if</span> (readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a13d3424b69abfaa66668757e06fed900">acqdelay</a> &lt; 2 * tsp) {</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;      readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a13d3424b69abfaa66668757e06fed900">acqdelay</a> = 2 * tsp;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    }</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a13d3424b69abfaa66668757e06fed900">acqdelay</a> = RUP_FACTOR(readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a13d3424b69abfaa66668757e06fed900">acqdelay</a>, 2);</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <span class="comment">/* gradient area before and after the acq window */</span></div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    nonacq_readarea = slewrate <span class="comment">/* [G/cm/usec] */</span> * (readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a13d3424b69abfaa66668757e06fed900">acqdelay</a>) * (readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a13d3424b69abfaa66668757e06fed900">acqdelay</a>) <span class="comment">/* [usec^2] */</span>; <span class="comment">/* from both sides of the readout */</span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="comment">/* required gradient area: gradient area needed during the acq window + nonacq_readarea */</span></div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a97ab43f6fd28920a42d987c8fec4afec">area</a> = (readpixelarea * nreadpixels) + nonacq_readarea;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__host_8c.html#ace858b7b1e7182259bcaa098147e5956">ks_eval_trap_constrained</a>(&amp;readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>, desc, ampmax_kspace_speedlimit, slewrate, 0) == FAILURE)</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;      <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <span class="keywordflow">if</span> (readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a> &gt; readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a13d3424b69abfaa66668757e06fed900">acqdelay</a>) {</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;      <span class="comment">/* rampsampling attempt ok, continue calculating area2center and time2center */</span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;      <span class="keywordflow">if</span> (readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a> &gt; 0) { <span class="comment">/* partial Fourier on the first part of the readout */</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a0c3ba07aac8b5f911ce918a97c7ebbc6">area2center</a> = readpixelarea * readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a> + nonacq_readarea / 2;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;      } <span class="keywordflow">else</span> { <span class="comment">/* Full Fourier, or partial Fourier on the last part of the readout */</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a0c3ba07aac8b5f911ce918a97c7ebbc6">area2center</a> = readpixelarea * readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#aac31eb68bff694554a182bd796b2f1c5">res</a> / 2 + nonacq_readarea / 2;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;      }</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;      <span class="comment">/* area = (s*t^2)/2 [G/cm/usec] * [usec^2] */</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;      <span class="keywordflow">if</span> (readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a0c3ba07aac8b5f911ce918a97c7ebbc6">area2center</a> &lt; slewrate * (readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a> * readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a> / 2.0)) {</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        <span class="comment">/* k-space center is on the attack ramp */</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#aa29afe5800d6b5d4be29e1da24c63caf">time2center</a> = (int) sqrt(readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a0c3ba07aac8b5f911ce918a97c7ebbc6">area2center</a> * 2.0 / slewrate);</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        <span class="keywordtype">float</span> arealeftonplateau = readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a0c3ba07aac8b5f911ce918a97c7ebbc6">area2center</a> - (readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a> * readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a> / 2.0);</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#aa29afe5800d6b5d4be29e1da24c63caf">time2center</a> = (int) readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a> + (arealeftonplateau / readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a>); <span class="comment">/* whole ramp + some plateau time */</span></div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;      }</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;      <span class="comment">/* round up the readout window time to the nearest multiple of &#39;2*tsp&#39; to always make filt.outputs even */</span></div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;      readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> = RUP_FACTOR(readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> - readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a13d3424b69abfaa66668757e06fed900">acqdelay</a> * 2, (<span class="keywordtype">int</span>) (2 * tsp));</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;      <span class="comment">/* update &#39;acqdelay&#39; due to this potential roundoff */</span></div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;      readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a13d3424b69abfaa66668757e06fed900">acqdelay</a> = (readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> - readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>) / 2;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;      readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a6a2cc013660b66a4c7793c6e55bfcaa8">rampsampling</a> = 0; <span class="comment">/* let&#39;s skip ramp sampling then (and be caught by the next non-rampsampled case) */</span></div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    }</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  } <span class="comment">/* rampsampling */</span></div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  <span class="keywordflow">if</span> (readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a6a2cc013660b66a4c7793c6e55bfcaa8">rampsampling</a> == 0) { <span class="comment">/* No rampsampling */</span></div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <span class="keywordflow">if</span> (desc[0] == <span class="charliteral">&#39; &#39;</span>) {</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;      <a class="code" href="_k_s_foundation__host_8c.html#a8efdbce2fbb4bf21a6fd8983fdd6d5c7">ks_init_trap</a>(&amp;readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>);</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_readtrap: desc (2nd arg) cannot begin with a space&quot;</span>);</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;      strncpy(readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, desc, <a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> - 1);</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;      readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>[<a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> - 1] = 0;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    }</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <span class="comment">/* Error if requested constraints cannot be fullfilled */</span></div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <span class="keywordflow">if</span> (readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#abfd94a01fc71278021802ca0d1e25e16">fov</a> &lt; minfov) {</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: %s - Please increase the FOV to %.1f [cm] or decrease the rBW&quot;</span>, __FUNCTION__, desc, minfov / 10.0);</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    }</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a> = ((float) (1.0 / (<a class="code" href="_k_s_foundation__host_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a> * tsp * 1e-6) * (10.0 / readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#abfd94a01fc71278021802ca0d1e25e16">fov</a>))); <span class="comment">/* [G/cm] */</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a> = RUP_GRD(readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a> / slewrate); <span class="comment">/* [usec] */</span></div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> = RUP_GRD(nreadpixels * tsp);</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    <span class="comment">/* adjust plateau time to account for padding */</span></div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> ramparea = readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a> * readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a> / 2.0;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> extradelay = RUP_GRD(FMax(2, readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a304cb284861ddcc08f2e4d24b3d30ff2">paddingarea</a> - ramparea, 0.0) / readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a>);</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">plateautime</a> = readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> + 2*extradelay; <span class="comment">/* [usec] */</span> <span class="comment">/* Nkx * dwell time */</span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> = readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">plateautime</a> + readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a> * 2; <span class="comment">/* [usec] */</span></div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a97ab43f6fd28920a42d987c8fec4afec">area</a> = (readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">plateautime</a> + readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a>) * readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a>; <span class="comment">/* rounding effects */</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <span class="comment">/* ACQ starts after the attack ramp */</span></div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a13d3424b69abfaa66668757e06fed900">acqdelay</a> = readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a> + extradelay;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> pixelstocenter = readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a> &gt; 0 ?</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;      readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a> : <span class="comment">/* partial Fourier on the first part of the readout */</span></div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;      readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#aac31eb68bff694554a182bd796b2f1c5">res</a>/2;  <span class="comment">/* Full Fourier, or partial Fourier on the last part of the readout */</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a0c3ba07aac8b5f911ce918a97c7ebbc6">area2center</a> = (readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a>/2 + tsp * pixelstocenter + extradelay)  * readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a>;</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#aa29afe5800d6b5d4be29e1da24c63caf">time2center</a> = readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a> + tsp * pixelstocenter + extradelay;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  } <span class="comment">/* no rampsampling */</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  <span class="comment">/* round up to nearest multiple of GRAD_UPDATE_TIME (4us) */</span></div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;  readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#aa29afe5800d6b5d4be29e1da24c63caf">time2center</a> = RUP_GRD(readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#aa29afe5800d6b5d4be29e1da24c63caf">time2center</a>);</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;  <span class="comment">/* setup acq window */</span></div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  <span class="comment">/* readtrap-&gt;acq.rbw is set &gt; 0 by the calling function */</span></div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a06d5868fa630d1c05faea3350dbf045c">KS_DESCRIPTION</a> read_description;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;  sprintf(read_description, <span class="stringliteral">&quot;%s.echo&quot;</span>, readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__host_8c.html#a255252279abfc7ffd48d45759033ea3e">ks_eval_read</a>(&amp;readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>, read_description) == FAILURE) {</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;  }</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;  <span class="comment">/* for rampsampling, create an omega waveform (for FOV shifts in the freq (read) direction for rampsampling) */</span></div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;  <span class="keywordflow">if</span> (readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a6a2cc013660b66a4c7793c6e55bfcaa8">rampsampling</a>) {</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#abd9ff216626c3fd76322a2a56dc606cc">omega</a> = readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>; <span class="comment">/* copy the shape of the readout */</span></div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#abd9ff216626c3fd76322a2a56dc606cc">omega</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a> = 1.0; <span class="comment">/* just unity value for conformance. It does not matter during scanning, since ks_scan_omegatrap_hz() ignores this value */</span></div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#abd9ff216626c3fd76322a2a56dc606cc">omega</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a97ab43f6fd28920a42d987c8fec4afec">area</a> = 0.0; <span class="comment">/* Omega area has no meaning */</span></div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    sprintf(readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#abd9ff216626c3fd76322a2a56dc606cc">omega</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, <span class="stringliteral">&quot;%s.omega&quot;</span>, readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#abd9ff216626c3fd76322a2a56dc606cc">omega</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> = 0;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  }</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;}</div><div class="ttc" id="struct_k_s___t_r_a_p_html_a878bb367b07dc7dfb5fef5728d2e5b1d"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">KS_TRAP::plateautime</a></div><div class="ttdeci">int plateautime</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:436</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a7c1c3b628e3f08dca4a169d80b7d6361"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a7c1c3b628e3f08dca4a169d80b7d6361">ks_calc_nearestbw</a></div><div class="ttdeci">float ks_calc_nearestbw(float bw)</div><div class="ttdoc">Round receiver bandwidth to nearest valid value</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3385</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aeb07c1278254f0a40622fbbe10566f57"><div class="ttname"><a href="_k_s_foundation_8h.html#aeb07c1278254f0a40622fbbe10566f57">ks_calc_fov2gradareapixel</a></div><div class="ttdeci">float ks_calc_fov2gradareapixel(float fov)</div><div class="ttdoc">Calculates the gradient area needed to move one pixel in k-space</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:279</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_afd953f31b866a09e0418967c2bf65a59"><div class="ttname"><a href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a></div><div class="ttdeci">#define KS_NOTSET</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:60</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a6ffabfee55fc92b35511d263092f6ea9"><div class="ttname"><a href="_k_s_foundation_8h.html#a6ffabfee55fc92b35511d263092f6ea9">ks_calc_minfov</a></div><div class="ttdeci">float ks_calc_minfov(float ampmax, int tsp)</div><div class="ttdoc">Calculates the minimum readout FOV</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:252</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a8efdbce2fbb4bf21a6fd8983fdd6d5c7"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a8efdbce2fbb4bf21a6fd8983fdd6d5c7">ks_init_trap</a></div><div class="ttdeci">void ks_init_trap(KS_TRAP *trap)</div><div class="ttdoc">Resets a KS_TRAP sequence object to its default value (KS_INIT_TRAP)</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:45</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_abfd94a01fc71278021802ca0d1e25e16"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#abfd94a01fc71278021802ca0d1e25e16">KS_READTRAP::fov</a></div><div class="ttdeci">float fov</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1425</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_ace858b7b1e7182259bcaa098147e5956"><div class="ttname"><a href="_k_s_foundation__host_8c.html#ace858b7b1e7182259bcaa098147e5956">ks_eval_trap_constrained</a></div><div class="ttdeci">STATUS ks_eval_trap_constrained(KS_TRAP *trap, const char *const desc, float ampmax, float slewrate, int minduration)</div><div class="ttdoc">Sets up a trapezoid using a KS_TRAP sequence object with gradient constraints specified as input argu...</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:276</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a544d58cc06d73e0f73e464114f6e5318"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a544d58cc06d73e0f73e464114f6e5318">KS_READ::rbw</a></div><div class="ttdeci">float rbw</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:584</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">KS_READTRAP::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1435</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_a304cb284861ddcc08f2e4d24b3d30ff2"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#a304cb284861ddcc08f2e4d24b3d30ff2">KS_READTRAP::paddingarea</a></div><div class="ttdeci">float paddingarea</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1430</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a2875ace95558531062d08465b2bcc282"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a></div><div class="ttdeci">float GAM</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aacb2fe1d83c45e8d0525f363bdd6b8a6"><div class="ttname"><a href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a></div><div class="ttdeci">#define KS_DESCRIPTION_LENGTH</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:112</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_abd9ff216626c3fd76322a2a56dc606cc"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#abd9ff216626c3fd76322a2a56dc606cc">KS_READTRAP::omega</a></div><div class="ttdeci">KS_TRAP omega</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1436</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#aac31eb68bff694554a182bd796b2f1c5">KS_READTRAP::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1426</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a955f51280beb0915d42853ad14eee700"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a955f51280beb0915d42853ad14eee700">ks_calc_bw2tsp</a></div><div class="ttdeci">int ks_calc_bw2tsp(float bw)</div><div class="ttdoc">Convert receiver bandwidth to dwell time</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3367</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a255252279abfc7ffd48d45759033ea3e"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a255252279abfc7ffd48d45759033ea3e">ks_eval_read</a></div><div class="ttdeci">STATUS ks_eval_read(KS_READ *read, const char *const desc)</div><div class="ttdoc">Sets up a data acquisition window using a KS_READ sequence object</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:230</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_READ::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:583</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a97ab43f6fd28920a42d987c8fec4afec"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a97ab43f6fd28920a42d987c8fec4afec">KS_TRAP::area</a></div><div class="ttdeci">float area</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:434</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ab508ded41392ee86a2a619d3e93d2373"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">KS_TRAP::amp</a></div><div class="ttdeci">float amp</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:433</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">KS_TRAP::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:432</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_a29cf05caf131eb2c5915a41b18af16d0"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#a29cf05caf131eb2c5915a41b18af16d0">KS_READTRAP::nover</a></div><div class="ttdeci">int nover</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1428</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_a6a2cc013660b66a4c7793c6e55bfcaa8"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#a6a2cc013660b66a4c7793c6e55bfcaa8">KS_READTRAP::rampsampling</a></div><div class="ttdeci">int rampsampling</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1427</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_ac359c54a7c5f9e9a94105b3c0d0be9ea"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">KS_READTRAP::acq</a></div><div class="ttdeci">KS_READ acq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1423</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_TRAP::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:437</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a06d5868fa630d1c05faea3350dbf045c"><div class="ttname"><a href="_k_s_foundation_8h.html#a06d5868fa630d1c05faea3350dbf045c">KS_DESCRIPTION</a></div><div class="ttdeci">char KS_DESCRIPTION[KS_DESCRIPTION_LENGTH]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:178</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_aa29afe5800d6b5d4be29e1da24c63caf"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#aa29afe5800d6b5d4be29e1da24c63caf">KS_READTRAP::time2center</a></div><div class="ttdeci">int time2center</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1434</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_a0c3ba07aac8b5f911ce918a97c7ebbc6"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#a0c3ba07aac8b5f911ce918a97c7ebbc6">KS_READTRAP::area2center</a></div><div class="ttdeci">float area2center</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1433</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_a13d3424b69abfaa66668757e06fed900"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#a13d3424b69abfaa66668757e06fed900">KS_READTRAP::acqdelay</a></div><div class="ttdeci">int acqdelay</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1429</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_acbc719dc4e48c2a2df0447875e4348ca"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">KS_TRAP::ramptime</a></div><div class="ttdeci">int ramptime</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:435</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0e06bd2e4433a2b508c7610d7056050f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0e06bd2e4433a2b508c7610d7056050f">&#9670;&nbsp;</a></span>ks_eval_readtrap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_readtrap </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a> *&#160;</td>
          <td class="paramname"><em>readtrap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const&#160;</td>
          <td class="paramname"><em>desc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets up an acquisition window with a trapezoid with preset gradient constraints</h4>
</p>
<p>This is a wrapper function to <a class="el" href="_k_s_foundation_8h.html#adbc5d161b21228ab4d53c03911916961" title="Sets up an acquisition window with a trapezoid, subject to gradient constraints specified as input ar...">ks_eval_readtrap_constrained()</a> with gradient constraints set to allow this <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> to simultaneously be played on XGRAD, YGRAD, ZGRAD for any slice angulation. This is the generic and safest configuration, but for readouts with small FOV and high rBW, the gradient limits may be reached, especially for double oblique slices. See <a class="el" href="_k_s_foundation_8h.html#adbc5d161b21228ab4d53c03911916961" title="Sets up an acquisition window with a trapezoid, subject to gradient constraints specified as input ar...">ks_eval_readtrap_constrained()</a> for details on fields that need to be set before calling this function.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">readtrap</td><td>Pointer to the <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> object to be set up </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">desc</td><td>A description (text string) of the <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> object. This description is used for pulse sequence generation (seen in the file generated by <em>TimeHist</em> in <em>MGD Sim/WTools</em>) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                                                                        {</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__host_8c.html#a0a1d9107de6b9e38a08ad33a76ea6cf5">ks_eval_readtrap_constrained</a>(readtrap, desc,</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                                      <a class="code" href="_k_s_foundation_8h.html#a5c919c547ee396b18069ed505c695139">ks_syslimits_ampmax</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>), <a class="code" href="_k_s_foundation_8h.html#a712d215e449900b4fc566fefff51b4e9">ks_syslimits_slewrate</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>));</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_a5c919c547ee396b18069ed505c695139"><div class="ttname"><a href="_k_s_foundation_8h.html#a5c919c547ee396b18069ed505c695139">ks_syslimits_ampmax</a></div><div class="ttdeci">float ks_syslimits_ampmax(LOG_GRAD loggrd)</div><div class="ttdoc">Returns the maximum gradient amplitude that can be used on all gradient boards simultaneously</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:163</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a0a1d9107de6b9e38a08ad33a76ea6cf5"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a0a1d9107de6b9e38a08ad33a76ea6cf5">ks_eval_readtrap_constrained</a></div><div class="ttdeci">STATUS ks_eval_readtrap_constrained(KS_READTRAP *readtrap, const char *const desc, float ampmax, float slewrate)</div><div class="ttdoc">Sets up an acquisition window with a trapezoid, subject to gradient constraints specified as input ar...</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:411</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a712d215e449900b4fc566fefff51b4e9"><div class="ttname"><a href="_k_s_foundation_8h.html#a712d215e449900b4fc566fefff51b4e9">ks_syslimits_slewrate</a></div><div class="ttdeci">float ks_syslimits_slewrate(LOG_GRAD loggrd)</div><div class="ttdoc">Returns the maximum slewrate that can be used on all gradient boards simultaneously</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:196</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0b3f7a7cc038b40ea4fd457751acd4ff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0b3f7a7cc038b40ea4fd457751acd4ff">&#9670;&nbsp;</a></span>ks_eval_readtrap2()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_readtrap2 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a> *&#160;</td>
          <td class="paramname"><em>readtrap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const&#160;</td>
          <td class="paramname"><em>desc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets up an acquisition window with a trapezoid with preset gradient constraints</h4>
</p>
<p>This is a wrapper function to <a class="el" href="_k_s_foundation_8h.html#adbc5d161b21228ab4d53c03911916961" title="Sets up an acquisition window with a trapezoid, subject to gradient constraints specified as input ar...">ks_eval_readtrap_constrained()</a> with gradient constraints set to allow this <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> to simultaneously be played on up to two (2) logical gradients for any slice angulation. For double oblique slice angulations, this function will allow for smaller FOVs and higher rBWs than <a class="el" href="_k_s_foundation_8h.html#a0e06bd2e4433a2b508c7610d7056050f" title="Sets up an acquisition window with a trapezoid with preset gradient constraints">ks_eval_readtrap()</a>.</p>
<p>See <a class="el" href="_k_s_foundation_8h.html#adbc5d161b21228ab4d53c03911916961" title="Sets up an acquisition window with a trapezoid, subject to gradient constraints specified as input ar...">ks_eval_readtrap_constrained()</a> for details on fields that need to be set before calling this function.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">readtrap</td><td>Pointer to the <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> object to be set up </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">desc</td><td>A description (text string) of the <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> object. This description is used for pulse sequence generation (seen in the file generated by <em>TimeHist</em> in <em>MGD Sim/WTools</em>) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;                                                                         {</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__host_8c.html#a0a1d9107de6b9e38a08ad33a76ea6cf5">ks_eval_readtrap_constrained</a>(readtrap, desc,</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;                                      <a class="code" href="_k_s_foundation_8h.html#a4b3a3095702bf551f318ef9f03ff3403">ks_syslimits_ampmax2</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>), <a class="code" href="_k_s_foundation_8h.html#a53d792432e1fd99fa597314576fa9e49">ks_syslimits_slewrate2</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>));</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;}</div><div class="ttc" id="_k_s_foundation__host_8c_html_a0a1d9107de6b9e38a08ad33a76ea6cf5"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a0a1d9107de6b9e38a08ad33a76ea6cf5">ks_eval_readtrap_constrained</a></div><div class="ttdeci">STATUS ks_eval_readtrap_constrained(KS_READTRAP *readtrap, const char *const desc, float ampmax, float slewrate)</div><div class="ttdoc">Sets up an acquisition window with a trapezoid, subject to gradient constraints specified as input ar...</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:411</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4b3a3095702bf551f318ef9f03ff3403"><div class="ttname"><a href="_k_s_foundation_8h.html#a4b3a3095702bf551f318ef9f03ff3403">ks_syslimits_ampmax2</a></div><div class="ttdeci">float ks_syslimits_ampmax2(LOG_GRAD loggrd)</div><div class="ttdoc">Returns the maximum gradient amplitude that can be used on two gradient boards simultaneously</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:167</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a53d792432e1fd99fa597314576fa9e49"><div class="ttname"><a href="_k_s_foundation_8h.html#a53d792432e1fd99fa597314576fa9e49">ks_syslimits_slewrate2</a></div><div class="ttdeci">float ks_syslimits_slewrate2(LOG_GRAD loggrd)</div><div class="ttdoc">Returns the maximum slewrate that can be used on two gradient boards simultaneously</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:200</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a203432ea0305ff401753b90d25e41b13"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a203432ea0305ff401753b90d25e41b13">&#9670;&nbsp;</a></span>ks_eval_readtrap1()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_readtrap1 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a> *&#160;</td>
          <td class="paramname"><em>readtrap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const&#160;</td>
          <td class="paramname"><em>desc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets up an acquisition window with a trapezoid with preset gradient constraints</h4>
</p>
<p>This is a wrapper function to <a class="el" href="_k_s_foundation_8h.html#adbc5d161b21228ab4d53c03911916961" title="Sets up an acquisition window with a trapezoid, subject to gradient constraints specified as input ar...">ks_eval_readtrap_constrained()</a> with gradient constraints set to allow this <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> to only be played out on one (1) logical gradient at a time. No gradient may be active on another board while this trapezoid is played out. For double oblique slice angulations, this function will allow for smaller FOVs and higher rBWs than <a class="el" href="_k_s_foundation_8h.html#a0e06bd2e4433a2b508c7610d7056050f" title="Sets up an acquisition window with a trapezoid with preset gradient constraints">ks_eval_readtrap()</a> and <a class="el" href="_k_s_foundation_8h.html#a0b3f7a7cc038b40ea4fd457751acd4ff" title="Sets up an acquisition window with a trapezoid with preset gradient constraints">ks_eval_readtrap2()</a>. See <a class="el" href="_k_s_foundation_8h.html#adbc5d161b21228ab4d53c03911916961" title="Sets up an acquisition window with a trapezoid, subject to gradient constraints specified as input ar...">ks_eval_readtrap_constrained()</a> for details on fields that need to be set before calling this function.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">readtrap</td><td>Pointer to the <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> object to be set up </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">desc</td><td>A description (text string) of the <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> object. This description is used for pulse sequence generation (seen in the file generated by <em>TimeHist</em> in <em>MGD Sim/WTools</em>) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;                                                                         {</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__host_8c.html#a0a1d9107de6b9e38a08ad33a76ea6cf5">ks_eval_readtrap_constrained</a>(readtrap, desc,</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                                      <a class="code" href="_k_s_foundation_8h.html#a431729c0ecf331b33d84db72a80debaf">ks_syslimits_ampmax1</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>), <a class="code" href="_k_s_foundation_8h.html#aaeea7c06ce455978cce287cf28c22a4f">ks_syslimits_slewrate1</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>));</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_aaeea7c06ce455978cce287cf28c22a4f"><div class="ttname"><a href="_k_s_foundation_8h.html#aaeea7c06ce455978cce287cf28c22a4f">ks_syslimits_slewrate1</a></div><div class="ttdeci">float ks_syslimits_slewrate1(LOG_GRAD loggrd)</div><div class="ttdoc">Returns the maximum slewrate that can be used on one gradient board at a time</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:204</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a0a1d9107de6b9e38a08ad33a76ea6cf5"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a0a1d9107de6b9e38a08ad33a76ea6cf5">ks_eval_readtrap_constrained</a></div><div class="ttdeci">STATUS ks_eval_readtrap_constrained(KS_READTRAP *readtrap, const char *const desc, float ampmax, float slewrate)</div><div class="ttdoc">Sets up an acquisition window with a trapezoid, subject to gradient constraints specified as input ar...</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:411</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a431729c0ecf331b33d84db72a80debaf"><div class="ttname"><a href="_k_s_foundation_8h.html#a431729c0ecf331b33d84db72a80debaf">ks_syslimits_ampmax1</a></div><div class="ttdeci">float ks_syslimits_ampmax1(LOG_GRAD loggrd)</div><div class="ttdoc">Returns the maximum gradient amplitude that can be used on all gradient boards simultaneously</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:171</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a92f07eb83de68841171693b2041cee66"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a92f07eb83de68841171693b2041cee66">&#9670;&nbsp;</a></span>ks_eval_phaseviewtable()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_eval_phaseviewtable </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *&#160;</td>
          <td class="paramname"><em>phaser</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets up which lines to acquire for a <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object</h4>
</p>
<p>This function sets the following fields in a <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object</p><ol type="1">
<li><code>.numlinestoacq</code>: Number of phase encoding lines to acquire</li>
<li><code>.linetoacq[]</code>: Array, where the first <code>.numlinestoacq</code> elements denotes <em>which</em> lines to acquire with indices corresponding to a fully sampled k-space. The top-most line has index 0 and the bottom-most line has index (<code>.res</code>-1).</li>
</ol>
<p>These two fields are set based on <code>.res</code>, <code>.nover</code>, <code>.nacslines</code>, and <code>.R</code> in the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object. If <code>.nover</code> &lt; 0, partial Fourier will be set up, but with flipped k-space coverage</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">phaser</td><td>Pointer to the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object to be set up </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;                                               {</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;  <span class="keywordtype">int</span> i, index, firstline, lastline, halfacslines;</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;  <span class="keywordtype">short</span> viewonflag[1025];</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;  <span class="comment">/* reset arrays */</span></div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="_k_s_foundation_8h.html#ab48aef2b031ba0ae2572616c42e6890c">KS_MAX_PHASEDYN</a>; i++) {</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[i] = 0;</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    viewonflag[i] = 0;</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  }</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;  <span class="keywordflow">if</span> (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a> == 0) {</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    firstline = 0;</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    lastline = phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a> - 1;</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a> &gt; 0) { <span class="comment">/* fractional ky upper half */</span></div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    firstline = 0;</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    lastline = phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a> / 2 + phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a> - 1;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    firstline = phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a> / 2 + phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a>; <span class="comment">/* NOTE: phase-&gt;nover here negative ! */</span></div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    lastline = phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a> - 1;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;  }</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;  <span class="keywordflow">if</span> ((lastline - firstline + 1) % 2) {</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    <span class="comment">/* /vobs/vre/recon/rcapps/rc_filter.cpp requires that rhdayres is odd (according to ARC.e) */</span></div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: #k-space lines *spanned* must be even&quot;</span>,__FUNCTION__);</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;  }</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;  <span class="comment">/* lower half of k-space: mark the lines to acquire with &#39;1&#39; */</span></div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;  halfacslines = phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a4762b9a6307f0223b3d1dfde7e8ddce8">nacslines</a> / 2;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;  <span class="keywordflow">for</span> (i = (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a> / 2); i &lt;= lastline; i++) {</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    <span class="keywordflow">if</span> (((i + 1) % phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a>) == 1 || phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a> == 1) {</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;      viewonflag[i] = 1;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (halfacslines &gt; 0) {</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;      viewonflag[i] = 1;</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      halfacslines--;</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    }</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;  }</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;  <span class="comment">/* upper half of k-space: mark the lines to acquire with &#39;1&#39; */</span></div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;  halfacslines = phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a4762b9a6307f0223b3d1dfde7e8ddce8">nacslines</a> - (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a4762b9a6307f0223b3d1dfde7e8ddce8">nacslines</a> / 2) + halfacslines;</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;  <span class="keywordflow">for</span> (i = (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a> / 2) - 1; i &gt;= 0; i--) {</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    <span class="keywordflow">if</span> (((i + 1) % phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a>) == 1 || phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a> == 1) {</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;      viewonflag[i] = 1;</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (halfacslines &gt; 0) {</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;      viewonflag[i] = 1;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;      halfacslines--;</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    }</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;  }</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;  <span class="comment">/* sweep kspace linearly and save the line numbers to acquire.</span></div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;<span class="comment">     firstline/lastline handles full/partial Fourier */</span></div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  index = 0;</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;  <span class="keywordflow">for</span> (i = firstline; i &lt;= lastline; i++) {</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    <span class="keywordflow">if</span> (viewonflag[i]) {</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;      phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[index++] = i;</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    }</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;  }</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;  phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a> = index;</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;}</div><div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a3d90133d3051fbc4816d02efd9566d8e"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">KS_PHASER::R</a></div><div class="ttdeci">int R</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1529</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">KS_PHASER::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1527</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a4762b9a6307f0223b3d1dfde7e8ddce8"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a4762b9a6307f0223b3d1dfde7e8ddce8">KS_PHASER::nacslines</a></div><div class="ttdeci">int nacslines</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1530</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a09b1a7dc77a7cf8c4e8421a23608a42a"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">KS_PHASER::numlinestoacq</a></div><div class="ttdeci">int numlinestoacq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1532</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a090fbced834ec878a08eadc4f829b8a3"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">KS_PHASER::linetoacq</a></div><div class="ttdeci">int linetoacq[KS_MAX_PHASEDYN]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1533</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a29cf05caf131eb2c5915a41b18af16d0"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">KS_PHASER::nover</a></div><div class="ttdeci">int nover</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1528</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab48aef2b031ba0ae2572616c42e6890c"><div class="ttname"><a href="_k_s_foundation_8h.html#ab48aef2b031ba0ae2572616c42e6890c">KS_MAX_PHASEDYN</a></div><div class="ttdeci">#define KS_MAX_PHASEDYN</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:118</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7ee5e825257b0e249ac013ba61413755"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7ee5e825257b0e249ac013ba61413755">&#9670;&nbsp;</a></span>ks_eval_phaser_adjustres()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_phaser_adjustres </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *&#160;</td>
          <td class="paramname"><em>phaser</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const&#160;</td>
          <td class="paramname"><em>desc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Adjusts the phase encoding resolution to the nearest valid value</h4>
</p>
<p>Phase resolution must be divisible by <code>.R</code> and be even, and there are additional requirements for partial ky Fourier scans. Moreover, for parallel imaging using ASSET, only the acquired lines are stored in the data (compressed BAM), resulting in an R times lower value for rhnframes.</p>
<p>Here are the rules:</p>
<ul>
<li>Resolution (and overscan) choice must guarantee that (rhhnover + rhnframes) is an even number</li>
<li>Full Fourier, ASSET:<ul>
<li>rhnframes = res / R</li>
<li>rhhnover = 0</li>
<li>=&gt; res / R must be even</li>
</ul>
</li>
<li>Partial Fourier:<ul>
<li>rhnframes = (res / 2) / R</li>
<li>rhhnover = overscans/R</li>
<li>=&gt; res / (2 * R) and (res / (2 * R) + overscans) must be even<br />
<ul>
<li>overscans/R and (res/2)/R must be integers</li>
<li>=&gt; res must be divisible by (4 * R)</li>
<li>=&gt; overscans must be divisible by (2 * R)</li>
</ul>
</li>
</ul>
</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">phaser</td><td>Pointer to <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">desc</td><td>A description (text string) of the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object, only used for error msg </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;                                                                            {</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;  <span class="keywordtype">int</span> kspacelines_noacc;</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;  <span class="keywordflow">if</span> (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a> == 0)</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    kspacelines_noacc = phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a>;</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    kspacelines_noacc = phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a> / 2 + abs(phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a>);</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;  <span class="keywordflow">if</span> (kspacelines_noacc &lt; phaser-&gt;R) {</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    <span class="comment">/* Number of k-space lines less than R */</span></div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s(%s): R cannot exceed %d&quot;</span>, __FUNCTION__, desc, kspacelines_noacc);</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (kspacelines_noacc == phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a>) {</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;  <span class="comment">/* Number of k-space lines equal to R. Used for EPI when R is used as shots to produce ETL = 1.</span></div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;<span class="comment">    Just make sure that res is even */</span></div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    <span class="keywordflow">if</span> (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a> % 2) {</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s(%s): res must be even&quot;</span>, __FUNCTION__, desc);</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;      <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    }</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;  }</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;  <span class="keywordflow">if</span> (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a> != 0) {</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    <span class="comment">/* partial Fourier */</span></div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> sign_nover = (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a> &gt;= 0) ? 1 : -1;</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a> = abs(phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a>);</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <span class="keywordtype">int</span> invalidnover = TRUE;</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    <span class="comment">/* round res and nover to nearest valid values */</span></div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    <span class="keywordflow">if</span> (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a> % 2) { <span class="comment">/* R is odd */</span></div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;      phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a>   = RUP_FACTOR(phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a>   - 2 * phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a>, 4 * phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a>);</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;      phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a> = RUP_FACTOR(phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a> - phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a>, 2 * phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a>) * sign_nover;</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;      invalidnover = phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a> &lt; (2 * phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a>) || phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a> &gt; (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a> / 2);</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    } <span class="keywordflow">else</span> { <span class="comment">/* R is even */</span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;      phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a>   = RUP_FACTOR(phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a>   - phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a>, 2 * phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a>);</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;      phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a> = RUP_FACTOR(phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a> - phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a>/2, phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a>) * sign_nover;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;      invalidnover = phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a> &lt; phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a> || phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a> &gt; (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a> / 2);</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    }</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    <span class="keywordflow">if</span> (invalidnover) {</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s(%s): Valid #overscans not found&quot;</span>, __FUNCTION__, desc);</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    }</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    <span class="comment">/* full Fourier */</span></div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a> = RUP_FACTOR(phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a> - phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a>, 2 * phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a>);</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;  }</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;}</div><div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a3d90133d3051fbc4816d02efd9566d8e"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">KS_PHASER::R</a></div><div class="ttdeci">int R</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1529</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">KS_PHASER::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1527</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a29cf05caf131eb2c5915a41b18af16d0"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">KS_PHASER::nover</a></div><div class="ttdeci">int nover</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1528</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a13aea1e02502f8276373928c87d0da3f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a13aea1e02502f8276373928c87d0da3f">&#9670;&nbsp;</a></span>ks_eval_phaser_setaccel()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_phaser_setaccel </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *&#160;</td>
          <td class="paramname"><em>phaser</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>min_acslines</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>R</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>[ks_eval_phaser_setaccel description] </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">phaser</td><td>Pointer to <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">min_acslines</td><td>Minimum # of ACS lines </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">R</td><td>(floating point) acceleration (taken e.g. from the UI <code>opaccel_ph_stride</code>) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;                                                                             {</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;  <span class="keywordflow">if</span> (R &lt;= 1.0) {</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a> = 1.0;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a4762b9a6307f0223b3d1dfde7e8ddce8">nacslines</a> = 0;</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;  }</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;  <span class="comment">/* Get integer acceleration and store the Rfraction for ARC mode */</span></div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;  <span class="keywordtype">double</span> Rfraction = ceil(R) - R;</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;  <span class="keywordflow">if</span> (Rfraction &gt; 0.9999) { <span class="comment">/* handle roundoff issues for e.g. R=2.0000001 */</span></div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    Rfraction = 0.0;</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;  }</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;  phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a> = floor(R + Rfraction + 0.5); <span class="comment">/* round-up R to nearest integer */</span></div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;  <span class="keywordflow">if</span> (min_acslines == 0) {</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    <span class="comment">/* ASSET mode */</span></div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    <span class="comment">/* phaser.nacslines = 0 triggers ASSET scan mode in GEReq_predownload_setrecon_accel() */</span></div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a4762b9a6307f0223b3d1dfde7e8ddce8">nacslines</a> = 0;</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    <span class="comment">/* ARC mode */</span></div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    <span class="keywordtype">double</span> totlines_spanned = (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a> != 0) ? (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a> / 2 + abs(phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a>)) : phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a>;</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    <span class="keywordtype">double</span> acqlines_R       = totlines_spanned / phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a>;</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    <span class="keywordtype">double</span> acqlines_floorR  = totlines_spanned / FMax(2, 1.0, floor(R));</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;    <span class="comment">/* adapt #acs lines based on the fraction of the acceleration factor, but never go below min_acslines */</span></div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a4762b9a6307f0223b3d1dfde7e8ddce8">nacslines</a> = IMax(2, (<span class="keywordtype">int</span>) ((acqlines_floorR - acqlines_R) * Rfraction), min_acslines);</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;  }</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;}</div><div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a3d90133d3051fbc4816d02efd9566d8e"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">KS_PHASER::R</a></div><div class="ttdeci">int R</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1529</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">KS_PHASER::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1527</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a4762b9a6307f0223b3d1dfde7e8ddce8"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a4762b9a6307f0223b3d1dfde7e8ddce8">KS_PHASER::nacslines</a></div><div class="ttdeci">int nacslines</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1530</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a29cf05caf131eb2c5915a41b18af16d0"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">KS_PHASER::nover</a></div><div class="ttdeci">int nover</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1528</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af0032a7ae290e65a958fa32c590d0fbf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af0032a7ae290e65a958fa32c590d0fbf">&#9670;&nbsp;</a></span>ks_eval_phaser_constrained()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_phaser_constrained </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *&#160;</td>
          <td class="paramname"><em>phaser</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const&#160;</td>
          <td class="paramname"><em>desc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>ampmax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>slewrate</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>minplateautime</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets up a trapezoid for phase encoding, subject to gradient constraints specified as input arguments</h4>
</p>
<p>Before calling this function, the following fields in <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> must be set up:</p><ol type="1">
<li><code>.fov</code>: The desired image Field-of-View (FOV) in [mm] along the sequence board one intends to place the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> on (typically YGRAD, for 3D also ZGRAD)</li>
<li><code>.res</code>: The number of pixels within the FOV</li>
<li><code>.nover</code>: Number of 'overscans'. If 0, a full-Fourier k-space will be set up. If &gt; 0, partial Fourier will be set up (shorter scan time) where <code>.nover</code> number of extra k-space lines beyond <code>.res/2</code>. If &lt; 0, partial Fourier will be set up, but with flipped k-space coverage. The total number of samples will be <code>.res/2 + abs(.nover)</code>. Absolute values of <code>.nover</code> between 1 and about 16 should be avoided since half Fourier reconstruction methods will likely have difficulties</li>
<li><code>.R</code>: The parallel imaging acceleration factor</li>
<li><code>.nacslines</code>: If <code>.R &gt; 1</code>, the value of <code>.nacslines</code> is the number of calibration lines around k-space center for parallel imaging calibration</li>
<li><code>.areaoffset</code>: It is possible to embed a static gradient area in the phase encoding functionality of <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a>. This is useful for 3D imaging, where the area needed for the rephaser for the slice select gradient can be put into <code>.areaoffset</code>. This makes the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> to act as both slice rephaser and slice phase encoding gradient, which can shorten TE</li>
</ol>
<p>If the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object is initialized with KS_INIT_PHASER, <code>.nover</code>, <code>.nacslines</code> and <code>.areaoffset</code> will be zero, and <code>.R</code> will be 1 (steps 3-6 can be skipped)</p>
<p>Based on the information in the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object, <a class="el" href="_k_s_foundation_8h.html#af0032a7ae290e65a958fa32c590d0fbf" title="Sets up a trapezoid for phase encoding, subject to gradient constraints specified as input arguments...">ks_eval_phaser_constrained()</a> will set up the <code>.grad</code> trapezoid (<a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a>). By internally calling <a class="el" href="_k_s_foundation_8h.html#a92f07eb83de68841171693b2041cee66" title="Sets up which lines to acquire for a KS_PHASER object">ks_eval_phaseviewtable()</a>, <code>.numlinestoacq</code>, and the array <code>.linetoacq[]</code> are also set up. The field <code>.numlinestoacq</code> is an integer corresponding to the actual number of lines to acquire, and also the number of elements to read in <code>.linetoacq[]</code>, containing the complete list of phase encoding lines to acquire (honoring partial Fourier, parallel imaging acceleration and ACS lines)</p>
<p>If <a class="el" href="_k_s_foundation_8h.html#af0032a7ae290e65a958fa32c590d0fbf" title="Sets up a trapezoid for phase encoding, subject to gradient constraints specified as input arguments...">ks_eval_phaser_constrained()</a> returns FAILURE, one must also make sure <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code> returns FAILURE, otherwise an error message created in <a class="el" href="_k_s_foundation_8h.html#af0032a7ae290e65a958fa32c590d0fbf" title="Sets up a trapezoid for phase encoding, subject to gradient constraints specified as input arguments...">ks_eval_phaser_constrained()</a> will not be seen in the UI</p>
<p>There are three wrapper functions to this function (<a class="el" href="_k_s_foundation_8h.html#acc45c24d1996acd3d95ae2866c5ffb2b" title="Sets up an acquisition window with a trapezoid with preset gradient constraints">ks_eval_phaser()</a>, <a class="el" href="_k_s_foundation_8h.html#a89b964cc50ce19bc364370f56b143309" title="Sets up an acquisition window with a trapezoid with preset gradient constraints">ks_eval_phaser1()</a>, <a class="el" href="_k_s_foundation_8h.html#a1977830e4c131a769f095e386ee372f6" title="Sets up an acquisition window with a trapezoid with preset gradient constraints">ks_eval_phaser2()</a>) that have reduced number of input arguments, and calls <a class="el" href="_k_s_foundation_8h.html#af0032a7ae290e65a958fa32c590d0fbf" title="Sets up a trapezoid for phase encoding, subject to gradient constraints specified as input arguments...">ks_eval_phaser_constrained()</a> with different preset gradient constraints. <a class="el" href="_k_s_foundation_8h.html#acc45c24d1996acd3d95ae2866c5ffb2b" title="Sets up an acquisition window with a trapezoid with preset gradient constraints">ks_eval_phaser()</a> makes fewest assumptions, making it the most general choice</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">phaser</td><td>Pointer to the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object to be set up </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">desc</td><td>A description (text string) of the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object. This description is used for pulse sequence generation (seen in the file generated by <em>TimeHist</em> in <em>MGD Sim/WTools</em>) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ampmax</td><td>The maximum allowed gradient amplitude ([G/cm]) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">slewrate</td><td>The maximum allowed slewrate ([(G/cm) / us]). Value of 0.01 corresponds to 100 mT/m/s </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">minplateautime</td><td>The minimum plateau time of the trapezoid ([us]) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;                                                                                 {</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;  <span class="keywordtype">float</span> phasepixelarea;</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#a8efdbce2fbb4bf21a6fd8983fdd6d5c7">ks_init_trap</a>(&amp;phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>);</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;  <span class="keywordflow">if</span> (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#abfd94a01fc71278021802ca0d1e25e16">fov</a> &lt; 5 || phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#abfd94a01fc71278021802ca0d1e25e16">fov</a> &gt; 600) {</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s(%s): field &#39;fov&#39; must be in the range 5-600 mm&quot;</span>, __FUNCTION__, phasername);</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;  }</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;  <span class="comment">/* adjust res and possibly nover to allow both ARC and ASSET scans with full and partial ky Fourier */</span></div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__host_8c.html#ae79ff3dee07d38c8a4b637e05e49214d">ks_eval_phaser_adjustres</a>(phaser, phasername) == FAILURE) {</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;  }</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;  phasepixelarea = <a class="code" href="_k_s_foundation_8h.html#aeb07c1278254f0a40622fbbe10566f57">ks_calc_fov2gradareapixel</a>(phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#abfd94a01fc71278021802ca0d1e25e16">fov</a>); <span class="comment">/* [(G/cm)*usec] */</span></div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;  <span class="comment">/* area required to reach the outermost phase encoding step (incl. areaoffset)</span></div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;<span class="comment">  N.B.: The *sign* of the area is controlled in scan using ks_scan_phaser_toline(), hence on HOST all phase encoding gradient will be positive, unlike TGT */</span></div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;  phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a97ab43f6fd28920a42d987c8fec4afec">area</a> = ((phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a> - 1.0) / 2.0) * phasepixelarea + fabs(phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aad774d0423b06e30276673c8100a8ade">areaoffset</a>); <span class="comment">/* .areaoffset is used in 3D imaging to embed e.g. a slice sel. rephaser in the phase encoding gradient */</span></div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;  <span class="comment">/* setup phaser trap */</span></div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;  <span class="keywordflow">if</span> (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a97ab43f6fd28920a42d987c8fec4afec">area</a> != 0.0) {</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__host_8c.html#ace858b7b1e7182259bcaa098147e5956">ks_eval_trap_constrained</a>(&amp;phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>, phasername, ampmax, slewrate, minduration) == FAILURE)</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;      <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;  }</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;  <span class="comment">/* setup phaser-&gt;linetoacq[] */</span></div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#a92f07eb83de68841171693b2041cee66">ks_eval_phaseviewtable</a>(phaser);</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;}</div><div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">KS_PHASER::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1527</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">KS_PHASER::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1525</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aeb07c1278254f0a40622fbbe10566f57"><div class="ttname"><a href="_k_s_foundation_8h.html#aeb07c1278254f0a40622fbbe10566f57">ks_calc_fov2gradareapixel</a></div><div class="ttdeci">float ks_calc_fov2gradareapixel(float fov)</div><div class="ttdoc">Calculates the gradient area needed to move one pixel in k-space</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:279</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_ae79ff3dee07d38c8a4b637e05e49214d"><div class="ttname"><a href="_k_s_foundation__host_8c.html#ae79ff3dee07d38c8a4b637e05e49214d">ks_eval_phaser_adjustres</a></div><div class="ttdeci">STATUS ks_eval_phaser_adjustres(KS_PHASER *phaser, const char *const desc)</div><div class="ttdoc">Adjusts the phase encoding resolution to the nearest valid value</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:687</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a8efdbce2fbb4bf21a6fd8983fdd6d5c7"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a8efdbce2fbb4bf21a6fd8983fdd6d5c7">ks_init_trap</a></div><div class="ttdeci">void ks_init_trap(KS_TRAP *trap)</div><div class="ttdoc">Resets a KS_TRAP sequence object to its default value (KS_INIT_TRAP)</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:45</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_ace858b7b1e7182259bcaa098147e5956"><div class="ttname"><a href="_k_s_foundation__host_8c.html#ace858b7b1e7182259bcaa098147e5956">ks_eval_trap_constrained</a></div><div class="ttdeci">STATUS ks_eval_trap_constrained(KS_TRAP *trap, const char *const desc, float ampmax, float slewrate, int minduration)</div><div class="ttdoc">Sets up a trapezoid using a KS_TRAP sequence object with gradient constraints specified as input argu...</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:276</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_aad774d0423b06e30276673c8100a8ade"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#aad774d0423b06e30276673c8100a8ade">KS_PHASER::areaoffset</a></div><div class="ttdeci">float areaoffset</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1531</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a97ab43f6fd28920a42d987c8fec4afec"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a97ab43f6fd28920a42d987c8fec4afec">KS_TRAP::area</a></div><div class="ttdeci">float area</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:434</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_abfd94a01fc71278021802ca0d1e25e16"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#abfd94a01fc71278021802ca0d1e25e16">KS_PHASER::fov</a></div><div class="ttdeci">float fov</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1526</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a92f07eb83de68841171693b2041cee66"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a92f07eb83de68841171693b2041cee66">ks_eval_phaseviewtable</a></div><div class="ttdeci">void ks_eval_phaseviewtable(KS_PHASER *phaser)</div><div class="ttdoc">Sets up which lines to acquire for a KS_PHASER object</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:624</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="acc45c24d1996acd3d95ae2866c5ffb2b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acc45c24d1996acd3d95ae2866c5ffb2b">&#9670;&nbsp;</a></span>ks_eval_phaser()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_phaser </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *&#160;</td>
          <td class="paramname"><em>phaser</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const&#160;</td>
          <td class="paramname"><em>desc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets up an acquisition window with a trapezoid with preset gradient constraints</h4>
</p>
<p>This is a wrapper function to <a class="el" href="_k_s_foundation_8h.html#af0032a7ae290e65a958fa32c590d0fbf" title="Sets up a trapezoid for phase encoding, subject to gradient constraints specified as input arguments...">ks_eval_phaser_constrained()</a> with gradient constraints set to allow this <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> to simultaneously be played on XGRAD, YGRAD, ZGRAD for any slice angulation. This is the generic and safest configuration, but the duration of the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object may increase for double oblique slices</p>
<p>See <a class="el" href="_k_s_foundation_8h.html#af0032a7ae290e65a958fa32c590d0fbf" title="Sets up a trapezoid for phase encoding, subject to gradient constraints specified as input arguments...">ks_eval_phaser_constrained()</a> for details on fields that need to be set before calling this function</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">phaser</td><td>Pointer to the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object to be set up </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">desc</td><td>A description (text string) of the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object. This description is used for pulse sequence generation (seen in the file generated by <em>TimeHist</em> in <em>MGD Sim/WTools</em>) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;                                                                        {</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__host_8c.html#a3719e6e7daa633b15bf8213abd3e3ab7">ks_eval_phaser_constrained</a>(phaser, phasername, <a class="code" href="_k_s_foundation_8h.html#a5c919c547ee396b18069ed505c695139">ks_syslimits_ampmax</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>), <a class="code" href="_k_s_foundation_8h.html#a712d215e449900b4fc566fefff51b4e9">ks_syslimits_slewrate</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>), 0);</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_a5c919c547ee396b18069ed505c695139"><div class="ttname"><a href="_k_s_foundation_8h.html#a5c919c547ee396b18069ed505c695139">ks_syslimits_ampmax</a></div><div class="ttdeci">float ks_syslimits_ampmax(LOG_GRAD loggrd)</div><div class="ttdoc">Returns the maximum gradient amplitude that can be used on all gradient boards simultaneously</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:163</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a3719e6e7daa633b15bf8213abd3e3ab7"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a3719e6e7daa633b15bf8213abd3e3ab7">ks_eval_phaser_constrained</a></div><div class="ttdeci">STATUS ks_eval_phaser_constrained(KS_PHASER *phaser, const char *const phasername, float ampmax, float slewrate, int minduration)</div><div class="ttdoc">Sets up a trapezoid for phase encoding, subject to gradient constraints specified as input arguments...</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:783</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a712d215e449900b4fc566fefff51b4e9"><div class="ttname"><a href="_k_s_foundation_8h.html#a712d215e449900b4fc566fefff51b4e9">ks_syslimits_slewrate</a></div><div class="ttdeci">float ks_syslimits_slewrate(LOG_GRAD loggrd)</div><div class="ttdoc">Returns the maximum slewrate that can be used on all gradient boards simultaneously</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:196</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1977830e4c131a769f095e386ee372f6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1977830e4c131a769f095e386ee372f6">&#9670;&nbsp;</a></span>ks_eval_phaser2()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_phaser2 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *&#160;</td>
          <td class="paramname"><em>phaser</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const&#160;</td>
          <td class="paramname"><em>desc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets up an acquisition window with a trapezoid with preset gradient constraints</h4>
</p>
<p>This is a wrapper function to <a class="el" href="_k_s_foundation_8h.html#af0032a7ae290e65a958fa32c590d0fbf" title="Sets up a trapezoid for phase encoding, subject to gradient constraints specified as input arguments...">ks_eval_phaser_constrained()</a> with gradient constraints set to allow this <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> to simultaneously be played on up to two (2) logical gradients for any slice angulation. For double oblique slice angulations, this function may allow for shorter duration than <a class="el" href="_k_s_foundation_8h.html#acc45c24d1996acd3d95ae2866c5ffb2b" title="Sets up an acquisition window with a trapezoid with preset gradient constraints">ks_eval_phaser()</a></p>
<p>See <a class="el" href="_k_s_foundation_8h.html#af0032a7ae290e65a958fa32c590d0fbf" title="Sets up a trapezoid for phase encoding, subject to gradient constraints specified as input arguments...">ks_eval_phaser_constrained()</a> for details on fields that need to be set before calling this function</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">phaser</td><td>Pointer to the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object to be set up </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">desc</td><td>A description (text string) of the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object. This description is used for pulse sequence generation (seen in the file generated by <em>TimeHist</em> in <em>MGD Sim/WTools</em>) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;                                                                         {</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__host_8c.html#a3719e6e7daa633b15bf8213abd3e3ab7">ks_eval_phaser_constrained</a>(phaser, phasername, <a class="code" href="_k_s_foundation_8h.html#a4b3a3095702bf551f318ef9f03ff3403">ks_syslimits_ampmax2</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>), <a class="code" href="_k_s_foundation_8h.html#a53d792432e1fd99fa597314576fa9e49">ks_syslimits_slewrate2</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>), 0);</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;}</div><div class="ttc" id="_k_s_foundation__host_8c_html_a3719e6e7daa633b15bf8213abd3e3ab7"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a3719e6e7daa633b15bf8213abd3e3ab7">ks_eval_phaser_constrained</a></div><div class="ttdeci">STATUS ks_eval_phaser_constrained(KS_PHASER *phaser, const char *const phasername, float ampmax, float slewrate, int minduration)</div><div class="ttdoc">Sets up a trapezoid for phase encoding, subject to gradient constraints specified as input arguments...</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:783</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4b3a3095702bf551f318ef9f03ff3403"><div class="ttname"><a href="_k_s_foundation_8h.html#a4b3a3095702bf551f318ef9f03ff3403">ks_syslimits_ampmax2</a></div><div class="ttdeci">float ks_syslimits_ampmax2(LOG_GRAD loggrd)</div><div class="ttdoc">Returns the maximum gradient amplitude that can be used on two gradient boards simultaneously</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:167</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a53d792432e1fd99fa597314576fa9e49"><div class="ttname"><a href="_k_s_foundation_8h.html#a53d792432e1fd99fa597314576fa9e49">ks_syslimits_slewrate2</a></div><div class="ttdeci">float ks_syslimits_slewrate2(LOG_GRAD loggrd)</div><div class="ttdoc">Returns the maximum slewrate that can be used on two gradient boards simultaneously</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:200</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a89b964cc50ce19bc364370f56b143309"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a89b964cc50ce19bc364370f56b143309">&#9670;&nbsp;</a></span>ks_eval_phaser1()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_phaser1 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *&#160;</td>
          <td class="paramname"><em>phaser</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const&#160;</td>
          <td class="paramname"><em>desc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets up an acquisition window with a trapezoid with preset gradient constraints</h4>
</p>
<p>This is a wrapper function to <a class="el" href="_k_s_foundation_8h.html#af0032a7ae290e65a958fa32c590d0fbf" title="Sets up a trapezoid for phase encoding, subject to gradient constraints specified as input arguments...">ks_eval_phaser_constrained()</a> with gradient constraints set to allow this <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> to only be played out on one (1) logical gradient at a time. No gradient may be active on another board while this trapezoid is played out. For double oblique slice angulations, this function may allow for shorter duration than <a class="el" href="_k_s_foundation_8h.html#acc45c24d1996acd3d95ae2866c5ffb2b" title="Sets up an acquisition window with a trapezoid with preset gradient constraints">ks_eval_phaser()</a> and <a class="el" href="_k_s_foundation_8h.html#a1977830e4c131a769f095e386ee372f6" title="Sets up an acquisition window with a trapezoid with preset gradient constraints">ks_eval_phaser2()</a></p>
<p>See <a class="el" href="_k_s_foundation_8h.html#af0032a7ae290e65a958fa32c590d0fbf" title="Sets up a trapezoid for phase encoding, subject to gradient constraints specified as input arguments...">ks_eval_phaser_constrained()</a> for details on fields that need to be set before calling this function</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">phaser</td><td>Pointer to the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object to be set up </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">desc</td><td>A description (text string) of the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object. This description is used for pulse sequence generation (seen in the file generated by <em>TimeHist</em> in <em>MGD Sim/WTools</em>) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;                                                                         {</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__host_8c.html#a3719e6e7daa633b15bf8213abd3e3ab7">ks_eval_phaser_constrained</a>(phaser, phasername, <a class="code" href="_k_s_foundation_8h.html#a431729c0ecf331b33d84db72a80debaf">ks_syslimits_ampmax1</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>), <a class="code" href="_k_s_foundation_8h.html#aaeea7c06ce455978cce287cf28c22a4f">ks_syslimits_slewrate1</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>), 0);</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;}</div><div class="ttc" id="_k_s_foundation__host_8c_html_a3719e6e7daa633b15bf8213abd3e3ab7"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a3719e6e7daa633b15bf8213abd3e3ab7">ks_eval_phaser_constrained</a></div><div class="ttdeci">STATUS ks_eval_phaser_constrained(KS_PHASER *phaser, const char *const phasername, float ampmax, float slewrate, int minduration)</div><div class="ttdoc">Sets up a trapezoid for phase encoding, subject to gradient constraints specified as input arguments...</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:783</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aaeea7c06ce455978cce287cf28c22a4f"><div class="ttname"><a href="_k_s_foundation_8h.html#aaeea7c06ce455978cce287cf28c22a4f">ks_syslimits_slewrate1</a></div><div class="ttdeci">float ks_syslimits_slewrate1(LOG_GRAD loggrd)</div><div class="ttdoc">Returns the maximum slewrate that can be used on one gradient board at a time</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:204</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a431729c0ecf331b33d84db72a80debaf"><div class="ttname"><a href="_k_s_foundation_8h.html#a431729c0ecf331b33d84db72a80debaf">ks_syslimits_ampmax1</a></div><div class="ttdeci">float ks_syslimits_ampmax1(LOG_GRAD loggrd)</div><div class="ttdoc">Returns the maximum gradient amplitude that can be used on all gradient boards simultaneously</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:171</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3369441b24c1df15ba2193aae29d3e11"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3369441b24c1df15ba2193aae29d3e11">&#9670;&nbsp;</a></span>ks_eval_wave()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_wave </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const&#160;</td>
          <td class="paramname"><em>desc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>res</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>duration</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a>&#160;</td>
          <td class="paramname"><em>waveform</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets up a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object based on a waveform (KS_WAVEFORM) in memory</h4>
</p>
<p><a class="el" href="_k_s_foundation_8h.html#a3369441b24c1df15ba2193aae29d3e11" title="Sets up a KS_WAVE object based on a waveform (KS_WAVEFORM) in memory">ks_eval_wave()</a> copies the content of a KS_WAVEFORM into a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> sequence object. KS_WAVEFORM (5th arg) is a <code>typedef</code> for a float array with a fixed length of KS_MAXWAVELEN elements. Hence, a KS_WAVEFORM, or float array, must first be created and filled with some wave contents before calling this function. <em>res</em> elements are copied from the input KS_WAVEFORM to the field <code>.waveform</code> in the <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object (1st arg). <em>duration</em> (4th arg) must be divisible by <em>res</em> (3rd arg) and at least 2x <em>res</em>.</p>
<p>When using (i.e. calling <a class="el" href="_k_s_foundation_8h.html#afc06ade569c7b85c1aa5026fc2e1c710" title="Places a KS_WAVE sequence object on a board at some position in the pulse sequence">ks_pg_wave()</a>) the waveform for:</p><ol type="1">
<li>RF or OMEGA, nothing needs to be done in terms of amplitude scaling. For RF, amplitude scaling is handled via the <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object, and for OMEGA the number of [Hz] are set directly in run-time (<a class="el" href="ksepi_8e.html#a1669428052472d00b1c55a1291f8032f">scan()</a>)</li>
<li>THETA, the waveform needs to be scaled to units of [degrees]</li>
<li>XGRAD, YGRAD, or ZGRAD, the waveform needs to be scaled to units of [G/cm]</li>
</ol>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">wave</td><td><a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object to be created </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">desc</td><td>A description (text string) of the <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object. This description is used for pulse sequence generation (seen in the file generated by <em>TimeHist</em> in <em>MGD Sim/WTools</em>) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">res</td><td>Resolution of the waveform, i.e. number of elements from KS_WAVEFORM (5th arg) to read </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">duration</td><td>Desired duration in [us] of the waveform (must be divisible with <em>res</em>) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">waveform</td><td>KS_WAVEFORM (float array of max length KS_MAXWAVELEN) with existing waveform content </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;                                                                                                        {</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a06d5868fa630d1c05faea3350dbf045c">KS_DESCRIPTION</a> tmpdesc;</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;  strncpy(tmpdesc, desc, <a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> / 2);</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;  <span class="comment">/* don&#39;t allow NULL or a description with leading space */</span></div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;  <span class="keywordflow">if</span> (desc == NULL || desc[0] == <span class="charliteral">&#39; &#39;</span>) {</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_wave: wave name (2nd arg) cannot be NULL or leading space&quot;</span>);</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;  }</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;  <span class="keywordflow">if</span> (duration &lt; 0 || res &lt; 0) {</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_wave(%s): &#39;res&#39; and &#39;duration&#39; must be positive&quot;</span>, desc);</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;  }</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;  <span class="keywordflow">if</span> (res &gt; <a class="code" href="_k_s_foundation_8h.html#a3c3e362198a193a273f436e9e392188b">KS_MAXWAVELEN</a>) {</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_wave(%s): &#39;res&#39; cannot exceed %d&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, <a class="code" href="_k_s_foundation_8h.html#a3c3e362198a193a273f436e9e392188b">KS_MAXWAVELEN</a>);</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;  }</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;  <span class="keywordflow">if</span> (res % 2) {</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_wave(%s): &#39;res&#39; must be even&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;  }</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;  <span class="keywordflow">if</span> (duration &gt; 0 &amp;&amp; (duration % res)) {</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_wave(%s): &#39;duration&#39; (%d) [us] must be divisible by &#39;res&#39; (%d)&quot;</span>, desc, duration, res);</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;  }</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;  <span class="keywordflow">if</span> (duration &gt; 0 &amp;&amp; (duration / res) &lt; 2) {</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_wave(%s): &#39;duration&#39; (%d) [us] must be at least 2x &#39;res&#39; (%d)&quot;</span>, desc, duration, res);</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;  }</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;  <span class="comment">/* reset wave object */</span></div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#aa2b37fa5aa0bffff1de8ca29e7c19cc1">ks_init_wave</a>(wave);</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;  <span class="comment">/* fill in wave object */</span></div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;  strcpy(wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, tmpdesc);</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;  wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> = res;</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;  wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> = duration;</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;  <span class="comment">/* copy the waveform */</span></div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;  memcpy(wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, newwave, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>);</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aacb2fe1d83c45e8d0525f363bdd6b8a6"><div class="ttname"><a href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a></div><div class="ttdeci">#define KS_DESCRIPTION_LENGTH</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:112</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">KS_WAVE::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:516</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_aa2b37fa5aa0bffff1de8ca29e7c19cc1"><div class="ttname"><a href="_k_s_foundation__host_8c.html#aa2b37fa5aa0bffff1de8ca29e7c19cc1">ks_init_wave</a></div><div class="ttdeci">void ks_init_wave(KS_WAVE *wave)</div><div class="ttdoc">Resets a KS_WAVE sequence object to its default value (KS_INIT_WAVE)</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:53</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a06d5868fa630d1c05faea3350dbf045c"><div class="ttname"><a href="_k_s_foundation_8h.html#a06d5868fa630d1c05faea3350dbf045c">KS_DESCRIPTION</a></div><div class="ttdeci">char KS_DESCRIPTION[KS_DESCRIPTION_LENGTH]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:178</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a27640b66342aa92e2fecafb0e8471785"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">KS_WAVE::waveform</a></div><div class="ttdeci">KS_WAVEFORM waveform</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:519</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_WAVE::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:518</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a3c3e362198a193a273f436e9e392188b"><div class="ttname"><a href="_k_s_foundation_8h.html#a3c3e362198a193a273f436e9e392188b">KS_MAXWAVELEN</a></div><div class="ttdeci">#define KS_MAXWAVELEN</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:113</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab970a46d592fc615a856f469532b7de1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab970a46d592fc615a856f469532b7de1">&#9670;&nbsp;</a></span>ks_eval_mirrorwave()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_mirrorwave </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Flips the contents of the KS_WAVEFORM in a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object</h4>
</p>
<p><a class="el" href="_k_s_foundation_8h.html#ab970a46d592fc615a856f469532b7de1" title="Flips the contents of the KS_WAVEFORM in a KS_WAVE object">ks_eval_mirrorwave()</a> replaces the KS_WAVEFORM with its (temporally) mirrored version. This can be used to e.g. mirror a minimum phase excitation pulse for fast recovery and T1-optimization in FSE sequences (<a class="el" href="ksfse_8e.html" title="This file contains the overall structure for the ksfse psd. ">ksfse.e</a>).#pragma endregion See also <a class="el" href="_k_s_foundation_8h.html#a38e6cbd20c6ca7972e583360a1fb67c3" title="In-place stretching of a KS_RF object">ks_eval_stretch_rf()</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">wave</td><td><a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object, whose KS_WAVEFORM to be mirrored </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;                                         {</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a> tmpwave;</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;  memcpy(tmpwave, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>);</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>; i++) {</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[i] = tmpwave[wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>-1 - i];</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;  }</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_a98d69b5689c184e4f57ab124e726f964"><div class="ttname"><a href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a></div><div class="ttdeci">float KS_WAVEFORM[KS_MAXWAVELEN]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:179</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a27640b66342aa92e2fecafb0e8471785"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">KS_WAVE::waveform</a></div><div class="ttdeci">KS_WAVEFORM waveform</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:519</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aaf06af6c18f52a777919eaef76d6c617"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaf06af6c18f52a777919eaef76d6c617">&#9670;&nbsp;</a></span>ks_eval_wave_file()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_wave_file </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const&#160;</td>
          <td class="paramname"><em>desc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>res</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>duration</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const&#160;</td>
          <td class="paramname"><em>filename</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const&#160;</td>
          <td class="paramname"><em>format</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets up a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object based on a waveform that resides on disk</h4>
</p>
<p><a class="el" href="_k_s_foundation_8h.html#aaf06af6c18f52a777919eaef76d6c617" title="Sets up a KS_WAVE object based on a waveform that resides on disk">ks_eval_wave_file()</a> reads waveforms on disk into a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a>. The data format (arg 6) may currently be one of:</p><ol type="1">
<li>"GE": GE's file format for external pulses (.rho, .gz, etc.). The data will be divided by a factor of MAX_PG_WAMP (32766) before copied to <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a></li>
<li>"short": Plain short integer format. The data will be divided by a factor of MAX_PG_WAMP (32766) before copied to <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a></li>
<li>"float": Plain float format. Data will be read in as is and copied to <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a></li>
</ol>
<p>When the first two formats are used the field <code>.waveform</code> in <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> will contain data in the range [-1.0,1.0]. <em>res</em> elements are read from disk in the specified format into the field <code>.waveform</code> in the <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object (1st arg). <em>duration</em> (4th arg) must be divisible by <em>res</em> (3rd arg) and at least 2x <em>res</em>.</p>
<p>When using (i.e. calling <a class="el" href="_k_s_foundation_8h.html#afc06ade569c7b85c1aa5026fc2e1c710" title="Places a KS_WAVE sequence object on a board at some position in the pulse sequence">ks_pg_wave()</a>) the waveform for:</p><ol type="1">
<li>RF or OMEGA, nothing needs to be done in terms of amplitude scaling. For RF, amplitude scaling is handled via the <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object, and for OMEGA the number of [Hz] are set directly in run-time (<a class="el" href="ksepi_8e.html#a1669428052472d00b1c55a1291f8032f">scan()</a>)</li>
<li>THETA, the waveform needs to be scaled to units of [degrees]</li>
<li>XGRAD, YGRAD, or ZGRAD, the waveform needs to be scaled to units of [G/cm]</li>
</ol>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">wave</td><td><a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object to be created </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">desc</td><td>A description (text string) of the <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object. This description is used for pulse sequence generation (seen in the file generated by <em>TimeHist</em> in <em>MGD Sim/WTools</em>) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">res</td><td><a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object to be created </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">duration</td><td><a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object to be created </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">filename</td><td>Filename on disk </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">format</td><td>String denoting the data format on disk. Valid values are: "ge" (reads GE's *.rho files with 32byte header), "short", and "float", the latter two being header-less </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;                                                                                                                                               {</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a06d5868fa630d1c05faea3350dbf045c">KS_DESCRIPTION</a> tmpdesc;</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;  strncpy(tmpdesc, desc, <a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> / 2);</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;  <span class="comment">/* don&#39;t allow empty description or a description with leading space */</span></div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;  <span class="keywordflow">if</span> (desc == NULL || desc[0] == <span class="charliteral">&#39; &#39;</span>) {</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_wave_file: wave name (2nd arg) cannot be NULL or leading space&quot;</span>);</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;  }</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;  <span class="keywordflow">if</span> (res % 2) {</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_wave_file(%s): &#39;res&#39; must be even&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;  }</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;  <span class="keywordflow">if</span> (duration &gt; 0 &amp;&amp; (duration % res)) {</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_wave_file(%s): &#39;duration&#39; (%d) [us] must be divisible by &#39;res&#39; (%d)&quot;</span>, desc, duration, res);</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;  }</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;  <span class="keywordflow">if</span> (duration &gt; 0 &amp;&amp; (duration / res) &lt; 2) {</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_wave_file(%s): &#39;duration&#39; (%d) [us] must be at least 2x &#39;res&#39; (%d)&quot;</span>, desc, duration, res);</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;  }</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;  <span class="keywordflow">if</span> (duration &lt; 0 || duration &gt; 4 * <a class="code" href="_k_s_foundation_8h.html#a3c3e362198a193a273f436e9e392188b">KS_MAXWAVELEN</a>) {</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_wave_file(%s): &#39;duration&#39; [us] must be in the range [0, %d]&quot;</span>, desc, 4 * <a class="code" href="_k_s_foundation_8h.html#a3c3e362198a193a273f436e9e392188b">KS_MAXWAVELEN</a>);</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;  }</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;  <span class="comment">/* reset wave object */</span></div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#aa2b37fa5aa0bffff1de8ca29e7c19cc1">ks_init_wave</a>(wave);</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;  <span class="comment">/* fill in wave object */</span></div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;  strcpy(wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, tmpdesc);</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;  wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> = res;</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;  wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> = duration;</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;  <span class="comment">/* read from file */</span></div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;  <span class="keywordflow">if</span> (!strncasecmp(format, <span class="stringliteral">&quot;ge&quot;</span>, 2)) { <span class="comment">/* short format with 32-byte header and big-endian short int */</span></div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#abba996c24da629eea72eecbd9a22a873">KS_IWAVE</a> iwave;</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;    uextwave(iwave, res, (<span class="keywordtype">char</span> *) filename);</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; res; i++)</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;      wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[i] = (<span class="keywordtype">float</span>) iwave[i] / (float) MAX_PG_WAMP;</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strncasecmp(format, <span class="stringliteral">&quot;short&quot;</span>, 5)) {</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#abba996c24da629eea72eecbd9a22a873">KS_IWAVE</a> iwave;</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;    FILE *fp;</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;    <span class="keywordtype">int</span> n;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    <span class="keywordflow">if</span> ((fp = fopen(filename, <span class="stringliteral">&quot;r&quot;</span>)) == NULL)</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_wave_file (%s): Error opening file &#39;%s&#39;&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, filename);</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;    <span class="keywordflow">if</span> ((n = fread(iwave, <span class="keyword">sizeof</span>(<span class="keywordtype">short</span>), res, fp)) &lt; res)</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_wave_file (%s): Only %d out of %d elements read from file &#39;%s&#39;&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, n, res, filename);</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;    fclose(fp);</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; res; i++)</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;      wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[i] = (<span class="keywordtype">float</span>) iwave[i] / (float) MAX_PG_WAMP;</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strncasecmp(format, <span class="stringliteral">&quot;float&quot;</span>, 5)) {</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;    FILE *fp;</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    <span class="keywordtype">int</span> n;</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    <span class="keywordflow">if</span> ((fp = fopen(filename, <span class="stringliteral">&quot;r&quot;</span>)) == NULL)</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_wave_file (%s): Error opening file &#39;%s&#39;&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, filename);</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    <span class="keywordflow">if</span> ((n = fread(wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), res, fp)) &lt; res)</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_wave_file (%s): Only %d out of %d elements read from file &#39;%s&#39;&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, n, res, filename);</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;    fclose(fp);</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_wave_file (%s): &#39;format&#39; (5th arg) must be &#39;ge&#39;,&#39;short&#39; or &#39;float&#39;&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;  }</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;} <span class="comment">/* ks_eval_wave_file */</span></div><div class="ttc" id="_k_s_foundation_8h_html_abba996c24da629eea72eecbd9a22a873"><div class="ttname"><a href="_k_s_foundation_8h.html#abba996c24da629eea72eecbd9a22a873">KS_IWAVE</a></div><div class="ttdeci">short KS_IWAVE[KS_MAXWAVELEN]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:180</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aacb2fe1d83c45e8d0525f363bdd6b8a6"><div class="ttname"><a href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a></div><div class="ttdeci">#define KS_DESCRIPTION_LENGTH</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:112</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">KS_WAVE::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:516</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_aa2b37fa5aa0bffff1de8ca29e7c19cc1"><div class="ttname"><a href="_k_s_foundation__host_8c.html#aa2b37fa5aa0bffff1de8ca29e7c19cc1">ks_init_wave</a></div><div class="ttdeci">void ks_init_wave(KS_WAVE *wave)</div><div class="ttdoc">Resets a KS_WAVE sequence object to its default value (KS_INIT_WAVE)</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:53</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a06d5868fa630d1c05faea3350dbf045c"><div class="ttname"><a href="_k_s_foundation_8h.html#a06d5868fa630d1c05faea3350dbf045c">KS_DESCRIPTION</a></div><div class="ttdeci">char KS_DESCRIPTION[KS_DESCRIPTION_LENGTH]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:178</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a27640b66342aa92e2fecafb0e8471785"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">KS_WAVE::waveform</a></div><div class="ttdeci">KS_WAVEFORM waveform</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:519</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_WAVE::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:518</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a3c3e362198a193a273f436e9e392188b"><div class="ttname"><a href="_k_s_foundation_8h.html#a3c3e362198a193a273f436e9e392188b">KS_MAXWAVELEN</a></div><div class="ttdeci">#define KS_MAXWAVELEN</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:113</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad09d10d506854e0913b9f1a30f6f26cc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad09d10d506854e0913b9f1a30f6f26cc">&#9670;&nbsp;</a></span>ks_eval_rf_sinc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_rf_sinc </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_f.html">KS_RF</a> *&#160;</td>
          <td class="paramname"><em>rf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const&#160;</td>
          <td class="paramname"><em>desc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>bw</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>tbw</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>flip</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>wintype</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets up a <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object with a Sinc pulse shape</h4>
</p>
<p>For small flip angles, the Fourier transform of the RF envelope is a good approximation of the final slice profile and SLR designed pulses may not be necessary. For these cases, this function can be used to create a Sinc RF pulse (as a <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object) with a desired bandwidth (BW), time-bandwidth-product (TBW) and window function (e.g. KS_RF_SINCWIN_HAMMING, see ks_enum_sincwin). An increased TBW results in more Sinc lobes and sharper slice profiles, and the minimum value is 2. The <em>duration</em> of the RF pulse (<code>.rfwave.duration</code>) increases when BW decreases or TBW increases</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">rf</td><td><a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object to be created </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">desc</td><td>A description (text string) of the <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object. This description is used for pulse sequence generation (seen in the file generated by <em>TimeHist</em> in <em>MGD Sim/WTools</em>) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">bw</td><td>Bandwidth of the RF pulse [Hz] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tbw</td><td>Time-bandwidth-product of the RF pulse. Higher value gives sharper slice profiles but increases the duration </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">flip</td><td>Nominal flip angle of the RF pulse </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">wintype</td><td>Window function over the Sinc. See ks_enum_sincwin for enums names that steer the window choice </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;                                                                                                           {</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a06d5868fa630d1c05faea3350dbf045c">KS_DESCRIPTION</a> tmpdesc;</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;  <span class="keywordtype">double</span> x, window, rfenvelope;</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;  <span class="keywordtype">int</span> duration = RUP_GRD(tbw / bw * 1e6); <span class="comment">/* [us]. We round up to nearest multiple of 4 (GRAD_UPDATE_TIME) to better align to gradients */</span></div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;  <span class="keywordtype">int</span> res = duration / RF_UPDATE_TIME; <span class="comment">/* # sample points. RF_UPDATE_TIME = 2 =&gt; res always even */</span></div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;  <span class="comment">/* don&#39;t allow empty description or a description with leading space */</span></div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;  <span class="keywordflow">if</span> (desc == NULL || desc[0] == <span class="charliteral">&#39; &#39;</span>) {</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_rf_sinc: RF name (2nd arg) cannot be NULL or leading space&quot;</span>);</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;  }</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;  strncpy(tmpdesc, desc, <a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a>/2);</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;  tmpdesc[<a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a>/2] = 0;</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;  <span class="comment">/* reset RF object */</span></div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#a708ba4291820da3460f6b2c7be287f06">ks_init_rf</a>(rf);</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;  <span class="comment">/* fill in wave object */</span></div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;  sprintf(rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, <span class="stringliteral">&quot;%s.wave&quot;</span>, tmpdesc);</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;  <span class="keywordflow">if</span> (bw &lt; 2 || bw &gt; 100000) {</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_rf_sinc(%s): &#39;bw&#39; (%g, 3rd arg) must be in range [2,100000] Hz&quot;</span>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, bw);</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;  }</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;  <span class="keywordflow">if</span> (tbw &lt; 2 || tbw &gt; 100) {</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_rf_sinc(%s): &#39;tbw&#39; (%g, 4th arg) must be in range [2,100]&quot;</span>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, tbw);</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;  }</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;  <span class="keywordflow">if</span> (res &gt; <a class="code" href="_k_s_foundation_8h.html#a3c3e362198a193a273f436e9e392188b">KS_MAXWAVELEN</a> || res &lt; 4) {</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_rf_sinc(%s): combination of &#39;bw&#39; and &#39;tbw&#39; resulted in a resolution outside the valid range [4, %d]&quot;</span>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, <a class="code" href="_k_s_foundation_8h.html#a3c3e362198a193a273f436e9e392188b">KS_MAXWAVELEN</a>);</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;  }</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;  <span class="keywordflow">if</span> (flip &lt;= 0 || flip &gt; 10000.0) {</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_rf_sinc(%s): &#39;flip&#39; must be in range (0, 10000]&quot;</span>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;  }</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> = res;</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> = duration;</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#afa10c3dbec21b5cc34276e741deeb97e">iso2end</a> = duration / 2;</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#af9bc4afb4579b2bf18259e70175090a3">start2iso</a> = duration / 2;</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#a6b955cde0388e60c3ec5f602072a8e0f">bw</a> = bw;</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#a7ab9fec3ad0848d2dff5db7279f1a806">flip</a> = flip;</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;  <span class="comment">/* generate waveform with max 1.0 */</span></div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;  <span class="keywordflow">for</span> (i = 0 ; i &lt; (res - 1) ; i++) {</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    x = 2.0 * i / (res - 1) - 1.0;</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    <span class="keywordflow">if</span> (fabs(2.0 * PI * (tbw / 4.0)*x) &gt; 1e-6) {</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;      rfenvelope = sin(2.0 * PI * (tbw / 4.0) * x) / (2.0 * PI * (tbw / 4.0) * x);</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;      rfenvelope = 1.0;</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    }</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    window = 1.0; <span class="comment">/* init to no filter */</span></div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;    <span class="keywordflow">if</span> (wintype == <a class="code" href="_k_s_foundation_8h.html#a86ae493647e9688c942bc9e0bb396313a3bc8b5d8517c5b1a3b852ee492ae293a">KS_RF_SINCWIN_HAMMING</a>) {</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;      window = 0.54 + 0.46 * cos(PI * x);</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wintype == <a class="code" href="_k_s_foundation_8h.html#a86ae493647e9688c942bc9e0bb396313a594d1a1254b32274c42975552d65184a">KS_RF_SINCWIN_HANNING</a>) {</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;      window = (1.0 + cos(PI * x)) * 0.5;</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wintype == <a class="code" href="_k_s_foundation_8h.html#a86ae493647e9688c942bc9e0bb396313a2ba60a518ac45656a0a55b26fe053836">KS_RF_SINCWIN_BLACKMAN</a>) {</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;      window = 0.42 + 0.5 * cos(PI * x) + 0.08 * cos(2 * PI * x);</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wintype == <a class="code" href="_k_s_foundation_8h.html#a86ae493647e9688c942bc9e0bb396313a09905442fe84127c23f592ca3af03dd2">KS_RF_SINCWIN_BARTLETT</a>) {</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;      <span class="keywordflow">if</span> (x &lt; 0.0)</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;        window = x + 1.0;</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;        window = 1.0 - x;</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    }</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;    rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[i] = rfenvelope * window;</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;  } <span class="comment">/* for */</span></div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;  <span class="comment">/* initialize amplitude to 1 */</span></div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ab508ded41392ee86a2a619d3e93d2373">amp</a> = 1;</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;  <span class="comment">/* set the usage of the RF PULSE to off until .base.ninst &gt; 0 (see ks_pg_rf() on HOST) */</span></div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.activity = PSD_PULSE_OFF;</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;  <span class="comment">/* initialize number of occurrences of RF pulse to zero */</span></div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.num = 0;</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;  <span class="comment">/* setup rfpulse structure */</span></div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__host_8c.html#ae514f91fbedc683d5e9db931960b79b1">ks_eval_rfstat</a>(rf);</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;}</div><div class="ttc" id="struct_k_s___r_f_html_af9bc4afb4579b2bf18259e70175090a3"><div class="ttname"><a href="struct_k_s___r_f.html#af9bc4afb4579b2bf18259e70175090a3">KS_RF::start2iso</a></div><div class="ttdeci">int start2iso</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:793</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a86ae493647e9688c942bc9e0bb396313a3bc8b5d8517c5b1a3b852ee492ae293a"><div class="ttname"><a href="_k_s_foundation_8h.html#a86ae493647e9688c942bc9e0bb396313a3bc8b5d8517c5b1a3b852ee492ae293a">KS_RF_SINCWIN_HAMMING</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1751</div></div>
<div class="ttc" id="struct_k_s___r_f_html_ae183c3e4095d1c6d14b3d59a0da97928"><div class="ttname"><a href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">KS_RF::rfpulse</a></div><div class="ttdeci">RF_PULSE rfpulse</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:797</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a7ab9fec3ad0848d2dff5db7279f1a806"><div class="ttname"><a href="struct_k_s___r_f.html#a7ab9fec3ad0848d2dff5db7279f1a806">KS_RF::flip</a></div><div class="ttdeci">float flip</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:789</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aacb2fe1d83c45e8d0525f363bdd6b8a6"><div class="ttname"><a href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a></div><div class="ttdeci">#define KS_DESCRIPTION_LENGTH</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:112</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a708ba4291820da3460f6b2c7be287f06"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a708ba4291820da3460f6b2c7be287f06">ks_init_rf</a></div><div class="ttdeci">void ks_init_rf(KS_RF *rf)</div><div class="ttdoc">Resets a KS_RF sequence object to its default value (KS_INIT_RF)</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:57</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">KS_WAVE::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:516</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_ae514f91fbedc683d5e9db931960b79b1"><div class="ttname"><a href="_k_s_foundation__host_8c.html#ae514f91fbedc683d5e9db931960b79b1">ks_eval_rfstat</a></div><div class="ttdeci">STATUS ks_eval_rfstat(KS_RF *rf)</div><div class="ttdoc">Sets up the RF_PULSE structure of a KS_RF object</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:1359</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a2a9b610a78cdae3ac8ef682bd34f7e0d"><div class="ttname"><a href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">KS_RF::rfwave</a></div><div class="ttdeci">KS_WAVE rfwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:798</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a86ae493647e9688c942bc9e0bb396313a09905442fe84127c23f592ca3af03dd2"><div class="ttname"><a href="_k_s_foundation_8h.html#a86ae493647e9688c942bc9e0bb396313a09905442fe84127c23f592ca3af03dd2">KS_RF_SINCWIN_BARTLETT</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1751</div></div>
<div class="ttc" id="struct_k_s___r_f_html_ab508ded41392ee86a2a619d3e93d2373"><div class="ttname"><a href="struct_k_s___r_f.html#ab508ded41392ee86a2a619d3e93d2373">KS_RF::amp</a></div><div class="ttdeci">float amp</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:792</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a86ae493647e9688c942bc9e0bb396313a2ba60a518ac45656a0a55b26fe053836"><div class="ttname"><a href="_k_s_foundation_8h.html#a86ae493647e9688c942bc9e0bb396313a2ba60a518ac45656a0a55b26fe053836">KS_RF_SINCWIN_BLACKMAN</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1751</div></div>
<div class="ttc" id="struct_k_s___r_f_html_afa10c3dbec21b5cc34276e741deeb97e"><div class="ttname"><a href="struct_k_s___r_f.html#afa10c3dbec21b5cc34276e741deeb97e">KS_RF::iso2end</a></div><div class="ttdeci">int iso2end</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:794</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a06d5868fa630d1c05faea3350dbf045c"><div class="ttname"><a href="_k_s_foundation_8h.html#a06d5868fa630d1c05faea3350dbf045c">KS_DESCRIPTION</a></div><div class="ttdeci">char KS_DESCRIPTION[KS_DESCRIPTION_LENGTH]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:178</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a86ae493647e9688c942bc9e0bb396313a594d1a1254b32274c42975552d65184a"><div class="ttname"><a href="_k_s_foundation_8h.html#a86ae493647e9688c942bc9e0bb396313a594d1a1254b32274c42975552d65184a">KS_RF_SINCWIN_HANNING</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1751</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a27640b66342aa92e2fecafb0e8471785"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">KS_WAVE::waveform</a></div><div class="ttdeci">KS_WAVEFORM waveform</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:519</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_WAVE::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:518</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a3c3e362198a193a273f436e9e392188b"><div class="ttname"><a href="_k_s_foundation_8h.html#a3c3e362198a193a273f436e9e392188b">KS_MAXWAVELEN</a></div><div class="ttdeci">#define KS_MAXWAVELEN</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:113</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a6b955cde0388e60c3ec5f602072a8e0f"><div class="ttname"><a href="struct_k_s___r_f.html#a6b955cde0388e60c3ec5f602072a8e0f">KS_RF::bw</a></div><div class="ttdeci">float bw</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:790</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a242ef57a69ccff033c43fada5ed0172f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a242ef57a69ccff033c43fada5ed0172f">&#9670;&nbsp;</a></span>ks_eval_rf_secant()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_rf_secant </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_f.html">KS_RF</a> *&#160;</td>
          <td class="paramname"><em>rf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const&#160;</td>
          <td class="paramname"><em>desc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>A0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>tbw</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>bw</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets up a <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object with a Hyperbolic Secant shape</h4>
</p>
<div class="fragment"><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;                                                                                            {</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;  STATUS status;</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="_g_e_required_8e.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a> = 1;</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;  <span class="comment">/* reset RF object */</span></div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#a708ba4291820da3460f6b2c7be287f06">ks_init_rf</a>(rf);</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a06d5868fa630d1c05faea3350dbf045c">KS_DESCRIPTION</a> tmpdesc;</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;  <span class="comment">/* don&#39;t allow empty description or a description with leading space */</span></div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;  <span class="keywordflow">if</span> (desc == NULL || desc[0] == <span class="charliteral">&#39; &#39;</span>) {</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_rf_secant: &#39;RF name&#39; (2nd arg) cannot be NULL or leading space&quot;</span>);</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;  }</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;  strncpy(tmpdesc, desc, <a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a>/2);</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;  tmpdesc[<a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a>/2] = 0;</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;  <span class="comment">/* fill in wave object */</span></div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;  sprintf(rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, <span class="stringliteral">&quot;%s.wave&quot;</span>, tmpdesc);</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;  <span class="keywordflow">if</span> (A0 &lt; 0 || 0.25 &lt; A0) {</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_rf_secant(%s): &#39;A0&#39; (%g, 3rd arg) must be in range [0,0.25] Gauss&quot;</span>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, A0);</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;  }</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;  <span class="keywordflow">if</span> (tbw &lt; 2 || 20 &lt; tbw) {</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_rf_secant(%s): &#39;tbw&#39; (%g, 4th arg) must be in range [2,20]&quot;</span>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, tbw);</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;  }</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;  <span class="keywordflow">if</span> (bw &lt; 100 || 10000 &lt; bw) {</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_rf_secant(%s): &#39;bw&#39; (%g, 5th arg) must be in range [0,10000] Hz&quot;</span>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, bw);</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;  }</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;  <span class="keywordtype">int</span> duration = RUP_GRD((<span class="keywordtype">int</span>)(1000000.0 * tbw / bw));</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;  <span class="keywordtype">int</span> res = duration / GRAD_UPDATE_TIME; <span class="comment">/* # sample points. RF_UPDATE_TIME = 2 =&gt; res always even */</span></div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;  <span class="keywordflow">if</span> (res &lt; 4 || <a class="code" href="_k_s_foundation_8h.html#a3c3e362198a193a273f436e9e392188b">KS_MAXWAVELEN</a> &lt; res) {</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_rf_secant(%s): tbw / bw resulted in a resolution(%d)/duration(%d) outside the valid range [4, %d]&quot;</span>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, res, duration, <a class="code" href="_k_s_foundation_8h.html#a3c3e362198a193a273f436e9e392188b">KS_MAXWAVELEN</a>);</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;  }</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> = res;</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> = duration;</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#afa10c3dbec21b5cc34276e741deeb97e">iso2end</a> = duration / 2;</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#af9bc4afb4579b2bf18259e70175090a3">start2iso</a> = duration / 2;</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;  <span class="comment">/* calculate pulse properties */</span></div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;  <span class="keywordtype">float</span> y = 5; <span class="comment">/* 5 is a standard value from literature */</span></div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;  <span class="keywordtype">float</span> B = (bw * PI) / y;</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;  <span class="keywordtype">float</span> Acheck = (PI * bw) / (2.0 * PI * 4258 * sqrt(y)); <span class="comment">/* Gauss */</span></div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;  <span class="keywordflow">if</span> (Acheck &gt; A0 * 0.5) {</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_rf_secant(%s): The adiabatic condition might not be met since %g !&gt;&gt; %g (needs to be at least half)&quot;</span>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, A0, Acheck);</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;  }</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#a6b955cde0388e60c3ec5f602072a8e0f">bw</a> = bw;</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#a7ab9fec3ad0848d2dff5db7279f1a806">flip</a> = 180.0;</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;  <span class="keywordtype">double</span> rfenvelope, phaseenvelope, tau, sech;</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;  <span class="keywordflow">for</span> (i = 0 ; i &lt; res; i++) {</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;    <span class="comment">/* range from -2pi to 2pi */</span></div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;    tau = ((i / (((float)res - 1.0) * 0.5)) - 1.0) * 2.0 * PI;</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;    sech = 1.0 / cosh(tau * B * 0.001);</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;    rfenvelope = A0 * sech;</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;    phaseenvelope = y * log(sech) + y * log(A0);</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;    rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[i] = rfenvelope;</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;    rf-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[i] = phaseenvelope * (180.0/PI);</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;  }</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_g_e_required_8e.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a> == 1) {</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;    <a class="code" href="_k_s_foundation__host_8c.html#a01d67d3faa8f2088f82af10aa0a28af0">ks_print_waveform</a>(rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, <span class="stringliteral">&quot;secant_a.txt&quot;</span>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>);</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;    <a class="code" href="_k_s_foundation__host_8c.html#a01d67d3faa8f2088f82af10aa0a28af0">ks_print_waveform</a>(rf-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, <span class="stringliteral">&quot;secant_p.txt&quot;</span>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>);</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;HS: A0=%f &gt;&gt; Ac=%f, bw=%f, tbw=%f&quot;</span>, A0, Acheck, bw, tbw);</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;HS: y=%f, B=%f&quot;</span>, y, B);</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;  }</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;  <span class="comment">/* Normalize waveform to one &amp; initialize amplitude to 1 */</span></div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a23b3d305df1e2ad0563f8a2fea2330df">ks_wave_multiplyval</a>(&amp;rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>, 1.0 / <a class="code" href="_k_s_foundation_8h.html#a2bfec427bf5a8966edf279b2eba23396">ks_wave_absmax</a>(&amp;rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>));</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ab508ded41392ee86a2a619d3e93d2373">amp</a> = 1;</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;  <span class="comment">/* set the usage of the RF PULSE to off until .base.ninst &gt; 0 (see ks_pg_rf() on HOST) */</span></div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.activity = PSD_PULSE_OFF;</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;  <span class="comment">/* initialize number of occurrences of RF pulse to zero */</span></div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.num = 0;</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;  <span class="comment">/* setup rfpulse structure */</span></div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;  status = <a class="code" href="_k_s_foundation__host_8c.html#ae514f91fbedc683d5e9db931960b79b1">ks_eval_rfstat</a>(rf);</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;  <span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.max_b1 = A0;</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> = res;</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> = duration;</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#aea7921a9aa2757a88e843476848ddd55">role</a> = <a class="code" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedac6b698b041a6da12fb9194c4947ec6e8">KS_RF_ROLE_INV</a>;</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;  <span class="keywordflow">return</span> status;</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;}</div><div class="ttc" id="_k_s_foundation__host_8c_html_a01d67d3faa8f2088f82af10aa0a28af0"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a01d67d3faa8f2088f82af10aa0a28af0">ks_print_waveform</a></div><div class="ttdeci">void ks_print_waveform(const KS_WAVEFORM waveform, char *filename, int res)</div><div class="ttdoc">Writes a KS_WAVEFORM to disk with the specified filename</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3658</div></div>
<div class="ttc" id="struct_k_s___r_f_html_af9bc4afb4579b2bf18259e70175090a3"><div class="ttname"><a href="struct_k_s___r_f.html#af9bc4afb4579b2bf18259e70175090a3">KS_RF::start2iso</a></div><div class="ttdeci">int start2iso</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:793</div></div>
<div class="ttc" id="struct_k_s___r_f_html_aea7921a9aa2757a88e843476848ddd55"><div class="ttname"><a href="struct_k_s___r_f.html#aea7921a9aa2757a88e843476848ddd55">KS_RF::role</a></div><div class="ttdeci">int role</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:788</div></div>
<div class="ttc" id="_g_e_required_8e_html_ac3e1795766a80ec63b157951b4b9a7d4"><div class="ttname"><a href="_g_e_required_8e.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a></div><div class="ttdeci">int debug</div><div class="ttdef"><b>Definition:</b> GERequired.e:2630</div></div>
<div class="ttc" id="struct_k_s___r_f_html_ae183c3e4095d1c6d14b3d59a0da97928"><div class="ttname"><a href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">KS_RF::rfpulse</a></div><div class="ttdeci">RF_PULSE rfpulse</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:797</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aa324c3517656b8ec032523397a142bedac6b698b041a6da12fb9194c4947ec6e8"><div class="ttname"><a href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedac6b698b041a6da12fb9194c4947ec6e8">KS_RF_ROLE_INV</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1750</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a7ab9fec3ad0848d2dff5db7279f1a806"><div class="ttname"><a href="struct_k_s___r_f.html#a7ab9fec3ad0848d2dff5db7279f1a806">KS_RF::flip</a></div><div class="ttdeci">float flip</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:789</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a2bfec427bf5a8966edf279b2eba23396"><div class="ttname"><a href="_k_s_foundation_8h.html#a2bfec427bf5a8966edf279b2eba23396">ks_wave_absmax</a></div><div class="ttdeci">float ks_wave_absmax(const KS_WAVE *wave)</div><div class="ttdoc">Returns the maximum absolute value in a KS_WAVE sequence object</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:986</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aacb2fe1d83c45e8d0525f363bdd6b8a6"><div class="ttname"><a href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a></div><div class="ttdeci">#define KS_DESCRIPTION_LENGTH</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:112</div></div>
<div class="ttc" id="struct_k_s___r_f_html_aecd8b68c159a31a28e2a2ec003b593e2"><div class="ttname"><a href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">KS_RF::thetawave</a></div><div class="ttdeci">KS_WAVE thetawave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:800</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a708ba4291820da3460f6b2c7be287f06"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a708ba4291820da3460f6b2c7be287f06">ks_init_rf</a></div><div class="ttdeci">void ks_init_rf(KS_RF *rf)</div><div class="ttdoc">Resets a KS_RF sequence object to its default value (KS_INIT_RF)</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:57</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">KS_WAVE::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:516</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_ae514f91fbedc683d5e9db931960b79b1"><div class="ttname"><a href="_k_s_foundation__host_8c.html#ae514f91fbedc683d5e9db931960b79b1">ks_eval_rfstat</a></div><div class="ttdeci">STATUS ks_eval_rfstat(KS_RF *rf)</div><div class="ttdoc">Sets up the RF_PULSE structure of a KS_RF object</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:1359</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a2a9b610a78cdae3ac8ef682bd34f7e0d"><div class="ttname"><a href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">KS_RF::rfwave</a></div><div class="ttdeci">KS_WAVE rfwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:798</div></div>
<div class="ttc" id="struct_k_s___r_f_html_ab508ded41392ee86a2a619d3e93d2373"><div class="ttname"><a href="struct_k_s___r_f.html#ab508ded41392ee86a2a619d3e93d2373">KS_RF::amp</a></div><div class="ttdeci">float amp</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:792</div></div>
<div class="ttc" id="struct_k_s___r_f_html_afa10c3dbec21b5cc34276e741deeb97e"><div class="ttname"><a href="struct_k_s___r_f.html#afa10c3dbec21b5cc34276e741deeb97e">KS_RF::iso2end</a></div><div class="ttdeci">int iso2end</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:794</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a06d5868fa630d1c05faea3350dbf045c"><div class="ttname"><a href="_k_s_foundation_8h.html#a06d5868fa630d1c05faea3350dbf045c">KS_DESCRIPTION</a></div><div class="ttdeci">char KS_DESCRIPTION[KS_DESCRIPTION_LENGTH]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:178</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a23b3d305df1e2ad0563f8a2fea2330df"><div class="ttname"><a href="_k_s_foundation_8h.html#a23b3d305df1e2ad0563f8a2fea2330df">ks_wave_multiplyval</a></div><div class="ttdeci">void ks_wave_multiplyval(KS_WAVE *wave, float val)</div><div class="ttdoc">In-place scalar multiplication of a KS_WAVE</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1135</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a27640b66342aa92e2fecafb0e8471785"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">KS_WAVE::waveform</a></div><div class="ttdeci">KS_WAVEFORM waveform</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:519</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_WAVE::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:518</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a3c3e362198a193a273f436e9e392188b"><div class="ttname"><a href="_k_s_foundation_8h.html#a3c3e362198a193a273f436e9e392188b">KS_MAXWAVELEN</a></div><div class="ttdeci">#define KS_MAXWAVELEN</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:113</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a6b955cde0388e60c3ec5f602072a8e0f"><div class="ttname"><a href="struct_k_s___r_f.html#a6b955cde0388e60c3ec5f602072a8e0f">KS_RF::bw</a></div><div class="ttdeci">float bw</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:790</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae907ed47938039d14cf25b9a9a1b3eb8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae907ed47938039d14cf25b9a9a1b3eb8">&#9670;&nbsp;</a></span>ks_eval_rf_hard()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_rf_hard </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_f.html">KS_RF</a> *&#160;</td>
          <td class="paramname"><em>rf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const&#160;</td>
          <td class="paramname"><em>desc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>duration</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>flip</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets up a <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object with a rectangular (hard) pulse of a given duration. </p>
<p>This function creates a hard RF pulse of the desired duration. Hard pulses are typically used as non-slice selective RF pulses, as their slice profile would be very poor (Sinc-like). The resolution of the RF pulse created is equal to the duration/2</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">rf</td><td><a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object to be created </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">desc</td><td>A description (text string) of the <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object. This description is used for pulse sequence generation (seen in the file generated by <em>TimeHist</em> in <em>MGD Sim/WTools</em>) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">duration</td><td>Desired duration in [us] of the waveform (must be even) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">flip</td><td>Nominal flip angle of the RF pulse </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;                                                                                     {</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a06d5868fa630d1c05faea3350dbf045c">KS_DESCRIPTION</a> tmpdesc;</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;  <span class="comment">/* don&#39;t allow empty description or a description with leading space */</span></div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;  <span class="keywordflow">if</span> (desc == NULL || desc[0] == <span class="charliteral">&#39; &#39;</span>) {</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_rf_hard: RF name (2nd arg) cannot be NULL or leading space&quot;</span>);</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;  }</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;  strncpy(tmpdesc, desc, <a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a>/2);</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;  tmpdesc[<a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a>/2] = 0;</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;  <span class="comment">/* reset RF object */</span></div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#a708ba4291820da3460f6b2c7be287f06">ks_init_rf</a>(rf);</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;  <span class="comment">/* fill in wave object */</span></div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;  sprintf(rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, <span class="stringliteral">&quot;%s.wave&quot;</span>, tmpdesc);</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;  <span class="keywordflow">if</span> (duration &gt; <a class="code" href="_k_s_foundation_8h.html#a3c3e362198a193a273f436e9e392188b">KS_MAXWAVELEN</a> * RF_UPDATE_TIME || duration &lt; 4) {</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_rf_hard(%s): &#39;duration&#39; (3rd arg) must be in range [4, %d]&quot;</span>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, <a class="code" href="_k_s_foundation_8h.html#a3c3e362198a193a273f436e9e392188b">KS_MAXWAVELEN</a> * RF_UPDATE_TIME);</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;  }</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;  <span class="keywordflow">if</span> (duration % 2) {</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_rf_hard(%s): &#39;duration&#39; (3rd arg) must be divisible by 2&quot;</span>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;  }</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> = duration / RF_UPDATE_TIME;</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> = duration;</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#afa10c3dbec21b5cc34276e741deeb97e">iso2end</a> = duration / 2;</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#af9bc4afb4579b2bf18259e70175090a3">start2iso</a> = duration / 2;</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#a6b955cde0388e60c3ec5f602072a8e0f">bw</a> = 0;</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#a7ab9fec3ad0848d2dff5db7279f1a806">flip</a> = flip;</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;  <span class="comment">/* generate waveform with max 1.0 */</span></div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;  <span class="keywordflow">for</span> (i = 0 ; i &lt; rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> ; i++) {</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;    rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[i] = 1.0;</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;  }</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;  <span class="comment">/* initialize amplitude to 1 */</span></div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ab508ded41392ee86a2a619d3e93d2373">amp</a> = 1;</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;  <span class="comment">/* set the usage of the RF PULSE to off until .base.ninst &gt; 0 (see ks_pg_rf() on HOST) */</span></div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.activity = PSD_PULSE_OFF;</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;  <span class="comment">/* initialize number of occurrences of RF pulse to zero */</span></div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.num = 0;</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;  <span class="comment">/* setup rfpulse structure */</span></div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;  STATUS status = <a class="code" href="_k_s_foundation__host_8c.html#ae514f91fbedc683d5e9db931960b79b1">ks_eval_rfstat</a>(rf);</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;  <span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;}</div><div class="ttc" id="struct_k_s___r_f_html_af9bc4afb4579b2bf18259e70175090a3"><div class="ttname"><a href="struct_k_s___r_f.html#af9bc4afb4579b2bf18259e70175090a3">KS_RF::start2iso</a></div><div class="ttdeci">int start2iso</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:793</div></div>
<div class="ttc" id="struct_k_s___r_f_html_ae183c3e4095d1c6d14b3d59a0da97928"><div class="ttname"><a href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">KS_RF::rfpulse</a></div><div class="ttdeci">RF_PULSE rfpulse</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:797</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a7ab9fec3ad0848d2dff5db7279f1a806"><div class="ttname"><a href="struct_k_s___r_f.html#a7ab9fec3ad0848d2dff5db7279f1a806">KS_RF::flip</a></div><div class="ttdeci">float flip</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:789</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aacb2fe1d83c45e8d0525f363bdd6b8a6"><div class="ttname"><a href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a></div><div class="ttdeci">#define KS_DESCRIPTION_LENGTH</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:112</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a708ba4291820da3460f6b2c7be287f06"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a708ba4291820da3460f6b2c7be287f06">ks_init_rf</a></div><div class="ttdeci">void ks_init_rf(KS_RF *rf)</div><div class="ttdoc">Resets a KS_RF sequence object to its default value (KS_INIT_RF)</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:57</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">KS_WAVE::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:516</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_ae514f91fbedc683d5e9db931960b79b1"><div class="ttname"><a href="_k_s_foundation__host_8c.html#ae514f91fbedc683d5e9db931960b79b1">ks_eval_rfstat</a></div><div class="ttdeci">STATUS ks_eval_rfstat(KS_RF *rf)</div><div class="ttdoc">Sets up the RF_PULSE structure of a KS_RF object</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:1359</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a2a9b610a78cdae3ac8ef682bd34f7e0d"><div class="ttname"><a href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">KS_RF::rfwave</a></div><div class="ttdeci">KS_WAVE rfwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:798</div></div>
<div class="ttc" id="struct_k_s___r_f_html_ab508ded41392ee86a2a619d3e93d2373"><div class="ttname"><a href="struct_k_s___r_f.html#ab508ded41392ee86a2a619d3e93d2373">KS_RF::amp</a></div><div class="ttdeci">float amp</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:792</div></div>
<div class="ttc" id="struct_k_s___r_f_html_afa10c3dbec21b5cc34276e741deeb97e"><div class="ttname"><a href="struct_k_s___r_f.html#afa10c3dbec21b5cc34276e741deeb97e">KS_RF::iso2end</a></div><div class="ttdeci">int iso2end</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:794</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a06d5868fa630d1c05faea3350dbf045c"><div class="ttname"><a href="_k_s_foundation_8h.html#a06d5868fa630d1c05faea3350dbf045c">KS_DESCRIPTION</a></div><div class="ttdeci">char KS_DESCRIPTION[KS_DESCRIPTION_LENGTH]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:178</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a27640b66342aa92e2fecafb0e8471785"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">KS_WAVE::waveform</a></div><div class="ttdeci">KS_WAVEFORM waveform</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:519</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_WAVE::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:518</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a3c3e362198a193a273f436e9e392188b"><div class="ttname"><a href="_k_s_foundation_8h.html#a3c3e362198a193a273f436e9e392188b">KS_MAXWAVELEN</a></div><div class="ttdeci">#define KS_MAXWAVELEN</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:113</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a6b955cde0388e60c3ec5f602072a8e0f"><div class="ttname"><a href="struct_k_s___r_f.html#a6b955cde0388e60c3ec5f602072a8e0f">KS_RF::bw</a></div><div class="ttdeci">float bw</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:790</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3c0a2264659da3604aca0fdb6429a245"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c0a2264659da3604aca0fdb6429a245">&#9670;&nbsp;</a></span>ks_eval_rf_hard_optimal_duration()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_rf_hard_optimal_duration </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_f.html">KS_RF</a> *&#160;</td>
          <td class="paramname"><em>rf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const&#160;</td>
          <td class="paramname"><em>desc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>order</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>flip</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>offsetFreq</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets up a <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object with a rectangular (hard) pulse with optimal duration for fat selection/saturation</h4>
</p>
<p>This function creates a hard RF pulse with optimal duration for fat selection/saturation. Hard pulses are typically used as non-slice selective RF pulses. Their slice profile is sinc-like and with this function you can create a hard pulse with a sinc-minima at the center of the spectral fat-peak. You can select wich minima using the input 'order'. A higher order generates a longer pulse duration with a more narrow frequency response. If the pulse is tuned to the fat peak, using input 'offsetFreq', the minimia will instead end up at the water-peak. The resolution of the RF pulse created is equal to the duration/2</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">rf</td><td><a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object to be created </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">desc</td><td>A description (text string) of the <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object. This description is used for pulse sequence generation (seen in the file generated by <em>TimeHist</em> in <em>MGD Sim/WTools</em>) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">order</td><td>Select wich minima to use </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">flip</td><td>Nominal flip angle of the RF pulse </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">offsetFreq</td><td>choose center frequency offset </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;                                                                                                                     {</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;  <span class="keywordflow">if</span> (order &lt; 1) {</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_rf_hard(%s): &#39;order&#39; (%d, 3rd arg) must be positive&quot;</span>, desc, order);</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;  }</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;  <span class="keywordtype">int</span> duration = RUP_FACTOR((<span class="keywordtype">int</span>)(1000000.0 * sqrt(pow(2.0 * PI * (<span class="keywordtype">float</span>)order, 2) - pow((<span class="keywordtype">float</span>)flip * (PI / 180.0), 2)) / fabs(2.0 * PI * offsetFreq)), GRAD_UPDATE_TIME);</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__host_8c.html#a8d9410f5debf5ed4aa11db99d43cd1aa">ks_eval_rf_hard</a>(rf, desc, duration, flip);</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a8d9410f5debf5ed4aa11db99d43cd1aa"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a8d9410f5debf5ed4aa11db99d43cd1aa">ks_eval_rf_hard</a></div><div class="ttdeci">STATUS ks_eval_rf_hard(KS_RF *rf, const char *const desc, int duration, float flip)</div><div class="ttdoc">Sets up a KS_RF object with a rectangular (hard) pulse of a given duration. </div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:1153</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af7e14a08fa48500dfc6546b1b3bbad35"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af7e14a08fa48500dfc6546b1b3bbad35">&#9670;&nbsp;</a></span>ks_eval_rf_binomial()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_rf_binomial </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_f.html">KS_RF</a> *&#160;</td>
          <td class="paramname"><em>rf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const&#160;</td>
          <td class="paramname"><em>desc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>offResExc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nPulses</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>flip</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>offsetFreq</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets up a <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object as a Binomial RF pulse</h4>
</p>
<p>This function creates a binomial RF pulse, which consists of a series of hard pulses. Binomial pulses are used for spectral selection. They utilize the difference in resonance frequency of different tissue types, such as water and fat. Increasing the number of sub-pulses will improve the spectral selectivity but also increse the pulse duration.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">rf</td><td><a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object to be created </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">desc</td><td>A description (text string) of the <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object. This description is used for pulse sequence generation (seen in the file generated by <em>TimeHist</em> in <em>MGD Sim/WTools</em>) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">offResExc</td><td>If 0 the pulse will excite the spinns at the center frequency, If 1 the pulse will excite the spinns at the offset frequency (given by input: offsetFreq) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nPulses</td><td>Number of sub-pulses </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">flip</td><td>Nominal flip angle of the RF pulse </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">offsetFreq</td><td>choose center frequency offset in Hz </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;                                                                                                                         {</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a06d5868fa630d1c05faea3350dbf045c">KS_DESCRIPTION</a> tmpdesc;</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;  <span class="keywordtype">int</span> i, j;</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;  <span class="comment">/* Don&#39;t allow empty description or a description with leading space */</span></div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;  <span class="keywordflow">if</span> (desc == NULL || desc[0] == <span class="charliteral">&#39; &#39;</span>) {</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_rf_binomial: RF name (2nd arg) cannot be NULL or leading space&quot;</span>);</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;  }</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;  strncpy(tmpdesc, desc, <a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a>/2);</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;  tmpdesc[<a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a>/2] = 0;</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;  <span class="comment">/* Reset RF object */</span></div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#a708ba4291820da3460f6b2c7be287f06">ks_init_rf</a>(rf);</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;  <span class="comment">/* Fill in wave object */</span></div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;  sprintf(rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, <span class="stringliteral">&quot;%s.wave&quot;</span>, tmpdesc);</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;  <span class="keywordflow">if</span> (offResExc &lt; 0 || offResExc &gt; 1) {</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_rf_hard(%s): &#39;offResExc&#39; (3rd arg) must be either 0 or 1&quot;</span>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;  }</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;  <span class="keywordflow">if</span> (nPulses &lt; 2 || nPulses &gt; 10) {</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_rf_hard(%s): &#39;nPulses&#39; (4th arg) must be in range [2, 10]&quot;</span>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;  }</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;  <span class="keywordtype">int</span> pascalstriangle[9][10] = { {1,1},</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;                                {1,2,1},</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;                               {1,3,3,1},</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;                              {1,4,6,4,1},</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;                            {1,5,10,10,5,1},</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;                           {1,6,15,20,15,6,1},</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;                          {1,7,21,35,35,21,7,1},</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;                         {1,8,28,56,70,56,28,8,1},</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;                       {1,9,36,84,126,126,84,36,9,1} };</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;  <span class="keywordtype">int</span> P[10];</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;  <span class="keywordtype">int</span> pulseSum = 0;</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; nPulses; i++) {</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;    P[i] = pascalstriangle[nPulses - 2][i];</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;    pulseSum += P[i];</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;  }</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;  <span class="comment">/* Calculate subpulse separation */</span></div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;  <span class="keywordtype">float</span> tau = fabs(1.0 / (2.0 * offsetFreq)); <span class="comment">/* sec */</span></div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;  <span class="comment">/* Calculate number of samples so that each subpulse is as close as possible to maxB1, without exceeding it */</span></div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;  <span class="keywordtype">float</span> <a class="code" href="_g_e_required_8e.html#a5dfe9b1d5c3f79c53ef1e8513159ce18">maxB1</a> = 0.20; <span class="comment">/* Gauss */</span></div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;  <span class="keywordtype">float</span> pulseArea = (float) flip * (PI / 180.0); <span class="comment">/* radians or Hz (depending on how you look at it) */</span></div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;  <span class="keywordtype">float</span> dt = RF_UPDATE_TIME / 1000000.0; <span class="comment">/* sec */</span></div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;  <span class="keywordtype">float</span> subArea[10];</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;  <span class="keywordtype">int</span> ntp[10];</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; nPulses; i++) {</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;    subArea[i] = (P[i] * pulseArea) / (pulseSum * 2.0 * PI * <a class="code" href="_k_s_foundation__host_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a>); <span class="comment">/* Gauss * sec */</span></div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;    ntp[i] = ceil(subArea[i] / (<a class="code" href="_g_e_required_8e.html#a5dfe9b1d5c3f79c53ef1e8513159ce18">maxB1</a> * dt)); <span class="comment">/* number of time points in sub pulse */</span></div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;    <span class="keywordflow">if</span> (ntp[i] &lt; 4 ) {</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;      ntp[i] = 4;</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;    }</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;  }</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;  <span class="keywordtype">int</span> idx = 0;</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; nPulses; i++) {</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;    <span class="comment">/* Calculate how much we have to attenuate this pulse</span></div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;<span class="comment">       to account for the fact that with this dwell time</span></div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;<span class="comment">       we couldn&#39;t hit the target flip exactly */</span></div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;    <span class="keywordtype">float</span> currentSubArea = ntp[i] * dt * <a class="code" href="_g_e_required_8e.html#a5dfe9b1d5c3f79c53ef1e8513159ce18">maxB1</a>; <span class="comment">/* Gauss * sec */</span></div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;    <span class="keywordtype">float</span> amp = <a class="code" href="_g_e_required_8e.html#a5dfe9b1d5c3f79c53ef1e8513159ce18">maxB1</a> * (subArea[i] / currentSubArea); <span class="comment">/* Gauss */</span></div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;    <span class="comment">/* Flip every other sub pulse for off resonace excitaion */</span></div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;    <span class="keywordflow">if</span> (offResExc) {</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;      <span class="comment">/* make sure the second center sub-pulse flips in the right direction */</span></div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;      amp *= pow(-1.0, (<span class="keywordtype">float</span>)(i + nPulses/2 % 2));</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;    }</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;    <span class="comment">/* Stitch on the sub pulse */</span></div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;    <span class="keywordflow">for</span> (j = 0; j &lt; ntp[i]; j++) {</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;      rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[idx] = amp;</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;      idx++;</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;    }</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;    <span class="comment">/* Stitch on the gap, skip for last sub pulse */</span></div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;    <span class="keywordflow">if</span> (i &lt; nPulses - 1) {</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;      <span class="keywordtype">int</span> ntp_gap = ceil(tau / dt - (<span class="keywordtype">float</span>)ntp[i] / 2.0 - (<span class="keywordtype">float</span>)ntp[i + 1] / 2.0);</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;      <span class="keywordflow">for</span> (j = 0; j &lt; ntp_gap; j++) {</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;        rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[idx] = 0.0;</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;        idx++;</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;      }</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;    }</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;  }</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;  <span class="comment">/* Make sure the resolution is divisible by 2 and the duration divisible by 4 */</span></div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> = RUP_FACTOR(idx, 4);</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> = rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> * RF_UPDATE_TIME;</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#afa10c3dbec21b5cc34276e741deeb97e">iso2end</a> = rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> / 2;</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#af9bc4afb4579b2bf18259e70175090a3">start2iso</a> = rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> / 2;</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#a6b955cde0388e60c3ec5f602072a8e0f">bw</a> = 0; <span class="comment">/* ? */</span></div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#a7ab9fec3ad0848d2dff5db7279f1a806">flip</a> = flip;</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;  <span class="comment">/* If the resolution has been rounded up, place zeros at the end */</span></div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;  <span class="keywordflow">for</span> (j = idx; j &lt; rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>; j++) {</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;    rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[j] = 0.0;</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;  }</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;  <span class="comment">/* Normalize waveform to one */</span></div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a23b3d305df1e2ad0563f8a2fea2330df">ks_wave_multiplyval</a>(&amp;rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>, 1.0 / <a class="code" href="_k_s_foundation_8h.html#a2bfec427bf5a8966edf279b2eba23396">ks_wave_absmax</a>(&amp;rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>));</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;  <span class="comment">/* Initialize amplitude to one */</span></div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ab508ded41392ee86a2a619d3e93d2373">amp</a> = 1;</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;  <span class="comment">/* Set the usage of the RF PULSE to off until .base.ninst &gt; 0 (see ks_pg_rf() on HOST) */</span></div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.activity = PSD_PULSE_OFF;</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;  <span class="comment">/* Never allow binomial RF pulses to be stretched. We can avoid this by always setting extgradfile = 1 (even if this is not the case) */</span></div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.extgradfile = 1;</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;  <span class="comment">/* Initialize number of occurrences of RF pulse to zero */</span></div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.num = 0;</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;  <span class="comment">/* Save original waveform to fool rfstat, with abs(waveform) */</span></div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;  <span class="keywordtype">float</span> *saveWave = alloca(rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;  <span class="keywordflow">if</span> (offResExc) {</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;    memcpy(saveWave, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;    <span class="keywordflow">for</span> (j = 0; j &lt; rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>; j++) {</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;      rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[j] = fabs(rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[j]);</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;    }</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;  }</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;  <span class="comment">/* Setup rfpulse structure */</span></div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;  STATUS status = <a class="code" href="_k_s_foundation__host_8c.html#ae514f91fbedc683d5e9db931960b79b1">ks_eval_rfstat</a>(rf);</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;  <span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;  <span class="comment">/* Put back the correct waveform */</span></div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;  <span class="keywordflow">if</span> (offResExc) {</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;    memcpy(rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, saveWave, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;  }</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;}</div><div class="ttc" id="struct_k_s___r_f_html_af9bc4afb4579b2bf18259e70175090a3"><div class="ttname"><a href="struct_k_s___r_f.html#af9bc4afb4579b2bf18259e70175090a3">KS_RF::start2iso</a></div><div class="ttdeci">int start2iso</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:793</div></div>
<div class="ttc" id="struct_k_s___r_f_html_ae183c3e4095d1c6d14b3d59a0da97928"><div class="ttname"><a href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">KS_RF::rfpulse</a></div><div class="ttdeci">RF_PULSE rfpulse</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:797</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a2875ace95558531062d08465b2bcc282"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a></div><div class="ttdeci">float GAM</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a7ab9fec3ad0848d2dff5db7279f1a806"><div class="ttname"><a href="struct_k_s___r_f.html#a7ab9fec3ad0848d2dff5db7279f1a806">KS_RF::flip</a></div><div class="ttdeci">float flip</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:789</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a2bfec427bf5a8966edf279b2eba23396"><div class="ttname"><a href="_k_s_foundation_8h.html#a2bfec427bf5a8966edf279b2eba23396">ks_wave_absmax</a></div><div class="ttdeci">float ks_wave_absmax(const KS_WAVE *wave)</div><div class="ttdoc">Returns the maximum absolute value in a KS_WAVE sequence object</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:986</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aacb2fe1d83c45e8d0525f363bdd6b8a6"><div class="ttname"><a href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a></div><div class="ttdeci">#define KS_DESCRIPTION_LENGTH</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:112</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a708ba4291820da3460f6b2c7be287f06"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a708ba4291820da3460f6b2c7be287f06">ks_init_rf</a></div><div class="ttdeci">void ks_init_rf(KS_RF *rf)</div><div class="ttdoc">Resets a KS_RF sequence object to its default value (KS_INIT_RF)</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:57</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">KS_WAVE::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:516</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_ae514f91fbedc683d5e9db931960b79b1"><div class="ttname"><a href="_k_s_foundation__host_8c.html#ae514f91fbedc683d5e9db931960b79b1">ks_eval_rfstat</a></div><div class="ttdeci">STATUS ks_eval_rfstat(KS_RF *rf)</div><div class="ttdoc">Sets up the RF_PULSE structure of a KS_RF object</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:1359</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a2a9b610a78cdae3ac8ef682bd34f7e0d"><div class="ttname"><a href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">KS_RF::rfwave</a></div><div class="ttdeci">KS_WAVE rfwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:798</div></div>
<div class="ttc" id="struct_k_s___r_f_html_ab508ded41392ee86a2a619d3e93d2373"><div class="ttname"><a href="struct_k_s___r_f.html#ab508ded41392ee86a2a619d3e93d2373">KS_RF::amp</a></div><div class="ttdeci">float amp</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:792</div></div>
<div class="ttc" id="struct_k_s___r_f_html_afa10c3dbec21b5cc34276e741deeb97e"><div class="ttname"><a href="struct_k_s___r_f.html#afa10c3dbec21b5cc34276e741deeb97e">KS_RF::iso2end</a></div><div class="ttdeci">int iso2end</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:794</div></div>
<div class="ttc" id="_g_e_required_8e_html_a5dfe9b1d5c3f79c53ef1e8513159ce18"><div class="ttname"><a href="_g_e_required_8e.html#a5dfe9b1d5c3f79c53ef1e8513159ce18">maxB1</a></div><div class="ttdeci">float maxB1[MAX_ENTRY_POINTS]</div><div class="ttdef"><b>Definition:</b> GERequired.e:260</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a06d5868fa630d1c05faea3350dbf045c"><div class="ttname"><a href="_k_s_foundation_8h.html#a06d5868fa630d1c05faea3350dbf045c">KS_DESCRIPTION</a></div><div class="ttdeci">char KS_DESCRIPTION[KS_DESCRIPTION_LENGTH]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:178</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a23b3d305df1e2ad0563f8a2fea2330df"><div class="ttname"><a href="_k_s_foundation_8h.html#a23b3d305df1e2ad0563f8a2fea2330df">ks_wave_multiplyval</a></div><div class="ttdeci">void ks_wave_multiplyval(KS_WAVE *wave, float val)</div><div class="ttdoc">In-place scalar multiplication of a KS_WAVE</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1135</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a27640b66342aa92e2fecafb0e8471785"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">KS_WAVE::waveform</a></div><div class="ttdeci">KS_WAVEFORM waveform</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:519</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_WAVE::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:518</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a6b955cde0388e60c3ec5f602072a8e0f"><div class="ttname"><a href="struct_k_s___r_f.html#a6b955cde0388e60c3ec5f602072a8e0f">KS_RF::bw</a></div><div class="ttdeci">float bw</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:790</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a380824e8f0a73be90f4f4afa69d1d07e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a380824e8f0a73be90f4f4afa69d1d07e">&#9670;&nbsp;</a></span>ks_eval_rfstat()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_rfstat </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_f.html">KS_RF</a> *&#160;</td>
          <td class="paramname"><em>rf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets up the RF_PULSE structure of a <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object</h4>
</p>
<p>For RF scaling, SAR calculation, and RF heating calculations, GE uses a global array of RF_PULSE structs, where each RF pulse is associated with one RF_PULSE struct each. This struct array contains RF pulses from Prescan as well as the pulse sequence itself, and is normally declared in a grad_rf_&lt;psd&gt;.h file.</p>
<p>Here, each <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object has its own RF_PULSE struct (the field <code>.rfpulse</code>), which this function sets up. The following fields in the <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object must be set before calling this <a class="el" href="_k_s_foundation_8h.html#a380824e8f0a73be90f4f4afa69d1d07e" title="Sets up the RF_PULSE structure of a KS_RF object">ks_eval_rfstat()</a></p><ol type="1">
<li><code>.rfwave</code>: Must contain the RF pulse waveform. An error is return if either <code>.thetawave</code> or <code>.omegawave</code> are non-empty (complex RF pulses not allowed)</li>
<li><code>.bw</code>: The bandwidth of the RF pulse [Hz]</li>
<li><code>.iso2end</code>: Time from the magnetic center of the RF pulse to the end, in [us]</li>
<li><code>.flip</code>: The flip angle of the RF pulse [degrees]. In this function, <code>.flip</code> will set <code>.rfpulse.nom_fa</code> and make sure <code>.rfpulse.act_fa</code> points to <code>.flip</code></li>
</ol>
<p>The RF waveform will be amplitude scaled so that its maximum absolute amplitude is 1.0 before making the calculations. Also the proper links between fields int the <code>.rfpulse</code> (RF_PULSE) struct and the parent fields in <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> are set up by calling <a class="el" href="_k_s_foundation_8h.html#acb5bc476c9416f2a3d9c975dd80fbb23" title="(Internal use) Relinks pointers between fields in a KS_RF object">ks_eval_rf_relink()</a></p>
<p>Credits: This function has been made largely after the code by Atsushi Takahashi, GE Healthcare.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">rf</td><td><a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object to calculate the RF_PULSE parameters for (in field <code>.rfpulse</code>) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;                                 {</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;  <span class="keywordtype">double</span> standard_pw = 1e-3;</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;  <span class="keywordtype">double</span> nRFenvelope;</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;  <span class="keywordtype">int</span> indx;</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;  <span class="keywordtype">double</span> area          = 0.0;</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;  <span class="keywordtype">double</span> abswidth      = 0.0;</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;  <span class="keywordtype">double</span> effwidth      = 0.0;</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;  <span class="keywordtype">double</span> dtycyc        = 0.0;</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;  <span class="keywordtype">double</span> max_pw        = 0.0;</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;  <span class="keywordtype">double</span> max_b1        = 0.0;</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;  <span class="keywordtype">double</span> max_int_b1_sq = 0.0;</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;  <span class="keywordtype">double</span> max_rms_b1    = 0.0;</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;  <span class="keywordflow">if</span> (rf-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> &gt; 0 || rf-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> &gt; 0) {</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_rfstat(%s): function is not validated for phase/frequency modulated RF-pulses&quot;</span>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;  }</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;  <span class="comment">/* require fields &#39;duration&#39;, &#39;isodelay&#39; and &#39;bw&#39; to be set to realistic values */</span></div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;  <span class="keywordflow">if</span> (rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> &lt; 4 || rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> &gt; <a class="code" href="_k_s_foundation_8h.html#a3c3e362198a193a273f436e9e392188b">KS_MAXWAVELEN</a> * RF_UPDATE_TIME || rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> % 2) {</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_rfstat: &#39;rf.rfwave.duration&#39; (%d) must be an even number in the range [4,%d] us&quot;</span>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>, <a class="code" href="_k_s_foundation_8h.html#a3c3e362198a193a273f436e9e392188b">KS_MAXWAVELEN</a> * RF_UPDATE_TIME);</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;  }</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;  <span class="keywordflow">if</span> (rf-&gt;<a class="code" href="struct_k_s___r_f.html#a6b955cde0388e60c3ec5f602072a8e0f">bw</a> &lt; 0 || rf-&gt;<a class="code" href="struct_k_s___r_f.html#a6b955cde0388e60c3ec5f602072a8e0f">bw</a> &gt; 100000) {</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_rfstat: &#39;rf.bw&#39; (%f) must be in the range [0,100000] Hz&quot;</span>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a6b955cde0388e60c3ec5f602072a8e0f">bw</a>);</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;  }</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;  <span class="keywordflow">if</span> (rf-&gt;<a class="code" href="struct_k_s___r_f.html#afa10c3dbec21b5cc34276e741deeb97e">iso2end</a> &lt; 0 || rf-&gt;<a class="code" href="struct_k_s___r_f.html#afa10c3dbec21b5cc34276e741deeb97e">iso2end</a> &gt; <a class="code" href="_k_s_foundation_8h.html#a3c3e362198a193a273f436e9e392188b">KS_MAXWAVELEN</a> * RF_UPDATE_TIME) {</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_rfstat: &#39;rf.iso2end&#39; (%d) must be in the range [0,%d] us&quot;</span>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#afa10c3dbec21b5cc34276e741deeb97e">iso2end</a>, <a class="code" href="_k_s_foundation_8h.html#a3c3e362198a193a273f436e9e392188b">KS_MAXWAVELEN</a> * RF_UPDATE_TIME);</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;  }</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;  <span class="keywordflow">if</span> (rf-&gt;<a class="code" href="struct_k_s___r_f.html#a7ab9fec3ad0848d2dff5db7279f1a806">flip</a> &lt; 0.0 || rf-&gt;<a class="code" href="struct_k_s___r_f.html#a7ab9fec3ad0848d2dff5db7279f1a806">flip</a> &gt; 10000.0) {</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_rfstat: &#39;rf.flip&#39; (%.2f) must be in the range [0,3000] deg&quot;</span>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a7ab9fec3ad0848d2dff5db7279f1a806">flip</a>);</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;  }</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;  <span class="comment">/* for reference, see: /ESE_xxxxx/psd/include/private/sar_pm.h  */</span></div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;  <span class="comment">/* normalize RF just in case */</span></div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a23b3d305df1e2ad0563f8a2fea2330df">ks_wave_multiplyval</a>(&amp;rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>, 1.0 / <a class="code" href="_k_s_foundation_8h.html#a2bfec427bf5a8966edf279b2eba23396">ks_wave_absmax</a>(&amp;rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>));</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;  <span class="keywordflow">for</span> (indx = 0; indx &lt; rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>; indx++) {</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;    nRFenvelope = rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[indx];</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;    area += nRFenvelope;</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;    abswidth += fabs(nRFenvelope);</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;    effwidth += (nRFenvelope * nRFenvelope);</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;    <span class="comment">/* dtycyc: % of Pulse Widths above 5% power */</span></div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;    <span class="keywordflow">if</span> (fabs(nRFenvelope) &gt; 0.05)</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;      dtycyc++;</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;  }</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;  area     /= rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>;</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;  abswidth /= rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>;</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;  effwidth /= rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>;</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;  dtycyc   /= rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>;</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;  <span class="comment">/* max_pw: % of the pulse width whose widest lobe is above 5% power</span></div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;<span class="comment">     GE uses max_pw = dtycyc for most pulses (sar_pm.h)</span></div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;<span class="comment">     Neither max_pw nor dtycyc seem to match well with the values used in GEs product sequences unlike</span></div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;<span class="comment">     the other fields, which seems to agree within a few percent */</span></div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;  max_pw = dtycyc;</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;  max_b1 = rf-&gt;<a class="code" href="struct_k_s___r_f.html#a7ab9fec3ad0848d2dff5db7279f1a806">flip</a> / 360.0 / (area * (rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>) * 1e-6) / <a class="code" href="_k_s_foundation__host_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a>;</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;  max_int_b1_sq = max_b1 * max_b1 * effwidth * (rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>) * 1e-6 / standard_pw;</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;  max_rms_b1 = sqrt(max_int_b1_sq / ((rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>) * 1e-6) * standard_pw);</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#acb5bc476c9416f2a3d9c975dd80fbb23">ks_eval_rf_relink</a>(rf);</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.abswidth       =  abswidth;</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.effwidth       =  effwidth;</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.area           =  area;</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.dtycyc         =  dtycyc;</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.maxpw          =  max_pw;</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.num            =  0;</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.max_b1         =  max_b1;</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.max_int_b1_sq  =  max_int_b1_sq;</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.max_rms_b1     =  max_rms_b1;</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.nom_fa         =  rf-&gt;<a class="code" href="struct_k_s___r_f.html#a7ab9fec3ad0848d2dff5db7279f1a806">flip</a>;   <span class="comment">/* nom_fa and act_fa are equal */</span></div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.nom_pw         =  rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>;</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.nom_bw         =  rf-&gt;<a class="code" href="struct_k_s___r_f.html#a6b955cde0388e60c3ec5f602072a8e0f">bw</a>;</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.activity       =  PSD_PULSE_OFF; <span class="comment">/* is set to PSD_SCAN_ON by ks_pg_rf() */</span></div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.reference      =  0;</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.isodelay       =  rf-&gt;<a class="code" href="struct_k_s___r_f.html#afa10c3dbec21b5cc34276e741deeb97e">iso2end</a>;</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.scale          =  1.0;</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;  <span class="keywordflow">if</span> (rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.extgradfile != 1) {</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;    rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.extgradfile =  0; <span class="comment">/* Only allow 0 or 1. Disallows RF pulse stretching if 1 */</span></div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;  }</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;}</div><div class="ttc" id="struct_k_s___r_f_html_ae183c3e4095d1c6d14b3d59a0da97928"><div class="ttname"><a href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">KS_RF::rfpulse</a></div><div class="ttdeci">RF_PULSE rfpulse</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:797</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a2875ace95558531062d08465b2bcc282"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a></div><div class="ttdeci">float GAM</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a7ab9fec3ad0848d2dff5db7279f1a806"><div class="ttname"><a href="struct_k_s___r_f.html#a7ab9fec3ad0848d2dff5db7279f1a806">KS_RF::flip</a></div><div class="ttdeci">float flip</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:789</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a2bfec427bf5a8966edf279b2eba23396"><div class="ttname"><a href="_k_s_foundation_8h.html#a2bfec427bf5a8966edf279b2eba23396">ks_wave_absmax</a></div><div class="ttdeci">float ks_wave_absmax(const KS_WAVE *wave)</div><div class="ttdoc">Returns the maximum absolute value in a KS_WAVE sequence object</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:986</div></div>
<div class="ttc" id="struct_k_s___r_f_html_aecd8b68c159a31a28e2a2ec003b593e2"><div class="ttname"><a href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">KS_RF::thetawave</a></div><div class="ttdeci">KS_WAVE thetawave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:800</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">KS_WAVE::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:516</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a2a9b610a78cdae3ac8ef682bd34f7e0d"><div class="ttname"><a href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">KS_RF::rfwave</a></div><div class="ttdeci">KS_WAVE rfwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:798</div></div>
<div class="ttc" id="struct_k_s___r_f_html_afa10c3dbec21b5cc34276e741deeb97e"><div class="ttname"><a href="struct_k_s___r_f.html#afa10c3dbec21b5cc34276e741deeb97e">KS_RF::iso2end</a></div><div class="ttdeci">int iso2end</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:794</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_acb5bc476c9416f2a3d9c975dd80fbb23"><div class="ttname"><a href="_k_s_foundation__host_8c.html#acb5bc476c9416f2a3d9c975dd80fbb23">ks_eval_rf_relink</a></div><div class="ttdeci">void ks_eval_rf_relink(KS_RF *rf)</div><div class="ttdoc">(Internal use) Relinks pointers between fields in a KS_RF object</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:1515</div></div>
<div class="ttc" id="struct_k_s___r_f_html_aa283d0a503cfda1c25da9f9b9a0d8b1c"><div class="ttname"><a href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">KS_RF::omegawave</a></div><div class="ttdeci">KS_WAVE omegawave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:799</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a23b3d305df1e2ad0563f8a2fea2330df"><div class="ttname"><a href="_k_s_foundation_8h.html#a23b3d305df1e2ad0563f8a2fea2330df">ks_wave_multiplyval</a></div><div class="ttdeci">void ks_wave_multiplyval(KS_WAVE *wave, float val)</div><div class="ttdoc">In-place scalar multiplication of a KS_WAVE</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1135</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a27640b66342aa92e2fecafb0e8471785"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">KS_WAVE::waveform</a></div><div class="ttdeci">KS_WAVEFORM waveform</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:519</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_WAVE::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:518</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a3c3e362198a193a273f436e9e392188b"><div class="ttname"><a href="_k_s_foundation_8h.html#a3c3e362198a193a273f436e9e392188b">KS_MAXWAVELEN</a></div><div class="ttdeci">#define KS_MAXWAVELEN</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:113</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a6b955cde0388e60c3ec5f602072a8e0f"><div class="ttname"><a href="struct_k_s___r_f.html#a6b955cde0388e60c3ec5f602072a8e0f">KS_RF::bw</a></div><div class="ttdeci">float bw</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:790</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a187dd827bc0f2be7f9a00f20802fca91"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a187dd827bc0f2be7f9a00f20802fca91">&#9670;&nbsp;</a></span>ks_eval_rf()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_rf </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_f.html">KS_RF</a> *&#160;</td>
          <td class="paramname"><em>rf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const&#160;</td>
          <td class="paramname"><em>desc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets up a <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object</h4>
</p>
<p>See documentation for the <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object for details on how to prepare the <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object before calling <a class="el" href="_k_s_foundation_8h.html#a187dd827bc0f2be7f9a00f20802fca91" title="Sets up a KS_RF object">ks_eval_rf()</a></p>
<p>This function does <em>not</em> set up a <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object by itself, merely it peforms final validation, naming, makes sure fields and links in <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> are properly set up. <a class="el" href="_k_s_foundation_8h.html#a187dd827bc0f2be7f9a00f20802fca91" title="Sets up a KS_RF object">ks_eval_rf()</a> should be called for non-slice selective RF pulses. For slice-selective RF pulses, use <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> and call <a class="el" href="_k_s_foundation_8h.html#ad77a28d39f423bca930ee2f8f392de17" title="Sets up a KS_SELRF object for RF slice selection with preset gradient constraints">ks_eval_selrf()</a> instead</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">rf</td><td>Pointer to the <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object to be set up </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">desc</td><td>A description (text string) of the <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object. This description is used for pulse sequence generation (seen in the file generated by <em>TimeHist</em> in <em>MGD Sim/WTools</em>) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;                                                      {</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;  <span class="keywordflow">if</span> (desc == NULL || desc[0] == <span class="charliteral">&#39; &#39;</span>) {</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_rf: description (2nd arg) cannot be NULL or begin with a space&quot;</span>);</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;    strncpy(rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, desc, <a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> / 2); <span class="comment">/* truncate after half max # chars to allow for suffixes */</span></div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;  }</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#acb5bc476c9416f2a3d9c975dd80fbb23">ks_eval_rf_relink</a>(rf);</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;  <span class="keywordflow">if</span> (rf-&gt;<a class="code" href="struct_k_s___r_f.html#aea7921a9aa2757a88e843476848ddd55">role</a> &lt;= <a class="code" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedace0db3ff9bb8cad071dc42579e9aadaf">KS_RF_ROLE_NOTSET</a> || rf-&gt;<a class="code" href="struct_k_s___r_f.html#aea7921a9aa2757a88e843476848ddd55">role</a> &gt; <a class="code" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedac6b698b041a6da12fb9194c4947ec6e8">KS_RF_ROLE_INV</a>) {</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_rf(%s): &#39;rf.role&#39; is not set or is invalid&quot;</span>, desc);</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;  }</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;  <span class="keywordflow">if</span> (rf-&gt;<a class="code" href="struct_k_s___r_f.html#a7ab9fec3ad0848d2dff5db7279f1a806">flip</a> &lt;= 0.0 || rf-&gt;<a class="code" href="struct_k_s___r_f.html#a7ab9fec3ad0848d2dff5db7279f1a806">flip</a> &gt; 10000.0) {</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_rf(%s): &#39;rf.flip&#39; (%.2f) must be in the range (0,3000] deg&quot;</span>, desc, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a7ab9fec3ad0848d2dff5db7279f1a806">flip</a>);</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;  }</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;  <span class="keywordflow">if</span> (rf-&gt;<a class="code" href="struct_k_s___r_f.html#a6b955cde0388e60c3ec5f602072a8e0f">bw</a> &lt; 0 || rf-&gt;<a class="code" href="struct_k_s___r_f.html#a6b955cde0388e60c3ec5f602072a8e0f">bw</a> &gt; 100000) {</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_rf(%s): &#39;rf.bw&#39; (%.2f)  must be in the range [0,100000]&quot;</span>, desc, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a6b955cde0388e60c3ec5f602072a8e0f">bw</a>);</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;  }</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;  <span class="comment">/* check that RF duration is even */</span></div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;  <span class="keywordflow">if</span> (rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> % 2)</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_rf (%s): RF duration (%d) [us] must be even&quot;</span>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>);</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;  <span class="comment">/* check that RF duration and optional THETA / OMEGA waveforms have same duration */</span></div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;  <span class="keywordflow">if</span> (rf-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>) {</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;    sprintf(rf-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, <span class="stringliteral">&quot;%s&quot;</span>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>); <span class="comment">/* suffix &#39;.x&#39; is added automatically in ks_pg_wave(), where &#39;x&#39; is the 1st letter of the board */</span></div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;    <span class="keywordflow">if</span> (rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> != rf-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>)</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_rf (%s): OMEGA duration (%d) [us] must equal RF duration (%d) [us]&quot;</span>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>);</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;  }</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;  <span class="keywordflow">if</span> (rf-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>) {</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;    sprintf(rf-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, <span class="stringliteral">&quot;%s&quot;</span>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;    <span class="keywordflow">if</span> (rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> != rf-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>)</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_rf (%s): THETA duration (%d) [us] must equal RF duration (%d) [us]&quot;</span>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>);</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;  }</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;  <span class="keywordflow">if</span> (rf-&gt;<a class="code" href="struct_k_s___r_f.html#afa10c3dbec21b5cc34276e741deeb97e">iso2end</a> &lt; 0 || rf-&gt;<a class="code" href="struct_k_s___r_f.html#afa10c3dbec21b5cc34276e741deeb97e">iso2end</a> &gt; rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>) {</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_rf (%s): &#39;rf.iso2end (%d) must in range [0,%d] [us]&quot;</span>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#afa10c3dbec21b5cc34276e741deeb97e">iso2end</a>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>);</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;  }</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;  <span class="comment">/* check that .iso2end is equal to .rfpulse.isodelay */</span></div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;  <span class="keywordflow">if</span> (rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.isodelay != rf-&gt;<a class="code" href="struct_k_s___r_f.html#afa10c3dbec21b5cc34276e741deeb97e">iso2end</a>) {</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_rf (%s): &#39;rf.rfpulse.isodelay (%d) must be equal to &#39;rf.iso2end&#39; (%d) [us]&quot;</span>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.isodelay, rf-&gt;<a class="code" href="struct_k_s___r_f.html#afa10c3dbec21b5cc34276e741deeb97e">iso2end</a>);</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;  }</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.isodelay = RUP_GRD(rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.isodelay); <span class="comment">/* Round up using RUP_GRD() to fall on gradient raster (GRAD_UPDATE_TIME = 4us) */</span></div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#afa10c3dbec21b5cc34276e741deeb97e">iso2end</a> = rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.isodelay;</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#af9bc4afb4579b2bf18259e70175090a3">start2iso</a> = rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> - rf-&gt;<a class="code" href="struct_k_s___r_f.html#afa10c3dbec21b5cc34276e741deeb97e">iso2end</a>; <span class="comment">/* time from start of RF pulse to its magnetic center */</span></div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;  <span class="comment">/* initialize amplitude to 1 */</span></div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ab508ded41392ee86a2a619d3e93d2373">amp</a> = 1;</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;  <span class="comment">/* set the usage of the RF PULSE to off until .base.ninst &gt; 0 (see ks_pg_rf() on HOST) */</span></div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.activity = PSD_PULSE_OFF;</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;  <span class="comment">/* initialize number of occurrences of RF pulse to zero */</span></div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.num = 0;</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;} <span class="comment">/* ks_eval_rf */</span></div><div class="ttc" id="struct_k_s___r_f_html_af9bc4afb4579b2bf18259e70175090a3"><div class="ttname"><a href="struct_k_s___r_f.html#af9bc4afb4579b2bf18259e70175090a3">KS_RF::start2iso</a></div><div class="ttdeci">int start2iso</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:793</div></div>
<div class="ttc" id="struct_k_s___r_f_html_aea7921a9aa2757a88e843476848ddd55"><div class="ttname"><a href="struct_k_s___r_f.html#aea7921a9aa2757a88e843476848ddd55">KS_RF::role</a></div><div class="ttdeci">int role</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:788</div></div>
<div class="ttc" id="struct_k_s___r_f_html_ae183c3e4095d1c6d14b3d59a0da97928"><div class="ttname"><a href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">KS_RF::rfpulse</a></div><div class="ttdeci">RF_PULSE rfpulse</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:797</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aa324c3517656b8ec032523397a142bedac6b698b041a6da12fb9194c4947ec6e8"><div class="ttname"><a href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedac6b698b041a6da12fb9194c4947ec6e8">KS_RF_ROLE_INV</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1750</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a7ab9fec3ad0848d2dff5db7279f1a806"><div class="ttname"><a href="struct_k_s___r_f.html#a7ab9fec3ad0848d2dff5db7279f1a806">KS_RF::flip</a></div><div class="ttdeci">float flip</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:789</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aacb2fe1d83c45e8d0525f363bdd6b8a6"><div class="ttname"><a href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a></div><div class="ttdeci">#define KS_DESCRIPTION_LENGTH</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:112</div></div>
<div class="ttc" id="struct_k_s___r_f_html_aecd8b68c159a31a28e2a2ec003b593e2"><div class="ttname"><a href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">KS_RF::thetawave</a></div><div class="ttdeci">KS_WAVE thetawave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:800</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">KS_WAVE::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:516</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a2a9b610a78cdae3ac8ef682bd34f7e0d"><div class="ttname"><a href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">KS_RF::rfwave</a></div><div class="ttdeci">KS_WAVE rfwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:798</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aa324c3517656b8ec032523397a142bedace0db3ff9bb8cad071dc42579e9aadaf"><div class="ttname"><a href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedace0db3ff9bb8cad071dc42579e9aadaf">KS_RF_ROLE_NOTSET</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1750</div></div>
<div class="ttc" id="struct_k_s___r_f_html_ab508ded41392ee86a2a619d3e93d2373"><div class="ttname"><a href="struct_k_s___r_f.html#ab508ded41392ee86a2a619d3e93d2373">KS_RF::amp</a></div><div class="ttdeci">float amp</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:792</div></div>
<div class="ttc" id="struct_k_s___r_f_html_afa10c3dbec21b5cc34276e741deeb97e"><div class="ttname"><a href="struct_k_s___r_f.html#afa10c3dbec21b5cc34276e741deeb97e">KS_RF::iso2end</a></div><div class="ttdeci">int iso2end</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:794</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_acb5bc476c9416f2a3d9c975dd80fbb23"><div class="ttname"><a href="_k_s_foundation__host_8c.html#acb5bc476c9416f2a3d9c975dd80fbb23">ks_eval_rf_relink</a></div><div class="ttdeci">void ks_eval_rf_relink(KS_RF *rf)</div><div class="ttdoc">(Internal use) Relinks pointers between fields in a KS_RF object</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:1515</div></div>
<div class="ttc" id="struct_k_s___r_f_html_aa283d0a503cfda1c25da9f9b9a0d8b1c"><div class="ttname"><a href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">KS_RF::omegawave</a></div><div class="ttdeci">KS_WAVE omegawave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:799</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_WAVE::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:518</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a6b955cde0388e60c3ec5f602072a8e0f"><div class="ttname"><a href="struct_k_s___r_f.html#a6b955cde0388e60c3ec5f602072a8e0f">KS_RF::bw</a></div><div class="ttdeci">float bw</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:790</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="acb5bc476c9416f2a3d9c975dd80fbb23"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acb5bc476c9416f2a3d9c975dd80fbb23">&#9670;&nbsp;</a></span>ks_eval_rf_relink()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_eval_rf_relink </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_f.html">KS_RF</a> *&#160;</td>
          <td class="paramname"><em>rf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>(<em>Internal use</em>) Relinks pointers between fields in a <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object</h4>
</p>
<p>This function is used by other RF functions to make sure that the links from pointers in <code>.rfpulse</code> are relinked to other fields inside the <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object. This function does not need to be called manually as long as either <a class="el" href="_k_s_foundation_8h.html#a187dd827bc0f2be7f9a00f20802fca91" title="Sets up a KS_RF object">ks_eval_rf()</a>, <a class="el" href="_k_s_foundation_8h.html#ad77a28d39f423bca930ee2f8f392de17" title="Sets up a KS_SELRF object for RF slice selection with preset gradient constraints">ks_eval_selrf()</a> are called.</p>
<p>If a <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object is copied to another <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object by simple assignment ('=' sign), then these pointers must be updated before the assigned <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object can be used. Best practice is to call <a class="el" href="_k_s_foundation_8h.html#a187dd827bc0f2be7f9a00f20802fca91" title="Sets up a KS_RF object">ks_eval_rf()</a> or <a class="el" href="_k_s_foundation_8h.html#ad77a28d39f423bca930ee2f8f392de17" title="Sets up a KS_SELRF object for RF slice selection with preset gradient constraints">ks_eval_selrf()</a> instead of this function, as more validation is performed and because description of the new <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> is also updated</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">rf</td><td>Pointer to the <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object to be set up </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;                                  {</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;  <span class="comment">/* link as required by RF_PULSE */</span></div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.pw = &amp;(rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>);</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.amp = &amp;(rf-&gt;<a class="code" href="struct_k_s___r_f.html#ab508ded41392ee86a2a619d3e93d2373">amp</a>);</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.act_fa = &amp;(rf-&gt;<a class="code" href="struct_k_s___r_f.html#a7ab9fec3ad0848d2dff5db7279f1a806">flip</a>);</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.res = &amp;(rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>);</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.exciter = &amp;<a class="code" href="_k_s_foundation_8h.html#a4dcd93b4f67aeb25541105ec7953c67e">ks_rhoboard</a>;</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_a4dcd93b4f67aeb25541105ec7953c67e"><div class="ttname"><a href="_k_s_foundation_8h.html#a4dcd93b4f67aeb25541105ec7953c67e">ks_rhoboard</a></div><div class="ttdeci">int ks_rhoboard</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:46</div></div>
<div class="ttc" id="struct_k_s___r_f_html_ae183c3e4095d1c6d14b3d59a0da97928"><div class="ttname"><a href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">KS_RF::rfpulse</a></div><div class="ttdeci">RF_PULSE rfpulse</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:797</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a7ab9fec3ad0848d2dff5db7279f1a806"><div class="ttname"><a href="struct_k_s___r_f.html#a7ab9fec3ad0848d2dff5db7279f1a806">KS_RF::flip</a></div><div class="ttdeci">float flip</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:789</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a2a9b610a78cdae3ac8ef682bd34f7e0d"><div class="ttname"><a href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">KS_RF::rfwave</a></div><div class="ttdeci">KS_WAVE rfwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:798</div></div>
<div class="ttc" id="struct_k_s___r_f_html_ab508ded41392ee86a2a619d3e93d2373"><div class="ttname"><a href="struct_k_s___r_f.html#ab508ded41392ee86a2a619d3e93d2373">KS_RF::amp</a></div><div class="ttdeci">float amp</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:792</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_WAVE::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:518</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a38e6cbd20c6ca7972e583360a1fb67c3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a38e6cbd20c6ca7972e583360a1fb67c3">&#9670;&nbsp;</a></span>ks_eval_stretch_rf()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_stretch_rf </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_f.html">KS_RF</a> *&#160;</td>
          <td class="paramname"><em>rf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>stretch_factor</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>In-place stretching of a <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object</h4>
</p>
<p>This function takes a <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object already set up, having some resolution (<code>rfwave.res</code>), bandwidth (<code>.bw</code>), duration (<code>rfwave.duration</code>) and waveform (<code>.rfwave.waveform</code>) and performs a linear interpolation of the waveform contained in <code>.rfwave.waveform</code> so its new duration becomes</p>
<p><code>newDuration = oldDuration * stretch_factor</code></p>
<ul>
<li>Note that regardless of the input resolution of the waveform, the output resolution will always be newDuration/2.</li>
<li>The description of the stretched <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object (<code>.rfwave.description</code>) is updated with a suffix <em>stretched</em></li>
<li>The fields <code>.start2iso</code>, <code>.iso2end</code> and <code>.bw</code> are automatically updated to reflect the new duration</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">rf</td><td>Pointer to the <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object to be stretched </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">stretch_factor</td><td>Stretch factor (float) that widens/shortens the RF pulse if larger/smaller than 1.0. If negative, the RF waveform will be mirrored (in time) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;                                                           {</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;</div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;  STATUS status;</div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;  <span class="keywordtype">int</span> idx;</div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="_g_e_required_8e.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a> = 0;</div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;  <span class="keywordtype">int</span> mirror_rfpulse = 0;</div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;</div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;  <span class="keywordflow">if</span> (stretch_factor == 1.0) {</div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;    <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;  }</div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;</div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;  mirror_rfpulse = (stretch_factor &lt; 0); <span class="comment">/* we are going to mirror the RF pulse after stretching */</span></div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;  stretch_factor = fabsf(stretch_factor);</div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;</div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;  <span class="keywordflow">if</span> (stretch_factor &lt; FLT_EPSILON) {</div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: can not stretch by %f&quot;</span>, __FUNCTION__, stretch_factor);</div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;  }</div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;</div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;  <span class="comment">/* get original duration/resolution and calculate new duration/resolution */</span></div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;  <span class="keywordtype">int</span> orgDur = rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>;</div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;  <span class="keywordtype">int</span> newDur = RUP_GRD((<span class="keywordtype">int</span>)(orgDur * stretch_factor));</div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;  <span class="keywordtype">int</span> orgRes = rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>;</div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;  <span class="keywordtype">int</span> newRes = newDur/RF_UPDATE_TIME;</div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;</div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;  <span class="comment">/* create index for interpolation */</span></div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;  <span class="keywordtype">float</span> *orgGrid = alloca(orgRes * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;  <span class="keywordtype">float</span> *newGrid = alloca(newRes * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;  <span class="keywordflow">for</span> (idx = 0; idx &lt; orgRes; idx++) {</div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;    orgGrid[idx] = (float) idx / (orgRes-1);</div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;  }</div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;  <span class="keywordflow">for</span> (idx = 0; idx &lt; newRes; idx++) {</div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;    newGrid[idx] = (float) idx / (newRes-1);</div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;  }</div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;</div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_g_e_required_8e.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a> == 1) {<a class="code" href="_k_s_foundation__host_8c.html#a01d67d3faa8f2088f82af10aa0a28af0">ks_print_waveform</a>(rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, <span class="stringliteral">&quot;stretch_orgrf.txt&quot;</span>, orgRes); }</div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;</div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;  <span class="comment">/* perform linear interpolation */</span></div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#abff3210ecf672ab9eaa08d4bd2316825">ks_eval_linear_interp1</a>(orgGrid, orgRes, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, newGrid, newRes, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>);</div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;</div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_g_e_required_8e.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a> == 1) {<a class="code" href="_k_s_foundation__host_8c.html#a01d67d3faa8f2088f82af10aa0a28af0">ks_print_waveform</a>(rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, <span class="stringliteral">&quot;stretch_newrf.txt&quot;</span>, newRes); }</div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;</div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;  <span class="comment">/* set new duration, resolution and bandwidth */</span></div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> = newDur;</div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> = newRes;</div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#a6b955cde0388e60c3ec5f602072a8e0f">bw</a> *= ((float)orgDur/newDur);</div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.isodelay = RUP_FACTOR((<span class="keywordtype">int</span>)(rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.isodelay * stretch_factor),RF_UPDATE_TIME);</div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#afa10c3dbec21b5cc34276e741deeb97e">iso2end</a> = rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.isodelay;</div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#af9bc4afb4579b2bf18259e70175090a3">start2iso</a> = rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> - rf-&gt;<a class="code" href="struct_k_s___r_f.html#afa10c3dbec21b5cc34276e741deeb97e">iso2end</a>;</div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;</div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;  <span class="keywordflow">if</span> (mirror_rfpulse) {</div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;    rf-&gt;<a class="code" href="struct_k_s___r_f.html#afa10c3dbec21b5cc34276e741deeb97e">iso2end</a> = rf-&gt;<a class="code" href="struct_k_s___r_f.html#af9bc4afb4579b2bf18259e70175090a3">start2iso</a>; <span class="comment">/* N.B.: start2iso will be updated again in ks_eval_rf() */</span></div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;    rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.isodelay = rf-&gt;<a class="code" href="struct_k_s___r_f.html#af9bc4afb4579b2bf18259e70175090a3">start2iso</a>;</div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;    <a class="code" href="_k_s_foundation__host_8c.html#ab970a46d592fc615a856f469532b7de1">ks_eval_mirrorwave</a>(&amp;rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>);</div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;    <a class="code" href="_k_s_foundation__host_8c.html#ab970a46d592fc615a856f469532b7de1">ks_eval_mirrorwave</a>(&amp;rf-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>);</div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;    <a class="code" href="_k_s_foundation__host_8c.html#ab970a46d592fc615a856f469532b7de1">ks_eval_mirrorwave</a>(&amp;rf-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>);</div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;  }</div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;</div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;  <span class="keywordtype">char</span> description[<a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a>];</div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;  sprintf(description, <span class="stringliteral">&quot;%s_stretched&quot;</span>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;  status = <a class="code" href="_k_s_foundation__host_8c.html#a106b3a179fec686052d27fcc87129916">ks_eval_rf</a>(rf, description);</div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;  <span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;</div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;  status = <a class="code" href="_k_s_foundation__host_8c.html#ae514f91fbedc683d5e9db931960b79b1">ks_eval_rfstat</a>(rf);</div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;  <span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;</div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;} <span class="comment">/* EOF */</span></div><div class="ttc" id="_k_s_foundation__host_8c_html_a01d67d3faa8f2088f82af10aa0a28af0"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a01d67d3faa8f2088f82af10aa0a28af0">ks_print_waveform</a></div><div class="ttdeci">void ks_print_waveform(const KS_WAVEFORM waveform, char *filename, int res)</div><div class="ttdoc">Writes a KS_WAVEFORM to disk with the specified filename</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3658</div></div>
<div class="ttc" id="struct_k_s___r_f_html_af9bc4afb4579b2bf18259e70175090a3"><div class="ttname"><a href="struct_k_s___r_f.html#af9bc4afb4579b2bf18259e70175090a3">KS_RF::start2iso</a></div><div class="ttdeci">int start2iso</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:793</div></div>
<div class="ttc" id="_g_e_required_8e_html_ac3e1795766a80ec63b157951b4b9a7d4"><div class="ttname"><a href="_g_e_required_8e.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a></div><div class="ttdeci">int debug</div><div class="ttdef"><b>Definition:</b> GERequired.e:2630</div></div>
<div class="ttc" id="struct_k_s___r_f_html_ae183c3e4095d1c6d14b3d59a0da97928"><div class="ttname"><a href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">KS_RF::rfpulse</a></div><div class="ttdeci">RF_PULSE rfpulse</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:797</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_abff3210ecf672ab9eaa08d4bd2316825"><div class="ttname"><a href="_k_s_foundation__host_8c.html#abff3210ecf672ab9eaa08d4bd2316825">ks_eval_linear_interp1</a></div><div class="ttdeci">void ks_eval_linear_interp1(const float *x, int x_length, const float *y, const float *xx, int xx_length, float *yy)</div><div class="ttdoc">Linear interpolation</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:2511</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aacb2fe1d83c45e8d0525f363bdd6b8a6"><div class="ttname"><a href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a></div><div class="ttdeci">#define KS_DESCRIPTION_LENGTH</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:112</div></div>
<div class="ttc" id="struct_k_s___r_f_html_aecd8b68c159a31a28e2a2ec003b593e2"><div class="ttname"><a href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">KS_RF::thetawave</a></div><div class="ttdeci">KS_WAVE thetawave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:800</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">KS_WAVE::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:516</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_ae514f91fbedc683d5e9db931960b79b1"><div class="ttname"><a href="_k_s_foundation__host_8c.html#ae514f91fbedc683d5e9db931960b79b1">ks_eval_rfstat</a></div><div class="ttdeci">STATUS ks_eval_rfstat(KS_RF *rf)</div><div class="ttdoc">Sets up the RF_PULSE structure of a KS_RF object</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:1359</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a2a9b610a78cdae3ac8ef682bd34f7e0d"><div class="ttname"><a href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">KS_RF::rfwave</a></div><div class="ttdeci">KS_WAVE rfwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:798</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_ab970a46d592fc615a856f469532b7de1"><div class="ttname"><a href="_k_s_foundation__host_8c.html#ab970a46d592fc615a856f469532b7de1">ks_eval_mirrorwave</a></div><div class="ttdeci">STATUS ks_eval_mirrorwave(KS_WAVE *wave)</div><div class="ttdoc">Flips the contents of the KS_WAVEFORM in a KS_WAVE object</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:948</div></div>
<div class="ttc" id="struct_k_s___r_f_html_afa10c3dbec21b5cc34276e741deeb97e"><div class="ttname"><a href="struct_k_s___r_f.html#afa10c3dbec21b5cc34276e741deeb97e">KS_RF::iso2end</a></div><div class="ttdeci">int iso2end</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:794</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a106b3a179fec686052d27fcc87129916"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a106b3a179fec686052d27fcc87129916">ks_eval_rf</a></div><div class="ttdeci">STATUS ks_eval_rf(KS_RF *rf, const char *const desc)</div><div class="ttdoc">Sets up a KS_RF object</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:1451</div></div>
<div class="ttc" id="struct_k_s___r_f_html_aa283d0a503cfda1c25da9f9b9a0d8b1c"><div class="ttname"><a href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">KS_RF::omegawave</a></div><div class="ttdeci">KS_WAVE omegawave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:799</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a27640b66342aa92e2fecafb0e8471785"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">KS_WAVE::waveform</a></div><div class="ttdeci">KS_WAVEFORM waveform</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:519</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_WAVE::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:518</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a6b955cde0388e60c3ec5f602072a8e0f"><div class="ttname"><a href="struct_k_s___r_f.html#a6b955cde0388e60c3ec5f602072a8e0f">KS_RF::bw</a></div><div class="ttdeci">float bw</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:790</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0c7c713519f3218a3b1afcb6917540c0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0c7c713519f3218a3b1afcb6917540c0">&#9670;&nbsp;</a></span>ks_eval_seltrap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_seltrap </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> *&#160;</td>
          <td class="paramname"><em>trap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const&#160;</td>
          <td class="paramname"><em>desc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>slewrate</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>slthick</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>bw</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rfduration</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>(<em>Internal use</em>) Sets up a trapezoid for RF slice selection</h4>
</p>
<p>This function is used by <a class="el" href="_k_s_foundation_8h.html#a91443aae8a97c4481ba841f1bf3dc13a" title="Sets up a KS_SELRF object for RF slice selection, subject to gradients constraints specified as input...">ks_eval_selrf_constrained()</a> (and its wrapper functions, e.g. <a class="el" href="_k_s_foundation_8h.html#ad77a28d39f423bca930ee2f8f392de17" title="Sets up a KS_SELRF object for RF slice selection with preset gradient constraints">ks_eval_selrf()</a>), and there is no need to use this function directly.</p>
<p>Based on the RF bandwidth and duration, this function will create a trapezoid gradient that with this type of RF pulse creates a slice with the desired thickness, by in turn calling <a class="el" href="_k_s_foundation_8h.html#a9261718b4f0e64bab0da0b9e9c2c02f0" title="Returns the gradient amplitude in [G/cm] necessary for slice selection (internal use)">ks_calc_selgradamp()</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">trap</td><td>Pointer to the <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object to be set up </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">desc</td><td>A description (text string) of the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object. This description is used for pulse sequence generation (seen in the file generated by <em>TimeHist</em> in <em>MGD Sim/WTools</em>) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">slewrate</td><td>The maximum allowed slewrate ([(G/cm) / us]). Value of 0.01 corresponds to 100 mT/m/s </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">slthick</td><td>The desired slice thickness in [mm]. If = 0, the slice selection gradient will have zero amplitude (hard pulses) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">bw</td><td>The bandwidth of the RF pulse to use with the gradient. If = 0, the slice selection gradient will have zero amplitude (hard pulses) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rfduration</td><td>The duration of the RF pulse to use with the gradient </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;                                                                                                                        {</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;  <span class="comment">/* Reset all fields and waveforms */</span></div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#a8efdbce2fbb4bf21a6fd8983fdd6d5c7">ks_init_trap</a>(trap);</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;  <span class="keywordflow">if</span> ((rfduration &lt; GRAD_UPDATE_TIME) || (rfduration % GRAD_UPDATE_TIME)) {</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: RF duration must be positive and divisible by 4&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;  }</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;  <span class="keywordflow">if</span> (slthick &lt; 0 || bw &lt; 0) {</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;    <span class="comment">/* N.B.: slthick may be exactly 0, in which case a zero amp gradient is created */</span></div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: slice thickness &amp; bandwidth cannot be negative&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;  }</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;  <span class="keywordflow">if</span> (desc == NULL || desc[0] == <span class="charliteral">&#39; &#39;</span>) {</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_seltrap: trap name (2nd arg) cannot be NULL or begin with a space&quot;</span>);</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;  }</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;  strncpy(trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, desc, <a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> - 1);</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;  trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a> = <a class="code" href="_k_s_foundation_8h.html#a9261718b4f0e64bab0da0b9e9c2c02f0">ks_calc_selgradamp</a>(bw, slthick); <span class="comment">/* amp [G/cm] */</span></div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;  trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a> = RUP_GRD((<span class="keywordtype">int</span>) (trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a> / slewrate)); <span class="comment">/* ramp time [us] */</span></div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;  <span class="keywordflow">if</span> (trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a> &lt;= 0) {</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;    trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a> = 4;</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;  }</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;  trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">plateautime</a> = rfduration; <span class="comment">/* plateau time [us] */</span></div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;  trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> = trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">plateautime</a> + 2 * trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a>; <span class="comment">/* total duration [us] */</span></div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;  trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a97ab43f6fd28920a42d987c8fec4afec">area</a> = (trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">plateautime</a> + trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a>) * trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a>;</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160; <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;}</div><div class="ttc" id="struct_k_s___t_r_a_p_html_a878bb367b07dc7dfb5fef5728d2e5b1d"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">KS_TRAP::plateautime</a></div><div class="ttdeci">int plateautime</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:436</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a8efdbce2fbb4bf21a6fd8983fdd6d5c7"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a8efdbce2fbb4bf21a6fd8983fdd6d5c7">ks_init_trap</a></div><div class="ttdeci">void ks_init_trap(KS_TRAP *trap)</div><div class="ttdoc">Resets a KS_TRAP sequence object to its default value (KS_INIT_TRAP)</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:45</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aacb2fe1d83c45e8d0525f363bdd6b8a6"><div class="ttname"><a href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a></div><div class="ttdeci">#define KS_DESCRIPTION_LENGTH</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:112</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a97ab43f6fd28920a42d987c8fec4afec"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a97ab43f6fd28920a42d987c8fec4afec">KS_TRAP::area</a></div><div class="ttdeci">float area</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:434</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ab508ded41392ee86a2a619d3e93d2373"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">KS_TRAP::amp</a></div><div class="ttdeci">float amp</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:433</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">KS_TRAP::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:432</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a9261718b4f0e64bab0da0b9e9c2c02f0"><div class="ttname"><a href="_k_s_foundation_8h.html#a9261718b4f0e64bab0da0b9e9c2c02f0">ks_calc_selgradamp</a></div><div class="ttdeci">float ks_calc_selgradamp(float rfbw, float slthick)</div><div class="ttdoc">Returns the gradient amplitude in [G/cm] necessary for slice selection (internal use)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:242</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_TRAP::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:437</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_acbc719dc4e48c2a2df0447875e4348ca"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">KS_TRAP::ramptime</a></div><div class="ttdeci">int ramptime</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:435</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a91443aae8a97c4481ba841f1bf3dc13a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a91443aae8a97c4481ba841f1bf3dc13a">&#9670;&nbsp;</a></span>ks_eval_selrf_constrained()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_selrf_constrained </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *&#160;</td>
          <td class="paramname"><em>selrf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const&#160;</td>
          <td class="paramname"><em>desc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>ampmax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>slewrate</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets up a <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> object for RF slice selection, subject to gradients constraints specified as input arguments</h4>
</p>
<p>This function does <em>not</em> set up the <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> field in <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> itself, see <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> and <a class="el" href="_k_s_foundation_8h.html#a187dd827bc0f2be7f9a00f20802fca91" title="Sets up a KS_RF object">ks_eval_rf()</a> for more details on how to prepare the <code>.rf</code> field in <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> before calling <a class="el" href="_k_s_foundation_8h.html#a91443aae8a97c4481ba841f1bf3dc13a" title="Sets up a KS_SELRF object for RF slice selection, subject to gradients constraints specified as input...">ks_eval_selrf_constrained()</a></p>
<p>The following fields in the <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> object must be set up before calling this function:</p><ol type="1">
<li>A ready <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object, with a proper <code>.rf.role</code> (see below for details)</li>
<li><code>.slthick</code>: Slice thickness in [mm]. Note that the slice thickness often needs to be made larger to compensate from slice narrowing due to multiple RF pulses. GE uses usually <code>gscale_rfX</code> CVs with values often between 0.8-0.9. Dividing with this number gives a thicker slice in the calculations. NOTE: <code>.slthick = 0</code> is accepted and results in zero gradient amplitude with minimal 4us ramps and a plateautime = .rf.rfwave.duration (cf. <a class="el" href="_k_s_foundation_8h.html#a0c7c713519f3218a3b1afcb6917540c0" title="(Internal use) Sets up a trapezoid for RF slice selection">ks_eval_seltrap()</a>-&gt;<a class="el" href="_k_s_foundation_8h.html#a9261718b4f0e64bab0da0b9e9c2c02f0" title="Returns the gradient amplitude in [G/cm] necessary for slice selection (internal use)">ks_calc_selgradamp()</a>)</li>
</ol>
<p><a class="el" href="_k_s_foundation_8h.html#a91443aae8a97c4481ba841f1bf3dc13a" title="Sets up a KS_SELRF object for RF slice selection, subject to gradients constraints specified as input...">ks_eval_selrf_constrained()</a> checks <code>.rf.role</code> to decide on how to set up its gradient objects. The following values of <code>.rf.role</code> are allowed:</p><ul>
<li><code>KS_RF_ROLE_EXC</code>, indicating an RF <em>excitation</em> role. <a class="el" href="_k_s_foundation_8h.html#a91443aae8a97c4481ba841f1bf3dc13a" title="Sets up a KS_SELRF object for RF slice selection, subject to gradients constraints specified as input...">ks_eval_selrf_constrained()</a> will in this case:<ul>
<li>disable <code>.pregrad</code></li>
<li>make <code>.grad.plateautime</code> equal to the RF duration (<code>.rf.rfwave.duration</code>) and the gradient amplitude (<code>.grad.amp</code> [G/cm]) will be set to the proper value depending on the BW (<code>.rf.bw</code>) and slice thickness (<code>.slthick</code>). The field <code>.grad.description</code> will have a ".trap" suffix added to it</li>
<li>make <code>.postgrad</code> to have a gradient area that rephases the slice. This is dependent on the isodelay of the RF pulse (<code>.rf.iso2end</code>) and the slice select gradient amplitude (<code>.grad.amp</code>). The field <code>.postgrad.description</code> will have a ".reph" suffix added to it</li>
</ul>
</li>
<li><code>KS_RF_ROLE_REF</code>, indicating an RF <em>refocusing</em> role. <a class="el" href="_k_s_foundation_8h.html#a91443aae8a97c4481ba841f1bf3dc13a" title="Sets up a KS_SELRF object for RF slice selection, subject to gradients constraints specified as input...">ks_eval_selrf_constrained()</a> will in this case:<ul>
<li>use <code>.pregrad</code> to make the left crusher (never <em>bridged</em> with slice selection). The size of the crusher can be controlled by <code>.crusherscale</code>. The field <code>.pregrad.description</code> will have a ".LC" suffix added to it</li>
<li>do the same with <code>.grad</code> as done for <code>KS_RF_ROLE_EXC</code></li>
<li>use <code>.postgrad</code> to make the right crusher (never <em>bridged</em> with slice selection). The size of the crusher can be controlled by <code>.crusherscale</code>. The field <code>.postgrad.description</code> will have a ".RC" suffix added to it</li>
</ul>
</li>
<li><code>KS_RF_ROLE_INV</code>, indicating an RF <em>inversion</em> role. <a class="el" href="_k_s_foundation_8h.html#a91443aae8a97c4481ba841f1bf3dc13a" title="Sets up a KS_SELRF object for RF slice selection, subject to gradients constraints specified as input...">ks_eval_selrf_constrained()</a> will in this case:<ul>
<li>disable <code>.pregrad</code></li>
<li>do the same with <code>.grad</code> as done for <code>KS_RF_ROLE_EXC</code></li>
<li>disable <code>.postgrad</code></li>
</ul>
</li>
<li><code>KS_RF_ROLE_SPSAT</code>, indicating a <em>spatial RF saturation</em>. <a class="el" href="_k_s_foundation_8h.html#a91443aae8a97c4481ba841f1bf3dc13a" title="Sets up a KS_SELRF object for RF slice selection, subject to gradients constraints specified as input...">ks_eval_selrf_constrained()</a> will in this case:<ul>
<li>disable <code>.pregrad</code></li>
<li>do the same with <code>.grad</code> as done for <code>KS_RF_ROLE_EXC</code></li>
<li>use <code>.postgrad</code> to make a gradient spoiler (never <em>bridged</em> with slice selection). The size of the spoiler can be controlled by <code>.crusherscale</code>. The field <code>.postgrad.description</code> will have a ".spoiler" suffix added to it</li>
</ul>
</li>
</ul>
<p>The role <code>KS_RF_ROLE_CHEMSAT</code>, indicates a non-slice selective, chemically selective, RF (usually <em>fat-sat</em>). <a class="el" href="_k_s_foundation_8h.html#a91443aae8a97c4481ba841f1bf3dc13a" title="Sets up a KS_SELRF object for RF slice selection, subject to gradients constraints specified as input...">ks_eval_selrf_constrained()</a> will in this case throw an error since no gradients should be used</p>
<p>There are three wrapper functions to this function (<a class="el" href="_k_s_foundation_8h.html#ad77a28d39f423bca930ee2f8f392de17" title="Sets up a KS_SELRF object for RF slice selection with preset gradient constraints">ks_eval_selrf()</a>, <a class="el" href="_k_s_foundation_8h.html#a86e5857ac625807c2dedd669cb11ede9" title="Sets up a KS_SELRF object for RF slice selection with preset gradient constraints">ks_eval_selrf1()</a>, <a class="el" href="_k_s_foundation_8h.html#add0c1222947d803bcb4ea5ddcc144749" title="Sets up a KS_SELRF object for RF slice selection with preset gradient constraints">ks_eval_selrf2()</a>) that have reduced number of input arguments, and calls <a class="el" href="_k_s_foundation_8h.html#a91443aae8a97c4481ba841f1bf3dc13a" title="Sets up a KS_SELRF object for RF slice selection, subject to gradients constraints specified as input...">ks_eval_selrf_constrained()</a> with different preset gradient constraints. <a class="el" href="_k_s_foundation_8h.html#ad77a28d39f423bca930ee2f8f392de17" title="Sets up a KS_SELRF object for RF slice selection with preset gradient constraints">ks_eval_selrf()</a> makes fewest assumptions, making it the most general choice.</p>
<h4>Using a custom gradient wave for slice selection (<code>.gradwave</code>)</h4>
<p>To support e.g. VERSEd RF excitations, a custom gradient wave can be used. If <code>.gradwave.res &gt; 0</code>, <a class="el" href="_k_s_foundation_8h.html#a91443aae8a97c4481ba841f1bf3dc13a" title="Sets up a KS_SELRF object for RF slice selection, subject to gradients constraints specified as input...">ks_eval_selrf_constrained()</a> will disable <code>.grad</code> and use <code>.gradwave</code> instead. When <code>.rf.role = KS_RF_ROLE_EXC</code>, the rephasing gradient area (in <code>.postgrad</code>) will be calculated by integrating the gradient waveform from the RF isocenter to the end. <code>.gradwave</code> must be created <em>before</em> calling <a class="el" href="_k_s_foundation_8h.html#a91443aae8a97c4481ba841f1bf3dc13a" title="Sets up a KS_SELRF object for RF slice selection, subject to gradients constraints specified as input...">ks_eval_selrf_constrained()</a> using either <a class="el" href="_k_s_foundation_8h.html#a3369441b24c1df15ba2193aae29d3e11" title="Sets up a KS_WAVE object based on a waveform (KS_WAVEFORM) in memory">ks_eval_wave()</a> or <a class="el" href="_k_s_foundation_8h.html#aaf06af6c18f52a777919eaef76d6c617" title="Sets up a KS_WAVE object based on a waveform that resides on disk">ks_eval_wave_file()</a>, and the units must be in [G/cm]. To further scale the amplitude of <code>.gradwave</code> before calling <a class="el" href="_k_s_foundation_8h.html#a91443aae8a97c4481ba841f1bf3dc13a" title="Sets up a KS_SELRF object for RF slice selection, subject to gradients constraints specified as input...">ks_eval_selrf_constrained()</a>, consider e.g. <a class="el" href="_k_s_foundation_8h.html#a23b3d305df1e2ad0563f8a2fea2330df" title="In-place scalar multiplication of a KS_WAVE">ks_wave_multiplyval()</a>, <a class="el" href="_k_s_foundation_8h.html#a2bfec427bf5a8966edf279b2eba23396" title="Returns the maximum absolute value in a KS_WAVE sequence object">ks_wave_absmax()</a>, and possibly <a class="el" href="_k_s_foundation_8h.html#a66a14bcaf8bf19a334866090c1f2ee49" title="In-place scalar addition of a KS_WAVE">ks_wave_addval()</a></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">selrf</td><td>Pointer to the <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> object to be set up </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">desc</td><td>A description (text string) of the <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> object. This description is used for pulse sequence generation (seen in the file generated by <em>TimeHist</em> in <em>MGD Sim/WTools</em>) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ampmax</td><td>The maximum allowed gradient amplitude ([G/cm]) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">slewrate</td><td>The maximum allowed slewrate ([(G/cm) / us]). Value of 0.01 corresponds to 100 mT/m/s </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;                                                                                                         {</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;  <span class="keywordtype">char</span> selname[<a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a>], preselname[<a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a>], postselname[<a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a>];</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;  <span class="keywordtype">float</span> minthick;</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;  <span class="keywordtype">float</span> standard_crusherarea = 2000.0;</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;  STATUS status;</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;  <span class="keywordflow">if</span> (desc == NULL || desc[0] == <span class="charliteral">&#39; &#39;</span>) {</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: description (2nd arg) cannot be NULL or begin with a space&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;  }</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;  <span class="comment">/* setup the RF pulse */</span></div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;  status = <a class="code" href="_k_s_foundation__host_8c.html#a106b3a179fec686052d27fcc87129916">ks_eval_rf</a>(&amp;selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>, desc);</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;  <span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;  <span class="comment">/* with slice selection (trap or gradwave), the RF duration must be divisible by GRAD_UPDATE_TIME (4) [us] */</span></div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;  <span class="keywordflow">if</span> ((selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> &lt; 4) || (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> % 4)) {</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s (%s): RF duration (%d) must be divisible by GRAD_UPDATE_TIME (4)&quot;</span>, __FUNCTION__, desc, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>);</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;  }</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;  <span class="comment">/* init members of selrf to their default state */</span></div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#a8efdbce2fbb4bf21a6fd8983fdd6d5c7">ks_init_trap</a>(&amp;selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a35145c98c931f54a8bf2b97edfb3e4c6">pregrad</a>);</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#a8efdbce2fbb4bf21a6fd8983fdd6d5c7">ks_init_trap</a>(&amp;selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#af33317a98ade78e3ac252b33cbb794af">grad</a>);</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#a8efdbce2fbb4bf21a6fd8983fdd6d5c7">ks_init_trap</a>(&amp;selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a5ac7ed86029ab647ba0c9a656ae9fb37">postgrad</a>);</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#a784f028a220f82adb610919a51c09abb">ks_init_sms_info</a>(&amp;selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#aca53dcf7a61b8beba82e8f9a0c768cb5">sms_info</a>);</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;  <span class="comment">/* Slice thickness */</span></div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;  <span class="comment">/* protect against e.g. +/-Inf thicknesses. Note that we do *NOT* complain about slthick = 0. This is OK and means zero amp dummy gradient */</span></div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;  <span class="keywordflow">if</span> (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#aa89aa200e4334657ad976733bebcbc2a">slthick</a> &lt; 0 || selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#aa89aa200e4334657ad976733bebcbc2a">slthick</a> &gt; 600) {</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s (%s): Thickness not in range [0,600] mm&quot;</span>, __FUNCTION__, desc);</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;  }</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;  minthick = selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a6b955cde0388e60c3ec5f602072a8e0f">bw</a>  / (ampmax * (0.1) * <a class="code" href="_k_s_foundation__host_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a>);</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;  <span class="keywordflow">if</span> (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#aa89aa200e4334657ad976733bebcbc2a">slthick</a> &gt; 0 &amp;&amp; selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#aa89aa200e4334657ad976733bebcbc2a">slthick</a> &lt; minthick) {</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;    <span class="comment">/* N.B.: checking for slthick &gt; 0 above, allows slthick = 0 without leaading to this error (meaning no slice sel amp) */</span></div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s (%s): Minimum thickness (%.1f [mm]) violated&quot;</span>, __FUNCTION__, desc, minthick);</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;  }</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;  <span class="comment">/* if we have a gradwave generated, check that it has the same duration as the rfpulse */</span></div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;  <span class="keywordflow">if</span> (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>) {</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;    <span class="keywordflow">if</span> (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> != selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>) {</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s (%s): Custom gradient wave duration (%d) must equal the RF duration (%d)&quot;</span>, __FUNCTION__, desc, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>);</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;    }</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;    <span class="keywordflow">if</span> (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> % selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>) {</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s (%s): Custom gradient wave duration (%d) must be divisible by res (%d)&quot;</span>, __FUNCTION__, desc, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>);</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;    }</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;    sprintf(selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, <span class="stringliteral">&quot;%s.gradwave&quot;</span>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>); <span class="comment">/* suffix &#39;.x&#39; is added automatically in ks_pg_wave(), where &#39;x&#39; is the 1st letter of the board */</span></div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;  }</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;  <span class="comment">/* Setup the gradients (trapezoid case) */</span></div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;  sprintf(selname, <span class="stringliteral">&quot;%s.trap&quot;</span>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>); <span class="comment">/* suffix &#39;.x&#39; is added automatically in ks_pg_wave(), where &#39;x&#39; is the 1st letter of the board */</span></div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;  <span class="comment">/* slice select */</span></div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;  <span class="keywordflow">if</span> (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> == 0) {</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;    <span class="comment">/* slice select using trapezoid (.grad). If selrf-&gt;slthick = 0 or selrf-&gt;rf.bw = 0, a zero amp gradient will be created to make consistent KS_SELRF</span></div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;<span class="comment">       This is facilitated by ks_eval_seltrap()-&gt;ks_calc_selgradamp() */</span></div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;    status = <a class="code" href="_k_s_foundation__host_8c.html#ace6503c6437af0a5d0278edd735eddd8">ks_eval_seltrap</a>(&amp;selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#af33317a98ade78e3ac252b33cbb794af">grad</a>, selname, slewrate, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#aa89aa200e4334657ad976733bebcbc2a">slthick</a>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a6b955cde0388e60c3ec5f602072a8e0f">bw</a>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>);</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;    <span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;    <span class="keywordflow">if</span> (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a6aa33ad60a96c56283d44d989fe2d499">gradwave_units</a> == <a class="code" href="_k_s_foundation_8h.html#adfc20623c6ef26b08b99174a1a77323caafce08e3915c706e0851da5f4977192c">KS_GRADWAVE_RELATIVE</a>) {</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;      <span class="comment">/* slice select using existing custom waveform (.gradwave) - scaling gradwave amplitude correctly regardless of current amplitude</span></div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;<span class="comment">       assumes that the maximum absolute value in gradwave.waveform corresponds to the gradient amplitude intended for the current rf BW and slthick */</span></div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;      <span class="keywordtype">float</span> maxval = <a class="code" href="_k_s_foundation_8h.html#a8309ba456fc3e23a10111a1439b13e21">ks_wave_max</a>(&amp;selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>); <span class="comment">/* not absmax, but max, to allow for larger negative lobes for e.g. flyback SPSP */</span></div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;      <span class="keywordflow">if</span> (maxval &lt;= 0) {</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;        <span class="comment">/* a gradwave that is strictly below zero, normalize instead by absmax */</span></div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;        maxval = fabs(<a class="code" href="_k_s_foundation_8h.html#adce100a7702e71bfb10377f1652465a2">ks_wave_min</a>(&amp;selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>));</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;      }</div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;      <a class="code" href="_k_s_foundation_8h.html#a23b3d305df1e2ad0563f8a2fea2330df">ks_wave_multiplyval</a>(&amp;selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>, <a class="code" href="_k_s_foundation_8h.html#a9261718b4f0e64bab0da0b9e9c2c02f0">ks_calc_selgradamp</a>(selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a6b955cde0388e60c3ec5f602072a8e0f">bw</a>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#aa89aa200e4334657ad976733bebcbc2a">slthick</a>) / maxval);</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a6aa33ad60a96c56283d44d989fe2d499">gradwave_units</a> == <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>) {</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s (%s): Custom gradient wave scaling policy not set&quot;</span>, __FUNCTION__, desc);</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;    }</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;  }</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;  <span class="keywordflow">switch</span> (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aea7921a9aa2757a88e843476848ddd55">role</a>) {</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;  <span class="comment">/********************************************************************************/</span></div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;  <span class="comment">/*********************** RF SEL EXCITATION **************************************/</span></div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;  <span class="comment">/********************************************************************************/</span></div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedacc16dd3ca09dedaf6334a39ee4e46241">KS_RF_ROLE_EXC</a>:</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;    sprintf(postselname, <span class="stringliteral">&quot;%s.reph&quot;</span>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;    <span class="keywordflow">if</span> (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> == 0) { <span class="comment">/* Slice selection using .grad (KS_TRAP) */</span></div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;      <span class="comment">/* area needed for rephaser */</span></div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;      selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a5ac7ed86029ab647ba0c9a656ae9fb37">postgrad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a97ab43f6fd28920a42d987c8fec4afec">area</a> = -(selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.isodelay + selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a> / 2) * selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a>;</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;    } <span class="keywordflow">else</span> { <span class="comment">/* Slice selection using .gradwave (KS_WAVE) */</span></div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;      <span class="keywordtype">int</span> i, isostart;</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;      <span class="keywordtype">int</span> grad_dwell = selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> / selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>;</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;      <span class="comment">/* rephaser area needed for gradient wave */</span></div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;      selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a5ac7ed86029ab647ba0c9a656ae9fb37">postgrad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a97ab43f6fd28920a42d987c8fec4afec">area</a> = 0;</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;      <span class="keywordflow">if</span> (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#ac89cc20f819623e17ac0696a6dfb2223">iso2end_subpulse</a> != <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>) {</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;        <span class="comment">/* SPSP&#39;s subpulses may be linear, min or max phase pulses, not neccesarily</span></div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;<span class="comment">           centered on the plateau of each lobe. For these pulses, the iso2end_subpulse field</span></div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;<span class="comment">           is not KS_NOTSET (-1). One can also have self-rephased gradwaves, not needing</span></div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;<span class="comment">           a .postgrad. In this case rf.iso2end_subpulse = 0 would disable this, while keeping</span></div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;<span class="comment">           rf.iso2end for TE calculations */</span></div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;        isostart = (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> - selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#ac89cc20f819623e17ac0696a6dfb2223">iso2end_subpulse</a>) / grad_dwell;</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;        isostart = (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> - selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#afa10c3dbec21b5cc34276e741deeb97e">iso2end</a>) / grad_dwell;</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;      }</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;      <span class="keywordflow">for</span> (i = isostart; i &lt; selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>; i++) {</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;        selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a5ac7ed86029ab647ba0c9a656ae9fb37">postgrad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a97ab43f6fd28920a42d987c8fec4afec">area</a> -= selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[i] * grad_dwell;</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;      }</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;    }</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;    <span class="comment">/* setup rephaser trapezoid */</span></div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;    status = <a class="code" href="_k_s_foundation__host_8c.html#ace858b7b1e7182259bcaa098147e5956">ks_eval_trap_constrained</a>(&amp;selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a5ac7ed86029ab647ba0c9a656ae9fb37">postgrad</a>, postselname, ampmax, slewrate, 0);</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;    <span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;  <span class="comment">/********************************************************************************/</span></div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;  <span class="comment">/*********************** RF SEL REFOCUSING **************************************/</span></div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;  <span class="comment">/********************************************************************************/</span></div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142beda8f1b938816b04ffdeb45de47204252fd">KS_RF_ROLE_REF</a>:</div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;    selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a35145c98c931f54a8bf2b97edfb3e4c6">pregrad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a97ab43f6fd28920a42d987c8fec4afec">area</a> = standard_crusherarea * selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a5e361f25d617a7522e7a14d0cba41c77">crusherscale</a>;</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;    selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a5ac7ed86029ab647ba0c9a656ae9fb37">postgrad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a97ab43f6fd28920a42d987c8fec4afec">area</a> = standard_crusherarea * selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a5e361f25d617a7522e7a14d0cba41c77">crusherscale</a>;</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;    sprintf(preselname,  <span class="stringliteral">&quot;%s.LC&quot;</span>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;    sprintf(postselname, <span class="stringliteral">&quot;%s.RC&quot;</span>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;</div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;    status = <a class="code" href="_k_s_foundation__host_8c.html#ace858b7b1e7182259bcaa098147e5956">ks_eval_trap_constrained</a>(&amp;selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a35145c98c931f54a8bf2b97edfb3e4c6">pregrad</a>,  preselname, ampmax, slewrate, 0);</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;    <span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;    status = <a class="code" href="_k_s_foundation__host_8c.html#ace858b7b1e7182259bcaa098147e5956">ks_eval_trap_constrained</a>(&amp;selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a5ac7ed86029ab647ba0c9a656ae9fb37">postgrad</a>, postselname, ampmax, slewrate, 0);</div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;    <span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;  <span class="comment">/********************************************************************************/</span></div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;  <span class="comment">/*********************** RF SEL INVERSION ***************************************/</span></div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;  <span class="comment">/********************************************************************************/</span></div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedac6b698b041a6da12fb9194c4947ec6e8">KS_RF_ROLE_INV</a>:</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;    <span class="comment">/* nothing to do for pregrad or postgrad */</span></div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;  <span class="comment">/********************************************************************************/</span></div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;  <span class="comment">/*********************** RF SPATIAL SATURATION **********************************/</span></div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;  <span class="comment">/********************************************************************************/</span></div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142beda2e9a4ba49720b15631440951968c2865">KS_RF_ROLE_SPSAT</a>:</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;    selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a5ac7ed86029ab647ba0c9a656ae9fb37">postgrad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a97ab43f6fd28920a42d987c8fec4afec">area</a> = standard_crusherarea * selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a5e361f25d617a7522e7a14d0cba41c77">crusherscale</a>;</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;    sprintf(postselname, <span class="stringliteral">&quot;%s.spoiler&quot;</span>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;    status = <a class="code" href="_k_s_foundation__host_8c.html#ace858b7b1e7182259bcaa098147e5956">ks_eval_trap_constrained</a>(&amp;selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a5ac7ed86029ab647ba0c9a656ae9fb37">postgrad</a>, postselname, ampmax, slewrate, 0);</div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;    <span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;  <span class="comment">/********************************************************************************/</span></div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;  <span class="comment">/********************************************************************************/</span></div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;  <span class="comment">/********************************************************************************/</span></div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;  <span class="keywordflow">default</span>:</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_selrf(%s): RF role must be one of: KS_RF_ROLE_EXC, KS_RF_ROLE_REF, KS_RF_ROLE_INV, KS_RF_ROLE_SPSAT&quot;</span>, desc);</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;  } <span class="comment">/* role */</span></div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;  <span class="comment">/********************************************************************************/</span></div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;  <span class="comment">/*********************** Validation *********************************************/</span></div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;  <span class="comment">/********************************************************************************/</span></div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;  <span class="keywordflow">if</span> (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>) { <span class="comment">/* custom gradient wave */</span></div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;    <span class="keywordtype">float</span> mostfavorable_gradmax = FMax(3, <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>.tx, <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>.ty, <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>.tz);</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation_8h.html#a2bfec427bf5a8966edf279b2eba23396">ks_wave_absmax</a>(&amp;selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>) &gt; mostfavorable_gradmax) {</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_selrf(%s): too large gradient amplitude for &#39;gradwave&#39;&quot;</span>, desc);</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;    }</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;</div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;  } <span class="keywordflow">else</span> { <span class="comment">/* standard trapezoid */</span></div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;</div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;    <span class="comment">/* timing check: grad vs. RF */</span></div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;    <span class="keywordflow">if</span> (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> &amp;&amp; selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">plateautime</a> != selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>) {</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_selrf(%s): grad.plateautime (%d) != rf.rfwave.duration (%d)&quot;</span>, desc, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">plateautime</a>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>);</div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;    }</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;    <span class="comment">/* gradient duration divisibility check */</span></div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;    <span class="keywordflow">if</span> (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> % GRAD_UPDATE_TIME) {</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_selrf(%s): grad.duration (%d) must be divisible by 4 [us]&quot;</span>, desc, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>);</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;    }</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;  }</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;} <span class="comment">/* ks_eval_selrf_constrained */</span></div><div class="ttc" id="struct_k_s___t_r_a_p_html_a878bb367b07dc7dfb5fef5728d2e5b1d"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">KS_TRAP::plateautime</a></div><div class="ttdeci">int plateautime</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:436</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#af33317a98ade78e3ac252b33cbb794af">KS_SELRF::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1340</div></div>
<div class="ttc" id="struct_k_s___r_f_html_ac89cc20f819623e17ac0696a6dfb2223"><div class="ttname"><a href="struct_k_s___r_f.html#ac89cc20f819623e17ac0696a6dfb2223">KS_RF::iso2end_subpulse</a></div><div class="ttdeci">int iso2end_subpulse</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:795</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_afd953f31b866a09e0418967c2bf65a59"><div class="ttname"><a href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a></div><div class="ttdeci">#define KS_NOTSET</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:60</div></div>
<div class="ttc" id="struct_k_s___r_f_html_aea7921a9aa2757a88e843476848ddd55"><div class="ttname"><a href="struct_k_s___r_f.html#aea7921a9aa2757a88e843476848ddd55">KS_RF::role</a></div><div class="ttdeci">int role</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:788</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_aca53dcf7a61b8beba82e8f9a0c768cb5"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#aca53dcf7a61b8beba82e8f9a0c768cb5">KS_SELRF::sms_info</a></div><div class="ttdeci">KS_SMS_INFO sms_info</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1343</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_a607347e9c1c7a9eef21fff556faccc3f"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">KS_SELRF::gradwave</a></div><div class="ttdeci">KS_WAVE gradwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1342</div></div>
<div class="ttc" id="struct_k_s___r_f_html_ae183c3e4095d1c6d14b3d59a0da97928"><div class="ttname"><a href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">KS_RF::rfpulse</a></div><div class="ttdeci">RF_PULSE rfpulse</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:797</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a8efdbce2fbb4bf21a6fd8983fdd6d5c7"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a8efdbce2fbb4bf21a6fd8983fdd6d5c7">ks_init_trap</a></div><div class="ttdeci">void ks_init_trap(KS_TRAP *trap)</div><div class="ttdoc">Resets a KS_TRAP sequence object to its default value (KS_INIT_TRAP)</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:45</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aa324c3517656b8ec032523397a142beda8f1b938816b04ffdeb45de47204252fd"><div class="ttname"><a href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142beda8f1b938816b04ffdeb45de47204252fd">KS_RF_ROLE_REF</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1750</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aa324c3517656b8ec032523397a142bedac6b698b041a6da12fb9194c4947ec6e8"><div class="ttname"><a href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedac6b698b041a6da12fb9194c4947ec6e8">KS_RF_ROLE_INV</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1750</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a6aa33ad60a96c56283d44d989fe2d499"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a6aa33ad60a96c56283d44d989fe2d499">KS_WAVE::gradwave_units</a></div><div class="ttdeci">int gradwave_units</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:521</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_ace858b7b1e7182259bcaa098147e5956"><div class="ttname"><a href="_k_s_foundation__host_8c.html#ace858b7b1e7182259bcaa098147e5956">ks_eval_trap_constrained</a></div><div class="ttdeci">STATUS ks_eval_trap_constrained(KS_TRAP *trap, const char *const desc, float ampmax, float slewrate, int minduration)</div><div class="ttdoc">Sets up a trapezoid using a KS_TRAP sequence object with gradient constraints specified as input argu...</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:276</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_adfc20623c6ef26b08b99174a1a77323caafce08e3915c706e0851da5f4977192c"><div class="ttname"><a href="_k_s_foundation_8h.html#adfc20623c6ef26b08b99174a1a77323caafce08e3915c706e0851da5f4977192c">KS_GRADWAVE_RELATIVE</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1772</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aa324c3517656b8ec032523397a142bedacc16dd3ca09dedaf6334a39ee4e46241"><div class="ttname"><a href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedacc16dd3ca09dedaf6334a39ee4e46241">KS_RF_ROLE_EXC</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1750</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a2875ace95558531062d08465b2bcc282"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a></div><div class="ttdeci">float GAM</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a2bfec427bf5a8966edf279b2eba23396"><div class="ttname"><a href="_k_s_foundation_8h.html#a2bfec427bf5a8966edf279b2eba23396">ks_wave_absmax</a></div><div class="ttdeci">float ks_wave_absmax(const KS_WAVE *wave)</div><div class="ttdoc">Returns the maximum absolute value in a KS_WAVE sequence object</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:986</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aacb2fe1d83c45e8d0525f363bdd6b8a6"><div class="ttname"><a href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a></div><div class="ttdeci">#define KS_DESCRIPTION_LENGTH</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:112</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_a35145c98c931f54a8bf2b97edfb3e4c6"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#a35145c98c931f54a8bf2b97edfb3e4c6">KS_SELRF::pregrad</a></div><div class="ttdeci">KS_TRAP pregrad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1339</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_adeab1cc34f1a7f20f41e8825d849981e"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">KS_SELRF::rf</a></div><div class="ttdeci">KS_RF rf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1334</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">KS_WAVE::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:516</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a2a9b610a78cdae3ac8ef682bd34f7e0d"><div class="ttname"><a href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">KS_RF::rfwave</a></div><div class="ttdeci">KS_WAVE rfwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:798</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a97ab43f6fd28920a42d987c8fec4afec"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a97ab43f6fd28920a42d987c8fec4afec">KS_TRAP::area</a></div><div class="ttdeci">float area</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:434</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ab508ded41392ee86a2a619d3e93d2373"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">KS_TRAP::amp</a></div><div class="ttdeci">float amp</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:433</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a784f028a220f82adb610919a51c09abb"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a784f028a220f82adb610919a51c09abb">ks_init_sms_info</a></div><div class="ttdeci">void ks_init_sms_info(KS_SMS_INFO *sms_info)</div><div class="ttdoc">Resets a KS_SMS_INFO sequence object to its default value (KS_INIT_SMS_INFO)</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:61</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_a5ac7ed86029ab647ba0c9a656ae9fb37"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#a5ac7ed86029ab647ba0c9a656ae9fb37">KS_SELRF::postgrad</a></div><div class="ttdeci">KS_TRAP postgrad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1341</div></div>
<div class="ttc" id="struct_k_s___r_f_html_afa10c3dbec21b5cc34276e741deeb97e"><div class="ttname"><a href="struct_k_s___r_f.html#afa10c3dbec21b5cc34276e741deeb97e">KS_RF::iso2end</a></div><div class="ttdeci">int iso2end</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:794</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a106b3a179fec686052d27fcc87129916"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a106b3a179fec686052d27fcc87129916">ks_eval_rf</a></div><div class="ttdeci">STATUS ks_eval_rf(KS_RF *rf, const char *const desc)</div><div class="ttdoc">Sets up a KS_RF object</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:1451</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a9261718b4f0e64bab0da0b9e9c2c02f0"><div class="ttname"><a href="_k_s_foundation_8h.html#a9261718b4f0e64bab0da0b9e9c2c02f0">ks_calc_selgradamp</a></div><div class="ttdeci">float ks_calc_selgradamp(float rfbw, float slthick)</div><div class="ttdoc">Returns the gradient amplitude in [G/cm] necessary for slice selection (internal use)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:242</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a8309ba456fc3e23a10111a1439b13e21"><div class="ttname"><a href="_k_s_foundation_8h.html#a8309ba456fc3e23a10111a1439b13e21">ks_wave_max</a></div><div class="ttdeci">float ks_wave_max(const KS_WAVE *wave)</div><div class="ttdoc">Returns the maximum value in a KS_WAVE sequence object</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:913</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_a5e361f25d617a7522e7a14d0cba41c77"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#a5e361f25d617a7522e7a14d0cba41c77">KS_SELRF::crusherscale</a></div><div class="ttdeci">float crusherscale</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1337</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_ace6503c6437af0a5d0278edd735eddd8"><div class="ttname"><a href="_k_s_foundation__host_8c.html#ace6503c6437af0a5d0278edd735eddd8">ks_eval_seltrap</a></div><div class="ttdeci">STATUS ks_eval_seltrap(KS_TRAP *trap, const char *const desc, float slewrate, float slthick, float bw, int rfduration)</div><div class="ttdoc">(Internal use) Sets up a trapezoid for RF slice selection</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:1533</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_TRAP::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:437</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_adce100a7702e71bfb10377f1652465a2"><div class="ttname"><a href="_k_s_foundation_8h.html#adce100a7702e71bfb10377f1652465a2">ks_wave_min</a></div><div class="ttdeci">float ks_wave_min(const KS_WAVE *wave)</div><div class="ttdoc">Returns the minimum value in a KS_WAVE sequence object</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:939</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a23b3d305df1e2ad0563f8a2fea2330df"><div class="ttname"><a href="_k_s_foundation_8h.html#a23b3d305df1e2ad0563f8a2fea2330df">ks_wave_multiplyval</a></div><div class="ttdeci">void ks_wave_multiplyval(KS_WAVE *wave, float val)</div><div class="ttdoc">In-place scalar multiplication of a KS_WAVE</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1135</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aa324c3517656b8ec032523397a142beda2e9a4ba49720b15631440951968c2865"><div class="ttname"><a href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142beda2e9a4ba49720b15631440951968c2865">KS_RF_ROLE_SPSAT</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1750</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a27640b66342aa92e2fecafb0e8471785"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">KS_WAVE::waveform</a></div><div class="ttdeci">KS_WAVEFORM waveform</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:519</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_acbc719dc4e48c2a2df0447875e4348ca"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">KS_TRAP::ramptime</a></div><div class="ttdeci">int ramptime</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:435</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_WAVE::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:518</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_aa89aa200e4334657ad976733bebcbc2a"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#aa89aa200e4334657ad976733bebcbc2a">KS_SELRF::slthick</a></div><div class="ttdeci">float slthick</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1336</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a6b955cde0388e60c3ec5f602072a8e0f"><div class="ttname"><a href="struct_k_s___r_f.html#a6b955cde0388e60c3ec5f602072a8e0f">KS_RF::bw</a></div><div class="ttdeci">float bw</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:790</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad77a28d39f423bca930ee2f8f392de17"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad77a28d39f423bca930ee2f8f392de17">&#9670;&nbsp;</a></span>ks_eval_selrf()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_selrf </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *&#160;</td>
          <td class="paramname"><em>selrf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const&#160;</td>
          <td class="paramname"><em>desc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets up a <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> object for RF slice selection with preset gradient constraints</h4>
</p>
<p>This is a wrapper function to <a class="el" href="_k_s_foundation_8h.html#a91443aae8a97c4481ba841f1bf3dc13a" title="Sets up a KS_SELRF object for RF slice selection, subject to gradients constraints specified as input...">ks_eval_selrf_constrained()</a> with gradient constraints set to allow this <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> to be played on any axis while other gradients (set up with the same constraints) can be played out on the other two gradient boards, for any slice angulation. This is the generic and safest configuration, but for thin slices and high RF BWs, the gradient limits may be reached, especially for double oblique slices</p>
<p>See <a class="el" href="_k_s_foundation_8h.html#a91443aae8a97c4481ba841f1bf3dc13a" title="Sets up a KS_SELRF object for RF slice selection, subject to gradients constraints specified as input...">ks_eval_selrf_constrained()</a> for details on fields that need to be set before calling this function</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">selrf</td><td>Pointer to the <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> object to be set up </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">desc</td><td>A description (text string) of the <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> object. This description is used for pulse sequence generation (seen in the file generated by <em>TimeHist</em> in <em>MGD Sim/WTools</em>) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;                                                               {</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__host_8c.html#a3374fbc738049ee6196fb20990888457">ks_eval_selrf_constrained</a>(selrf, desc, <a class="code" href="_k_s_foundation_8h.html#a5c919c547ee396b18069ed505c695139">ks_syslimits_ampmax</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>), <a class="code" href="_k_s_foundation_8h.html#a712d215e449900b4fc566fefff51b4e9">ks_syslimits_slewrate</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>));</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_a5c919c547ee396b18069ed505c695139"><div class="ttname"><a href="_k_s_foundation_8h.html#a5c919c547ee396b18069ed505c695139">ks_syslimits_ampmax</a></div><div class="ttdeci">float ks_syslimits_ampmax(LOG_GRAD loggrd)</div><div class="ttdoc">Returns the maximum gradient amplitude that can be used on all gradient boards simultaneously</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:163</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a3374fbc738049ee6196fb20990888457"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a3374fbc738049ee6196fb20990888457">ks_eval_selrf_constrained</a></div><div class="ttdeci">STATUS ks_eval_selrf_constrained(KS_SELRF *selrf, const char *const desc, float ampmax, float slewrate)</div><div class="ttdoc">Sets up a KS_SELRF object for RF slice selection, subject to gradients constraints specified as input...</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:1571</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a712d215e449900b4fc566fefff51b4e9"><div class="ttname"><a href="_k_s_foundation_8h.html#a712d215e449900b4fc566fefff51b4e9">ks_syslimits_slewrate</a></div><div class="ttdeci">float ks_syslimits_slewrate(LOG_GRAD loggrd)</div><div class="ttdoc">Returns the maximum slewrate that can be used on all gradient boards simultaneously</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:196</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="add0c1222947d803bcb4ea5ddcc144749"></a>
<h2 class="memtitle"><span class="permalink"><a href="#add0c1222947d803bcb4ea5ddcc144749">&#9670;&nbsp;</a></span>ks_eval_selrf2()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_selrf2 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *&#160;</td>
          <td class="paramname"><em>selrf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const&#160;</td>
          <td class="paramname"><em>desc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets up a <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> object for RF slice selection with preset gradient constraints</h4>
</p>
<p>This is a wrapper function to <a class="el" href="_k_s_foundation_8h.html#a91443aae8a97c4481ba841f1bf3dc13a" title="Sets up a KS_SELRF object for RF slice selection, subject to gradients constraints specified as input...">ks_eval_selrf_constrained()</a> with gradient constraints set to allow this <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> to be played on any axis while one more gradient (set up with the same constraints) can be played out on another gradient board, for any slice angulation. For double oblique slice angulations, this function will allow for thinner slices and higher RF BWs than <a class="el" href="_k_s_foundation_8h.html#ad77a28d39f423bca930ee2f8f392de17" title="Sets up a KS_SELRF object for RF slice selection with preset gradient constraints">ks_eval_selrf()</a></p>
<p>See <a class="el" href="_k_s_foundation_8h.html#a91443aae8a97c4481ba841f1bf3dc13a" title="Sets up a KS_SELRF object for RF slice selection, subject to gradients constraints specified as input...">ks_eval_selrf_constrained()</a> for details on fields that need to be set before calling this function</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">selrf</td><td>Pointer to the <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> object to be set up </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">desc</td><td>A description (text string) of the <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> object. This description is used for pulse sequence generation (seen in the file generated by <em>TimeHist</em> in <em>MGD Sim/WTools</em>) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;                                                                {</div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;</div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__host_8c.html#a3374fbc738049ee6196fb20990888457">ks_eval_selrf_constrained</a>(selrf, desc, <a class="code" href="_k_s_foundation_8h.html#a4b3a3095702bf551f318ef9f03ff3403">ks_syslimits_ampmax2</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>), <a class="code" href="_k_s_foundation_8h.html#a53d792432e1fd99fa597314576fa9e49">ks_syslimits_slewrate2</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>));</div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;</div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;}</div><div class="ttc" id="_k_s_foundation__host_8c_html_a3374fbc738049ee6196fb20990888457"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a3374fbc738049ee6196fb20990888457">ks_eval_selrf_constrained</a></div><div class="ttdeci">STATUS ks_eval_selrf_constrained(KS_SELRF *selrf, const char *const desc, float ampmax, float slewrate)</div><div class="ttdoc">Sets up a KS_SELRF object for RF slice selection, subject to gradients constraints specified as input...</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:1571</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4b3a3095702bf551f318ef9f03ff3403"><div class="ttname"><a href="_k_s_foundation_8h.html#a4b3a3095702bf551f318ef9f03ff3403">ks_syslimits_ampmax2</a></div><div class="ttdeci">float ks_syslimits_ampmax2(LOG_GRAD loggrd)</div><div class="ttdoc">Returns the maximum gradient amplitude that can be used on two gradient boards simultaneously</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:167</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a53d792432e1fd99fa597314576fa9e49"><div class="ttname"><a href="_k_s_foundation_8h.html#a53d792432e1fd99fa597314576fa9e49">ks_syslimits_slewrate2</a></div><div class="ttdeci">float ks_syslimits_slewrate2(LOG_GRAD loggrd)</div><div class="ttdoc">Returns the maximum slewrate that can be used on two gradient boards simultaneously</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:200</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a86e5857ac625807c2dedd669cb11ede9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a86e5857ac625807c2dedd669cb11ede9">&#9670;&nbsp;</a></span>ks_eval_selrf1()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_selrf1 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *&#160;</td>
          <td class="paramname"><em>selrf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const&#160;</td>
          <td class="paramname"><em>desc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets up a <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> object for RF slice selection with preset gradient constraints</h4>
</p>
<p>This is a wrapper function to <a class="el" href="_k_s_foundation_8h.html#a91443aae8a97c4481ba841f1bf3dc13a" title="Sets up a KS_SELRF object for RF slice selection, subject to gradients constraints specified as input...">ks_eval_selrf_constrained()</a> with gradient constraints set to allow this <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> to be played on any axis, as long as no other gradients are be played out simultaneously. For double oblique slice angulations, this function will allow for thinner slices and higher RF BWs than <a class="el" href="_k_s_foundation_8h.html#ad77a28d39f423bca930ee2f8f392de17" title="Sets up a KS_SELRF object for RF slice selection with preset gradient constraints">ks_eval_selrf()</a> and <a class="el" href="_k_s_foundation_8h.html#add0c1222947d803bcb4ea5ddcc144749" title="Sets up a KS_SELRF object for RF slice selection with preset gradient constraints">ks_eval_selrf2()</a></p>
<p>See <a class="el" href="_k_s_foundation_8h.html#a91443aae8a97c4481ba841f1bf3dc13a" title="Sets up a KS_SELRF object for RF slice selection, subject to gradients constraints specified as input...">ks_eval_selrf_constrained()</a> for details on fields that need to be set before calling this function</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">selrf</td><td>Pointer to the <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> object to be set up </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">desc</td><td>A description (text string) of the <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> object. This description is used for pulse sequence generation (seen in the file generated by <em>TimeHist</em> in <em>MGD Sim/WTools</em>) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;                                                                {</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;</div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__host_8c.html#a3374fbc738049ee6196fb20990888457">ks_eval_selrf_constrained</a>(selrf, desc, <a class="code" href="_k_s_foundation_8h.html#a431729c0ecf331b33d84db72a80debaf">ks_syslimits_ampmax1</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>), <a class="code" href="_k_s_foundation_8h.html#aaeea7c06ce455978cce287cf28c22a4f">ks_syslimits_slewrate1</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>));</div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;</div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;}</div><div class="ttc" id="_k_s_foundation__host_8c_html_a3374fbc738049ee6196fb20990888457"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a3374fbc738049ee6196fb20990888457">ks_eval_selrf_constrained</a></div><div class="ttdeci">STATUS ks_eval_selrf_constrained(KS_SELRF *selrf, const char *const desc, float ampmax, float slewrate)</div><div class="ttdoc">Sets up a KS_SELRF object for RF slice selection, subject to gradients constraints specified as input...</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:1571</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aaeea7c06ce455978cce287cf28c22a4f"><div class="ttname"><a href="_k_s_foundation_8h.html#aaeea7c06ce455978cce287cf28c22a4f">ks_syslimits_slewrate1</a></div><div class="ttdeci">float ks_syslimits_slewrate1(LOG_GRAD loggrd)</div><div class="ttdoc">Returns the maximum slewrate that can be used on one gradient board at a time</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:204</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a431729c0ecf331b33d84db72a80debaf"><div class="ttname"><a href="_k_s_foundation_8h.html#a431729c0ecf331b33d84db72a80debaf">ks_syslimits_ampmax1</a></div><div class="ttdeci">float ks_syslimits_ampmax1(LOG_GRAD loggrd)</div><div class="ttdoc">Returns the maximum gradient amplitude that can be used on all gradient boards simultaneously</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:171</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a5040306d860c46da494963303f88cab9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5040306d860c46da494963303f88cab9">&#9670;&nbsp;</a></span>ks_eval_sms_get_phase_modulation()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_sms_get_phase_modulation </td>
          <td>(</td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>sms_phase_modulation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>sms_multiband_factor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>sms_phase_modulation_mode</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets up an array with values for phase modulation between slices in a multi-band (MB) RF</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">sms_phase_modulation</td><td>Array with phase modulation between slices in a MB RF </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sms_multiband_factor</td><td>The multi-band acceleration factor </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sms_phase_modulation_mode</td><td>See ks_enum_smstype for options </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;                                                                                                                                          {</div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;<span class="comment">  %   Return optimal phases for phase-modulated or amplitude-modulated low-peak power multiband pulses.</span></div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;<span class="comment">  %</span></div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;<span class="comment">  %   sms_phase_modulation: Optimal phases</span></div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;<span class="comment">  %   sms_multiband_factor: Number of bands</span></div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;<span class="comment">  %   sms_phase_modulation_mode: phasmod, amplmod, or quadmod</span></div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;<span class="comment">  %</span></div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;<span class="comment">  %   Adopted for EPIC from Will Grissom&#39;s (Vanderbilt University, 2015) MATLAB code by Ola Norbeck (Karolinska Unviversity Hospital, 2015).</span></div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;</div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;  <span class="keywordtype">int</span> jdx;</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;</div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;  <span class="keywordflow">if</span> (sms_phase_modulation_mode == <a class="code" href="_k_s_foundation_8h.html#afbfc330f4f27194b4e27753383464227a1918b5929560ca3eaa2f054f855d5659">KS_SELRF_SMS_PHAS_MOD_PHAS</a>) {</div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;</div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;    <span class="comment">/* Wong&#39;s sms_phase_modulation: From E C Wong, ISMRM 2012, p. 2209 */</span></div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;</div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;    <span class="keywordflow">if</span> ((sms_multiband_factor &lt; 2) || (sms_multiband_factor &gt; 16)) {</div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_sms_get_phase_modulation: multiband factor (%d, 2nd arg) must be in range [2,16] for Wong&#39;s sms_phase_modulation&quot;</span>, sms_multiband_factor);</div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;    }</div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;</div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;    <span class="keywordtype">float</span> P[15][16] = {</div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;      <span class="comment">/* mbf = 2  */</span>  {0.0, 0.0}, <span class="comment">/* alt.{0.0, 3.142} */</span></div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;      <span class="comment">/* mbf = 3  */</span>  {0.0, 0.730, 4.602},</div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;      <span class="comment">/* mbf = 4  */</span>  {0.0, 3.875, 5.940, 6.197},</div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;      <span class="comment">/* mbf = 5  */</span>  {0.0, 3.778, 5.335, 0.872, 0.471},</div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;      <span class="comment">/* mbf = 6  */</span>  {0.0, 2.005, 1.674, 5.012, 5.736, 4.123},</div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;      <span class="comment">/* mbf = 7  */</span>  {0.0, 3.002, 5.998, 5.909, 2.624, 2.528, 2.440},</div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;      <span class="comment">/* mbf = 8  */</span>  {0.0, 1.036, 3.414, 3.778, 3.215, 1.756, 4.555, 2.467},</div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;      <span class="comment">/* mbf = 9  */</span>  {0.0, 1.250, 1.783, 3.558, 0.739, 3.319, 1.296, 0.521, 5.332},</div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;      <span class="comment">/* mbf = 10 */</span>  {0.0, 4.418, 2.360, 0.677, 2.253, 3.472, 3.040, 3.974, 1.192, 2.510},</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;      <span class="comment">/* mbf = 11 */</span>  {0.0, 5.041, 4.285, 3.001, 5.765, 4.295, 0.056, 4.213, 6.040, 1.078, 2.759},</div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;      <span class="comment">/* mbf = 12 */</span>  {0.0, 2.755, 5.491, 4.447, 0.231, 2.499, 3.539, 2.931, 2.759, 5.376, 4.554, 3.479},</div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;      <span class="comment">/* mbf = 13 */</span>  {0.0, 0.603, 0.009, 4.179, 4.361, 4.837, 0.816, 5.995, 4.150, 0.417, 1.520, 4.517, 1.729},</div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;      <span class="comment">/* mbf = 14 */</span>  {0.0, 3.997, 0.830, 5.712, 3.838, 0.084, 1.685, 5.328, 0.237, 0.506, 1.356, 4.025, 4.483, 4.084},</div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;      <span class="comment">/* mbf = 15 */</span>  {0.0, 4.126, 2.266, 0.957, 4.603, 0.815, 3.475, 0.977, 1.449, 1.192, 0.148, 0.939, 2.531, 3.612, 4.801},</div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;      <span class="comment">/* mbf = 16 */</span>  {0.0, 4.359, 3.510, 4.410, 1.750, 3.357, 2.061, 5.948, 3.000, 2.822, 0.627, 2.768, 3.875, 4.173, 4.224, 5.941}</div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;    };</div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;</div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;    <span class="keywordflow">for</span> (jdx = 0; jdx &lt; sms_multiband_factor; jdx++ ) {</div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;      sms_phase_modulation[jdx] = P[sms_multiband_factor - 2][jdx];</div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;    }</div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;</div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sms_phase_modulation_mode == <a class="code" href="_k_s_foundation_8h.html#afbfc330f4f27194b4e27753383464227a385b4332bc937b39f58986df5422adba">KS_SELRF_SMS_PHAS_MOD_AMPL</a>) {</div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;</div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;    <span class="comment">/*  Seada&#39;s Hermitian sms_phase_modulation: From Seada et. al. Optimized Amplitude Modulated Multiband RF Pulse Design. MRM 2017 */</span></div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;</div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;    <span class="keywordflow">if</span> ((sms_multiband_factor &lt; 3) || (sms_multiband_factor &gt; 12)) {</div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_sms_get_phase_modulation: multiband factor (%d, 2nd arg) must be in range [3,12] for Seada&#39;s Hermitian sms_phase_modulation&quot;</span>, sms_multiband_factor);</div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;    }</div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;</div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;    <span class="keywordtype">float</span> P[10][12] = {</div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;      <span class="comment">/* mbf = 3  */</span>  {1.2846,  0.0000, -1.2846},</div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;      <span class="comment">/* mbf = 4  */</span>  {0.9739,  1.3718, -1.3718, -0.9739},</div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;      <span class="comment">/* mbf = 5  */</span>  {1.1572, -0.9931,  0.0000,  0.9931, -1.1572},</div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;      <span class="comment">/* mbf = 6  */</span>  {1.6912,  2.8117,  1.1572, -1.1572, -2.8117, -1.6912},</div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;      <span class="comment">/* mbf = 7  */</span>  {2.5813, -0.5620,  0.1030,  0.0000, -0.1030,  0.5620, -2.5813},</div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;      <span class="comment">/* mbf = 8  */</span>  {2.1118,  0.2199,  1.4643,  1.9914, -1.9914, -1.4643, -0.2199, -2.1118},</div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;      <span class="comment">/* mbf = 9  */</span>  {0.4800, -2.6669, -0.6458, -0.4189,  0.0000,  0.4189,  0.6458,  2.6669, -0.4800},</div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;      <span class="comment">/* mbf = 10 */</span>  {1.6825, -2.3946,  2.9130,  0.3037,  0.7365, -0.7365, -0.3037, -2.9130,  2.3946, -1.6825},</div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;      <span class="comment">/* mbf = 11 */</span>  {1.4050,  0.8866, -1.8535,  0.0698, -1.4940,  0.0000,  1.4940, -0.0698,  1.8535, -0.8866, -1.4050},</div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;      <span class="comment">/* mbf = 12 */</span>  {1.7296,  0.4433,  0.7208,  2.1904, -2.1956,  0.9844, -0.9844,  2.1956, -2.1904, -0.7208, -0.4433, -1.7296}</div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;    };</div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;</div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;    <span class="keywordflow">for</span> (jdx = 0; jdx &lt; sms_multiband_factor; jdx++ ) {</div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;      sms_phase_modulation[jdx] = P[sms_multiband_factor - 3][jdx];</div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;    }</div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;</div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;</div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sms_phase_modulation_mode == <a class="code" href="_k_s_foundation_8h.html#afbfc330f4f27194b4e27753383464227a4053b2f4fe4f8d2d7031cdb0041966fc">KS_SELRF_SMS_PHAS_MOD_QUAD</a>) {</div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;</div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;    <span class="comment">/* Grissom&#39;s quadratic sms_phase_modulation (unpublished) */</span></div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;</div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;    <span class="keywordflow">for</span> (jdx = 0; jdx &lt; sms_multiband_factor; jdx++) {</div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;      sms_phase_modulation[jdx] = pow( (3.4 / sms_multiband_factor) * (<span class="keywordtype">float</span>)(1.0 + (<span class="keywordtype">float</span>)jdx - ((<span class="keywordtype">float</span>)sms_multiband_factor / 2.0) - 0.5), 2.0); <span class="comment">/* sms_phase_modulation for each band */</span></div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;    }</div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;</div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;</div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_sms_get_phase_modulation: sms_phase_modulation_mode (%d, 3rd arg) is of unrecognized type. Choose phasmod = 1, amplmod = 2, or quadmod = 3&quot;</span>, sms_phase_modulation_mode);</div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;</div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;  }; <span class="comment">/* end of if  */</span></div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;</div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;</div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;} <span class="comment">/* EOF */</span></div><div class="ttc" id="_k_s_foundation_8h_html_afbfc330f4f27194b4e27753383464227a1918b5929560ca3eaa2f054f855d5659"><div class="ttname"><a href="_k_s_foundation_8h.html#afbfc330f4f27194b4e27753383464227a1918b5929560ca3eaa2f054f855d5659">KS_SELRF_SMS_PHAS_MOD_PHAS</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1766</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_afbfc330f4f27194b4e27753383464227a385b4332bc937b39f58986df5422adba"><div class="ttname"><a href="_k_s_foundation_8h.html#afbfc330f4f27194b4e27753383464227a385b4332bc937b39f58986df5422adba">KS_SELRF_SMS_PHAS_MOD_AMPL</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1767</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_afbfc330f4f27194b4e27753383464227a4053b2f4fe4f8d2d7031cdb0041966fc"><div class="ttname"><a href="_k_s_foundation_8h.html#afbfc330f4f27194b4e27753383464227a4053b2f4fe4f8d2d7031cdb0041966fc">KS_SELRF_SMS_PHAS_MOD_QUAD</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1768</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6f3aa6f06724f8fb3675f7b18600d747"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6f3aa6f06724f8fb3675f7b18600d747">&#9670;&nbsp;</a></span>ks_eval_findb1()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_eval_findb1 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *&#160;</td>
          <td class="paramname"><em>selrf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>max_b1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>scaleFactor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sms_multiband_factor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sms_phase_modulation_mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>sms_slice_gap</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Finds a stretch factor leading to the specified peak B1</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">selrf</td><td>rf object <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">max_b1</td><td>peak B1 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">scaleFactor</td><td>initial stretch factor </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sms_multiband_factor</td><td>SMS factor </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sms_phase_modulation_mode</td><td>SMS phase modulation mode </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sms_slice_gap</td><td>SMS slice gap </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>float stretch factor </dd></dl>
<div class="fragment"><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;                                                                                                                                                      {</div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;</div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;  STATUS status;</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;  <span class="keywordtype">float</span> curr_b1 = 0.0;</div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="_g_e_required_8e.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a> = 0;</div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;  <span class="keywordtype">double</span> stepDown = 1.01;</div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;  <span class="keywordtype">double</span> stepUp = 1.05;</div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;</div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;  <span class="comment">/* Init tmp rf object */</span></div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;  <a class="code" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> selrftmp;</div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#a3cb1d6e472e9061b0f4768d8985a442e">ks_init_selrf</a>(&amp;selrftmp);</div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;  <span class="comment">/* Make the RF-pulse longer until its B1 peak is under its target */</span></div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;  <span class="keywordflow">do</span> {</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;    selrftmp = *selrf;</div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;    <a class="code" href="_k_s_foundation__host_8c.html#a38e6cbd20c6ca7972e583360a1fb67c3">ks_eval_stretch_rf</a>(&amp;selrftmp.<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>, scaleFactor);</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;    status = <a class="code" href="_k_s_foundation__host_8c.html#a61646299ba8c9a06f8a978ea1e814a1a">ks_eval_selrf</a>(&amp;selrftmp, <span class="stringliteral">&quot;tmp+&quot;</span>);</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;    <span class="keywordflow">if</span> (status == FAILURE) {<span class="keywordflow">continue</span>;}</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;    <span class="keywordflow">if</span> (sms_multiband_factor &gt; 1) {</div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;      status = <a class="code" href="_k_s_foundation__host_8c.html#a1c084f09cce310e7e34129f7337ddc14">ks_eval_sms_make_multiband</a>(&amp;selrftmp, &amp;selrftmp, sms_multiband_factor, sms_phase_modulation_mode, sms_slice_gap, 0);</div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;      status = <a class="code" href="_k_s_foundation__host_8c.html#ae514f91fbedc683d5e9db931960b79b1">ks_eval_rfstat</a>(&amp;selrftmp.<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>);</div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;    }</div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;    <span class="keywordflow">if</span> (status == FAILURE) {<span class="keywordflow">continue</span>;}</div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;    curr_b1 = selrftmp.<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.max_b1;</div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;    scaleFactor *= stepUp;</div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_g_e_required_8e.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>) {<a class="code" href="_k_s_foundation_8h.html#a763989ed463b618658bef9c2485051eb">ks_dbg</a>(<span class="stringliteral">&quot;+ scaleFactor=%f, currB1=%f, maxB1=%f&quot;</span>, scaleFactor, curr_b1, max_b1);}</div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;  }</div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;  <span class="keywordflow">while</span> (fabs(curr_b1) &gt; max_b1);</div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;  scaleFactor /= stepUp;</div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;</div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;  <span class="comment">/* Make the RF-pulse shorter until its B1 peak hits its target */</span></div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;  <span class="keywordflow">while</span> ((fabs(curr_b1) &lt; max_b1) &amp;&amp; (scaleFactor &gt; 0)) {</div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;    selrftmp = *selrf;</div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;    <a class="code" href="_k_s_foundation__host_8c.html#a38e6cbd20c6ca7972e583360a1fb67c3">ks_eval_stretch_rf</a>(&amp;selrftmp.<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>, scaleFactor);</div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;    status = <a class="code" href="_k_s_foundation__host_8c.html#a61646299ba8c9a06f8a978ea1e814a1a">ks_eval_selrf</a>(&amp;selrftmp, <span class="stringliteral">&quot;tmp-&quot;</span>);</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;    <span class="keywordflow">if</span> (status == FAILURE) {<span class="keywordflow">break</span>;}</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;    <span class="keywordflow">if</span> (sms_multiband_factor &gt; 1) {</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;      status = <a class="code" href="_k_s_foundation__host_8c.html#a1c084f09cce310e7e34129f7337ddc14">ks_eval_sms_make_multiband</a>(&amp;selrftmp, &amp;selrftmp, sms_multiband_factor, sms_phase_modulation_mode, sms_slice_gap, 0);</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;      status = <a class="code" href="_k_s_foundation__host_8c.html#ae514f91fbedc683d5e9db931960b79b1">ks_eval_rfstat</a>(&amp;selrftmp.<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>);</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;    }</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;    <span class="keywordflow">if</span> (status == FAILURE) {<span class="keywordflow">break</span>;}</div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;    curr_b1 = selrftmp.<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.max_b1;</div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;    scaleFactor /= stepDown;</div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_g_e_required_8e.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>) {<a class="code" href="_k_s_foundation_8h.html#a763989ed463b618658bef9c2485051eb">ks_dbg</a>(<span class="stringliteral">&quot;- scaleFactor=%f, currB1=%f, maxB1=%f&quot;</span>, scaleFactor, curr_b1, max_b1);}</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;  }</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;  scaleFactor *= stepDown;</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;  <span class="keywordflow">return</span> scaleFactor;</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;}</div><div class="ttc" id="_k_s_foundation__host_8c_html_a3cb1d6e472e9061b0f4768d8985a442e"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a3cb1d6e472e9061b0f4768d8985a442e">ks_init_selrf</a></div><div class="ttdeci">void ks_init_selrf(KS_SELRF *selrf)</div><div class="ttdoc">Resets a KS_SELRF sequence object to its default value (KS_INIT_SELRF)</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:65</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a></div><div class="ttdoc">Composite sequence object for slice-selective RF</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1333</div></div>
<div class="ttc" id="_g_e_required_8e_html_ac3e1795766a80ec63b157951b4b9a7d4"><div class="ttname"><a href="_g_e_required_8e.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a></div><div class="ttdeci">int debug</div><div class="ttdef"><b>Definition:</b> GERequired.e:2630</div></div>
<div class="ttc" id="struct_k_s___r_f_html_ae183c3e4095d1c6d14b3d59a0da97928"><div class="ttname"><a href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">KS_RF::rfpulse</a></div><div class="ttdeci">RF_PULSE rfpulse</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:797</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_adeab1cc34f1a7f20f41e8825d849981e"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">KS_SELRF::rf</a></div><div class="ttdeci">KS_RF rf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1334</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_ae514f91fbedc683d5e9db931960b79b1"><div class="ttname"><a href="_k_s_foundation__host_8c.html#ae514f91fbedc683d5e9db931960b79b1">ks_eval_rfstat</a></div><div class="ttdeci">STATUS ks_eval_rfstat(KS_RF *rf)</div><div class="ttdoc">Sets up the RF_PULSE structure of a KS_RF object</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:1359</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a1c084f09cce310e7e34129f7337ddc14"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a1c084f09cce310e7e34129f7337ddc14">ks_eval_sms_make_multiband</a></div><div class="ttdeci">STATUS ks_eval_sms_make_multiband(KS_SELRF *selrfMB, const KS_SELRF *selrf, const int sms_multiband_factor, const int sms_phase_modulation_mode, const float sms_slice_gap, int debug)</div><div class="ttdoc">Creates a SMS (simultaneous-multi-slice) version of a KS_SELRF object</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:1840</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a763989ed463b618658bef9c2485051eb"><div class="ttname"><a href="_k_s_foundation_8h.html#a763989ed463b618658bef9c2485051eb">ks_dbg</a></div><div class="ttdeci">STATUS STATUS ks_dbg(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common debug message function for HOST and TGT</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a61646299ba8c9a06f8a978ea1e814a1a"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a61646299ba8c9a06f8a978ea1e814a1a">ks_eval_selrf</a></div><div class="ttdeci">STATUS ks_eval_selrf(KS_SELRF *selrf, const char *const desc)</div><div class="ttdoc">Sets up a KS_SELRF object for RF slice selection with preset gradient constraints</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:1767</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a38e6cbd20c6ca7972e583360a1fb67c3"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a38e6cbd20c6ca7972e583360a1fb67c3">ks_eval_stretch_rf</a></div><div class="ttdeci">STATUS ks_eval_stretch_rf(KS_RF *rf, float stretch_factor)</div><div class="ttdoc">In-place stretching of a KS_RF object</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:2171</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a281427bd4e486330c9f0fc20ed848f19"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a281427bd4e486330c9f0fc20ed848f19">&#9670;&nbsp;</a></span>ks_eval_sms_make_multiband()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_sms_make_multiband </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *&#160;</td>
          <td class="paramname"><em>selrfMB</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *&#160;</td>
          <td class="paramname"><em>selrf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>sms_multiband_factor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>sms_phase_modulation_mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const float&#160;</td>
          <td class="paramname"><em>sms_slice_gap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>debug</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Creates a SMS (simultaneous-multi-slice) version of a <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> object</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">selrfMB</td><td>Pointer to multiband (SMS) <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">selrf</td><td>The original (single-band) <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> object (set up using <a class="el" href="_k_s_foundation_8h.html#ad77a28d39f423bca930ee2f8f392de17" title="Sets up a KS_SELRF object for RF slice selection with preset gradient constraints">ks_eval_selrf()</a>) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sms_multiband_factor</td><td>The multi-band acceleration factor </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sms_phase_modulation_mode</td><td>See ks_enum_smstype for options </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sms_slice_gap</td><td>Slice gap in [mm] for the selrfMB pulse </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">debug</td><td>Debug flag for writing out text files (SIM: in current dir HW:/usr/g/mrraw/kstmp) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;                                                                                                             {</div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;<span class="comment">%</span></div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;  <span class="keywordtype">int</span> jdx, idx, kdx;</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;  <span class="keywordtype">float</span> sms_phase_modulation[16] = <a class="code" href="_k_s_foundation_8h.html#a5adde8c85d3d00e22516df96c55f4eb7">KS_INITZEROS</a>(16);</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;  STATUS status;</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;  <span class="comment">/* Debug stuff */</span></div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;  <span class="keywordtype">int</span> single_band_mode = -1;</div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;  <span class="keywordtype">char</span> fname[<a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> + 14];</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;  <span class="keywordtype">char</span> outputdir_uid[250];</div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;  FILE *asciiWaveReal;</div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;  FILE *asciiWaveImag;</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;  FILE *asciiWaveRealMB;</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;  FILE *asciiWaveImagMB;</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;  FILE *asciiWaveRealMod;</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;  FILE *asciiWaveImagMod;</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;  FILE *asciiWaveParams;</div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;</div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_g_e_required_8e.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>) {</div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;</div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;<span class="preprocessor">#ifdef SIM</span></div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;    sprintf(outputdir_uid, <span class="stringliteral">&quot;./&quot;</span>);</div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;    <span class="keywordtype">char</span> cmd[250];</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;    sprintf(outputdir_uid, <span class="stringliteral">&quot;/usr/g/mrraw/kstmp/%010d/&quot;</span>, <a class="code" href="_k_s_foundation__host_8c.html#a2e788c6338615164f241b755f219c961">rhkacq_uid</a>);</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;    sprintf(cmd, <span class="stringliteral">&quot;mkdir -p %s &gt; /dev/null&quot;</span>, outputdir_uid);</div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;    system(cmd);</div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;    sprintf(fname, <span class="stringliteral">&quot;%s%s_mb_rf_Real.txt&quot;</span>, outputdir_uid, selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;    asciiWaveReal = fopen(fname,<span class="stringliteral">&quot;w&quot;</span>);</div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;    sprintf(fname, <span class="stringliteral">&quot;%s%s_mb_rf_Imag.txt&quot;</span>, outputdir_uid, selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;    asciiWaveImag = fopen(fname,<span class="stringliteral">&quot;w&quot;</span>);</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;    sprintf(fname, <span class="stringliteral">&quot;%s%s_mb_rfMB_Real.txt&quot;</span>, outputdir_uid, selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;    asciiWaveRealMB = fopen(fname,<span class="stringliteral">&quot;w&quot;</span>);</div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;    sprintf(fname, <span class="stringliteral">&quot;%s%s_mb_rfMB_Imag.txt&quot;</span>, outputdir_uid, selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;    asciiWaveImagMB = fopen(fname,<span class="stringliteral">&quot;w&quot;</span>);</div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;    sprintf(fname, <span class="stringliteral">&quot;%s%s_mod_rfMB_Real.txt&quot;</span>, outputdir_uid, selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;    asciiWaveRealMod = fopen(fname,<span class="stringliteral">&quot;w&quot;</span>);</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;    sprintf(fname, <span class="stringliteral">&quot;%s%s_mod_rfMB_Imag.txt&quot;</span>, outputdir_uid, selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;    asciiWaveImagMod = fopen(fname,<span class="stringliteral">&quot;w&quot;</span>);</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;  }</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;</div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;  <span class="comment">/* Check if gradient is present */</span></div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;  <span class="keywordflow">if</span> (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a> == 0){</div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_sms_make_multiband: Need a pre calculated gradient amp (2nd arg. selrf-&gt;grad.amp = %g)&quot;</span>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a>);</div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;  }</div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;</div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;  <span class="comment">/* Duplicate the selRF structure  */</span></div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;  <span class="keywordflow">if</span> (selrfMB != selrf ) {</div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;    *selrfMB = *selrf;</div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;  }</div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;</div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;  <span class="comment">/* Set info struct */</span></div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;  selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#aca53dcf7a61b8beba82e8f9a0c768cb5">sms_info</a>.<a class="code" href="struct_k_s___s_m_s___i_n_f_o.html#a58c64aa08739814113f9cd8a01b7f2e6">mb_factor</a> = sms_multiband_factor;</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;  selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#aca53dcf7a61b8beba82e8f9a0c768cb5">sms_info</a>.<a class="code" href="struct_k_s___s_m_s___i_n_f_o.html#a1b26a538ab6e22362275d427f991a3e1">slice_gap</a> = sms_slice_gap;</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;  selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#aca53dcf7a61b8beba82e8f9a0c768cb5">sms_info</a>.<a class="code" href="struct_k_s___s_m_s___i_n_f_o.html#a177e78699b1c480f77893fa200380d84">pulse_type</a> = <a class="code" href="_k_s_foundation_8h.html#af968d7d6e4fa1359fba5550fc39ae172ae28e1f22fff3b271570f3b9ec916bf58">KS_SELRF_SMS_MB</a>;</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;  <span class="comment">/* Save max b1 to make sure it does not get overwritten */</span></div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;  <span class="keywordtype">double</span> base_rf_max_amp = <a class="code" href="_k_s_foundation_8h.html#abf8e5bff3973c32360bc0e1505db61bc">ks_waveform_absmax</a>(selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, <a class="code" href="_k_s_foundation_8h.html#aa672c7e32ce3bce20534fa814901e720">ks_wave_res</a>(&amp;selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>));</div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;</div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;  <span class="comment">/* Get phase modulation to lower peak B1 */</span></div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;  <span class="keywordflow">if</span> (sms_phase_modulation_mode != <a class="code" href="_k_s_foundation_8h.html#afbfc330f4f27194b4e27753383464227ae3bd201ec523ddd720faf6625365aae7">KS_SELRF_SMS_PHAS_MOD_OFF</a>) {</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;    status = <a class="code" href="_k_s_foundation__host_8c.html#a2ff8c7b3ff61db2590c067015ecae1af">ks_eval_sms_get_phase_modulation</a>(sms_phase_modulation, sms_multiband_factor, sms_phase_modulation_mode);</div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;    <span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;  }</div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;</div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;  <span class="comment">/* initialize thetawave */</span></div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;  <span class="keywordflow">if</span> (selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> == 0) {</div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;    <a class="code" href="_k_s_foundation__host_8c.html#aa2b37fa5aa0bffff1de8ca29e7c19cc1">ks_init_wave</a>(&amp;selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>);</div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;    strncpy(selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, <a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a>);</div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;    selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> = selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>;</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;    selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> = selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>;</div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;  }</div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;</div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_g_e_required_8e.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>) {sprintf(fname, <span class="stringliteral">&quot;%s%s_mb_rf_base.txt&quot;</span>, outputdir_uid, selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>); <a class="code" href="_k_s_foundation__host_8c.html#a01d67d3faa8f2088f82af10aa0a28af0">ks_print_waveform</a>(selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, fname, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>); }</div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;</div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;  <span class="comment">/* Figure out a new resolution, since many pulses are of low resolution */</span></div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;  <span class="keywordtype">int</span> newRes = selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>/RF_UPDATE_TIME;</div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;  <span class="keywordtype">int</span> nPoints = newRes/selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>;</div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;  <span class="comment">/* Calc and apply sms modulation to base pulse */</span></div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;  <span class="keywordtype">float</span> *sms_wave_real = alloca(newRes*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;  <span class="keywordtype">float</span> *sms_wave_imag = alloca(newRes*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;</div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;  kdx = 0;</div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;  <span class="keywordflow">for</span> (idx=0; idx &lt; newRes; idx++) {</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;    <span class="keywordtype">double</span> wave_real, wave_imag, sms_modulation_real = 0, sms_modulation_imag = 0, p, slice_offset;</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;</div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;    <span class="comment">/* Convert base pulse from polar to cartesian */</span></div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;    wave_real = selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[kdx] * cos(selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[kdx]*(PI/180.0));</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;    wave_imag = selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[kdx] * sin(selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[kdx]*(PI/180.0));</div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_g_e_required_8e.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>) {</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;      fprintf(asciiWaveReal, <span class="stringliteral">&quot;%d %f\n&quot;</span>, idx, wave_real); fflush(asciiWaveReal);</div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;      fprintf(asciiWaveImag, <span class="stringliteral">&quot;%d %f\n&quot;</span>, idx, wave_imag); fflush(asciiWaveImag);</div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;    }</div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;    <span class="keywordflow">if</span> (idx % nPoints == 0 &amp;&amp; idx &gt; 0) {</div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;      kdx++;</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;    }</div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;</div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;    <span class="comment">/* Calc sms modulation */</span></div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;    <span class="keywordtype">double</span> centeredIndex = idx - (newRes-1) * 0.5;</div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;    <span class="keywordflow">for</span> (jdx = 0; jdx &lt; sms_multiband_factor; jdx++) {</div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;      slice_offset = (sms_slice_gap / 10) * (1.0 + jdx - (sms_multiband_factor / 2.0) - 0.5);</div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;      p = 2.0 * PI * <a class="code" href="_k_s_foundation__host_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a> * slice_offset * selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a> * centeredIndex * RF_UPDATE_TIME * 1e-6 + sms_phase_modulation[jdx];</div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;</div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;      <span class="keywordflow">if</span> (single_band_mode &gt;= 0) {</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;        <span class="keywordflow">if</span> (jdx == single_band_mode) {</div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;          sms_modulation_real += cos(p);</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;          sms_modulation_imag += sin(p);</div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;        }</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;        sms_modulation_real += cos(p);</div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;        sms_modulation_imag += sin(p);</div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;      }</div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;    }</div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;    <span class="comment">/* Apply sms modulation via complex multiplication */</span></div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;    sms_wave_real[idx] = wave_real * sms_modulation_real - wave_imag * sms_modulation_imag;</div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;    sms_wave_imag[idx] = wave_real * sms_modulation_imag + wave_imag * sms_modulation_real;</div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;</div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_g_e_required_8e.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>) {</div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;      fprintf(asciiWaveRealMB, <span class="stringliteral">&quot;%d %f\n&quot;</span>, idx, sms_wave_real[idx]); fflush(asciiWaveRealMB);</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;      fprintf(asciiWaveImagMB, <span class="stringliteral">&quot;%d %f\n&quot;</span>, idx, sms_wave_imag[idx]); fflush(asciiWaveImagMB);</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;      fprintf(asciiWaveRealMod, <span class="stringliteral">&quot;%d %f\n&quot;</span>, idx, sms_modulation_real); fflush(asciiWaveRealMod);</div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;      fprintf(asciiWaveImagMod, <span class="stringliteral">&quot;%d %f\n&quot;</span>, idx, sms_modulation_imag); fflush(asciiWaveImagMod);</div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;    }</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;  }</div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_g_e_required_8e.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>) {</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;    fclose(asciiWaveReal);</div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;    fclose(asciiWaveImag);</div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;    fclose(asciiWaveRealMB);</div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;    fclose(asciiWaveImagMB);</div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;    <span class="comment">/*ks_error(&quot;GAM=%g, PI=%g, grad.amp=%g, slice_gap=%g, dt=%d&quot;, GAM, PI, selrf-&gt;grad.amp, sms_slice_gap, RF_UPDATE_TIME);*/</span></div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;  }</div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;  kdx = 0;</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;  <span class="keywordflow">for</span> (idx=0; idx &lt; newRes; idx++) {</div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;</div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;    <span class="keywordflow">if</span> (sms_phase_modulation_mode == <a class="code" href="_k_s_foundation_8h.html#afbfc330f4f27194b4e27753383464227ae3bd201ec523ddd720faf6625365aae7">KS_SELRF_SMS_PHAS_MOD_OFF</a> || sms_phase_modulation_mode == <a class="code" href="_k_s_foundation_8h.html#afbfc330f4f27194b4e27753383464227a385b4332bc937b39f58986df5422adba">KS_SELRF_SMS_PHAS_MOD_AMPL</a>) {</div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;</div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;      <span class="comment">/* Use real part and place waves in selrfMB */</span></div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;      selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[idx] = sms_wave_real[idx];</div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;</div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;</div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;      <span class="comment">/* Convert from polar to cartesian and place waves in selrfMB */</span></div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;      selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[idx]    = sqrt(pow(sms_wave_real[idx], 2.0) + pow(sms_wave_imag[idx], 2.0));</div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;      selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[idx] = atan2(sms_wave_imag[idx], sms_wave_real[idx]) * (180.0/PI);</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;</div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;    }</div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;</div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;    <span class="keywordflow">if</span> (idx % nPoints == 0 &amp;&amp; idx &gt; 0) {</div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;      kdx++;</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;    }</div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;  }</div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;</div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;  <span class="comment">/* Update resolution fields */</span></div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;  selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> = newRes;</div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;  <span class="keywordflow">if</span> (sms_phase_modulation_mode == <a class="code" href="_k_s_foundation_8h.html#afbfc330f4f27194b4e27753383464227ae3bd201ec523ddd720faf6625365aae7">KS_SELRF_SMS_PHAS_MOD_OFF</a> || sms_phase_modulation_mode == <a class="code" href="_k_s_foundation_8h.html#afbfc330f4f27194b4e27753383464227a385b4332bc937b39f58986df5422adba">KS_SELRF_SMS_PHAS_MOD_AMPL</a>) {</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;    selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> = 0;</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;    selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> = 0;</div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;    selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> = newRes;</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;  }</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;</div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_g_e_required_8e.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>) {sprintf(fname, <span class="stringliteral">&quot;%s%s_mb_rf.txt&quot;</span>, outputdir_uid, selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>); <a class="code" href="_k_s_foundation__host_8c.html#a01d67d3faa8f2088f82af10aa0a28af0">ks_print_waveform</a>(selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, fname, selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>); }</div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_g_e_required_8e.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>) {sprintf(fname, <span class="stringliteral">&quot;%s%s_mb_theta.txt&quot;</span>, outputdir_uid, selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>); <a class="code" href="_k_s_foundation__host_8c.html#a01d67d3faa8f2088f82af10aa0a28af0">ks_print_waveform</a>(selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, fname, selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>); }</div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;</div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;  <span class="comment">/* Modify rfpulse structure */</span></div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;  <span class="keywordtype">double</span> standard_pw = 1e-3;</div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;  <span class="keywordtype">double</span> b1_scale_factor = <a class="code" href="_k_s_foundation_8h.html#abf8e5bff3973c32360bc0e1505db61bc">ks_waveform_absmax</a>(selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, newRes) / base_rf_max_amp;</div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;  selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.max_b1 *= b1_scale_factor;</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;  selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.area /= b1_scale_factor;</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;  selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.effwidth /= b1_scale_factor;</div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;  selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.max_int_b1_sq = selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.max_b1 * selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.max_b1 * selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.effwidth * (selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>) * 1e-6 / standard_pw;</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;  selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.max_rms_b1 = sqrt(selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.max_int_b1_sq / ((selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>) * 1e-6) * standard_pw);</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;</div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;  <span class="comment">/* Normalize to 1 */</span></div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a23b3d305df1e2ad0563f8a2fea2330df">ks_wave_multiplyval</a>(&amp;selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>, 1.0 / <a class="code" href="_k_s_foundation_8h.html#a2bfec427bf5a8966edf279b2eba23396">ks_wave_absmax</a>(&amp;selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>));</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;</div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;  <span class="comment">/* register the RF for later heat calcs and RF scaling */</span></div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;  <span class="keywordtype">char</span> description[<a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> + 4];</div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;  sprintf(description, <span class="stringliteral">&quot;%s_sms&quot;</span>, selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;  status = <a class="code" href="_k_s_foundation__host_8c.html#a106b3a179fec686052d27fcc87129916">ks_eval_rf</a>(&amp;selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>, description);</div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;  <span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;</div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_g_e_required_8e.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>) {</div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;    sprintf(fname, <span class="stringliteral">&quot;%s%s_mb_params.txt&quot;</span>, outputdir_uid, selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;    asciiWaveParams = fopen(fname,<span class="stringliteral">&quot;w&quot;</span>);</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;    fprintf(asciiWaveParams, <span class="stringliteral">&quot;%f\n&quot;</span>, (<span class="keywordtype">float</span>)selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a7ab9fec3ad0848d2dff5db7279f1a806">flip</a>);</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;    fprintf(asciiWaveParams, <span class="stringliteral">&quot;%f\n&quot;</span>, (<span class="keywordtype">float</span>)selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a>);</div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;    fprintf(asciiWaveParams, <span class="stringliteral">&quot;%f\n&quot;</span>, (<span class="keywordtype">float</span>)selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.max_b1);</div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;    fprintf(asciiWaveParams, <span class="stringliteral">&quot;%f\n&quot;</span>, (<span class="keywordtype">float</span>)selrfMB-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#aa89aa200e4334657ad976733bebcbc2a">slthick</a>);</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;    fprintf(asciiWaveParams, <span class="stringliteral">&quot;%f\n&quot;</span>, (<span class="keywordtype">float</span>)sms_slice_gap);</div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;    fprintf(asciiWaveParams, <span class="stringliteral">&quot;%f\n&quot;</span>, (<span class="keywordtype">float</span>)sms_multiband_factor);</div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;    fprintf(asciiWaveParams, <span class="stringliteral">&quot;%f\n&quot;</span>, (<span class="keywordtype">float</span>)b1_scale_factor);</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;    fflush(asciiWaveParams); fclose(asciiWaveParams);</div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;  }</div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;</div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;</div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;} <span class="comment">/* EOF */</span></div><div class="ttc" id="struct_k_s___s_e_l_r_f_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#af33317a98ade78e3ac252b33cbb794af">KS_SELRF::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1340</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a01d67d3faa8f2088f82af10aa0a28af0"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a01d67d3faa8f2088f82af10aa0a28af0">ks_print_waveform</a></div><div class="ttdeci">void ks_print_waveform(const KS_WAVEFORM waveform, char *filename, int res)</div><div class="ttdoc">Writes a KS_WAVEFORM to disk with the specified filename</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3658</div></div>
<div class="ttc" id="_g_e_required_8e_html_ac3e1795766a80ec63b157951b4b9a7d4"><div class="ttname"><a href="_g_e_required_8e.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a></div><div class="ttdeci">int debug</div><div class="ttdef"><b>Definition:</b> GERequired.e:2630</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_aca53dcf7a61b8beba82e8f9a0c768cb5"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#aca53dcf7a61b8beba82e8f9a0c768cb5">KS_SELRF::sms_info</a></div><div class="ttdeci">KS_SMS_INFO sms_info</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1343</div></div>
<div class="ttc" id="struct_k_s___r_f_html_ae183c3e4095d1c6d14b3d59a0da97928"><div class="ttname"><a href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">KS_RF::rfpulse</a></div><div class="ttdeci">RF_PULSE rfpulse</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:797</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5adde8c85d3d00e22516df96c55f4eb7"><div class="ttname"><a href="_k_s_foundation_8h.html#a5adde8c85d3d00e22516df96c55f4eb7">KS_INITZEROS</a></div><div class="ttdeci">#define KS_INITZEROS(n)</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:125</div></div>
<div class="ttc" id="struct_k_s___s_m_s___i_n_f_o_html_a1b26a538ab6e22362275d427f991a3e1"><div class="ttname"><a href="struct_k_s___s_m_s___i_n_f_o.html#a1b26a538ab6e22362275d427f991a3e1">KS_SMS_INFO::slice_gap</a></div><div class="ttdeci">float slice_gap</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1218</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a2ff8c7b3ff61db2590c067015ecae1af"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a2ff8c7b3ff61db2590c067015ecae1af">ks_eval_sms_get_phase_modulation</a></div><div class="ttdeci">STATUS ks_eval_sms_get_phase_modulation(float *sms_phase_modulation, const int sms_multiband_factor, const int sms_phase_modulation_mode)</div><div class="ttdoc">Sets up an array with values for phase modulation between slices in a multi-band (MB) RF...</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:2054</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a2875ace95558531062d08465b2bcc282"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a></div><div class="ttdeci">float GAM</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a7ab9fec3ad0848d2dff5db7279f1a806"><div class="ttname"><a href="struct_k_s___r_f.html#a7ab9fec3ad0848d2dff5db7279f1a806">KS_RF::flip</a></div><div class="ttdeci">float flip</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:789</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a2bfec427bf5a8966edf279b2eba23396"><div class="ttname"><a href="_k_s_foundation_8h.html#a2bfec427bf5a8966edf279b2eba23396">ks_wave_absmax</a></div><div class="ttdeci">float ks_wave_absmax(const KS_WAVE *wave)</div><div class="ttdoc">Returns the maximum absolute value in a KS_WAVE sequence object</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:986</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aacb2fe1d83c45e8d0525f363bdd6b8a6"><div class="ttname"><a href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a></div><div class="ttdeci">#define KS_DESCRIPTION_LENGTH</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:112</div></div>
<div class="ttc" id="struct_k_s___r_f_html_aecd8b68c159a31a28e2a2ec003b593e2"><div class="ttname"><a href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">KS_RF::thetawave</a></div><div class="ttdeci">KS_WAVE thetawave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:800</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a2e788c6338615164f241b755f219c961"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a2e788c6338615164f241b755f219c961">rhkacq_uid</a></div><div class="ttdeci">int rhkacq_uid</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_adeab1cc34f1a7f20f41e8825d849981e"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">KS_SELRF::rf</a></div><div class="ttdeci">KS_RF rf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1334</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">KS_WAVE::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:516</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a2a9b610a78cdae3ac8ef682bd34f7e0d"><div class="ttname"><a href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">KS_RF::rfwave</a></div><div class="ttdeci">KS_WAVE rfwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:798</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_afbfc330f4f27194b4e27753383464227a385b4332bc937b39f58986df5422adba"><div class="ttname"><a href="_k_s_foundation_8h.html#afbfc330f4f27194b4e27753383464227a385b4332bc937b39f58986df5422adba">KS_SELRF_SMS_PHAS_MOD_AMPL</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1767</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ab508ded41392ee86a2a619d3e93d2373"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">KS_TRAP::amp</a></div><div class="ttdeci">float amp</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:433</div></div>
<div class="ttc" id="struct_k_s___s_m_s___i_n_f_o_html_a58c64aa08739814113f9cd8a01b7f2e6"><div class="ttname"><a href="struct_k_s___s_m_s___i_n_f_o.html#a58c64aa08739814113f9cd8a01b7f2e6">KS_SMS_INFO::mb_factor</a></div><div class="ttdeci">int mb_factor</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1217</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_aa2b37fa5aa0bffff1de8ca29e7c19cc1"><div class="ttname"><a href="_k_s_foundation__host_8c.html#aa2b37fa5aa0bffff1de8ca29e7c19cc1">ks_init_wave</a></div><div class="ttdeci">void ks_init_wave(KS_WAVE *wave)</div><div class="ttdoc">Resets a KS_WAVE sequence object to its default value (KS_INIT_WAVE)</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:53</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a106b3a179fec686052d27fcc87129916"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a106b3a179fec686052d27fcc87129916">ks_eval_rf</a></div><div class="ttdeci">STATUS ks_eval_rf(KS_RF *rf, const char *const desc)</div><div class="ttdoc">Sets up a KS_RF object</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:1451</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aa672c7e32ce3bce20534fa814901e720"><div class="ttname"><a href="_k_s_foundation_8h.html#aa672c7e32ce3bce20534fa814901e720">ks_wave_res</a></div><div class="ttdeci">int ks_wave_res(const KS_WAVE *wave)</div><div class="ttdoc">Returns the number of samples in a KS_WAVE sequence object</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:869</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_afbfc330f4f27194b4e27753383464227ae3bd201ec523ddd720faf6625365aae7"><div class="ttname"><a href="_k_s_foundation_8h.html#afbfc330f4f27194b4e27753383464227ae3bd201ec523ddd720faf6625365aae7">KS_SELRF_SMS_PHAS_MOD_OFF</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1765</div></div>
<div class="ttc" id="struct_k_s___s_m_s___i_n_f_o_html_a177e78699b1c480f77893fa200380d84"><div class="ttname"><a href="struct_k_s___s_m_s___i_n_f_o.html#a177e78699b1c480f77893fa200380d84">KS_SMS_INFO::pulse_type</a></div><div class="ttdeci">int pulse_type</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1219</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_abf8e5bff3973c32360bc0e1505db61bc"><div class="ttname"><a href="_k_s_foundation_8h.html#abf8e5bff3973c32360bc0e1505db61bc">ks_waveform_absmax</a></div><div class="ttdeci">float ks_waveform_absmax(const KS_WAVEFORM waveform, int res)</div><div class="ttdoc">Returns the maximum absolute value in a KS_WAVEFORM</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:965</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_af968d7d6e4fa1359fba5550fc39ae172ae28e1f22fff3b271570f3b9ec916bf58"><div class="ttname"><a href="_k_s_foundation_8h.html#af968d7d6e4fa1359fba5550fc39ae172ae28e1f22fff3b271570f3b9ec916bf58">KS_SELRF_SMS_MB</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1758</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a23b3d305df1e2ad0563f8a2fea2330df"><div class="ttname"><a href="_k_s_foundation_8h.html#a23b3d305df1e2ad0563f8a2fea2330df">ks_wave_multiplyval</a></div><div class="ttdeci">void ks_wave_multiplyval(KS_WAVE *wave, float val)</div><div class="ttdoc">In-place scalar multiplication of a KS_WAVE</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1135</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a27640b66342aa92e2fecafb0e8471785"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">KS_WAVE::waveform</a></div><div class="ttdeci">KS_WAVEFORM waveform</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:519</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_WAVE::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:518</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_aa89aa200e4334657ad976733bebcbc2a"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#aa89aa200e4334657ad976733bebcbc2a">KS_SELRF::slthick</a></div><div class="ttdeci">float slthick</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1336</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="abd0ec7d0d685aa5fc55d4a0d109543d3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abd0ec7d0d685aa5fc55d4a0d109543d3">&#9670;&nbsp;</a></span>ks_eval_sms_calc_slice_gap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_eval_sms_calc_slice_gap </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sms_multiband_factor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const SCAN_INFO *&#160;</td>
          <td class="paramname"><em>org_slice_positions</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nslices</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>slthick</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>slspace</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Calculates the resulting slice gap in [mm] for SMS RF</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">sms_multiband_factor</td><td>The multi-band acceleration factor </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">org_slice_positions</td><td>SCAN_INFO struct holding the original slice information </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nslices</td><td>Prescribed number of slices </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">slthick</td><td>Prescribed slice thickness </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">slspace</td><td>Prescribed slice spacing </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">slicegap</td><td>SMS slice gap in [mm] </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;                                                                                                                                            {</div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;</div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;  <span class="keywordtype">float</span> gap;</div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;</div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;  <span class="keywordflow">if</span> (nslices % sms_multiband_factor) {</div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_sms_calc_slice_gap: Number of slices (%d, 3rd arg) must be divisible with the MB factor (%d, 1st arg)&quot;</span>, nslices, sms_multiband_factor);</div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;  }</div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;</div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;  <span class="comment">/* gap between MB slices mm */</span></div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;  <span class="comment">/*gap = org_slice_positions[nslices/sms_multiband_factor].optloc - org_slice_positions[0].optloc;*/</span></div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;  gap = (float)((nslices + sms_multiband_factor - 1) / sms_multiband_factor) * (<span class="keywordtype">float</span>)(slthick + slspace);</div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;</div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;  <span class="keywordflow">return</span> gap;</div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;</div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;} <span class="comment">/* EOF */</span></div><div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="afd7835fa3e8d6eaabd8e53397923eb93"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afd7835fa3e8d6eaabd8e53397923eb93">&#9670;&nbsp;</a></span>ks_eval_sms_calc_caipi_area()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_eval_sms_calc_caipi_area </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>caipi_fov_shift</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>sms_slice_gap</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Calculates the CAIPI blip area</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">caipi_fov_shift</td><td>The FOV shift in units of faction of FOV (e.g. 2 means shift of FOV/2) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sms_slice_gap</td><td>Slice gap in [mm] for the selrfMB pulse </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">caipi_blip_area</td><td>The area of the CAIPIRINHA blip in [(G/cm) * us] </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;                                                                            {</div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;</div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;  <span class="keywordflow">if</span> (sms_slice_gap &lt;= 0) {</div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;    <span class="keywordflow">return</span> 0.0;</div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;  }</div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;</div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;  <span class="comment">/* Calculate CAIPI-blip area in us*G/cm */</span></div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;  <span class="keywordflow">return</span> ((caipi_fov_shift-1)*(<span class="keywordtype">float</span>)PI/(<span class="keywordtype">float</span>)caipi_fov_shift) / (2.0*PI*<a class="code" href="_k_s_foundation__host_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a>*1e-6 * (sms_slice_gap/10.0));</div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;</div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;} <span class="comment">/* EOF */</span></div><div class="ttc" id="_k_s_foundation__host_8c_html_a2875ace95558531062d08465b2bcc282"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a></div><div class="ttdeci">float GAM</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a831be67afd29ffe6449edd3ddd27813f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a831be67afd29ffe6449edd3ddd27813f">&#9670;&nbsp;</a></span>ks_eval_sms_make_pins()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_sms_make_pins </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *&#160;</td>
          <td class="paramname"><em>selrfPINS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *&#160;</td>
          <td class="paramname"><em>selrf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>sms_slice_gap</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Creates a PINS RF pulse (<a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a>) based on a <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> object</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">selrfPINS</td><td>PINS RF pulse (<a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> object) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">selrf</td><td>The original (single-band) <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> object (set up using <a class="el" href="_k_s_foundation_8h.html#ad77a28d39f423bca930ee2f8f392de17" title="Sets up a KS_SELRF object for RF slice selection with preset gradient constraints">ks_eval_selrf()</a>) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sms_slice_gap</td><td>Slice gap in [mm] for the selrfMB pulse </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;                                                  {</div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;</div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;  STATUS status;</div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;  <span class="keywordtype">int</span> jdx, idx, kdx = 0, gdx = 0, <a class="code" href="_g_e_required_8e.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a> = 0;</div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;  <span class="keywordtype">int</span> orgDur = selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>;</div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;  <a class="code" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> gzblip = <a class="code" href="_k_s_foundation_8h.html#a1ba17433713316fa65385237ebb0fb67">KS_INIT_TRAP</a>;</div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;</div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;  <span class="comment">/* Duplicate the selRF structure  */</span></div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;  <span class="keywordflow">if</span> (selrfPINS != selrf ) {</div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;    *selrfPINS = *selrf;</div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;  }</div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;</div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;  <span class="comment">/* Set info struct */</span></div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;  selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#aca53dcf7a61b8beba82e8f9a0c768cb5">sms_info</a>.<a class="code" href="struct_k_s___s_m_s___i_n_f_o.html#a1b26a538ab6e22362275d427f991a3e1">slice_gap</a> = sms_slice_gap;</div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;  selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#aca53dcf7a61b8beba82e8f9a0c768cb5">sms_info</a>.<a class="code" href="struct_k_s___s_m_s___i_n_f_o.html#a177e78699b1c480f77893fa200380d84">pulse_type</a> = <a class="code" href="_k_s_foundation_8h.html#af968d7d6e4fa1359fba5550fc39ae172aad24beb62524f381a37c7edad4cde495">KS_SELRF_SMS_PINS</a>;</div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;</div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#a8efdbce2fbb4bf21a6fd8983fdd6d5c7">ks_init_trap</a>(&amp;selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#af33317a98ade78e3ac252b33cbb794af">grad</a>);</div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;</div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_g_e_required_8e.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a> == 1) {<a class="code" href="_k_s_foundation__host_8c.html#a01d67d3faa8f2088f82af10aa0a28af0">ks_print_waveform</a>(selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, <span class="stringliteral">&quot;pins_rfMB_base.txt&quot;</span>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>); }</div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;</div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;  <span class="keywordtype">double</span> kzw = (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a6b955cde0388e60c3ec5f602072a8e0f">bw</a> * selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> * 1e-6) / (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#aa89aa200e4334657ad976733bebcbc2a">slthick</a> / 10); <span class="comment">/* 1/cm, width in kz-space we must go */</span></div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;  <span class="keywordtype">int</span> NPulses = (floor(ceil(kzw / (1 / (sms_slice_gap / 10))) / 2) * 2) + 1; <span class="comment">/* number of subpulses (odd) */</span></div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;</div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;  <span class="comment">/* Init waves */</span></div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a> rfLowRes = <a class="code" href="_k_s_foundation_8h.html#a6f3115cf4ed2b225acc3a46df223ba7c">KS_INIT_WAVEFORM</a>;</div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;  <a class="code" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> gzBlipWave = <a class="code" href="_k_s_foundation_8h.html#ae837f68085b812e9e22a659cc26a42cc">KS_INIT_WAVE</a>;</div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;  <span class="keywordtype">float</span> *lowResGrid = alloca(NPulses * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;  <span class="keywordtype">float</span> *baseGrid = alloca(selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;</div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;  <span class="comment">/* create index for interpolation */</span></div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;  <span class="keywordflow">for</span> (idx = 0; idx &lt; selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>; idx++) {</div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;    baseGrid[idx] = (float) idx / (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> - 1);</div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;  }</div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;  <span class="keywordflow">for</span> (idx = 0; idx &lt; NPulses; idx++) {</div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;    lowResGrid[idx] = (float) idx / (NPulses - 1);</div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;  }</div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;</div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;  <span class="comment">/* Interpolate the base rf to get PINS sub pulse amplitudes and high res for MB pulse */</span></div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#abff3210ecf672ab9eaa08d4bd2316825">ks_eval_linear_interp1</a>(baseGrid, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, lowResGrid, NPulses, rfLowRes);</div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;</div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_g_e_required_8e.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a> == 1) {<a class="code" href="_k_s_foundation__host_8c.html#a01d67d3faa8f2088f82af10aa0a28af0">ks_print_waveform</a>(rfLowRes, <span class="stringliteral">&quot;pins_rfLowRes.txt&quot;</span>, NPulses); }</div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;</div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;  <span class="comment">/* Create blip */</span></div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;  <span class="keywordtype">double</span> gArea = 1 / (sms_slice_gap / 10) / (<a class="code" href="_k_s_foundation__host_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a>); <span class="comment">/* (g sec)/cm, k-area of each blip */</span></div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;  gzblip.<a class="code" href="struct_k_s___t_r_a_p.html#a97ab43f6fd28920a42d987c8fec4afec">area</a> = gArea * 1e6; <span class="comment">/* (G/cm)*us */</span></div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;  status = <a class="code" href="_k_s_foundation__host_8c.html#a29c20221f74975954ea8917e5db5a635">ks_eval_trap1</a>(&amp;gzblip, <span class="stringliteral">&quot;PINSblip&quot;</span>); <span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;  status = <a class="code" href="_k_s_foundation__host_8c.html#a44c9e307b5545613303fdd4c700488f3">ks_eval_trap2wave</a>(&amp;gzBlipWave, &amp;gzblip); <span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#a8efdbce2fbb4bf21a6fd8983fdd6d5c7">ks_init_trap</a>(&amp;gzblip);</div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;</div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;  <span class="comment">/* Matched-duration RF subpulses */</span></div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;  <span class="keywordtype">float</span> <a class="code" href="_g_e_required_8e.html#a5dfe9b1d5c3f79c53ef1e8513159ce18">maxB1</a> = 0.24; <span class="comment">/* temp. */</span></div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;  <span class="keywordtype">float</span> dt = GRAD_UPDATE_TIME / 1000000.0; <span class="comment">/* sec */</span></div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;  <span class="keywordtype">float</span> pulseArea = (float) selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a7ab9fec3ad0848d2dff5db7279f1a806">flip</a> * (PI / 180.0); <span class="comment">/* radians or Hz (depending on how you look at it) */</span></div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;  <span class="keywordtype">float</span> subArea = (<a class="code" href="_k_s_foundation_8h.html#abf8e5bff3973c32360bc0e1505db61bc">ks_waveform_absmax</a>(rfLowRes, NPulses) * pulseArea) / (<a class="code" href="_k_s_foundation_8h.html#a836fc0fca52fac39fbecc05b3f1b2329">ks_waveform_sum</a>(rfLowRes, NPulses) * 2.0 * PI * <a class="code" href="_k_s_foundation__host_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a>); <span class="comment">/* Gauss * sec */</span></div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;  <span class="keywordtype">int</span> hpw = ceil(subArea / (<a class="code" href="_g_e_required_8e.html#a5dfe9b1d5c3f79c53ef1e8513159ce18">maxB1</a> * dt)); <span class="comment">/* number of time points in sub pulse */</span></div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;  <span class="keywordtype">float</span> scaleFactor = 1.0;</div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;</div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;  <span class="comment">/* kludge :( */</span></div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;  <span class="keywordflow">for</span> (idx = 0; idx &lt; NPulses; idx++) {</div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;    <span class="keywordflow">if</span> (rfLowRes[idx] == 0) {</div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;      rfLowRes[idx] = rfLowRes[idx] + 0.01;</div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;    }</div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;  }</div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;</div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;  <span class="comment">/* Loop to concatenate the sub pulses and gradient blips */</span></div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;  <span class="keywordflow">for</span> (idx = 0; idx &lt; NPulses; idx++) {</div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;    <span class="keywordflow">for</span> (jdx = 0; jdx &lt; hpw; jdx++) {</div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;      selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[kdx] = rfLowRes[idx] / scaleFactor;</div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;      selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[kdx] = 0.0;</div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;      kdx++;</div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;    }</div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;    <span class="keywordflow">if</span> (idx != NPulses - 1) {</div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;      <span class="keywordflow">for</span> (jdx = 0; jdx &lt; gzBlipWave.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>; jdx++) {</div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;        selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[kdx] = 0.0;</div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;        selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[kdx] = gzBlipWave.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[jdx];</div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;        kdx++; gdx++;</div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;      }</div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;    }</div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;  }</div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;</div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;  <span class="comment">/* Set duration and resolution */</span></div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;  selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a6aa33ad60a96c56283d44d989fe2d499">gradwave_units</a> = <a class="code" href="_k_s_foundation_8h.html#adfc20623c6ef26b08b99174a1a77323ca18c0e84d66e6f381b509ea483f7cc7fd">KS_GRADWAVE_ABSOLUTE</a>;</div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;  selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> = RUP_FACTOR(kdx, GRAD_UPDATE_TIME);</div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;  selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> = selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> * GRAD_UPDATE_TIME;</div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;  selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> = selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>;</div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;  selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> = selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>;</div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;  selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.isodelay = RUP_FACTOR(ceil((<span class="keywordtype">float</span>)selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.isodelay * ((<span class="keywordtype">float</span>)selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>/(<span class="keywordtype">float</span>)orgDur)), GRAD_UPDATE_TIME);</div><div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;  selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#afa10c3dbec21b5cc34276e741deeb97e">iso2end</a> = selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.isodelay;</div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;  selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a6b955cde0388e60c3ec5f602072a8e0f">bw</a> = 1e3 * (NPulses+1) * selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#aa89aa200e4334657ad976733bebcbc2a">slthick</a> / sms_slice_gap;</div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;</div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;  <span class="comment">/* If the resolution has been rounded up, place zeros at the end */</span></div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;  for (idx = kdx; idx &lt; selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>; idx++) {</div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;    selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[idx] = 0.0;</div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;    selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[idx] = 0.0;</div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;  }</div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;</div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_g_e_required_8e.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a> == 1) {<a class="code" href="_k_s_foundation__host_8c.html#a01d67d3faa8f2088f82af10aa0a28af0">ks_print_waveform</a>(selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, <span class="stringliteral">&quot;pins_RF.txt&quot;</span>, selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>); }</div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_g_e_required_8e.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a> == 1) {<a class="code" href="_k_s_foundation__host_8c.html#a01d67d3faa8f2088f82af10aa0a28af0">ks_print_waveform</a>(selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, <span class="stringliteral">&quot;pins_GRAD.txt&quot;</span>, selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>); }</div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;</div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;  <span class="comment">/* Normalize to 1 */</span></div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#ace0cae3befbb3608319f34a61657bc26">ks_waveform_multiplyval</a>(selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, 1.0 / <a class="code" href="_k_s_foundation_8h.html#abf8e5bff3973c32360bc0e1505db61bc">ks_waveform_absmax</a>(selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>), selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>);</div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;</div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;  <span class="comment">/* rfStat */</span></div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;  status = <a class="code" href="_k_s_foundation__host_8c.html#ae514f91fbedc683d5e9db931960b79b1">ks_eval_rfstat</a>(&amp;selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>); <span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;</div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;  <span class="comment">/* init theta wave */</span></div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#aa2b37fa5aa0bffff1de8ca29e7c19cc1">ks_init_wave</a>(&amp;selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>);</div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;  selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> = selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>;</div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;  selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> = selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>;</div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_g_e_required_8e.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a> == 1) {<a class="code" href="_k_s_foundation__host_8c.html#a01d67d3faa8f2088f82af10aa0a28af0">ks_print_waveform</a>(selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, <span class="stringliteral">&quot;pins_TH.txt&quot;</span>, selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>); }</div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;</div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;  <span class="comment">/* Register the RF */</span></div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;  <span class="keywordtype">char</span> description[<a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> + 4];</div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;  sprintf(description, <span class="stringliteral">&quot;%s_PINS&quot;</span>, selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;  sprintf(selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, <span class="stringliteral">&quot;%s_PINS&quot;</span>, selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_g_e_required_8e.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a> == 1) {fprintf(stderr, <span class="stringliteral">&quot;---------- PINS %s rfstat ---------\n&quot;</span>, selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);}</div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_g_e_required_8e.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a> == 1) {<a class="code" href="_k_s_foundation__host_8c.html#a609ddd32fdfbfa689c413d494a55d62c">ks_print_rfpulse</a>(selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>, stderr);}</div><div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__host_8c.html#a106b3a179fec686052d27fcc87129916">ks_eval_rf</a>(&amp;selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>, description);</div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;</div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_adfc20623c6ef26b08b99174a1a77323ca18c0e84d66e6f381b509ea483f7cc7fd"><div class="ttname"><a href="_k_s_foundation_8h.html#adfc20623c6ef26b08b99174a1a77323ca18c0e84d66e6f381b509ea483f7cc7fd">KS_GRADWAVE_ABSOLUTE</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1772</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#af33317a98ade78e3ac252b33cbb794af">KS_SELRF::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1340</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a01d67d3faa8f2088f82af10aa0a28af0"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a01d67d3faa8f2088f82af10aa0a28af0">ks_print_waveform</a></div><div class="ttdeci">void ks_print_waveform(const KS_WAVEFORM waveform, char *filename, int res)</div><div class="ttdoc">Writes a KS_WAVEFORM to disk with the specified filename</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3658</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a29c20221f74975954ea8917e5db5a635"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a29c20221f74975954ea8917e5db5a635">ks_eval_trap1</a></div><div class="ttdeci">STATUS ks_eval_trap1(KS_TRAP *trap, const char *const desc)</div><div class="ttdoc">Sets up a trapezoid using a KS_TRAP sequence object with preset gradient constraints</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:403</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html"><div class="ttname"><a href="struct_k_s___t_r_a_p.html">KS_TRAP</a></div><div class="ttdoc">Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:430</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html"><div class="ttname"><a href="struct_k_s___w_a_v_e.html">KS_WAVE</a></div><div class="ttdoc">Core sequence object making arbitrary waveforms on any board (using float data format)</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:514</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a836fc0fca52fac39fbecc05b3f1b2329"><div class="ttname"><a href="_k_s_foundation_8h.html#a836fc0fca52fac39fbecc05b3f1b2329">ks_waveform_sum</a></div><div class="ttdeci">float ks_waveform_sum(const KS_WAVEFORM waveform, int res)</div><div class="ttdoc">Returns the sum of a KS_WAVEFORM</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1030</div></div>
<div class="ttc" id="_g_e_required_8e_html_ac3e1795766a80ec63b157951b4b9a7d4"><div class="ttname"><a href="_g_e_required_8e.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a></div><div class="ttdeci">int debug</div><div class="ttdef"><b>Definition:</b> GERequired.e:2630</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_aca53dcf7a61b8beba82e8f9a0c768cb5"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#aca53dcf7a61b8beba82e8f9a0c768cb5">KS_SELRF::sms_info</a></div><div class="ttdeci">KS_SMS_INFO sms_info</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1343</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ae837f68085b812e9e22a659cc26a42cc"><div class="ttname"><a href="_k_s_foundation_8h.html#ae837f68085b812e9e22a659cc26a42cc">KS_INIT_WAVE</a></div><div class="ttdeci">#define KS_INIT_WAVE</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:145</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_a607347e9c1c7a9eef21fff556faccc3f"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">KS_SELRF::gradwave</a></div><div class="ttdeci">KS_WAVE gradwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1342</div></div>
<div class="ttc" id="struct_k_s___r_f_html_ae183c3e4095d1c6d14b3d59a0da97928"><div class="ttname"><a href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">KS_RF::rfpulse</a></div><div class="ttdeci">RF_PULSE rfpulse</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:797</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a8efdbce2fbb4bf21a6fd8983fdd6d5c7"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a8efdbce2fbb4bf21a6fd8983fdd6d5c7">ks_init_trap</a></div><div class="ttdeci">void ks_init_trap(KS_TRAP *trap)</div><div class="ttdoc">Resets a KS_TRAP sequence object to its default value (KS_INIT_TRAP)</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:45</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a6aa33ad60a96c56283d44d989fe2d499"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a6aa33ad60a96c56283d44d989fe2d499">KS_WAVE::gradwave_units</a></div><div class="ttdeci">int gradwave_units</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:521</div></div>
<div class="ttc" id="struct_k_s___s_m_s___i_n_f_o_html_a1b26a538ab6e22362275d427f991a3e1"><div class="ttname"><a href="struct_k_s___s_m_s___i_n_f_o.html#a1b26a538ab6e22362275d427f991a3e1">KS_SMS_INFO::slice_gap</a></div><div class="ttdeci">float slice_gap</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1218</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_abff3210ecf672ab9eaa08d4bd2316825"><div class="ttname"><a href="_k_s_foundation__host_8c.html#abff3210ecf672ab9eaa08d4bd2316825">ks_eval_linear_interp1</a></div><div class="ttdeci">void ks_eval_linear_interp1(const float *x, int x_length, const float *y, const float *xx, int xx_length, float *yy)</div><div class="ttdoc">Linear interpolation</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:2511</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a44c9e307b5545613303fdd4c700488f3"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a44c9e307b5545613303fdd4c700488f3">ks_eval_trap2wave</a></div><div class="ttdeci">STATUS ks_eval_trap2wave(KS_WAVE *wave, const KS_TRAP *trap)</div><div class="ttdoc">Converts a trapezoid object (KS_TRAP) to a wave object (KS_WAVE)</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:2547</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a2875ace95558531062d08465b2bcc282"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a></div><div class="ttdeci">float GAM</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a7ab9fec3ad0848d2dff5db7279f1a806"><div class="ttname"><a href="struct_k_s___r_f.html#a7ab9fec3ad0848d2dff5db7279f1a806">KS_RF::flip</a></div><div class="ttdeci">float flip</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:789</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a6f3115cf4ed2b225acc3a46df223ba7c"><div class="ttname"><a href="_k_s_foundation_8h.html#a6f3115cf4ed2b225acc3a46df223ba7c">KS_INIT_WAVEFORM</a></div><div class="ttdeci">#define KS_INIT_WAVEFORM</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:144</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aacb2fe1d83c45e8d0525f363bdd6b8a6"><div class="ttname"><a href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a></div><div class="ttdeci">#define KS_DESCRIPTION_LENGTH</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:112</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a1ba17433713316fa65385237ebb0fb67"><div class="ttname"><a href="_k_s_foundation_8h.html#a1ba17433713316fa65385237ebb0fb67">KS_INIT_TRAP</a></div><div class="ttdeci">#define KS_INIT_TRAP</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:132</div></div>
<div class="ttc" id="struct_k_s___r_f_html_aecd8b68c159a31a28e2a2ec003b593e2"><div class="ttname"><a href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">KS_RF::thetawave</a></div><div class="ttdeci">KS_WAVE thetawave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:800</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_adeab1cc34f1a7f20f41e8825d849981e"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">KS_SELRF::rf</a></div><div class="ttdeci">KS_RF rf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1334</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">KS_WAVE::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:516</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_ae514f91fbedc683d5e9db931960b79b1"><div class="ttname"><a href="_k_s_foundation__host_8c.html#ae514f91fbedc683d5e9db931960b79b1">ks_eval_rfstat</a></div><div class="ttdeci">STATUS ks_eval_rfstat(KS_RF *rf)</div><div class="ttdoc">Sets up the RF_PULSE structure of a KS_RF object</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:1359</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a2a9b610a78cdae3ac8ef682bd34f7e0d"><div class="ttname"><a href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">KS_RF::rfwave</a></div><div class="ttdeci">KS_WAVE rfwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:798</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a98d69b5689c184e4f57ab124e726f964"><div class="ttname"><a href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a></div><div class="ttdeci">float KS_WAVEFORM[KS_MAXWAVELEN]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:179</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a97ab43f6fd28920a42d987c8fec4afec"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a97ab43f6fd28920a42d987c8fec4afec">KS_TRAP::area</a></div><div class="ttdeci">float area</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:434</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_aa2b37fa5aa0bffff1de8ca29e7c19cc1"><div class="ttname"><a href="_k_s_foundation__host_8c.html#aa2b37fa5aa0bffff1de8ca29e7c19cc1">ks_init_wave</a></div><div class="ttdeci">void ks_init_wave(KS_WAVE *wave)</div><div class="ttdoc">Resets a KS_WAVE sequence object to its default value (KS_INIT_WAVE)</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:53</div></div>
<div class="ttc" id="struct_k_s___r_f_html_afa10c3dbec21b5cc34276e741deeb97e"><div class="ttname"><a href="struct_k_s___r_f.html#afa10c3dbec21b5cc34276e741deeb97e">KS_RF::iso2end</a></div><div class="ttdeci">int iso2end</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:794</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a106b3a179fec686052d27fcc87129916"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a106b3a179fec686052d27fcc87129916">ks_eval_rf</a></div><div class="ttdeci">STATUS ks_eval_rf(KS_RF *rf, const char *const desc)</div><div class="ttdoc">Sets up a KS_RF object</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:1451</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ace0cae3befbb3608319f34a61657bc26"><div class="ttname"><a href="_k_s_foundation_8h.html#ace0cae3befbb3608319f34a61657bc26">ks_waveform_multiplyval</a></div><div class="ttdeci">void ks_waveform_multiplyval(KS_WAVEFORM waveform, float val, int res)</div><div class="ttdoc">In-place scalar multiplication of a KS_WAVEFORM</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1127</div></div>
<div class="ttc" id="_g_e_required_8e_html_a5dfe9b1d5c3f79c53ef1e8513159ce18"><div class="ttname"><a href="_g_e_required_8e.html#a5dfe9b1d5c3f79c53ef1e8513159ce18">maxB1</a></div><div class="ttdeci">float maxB1[MAX_ENTRY_POINTS]</div><div class="ttdef"><b>Definition:</b> GERequired.e:260</div></div>
<div class="ttc" id="struct_k_s___s_m_s___i_n_f_o_html_a177e78699b1c480f77893fa200380d84"><div class="ttname"><a href="struct_k_s___s_m_s___i_n_f_o.html#a177e78699b1c480f77893fa200380d84">KS_SMS_INFO::pulse_type</a></div><div class="ttdeci">int pulse_type</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1219</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a609ddd32fdfbfa689c413d494a55d62c"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a609ddd32fdfbfa689c413d494a55d62c">ks_print_rfpulse</a></div><div class="ttdeci">void ks_print_rfpulse(RF_PULSE rfpulse, FILE *fp)</div><div class="ttdoc">Writes out the contents of an RF_PULSE struct for debugging</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3769</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_abf8e5bff3973c32360bc0e1505db61bc"><div class="ttname"><a href="_k_s_foundation_8h.html#abf8e5bff3973c32360bc0e1505db61bc">ks_waveform_absmax</a></div><div class="ttdeci">float ks_waveform_absmax(const KS_WAVEFORM waveform, int res)</div><div class="ttdoc">Returns the maximum absolute value in a KS_WAVEFORM</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:965</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a27640b66342aa92e2fecafb0e8471785"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">KS_WAVE::waveform</a></div><div class="ttdeci">KS_WAVEFORM waveform</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:519</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_WAVE::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:518</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_aa89aa200e4334657ad976733bebcbc2a"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#aa89aa200e4334657ad976733bebcbc2a">KS_SELRF::slthick</a></div><div class="ttdeci">float slthick</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1336</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a6b955cde0388e60c3ec5f602072a8e0f"><div class="ttname"><a href="struct_k_s___r_f.html#a6b955cde0388e60c3ec5f602072a8e0f">KS_RF::bw</a></div><div class="ttdeci">float bw</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:790</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_af968d7d6e4fa1359fba5550fc39ae172aad24beb62524f381a37c7edad4cde495"><div class="ttname"><a href="_k_s_foundation_8h.html#af968d7d6e4fa1359fba5550fc39ae172aad24beb62524f381a37c7edad4cde495">KS_SELRF_SMS_PINS</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1759</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="afb0829ca1ee5754e87491f63e872dd15"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afb0829ca1ee5754e87491f63e872dd15">&#9670;&nbsp;</a></span>ks_eval_sms_make_pins_dante()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_sms_make_pins_dante </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *&#160;</td>
          <td class="paramname"><em>selrfPINS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *&#160;</td>
          <td class="paramname"><em>selrf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>sms_slice_gap</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;                                                                                                    {</div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;  STATUS status;</div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;  <span class="keywordtype">int</span> jdx, idx, kdx = 0, gdx = 0, <a class="code" href="_g_e_required_8e.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a> = 1;</div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;  <span class="keywordtype">int</span> orgDur = selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>;</div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;  <a class="code" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> gzblip = <a class="code" href="_k_s_foundation_8h.html#a1ba17433713316fa65385237ebb0fb67">KS_INIT_TRAP</a>;</div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;</div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;  <span class="comment">/* Duplicate the selRF structure  */</span></div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;  <span class="keywordflow">if</span> (selrfPINS != selrf ) {</div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;    *selrfPINS = *selrf;</div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;  }</div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;</div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;  <span class="comment">/* Set info struct */</span></div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;  selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#aca53dcf7a61b8beba82e8f9a0c768cb5">sms_info</a>.<a class="code" href="struct_k_s___s_m_s___i_n_f_o.html#a1b26a538ab6e22362275d427f991a3e1">slice_gap</a> = sms_slice_gap;</div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;  selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#aca53dcf7a61b8beba82e8f9a0c768cb5">sms_info</a>.<a class="code" href="struct_k_s___s_m_s___i_n_f_o.html#a177e78699b1c480f77893fa200380d84">pulse_type</a> = <a class="code" href="_k_s_foundation_8h.html#af968d7d6e4fa1359fba5550fc39ae172a27d5a473a532b02775bf36bd99857980">KS_SELRF_SMS_PINS_DANTE</a>;</div><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;</div><div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_g_e_required_8e.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a> == 1) {<a class="code" href="_k_s_foundation__host_8c.html#a01d67d3faa8f2088f82af10aa0a28af0">ks_print_waveform</a>(selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, <span class="stringliteral">&quot;dpins_rfMB_base.txt&quot;</span>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>); }</div><div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_g_e_required_8e.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a> == 1) {<a class="code" href="_k_s_foundation__host_8c.html#a01d67d3faa8f2088f82af10aa0a28af0">ks_print_waveform</a>(selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, <span class="stringliteral">&quot;dpins_phMB_base.txt&quot;</span>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>); }</div><div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;</div><div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;  <span class="comment">/* Create blip */</span></div><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;  <a class="code" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> gzBlipWave = <a class="code" href="_k_s_foundation_8h.html#ae837f68085b812e9e22a659cc26a42cc">KS_INIT_WAVE</a>;</div><div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;  <span class="keywordtype">double</span> gArea = 1 / (sms_slice_gap / 10) / (<a class="code" href="_k_s_foundation__host_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a>); <span class="comment">/* (g sec)/cm, k-area of each blip */</span></div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;  gzblip.<a class="code" href="struct_k_s___t_r_a_p.html#a97ab43f6fd28920a42d987c8fec4afec">area</a> = gArea * 1e6; <span class="comment">/* (G/cm)*us */</span></div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;  status = <a class="code" href="_k_s_foundation__host_8c.html#a29c20221f74975954ea8917e5db5a635">ks_eval_trap1</a>(&amp;gzblip, <span class="stringliteral">&quot;PINSblip&quot;</span>); <span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;  status = <a class="code" href="_k_s_foundation__host_8c.html#a44c9e307b5545613303fdd4c700488f3">ks_eval_trap2wave</a>(&amp;gzBlipWave, &amp;gzblip); <span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#a8efdbce2fbb4bf21a6fd8983fdd6d5c7">ks_init_trap</a>(&amp;gzblip);</div><div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;</div><div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;  <span class="comment">/* Calcualte PINS parameters */</span></div><div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;  <span class="keywordtype">double</span> kzw = (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a6b955cde0388e60c3ec5f602072a8e0f">bw</a> * selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> * 1e-6) / (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#aa89aa200e4334657ad976733bebcbc2a">slthick</a> / 10); <span class="comment">/* 1/cm, width in kz-space we must go */</span></div><div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;  <span class="keywordtype">int</span> NPulses = (floor(ceil(kzw / (1 / (sms_slice_gap / 10))) / 2) * 2) + 1; <span class="comment">/* number of subpulses (odd) */</span></div><div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;  <span class="keywordtype">int</span> hpw = ceil((<span class="keywordtype">float</span>)selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> / (<span class="keywordtype">float</span>)NPulses); <span class="comment">/* number of time points in sub pulse */</span></div><div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;  <span class="keywordtype">int</span> interpolRes = hpw * NPulses;</div><div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;</div><div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;  <span class="comment">/* Create index for interpolation */</span></div><div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;  <span class="keywordtype">float</span> *newGrid = alloca(interpolRes * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div><div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;  <span class="keywordtype">float</span> *baseGrid = alloca(selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div><div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;  <span class="keywordflow">for</span> (idx = 0; idx &lt; selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>; idx++) {</div><div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;    baseGrid[idx] = (float) idx / (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> - 1);</div><div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;  }</div><div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;  <span class="keywordflow">for</span> (idx = 0; idx &lt; interpolRes; idx++) {</div><div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;    newGrid[idx] = (float) idx / (interpolRes - 1);</div><div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;  }</div><div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;</div><div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;  <span class="comment">/* Interpolate the base rf &amp; phase to make their resolution divideble by NPulses */</span></div><div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a> rfNewRes = <a class="code" href="_k_s_foundation_8h.html#a6f3115cf4ed2b225acc3a46df223ba7c">KS_INIT_WAVEFORM</a>;</div><div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a> phNewRes = <a class="code" href="_k_s_foundation_8h.html#a6f3115cf4ed2b225acc3a46df223ba7c">KS_INIT_WAVEFORM</a>;</div><div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#abff3210ecf672ab9eaa08d4bd2316825">ks_eval_linear_interp1</a>(baseGrid, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, newGrid, interpolRes, rfNewRes);</div><div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#abff3210ecf672ab9eaa08d4bd2316825">ks_eval_linear_interp1</a>(baseGrid, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, newGrid, interpolRes, phNewRes);</div><div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;</div><div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_g_e_required_8e.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a> == 1) {<a class="code" href="_k_s_foundation__host_8c.html#a01d67d3faa8f2088f82af10aa0a28af0">ks_print_waveform</a>(rfNewRes, <span class="stringliteral">&quot;rfNewRes.txt&quot;</span>, interpolRes); }</div><div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_g_e_required_8e.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a> == 1) {<a class="code" href="_k_s_foundation__host_8c.html#a01d67d3faa8f2088f82af10aa0a28af0">ks_print_waveform</a>(phNewRes, <span class="stringliteral">&quot;phNewRes.txt&quot;</span>, interpolRes); }</div><div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;</div><div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;  <span class="comment">/* Loop to concatenate the sub pulses and gradient blips */</span></div><div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;  <span class="keywordflow">for</span> (idx = 0; idx &lt; NPulses; idx++) {</div><div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;    <span class="keywordflow">for</span> (jdx = 0; jdx &lt; hpw; jdx++) {</div><div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;      selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[kdx] = rfNewRes[(idx * hpw) + jdx];</div><div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;      selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[kdx] = phNewRes[(idx * hpw) + jdx];</div><div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;      selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[kdx] = 0.0;</div><div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;      kdx++;</div><div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;    }</div><div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;    <span class="keywordflow">if</span> (idx != NPulses - 1) {</div><div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;      <span class="keywordflow">for</span> (jdx = 0; jdx &lt; gzBlipWave.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>; jdx++) {</div><div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;        selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[kdx] = 0.0;</div><div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;        selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[kdx] = 0.0;</div><div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;        selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[kdx] = gzBlipWave.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[jdx];</div><div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;        kdx++; gdx++;</div><div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;      }</div><div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;    }</div><div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;  }</div><div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;</div><div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;  <span class="comment">/* Set duration and resolution */</span></div><div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;  selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> = 0;</div><div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;  selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a6aa33ad60a96c56283d44d989fe2d499">gradwave_units</a> = <a class="code" href="_k_s_foundation_8h.html#adfc20623c6ef26b08b99174a1a77323ca18c0e84d66e6f381b509ea483f7cc7fd">KS_GRADWAVE_ABSOLUTE</a>;</div><div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;  selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> = RUP_FACTOR(kdx, GRAD_UPDATE_TIME);</div><div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;  selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> = selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> * GRAD_UPDATE_TIME;</div><div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;  selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> = selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>;</div><div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;  selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> = selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>;</div><div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;  selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.isodelay = RUP_FACTOR((<span class="keywordtype">int</span>)(selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.isodelay * ((<span class="keywordtype">float</span>)selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>/(<span class="keywordtype">float</span>)orgDur)),RF_UPDATE_TIME);</div><div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;  selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#afa10c3dbec21b5cc34276e741deeb97e">iso2end</a> = selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.isodelay;</div><div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;  selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a6b955cde0388e60c3ec5f602072a8e0f">bw</a> = 1e3 * (NPulses+1) * selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#aa89aa200e4334657ad976733bebcbc2a">slthick</a> / sms_slice_gap;</div><div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;</div><div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;  <span class="comment">/* If the resolution has been rounded up, place zeros at the end */</span></div><div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;  for (idx = kdx; idx &lt; selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>; idx++) {</div><div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;    selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[idx] = 0.0;</div><div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;    selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[idx] = selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[kdx];</div><div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;    selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[idx] = 0.0;</div><div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;  }</div><div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;</div><div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_g_e_required_8e.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a> == 1) {<a class="code" href="_k_s_foundation__host_8c.html#a01d67d3faa8f2088f82af10aa0a28af0">ks_print_waveform</a>(selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, <span class="stringliteral">&quot;dpins_RF.txt&quot;</span>, selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>); }</div><div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_g_e_required_8e.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a> == 1) {<a class="code" href="_k_s_foundation__host_8c.html#a01d67d3faa8f2088f82af10aa0a28af0">ks_print_waveform</a>(selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, <span class="stringliteral">&quot;dpins_GRAD.txt&quot;</span>, selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>); }</div><div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;</div><div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;  <span class="comment">/* Normalize to 1 */</span></div><div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#ace0cae3befbb3608319f34a61657bc26">ks_waveform_multiplyval</a>(selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, 1.0 / <a class="code" href="_k_s_foundation_8h.html#abf8e5bff3973c32360bc0e1505db61bc">ks_waveform_absmax</a>(selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>), selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>);</div><div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;</div><div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;  <span class="comment">/* rfStat */</span></div><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;  <span class="keywordtype">float</span> orgMaxB1 = selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.max_b1;</div><div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;  selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> = 0;</div><div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;  status = <a class="code" href="_k_s_foundation__host_8c.html#ae514f91fbedc683d5e9db931960b79b1">ks_eval_rfstat</a>(&amp;selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>); <span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;  selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.max_b1 = orgMaxB1;</div><div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;</div><div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;  <span class="comment">/* Theta wave */</span></div><div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;  selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> = selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>;</div><div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;  selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> = selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>;</div><div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;</div><div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;  <span class="keywordflow">for</span> (idx = 0; idx &lt; selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>; idx++) {</div><div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;    <span class="keywordflow">if</span> (fabs(selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[idx]) &gt; 180.0) {</div><div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;      <span class="keywordtype">double</span> angle = selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[idx];</div><div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;      <span class="keywordtype">double</span> revolutions = floor((angle + 180.0) / 360.0);</div><div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;      selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[idx] = (float) (angle - revolutions * 360.0);</div><div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;    }</div><div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;  }</div><div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;</div><div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_g_e_required_8e.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a> == 1) {<a class="code" href="_k_s_foundation__host_8c.html#a01d67d3faa8f2088f82af10aa0a28af0">ks_print_waveform</a>(selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, <span class="stringliteral">&quot;dpins_TH.txt&quot;</span>, selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>); }</div><div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;</div><div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;  <span class="comment">/* Register the RF */</span></div><div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;  <span class="keywordtype">char</span> description[<a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> + 4];</div><div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;  sprintf(description, <span class="stringliteral">&quot;%s_PINSDANTE&quot;</span>, selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;  sprintf(selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, <span class="stringliteral">&quot;%s_PINSDANTE&quot;</span>, selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_g_e_required_8e.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a> == 1) {fprintf(stderr, <span class="stringliteral">&quot;---------- PINS DANTE %s rfstat ---------\n&quot;</span>, selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);}</div><div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_g_e_required_8e.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a> == 1) {<a class="code" href="_k_s_foundation__host_8c.html#a609ddd32fdfbfa689c413d494a55d62c">ks_print_rfpulse</a>(selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>, stderr);}</div><div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__host_8c.html#a106b3a179fec686052d27fcc87129916">ks_eval_rf</a>(&amp;selrfPINS-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>, description);</div><div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;</div><div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_adfc20623c6ef26b08b99174a1a77323ca18c0e84d66e6f381b509ea483f7cc7fd"><div class="ttname"><a href="_k_s_foundation_8h.html#adfc20623c6ef26b08b99174a1a77323ca18c0e84d66e6f381b509ea483f7cc7fd">KS_GRADWAVE_ABSOLUTE</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1772</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#af33317a98ade78e3ac252b33cbb794af">KS_SELRF::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1340</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a01d67d3faa8f2088f82af10aa0a28af0"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a01d67d3faa8f2088f82af10aa0a28af0">ks_print_waveform</a></div><div class="ttdeci">void ks_print_waveform(const KS_WAVEFORM waveform, char *filename, int res)</div><div class="ttdoc">Writes a KS_WAVEFORM to disk with the specified filename</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3658</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a29c20221f74975954ea8917e5db5a635"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a29c20221f74975954ea8917e5db5a635">ks_eval_trap1</a></div><div class="ttdeci">STATUS ks_eval_trap1(KS_TRAP *trap, const char *const desc)</div><div class="ttdoc">Sets up a trapezoid using a KS_TRAP sequence object with preset gradient constraints</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:403</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html"><div class="ttname"><a href="struct_k_s___t_r_a_p.html">KS_TRAP</a></div><div class="ttdoc">Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:430</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html"><div class="ttname"><a href="struct_k_s___w_a_v_e.html">KS_WAVE</a></div><div class="ttdoc">Core sequence object making arbitrary waveforms on any board (using float data format)</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:514</div></div>
<div class="ttc" id="_g_e_required_8e_html_ac3e1795766a80ec63b157951b4b9a7d4"><div class="ttname"><a href="_g_e_required_8e.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a></div><div class="ttdeci">int debug</div><div class="ttdef"><b>Definition:</b> GERequired.e:2630</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_aca53dcf7a61b8beba82e8f9a0c768cb5"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#aca53dcf7a61b8beba82e8f9a0c768cb5">KS_SELRF::sms_info</a></div><div class="ttdeci">KS_SMS_INFO sms_info</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1343</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ae837f68085b812e9e22a659cc26a42cc"><div class="ttname"><a href="_k_s_foundation_8h.html#ae837f68085b812e9e22a659cc26a42cc">KS_INIT_WAVE</a></div><div class="ttdeci">#define KS_INIT_WAVE</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:145</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_a607347e9c1c7a9eef21fff556faccc3f"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">KS_SELRF::gradwave</a></div><div class="ttdeci">KS_WAVE gradwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1342</div></div>
<div class="ttc" id="struct_k_s___r_f_html_ae183c3e4095d1c6d14b3d59a0da97928"><div class="ttname"><a href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">KS_RF::rfpulse</a></div><div class="ttdeci">RF_PULSE rfpulse</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:797</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a8efdbce2fbb4bf21a6fd8983fdd6d5c7"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a8efdbce2fbb4bf21a6fd8983fdd6d5c7">ks_init_trap</a></div><div class="ttdeci">void ks_init_trap(KS_TRAP *trap)</div><div class="ttdoc">Resets a KS_TRAP sequence object to its default value (KS_INIT_TRAP)</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:45</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a6aa33ad60a96c56283d44d989fe2d499"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a6aa33ad60a96c56283d44d989fe2d499">KS_WAVE::gradwave_units</a></div><div class="ttdeci">int gradwave_units</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:521</div></div>
<div class="ttc" id="struct_k_s___s_m_s___i_n_f_o_html_a1b26a538ab6e22362275d427f991a3e1"><div class="ttname"><a href="struct_k_s___s_m_s___i_n_f_o.html#a1b26a538ab6e22362275d427f991a3e1">KS_SMS_INFO::slice_gap</a></div><div class="ttdeci">float slice_gap</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1218</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_af968d7d6e4fa1359fba5550fc39ae172a27d5a473a532b02775bf36bd99857980"><div class="ttname"><a href="_k_s_foundation_8h.html#af968d7d6e4fa1359fba5550fc39ae172a27d5a473a532b02775bf36bd99857980">KS_SELRF_SMS_PINS_DANTE</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1760</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_abff3210ecf672ab9eaa08d4bd2316825"><div class="ttname"><a href="_k_s_foundation__host_8c.html#abff3210ecf672ab9eaa08d4bd2316825">ks_eval_linear_interp1</a></div><div class="ttdeci">void ks_eval_linear_interp1(const float *x, int x_length, const float *y, const float *xx, int xx_length, float *yy)</div><div class="ttdoc">Linear interpolation</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:2511</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a44c9e307b5545613303fdd4c700488f3"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a44c9e307b5545613303fdd4c700488f3">ks_eval_trap2wave</a></div><div class="ttdeci">STATUS ks_eval_trap2wave(KS_WAVE *wave, const KS_TRAP *trap)</div><div class="ttdoc">Converts a trapezoid object (KS_TRAP) to a wave object (KS_WAVE)</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:2547</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a2875ace95558531062d08465b2bcc282"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a></div><div class="ttdeci">float GAM</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a6f3115cf4ed2b225acc3a46df223ba7c"><div class="ttname"><a href="_k_s_foundation_8h.html#a6f3115cf4ed2b225acc3a46df223ba7c">KS_INIT_WAVEFORM</a></div><div class="ttdeci">#define KS_INIT_WAVEFORM</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:144</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aacb2fe1d83c45e8d0525f363bdd6b8a6"><div class="ttname"><a href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a></div><div class="ttdeci">#define KS_DESCRIPTION_LENGTH</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:112</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a1ba17433713316fa65385237ebb0fb67"><div class="ttname"><a href="_k_s_foundation_8h.html#a1ba17433713316fa65385237ebb0fb67">KS_INIT_TRAP</a></div><div class="ttdeci">#define KS_INIT_TRAP</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:132</div></div>
<div class="ttc" id="struct_k_s___r_f_html_aecd8b68c159a31a28e2a2ec003b593e2"><div class="ttname"><a href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">KS_RF::thetawave</a></div><div class="ttdeci">KS_WAVE thetawave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:800</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_adeab1cc34f1a7f20f41e8825d849981e"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">KS_SELRF::rf</a></div><div class="ttdeci">KS_RF rf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1334</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">KS_WAVE::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:516</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_ae514f91fbedc683d5e9db931960b79b1"><div class="ttname"><a href="_k_s_foundation__host_8c.html#ae514f91fbedc683d5e9db931960b79b1">ks_eval_rfstat</a></div><div class="ttdeci">STATUS ks_eval_rfstat(KS_RF *rf)</div><div class="ttdoc">Sets up the RF_PULSE structure of a KS_RF object</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:1359</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a2a9b610a78cdae3ac8ef682bd34f7e0d"><div class="ttname"><a href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">KS_RF::rfwave</a></div><div class="ttdeci">KS_WAVE rfwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:798</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a98d69b5689c184e4f57ab124e726f964"><div class="ttname"><a href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a></div><div class="ttdeci">float KS_WAVEFORM[KS_MAXWAVELEN]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:179</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a97ab43f6fd28920a42d987c8fec4afec"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a97ab43f6fd28920a42d987c8fec4afec">KS_TRAP::area</a></div><div class="ttdeci">float area</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:434</div></div>
<div class="ttc" id="struct_k_s___r_f_html_afa10c3dbec21b5cc34276e741deeb97e"><div class="ttname"><a href="struct_k_s___r_f.html#afa10c3dbec21b5cc34276e741deeb97e">KS_RF::iso2end</a></div><div class="ttdeci">int iso2end</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:794</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a106b3a179fec686052d27fcc87129916"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a106b3a179fec686052d27fcc87129916">ks_eval_rf</a></div><div class="ttdeci">STATUS ks_eval_rf(KS_RF *rf, const char *const desc)</div><div class="ttdoc">Sets up a KS_RF object</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:1451</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ace0cae3befbb3608319f34a61657bc26"><div class="ttname"><a href="_k_s_foundation_8h.html#ace0cae3befbb3608319f34a61657bc26">ks_waveform_multiplyval</a></div><div class="ttdeci">void ks_waveform_multiplyval(KS_WAVEFORM waveform, float val, int res)</div><div class="ttdoc">In-place scalar multiplication of a KS_WAVEFORM</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1127</div></div>
<div class="ttc" id="struct_k_s___s_m_s___i_n_f_o_html_a177e78699b1c480f77893fa200380d84"><div class="ttname"><a href="struct_k_s___s_m_s___i_n_f_o.html#a177e78699b1c480f77893fa200380d84">KS_SMS_INFO::pulse_type</a></div><div class="ttdeci">int pulse_type</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1219</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a609ddd32fdfbfa689c413d494a55d62c"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a609ddd32fdfbfa689c413d494a55d62c">ks_print_rfpulse</a></div><div class="ttdeci">void ks_print_rfpulse(RF_PULSE rfpulse, FILE *fp)</div><div class="ttdoc">Writes out the contents of an RF_PULSE struct for debugging</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3769</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_abf8e5bff3973c32360bc0e1505db61bc"><div class="ttname"><a href="_k_s_foundation_8h.html#abf8e5bff3973c32360bc0e1505db61bc">ks_waveform_absmax</a></div><div class="ttdeci">float ks_waveform_absmax(const KS_WAVEFORM waveform, int res)</div><div class="ttdoc">Returns the maximum absolute value in a KS_WAVEFORM</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:965</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_TRAP::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:437</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a27640b66342aa92e2fecafb0e8471785"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">KS_WAVE::waveform</a></div><div class="ttdeci">KS_WAVEFORM waveform</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:519</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_WAVE::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:518</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_aa89aa200e4334657ad976733bebcbc2a"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#aa89aa200e4334657ad976733bebcbc2a">KS_SELRF::slthick</a></div><div class="ttdeci">float slthick</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1336</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a6b955cde0388e60c3ec5f602072a8e0f"><div class="ttname"><a href="struct_k_s___r_f.html#a6b955cde0388e60c3ec5f602072a8e0f">KS_RF::bw</a></div><div class="ttdeci">float bw</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:790</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aceaba65eaa064b90ef16da5c2cd9591e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aceaba65eaa064b90ef16da5c2cd9591e">&#9670;&nbsp;</a></span>ks_eval_findNearestNeighbourIndex()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_eval_findNearestNeighbourIndex </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const float *&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Find nearest neighbor index (NEEDS BETTER DOCUMENTATION)</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">value</td><td></td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">x</td><td>Input array </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">length</td><td>Length of array </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">index</td><td>Index into array </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;                                                                               {</div><div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;</div><div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;  <span class="keywordtype">float</span> dist = fabs(value - x[0]);</div><div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;  <span class="keywordtype">float</span> newDist;</div><div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;  <span class="keywordtype">int</span> idx = 0, i;</div><div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;</div><div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;  <span class="keywordflow">for</span> (i = 1; i &lt; length; i++) {</div><div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;</div><div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;    newDist = value - x[i];</div><div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;</div><div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;    <span class="keywordflow">if</span> (0 &lt; newDist &amp;&amp; newDist &lt; dist) {</div><div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;</div><div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;      dist = newDist;</div><div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;      idx = i;</div><div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;    }</div><div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;  }</div><div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;</div><div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;  <span class="keywordflow">return</span> idx;</div><div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="abff3210ecf672ab9eaa08d4bd2316825"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abff3210ecf672ab9eaa08d4bd2316825">&#9670;&nbsp;</a></span>ks_eval_linear_interp1()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_eval_linear_interp1 </td>
          <td>(</td>
          <td class="paramtype">const float *&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>x_length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const float *&#160;</td>
          <td class="paramname"><em>y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const float *&#160;</td>
          <td class="paramname"><em>xx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>xx_length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>yy</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Linear interpolation</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">x</td><td>Input array of x coordinates for data (y) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">x_length</td><td>Length of array </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">y</td><td>Input array of data (same length as x) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">xx</td><td>Array of new sample points of the data in y </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">xx_length</td><td>Length of array with new sample points </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">yy</td><td>Output array with interpolated data </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;                                                                                                                     {</div><div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;</div><div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;  <span class="keywordtype">int</span> i, index;</div><div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;  <span class="keywordtype">float</span> dx, dy;</div><div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;  <span class="keywordtype">float</span> *slope = alloca(x_length * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div><div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;  <span class="keywordtype">float</span> *intercept = alloca(x_length * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div><div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;  <span class="keywordtype">float</span> *Y = alloca(x_length * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div><div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;  memcpy(Y, y, x_length * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div><div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;</div><div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; x_length; i++) {</div><div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;</div><div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;    <span class="keywordflow">if</span> (i &lt; x_length - 1) {</div><div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;</div><div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;      dx = x[i + 1] - x[i];</div><div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;      dy = Y[i + 1] - Y[i];</div><div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;      slope[i] = dy / dx;</div><div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;      intercept[i] = Y[i] - x[i] * slope[i];</div><div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;</div><div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;</div><div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;      slope[i] = slope[i - 1];</div><div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;      intercept[i] = intercept[i - 1];</div><div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;</div><div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;    }</div><div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;  }</div><div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;</div><div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; xx_length; i++) {</div><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;</div><div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;    index = <a class="code" href="_k_s_foundation__host_8c.html#aceaba65eaa064b90ef16da5c2cd9591e">ks_eval_findNearestNeighbourIndex</a>(xx[i], x, x_length);</div><div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;    yy[i] = slope[index] * xx[i] + intercept[index];</div><div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;  }</div><div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;} <span class="comment">/* EOF */</span></div><div class="ttc" id="_k_s_foundation__host_8c_html_aceaba65eaa064b90ef16da5c2cd9591e"><div class="ttname"><a href="_k_s_foundation__host_8c.html#aceaba65eaa064b90ef16da5c2cd9591e">ks_eval_findNearestNeighbourIndex</a></div><div class="ttdeci">int ks_eval_findNearestNeighbourIndex(float value, const float *x, int length)</div><div class="ttdoc">Find nearest neighbor index (NEEDS BETTER DOCUMENTATION)</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:2489</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac98e5860a08220295e2a2150b4313c82"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac98e5860a08220295e2a2150b4313c82">&#9670;&nbsp;</a></span>ks_eval_trap2wave()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_trap2wave </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> *&#160;</td>
          <td class="paramname"><em>trap</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Converts a trapezoid object (<a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a>) to a wave object (<a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a>)</h4>
</p>
<p>The input <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object will be converted to a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object, which will have its <code>.waveform</code> (float array) field filled with the shape of the trapezoid with the maintained GRAD_UPDATE_TIME (4 [us]) sample duration. The <code>.waveform</code> amplitude on the plateau will be <code>.amp</code> [G/cm].</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">wave</td><td>Pointer to a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object to be set up with same shape as the trapezoid (<a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a>) in arg 2 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">trap</td><td>The trapezoid to convert into a waveform </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;                                                             {</div><div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;</div><div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;  <span class="keywordtype">int</span> idx = 0;</div><div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;</div><div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#aa2b37fa5aa0bffff1de8ca29e7c19cc1">ks_init_wave</a>(wave);</div><div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;</div><div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;  <span class="keywordtype">int</span> pointsInRamp = (trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a> / GRAD_UPDATE_TIME) + 1;</div><div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;  <span class="keywordtype">int</span> pointsInPlateau = (trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">plateautime</a> / GRAD_UPDATE_TIME) - 2;</div><div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;  <span class="keywordtype">int</span> pointsInWave = 2 * pointsInRamp + pointsInPlateau;</div><div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;  <span class="keywordtype">double</span> slope = trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a> / pointsInRamp;</div><div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;</div><div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;  <span class="keywordflow">if</span> (trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> != (pointsInWave * GRAD_UPDATE_TIME)) {</div><div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_trap2wave(%s): field .ramptime or .plateautime not divisible by GRAD_UPDATE_TIME (4)&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;  }</div><div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;</div><div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;  <span class="comment">/* ramp up */</span></div><div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;  <span class="keywordflow">for</span> (i = 1; i &lt;= pointsInRamp; i++) {</div><div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;    wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[idx++] = (float)(i * slope);</div><div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;  }</div><div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;</div><div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;  <span class="comment">/* plateau */</span></div><div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; pointsInPlateau; i++) {</div><div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;    wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[idx++] = trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a>;</div><div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;  }</div><div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;</div><div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;  <span class="comment">/* ramp down */</span></div><div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;  <span class="keywordflow">for</span> (i = pointsInRamp; i &gt; 0; i--) {</div><div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;    wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[idx++] = (float)(i * slope);</div><div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;  }</div><div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;</div><div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;  <span class="comment">/* set fields */</span></div><div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;  wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> = idx;</div><div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;  <span class="keywordflow">if</span> (pointsInWave != wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>) {</div><div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_trap2wave(%s): Implementation error - The resulting KS_WAVE has wrong res [%d!=%d]&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, pointsInWave, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>);</div><div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;  }</div><div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;</div><div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;  wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> = idx * GRAD_UPDATE_TIME;</div><div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;  <span class="keywordflow">if</span> (trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> != wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>) {</div><div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_eval_trap2wave(%s): Implementation error - The resulting KS_WAVE has wrong duration [%d!=%d]&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>,trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>,wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>);</div><div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;  }</div><div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;</div><div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;  sprintf(wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, <span class="stringliteral">&quot;%s_wave&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;</div><div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;</div><div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;} <span class="comment">/* EOF */</span></div><div class="ttc" id="struct_k_s___t_r_a_p_html_a878bb367b07dc7dfb5fef5728d2e5b1d"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">KS_TRAP::plateautime</a></div><div class="ttdeci">int plateautime</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:436</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">KS_WAVE::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:516</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ab508ded41392ee86a2a619d3e93d2373"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">KS_TRAP::amp</a></div><div class="ttdeci">float amp</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:433</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_aa2b37fa5aa0bffff1de8ca29e7c19cc1"><div class="ttname"><a href="_k_s_foundation__host_8c.html#aa2b37fa5aa0bffff1de8ca29e7c19cc1">ks_init_wave</a></div><div class="ttdeci">void ks_init_wave(KS_WAVE *wave)</div><div class="ttdoc">Resets a KS_WAVE sequence object to its default value (KS_INIT_WAVE)</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:53</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">KS_TRAP::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:432</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_TRAP::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:437</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a27640b66342aa92e2fecafb0e8471785"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">KS_WAVE::waveform</a></div><div class="ttdeci">KS_WAVEFORM waveform</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:519</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_acbc719dc4e48c2a2df0447875e4348ca"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">KS_TRAP::ramptime</a></div><div class="ttdeci">int ramptime</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:435</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_WAVE::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:518</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a807960a15af4f90154ef8cd8985120ec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a807960a15af4f90154ef8cd8985120ec">&#9670;&nbsp;</a></span>ks_eval_append_two_waves()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_append_two_waves </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>first_wave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>second_wave</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;                                                                           {</div><div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;  memcpy( &amp;(first_wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[first_wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>]), second_wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) *second_wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>);</div><div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;  first_wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> += second_wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>;</div><div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;  first_wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> += second_wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>;</div><div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;}</div><div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a27640b66342aa92e2fecafb0e8471785"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">KS_WAVE::waveform</a></div><div class="ttdeci">KS_WAVEFORM waveform</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:519</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_WAVE::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:518</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3dcaceb00be089a696fc8297573d3ca9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3dcaceb00be089a696fc8297573d3ca9">&#9670;&nbsp;</a></span>ks_eval_concatenate_waves()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_concatenate_waves </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>num_waves</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>target_wave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> **&#160;</td>
          <td class="paramname"><em>waves_to_append</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;                                                                                                 {</div><div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;  <span class="keywordtype">int</span> idx;</div><div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;  <span class="keywordflow">for</span>(idx = 0; idx &lt; num_waves; idx++) {</div><div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__host_8c.html#ab239acdb49cc85692567e28ce50e6f3b">ks_eval_append_two_waves</a>(target_wave, waves_to_append[idx]) != SUCCESS) {</div><div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;      <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s failed&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;      <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;    };</div><div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;  }</div><div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;</div><div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;}</div><div class="ttc" id="_k_s_foundation__host_8c_html_ab239acdb49cc85692567e28ce50e6f3b"><div class="ttname"><a href="_k_s_foundation__host_8c.html#ab239acdb49cc85692567e28ce50e6f3b">ks_eval_append_two_waves</a></div><div class="ttdeci">STATUS ks_eval_append_two_waves(KS_WAVE *first_wave, KS_WAVE *second_wave)</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:2596</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a36356d324c41fd3b1446443e15d54815"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a36356d324c41fd3b1446443e15d54815">&#9670;&nbsp;</a></span>ks_eval_epi_constrained()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_epi_constrained </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *&#160;</td>
          <td class="paramname"><em>epi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const&#160;</td>
          <td class="paramname"><em>desc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>ampmax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>slewrate</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets up a <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> composite sequence object, subject to gradients constraints specified as input arguments</h4>
</p>
<p>The <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> composite sequence object controls an entire EPI train (including de/rephasers on freq &amp; phase axes). Four fields in <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> are other sequence objects:</p><ul>
<li><a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> <code>.read</code>: The EPI readout lobes including data acquisition</li>
<li><a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> <code>.readphaser</code>: The dephaser &amp; rephaser gradients before &amp; after the train of readout lobes, on the same board as <code>.read</code></li>
<li><a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> <code>.blip</code>: The blip gradients in the phase encoding direction between the readout lobes</li>
<li><a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> <code>.blipphaser</code>: The dephaser &amp; rephaser gradients on the same board as the <code>.blip</code> gradients. For multi-shot EPI these gradients will change in <a class="el" href="ksepi_8e.html#a1669428052472d00b1c55a1291f8032f">scan()</a> when calling <a class="el" href="_k_s_foundation_8h.html#a0d83cf730d82612a87abc0f024bea336" title="Changes the gradient state of a KS_EPI object for the given slice information">ks_scan_epi_shotcontrol()</a></li>
</ul>
<p>Before calling this function, portions of the <code>.read</code> field (<a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a>) and <code>.blipphaser</code> field (<a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a>) must be set up. Here follows a list of fields that must be set:</p><ol type="1">
<li><code>.read.fov</code>: The Field-of-View (FOV) in the frequency encoding (readout) direction</li>
<li><code>.read.res</code>: The number of pixels within the FOV along the frequency encoding direction</li>
<li><code>.blipphaser.fov</code>: The Field-of-View (FOV) in the phase encoding direction</li>
<li><code>.blipphaser.res</code>: The number of pixels within the FOV along the phase encoding direction</li>
<li><code>.blipphaser.R</code>: Either the number of EPI shots or the parallel imaging factor</li>
<li><code>.read.rampsampling</code>: Whether rampsampling should be used (see <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a>). Value of 1 is recommended for EPI</li>
<li><code>.read.acq.rbw</code>: The receiver bandwidth in [kHz/FOV]. Maximum: 250 (recommended)</li>
</ol>
<p>If the <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> object is initialized with KS_INIT_EPI on declaration, <code>.read.rampsampling</code> will already be set to 1 and <code>.read.acq.rbw</code> will be set to 250.0 (hence steps 6-7 can be skipped).</p>
<p>Single-shot EPI acquisitions are geometrically distorted to some degree depending on chosen <code>.read.res</code> and <code>.blipphaser.fov</code>. To reduce the EPI distortions, either multi-shot EPI or <em>parallel imaging</em> acceleration can be used. For both alternatives, every Rth phase ecoding lines are acquired in k-space as the EPI train is played out. <em>R</em> corresponds to the number of shots (<code>opnshots</code> menu in the UI) or the parallel imaging factor. Therefore, e.g. a 4-shot EPI readout is identical to an <em>R</em> = 4 accelerated EPI readout with the same FOV and resolution, why one same field <code>.R</code> may be used to control the EPI train setup, be it multi-shot or parallel imaging acceleration (but not both at the same time). What differs between multi-shot and parallel imaging acceleration in the acquisition is only whether the <code>.blipphaser</code> should change from TR to TR. Hence, to set up a <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> object, use the field <code>.R</code> for both multi-shot EPI and parallel imaging scenarios.</p>
<p>The remaining fields of interest in the <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> sequence objects are:</p><ul>
<li><code>.etl</code>: This is the echo-train-length (ETL) of the EPI readout train, set by <a class="el" href="_k_s_foundation_8h.html#a77fb9dea403599e8fbbf1fed426ff66e" title="Sets up a KS_EPI composite sequence object with preset gradient constraints">ks_eval_epi()</a> based on <code>.blipphaser.res</code> and <code>.blipphaser.R</code></li>
<li><code>.read_spacing</code>: Additional spacing in [us] between readout lobes. Default value is zero, but can be set &gt; 0 if additional gradients is to be inserted between the readout lobes. One scenario is adding CAIPIRINHA blips on ZGRAD during the time where the EPI readout is played out in the pulse sequence</li>
<li><code>.duration</code>: Convenience information for timing calculations, set by <a class="el" href="_k_s_foundation_8h.html#a77fb9dea403599e8fbbf1fed426ff66e" title="Sets up a KS_EPI composite sequence object with preset gradient constraints">ks_eval_epi()</a>. This is the total time in [us] for the EPI train, including the de/rephasers on the frequency/phase axes. Note that there are also <code>.duration</code> fields for each of the four <code>KS_***</code> sequence objects in <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a>, stating the duration of each of these components.</li>
<li><code>.time2center</code>: Convenience information for timing calculations, set by <a class="el" href="_k_s_foundation_8h.html#a77fb9dea403599e8fbbf1fed426ff66e" title="Sets up a KS_EPI composite sequence object with preset gradient constraints">ks_eval_epi()</a>. The time in [us] from the start of the first dephaser until the center of k-space is reached. This deviates from <code>&lt;epi&gt;.duration/2</code> for partial Fourier EPI trains where <code>.blipphaser.nover &gt; 0</code> (a.k.a. fractional NEX, but typically shown as MiniumTE in the UI for EPI)</li>
</ul>
<p>If peripheral nerve stimulation would be observed, consider calling <a class="el" href="_k_s_foundation_8h.html#a36356d324c41fd3b1446443e15d54815" title="Sets up a KS_EPI composite sequence object, subject to gradients constraints specified as input argum...">ks_eval_epi_constrained()</a> with reduced <em>slewrate</em>. This will however increase the geometric distortions in the images</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">epi</td><td>Pointer to the <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> object to be set up </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">desc</td><td>A description (text string) of the <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> object. This description is used for pulse sequence generation (seen in the file generated by <em>TimeHist</em> in <em>MGD Sim/WTools</em>) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ampmax</td><td>The maximum allowed gradient amplitude ([G/cm]) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">slewrate</td><td>The maximum allowed slewrate ([(G/cm) / us]). Value of 0.01 corresponds to 100 mT/m/s </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;                                                                                                   {  </div><div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;  <span class="keywordtype">char</span> tmpstr[1000];</div><div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;  <span class="keywordtype">int</span> kspacelines_noacc;</div><div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;</div><div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;  <span class="keywordflow">if</span> (desc == NULL || desc[0] == <span class="charliteral">&#39; &#39;</span>) {</div><div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: description (2nd arg) cannot be NULL or begin with a space&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;  }</div><div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;</div><div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;  <span class="comment">/************************** Step 1: resolution checking ************************/</span></div><div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;</div><div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;  <span class="comment">/* For EPI, we don&#39;t allow negative &#39;nover&#39;. For lower k-space pFourier control, we use ks_scan_epi_shotcontrol() */</span></div><div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;  <span class="keywordflow">if</span> (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a> &lt; 0) {</div><div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s(%s): negative &#39;blipphaser.nover&#39; not allowed for EPI. See ks_scan_epi_shotcontrol()&quot;</span>, __FUNCTION__, desc);</div><div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;  }</div><div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;  <span class="keywordflow">if</span> (abs(epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a>) &gt; 0) {</div><div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s(%s): partial Fourier in read is not supported&quot;</span>, __FUNCTION__, desc);</div><div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;  }</div><div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;  <span class="keywordflow">if</span> (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a0d32a90987ac38871d307027697c90d8">minbliparea</a> &lt; 0 || epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a0d32a90987ac38871d307027697c90d8">minbliparea</a> &gt; 1000) {</div><div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s(%s): field &#39;minbliparea&#39; must be in range [0,1000]&quot;</span>, __FUNCTION__, desc);</div><div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;  }</div><div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;  <span class="keywordflow">if</span> (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#aac31eb68bff694554a182bd796b2f1c5">res</a> % 2) {</div><div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s(%s): Read res must be even&quot;</span>, __FUNCTION__, desc);</div><div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;  }</div><div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;</div><div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;  <span class="comment">/************************** Step 2: blip phaser (DE/REphasers)  ***************************/</span></div><div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;  epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a4762b9a6307f0223b3d1dfde7e8ddce8">nacslines</a> = 0; <span class="comment">/* ACS lines are forbidden for EPI */</span></div><div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;</div><div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;  <span class="comment">/* blip DE/REphaser (KS_PHASER). Here the &#39;.res&#39; and &#39;.nover&#39; fields may be rounded due to &#39;.R&#39;</span></div><div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;<span class="comment">     as ks_eval_phaser_constrained() is also calling ks_eval_phaser_adjustres() */</span></div><div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;  sprintf(tmpstr, <span class="stringliteral">&quot;%s.blipphaser&quot;</span>, desc);</div><div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__host_8c.html#a3719e6e7daa633b15bf8213abd3e3ab7">ks_eval_phaser_constrained</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>, tmpstr, ampmax, slewrate, 0) == FAILURE)</div><div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;</div><div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;  <span class="comment">/************************** Step 3: z phaser ***************************/</span></div><div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;</div><div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;  <span class="comment">/* blip DE/REphaser (KS_PHASER). Here the &#39;.res&#39; and &#39;.nover&#39; fields may be rounded due to &#39;.R&#39;</span></div><div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;<span class="comment">     as ks_eval_phaser_constrained() is also calling ks_eval_phaser_adjustres() */</span></div><div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;  sprintf(tmpstr, <span class="stringliteral">&quot;%s.zphaser&quot;</span>, desc);</div><div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;  <span class="keywordflow">if</span> ((epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a> &gt; 0) &amp;&amp; (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a> &gt; 0)) {</div><div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: Cannot have partial Fourier in both ky (nover=%d) and kz (nover=%d)&quot;</span>, __FUNCTION__, epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a>, epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a>);</div><div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;  }</div><div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;  <span class="keywordflow">if</span> (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a> &gt; 1) {</div><div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__host_8c.html#a3719e6e7daa633b15bf8213abd3e3ab7">ks_eval_phaser_constrained</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>, tmpstr, ampmax, slewrate, 0) == FAILURE)</div><div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;      <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;    <a class="code" href="_k_s_foundation__host_8c.html#a38e859809526b8d07b17999dc6bbdbe9">ks_init_phaser</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>);</div><div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;  }</div><div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;</div><div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;  <span class="comment">/************************** Step 4: ETL ***************************/</span></div><div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;</div><div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;  <span class="keywordflow">if</span> (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a> &gt; 0) {</div><div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;    kspacelines_noacc = epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a> / 2 + epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a>;</div><div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;    kspacelines_noacc = epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a>;</div><div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;  }</div><div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;</div><div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;  epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a> = kspacelines_noacc / epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a>;</div><div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;</div><div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;  <span class="keywordflow">if</span> (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a> &lt; 1) {</div><div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s(%s): R (or shots) must be in range [1,%d]&quot;</span>, __FUNCTION__, desc, kspacelines_noacc);</div><div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;  }</div><div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;</div><div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;  <span class="comment">/********************* Step 5: EPI blips ********************/</span></div><div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;</div><div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;  <span class="comment">/* blip area [(G/cm)*usec] */</span></div><div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;  <span class="keywordflow">if</span> (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a> &gt; 1) {</div><div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;</div><div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;    epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#aaa0021ab8174eb7806de89d599769a9b">blip</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a97ab43f6fd28920a42d987c8fec4afec">area</a> = epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a> * <a class="code" href="_k_s_foundation_8h.html#aeb07c1278254f0a40622fbbe10566f57">ks_calc_fov2gradareapixel</a>(epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#abfd94a01fc71278021802ca0d1e25e16">fov</a>);</div><div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;</div><div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;    <span class="comment">/* The blip area should not be too small to reduce discretization errors. This is based on observations doing moment calcs in WTools.  */</span></div><div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;    <span class="keywordflow">if</span> (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#aaa0021ab8174eb7806de89d599769a9b">blip</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a97ab43f6fd28920a42d987c8fec4afec">area</a> &lt; epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a0d32a90987ac38871d307027697c90d8">minbliparea</a>)</div><div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;      epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#ab758140f3ca23e746a312f34a0d9c3a9">blipoversize</a> = (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a0d32a90987ac38871d307027697c90d8">minbliparea</a> / epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#aaa0021ab8174eb7806de89d599769a9b">blip</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a97ab43f6fd28920a42d987c8fec4afec">area</a>); <span class="comment">/* design a bigger blip, and use .blipoversize in ks_scan_epi_shotcontrol() to reduce the amp correspondingly */</span></div><div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;      epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#ab758140f3ca23e746a312f34a0d9c3a9">blipoversize</a> = 1.0;</div><div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;</div><div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;    epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#aaa0021ab8174eb7806de89d599769a9b">blip</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a97ab43f6fd28920a42d987c8fec4afec">area</a> = epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a> * <a class="code" href="_k_s_foundation_8h.html#aeb07c1278254f0a40622fbbe10566f57">ks_calc_fov2gradareapixel</a>(epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#abfd94a01fc71278021802ca0d1e25e16">fov</a>) * epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#ab758140f3ca23e746a312f34a0d9c3a9">blipoversize</a>;</div><div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;    epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#aaa0021ab8174eb7806de89d599769a9b">blip</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a97ab43f6fd28920a42d987c8fec4afec">area</a> = 0.0;</div><div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;  }</div><div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;  <span class="comment">/* Get ramp &amp; plateau time as well as amplitude of the blip */</span></div><div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;  sprintf(tmpstr, <span class="stringliteral">&quot;%s.blip&quot;</span>, desc);</div><div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;</div><div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__host_8c.html#ace858b7b1e7182259bcaa098147e5956">ks_eval_trap_constrained</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#aaa0021ab8174eb7806de89d599769a9b">blip</a>, tmpstr, ampmax, slewrate, 0) == FAILURE)</div><div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;</div><div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;</div><div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;  <span class="comment">/************************** Step 6: Read width and amp **************************/</span></div><div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;</div><div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;  <span class="comment">/* rampsampling (normal case): We don&#39;t want to acquire data during half the blip duration (straddling two readouts) */</span></div><div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;  <span class="keywordflow">if</span> (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a6a2cc013660b66a4c7793c6e55bfcaa8">rampsampling</a>)</div><div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;    epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a13d3424b69abfaa66668757e06fed900">acqdelay</a> = epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#aaa0021ab8174eb7806de89d599769a9b">blip</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> / 2;</div><div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;</div><div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;  sprintf(tmpstr, <span class="stringliteral">&quot;%s.read&quot;</span>, desc);</div><div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__host_8c.html#a0a1d9107de6b9e38a08ad33a76ea6cf5">ks_eval_readtrap_constrained</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>, tmpstr, ampmax, slewrate) == FAILURE)</div><div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;</div><div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;  <span class="keywordflow">if</span> (!epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a6a2cc013660b66a4c7793c6e55bfcaa8">rampsampling</a>) {</div><div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;    <span class="comment">/* non-rampsampling (unusual case) */</span></div><div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;    <span class="keywordflow">if</span> (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a> &lt; (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#aaa0021ab8174eb7806de89d599769a9b">blip</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> / 2)) {</div><div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;      <span class="comment">/* blip-duration limited: Prolong the read gradient ramps to fit the blip, reduce PNS and acoustic noise */</span></div><div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;      epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a> = epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#aaa0021ab8174eb7806de89d599769a9b">blip</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> / 2;</div><div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;      epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a13d3424b69abfaa66668757e06fed900">acqdelay</a> = epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a>;</div><div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;      epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> = epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">plateautime</a> + 2 * epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a>;</div><div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;      epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a97ab43f6fd28920a42d987c8fec4afec">area</a> = (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">plateautime</a> + epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a>) * epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a>;</div><div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;      epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a0c3ba07aac8b5f911ce918a97c7ebbc6">area2center</a> = epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a97ab43f6fd28920a42d987c8fec4afec">area</a> / 2;</div><div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;    }</div><div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;  }</div><div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;</div><div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;</div><div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;  <span class="comment">/************************** Step 7: read phaser (DE/REphasers) **************************/</span></div><div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;</div><div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;  <span class="comment">/* readphaser (KS_TRAP) */</span></div><div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;  epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#abc81c5867684b6e31b65459ec9431269">readphaser</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a97ab43f6fd28920a42d987c8fec4afec">area</a> = -epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a0c3ba07aac8b5f911ce918a97c7ebbc6">area2center</a>;</div><div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;</div><div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;  <span class="keywordflow">if</span> (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#abc81c5867684b6e31b65459ec9431269">readphaser</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a97ab43f6fd28920a42d987c8fec4afec">area</a> != 0.0) {</div><div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;    sprintf(tmpstr, <span class="stringliteral">&quot;%s.readphaser&quot;</span>, desc);</div><div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__host_8c.html#ace858b7b1e7182259bcaa098147e5956">ks_eval_trap_constrained</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#abc81c5867684b6e31b65459ec9431269">readphaser</a>, tmpstr, ampmax, slewrate, 0) == FAILURE)</div><div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;      <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;  }</div><div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;</div><div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;</div><div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;  <span class="comment">/**************************** Step 8: Convenience info ****************************/</span></div><div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;</div><div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#a91f5845d9f812af4f2072deefb1823fa">ks_eval_epi_setinfo</a>(epi);</div><div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;</div><div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;</div><div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;</div><div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;} <span class="comment">/* ks_eval_epi_constrained */</span></div><div class="ttc" id="struct_k_s___e_p_i_html_ab758140f3ca23e746a312f34a0d9c3a9"><div class="ttname"><a href="struct_k_s___e_p_i.html#ab758140f3ca23e746a312f34a0d9c3a9">KS_EPI::blipoversize</a></div><div class="ttdeci">float blipoversize</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1694</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_aaa0021ab8174eb7806de89d599769a9b"><div class="ttname"><a href="struct_k_s___e_p_i.html#aaa0021ab8174eb7806de89d599769a9b">KS_EPI::blip</a></div><div class="ttdeci">KS_TRAP blip</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1687</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a878bb367b07dc7dfb5fef5728d2e5b1d"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">KS_TRAP::plateautime</a></div><div class="ttdeci">int plateautime</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:436</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a3d90133d3051fbc4816d02efd9566d8e"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">KS_PHASER::R</a></div><div class="ttdeci">int R</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1529</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">KS_PHASER::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1527</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aeb07c1278254f0a40622fbbe10566f57"><div class="ttname"><a href="_k_s_foundation_8h.html#aeb07c1278254f0a40622fbbe10566f57">ks_calc_fov2gradareapixel</a></div><div class="ttdeci">float ks_calc_fov2gradareapixel(float fov)</div><div class="ttdoc">Calculates the gradient area needed to move one pixel in k-space</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:279</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a4762b9a6307f0223b3d1dfde7e8ddce8"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a4762b9a6307f0223b3d1dfde7e8ddce8">KS_PHASER::nacslines</a></div><div class="ttdeci">int nacslines</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1530</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a91f5845d9f812af4f2072deefb1823fa"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a91f5845d9f812af4f2072deefb1823fa">ks_eval_epi_setinfo</a></div><div class="ttdeci">STATUS ks_eval_epi_setinfo(KS_EPI *epi)</div><div class="ttdoc">Set convenience info for KS_EPI based on objects&amp;#39; timing in KS_EPI</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:2752</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a22cd0313e5ffabe8393f77745dba8d52"><div class="ttname"><a href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">KS_EPI::blipphaser</a></div><div class="ttdeci">KS_PHASER blipphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1688</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a3719e6e7daa633b15bf8213abd3e3ab7"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a3719e6e7daa633b15bf8213abd3e3ab7">ks_eval_phaser_constrained</a></div><div class="ttdeci">STATUS ks_eval_phaser_constrained(KS_PHASER *phaser, const char *const phasername, float ampmax, float slewrate, int minduration)</div><div class="ttdoc">Sets up a trapezoid for phase encoding, subject to gradient constraints specified as input arguments...</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:783</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_ace858b7b1e7182259bcaa098147e5956"><div class="ttname"><a href="_k_s_foundation__host_8c.html#ace858b7b1e7182259bcaa098147e5956">ks_eval_trap_constrained</a></div><div class="ttdeci">STATUS ks_eval_trap_constrained(KS_TRAP *trap, const char *const desc, float ampmax, float slewrate, int minduration)</div><div class="ttdoc">Sets up a trapezoid using a KS_TRAP sequence object with gradient constraints specified as input argu...</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:276</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_ad76a5ac226f0d25f70349ef83b5bc38a"><div class="ttname"><a href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">KS_EPI::zphaser</a></div><div class="ttdeci">KS_PHASER zphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1689</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">KS_READTRAP::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1435</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a38e859809526b8d07b17999dc6bbdbe9"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a38e859809526b8d07b17999dc6bbdbe9">ks_init_phaser</a></div><div class="ttdeci">void ks_init_phaser(KS_PHASER *phaser)</div><div class="ttdoc">Resets a KS_PHASER sequence object to its default value (KS_INIT_PHASER)</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:73</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a0a1d9107de6b9e38a08ad33a76ea6cf5"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a0a1d9107de6b9e38a08ad33a76ea6cf5">ks_eval_readtrap_constrained</a></div><div class="ttdeci">STATUS ks_eval_readtrap_constrained(KS_READTRAP *readtrap, const char *const desc, float ampmax, float slewrate)</div><div class="ttdoc">Sets up an acquisition window with a trapezoid, subject to gradient constraints specified as input ar...</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:411</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a7582325a159d8ec89a4a4ba0fb89e9a9"><div class="ttname"><a href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">KS_EPI::etl</a></div><div class="ttdeci">int etl</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1690</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#aac31eb68bff694554a182bd796b2f1c5">KS_READTRAP::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1426</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a03d42c44e323f3203fe5beabcefa47a5"><div class="ttname"><a href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">KS_EPI::read</a></div><div class="ttdeci">KS_READTRAP read</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1685</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a0d32a90987ac38871d307027697c90d8"><div class="ttname"><a href="struct_k_s___e_p_i.html#a0d32a90987ac38871d307027697c90d8">KS_EPI::minbliparea</a></div><div class="ttdeci">float minbliparea</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1695</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a97ab43f6fd28920a42d987c8fec4afec"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a97ab43f6fd28920a42d987c8fec4afec">KS_TRAP::area</a></div><div class="ttdeci">float area</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:434</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ab508ded41392ee86a2a619d3e93d2373"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">KS_TRAP::amp</a></div><div class="ttdeci">float amp</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:433</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a29cf05caf131eb2c5915a41b18af16d0"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">KS_PHASER::nover</a></div><div class="ttdeci">int nover</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1528</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_abc81c5867684b6e31b65459ec9431269"><div class="ttname"><a href="struct_k_s___e_p_i.html#abc81c5867684b6e31b65459ec9431269">KS_EPI::readphaser</a></div><div class="ttdeci">KS_TRAP readphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1686</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_a29cf05caf131eb2c5915a41b18af16d0"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#a29cf05caf131eb2c5915a41b18af16d0">KS_READTRAP::nover</a></div><div class="ttdeci">int nover</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1428</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_a6a2cc013660b66a4c7793c6e55bfcaa8"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#a6a2cc013660b66a4c7793c6e55bfcaa8">KS_READTRAP::rampsampling</a></div><div class="ttdeci">int rampsampling</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1427</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_TRAP::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:437</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_a0c3ba07aac8b5f911ce918a97c7ebbc6"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#a0c3ba07aac8b5f911ce918a97c7ebbc6">KS_READTRAP::area2center</a></div><div class="ttdeci">float area2center</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1433</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_abfd94a01fc71278021802ca0d1e25e16"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#abfd94a01fc71278021802ca0d1e25e16">KS_PHASER::fov</a></div><div class="ttdeci">float fov</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1526</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_a13d3424b69abfaa66668757e06fed900"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#a13d3424b69abfaa66668757e06fed900">KS_READTRAP::acqdelay</a></div><div class="ttdeci">int acqdelay</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1429</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_acbc719dc4e48c2a2df0447875e4348ca"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">KS_TRAP::ramptime</a></div><div class="ttdeci">int ramptime</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:435</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a91f5845d9f812af4f2072deefb1823fa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a91f5845d9f812af4f2072deefb1823fa">&#9670;&nbsp;</a></span>ks_eval_epi_setinfo()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_epi_setinfo </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *&#160;</td>
          <td class="paramname"><em>epi</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Set convenience info for <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> based on objects' timing in <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a></h4>
</p>
<div class="fragment"><div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;                                        {</div><div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;</div><div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;    epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> = epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a> * epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> + \</div><div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;                    (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a> - 1) * epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a035bb76f8cc944eff7afd9333c2688e3">read_spacing</a> + \</div><div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;                    IMax(3, epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#abc81c5867684b6e31b65459ec9431269">readphaser</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>, epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>, epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>) + \</div><div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;                    IMax(3, epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#abc81c5867684b6e31b65459ec9431269">readphaser</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>, epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>, epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>);</div><div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;</div><div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;    <span class="keywordflow">if</span> (abs(epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a>)) {</div><div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;      <span class="comment">/* partial Fourier */</span></div><div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;      epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#aa29afe5800d6b5d4be29e1da24c63caf">time2center</a> = ((epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> + epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a035bb76f8cc944eff7afd9333c2688e3">read_spacing</a>) * (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a> / epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a>)) - epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a035bb76f8cc944eff7afd9333c2688e3">read_spacing</a> / 2;</div><div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;      epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#aa29afe5800d6b5d4be29e1da24c63caf">time2center</a> = ((epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> + epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a035bb76f8cc944eff7afd9333c2688e3">read_spacing</a>) * epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a> / 2) - epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a035bb76f8cc944eff7afd9333c2688e3">read_spacing</a> / 2;</div><div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;    }</div><div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;    epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#aa29afe5800d6b5d4be29e1da24c63caf">time2center</a> += IMax(3, epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#abc81c5867684b6e31b65459ec9431269">readphaser</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>, epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>, epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>);</div><div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;</div><div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;  <span class="keywordflow">return</span> SUCCESS;  </div><div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;}</div><div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a3d90133d3051fbc4816d02efd9566d8e"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">KS_PHASER::R</a></div><div class="ttdeci">int R</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1529</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">KS_PHASER::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1525</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a22cd0313e5ffabe8393f77745dba8d52"><div class="ttname"><a href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">KS_EPI::blipphaser</a></div><div class="ttdeci">KS_PHASER blipphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1688</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_ad76a5ac226f0d25f70349ef83b5bc38a"><div class="ttname"><a href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">KS_EPI::zphaser</a></div><div class="ttdeci">KS_PHASER zphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1689</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">KS_READTRAP::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1435</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___e_p_i.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_EPI::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1692</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a7582325a159d8ec89a4a4ba0fb89e9a9"><div class="ttname"><a href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">KS_EPI::etl</a></div><div class="ttdeci">int etl</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1690</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a03d42c44e323f3203fe5beabcefa47a5"><div class="ttname"><a href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">KS_EPI::read</a></div><div class="ttdeci">KS_READTRAP read</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1685</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a29cf05caf131eb2c5915a41b18af16d0"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">KS_PHASER::nover</a></div><div class="ttdeci">int nover</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1528</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_aa29afe5800d6b5d4be29e1da24c63caf"><div class="ttname"><a href="struct_k_s___e_p_i.html#aa29afe5800d6b5d4be29e1da24c63caf">KS_EPI::time2center</a></div><div class="ttdeci">int time2center</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1693</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_abc81c5867684b6e31b65459ec9431269"><div class="ttname"><a href="struct_k_s___e_p_i.html#abc81c5867684b6e31b65459ec9431269">KS_EPI::readphaser</a></div><div class="ttdeci">KS_TRAP readphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1686</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a035bb76f8cc944eff7afd9333c2688e3"><div class="ttname"><a href="struct_k_s___e_p_i.html#a035bb76f8cc944eff7afd9333c2688e3">KS_EPI::read_spacing</a></div><div class="ttdeci">int read_spacing</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1691</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_TRAP::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:437</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a90a2291a373ec98692e078d145473ec9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a90a2291a373ec98692e078d145473ec9">&#9670;&nbsp;</a></span>ks_eval_epi_maxamp_slewrate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_epi_maxamp_slewrate </td>
          <td>(</td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>ampmax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>slewrate</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>xres</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>quietnessfactor</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Get maximum amplitude and slewrate for the EPI readout constrained by hardware and PNS</h4>
</p>
<p>Get a reasonably optimized max gradient amplitude and slewrate for the EPI train. This function results in similar values as GE's epigradopts(), where gradient system limits and peripheral-nerve-stimulation (PNS) are not to be exceeded. <a class="el" href="_k_s_foundation_8h.html#a90a2291a373ec98692e078d145473ec9" title="Get maximum amplitude and slewrate for the EPI readout constrained by hardware and PNS...">ks_eval_epi_maxamp_slewrate()</a> has no dB/dt model, but is dependent on xres (assuming fixed FOV, rampsampling and maxmimum rBW). This has also been tested for axial and oblique scans on volunteers at Karolinska without PNS experience using FOV = 24 cm on both DV750 and DV750w with rampsampling and rBW = 250. If PNS should still occur, the slewrate value passed to <a class="el" href="_k_s_foundation_8h.html#a36356d324c41fd3b1446443e15d54815" title="Sets up a KS_EPI composite sequence object, subject to gradients constraints specified as input argum...">ks_eval_epi_constrained()</a> should be decreased. The units of the slewrate is [(G / cm) / us], i.e. gradient amp in G / cm divided by the ramptime in us. This value times 1e4 gives slewrate in SI units: T / m / s (up to e.g. 200).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">ampmax</td><td>The maximum allowed gradient amplitude ([G/cm]) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">slewrate</td><td>The maximum allowed slewrate ([(G/cm) / us]). Value of 0.01 corresponds to 100 mT/m/s </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">xres</td><td>The frequency encoding resolution </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">quietnessfactor</td><td>Value &gt;= 1 used for optional gradient derating </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;                                                                                                    {</div><div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;  PHYS_GRAD epiphygrd = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 };</div><div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;  LOG_GRAD  epiloggrd = {0, 0, 0, 0, 0, 0, {0, 0, 0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, {0, 0, 0, 0}, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 };</div><div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;  <span class="keywordtype">int</span> epi_initnewgeo = 1;</div><div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;  <span class="keyword">extern</span> SCAN_INFO scan_info[SLTAB_MAX];</div><div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;  <span class="keyword">extern</span> <span class="keywordtype">int</span> opcoax;</div><div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;  <span class="keyword">extern</span> <span class="keywordtype">int</span> opplane;</div><div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;  <span class="keyword">extern</span> <span class="keywordtype">int</span> opslquant;</div><div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;  <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="_g_e_required_8e.html#a9e27acda2e5cc865747fa56d03d8f093">obl_debug</a>;</div><div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;  <span class="keywordtype">int</span> stronggradient_flag = 0;</div><div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;  <span class="keywordtype">int</span> premiersystem_flag = 0;</div><div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">float</span> premierslewrate_max = 0.0150; <span class="comment">/* 0.0150 (G/cm)/us = SR150 (T/m)/s */</span></div><div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">float</span> stronggradient_ampmax = 3.5; <span class="comment">/* 35 mT/m. Maximum gradient amplitude to avoid too high rBW at k-space center */</span></div><div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;</div><div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;  <span class="comment">/* relationships below have been tested in the range [16,256] */</span></div><div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;  <span class="keywordflow">if</span> (xres &lt; 16)</div><div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;    xres = 16;</div><div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;  <span class="keywordflow">if</span> (xres &gt; 256)</div><div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;    xres = 256;</div><div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;</div><div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;</div><div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;  <span class="keywordflow">if</span> (quietnessfactor &lt; 1.0) {</div><div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: The quietness factor must be &gt;= 1.0&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;  }</div><div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;</div><div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;</div><div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;  inittargets(&amp;epiloggrd, &amp;epiphygrd);</div><div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;</div><div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;  <span class="comment">/* we need to know the system limits, but we don&#39;t want to be dependent on GERequired:GEReq_init_gradspecs() and ks_srfact</span></div><div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;<span class="comment">     for the EPI readout. I.e. ks_srfact (GERequired.e) can be used to set a proper slewrate tweak factor for all gradients except for</span></div><div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;<span class="comment">     the EPI readout (and EPI blips), while the ampmax and slewrate for the EPI train is controlled only by this function */</span></div><div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;  <span class="keywordflow">if</span> (obloptimize_epi(&amp;epiloggrd, &amp;epiphygrd, scan_info, (opslquant),</div><div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;                      (opplane), (opcoax), PSD_OBL_OPTIMAL, (<a class="code" href="_g_e_required_8e.html#a9e27acda2e5cc865747fa56d03d8f093">obl_debug</a>), &amp;epi_initnewgeo, <a class="code" href="_k_s_foundation__host_8c.html#abf6243f7d1afc6d9684f8aeaf71b10a7">cfsrmode</a>) == FAILURE) {</div><div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: obloptimize_epi() failed&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;  }</div><div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;</div><div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;  <span class="comment">/* ampmax */</span></div><div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;<span class="preprocessor">#if EPIC_RELEASE &gt;= 27</span></div><div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;  stronggradient_flag = (<a class="code" href="_k_s_foundation__host_8c.html#af18437b2347fb8d8a16a7668f4a7a768">cfgcoiltype</a> == PSD_XRMB_COIL || <a class="code" href="_k_s_foundation__host_8c.html#af18437b2347fb8d8a16a7668f4a7a768">cfgcoiltype</a> == <a class="code" href="_k_s_foundation_8h.html#a51e32d6a9800bdbb4ecf0546f1f92a0e">PSD_HRMW_COIL</a>); <span class="comment">/* 750 or Premier. 50+ mT/m */</span></div><div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;  premiersystem_flag = (<a class="code" href="_k_s_foundation__host_8c.html#af18437b2347fb8d8a16a7668f4a7a768">cfgcoiltype</a> == <a class="code" href="_k_s_foundation_8h.html#a51e32d6a9800bdbb4ecf0546f1f92a0e">PSD_HRMW_COIL</a>);</div><div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;  stronggradient_flag = <a class="code" href="_k_s_foundation__host_8c.html#af18437b2347fb8d8a16a7668f4a7a768">cfgcoiltype</a> == PSD_XRMB_COIL; <span class="comment">/* 750 */</span></div><div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;</div><div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;  <span class="keywordflow">if</span> (stronggradient_flag) {</div><div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;   *ampmax = FMin(2, stronggradient_ampmax, 0.01 * xres + 2); <span class="comment">/* very unscientific linear relationship, but GE&#39;s EPI gradients increase semi-linearly with xres (they use epigradopt.c) */</span></div><div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;    <span class="comment">/* 750w and others */</span></div><div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;    <span class="keywordflow">if</span> (xres &gt; 128)</div><div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;      *ampmax = 0.005 * xres + 1.36; <span class="comment">/* allow the amp to increase slowly for higher res than 128 */</span></div><div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;      *ampmax = 2.0;</div><div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;  }</div><div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;  *ampmax = FMin(2, *ampmax, epiphygrd.xfs);</div><div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;</div><div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;</div><div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;  <span class="comment">/* slewrate */</span></div><div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;  <span class="keywordflow">if</span> (stronggradient_flag) {</div><div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;    <span class="comment">//* 750 or Premier. 50+ mT/m */</span></div><div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;    <span class="keywordflow">if</span> (xres &lt;= 48){</div><div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;      *slewrate = 250e-4; <span class="comment">/* SR250 */</span></div><div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;      *slewrate = 1.0e-4 / (2.4e-5 * xres + 0.003); <span class="comment">/* SR250 (xres 48) -&gt; SR110 (xres 256). 1/x function */</span></div><div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;    }</div><div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;    <span class="keywordflow">if</span> (premiersystem_flag &amp;&amp; *slewrate &gt; premierslewrate_max) {</div><div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;      *slewrate = premierslewrate_max;</div><div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;    }</div><div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;    <span class="comment">/* 750w. 33 mT/m, SR120 (and all others) */</span></div><div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;    <span class="keywordflow">if</span> (xres &lt;= 48)</div><div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;      *slewrate = 170e-4; <span class="comment">/* SR170 */</span></div><div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;      *slewrate = 120e-4; <span class="comment">/* SR120 */</span></div><div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;</div><div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;    <span class="comment">/* use the relative ampmax reduction dependent on slice angulation to instead reduce the slewrate on 750w.</span></div><div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;<span class="comment">       ks_syslimits_ampmax2(&amp;epiloggrd) returns 1.0 for axial scans,</span></div><div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;<span class="comment">       but for oblique scans the value is reduced. Although this should cap the amplitude, we use</span></div><div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;<span class="comment">       is here to instead reduce the slewrate, since we need some way to make the slewrate lower for (double)</span></div><div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;<span class="comment">       oblique scans, or maybe when the XGRAD is not parallel to the physical X-axis (R/L) */</span></div><div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;</div><div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;    *slewrate *= epiloggrd.tx_xy / epiloggrd.xfs;</div><div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;  }</div><div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;</div><div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;  <span class="comment">/* but if user wants a quieter scan, reduce the slewate */</span></div><div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;  *slewrate /= quietnessfactor;</div><div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;</div><div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;</div><div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;</div><div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;} <span class="comment">/* ks_eval_epi_maxamp_slewrate() */</span></div><div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a51e32d6a9800bdbb4ecf0546f1f92a0e"><div class="ttname"><a href="_k_s_foundation_8h.html#a51e32d6a9800bdbb4ecf0546f1f92a0e">PSD_HRMW_COIL</a></div><div class="ttdeci">#define PSD_HRMW_COIL</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:97</div></div>
<div class="ttc" id="_g_e_required_8e_html_a9e27acda2e5cc865747fa56d03d8f093"><div class="ttname"><a href="_g_e_required_8e.html#a9e27acda2e5cc865747fa56d03d8f093">obl_debug</a></div><div class="ttdeci">int obl_debug</div><div class="ttdef"><b>Definition:</b> GERequired.e:230</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_af18437b2347fb8d8a16a7668f4a7a768"><div class="ttname"><a href="_k_s_foundation__host_8c.html#af18437b2347fb8d8a16a7668f4a7a768">cfgcoiltype</a></div><div class="ttdeci">int cfgcoiltype</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_abf6243f7d1afc6d9684f8aeaf71b10a7"><div class="ttname"><a href="_k_s_foundation__host_8c.html#abf6243f7d1afc6d9684f8aeaf71b10a7">cfsrmode</a></div><div class="ttdeci">int cfsrmode</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a77fb9dea403599e8fbbf1fed426ff66e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a77fb9dea403599e8fbbf1fed426ff66e">&#9670;&nbsp;</a></span>ks_eval_epi()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_epi </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *&#160;</td>
          <td class="paramname"><em>epi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const&#160;</td>
          <td class="paramname"><em>desc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>quietnessfactor</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets up a <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> composite sequence object with preset gradient constraints</h4>
</p>
<p>This is a wrapper function to <a class="el" href="_k_s_foundation_8h.html#a36356d324c41fd3b1446443e15d54815" title="Sets up a KS_EPI composite sequence object, subject to gradients constraints specified as input argum...">ks_eval_epi_constrained()</a> with a reduced set of input arguments using preset gradient constraints. These constraints should allow for EPI readouts for double oblique slice angulations, but the values for <em>ampmax</em> or <em>slewrate</em> may not be optimal. If peripheral nerve stimulation (PNS) would be observed, consider calling <a class="el" href="_k_s_foundation_8h.html#a36356d324c41fd3b1446443e15d54815" title="Sets up a KS_EPI composite sequence object, subject to gradients constraints specified as input argum...">ks_eval_epi_constrained()</a> directly with reduced <em>slewrate</em>. This will however increase the geometric distortions in the images</p>
<p>See <a class="el" href="_k_s_foundation_8h.html#a36356d324c41fd3b1446443e15d54815" title="Sets up a KS_EPI composite sequence object, subject to gradients constraints specified as input argum...">ks_eval_epi_constrained()</a> for more details on fields in <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> that must be set before calling this function</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">epi</td><td>Pointer to the <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> object to be set up </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">desc</td><td>A description (text string) of the <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> object. This description is used for pulse sequence generation (seen in the file generated by <em>TimeHist</em> in <em>MGD Sim/WTools</em>) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">quietnessfactor</td><td>Value &gt;= 1 used for optional gradient derating </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;                                                                                {</div><div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;  <span class="keywordtype">float</span> ampmax, slewrate;</div><div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;</div><div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__host_8c.html#a90a2291a373ec98692e078d145473ec9">ks_eval_epi_maxamp_slewrate</a>(&amp;ampmax, &amp;slewrate, epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#aac31eb68bff694554a182bd796b2f1c5">res</a>, quietnessfactor) == FAILURE)</div><div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;</div><div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__host_8c.html#a9d870e214ac57c8d2a87c8d754167d32">ks_eval_epi_constrained</a>(epi, desc, ampmax, slewrate);</div><div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;</div><div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;} <span class="comment">/* ks_eval_epi */</span></div><div class="ttc" id="_k_s_foundation__host_8c_html_a90a2291a373ec98692e078d145473ec9"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a90a2291a373ec98692e078d145473ec9">ks_eval_epi_maxamp_slewrate</a></div><div class="ttdeci">STATUS ks_eval_epi_maxamp_slewrate(float *ampmax, float *slewrate, int xres, float quietnessfactor)</div><div class="ttdoc">Get maximum amplitude and slewrate for the EPI readout constrained by hardware and PNS...</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:2772</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a9d870e214ac57c8d2a87c8d754167d32"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a9d870e214ac57c8d2a87c8d754167d32">ks_eval_epi_constrained</a></div><div class="ttdeci">STATUS ks_eval_epi_constrained(KS_EPI *epi, const char *const desc, float ampmax, float slewrate)</div><div class="ttdoc">Sets up a KS_EPI composite sequence object, subject to gradients constraints specified as input argum...</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:2620</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#aac31eb68bff694554a182bd796b2f1c5">KS_READTRAP::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1426</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a03d42c44e323f3203fe5beabcefa47a5"><div class="ttname"><a href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">KS_EPI::read</a></div><div class="ttdeci">KS_READTRAP read</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1685</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab4c6e9f82b55a3db56765fc22f21b7b5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab4c6e9f82b55a3db56765fc22f21b7b5">&#9670;&nbsp;</a></span>ks_eval_gradrflimits()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_eval_gradrflimits </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_a_r.html">KS_SAR</a> *&#160;</td>
          <td class="paramname"><em>sar</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html">KS_SEQ_COLLECTION</a> *&#160;</td>
          <td class="paramname"><em>seqcollection</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>gheatfact</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the time required to play out a certain number of sequence modules over some interval, honoring SAR, RF power and gradient heating constraints</h4>
</p>
<p>This function uses one <a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html" title="Collection handle of all sequence modules involved in the pulse sequence, used for RF scaling...">KS_SEQ_COLLECTION</a> struct holding the RF and gradient information for the entire psd (involving one or more sequence modules) to check if an interval can be played out as is or if the overall duration needs to be increased to honor SAR and hardware limits. The interval of measurement is given by the function pointer passed to <a class="el" href="_k_s_foundation_8h.html#af38e51235c90bff510cae4ee1955dd95" title="Returns the minimum TR based on the content of a slice loop, adding additional time due to SAR and ha...">ks_eval_mintr()</a>, which typically is a sliceloop function playing out the slices for one TR (using one or more sequence modules).</p>
<p>The net time for this period is given by the sum of instances and durations of the sequence modules involved. This information is taken from <a class="el" href="_k_s_foundation_8h.html#aeb213f86f7f6172f91b3ab69a518afe7" title="Returns the total duration of the sequence collection">ks_eval_seqcollection_gettotalduration()</a>, which sums the product of the duration of each sequence module by the number of instances of each sequence module.</p>
<p><a class="el" href="_k_s_foundation_8h.html#ab4c6e9f82b55a3db56765fc22f21b7b5" title="Returns the time required to play out a certain number of sequence modules over some interval...">ks_eval_gradrflimits()</a> will call GE's regular SAR, RF power and gradient heating functions after creating temporary RF_PULSE and GRAD_PULSE structs using the sequence objects (RF and gradients) in the sequence modules.</p>
<p>The gradient information for all sequence modules is accessed via <code>seqcollection-&gt;seqctrlptr[i].gradrf.trapptr[...]</code>, while the RF information for all sequence modules is accessed via <code>seqcollection-&gt;seqctrlptr[i].gradrf.rfptr[...]</code>, with <em>i</em> being the internal sequence module index.</p>
<p>GE's hardware and SAR check functions will return new minimum durations, which may be equal or larger than the net time, depending on the hardware and safety limits. The largest new minimum duration is the return value for this function. Also, if the 1st argument (<a class="el" href="struct_k_s___s_a_r.html" title="Struct to keep SAR parameters together. Used in ks_eval_gradrflimits() and GEReq_eval_checkTR_SAR_cal...">KS_SAR</a> *) is not pointing to NULL, the SAR information will be stored in this struct, so it can be used by the calling function.</p>
<p>Currently, KSFoundation does not use GE's new gradheat method where cornerpoints of the sequence waveforms are used for the gradient heating calculations. When using the old method, the <code>minseq()</code> function will likely be too conservative and may add unnecessary time penalty. The level of exaggeration is not clear, why there is a temporary solution with a 'gheatfact' as an input argument, where it is up to the EPIC programmer to decide on this. This variable should be 1.0 to fully obey the old gradient heating calculations (understanding the minimum TR can bump up significantly). To fully ignore gradient heating calculations a value of 0.0 is used. The proper value of this variable, that would correspond to the actual hardware gradient limits, is not known at the moment, but a value closer to 0.0 than 1.0 better matches the new gradient heating model used by GE's product psds. Having said that, absolutely no guarantees are given in terms of gradient damage or similar.</p>
<p>See also: <a class="el" href="_k_s_foundation_8h.html#af38e51235c90bff510cae4ee1955dd95" title="Returns the minimum TR based on the content of a slice loop, adding additional time due to SAR and ha...">ks_eval_mintr()</a>, <a class="el" href="_k_s_foundation_8h.html#a86ab45a04531e1e9353667c9ca6d5fbd" title="Returns the maximum number of slices that can be played out in one TR, honoring SAR and hardware cons...">ks_eval_maxslicespertr()</a>, <a class="el" href="_k_s_foundation_8h.html#aeb213f86f7f6172f91b3ab69a518afe7" title="Returns the total duration of the sequence collection">ks_eval_seqcollection_gettotalduration()</a></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">sar</td><td>Pointer to <a class="el" href="struct_k_s___s_a_r.html" title="Struct to keep SAR parameters together. Used in ks_eval_gradrflimits() and GEReq_eval_checkTR_SAR_cal...">KS_SAR</a> struct with SAR parameters. If NULL, no attempt to store SAR parameters will be done. If not null, <a class="el" href="struct_k_s___s_a_r.html" title="Struct to keep SAR parameters together. Used in ks_eval_gradrflimits() and GEReq_eval_checkTR_SAR_cal...">KS_SAR</a> will be set up. In addition, the description of GE's CV 'optr' will be changed so that one can see the limit factor and how much time that had to be added to be within specs. This information can be viewed on the MR system while scanning by DisplayCV and type in 'optr'. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">seqcollection</td><td>A <a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html" title="Collection handle of all sequence modules involved in the pulse sequence, used for RF scaling...">KS_SEQ_COLLECTION</a> struct, which have undergone a reset of <code>seqctlptr[].nseqinstances</code> followed by a single run of the sequence's slice loop or equivalent period </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gheatfact</td><td>Experimental fudge factor in range [0.0, 1.0] to control how much to obey the gradient heating calculations using the old gradient heating model. It is up to the EPIC programmer to set this to a proper value for now. This input argument can hopefully be removed in the future </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">int</td><td>Minimum time in[us] that is needed to safetly play out the <code>.nseqinstances</code> sequence modules over the intended interval (usually one <em>TR</em> for 2D sequences) </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;                                                                                         {</div><div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;  <span class="keywordtype">int</span> i, j;</div><div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;  <span class="keywordtype">int</span> rfindx = 0;</div><div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;  <span class="keywordtype">int</span> numuniquetrap = 0;</div><div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;  <span class="keywordtype">int</span> numxtrap = 0;</div><div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;  <span class="keywordtype">int</span> numytrap = 0;</div><div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;  <span class="keywordtype">int</span> numztrap = 0;</div><div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;  <span class="keywordtype">int</span> numuniquerf = 0;</div><div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;  <span class="keywordtype">int</span> nettime = 0;</div><div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;  <span class="keywordtype">int</span> newtime_gradheat = 0;</div><div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;  <span class="keywordtype">int</span> newtime_rfamp = 0;</div><div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;  <span class="keywordtype">int</span> newtime_sar = 0;</div><div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;  <span class="keywordtype">int</span> newtime_allconstraints = 0;</div><div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;  <span class="keywordtype">int</span> dummy;</div><div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;  <span class="keywordtype">double</span> ave_sar = 0;</div><div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;  <span class="keywordtype">double</span> peak_sar = 0;</div><div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;  <span class="keywordtype">double</span> cave_sar = 0; <span class="comment">/* Coil SAR */</span></div><div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;  <span class="keywordtype">double</span> b1rms = 0;</div><div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;  GRAD_PULSE tempgrad;</div><div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;</div><div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;  STATUS status;</div><div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a> == NULL) {</div><div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: 2nd arg is NULL (KS_SEQ_COLLECTION)&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>;</div><div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a65c4aa433169274a52c448793e82e12e">numseq</a> &lt; 1) {</div><div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: No sequence modules in 2nd arg (KS_SEQ_COLLECTION)&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>;</div><div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;  }</div><div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;</div><div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;  <span class="comment">/********** copy to common struct arrays for grad and RF from the sequence collection **********/</span></div><div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a65c4aa433169274a52c448793e82e12e">numseq</a>; i++) {</div><div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;    numuniquetrap += <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">seqctrlptr</a>[i]-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a576774535b3b72525cf3821a0ded5124">numtrap</a>;</div><div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;    numuniquerf   += <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">seqctrlptr</a>[i]-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ad1471d1cbc5ed7e8b1bc9d0987bf6eed">numrf</a>;</div><div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;  }</div><div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;</div><div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;  nettime = <a class="code" href="_k_s_foundation__host_8c.html#aeb213f86f7f6172f91b3ab69a518afe7">ks_eval_seqcollection_gettotalduration</a>(<a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>);</div><div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;  <span class="keywordflow">if</span> (nettime &lt;= 0) {</div><div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;    <span class="keywordflow">return</span> nettime;</div><div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;  }</div><div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;</div><div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;  GRAD_PULSE *mygradx = alloca(numuniquetrap * <span class="keyword">sizeof</span>(GRAD_PULSE));</div><div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;  GRAD_PULSE *mygrady = alloca(numuniquetrap * <span class="keyword">sizeof</span>(GRAD_PULSE));</div><div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;  GRAD_PULSE *mygradz = alloca(numuniquetrap * <span class="keyword">sizeof</span>(GRAD_PULSE));</div><div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;  RF_PULSE *myrfpulse = alloca(numuniquerf * <span class="keyword">sizeof</span>(RF_PULSE));</div><div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;</div><div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;</div><div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a65c4aa433169274a52c448793e82e12e">numseq</a>; i++) {</div><div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;</div><div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;    <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">seqctrlptr</a>[i]-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a576774535b3b72525cf3821a0ded5124">numtrap</a>; j++) {</div><div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;</div><div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;      tempgrad = <a class="code" href="_k_s_foundation__host_8c.html#acf397088ddce91c4fc821e59fa0a321d">ks_eval_makegradpulse</a>(<a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">seqctrlptr</a>[i]-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a218dab0fa00815bec264cb1170a615ef">trapptr</a>[j], XGRAD);</div><div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;      <span class="keywordflow">if</span> (tempgrad.num &gt; 0) {</div><div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;        <span class="comment">/* change from &quot;number of instances per sequence module&quot; to &quot;number of instances per TR&quot;</span></div><div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;<span class="comment">         by multiplying by the number of times this sequence module is played out each TR */</span></div><div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;        tempgrad.num *= <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">seqctrlptr</a>[i]-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a5af9f3a7de19e7493ce64776bd8f3556">nseqinstances</a>;</div><div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;        mygradx[numxtrap++] = tempgrad;</div><div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;      }</div><div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;</div><div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;      tempgrad = <a class="code" href="_k_s_foundation__host_8c.html#acf397088ddce91c4fc821e59fa0a321d">ks_eval_makegradpulse</a>(<a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">seqctrlptr</a>[i]-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a218dab0fa00815bec264cb1170a615ef">trapptr</a>[j], YGRAD);</div><div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;      <span class="keywordflow">if</span> (tempgrad.num &gt; 0) {</div><div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;        tempgrad.num *= <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">seqctrlptr</a>[i]-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a5af9f3a7de19e7493ce64776bd8f3556">nseqinstances</a>;</div><div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;        mygrady[numytrap++] = tempgrad;</div><div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;      }</div><div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;</div><div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;      tempgrad = <a class="code" href="_k_s_foundation__host_8c.html#acf397088ddce91c4fc821e59fa0a321d">ks_eval_makegradpulse</a>(<a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">seqctrlptr</a>[i]-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a218dab0fa00815bec264cb1170a615ef">trapptr</a>[j], ZGRAD);</div><div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;      <span class="keywordflow">if</span> (tempgrad.num &gt; 0) {</div><div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;        tempgrad.num *= <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">seqctrlptr</a>[i]-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a5af9f3a7de19e7493ce64776bd8f3556">nseqinstances</a>;</div><div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;        mygradz[numztrap++] = tempgrad;</div><div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;      }</div><div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;</div><div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;    }</div><div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;</div><div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;    <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">seqctrlptr</a>[i]-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ad1471d1cbc5ed7e8b1bc9d0987bf6eed">numrf</a>; j++) {</div><div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;      <a class="code" href="_k_s_foundation__host_8c.html#acb5bc476c9416f2a3d9c975dd80fbb23">ks_eval_rf_relink</a>(<a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">seqctrlptr</a>[i]-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a753f71c73d8169393fcbe8a9b3f4d2c2">rfptr</a>[j]);</div><div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;      myrfpulse[rfindx] = <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">seqctrlptr</a>[i]-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a753f71c73d8169393fcbe8a9b3f4d2c2">rfptr</a>[j]-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>;</div><div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;      <span class="comment">/* change from &quot;number of instances per sequence module&quot; to &quot;number of instances per TR&quot;</span></div><div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;<span class="comment">      by multiplying by the number of times this sequence module is played out each TR */</span></div><div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;      myrfpulse[rfindx].num *= <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">seqctrlptr</a>[i]-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a5af9f3a7de19e7493ce64776bd8f3556">nseqinstances</a>;</div><div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;      rfindx++;</div><div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;    }</div><div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;</div><div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;  }</div><div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;</div><div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;  <span class="comment">/********** Gradient heating ***********/</span></div><div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;</div><div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;  <span class="comment">/* turn gradHeatMethod off until we understand how/if getCornerPoints() work (PGenOnHost()) in minseq.c */</span></div><div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> saveGradHeatMethod = <a class="code" href="_k_s_foundation__host_8c.html#a1f70ca5eee14bca64624b19cdea23dc0">gradHeatMethod</a>;</div><div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;</div><div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;  <span class="comment">/* gradHeatMethod:</span></div><div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;<span class="comment">     - Off: old traditional gradient heating calcs where minseq() is calling minseqgrad() and minseqcoil()</span></div><div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;<span class="comment">            Warning: minseqcoil() is also calling Safe_DC_Model() if the CV gradDCsafeMethod is 1, which will cause problems for</span></div><div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;<span class="comment">            non-product PSDs. This because of the call to Safe_DC_Model()-&gt;predict_gcontirms_fse(), which contains hardcoded indices to gradient</span></div><div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;<span class="comment">            entries for product FSE. To avoid this, we now force gradDCsafeMethod = 0 until KSFoundation PSDs are using PGenOnHost for</span></div><div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;<span class="comment">            gradient heating calcs (gradHeatMethod = 1).</span></div><div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;<span class="comment">     - On: New gradient heating calcs where minseq() is calling minseqseg(). This is not supported yet in KSFoundation, but is indeed the preferred</span></div><div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;<span class="comment">           choice.</span></div><div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#a1f70ca5eee14bca64624b19cdea23dc0">gradHeatMethod</a> = PSD_OFF;</div><div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#ad81f2415c5ec6aaba74f2a8c6c45095b">gradDCsafeMethod</a> = PSD_OFF; <span class="comment">/* must be off until PGenOnHost is used (gradHeatMethod = 1) */</span></div><div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;</div><div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;  status = minseq(&amp;newtime_gradheat,</div><div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;                         mygradx, numxtrap, mygrady, numytrap, mygradz, numztrap,</div><div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;                         &amp;<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>, <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">seqctrlptr</a>[0]-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a0dd6f20330fb1abf528ca46f34299f7c">handle</a>.<a class="code" href="struct_k_s___s_e_q___h_a_n_d_l_e.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a> <span class="comment">/* assume 0 is main seq */</span>, <span class="comment">/*tsamp*/</span> GRAD_UPDATE_TIME, nettime,</div><div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;                         <span class="comment">/*use_ermes*/</span>0, <span class="comment">/*debug*/</span>0);</div><div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;</div><div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;  <span class="keywordflow">if</span> (status != SUCCESS) {</div><div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: minseq() failed (gradient heating)&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>;</div><div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;  }</div><div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#a1f70ca5eee14bca64624b19cdea23dc0">gradHeatMethod</a> = saveGradHeatMethod;</div><div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;</div><div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;  <span class="comment">/* Protection against not understood values of minseqcable_t or minseqbusbar_t</span></div><div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;<span class="comment">     which can be -2147483648 (neg INT max). This is nonsense and out of valid CV range (by 1 value)</span></div><div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;<span class="comment">     and leads to download failure. Need to find where minseqcable_t and minseqbusbar_t are set.</span></div><div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;  <span class="keywordflow">if</span> (minseqcable_t &lt; 0 || minseqcable_t &gt; 100 * nettime) {</div><div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;    <a class="code" href="_k_s_foundation__host_8c.html#a56efa525b924da4c53e3fde2cab60717">minseqcable_t</a> = 0;</div><div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;  }</div><div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;  <span class="keywordflow">if</span> (minseqbusbar_t &lt; 0 || minseqbusbar_t &gt; 100 * nettime) {</div><div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;    <a class="code" href="_k_s_foundation__host_8c.html#ac684dc36c2bed149a44b5a28bd599f84">minseqbusbar_t</a> = 0;</div><div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;  }</div><div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;</div><div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;</div><div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;</div><div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;  <span class="comment">/********** RF amplifier **********/</span></div><div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;  status = minseqrfamp(&amp;newtime_rfamp, numuniquerf, myrfpulse, L_SCAN);</div><div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;</div><div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;  <span class="keywordflow">if</span> (status != SUCCESS) {</div><div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: minseqrfamp() failed - Please reduce FA&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>;</div><div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;  }</div><div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;</div><div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;  <span class="comment">/********** RF SAR **********/</span></div><div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;<span class="preprocessor">#if EPIC_RELEASE &gt;= 24</span></div><div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;  status = maxsar(&amp;newtime_sar,</div><div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;                  &amp;dummy, &amp;ave_sar, &amp;cave_sar, &amp;peak_sar, &amp;b1rms,</div><div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;                  numuniquerf, myrfpulse, L_SCAN, nettime);</div><div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;  status = maxsar(&amp;newtime_sar,</div><div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;                  &amp;dummy, &amp;ave_sar, &amp;cave_sar, &amp;peak_sar,</div><div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;                  numuniquerf, myrfpulse, L_SCAN, nettime);</div><div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;</div><div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;  <span class="keywordflow">if</span> (status != SUCCESS) {</div><div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: maxsar() failed&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>;</div><div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;  }</div><div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;</div><div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;  <span class="keywordflow">if</span> (sar != NULL) {</div><div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;    sar-&gt;<a class="code" href="struct_k_s___s_a_r.html#a2e50537b138c27e2e30e8d3a568fbee0">average</a> = ave_sar;</div><div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;    sar-&gt;<a class="code" href="struct_k_s___s_a_r.html#a2ce680a3ce053dc060c5616496615726">coil</a> = cave_sar;</div><div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;    sar-&gt;<a class="code" href="struct_k_s___s_a_r.html#aa7fd5e56ed5028cc63702f999df5cbfd">peak</a> = peak_sar;</div><div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;    sar-&gt;<a class="code" href="struct_k_s___s_a_r.html#a3c77a7baa865a44ae8c49c408f42a5d9">b1rms</a> = b1rms;</div><div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;  }</div><div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;</div><div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;  newtime_allconstraints = IMax(4, nettime, (<span class="keywordtype">int</span>) (newtime_gradheat * gheatfact), newtime_rfamp, newtime_sar);</div><div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;</div><div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;  <span class="keywordflow">if</span> (sar == NULL) {</div><div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;  <span class="comment">/* Change description of optr only if `sar` (1st arg) == NULL (c.f. GEReq_eval_TR()-&gt;ks_eval_mintr() )</span></div><div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;<span class="comment">     This is because when we use ks_eval_mintr() we have .duration = .min_duration and hence nettime is equal</span></div><div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;<span class="comment">     to the bare sum of sequence module durations */</span></div><div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;    <span class="keywordtype">char</span> tmpstr[100];</div><div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;    <span class="keyword">extern</span> _cvfloat _optr;</div><div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;</div><div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;    <span class="keywordflow">if</span> (newtime_allconstraints == nettime) {</div><div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;      sprintf(tmpstr, <span class="stringliteral">&quot;TR [Not SAR/heat limited (%d)]&quot;</span>, nettime);</div><div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (newtime_allconstraints == newtime_gradheat) {</div><div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;      sprintf(tmpstr, <span class="stringliteral">&quot;TR [Grad. heat limited (%d/%d)]&quot;</span>, nettime, newtime_allconstraints);</div><div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (newtime_allconstraints == newtime_rfamp) {</div><div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;      sprintf(tmpstr, <span class="stringliteral">&quot;TR [RF amp limited (%d/%d)]&quot;</span>, nettime, newtime_allconstraints);</div><div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (newtime_allconstraints == newtime_sar) {</div><div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;      sprintf(tmpstr, <span class="stringliteral">&quot;TR [SAR limited (%d/%d)]&quot;</span>, nettime, newtime_allconstraints);</div><div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;    }</div><div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;    cvdesc(optr, tmpstr);</div><div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;  }</div><div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;</div><div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;  <span class="comment">/* return the maximum value */</span></div><div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;  <span class="keywordflow">return</span> RUP_GRD(newtime_allconstraints);</div><div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;</div><div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;} <span class="comment">/* ks_eval_gradrflimits */</span></div><div class="ttc" id="_k_s_foundation__host_8c_html_aeb213f86f7f6172f91b3ab69a518afe7"><div class="ttname"><a href="_k_s_foundation__host_8c.html#aeb213f86f7f6172f91b3ab69a518afe7">ks_eval_seqcollection_gettotalduration</a></div><div class="ttdeci">int ks_eval_seqcollection_gettotalduration(KS_SEQ_COLLECTION *seqcollection)</div><div class="ttdoc">Returns the total duration of the sequence collection</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3248</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a1f70ca5eee14bca64624b19cdea23dc0"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a1f70ca5eee14bca64624b19cdea23dc0">gradHeatMethod</a></div><div class="ttdeci">int gradHeatMethod</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_ad81f2415c5ec6aaba74f2a8c6c45095b"><div class="ttname"><a href="_k_s_foundation__host_8c.html#ad81f2415c5ec6aaba74f2a8c6c45095b">gradDCsafeMethod</a></div><div class="ttdeci">int gradDCsafeMethod</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_ac684dc36c2bed149a44b5a28bd599f84"><div class="ttname"><a href="_k_s_foundation__host_8c.html#ac684dc36c2bed149a44b5a28bd599f84">minseqbusbar_t</a></div><div class="ttdeci">int minseqbusbar_t</div></div>
<div class="ttc" id="struct_k_s___s_a_r_html_a3c77a7baa865a44ae8c49c408f42a5d9"><div class="ttname"><a href="struct_k_s___s_a_r.html#a3c77a7baa865a44ae8c49c408f42a5d9">KS_SAR::b1rms</a></div><div class="ttdeci">double b1rms</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1168</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a753f71c73d8169393fcbe8a9b3f4d2c2"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a753f71c73d8169393fcbe8a9b3f4d2c2">KS_GRADRFCTRL::rfptr</a></div><div class="ttdeci">KS_RF * rfptr[KS_MAXUNIQUE_RF]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:815</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_afd953f31b866a09e0418967c2bf65a59"><div class="ttname"><a href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a></div><div class="ttdeci">#define KS_NOTSET</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:60</div></div>
<div class="ttc" id="struct_k_s___s_a_r_html_a2e50537b138c27e2e30e8d3a568fbee0"><div class="ttname"><a href="struct_k_s___s_a_r.html#a2e50537b138c27e2e30e8d3a568fbee0">KS_SAR::average</a></div><div class="ttdeci">double average</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1165</div></div>
<div class="ttc" id="struct_k_s___r_f_html_ae183c3e4095d1c6d14b3d59a0da97928"><div class="ttname"><a href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">KS_RF::rfpulse</a></div><div class="ttdeci">RF_PULSE rfpulse</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:797</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a576774535b3b72525cf3821a0ded5124"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a576774535b3b72525cf3821a0ded5124">KS_GRADRFCTRL::numtrap</a></div><div class="ttdeci">int numtrap</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:818</div></div>
<div class="ttc" id="struct_k_s___s_a_r_html_a2ce680a3ce053dc060c5616496615726"><div class="ttname"><a href="struct_k_s___s_a_r.html#a2ce680a3ce053dc060c5616496615726">KS_SAR::coil</a></div><div class="ttdeci">double coil</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1166</div></div>
<div class="ttc" id="struct_k_s___s_e_q___h_a_n_d_l_e_html_a750b5d744c39a06bfb13e6eb010e35d0"><div class="ttname"><a href="struct_k_s___s_e_q___h_a_n_d_l_e.html#a750b5d744c39a06bfb13e6eb010e35d0">KS_SEQ_HANDLE::index</a></div><div class="ttdeci">int index</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:836</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a5af9f3a7de19e7493ce64776bd8f3556"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a5af9f3a7de19e7493ce64776bd8f3556">KS_SEQ_CONTROL::nseqinstances</a></div><div class="ttdeci">int nseqinstances</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:982</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n_html_a8ab39b275ee333fc1e568a0994db98d1"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">KS_SEQ_COLLECTION::seqctrlptr</a></div><div class="ttdeci">KS_SEQ_CONTROL * seqctrlptr[KS_MAXUNIQUE_SEQUENCES]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1155</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_ad1471d1cbc5ed7e8b1bc9d0987bf6eed"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ad1471d1cbc5ed7e8b1bc9d0987bf6eed">KS_GRADRFCTRL::numrf</a></div><div class="ttdeci">int numrf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:816</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_acf397088ddce91c4fc821e59fa0a321d"><div class="ttname"><a href="_k_s_foundation__host_8c.html#acf397088ddce91c4fc821e59fa0a321d">ks_eval_makegradpulse</a></div><div class="ttdeci">GRAD_PULSE ks_eval_makegradpulse(KS_TRAP *trp, int gradchoice)</div><div class="ttdoc">(Internal use) Creates a GRAD_PULSE struct from a KS_TRAP object</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:2881</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a2573e18f36ab5c3d3fc97072edcfab16"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">KS_SEQ_CONTROL::gradrf</a></div><div class="ttdeci">KS_GRADRFCTRL gradrf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:992</div></div>
<div class="ttc" id="ksepi_8e_html_ab5adb9efc118dc1cc8a0dc3c32cb73bf"><div class="ttname"><a href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a></div><div class="ttdeci">KS_SEQ_COLLECTION seqcollection</div><div class="ttdef"><b>Definition:</b> ksepi.e:79</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a218dab0fa00815bec264cb1170a615ef"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a218dab0fa00815bec264cb1170a615ef">KS_GRADRFCTRL::trapptr</a></div><div class="ttdeci">KS_TRAP * trapptr[KS_MAXUNIQUE_TRAP]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:817</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_acb5bc476c9416f2a3d9c975dd80fbb23"><div class="ttname"><a href="_k_s_foundation__host_8c.html#acb5bc476c9416f2a3d9c975dd80fbb23">ks_eval_rf_relink</a></div><div class="ttdeci">void ks_eval_rf_relink(KS_RF *rf)</div><div class="ttdoc">(Internal use) Relinks pointers between fields in a KS_RF object</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:1515</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a0dd6f20330fb1abf528ca46f34299f7c"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a0dd6f20330fb1abf528ca46f34299f7c">KS_SEQ_CONTROL::handle</a></div><div class="ttdeci">KS_SEQ_HANDLE handle</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:991</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a56efa525b924da4c53e3fde2cab60717"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a56efa525b924da4c53e3fde2cab60717">minseqcable_t</a></div><div class="ttdeci">int minseqcable_t</div></div>
<div class="ttc" id="struct_k_s___s_a_r_html_aa7fd5e56ed5028cc63702f999df5cbfd"><div class="ttname"><a href="struct_k_s___s_a_r.html#aa7fd5e56ed5028cc63702f999df5cbfd">KS_SAR::peak</a></div><div class="ttdeci">double peak</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1167</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n_html_a65c4aa433169274a52c448793e82e12e"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a65c4aa433169274a52c448793e82e12e">KS_SEQ_COLLECTION::numseq</a></div><div class="ttdeci">int numseq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1149</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af38e51235c90bff510cae4ee1955dd95"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af38e51235c90bff510cae4ee1955dd95">&#9670;&nbsp;</a></span>ks_eval_mintr()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_eval_mintr </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nslices</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html">KS_SEQ_COLLECTION</a> *&#160;</td>
          <td class="paramname"><em>seqcollection</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>gheatfact</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int(*)(int, int, void **)&#160;</td>
          <td class="paramname"><em>play_loop</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nargs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void **&#160;</td>
          <td class="paramname"><em>args</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the minimum TR based on the content of a slice loop, adding additional time due to SAR and hardware constraints if necessary</h4>
</p>
<p>This function relies on the existence of a slice loop (wrapper) function that can be run on both HOST and TGT. In addition, it needs a <a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html" title="Collection handle of all sequence modules involved in the pulse sequence, used for RF scaling...">KS_SEQ_COLLECTION</a> struct containing references to the sequence modules (<a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a>) used in the slice loop. <a class="el" href="_k_s_foundation_8h.html#af38e51235c90bff510cae4ee1955dd95" title="Returns the minimum TR based on the content of a slice loop, adding additional time due to SAR and ha...">ks_eval_mintr()</a> will call the slice loop, passed in as a function pointer, with <em>nslices</em> as the first argument.</p>
<p>Different psds have different arguments to their slice loop function depending on what is needed to know for the particular sequence, but a standardized argument list of the sliceloop function is required to allow it to be passed in to <a class="el" href="_k_s_foundation_8h.html#af38e51235c90bff510cae4ee1955dd95" title="Returns the minimum TR based on the content of a slice loop, adding additional time due to SAR and ha...">ks_eval_mintr()</a>. Therefore, a small wrapper function is likely needed for the psd's sliceloop. Moreover, the sliceloop function must return the time in [us] (int) corresponding to the duration to play out the slice loop for <em>nslices</em> number of slices. E.g. if there is a psd specific function </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> mysliceloop(<span class="keywordtype">int</span> nslices, <span class="keywordtype">int</span> ky, <span class="keywordtype">int</span> exc, <span class="keywordtype">float</span> somecustominfo) {</div><div class="line">   <span class="keywordtype">int</span> time = 0;</div><div class="line"></div><div class="line">   <span class="keywordflow">for</span> (i = 0; i &lt; nslices; i++) {</div><div class="line">      time += <a class="code" href="_k_s_foundation_8h.html#a02e188307a4bd9dfdb00d37688c0487e">ks_scan_playsequence</a>(&amp;fatsatseqctrl); <span class="comment">// play the fatsat sequence module, and count up fatsatseqctrl.nseqinstances by 1</span></div><div class="line">      time += <a class="code" href="_k_s_foundation_8h.html#a02e188307a4bd9dfdb00d37688c0487e">ks_scan_playsequence</a>(&amp;mymainseqctrl); <span class="comment">// play the main sequence, and count up mymainseqctrl.nseqinstances by 1</span></div><div class="line">   }</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> time; <span class="comment">// return the duration of the sliceloop given &#39;nslices&#39; slices.</span></div><div class="line">               <span class="comment">// This time is used to set the scan clock, while the .nseqinstances and .duration fields of each seqctrl struct</span></div><div class="line">               <span class="comment">// is used by ks_eval_gradrflimits() and ks_eval_mintr() to determine the total duration. .nseqinstances must be</span></div><div class="line">               <span class="comment">// known to calculate SAR in order to get the correct number of RF pulses for the slice loop via seqctrl.gradrf.rfptr[]</span></div><div class="line">}</div></div><!-- fragment --><p>there should be a wrapper function with the following fixed input args:</p><ol type="1">
<li>nslices</li>
<li>nargs (number of extra arguments)</li>
<li>args (pointer to array of <code>(void *)</code> for the <em>nargs</em> extra arguments)</li>
</ol>
<p>The most important argument is <em>nslices</em>, which must be passed to <code>mysliceloop()</code> so that different times are returned for different <em>nslices</em>. Hence, <code>mysliceloop()</code> must also have <em>nslices</em> as an input argument.</p>
<h4>Scenario 1:</h4>
<p>If the remaining arguments to <code>mysliceloop()</code> (like <em>ky</em>, <em>exc</em>, <em>somecustominfo</em>) do <b>not</b> affect the sequence timing, the sliceloop wrapper function can be written as (using mysliceloop() above): </p><div class="fragment"><div class="line"> <span class="keywordtype">int</span> mysliceloop_nargs(<span class="keywordtype">int</span> nslices, <span class="keywordtype">int</span> nargs, <span class="keywordtype">void</span> **args) {</div><div class="line"></div><div class="line">    mysliceloop(nslices, 0, 0, 0.0); <span class="comment">// args 2-4 are set to 0 since ky, exc, or somecustominfo do not change the sliceloop timing and we will</span></div><div class="line">                                     <span class="comment">// only evaluate this on HOST where we are dry-running the sliceloop for timing reasons</span></div><div class="line"></div><div class="line">}</div></div><!-- fragment --><h4>Scenario 2:</h4>
<p>If some of the remaining arguments to <code>mysliceloop()</code> (like <em>ky</em>, <em>exc</em>, <em>somecustominfo</em>) affect the sequence timing, the sliceloop wrapper function can be written as (using mysliceloop() above): </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> mysliceloop_nargs(<span class="keywordtype">int</span> nslices, <span class="keywordtype">int</span> nargs, <span class="keywordtype">void</span> **args) {</div><div class="line">  <span class="keywordtype">int</span> ky = 0;</div><div class="line">  <span class="keywordtype">int</span> exc = 0;</div><div class="line">  <span class="keywordtype">float</span> somecustominfo = 0;</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (nargs &gt;= 1 &amp;&amp; args[0] != NULL) {</div><div class="line">    ky = *((<span class="keywordtype">int</span> *) args[0]); <span class="comment">// cast from (void *) to (int *) and dereference</span></div><div class="line">  }</div><div class="line">  <span class="keywordflow">if</span> (nargs &gt;= 2 &amp;&amp; args[1] != NULL) {</div><div class="line">    exc = *((<span class="keywordtype">int</span> *) args[1]); <span class="comment">// cast from (void *) to (int *) and dereference</span></div><div class="line">  }</div><div class="line">  <span class="keywordflow">if</span> (nargs &gt;= 3 &amp;&amp; args[2] != NULL) {</div><div class="line">    somecustominfo = *((<span class="keywordtype">float</span> *) args[2]); <span class="comment">// cast from (void *) to (float *) and dereference</span></div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> mysliceloop(nslices, ky, exc, somecustominfo);</div><div class="line">}</div></div><!-- fragment --><p>For scenario #2, <em>nargs</em> and <em>args</em> must be set up before calling <a class="el" href="_k_s_foundation_8h.html#af38e51235c90bff510cae4ee1955dd95" title="Returns the minimum TR based on the content of a slice loop, adding additional time due to SAR and ha...">ks_eval_mintr()</a>, e.g. like: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> *args[] = {(<span class="keywordtype">void</span> *) &amp;ky,</div><div class="line">                (<span class="keywordtype">void</span> *) &amp;exc,</div><div class="line">                (<span class="keywordtype">void</span> *) &amp;somecustominfo}; <span class="comment">// pass on the args to mysliceloop() via mysliceloop_nargs()</span></div><div class="line"><span class="keywordtype">int</span> nargs = <span class="keyword">sizeof</span>(args) / <span class="keyword">sizeof</span>(<span class="keywordtype">void</span> *);</div><div class="line"></div><div class="line"><a class="code" href="_k_s_foundation_8h.html#af38e51235c90bff510cae4ee1955dd95">ks_eval_mintr</a>(nslices, &amp;<a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>, mysliceloop_nargs, nargs, args);</div></div><!-- fragment --><h4>Calculation of the minimum TR in three steps using <a class="el" href="_k_s_foundation_8h.html#af38e51235c90bff510cae4ee1955dd95" title="Returns the minimum TR based on the content of a slice loop, adding additional time due to SAR and ha...">ks_eval_mintr()</a>:</h4>
<ol type="1">
<li>Set the <code>.nseqinstances</code> field to 0 for all <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> structs being a part of the <a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html" title="Collection handle of all sequence modules involved in the pulse sequence, used for RF scaling...">KS_SEQ_COLLECTION</a> using <a class="el" href="_k_s_foundation_8h.html#acb34cd9d6c99193829696596b4d0271f" title="Set the .nseqinstances field of each sequence module (KS_SEQ_CONTROL) equal to 0">ks_eval_seqcollection_resetninst()</a></li>
<li>Run the slice loop (wrapper) function for the psd (see above) passed in as a function pointer. This will set the <code>.nseqinstances</code> field for each sequence module equal to the number of playouts of that sequence module in the slice loop</li>
<li>Call <a class="el" href="_k_s_foundation_8h.html#ab4c6e9f82b55a3db56765fc22f21b7b5" title="Returns the time required to play out a certain number of sequence modules over some interval...">ks_eval_gradrflimits()</a>, which will<ul>
<li>use the <code>.nseqinstances</code> and <code>.duration</code> fields of each sequence module to determine the total net duration for the given number of slices</li>
<li>add potential extra time to keep us within SAR and hardware limits</li>
</ul>
</li>
</ol>
<p>The return value of <a class="el" href="_k_s_foundation_8h.html#ab4c6e9f82b55a3db56765fc22f21b7b5" title="Returns the time required to play out a certain number of sequence modules over some interval...">ks_eval_gradrflimits()</a> is also the return value of <a class="el" href="_k_s_foundation_8h.html#af38e51235c90bff510cae4ee1955dd95" title="Returns the minimum TR based on the content of a slice loop, adding additional time due to SAR and ha...">ks_eval_mintr()</a></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">nslices</td><td>Number of slices to play out in the slice loop </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">seqcollection</td><td>A <a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html" title="Collection handle of all sequence modules involved in the pulse sequence, used for RF scaling...">KS_SEQ_COLLECTION</a> struct, which have undergone a reset of <code>seqctlptr[].nseqinstances</code> followed by a single run of the sequence's slice loop or equivalent period </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gheatfact</td><td>Experimental fudge factor in range [0.0, 1.0] to control how much to obey the gradient heating calculations using the old gradient heating model. It is up to the EPIC programmer to set this to a proper value for now. This input argument can hopefully be removed in the future </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">play_loop</td><td>Function pointer to the sliceloop (wrapper) function of the sequence. This function should perform all time consuming tasks for one TR. It is a requirement that this function has three input arguments: <code>int nslices, int nargs, void **args</code> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nargs</td><td>Number of extra arguments to the slice loop wrapper function. This can be 0 if the slice loop is only temporally dependent on <em>nslices</em> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">args</td><td>void * pointer array to extra arguments. This can be NULL if the slice loop is temporally dependent only on <em>nslices</em> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">int</td><td>Minimum time in[us] that is needed to safetly play out the <code>.nseqinstances</code> sequence modules over the intended interval (usually one <em>TR</em> for 2D sequences) </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;                                                                                                                                                     {</div><div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;</div><div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;  <span class="comment">/* must be run before each call to function pointer `play_loop()` to set all `seqctrl.nseqinstances` to 0 */</span></div><div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#acb34cd9d6c99193829696596b4d0271f">ks_eval_seqcollection_resetninst</a>(<a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>);</div><div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;</div><div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;  play_loop(nslices, nargs, args); <span class="comment">/* =&gt; seqctrl.nseqinstances = # times each seq. module has been played out */</span></div><div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;</div><div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__host_8c.html#ab4c6e9f82b55a3db56765fc22f21b7b5">ks_eval_gradrflimits</a>(NULL, <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>, gheatfact);</div><div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;</div><div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;} <span class="comment">/* ks_eval_mintr() */</span></div><div class="ttc" id="ksepi_8e_html_ab5adb9efc118dc1cc8a0dc3c32cb73bf"><div class="ttname"><a href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a></div><div class="ttdeci">KS_SEQ_COLLECTION seqcollection</div><div class="ttdef"><b>Definition:</b> ksepi.e:79</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_ab4c6e9f82b55a3db56765fc22f21b7b5"><div class="ttname"><a href="_k_s_foundation__host_8c.html#ab4c6e9f82b55a3db56765fc22f21b7b5">ks_eval_gradrflimits</a></div><div class="ttdeci">int ks_eval_gradrflimits(KS_SAR *sar, KS_SEQ_COLLECTION *seqcollection, float gheatfact)</div><div class="ttdoc">Returns the time required to play out a certain number of sequence modules over some interval...</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3014</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_acb34cd9d6c99193829696596b4d0271f"><div class="ttname"><a href="_k_s_foundation__host_8c.html#acb34cd9d6c99193829696596b4d0271f">ks_eval_seqcollection_resetninst</a></div><div class="ttdeci">void ks_eval_seqcollection_resetninst(KS_SEQ_COLLECTION *seqcollection)</div><div class="ttdoc">Set the .nseqinstances field of each sequence module (KS_SEQ_CONTROL) equal to 0</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3235</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a86ab45a04531e1e9353667c9ca6d5fbd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a86ab45a04531e1e9353667c9ca6d5fbd">&#9670;&nbsp;</a></span>ks_eval_maxslicespertr()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_eval_maxslicespertr </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>TR</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html">KS_SEQ_COLLECTION</a> *&#160;</td>
          <td class="paramname"><em>seqcollection</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>gheatfact</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int(*)(int, int, void **)&#160;</td>
          <td class="paramname"><em>play_loop</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nargs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void **&#160;</td>
          <td class="paramname"><em>args</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the maximum number of slices that can be played out in one TR, honoring SAR and hardware constraints</h4>
</p>
<p>The maximum numbers of slices per TR is determined by calling <a class="el" href="_k_s_foundation_8h.html#af38e51235c90bff510cae4ee1955dd95" title="Returns the minimum TR based on the content of a slice loop, adding additional time due to SAR and ha...">ks_eval_mintr()</a> with an increasing number of slices until the input TR value is reached</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">TR</td><td>Repetition time in [us] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">seqcollection</td><td>A <a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html" title="Collection handle of all sequence modules involved in the pulse sequence, used for RF scaling...">KS_SEQ_COLLECTION</a> struct, which have undergone a reset of <code>seqctlptr[].nseqinstances</code> followed by a single run of the sequence's slice loop or equivalent period </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gheatfact</td><td>Experimental fudge factor in range [0.0, 1.0] to control how much to obey the gradient heating calculations using the old gradient heating model. It is up to the EPIC programmer to set this to a proper value for now. This input argument can hopefully be removed in the future </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">play_loop</td><td>Function pointer to the sliceloop (wrapper) function of the sequence. This function should perform all time consuming tasks for one TR. It is a requirement that this function has three input arguments: <code>int nslices, int nargs, void **args</code> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nargs</td><td>Number of extra arguments to the slice loop wrapper function. This can be 0 if the slice loop is only temporally dependent on <em>nslices</em> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">args</td><td>void * pointer array to extra arguments. This can be NULL if the slice loop is temporally dependent only on <em>nslices</em> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">int</td><td>Maximum number of slices that can fit in one TR </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;                                                                                                    {</div><div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;  <span class="keywordtype">int</span> max_slquant1 = 0;</div><div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;  <span class="keywordtype">int</span> i, acqtime;</div><div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;  <span class="keywordflow">for</span> (i = 1; i &lt; 1024; i++) {</div><div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;</div><div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;    acqtime = <a class="code" href="_k_s_foundation__host_8c.html#af38e51235c90bff510cae4ee1955dd95">ks_eval_mintr</a>(i, <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>, gheatfact, play_loop, nargs, args);</div><div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;</div><div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;    <span class="keywordflow">if</span> (acqtime == <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>) {</div><div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>;</div><div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;    }</div><div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;    <span class="keywordflow">if</span> (acqtime &gt; TR) {</div><div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;      <span class="keywordflow">return</span> max_slquant1;</div><div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;    }</div><div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;    max_slquant1 = i;</div><div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;  }</div><div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;</div><div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;  <span class="keywordflow">return</span> max_slquant1;</div><div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_afd953f31b866a09e0418967c2bf65a59"><div class="ttname"><a href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a></div><div class="ttdeci">#define KS_NOTSET</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:60</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_af38e51235c90bff510cae4ee1955dd95"><div class="ttname"><a href="_k_s_foundation__host_8c.html#af38e51235c90bff510cae4ee1955dd95">ks_eval_mintr</a></div><div class="ttdeci">int ks_eval_mintr(int nslices, KS_SEQ_COLLECTION *seqcollection, float gheatfact, int(*play_loop)(int, int, void **), int nargs, void **args)</div><div class="ttdoc">Returns the minimum TR based on the content of a slice loop, adding additional time due to SAR and ha...</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3199</div></div>
<div class="ttc" id="ksepi_8e_html_ab5adb9efc118dc1cc8a0dc3c32cb73bf"><div class="ttname"><a href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a></div><div class="ttdeci">KS_SEQ_COLLECTION seqcollection</div><div class="ttdef"><b>Definition:</b> ksepi.e:79</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a75c403072633f5a42fe364af4454b245"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a75c403072633f5a42fe364af4454b245">&#9670;&nbsp;</a></span>ks_eval_seqctrl_setminduration()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_seqctrl_setminduration </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>seqctrl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>mindur</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets the minimum duration and duration fields of a <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> struct based on some minimum time (arg 2)</h4>
</p>
<p>It is recommended that this function is put at the end of the sequence generating function for the current sequence module (c.f. <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a>), e.g. <em>mypsd</em>_pg(), which is a point where one knows how long the pulse sequence is, as the last gradient or RF waveform has been placed out. After passing the known minimum allowed sequence module duration as arg2 to <a class="el" href="_k_s_foundation_8h.html#a75c403072633f5a42fe364af4454b245" title="Sets the minimum duration and duration fields of a KS_SEQ_CONTROL struct based on some minimum time (...">ks_eval_seqctrl_setminduration()</a>, <em>both</em> <code>seqctrl.duration</code> and `seqctrl.min_duration are set to this minimum value + the SSI time for the sequence module (which must be &gt; 0 before calling this function).</p>
<p>This function is only available on HOST for the reason that the <code>.duration</code> field should not be reset to the minimum duration on TGT. The recommended order of events is the following:</p>
<ol type="1">
<li>In <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code> on HOST: Call <em>mypsd</em>_pg(). Having the <a class="el" href="_k_s_foundation_8h.html#a75c403072633f5a42fe364af4454b245" title="Sets the minimum duration and duration fields of a KS_SEQ_CONTROL struct based on some minimum time (...">ks_eval_seqctrl_setminduration()</a> call at the end of <em>mypsd</em>_pg(), with the second argument (minimum duration) set to the absolute time corresponding to the last waveform, it is assured that both <code>seqctrl.duration</code> (which can grow bigger later) and <code>seqctrl.min_duration</code> (which should not be modified later) is equal to the same minimum possible value at this point. <div class="fragment"><div class="line"><span class="preprocessor">#ifndef IPG // make it explicit that this function is to be called only on HOST (not IPG)</span></div><div class="line"> <span class="comment">// ...end of mypsd_pg()...</span></div><div class="line"> <span class="comment">// N.B.: .seqctrl.ssi_time must be &gt; 0 before calling ks_eval_seqctrl_setminduration()</span></div><div class="line"> <a class="code" href="_k_s_foundation_8h.html#a75c403072633f5a42fe364af4454b245">ks_eval_seqctrl_setminduration</a>(&amp;<a class="code" href="ksfse__implementation_8e.html#a9c3ae9d44addcef6a9e09b7db6679baf">ksfse</a>.<a class="code" href="struct_k_s_f_s_e___s_e_q_u_e_n_c_e.html#acd34da9660251c2abb551f0efdd20368">seqctrl</a>, tmploc.pos); <span class="comment">// tmploc.pos now corresponds to the end of last gradient in the sequence</span></div><div class="line"><span class="preprocessor">#endif</span></div></div><!-- fragment --></li>
<li>In <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code> on HOST, after the <em>mypsd</em>_pg() call: Do some TR timing calculations and increase the <code>seqctrl.duration</code> field(s) for one or more sequence modules to fill up to the intended TR. The reasons for why <code>seqctrl.duration</code> needs to be larger than <code>seqctrl.min_duration</code> could be either that the TR is larger than the minimum possible by the waveforms, and/or that SAR or hardware constraints (reported back by <a class="el" href="_k_s_foundation_8h.html#af38e51235c90bff510cae4ee1955dd95" title="Returns the minimum TR based on the content of a slice loop, adding additional time due to SAR and ha...">ks_eval_mintr()</a>) mandates that additional time must be added to the sequence to honor these limits.</li>
<li>In <code><a class="el" href="ksepi_8e.html#a9229731c099971b90dbf7721bad586a9">pulsegen()</a></code> on TGT (IPG): The <em>mypsd</em>_pg() function is called to place out the actual hardware waveforms, followed by the "sequence ending here"-call to <a class="el" href="_g_e_required_8e.html#ab1fe30ecb27b541de01992692c1e9a47" title="Creates a hardware sequence for the current sequence module">KS_SEQLENGTH()</a>, which is using <code>seqctrl.duration</code> to determine the length of the sequence module. As efforts have been made on HOST to set <code>seqctrl.duration</code>, we cannot have <a class="el" href="_k_s_foundation_8h.html#a75c403072633f5a42fe364af4454b245" title="Sets the minimum duration and duration fields of a KS_SEQ_CONTROL struct based on some minimum time (...">ks_eval_seqctrl_setminduration()</a> to reset it again on TGT when <em>mypsd</em>_pg() is called. Hence this is why <a class="el" href="_k_s_foundation_8h.html#a75c403072633f5a42fe364af4454b245" title="Sets the minimum duration and duration fields of a KS_SEQ_CONTROL struct based on some minimum time (...">ks_eval_seqctrl_setminduration()</a> is only accessible on HOST</li>
</ol>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">seqctrl</td><td>Pointer to <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> struct for the current sequence module </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">mindur</td><td>mindur + <code>.ssi_time</code> =&gt; <code>.min_duration</code> = <code>.duration @retval STATUS</code>SUCCESS<code>or</code>FAILURE` </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;                                                                           {</div><div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;<span class="preprocessor">#ifndef IPG</span></div><div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;  <span class="comment">/* only do this on HOST */</span></div><div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;</div><div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;  <span class="keywordflow">if</span> (seqctrl == NULL) {</div><div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: arg 1 is NULL&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mindur &gt; 0 &amp;&amp; seqctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6037d68ff7b6f66735a92611628df57">ssi_time</a> &lt;= 0) {</div><div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: %s - seqctrl.ssi_time must be &gt; 0 before setting minimum duration&quot;</span>, __FUNCTION__, seqctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mindur &gt; 0 &amp;&amp; seqctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6037d68ff7b6f66735a92611628df57">ssi_time</a> % 4) {</div><div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: %s - seqctrl.ssi_time must be divisible by GRAD_UPDATE_TIME&quot;</span>, __FUNCTION__, seqctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mindur &lt; 0) {</div><div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: %s - min duration (arg 2) must be &gt;= 0&quot;</span>, __FUNCTION__, seqctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mindur % 4) {</div><div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: %s - min duration (arg 2) must be divisible by GRAD_UPDATE_TIME&quot;</span>, __FUNCTION__, seqctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;    <span class="keywordflow">if</span> (mindur == 0) {</div><div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;      seqctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a901ce6fe6b2fa774dc95ea6bab219bd0">min_duration</a> = 0;</div><div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;      <span class="comment">/* we add 4us (GRAD_UPDATE_TIME) to avoid waveform-after-seqcore errors */</span></div><div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;      seqctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a901ce6fe6b2fa774dc95ea6bab219bd0">min_duration</a> = RUP_GRD(mindur + seqctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6037d68ff7b6f66735a92611628df57">ssi_time</a> + GRAD_UPDATE_TIME);</div><div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;    }</div><div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;    seqctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> = seqctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a901ce6fe6b2fa774dc95ea6bab219bd0">min_duration</a>;</div><div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;  }</div><div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;</div><div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160; <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_SEQ_CONTROL::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:984</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a901ce6fe6b2fa774dc95ea6bab219bd0"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a901ce6fe6b2fa774dc95ea6bab219bd0">KS_SEQ_CONTROL::min_duration</a></div><div class="ttdeci">int min_duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:981</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_ac6037d68ff7b6f66735a92611628df57"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6037d68ff7b6f66735a92611628df57">KS_SEQ_CONTROL::ssi_time</a></div><div class="ttdeci">int ssi_time</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:983</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">KS_SEQ_CONTROL::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:990</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a607b7d799ca95db1431027fe74b4586b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a607b7d799ca95db1431027fe74b4586b">&#9670;&nbsp;</a></span>ks_eval_seqctrl_setduration()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_seqctrl_setduration </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>seqctrl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dur</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets the <code>.duration</code> field of the sequence module (<a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a>), while checking that the input value is not less than <code>.min_duration</code></h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">seqctrl</td><td>Pointer to <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> struct for the current sequence module </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dur</td><td>Desired duration of the current sequence module (including its SSI time, <code>.ssi_time</code>) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;                                                                     {</div><div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;<span class="preprocessor">#ifndef IPG</span></div><div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;  <span class="comment">/* only do this on HOST */</span></div><div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;</div><div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;  <span class="keywordflow">if</span> (seqctrl == NULL) {</div><div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: arg 1 is NULL&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dur &lt; seqctrl-&gt;min_duration) {</div><div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: duration (arg 2) must be &gt;= min duration (%d&quot;</span>, __FUNCTION__, seqctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a901ce6fe6b2fa774dc95ea6bab219bd0">min_duration</a>);</div><div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;    seqctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> = RUP_GRD(dur);</div><div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;  }</div><div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;</div><div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160; <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_SEQ_CONTROL::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:984</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a901ce6fe6b2fa774dc95ea6bab219bd0"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a901ce6fe6b2fa774dc95ea6bab219bd0">KS_SEQ_CONTROL::min_duration</a></div><div class="ttdeci">int min_duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:981</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab5e4f217425665a562737662e46f1ba1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab5e4f217425665a562737662e46f1ba1">&#9670;&nbsp;</a></span>ks_eval_seqcollection_durations_setminimum()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_seqcollection_durations_setminimum </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html">KS_SEQ_COLLECTION</a> *&#160;</td>
          <td class="paramname"><em>seqcollection</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets the <code>.duration</code> fields of all sequence modules being part of the sequence collection (<a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html" title="Collection handle of all sequence modules involved in the pulse sequence, used for RF scaling...">KS_SEQ_COLLECTION</a>) to their <code>.min_duration</code> value</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">seqcollection</td><td>Pointer to <a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html" title="Collection handle of all sequence modules involved in the pulse sequence, used for RF scaling...">KS_SEQ_COLLECTION</a> struct holding pointers to all sequence modules </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;                                                                                    {</div><div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;<span class="preprocessor">#ifndef IPG</span></div><div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;  <span class="comment">/* only do this on HOST */</span></div><div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;</div><div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160; <span class="keywordtype">int</span> i;</div><div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a> != NULL) {</div><div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a65c4aa433169274a52c448793e82e12e">numseq</a>; i++) {</div><div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">seqctrlptr</a>[i]-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a901ce6fe6b2fa774dc95ea6bab219bd0">min_duration</a> % 4) {</div><div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: Field min_duration for sequence module #%d is not divisible by GRAD_UPDATE_TIME&quot;</span>, __FUNCTION__, i);</div><div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;      }</div><div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;      <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">seqctrlptr</a>[i]-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> = <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">seqctrlptr</a>[i]-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a901ce6fe6b2fa774dc95ea6bab219bd0">min_duration</a>;</div><div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;    }</div><div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;  }</div><div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;</div><div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_SEQ_CONTROL::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:984</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n_html_a8ab39b275ee333fc1e568a0994db98d1"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">KS_SEQ_COLLECTION::seqctrlptr</a></div><div class="ttdeci">KS_SEQ_CONTROL * seqctrlptr[KS_MAXUNIQUE_SEQUENCES]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1155</div></div>
<div class="ttc" id="ksepi_8e_html_ab5adb9efc118dc1cc8a0dc3c32cb73bf"><div class="ttname"><a href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a></div><div class="ttdeci">KS_SEQ_COLLECTION seqcollection</div><div class="ttdef"><b>Definition:</b> ksepi.e:79</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a901ce6fe6b2fa774dc95ea6bab219bd0"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a901ce6fe6b2fa774dc95ea6bab219bd0">KS_SEQ_CONTROL::min_duration</a></div><div class="ttdeci">int min_duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:981</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n_html_a65c4aa433169274a52c448793e82e12e"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a65c4aa433169274a52c448793e82e12e">KS_SEQ_COLLECTION::numseq</a></div><div class="ttdeci">int numseq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1149</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3de8410411e4caddbabb57b40fc3abe1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3de8410411e4caddbabb57b40fc3abe1">&#9670;&nbsp;</a></span>ks_eval_seqcollection_durations_atleastminimum()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_seqcollection_durations_atleastminimum </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html">KS_SEQ_COLLECTION</a> *&#160;</td>
          <td class="paramname"><em>seqcollection</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Assures the <code>.duration</code> fields of all sequence modules being part of the sequence collection (<a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html" title="Collection handle of all sequence modules involved in the pulse sequence, used for RF scaling...">KS_SEQ_COLLECTION</a>) are at least their <code>.min_duration</code> value</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">seqcollection</td><td>Pointer to <a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html" title="Collection handle of all sequence modules involved in the pulse sequence, used for RF scaling...">KS_SEQ_COLLECTION</a> struct holding pointers to all sequence modules </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;                                                                                        {</div><div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;<span class="preprocessor">#ifndef IPG</span></div><div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;  <span class="comment">/* only do this on HOST */</span></div><div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;</div><div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160; <span class="keywordtype">int</span> i;</div><div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a> != NULL) {</div><div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a65c4aa433169274a52c448793e82e12e">numseq</a>; i++) {</div><div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">seqctrlptr</a>[i]-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a901ce6fe6b2fa774dc95ea6bab219bd0">min_duration</a> % 4) {</div><div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: Field min_duration for sequence module #%d is not divisible by GRAD_UPDATE_TIME&quot;</span>, __FUNCTION__, i);</div><div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;      }</div><div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">seqctrlptr</a>[i]-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> &lt; <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">seqctrlptr</a>[i]-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a901ce6fe6b2fa774dc95ea6bab219bd0">min_duration</a>) {</div><div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;        <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">seqctrlptr</a>[i]-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> = <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">seqctrlptr</a>[i]-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a901ce6fe6b2fa774dc95ea6bab219bd0">min_duration</a>;</div><div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;      }</div><div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;    }</div><div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;  }</div><div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;</div><div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_SEQ_CONTROL::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:984</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n_html_a8ab39b275ee333fc1e568a0994db98d1"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">KS_SEQ_COLLECTION::seqctrlptr</a></div><div class="ttdeci">KS_SEQ_CONTROL * seqctrlptr[KS_MAXUNIQUE_SEQUENCES]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1155</div></div>
<div class="ttc" id="ksepi_8e_html_ab5adb9efc118dc1cc8a0dc3c32cb73bf"><div class="ttname"><a href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a></div><div class="ttdeci">KS_SEQ_COLLECTION seqcollection</div><div class="ttdef"><b>Definition:</b> ksepi.e:79</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a901ce6fe6b2fa774dc95ea6bab219bd0"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a901ce6fe6b2fa774dc95ea6bab219bd0">KS_SEQ_CONTROL::min_duration</a></div><div class="ttdeci">int min_duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:981</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n_html_a65c4aa433169274a52c448793e82e12e"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a65c4aa433169274a52c448793e82e12e">KS_SEQ_COLLECTION::numseq</a></div><div class="ttdeci">int numseq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1149</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="acb34cd9d6c99193829696596b4d0271f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acb34cd9d6c99193829696596b4d0271f">&#9670;&nbsp;</a></span>ks_eval_seqcollection_resetninst()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_eval_seqcollection_resetninst </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html">KS_SEQ_COLLECTION</a> *&#160;</td>
          <td class="paramname"><em>seqcollection</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Set the <code>.nseqinstances</code> field of each sequence module (<a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a>) equal to 0</h4>
</p>
<p>This function is called in <a class="el" href="_k_s_foundation_8h.html#af38e51235c90bff510cae4ee1955dd95" title="Returns the minimum TR based on the content of a slice loop, adding additional time due to SAR and ha...">ks_eval_mintr()</a> and <a class="el" href="_g_e_required_8e.html#a3bf65ebca3543f771e2d17799bbb0d3c">GEReq_eval_TR()</a> to reset the sequence module counters before calling the psd's scanloop function, where the <a class="el" href="_k_s_foundation_8h.html#a02e188307a4bd9dfdb00d37688c0487e">ks_scan_playsequence()</a> functions internally increment <code>.nseqinstances</code> by one every time they are called</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">seqcollection</td><td>Collection of all sequence modules (<a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html" title="Collection handle of all sequence modules involved in the pulse sequence, used for RF scaling...">KS_SEQ_COLLECTION</a>). C.f. <a class="el" href="_k_s_foundation_8h.html#a9c627057bb753177d7b74e5cd9ba1a46" title="Adds a sequence module (KS_SEQ_CONTROL) to the KS_SEQ_COLLECTION struct for later RF scaling and SAR ...">ks_eval_addtoseqcollection()</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;                                                                        {</div><div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a> != NULL) {</div><div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a65c4aa433169274a52c448793e82e12e">numseq</a>; i++) {</div><div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;<span class="preprocessor">#ifndef IPG</span></div><div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;      <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">seqctrlptr</a>[i]-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a5af9f3a7de19e7493ce64776bd8f3556">nseqinstances</a> = 0;</div><div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;    }</div><div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;  }</div><div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;</div><div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;}</div><div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a5af9f3a7de19e7493ce64776bd8f3556"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a5af9f3a7de19e7493ce64776bd8f3556">KS_SEQ_CONTROL::nseqinstances</a></div><div class="ttdeci">int nseqinstances</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:982</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n_html_a8ab39b275ee333fc1e568a0994db98d1"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">KS_SEQ_COLLECTION::seqctrlptr</a></div><div class="ttdeci">KS_SEQ_CONTROL * seqctrlptr[KS_MAXUNIQUE_SEQUENCES]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1155</div></div>
<div class="ttc" id="ksepi_8e_html_ab5adb9efc118dc1cc8a0dc3c32cb73bf"><div class="ttname"><a href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a></div><div class="ttdeci">KS_SEQ_COLLECTION seqcollection</div><div class="ttdef"><b>Definition:</b> ksepi.e:79</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n_html_a65c4aa433169274a52c448793e82e12e"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a65c4aa433169274a52c448793e82e12e">KS_SEQ_COLLECTION::numseq</a></div><div class="ttdeci">int numseq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1149</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac39743a45d5ad00147e24218523f88c8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac39743a45d5ad00147e24218523f88c8">&#9670;&nbsp;</a></span>ks_print_seqcollection()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_print_seqcollection </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html">KS_SEQ_COLLECTION</a> *&#160;</td>
          <td class="paramname"><em>seqcollection</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE *&#160;</td>
          <td class="paramname"><em>fp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Print out the duration of each sequence module in the sequence collection to a file pointer</h4>
Besides printing out the duration of each sequence module, it will also show the number of occurences of each sequence module each TR. However, for this to be correct <a class="el" href="_k_s_foundation_8h.html#acb34cd9d6c99193829696596b4d0271f" title="Set the .nseqinstances field of each sequence module (KS_SEQ_CONTROL) equal to 0">ks_eval_seqcollection_resetninst()</a> should first be called followed by one call to the sequence's sliceloop function to increment each .seqctrl.nseqinstances field. See e.g. <a class="el" href="_g_e_required_8e.html#a027161dabe834c55750bd1e7f2fa8473" title="Runs the slice loop and validates TR and SAR/hardware limits">GEReq_eval_checkTR_SAR()</a>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">seqcollection</td><td>Collection of all sequence modules (<a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html" title="Collection handle of all sequence modules involved in the pulse sequence, used for RF scaling...">KS_SEQ_COLLECTION</a>). C.f. <a class="el" href="_k_s_foundation_8h.html#a9c627057bb753177d7b74e5cd9ba1a46" title="Adds a sequence module (KS_SEQ_CONTROL) to the KS_SEQ_COLLECTION struct for later RF scaling and SAR ...">ks_eval_addtoseqcollection()</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fp</td><td>File pointer to file to write to </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l03621"></a><span class="lineno"> 3621</span>&#160;                                                                        {</div><div class="line"><a name="l03622"></a><span class="lineno"> 3622</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l03623"></a><span class="lineno"> 3623</span>&#160;</div><div class="line"><a name="l03624"></a><span class="lineno"> 3624</span>&#160;  <span class="comment">/* duration based on the sequence collection struct */</span></div><div class="line"><a name="l03625"></a><span class="lineno"> 3625</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;\n----------------------------------------------\n&quot;</span>);</div><div class="line"><a name="l03626"></a><span class="lineno"> 3626</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;Sequence modules in the sequence collection:\n&quot;</span>);</div><div class="line"><a name="l03627"></a><span class="lineno"> 3627</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a65c4aa433169274a52c448793e82e12e">numseq</a>; i++) {</div><div class="line"><a name="l03628"></a><span class="lineno"> 3628</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;%s: %dx %d us = %d\n&quot;</span>, <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">seqctrlptr</a>[i]-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">seqctrlptr</a>[i]-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a5af9f3a7de19e7493ce64776bd8f3556">nseqinstances</a>, <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">seqctrlptr</a>[i]-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>,</div><div class="line"><a name="l03629"></a><span class="lineno"> 3629</span>&#160;      <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">seqctrlptr</a>[i]-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a5af9f3a7de19e7493ce64776bd8f3556">nseqinstances</a> * <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">seqctrlptr</a>[i]-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>);</div><div class="line"><a name="l03630"></a><span class="lineno"> 3630</span>&#160;  }</div><div class="line"><a name="l03631"></a><span class="lineno"> 3631</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;Sum of durations: %d us\n&quot;</span>, <a class="code" href="_k_s_foundation__host_8c.html#aeb213f86f7f6172f91b3ab69a518afe7">ks_eval_seqcollection_gettotalduration</a>(<a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>));</div><div class="line"><a name="l03632"></a><span class="lineno"> 3632</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;----------------------------------------------\n\n&quot;</span>);</div><div class="line"><a name="l03633"></a><span class="lineno"> 3633</span>&#160;  fflush(fp);</div><div class="line"><a name="l03634"></a><span class="lineno"> 3634</span>&#160;</div><div class="line"><a name="l03635"></a><span class="lineno"> 3635</span>&#160;  <span class="keywordflow">return</span>;</div><div class="line"><a name="l03636"></a><span class="lineno"> 3636</span>&#160;} <span class="comment">/* ks_print_seqcollection() */</span></div><div class="ttc" id="_k_s_foundation__host_8c_html_aeb213f86f7f6172f91b3ab69a518afe7"><div class="ttname"><a href="_k_s_foundation__host_8c.html#aeb213f86f7f6172f91b3ab69a518afe7">ks_eval_seqcollection_gettotalduration</a></div><div class="ttdeci">int ks_eval_seqcollection_gettotalduration(KS_SEQ_COLLECTION *seqcollection)</div><div class="ttdoc">Returns the total duration of the sequence collection</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3248</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_SEQ_CONTROL::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:984</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a5af9f3a7de19e7493ce64776bd8f3556"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a5af9f3a7de19e7493ce64776bd8f3556">KS_SEQ_CONTROL::nseqinstances</a></div><div class="ttdeci">int nseqinstances</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:982</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n_html_a8ab39b275ee333fc1e568a0994db98d1"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">KS_SEQ_COLLECTION::seqctrlptr</a></div><div class="ttdeci">KS_SEQ_CONTROL * seqctrlptr[KS_MAXUNIQUE_SEQUENCES]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1155</div></div>
<div class="ttc" id="ksepi_8e_html_ab5adb9efc118dc1cc8a0dc3c32cb73bf"><div class="ttname"><a href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a></div><div class="ttdeci">KS_SEQ_COLLECTION seqcollection</div><div class="ttdef"><b>Definition:</b> ksepi.e:79</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">KS_SEQ_CONTROL::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:990</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n_html_a65c4aa433169274a52c448793e82e12e"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a65c4aa433169274a52c448793e82e12e">KS_SEQ_COLLECTION::numseq</a></div><div class="ttdeci">int numseq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1149</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aeb213f86f7f6172f91b3ab69a518afe7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeb213f86f7f6172f91b3ab69a518afe7">&#9670;&nbsp;</a></span>ks_eval_seqcollection_gettotalduration()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_eval_seqcollection_gettotalduration </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html">KS_SEQ_COLLECTION</a> *&#160;</td>
          <td class="paramname"><em>seqcollection</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the total duration of the sequence collection</h4>
</p>
<p>Based on the <code>seqctrl.ninstances</code> and <code>seqctrl.duration</code> fields for each <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> (sequence module) that have been added to the sequence collection struct (<a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html" title="Collection handle of all sequence modules involved in the pulse sequence, used for RF scaling...">KS_SEQ_COLLECTION</a>), this function returns the total duration of the sequence collection. No time is added to comply with SAR or hardware limits, hence this time may not be possible to use in practice. See <a class="el" href="_k_s_foundation_8h.html#af38e51235c90bff510cae4ee1955dd95" title="Returns the minimum TR based on the content of a slice loop, adding additional time due to SAR and ha...">ks_eval_mintr()</a>, <a class="el" href="_g_e_required_8e.html#a3bf65ebca3543f771e2d17799bbb0d3c">GEReq_eval_TR()</a>, and <a class="el" href="_k_s_foundation_8h.html#ab4c6e9f82b55a3db56765fc22f21b7b5" title="Returns the time required to play out a certain number of sequence modules over some interval...">ks_eval_gradrflimits()</a> for more details. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">seqcollection</td><td>Collection of all sequence modules (<a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html" title="Collection handle of all sequence modules involved in the pulse sequence, used for RF scaling...">KS_SEQ_COLLECTION</a>). C.f. <a class="el" href="_k_s_foundation_8h.html#a9c627057bb753177d7b74e5cd9ba1a46" title="Adds a sequence module (KS_SEQ_CONTROL) to the KS_SEQ_COLLECTION struct for later RF scaling and SAR ...">ks_eval_addtoseqcollection()</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">int</td><td>Time in [us] </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;                                                                             {</div><div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160; <span class="keywordtype">int</span> i;</div><div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160; <span class="keywordtype">int</span> nettime = 0;</div><div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;</div><div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;  <span class="comment">/* duration based on the sequence collection struct */</span></div><div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a65c4aa433169274a52c448793e82e12e">numseq</a>; i++) {</div><div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;<span class="comment">    if (seqcollection-&gt;seqctrlptr[i]-&gt;duration &gt; 0 &amp;&amp; seqcollection-&gt;seqctrlptr[i]-&gt;nseqinstances == 0) {</span></div><div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;<span class="comment">      ks_error(&quot;%s: Sequence module #%d was not played out in sliceloop using ks_scan_playsequence()&quot;, __FUNCTION__, i);</span></div><div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;<span class="comment">      return KS_NOTSET;</span></div><div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;<span class="comment">    }</span></div><div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;    nettime += <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">seqctrlptr</a>[i]-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> * <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">seqctrlptr</a>[i]-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a5af9f3a7de19e7493ce64776bd8f3556">nseqinstances</a>;</div><div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;  }</div><div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;</div><div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;  <span class="keywordflow">if</span> (nettime == 0) {</div><div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: Sum of durations of sequence modules used is 0&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;  }</div><div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;</div><div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;  <span class="keywordflow">return</span> nettime;</div><div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;} <span class="comment">/* ks_eval_seqcollection_gettotalduration() */</span></div><div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_SEQ_CONTROL::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:984</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a5af9f3a7de19e7493ce64776bd8f3556"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a5af9f3a7de19e7493ce64776bd8f3556">KS_SEQ_CONTROL::nseqinstances</a></div><div class="ttdeci">int nseqinstances</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:982</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n_html_a8ab39b275ee333fc1e568a0994db98d1"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">KS_SEQ_COLLECTION::seqctrlptr</a></div><div class="ttdeci">KS_SEQ_CONTROL * seqctrlptr[KS_MAXUNIQUE_SEQUENCES]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1155</div></div>
<div class="ttc" id="ksepi_8e_html_ab5adb9efc118dc1cc8a0dc3c32cb73bf"><div class="ttname"><a href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a></div><div class="ttdeci">KS_SEQ_COLLECTION seqcollection</div><div class="ttdef"><b>Definition:</b> ksepi.e:79</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n_html_a65c4aa433169274a52c448793e82e12e"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a65c4aa433169274a52c448793e82e12e">KS_SEQ_COLLECTION::numseq</a></div><div class="ttdeci">int numseq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1149</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0613fe6eed79703a67f679dec6a19b50"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0613fe6eed79703a67f679dec6a19b50">&#9670;&nbsp;</a></span>ks_eval_seqcollection_gettotalminduration()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_eval_seqcollection_gettotalminduration </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html">KS_SEQ_COLLECTION</a> *&#160;</td>
          <td class="paramname"><em>seqcollection</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the total duration of the sequence collection</h4>
</p>
<p>Based on the <code>seqctrl.ninstances</code> and <code>seqctrl.min_duration</code> fields for each <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> (sequence module) that have been added to the sequence collection struct (<a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html" title="Collection handle of all sequence modules involved in the pulse sequence, used for RF scaling...">KS_SEQ_COLLECTION</a>), this function returns the total minimum duration possible of the sequence collection, i.e. the time needed to play out the sequence waveforms without any deadtime. See <a class="el" href="_k_s_foundation_8h.html#af38e51235c90bff510cae4ee1955dd95" title="Returns the minimum TR based on the content of a slice loop, adding additional time due to SAR and ha...">ks_eval_mintr()</a>, <a class="el" href="_g_e_required_8e.html#a3bf65ebca3543f771e2d17799bbb0d3c">GEReq_eval_TR()</a>, and <a class="el" href="_k_s_foundation_8h.html#ab4c6e9f82b55a3db56765fc22f21b7b5" title="Returns the time required to play out a certain number of sequence modules over some interval...">ks_eval_gradrflimits()</a> for more details</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">seqcollection</td><td>Collection of all sequence modules (<a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html" title="Collection handle of all sequence modules involved in the pulse sequence, used for RF scaling...">KS_SEQ_COLLECTION</a>). C.f. <a class="el" href="_k_s_foundation_8h.html#a9c627057bb753177d7b74e5cd9ba1a46" title="Adds a sequence module (KS_SEQ_CONTROL) to the KS_SEQ_COLLECTION struct for later RF scaling and SAR ...">ks_eval_addtoseqcollection()</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">int</td><td>Time in [us] </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;                                                                                {</div><div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160; <span class="keywordtype">int</span> i;</div><div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160; <span class="keywordtype">int</span> nettime = 0;</div><div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;</div><div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;  <span class="comment">/* duration based on the sequence collection struct */</span></div><div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a65c4aa433169274a52c448793e82e12e">numseq</a>; i++) {</div><div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;<span class="comment">    if (seqcollection-&gt;seqctrlptr[i]-&gt;min_duration &gt; 0 &amp;&amp; seqcollection-&gt;seqctrlptr[i]-&gt;nseqinstances == 0) {</span></div><div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;<span class="comment">      ks_error(&quot;%s: Sequence module #%d was not played out in sliceloop using ks_scan_playsequence()&quot;, __FUNCTION__, i);</span></div><div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;<span class="comment">      return KS_NOTSET;</span></div><div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;<span class="comment">    }</span></div><div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;    nettime += <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">seqctrlptr</a>[i]-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a901ce6fe6b2fa774dc95ea6bab219bd0">min_duration</a> * <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">seqctrlptr</a>[i]-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a5af9f3a7de19e7493ce64776bd8f3556">nseqinstances</a>;</div><div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;  }</div><div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;</div><div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;  <span class="keywordflow">if</span> (nettime == 0) {</div><div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: Sum of min_durations of sequence modules used is 0&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;  }</div><div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;</div><div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;  <span class="keywordflow">return</span> nettime;</div><div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;} <span class="comment">/* ks_eval_seqcollection_gettotalminduration() */</span></div><div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a5af9f3a7de19e7493ce64776bd8f3556"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a5af9f3a7de19e7493ce64776bd8f3556">KS_SEQ_CONTROL::nseqinstances</a></div><div class="ttdeci">int nseqinstances</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:982</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n_html_a8ab39b275ee333fc1e568a0994db98d1"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">KS_SEQ_COLLECTION::seqctrlptr</a></div><div class="ttdeci">KS_SEQ_CONTROL * seqctrlptr[KS_MAXUNIQUE_SEQUENCES]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1155</div></div>
<div class="ttc" id="ksepi_8e_html_ab5adb9efc118dc1cc8a0dc3c32cb73bf"><div class="ttname"><a href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a></div><div class="ttdeci">KS_SEQ_COLLECTION seqcollection</div><div class="ttdef"><b>Definition:</b> ksepi.e:79</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a901ce6fe6b2fa774dc95ea6bab219bd0"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a901ce6fe6b2fa774dc95ea6bab219bd0">KS_SEQ_CONTROL::min_duration</a></div><div class="ttdeci">int min_duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:981</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n_html_a65c4aa433169274a52c448793e82e12e"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a65c4aa433169274a52c448793e82e12e">KS_SEQ_COLLECTION::numseq</a></div><div class="ttdeci">int numseq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1149</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a736f7a360ad913bc8295ee2bddc6525e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a736f7a360ad913bc8295ee2bddc6525e">&#9670;&nbsp;</a></span>ks_eval_seqcollection2rfpulse()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_eval_seqcollection2rfpulse </td>
          <td>(</td>
          <td class="paramtype">RF_PULSE *&#160;</td>
          <td class="paramname"><em>rfpulse</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html">KS_SEQ_COLLECTION</a> *&#160;</td>
          <td class="paramname"><em>seqcollection</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>(<em>Internal use</em>) Sets up GE's <code>rfpulse[]</code> array from the contents of a <a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html" title="Collection handle of all sequence modules involved in the pulse sequence, used for RF scaling...">KS_SEQ_COLLECTION</a> struct</h4>
</p>
<p>To use GE's <code>maxsar()</code> and <code>maxseqrfamp()</code> functions in <a class="el" href="_k_s_foundation_8h.html#ab4c6e9f82b55a3db56765fc22f21b7b5" title="Returns the time required to play out a certain number of sequence modules over some interval...">ks_eval_gradrflimits()</a> there needs to be an <code>rfpulse[]</code> array containing info about the RF pulses. This info is for standard EPIC psds stored on disk in a file grad_rf_&lt;psdname&gt;.h. KSFoundation EPIC psds with one or more sequence modules (<a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a>) have all RF information stored in <em>seqcollection-&gt;seqctrlptr[i].gradrf.rfptr[]</em>. This function takes all RF information from all sequence modules in the sequence collection and puts in the proper format in <code>rfpulse[]</code>. Then <code>rfpulse[]</code> can be passed on to <code>maxsar()</code> and <code>maxseqrfamp()</code> (see <a class="el" href="_k_s_foundation_8h.html#ab4c6e9f82b55a3db56765fc22f21b7b5" title="Returns the time required to play out a certain number of sequence modules over some interval...">ks_eval_gradrflimits()</a>)</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">rfpulse</td><td>Pointer to rfpulse[] array </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">seqcollection</td><td>Pointer to the sequence collection struct for the sequence </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;                                                                                          {</div><div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;  <span class="keywordtype">int</span> i, j, k;</div><div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;</div><div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;  <span class="comment">/* clear the activity bits for all (KS_MAXUNIQUE_RF) available RF pulse slots */</span></div><div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="_k_s_foundation_8h.html#a4becfb20a2ad2227c16c4ce772ed8d51">KS_MAXUNIQUE_RF</a>; i++) {</div><div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;    <a class="code" href="grad__rf__empty_8h.html#a53f2690e6af35d559b80182016987d22">rfpulse</a>[i].activity = 0;</div><div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;  }</div><div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;</div><div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;  i = 0;</div><div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;  <span class="keywordflow">for</span> (k = 0; k &lt; <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a65c4aa433169274a52c448793e82e12e">numseq</a>; k++) {</div><div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;</div><div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;    <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">seqctrlptr</a>[k]-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ad1471d1cbc5ed7e8b1bc9d0987bf6eed">numrf</a>; j++) {</div><div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;</div><div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;      <span class="keywordflow">if</span> (i &gt;= <a class="code" href="_k_s_foundation_8h.html#a4becfb20a2ad2227c16c4ce772ed8d51">KS_MAXUNIQUE_RF</a>) {</div><div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: too many RF pulses, recompilation is needed with an increased KS_MAXUNIQUE_RF&quot;</span>,</div><div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;                        __FUNCTION__);</div><div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;      }</div><div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;</div><div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;      <a class="code" href="_k_s_foundation__host_8c.html#acb5bc476c9416f2a3d9c975dd80fbb23">ks_eval_rf_relink</a>(<a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">seqctrlptr</a>[k]-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a753f71c73d8169393fcbe8a9b3f4d2c2">rfptr</a>[j]);</div><div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;      <a class="code" href="grad__rf__empty_8h.html#a53f2690e6af35d559b80182016987d22">rfpulse</a>[i++] = <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">seqctrlptr</a>[k]-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a753f71c73d8169393fcbe8a9b3f4d2c2">rfptr</a>[j]-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>;</div><div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;    }</div><div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;  }</div><div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;</div><div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;</div><div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;} <span class="comment">/* ks_eval_seqcollection2rfpulse */</span></div><div class="ttc" id="_k_s_foundation_8h_html_a4becfb20a2ad2227c16c4ce772ed8d51"><div class="ttname"><a href="_k_s_foundation_8h.html#a4becfb20a2ad2227c16c4ce772ed8d51">KS_MAXUNIQUE_RF</a></div><div class="ttdeci">#define KS_MAXUNIQUE_RF</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:114</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a753f71c73d8169393fcbe8a9b3f4d2c2"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a753f71c73d8169393fcbe8a9b3f4d2c2">KS_GRADRFCTRL::rfptr</a></div><div class="ttdeci">KS_RF * rfptr[KS_MAXUNIQUE_RF]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:815</div></div>
<div class="ttc" id="grad__rf__empty_8h_html_a53f2690e6af35d559b80182016987d22"><div class="ttname"><a href="grad__rf__empty_8h.html#a53f2690e6af35d559b80182016987d22">rfpulse</a></div><div class="ttdeci">RF_PULSE rfpulse[RF_FREE]</div><div class="ttdef"><b>Definition:</b> grad_rf_empty.h:56</div></div>
<div class="ttc" id="struct_k_s___r_f_html_ae183c3e4095d1c6d14b3d59a0da97928"><div class="ttname"><a href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">KS_RF::rfpulse</a></div><div class="ttdeci">RF_PULSE rfpulse</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:797</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n_html_a8ab39b275ee333fc1e568a0994db98d1"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">KS_SEQ_COLLECTION::seqctrlptr</a></div><div class="ttdeci">KS_SEQ_CONTROL * seqctrlptr[KS_MAXUNIQUE_SEQUENCES]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1155</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_ad1471d1cbc5ed7e8b1bc9d0987bf6eed"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ad1471d1cbc5ed7e8b1bc9d0987bf6eed">KS_GRADRFCTRL::numrf</a></div><div class="ttdeci">int numrf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:816</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a2573e18f36ab5c3d3fc97072edcfab16"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">KS_SEQ_CONTROL::gradrf</a></div><div class="ttdeci">KS_GRADRFCTRL gradrf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:992</div></div>
<div class="ttc" id="ksepi_8e_html_ab5adb9efc118dc1cc8a0dc3c32cb73bf"><div class="ttname"><a href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a></div><div class="ttdeci">KS_SEQ_COLLECTION seqcollection</div><div class="ttdef"><b>Definition:</b> ksepi.e:79</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_acb5bc476c9416f2a3d9c975dd80fbb23"><div class="ttname"><a href="_k_s_foundation__host_8c.html#acb5bc476c9416f2a3d9c975dd80fbb23">ks_eval_rf_relink</a></div><div class="ttdeci">void ks_eval_rf_relink(KS_RF *rf)</div><div class="ttdoc">(Internal use) Relinks pointers between fields in a KS_RF object</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:1515</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n_html_a65c4aa433169274a52c448793e82e12e"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a65c4aa433169274a52c448793e82e12e">KS_SEQ_COLLECTION::numseq</a></div><div class="ttdeci">int numseq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1149</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="acf397088ddce91c4fc821e59fa0a321d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acf397088ddce91c4fc821e59fa0a321d">&#9670;&nbsp;</a></span>ks_eval_makegradpulse()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">GRAD_PULSE ks_eval_makegradpulse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> *&#160;</td>
          <td class="paramname"><em>trp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>gradchoice</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>(<em>Internal use</em>) Creates a <code>GRAD_PULSE</code> struct from a <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object</h4>
</p>
<p>To use GE's <code>minseq()</code> function that determines gradient heating limits from the gradient usage, a GRAD_PULSE array needs to be generated for each gradient axis. This info is for standard EPIC psds stored on disk in a file grad_rf_&lt;psdname&gt;.h. KSFoundation EPIC psds with one or more sequence modules (<a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a>) being part of a <a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html" title="Collection handle of all sequence modules involved in the pulse sequence, used for RF scaling...">KS_SEQ_COLLECTION</a> struct, have all gradient trapezoid (<a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a>) information stored in seqcollection-&gt;seqctrlptr[i].gradrf.trapptr[]. Hence, from the seqcollection struct it is possible to reach all <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> for all sequence modules (see <a class="el" href="_k_s_foundation_8h.html#ab4c6e9f82b55a3db56765fc22f21b7b5" title="Returns the time required to play out a certain number of sequence modules over some interval...">ks_eval_gradrflimits()</a>), which one by one can be converted to GRAD_PULSE structs using this function.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">trp</td><td>Pointer to a <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gradchoice</td><td>XGRAD, YGRAD, or ZGRAD, specifying which gradient this is used on </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">GRAD_PULSE</td><td>A gradient pulse structure in GE's standard form </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;                                                               {</div><div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;  GRAD_PULSE g;</div><div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;</div><div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;  g.ptype = G_TRAP;</div><div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;  g.attack = &amp;trp-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a>;</div><div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;  g.decay = &amp;trp-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a>;</div><div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;  g.pw = &amp;trp-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">plateautime</a>;</div><div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;  g.amps = NULL;</div><div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;  g.amp = &amp;trp-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a>;</div><div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;  g.ampd = NULL;</div><div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;  g.ampe = NULL;</div><div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;  g.gradfile = NULL;</div><div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;  g.num = trp-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a3fb111f1302287e152078110b3b37d6f">gradnum</a>[gradchoice];</div><div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;  g.scale = 1.0; <span class="comment">/* scale. &lt; 1 for phase enc. */</span></div><div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;  g.time = NULL;</div><div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;  g.tdelta = 0; <span class="comment">/* Time delta in microseconds in between multiple occurances of the pulse */</span></div><div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;  g.powscale = 1.0; <span class="comment">/* might want to do loggrd.xfs/loggrd.tx_xyz instead? */</span></div><div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;</div><div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;  <span class="comment">/* the following are set by minseq***() later */</span></div><div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;  g.power = 0.0;</div><div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;  g.powpos = 0.0;</div><div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;  g.powneg = 0.0;</div><div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;  g.powabs = 0.0;</div><div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;  g.amptran = 0.0;</div><div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;  g.pwm = 1;</div><div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;  g.bridge = 0;</div><div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;  g.intabspwmcurr = 0;</div><div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;</div><div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;  <span class="keywordflow">return</span> g;</div><div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;}</div><div class="ttc" id="struct_k_s___t_r_a_p_html_a878bb367b07dc7dfb5fef5728d2e5b1d"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">KS_TRAP::plateautime</a></div><div class="ttdeci">int plateautime</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:436</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ab508ded41392ee86a2a619d3e93d2373"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">KS_TRAP::amp</a></div><div class="ttdeci">float amp</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:433</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a3fb111f1302287e152078110b3b37d6f"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a3fb111f1302287e152078110b3b37d6f">KS_TRAP::gradnum</a></div><div class="ttdeci">int gradnum[3]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:438</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_acbc719dc4e48c2a2df0447875e4348ca"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">KS_TRAP::ramptime</a></div><div class="ttdeci">int ramptime</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:435</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad4a047990c5929bff018d4ed06a28116"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad4a047990c5929bff018d4ed06a28116">&#9670;&nbsp;</a></span>ks_read_header_pool()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_read_header_pool </td>
          <td>(</td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>exam_number</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>series_number</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>run_number</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ac43539de32839ff2bf2166f69c04e44d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac43539de32839ff2bf2166f69c04e44d">&#9670;&nbsp;</a></span>ks_calc_nextpow2()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int ks_calc_nextpow2 </td>
          <td>(</td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>x</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Gives the next higher 2^N for a given number</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">x</td><td>Integer (usually related to resolution) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">nextpow2</td><td>Unsigned integer with a value equal to the nearest larger power-of-2 </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;                                              {</div><div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;  n--;</div><div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;  n |= n &gt;&gt; 1;</div><div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;  n |= n &gt;&gt; 2;</div><div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;  n |= n &gt;&gt; 4;</div><div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;  n |= n &gt;&gt; 8;</div><div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;  n |= n &gt;&gt; 16;</div><div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;  n++;</div><div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;  <span class="keywordflow">return</span> n;</div><div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a0b690996b2c3e240bfa03e435feb4bc9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0b690996b2c3e240bfa03e435feb4bc9">&#9670;&nbsp;</a></span>ks_calc_roundupms()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_calc_roundupms </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>time</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Rounds up a value in [us] to nearest whole [ms]</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">time</td><td>Time in [us] </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">newtime</td><td>Time in [us], rounded up to next whole [ms] unless already rounded </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;                               {</div><div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;  <span class="keywordflow">return</span> (((val + 999) / 1000) * 1000);</div><div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="aa6f2602e2b975430d4fb39788d82ba9d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa6f2602e2b975430d4fb39788d82ba9d">&#9670;&nbsp;</a></span>ks_calc_filter()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_calc_filter </td>
          <td>(</td>
          <td class="paramtype">FILTER_INFO *&#160;</td>
          <td class="paramname"><em>echo_filter</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>tsp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>duration</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets up GE's FILTER_INFO struct based on dwell (sample point) time and duration of an acquisition window</h4>
</p>
<p>This function is used internally by <a class="el" href="_k_s_foundation_8h.html#ae51f5ee899509ee52c23002bc1883cac" title="Sets up a data acquisition window using a KS_READ sequence object">ks_eval_read()</a> as a part of the setup of a <a class="el" href="struct_k_s___r_e_a_d.html" title="Core sequence object that handles a data acquisition window">KS_READ</a> sequence object, which contains the <code>.filt</code> (FILTER_INFO) field that is used with the corresponding acquisition window in the field <code>.echo</code> of the <a class="el" href="struct_k_s___r_e_a_d.html" title="Core sequence object that handles a data acquisition window">KS_READ</a> object</p>
<p><a class="el" href="_k_s_foundation_8h.html#aa6f2602e2b975430d4fb39788d82ba9d" title="Sets up GE&#39;s FILTER_INFO struct based on dwell (sample point) time and duration of an acquisition win...">ks_calc_filter()</a> will set the field <code>.filt.slot</code> to <code>KS_NOTSET</code> (= -1). A final (global) hardware slot number is set when either <code>setfilter()</code> or <a class="el" href="_g_e_required_8e.html#aa2b5289cf54c04c4c834bad269af6c9b" title="Assigns a global filter slot for a main sequence">GEReq_predownload_setfilter()</a> is called in <code><a class="el" href="ksepi_8e.html#a6dab68043b9947b6a659f72613c083ec">predownload()</a></code>. With the assigned slot number, <a class="el" href="_k_s_foundation_8h.html#a5b50d0ffcc69966c42bceb7e67c70cbf" title="Places a KS_READ sequence object at some position in the pulse sequence">ks_pg_read()</a> in <code><a class="el" href="ksepi_8e.html#a9229731c099971b90dbf7721bad586a9">pulsegen()</a></code> will connect this filter to the acquisition window by internally calling <code>setrfltrs()</code></p>
<h4>Steps for a main sequence written entirely using KSFoundation</h4>
<ul>
<li>GE's function <code>initfilter()</code> is called in the <em>Requiredcvinit</em> section of <a class="el" href="_g_e_required_8e.html" title="This file has several sections that should be @inline&#39;d for a main pulse sequence written entirely in...">GERequired.e</a>. Make sure this section is @inline'd in <code><a class="el" href="ksepi_8e.html#ab86d8a9c08d382dc537ec69e0f1cc9dc">cvinit()</a></code> in the main sequence</li>
<li>In <a class="el" href="ksepi_8e.html#a6dab68043b9947b6a659f72613c083ec">predownload()</a>: <a class="el" href="_g_e_required_8e.html#aa2b5289cf54c04c4c834bad269af6c9b" title="Assigns a global filter slot for a main sequence">GEReq_predownload_setfilter()</a> should be called instead of <code>setfilter()</code>, after @inlining the <em>RequiredpredownloadBegin</em> section of <a class="el" href="_g_e_required_8e.html" title="This file has several sections that should be @inline&#39;d for a main pulse sequence written entirely in...">GERequired.e</a>. Pass the <code>.filt</code> field set up by this function to <a class="el" href="_g_e_required_8e.html#aa2b5289cf54c04c4c834bad269af6c9b" title="Assigns a global filter slot for a main sequence">GEReq_predownload_setfilter()</a></li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">echo_filter</td><td>FILTER_INFO struct needed for data acquisition </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tsp</td><td>Duration in [us] for each data sample (dwell time) in the acquisition window. Minimum: 2 [us] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">duration</td><td>Duration in [us] of the entire data acquisition window </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;                                                                   {</div><div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;</div><div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;  echortf-&gt;decimation = tsp / 2;</div><div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;  echortf-&gt;bw = 1.0e3 / (tsp * 2.0);</div><div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;  echortf-&gt;tsp = tsp; <span class="comment">/* dwell time [us] */</span></div><div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;  echortf-&gt;tdaq = duration;</div><div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;  echortf-&gt;outputs = duration / echortf-&gt;tsp;</div><div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;  echortf-&gt;fslot = <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>; <span class="comment">/* set this to an unusable value so we are forced to call setfilter() or GEReq_predownload_setfilter() */</span></div><div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;  echortf-&gt;prefills = 0;</div><div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;  echortf-&gt;taps = -1;</div><div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;</div><div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;  <span class="keywordflow">if</span> ((floor(echortf-&gt;tsp) != echortf-&gt;tsp) || (duration % (int) echortf-&gt;tsp)) {</div><div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_calc_filter: tsp must be an integer number and 2nd arg (duration) must be even (divisible by &#39;tsp&#39;), in units of us&quot;</span>);</div><div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;  }</div><div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;  <span class="keywordflow">if</span> (echortf-&gt;outputs % 2) {</div><div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_calc_filter: the number of sample outputs must be even&quot;</span>);</div><div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;  }</div><div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_afd953f31b866a09e0418967c2bf65a59"><div class="ttname"><a href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a></div><div class="ttdeci">#define KS_NOTSET</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:60</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a955f51280beb0915d42853ad14eee700"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a955f51280beb0915d42853ad14eee700">&#9670;&nbsp;</a></span>ks_calc_bw2tsp()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_calc_bw2tsp </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>bw</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Convert receiver bandwidth to dwell time</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">bw</td><td>+/- bandwidth per FOV in [kHz]. Maximum: 250 </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">tsp</td><td>Duration in [us] for each data sample (dwell time) in the acquisition window </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;                             {</div><div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;  <span class="keywordtype">int</span> tsp;</div><div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;  <span class="keywordtype">int</span> sysmintsp = 2;</div><div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;</div><div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;  tsp = ((int) floor((<span class="keywordtype">float</span>) HALF_KHZ_USEC / bw / (float) sysmintsp + 0.5)) * sysmintsp;</div><div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;</div><div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;  <span class="keywordflow">if</span> (tsp &lt; sysmintsp)</div><div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;    tsp = sysmintsp;</div><div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;</div><div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;  <span class="keywordflow">return</span> tsp;</div><div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="ae93598f859077f2c60de6be3953dc33c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae93598f859077f2c60de6be3953dc33c">&#9670;&nbsp;</a></span>ks_calc_tsp2bw()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_calc_tsp2bw </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>tsp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Convert dwell time to receiver bandwidth</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">tsp</td><td>Duration in [us] for each data sample in the acquisition window. Minimum: 2 [us] </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">bw</td><td>+/- bandwidth per FOV in [kHz] </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;                              {</div><div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;</div><div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;  <span class="keywordflow">return</span> ( (<span class="keywordtype">float</span>) HALF_KHZ_USEC / (<span class="keywordtype">float</span>) tsp );</div><div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;</div><div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a02dad9317286e1cb7c4a9660f5e524ea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a02dad9317286e1cb7c4a9660f5e524ea">&#9670;&nbsp;</a></span>ks_calc_trap_time2area()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_calc_trap_time2area </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> *&#160;</td>
          <td class="paramname"><em>trap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>area</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Calculates the time from start of gradient until area is reached</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">trap</td><td>KS_TRAP* Trapezoid gradient </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">area</td><td>Area to reach </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">time</td><td>in [us] </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;                                                      {</div><div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;  <span class="keywordtype">float</span> ramp_area = trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a> * trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a> / 2.0;</div><div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;  <span class="keywordtype">float</span> plateau_area = trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a> * trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">plateautime</a>;</div><div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;  <span class="keywordtype">float</span> slewrate = trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a> / trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a>;</div><div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;  <span class="keywordtype">int</span> time2area;</div><div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;  <span class="keywordflow">if</span> (area &lt; ramp_area) {</div><div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;    <span class="comment">/* Target area reached on ramp */</span></div><div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;    time2area = (int) sqrtf(area * 2.0 / slewrate);</div><div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (area &lt; (ramp_area + plateau_area)) {</div><div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;    <span class="comment">/* Target area reached on plateau*/</span></div><div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;    <span class="keywordtype">float</span> area_remaining = area - ramp_area;</div><div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;    time2area = trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a> + (area_remaining / trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a>);</div><div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;    <span class="comment">/* Target area reached on ramp down */</span></div><div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;    <span class="keywordtype">float</span> area_remaining = area - ramp_area - plateau_area;</div><div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;    time2area = (trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a> - sqrtf(trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a>*trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a>  - 2*area_remaining*slewrate) ) / slewrate;</div><div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;  }</div><div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;  <span class="keywordflow">return</span> time2area;</div><div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;}</div><div class="ttc" id="struct_k_s___t_r_a_p_html_a878bb367b07dc7dfb5fef5728d2e5b1d"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">KS_TRAP::plateautime</a></div><div class="ttdeci">int plateautime</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:436</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ab508ded41392ee86a2a619d3e93d2373"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">KS_TRAP::amp</a></div><div class="ttdeci">float amp</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:433</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_acbc719dc4e48c2a2df0447875e4348ca"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">KS_TRAP::ramptime</a></div><div class="ttdeci">int ramptime</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:435</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7c1c3b628e3f08dca4a169d80b7d6361"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7c1c3b628e3f08dca4a169d80b7d6361">&#9670;&nbsp;</a></span>ks_calc_nearestbw()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_calc_nearestbw </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>bw</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Round receiver bandwidth to nearest valid value</h4>
</p>
<p>As the dwell time is an integer and the reciprocal of receiver bandwidth, only certain values of receiver bandwidth are possible. This functions rounds a desired receiver bandwidth to the nearest valid value</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">bw</td><td>+/- bandwidth per FOV in [kHz]. Maximum: 250 </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">bw</td><td>Rounded +/- bandwidth per FOV in [kHz] </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;                                  {</div><div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;  <span class="keywordtype">int</span> tsp;</div><div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;  <span class="keywordflow">if</span> (bw &gt; 0) {</div><div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;    tsp = (int) <a class="code" href="_k_s_foundation__host_8c.html#a955f51280beb0915d42853ad14eee700">ks_calc_bw2tsp</a>(bw); <span class="comment">/* convert rBW to dwell time [us] */</span></div><div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;    <span class="keywordflow">return</span> (<a class="code" href="_k_s_foundation__host_8c.html#ae93598f859077f2c60de6be3953dc33c">ks_calc_tsp2bw</a>(tsp)); <span class="comment">/* round rBW to exacly match the dwell time */</span></div><div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;    <span class="keywordflow">return</span> bw;</div><div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;  }</div><div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;}</div><div class="ttc" id="_k_s_foundation__host_8c_html_ae93598f859077f2c60de6be3953dc33c"><div class="ttname"><a href="_k_s_foundation__host_8c.html#ae93598f859077f2c60de6be3953dc33c">ks_calc_tsp2bw</a></div><div class="ttdeci">float ks_calc_tsp2bw(int tsp)</div><div class="ttdoc">Convert dwell time to receiver bandwidth</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3379</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a955f51280beb0915d42853ad14eee700"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a955f51280beb0915d42853ad14eee700">ks_calc_bw2tsp</a></div><div class="ttdeci">int ks_calc_bw2tsp(float bw)</div><div class="ttdoc">Convert receiver bandwidth to dwell time</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3367</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2a7dd481805414088d844758e9b40419"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2a7dd481805414088d844758e9b40419">&#9670;&nbsp;</a></span>ks_calc_max_rbw()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_calc_max_rbw </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>ampmax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>fov</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Find the maximum reciever bandwidth based on a max gradient amplitude and FOV</h4>
</p>
<h4>Calculates maximum receiver bandwidth</h4>
<p>As the dwell time is an integer and the reciprocal of receiver bandwidth, only certain values of receiver bandwidth are possible. This functions rounds a desired receiver bandwidth to the nearest valid value</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ampmax</td><td>Max gradient amplitude allowed </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fov</td><td>FOV in the readout direction [mm] </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">bw</td><td>Rounded +/- bandwidth per FOV in [kHz]</td></tr>
  </table>
  </dd>
</dl>
<p>Given a maximum allowed gradient amplitude in [G/cm] and a readout FOV in [mm], the largest rBW time (i.e. smallest dwell time) in [us] is calculated.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ampmax</td><td>The maximum allowed gradient amplitude ([G/cm]) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fov</td><td>FOV in the readout direction </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">rbw</td><td>Receiver bandwidth in kHz. </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;                                               {</div><div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;  <span class="keywordtype">float</span> max_rbw = -1.0f;</div><div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;  <span class="keywordtype">int</span> dwelltime;</div><div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;  <span class="keywordflow">for</span> (dwelltime = 2; max_rbw &lt; 0.0; dwelltime += 2) {</div><div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;    <span class="keywordtype">float</span> required_amp = 1.0/(<a class="code" href="_k_s_foundation__host_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a> * fov * 0.1 * dwelltime * 0.000001);</div><div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;    <span class="keywordflow">if</span> (required_amp &lt;= ampmax) {</div><div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;      max_rbw = 500.0f / ((float) dwelltime);</div><div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;    }</div><div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;  }</div><div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;  <span class="keywordflow">return</span> max_rbw;</div><div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;}</div><div class="ttc" id="_k_s_foundation__host_8c_html_a2875ace95558531062d08465b2bcc282"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a></div><div class="ttdeci">float GAM</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6ffabfee55fc92b35511d263092f6ea9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6ffabfee55fc92b35511d263092f6ea9">&#9670;&nbsp;</a></span>ks_calc_minfov()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_calc_minfov </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>ampmax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>tsp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Calculates the minimum readout FOV</h4>
</p>
<p>Given a maximum allowed gradient amplitude in [G/cm] and a dwell time in [us] (see <a class="el" href="_k_s_foundation_8h.html#a955f51280beb0915d42853ad14eee700" title="Convert receiver bandwidth to dwell time">ks_calc_bw2tsp()</a>), the minimum possible readout FOV in [mm] is calculated. This function is called internally by <a class="el" href="_k_s_foundation_8h.html#adbc5d161b21228ab4d53c03911916961" title="Sets up an acquisition window with a trapezoid, subject to gradient constraints specified as input ar...">ks_eval_readtrap_constrained()</a> when rampsampling is not used (<code>.rampsampling = 0</code>)</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ampmax</td><td>The maximum allowed gradient amplitude ([G/cm]) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tsp</td><td>Duration in [us] for each data sample in the acquisition window. Minimum: 2 [us] </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">minFOV</td><td>Minimum FOV in the readout direction </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                                            {</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  <span class="keywordtype">float</span> minfov;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  minfov = ((float) (2 * (1.0e3 / (tsp * 2.0)) * 1000 / <a class="code" href="_k_s_foundation__common_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a>) * (10.0 / ampmax));</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  <span class="keywordflow">return</span> minfov;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a2875ace95558531062d08465b2bcc282"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a></div><div class="ttdeci">float GAM</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a296e894800a7f533250c6ae58e625da9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a296e894800a7f533250c6ae58e625da9">&#9670;&nbsp;</a></span>ks_calc_minslthick()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_calc_minslthick </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>bw</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Calculates the minimum slice thickness [mm]</h4>
</p>
<p>Given an RF bandwidth in [kHz], this function returns the minimum slice thickness possible given the gradient max amplitude.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">bw</td><td>RF bandwidth in [kHz] </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">minSliceThickness</td><td>Minimum slice thickness in [mm] </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                                   {</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <span class="keywordflow">return</span> (bw  / (<a class="code" href="_k_s_foundation__common_8c.html#a5c919c547ee396b18069ed505c695139">ks_syslimits_ampmax</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>) * (0.1) * <a class="code" href="_k_s_foundation__common_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a>));</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a2875ace95558531062d08465b2bcc282"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a></div><div class="ttdeci">float GAM</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a5c919c547ee396b18069ed505c695139"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a5c919c547ee396b18069ed505c695139">ks_syslimits_ampmax</a></div><div class="ttdeci">float ks_syslimits_ampmax(LOG_GRAD loggrd)</div><div class="ttdoc">Returns the maximum gradient amplitude that can be used on all gradient boards simultaneously</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:163</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3957455e4a8980ae7cf4dc1edefa5a4e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3957455e4a8980ae7cf4dc1edefa5a4e">&#9670;&nbsp;</a></span>ks_calc_mintsp()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_calc_mintsp </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>ampmax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>fov</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Calculates the minimum dwell time</h4>
</p>
<p>Given a maximum allowed gradient amplitude in [G/cm] and a readout FOV in [mm], the smallest dwell time (i.e. largest rBW) in [us] is calculated.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ampmax</td><td>The maximum allowed gradient amplitude ([G/cm]) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fov</td><td>FOV in the readout direction </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">tsp</td><td>Duration in [us] for each data sample in the acquisition window </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                                            {</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <span class="keywordtype">int</span> mintsp;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <span class="keywordtype">int</span> sysmintsp = 2;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  mintsp = (int) ceil(1.0e3 / (fov / ((<span class="keywordtype">float</span>) (2 * 1000 / <a class="code" href="_k_s_foundation__common_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a>) * (10.0 / ampmax)) * 2.0));</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <span class="keywordflow">if</span> (mintsp &lt; sysmintsp)</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    mintsp = mintsp;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  <span class="keywordflow">return</span> mintsp;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a2875ace95558531062d08465b2bcc282"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a></div><div class="ttdeci">float GAM</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aeb07c1278254f0a40622fbbe10566f57"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeb07c1278254f0a40622fbbe10566f57">&#9670;&nbsp;</a></span>ks_calc_fov2gradareapixel()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_calc_fov2gradareapixel </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>fov</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Calculates the gradient area needed to move one pixel in k-space</h4>
</p>
<p>Given a readout FOV in [mm], the gradient area needed to move one pixel in a fully sampled k-space is calculated</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">fov</td><td>FOV in the readout direction </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">area</td><td>Gradient area in [(G/cm) * us] </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                                             {</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  <span class="keywordflow">if</span> (fov &gt; 0) {</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="comment">/* G/cm * us. Area needed to move one pixel in k-space corresponding to the input FOV */</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="keywordflow">return</span> (1.0e6 / (fov / 10.0 * <a class="code" href="_k_s_foundation__common_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a>));</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="keywordflow">return</span> (0.0);</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  }</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a2875ace95558531062d08465b2bcc282"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a></div><div class="ttdeci">float GAM</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6ab9211cdefcc0e167b71289e23829bc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6ab9211cdefcc0e167b71289e23829bc">&#9670;&nbsp;</a></span>ks_phaseencoding_init_tgt()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_phaseencoding_init_tgt </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *&#160;</td>
          <td class="paramname"><em>phaseenc_plan_ptr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Internal use for correct migration of <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> from HOST to TGT (IPG)</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">phaseenc_plan_ptr</td><td>Pointer to <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                                                                         {</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  <span class="keywordflow">if</span> (phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#af7f2aa8614e77ef8af0154c7e071ab0e">is_cleared_on_tgt</a> == FALSE) {</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a94a0ea2c005add8c48c0ce371cc15a76">entries</a> = NULL; <span class="comment">/* clear memory pointer from HOST (which is garbage to the TGT) */</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a706b4cec8ea7b1363975e556d74de924">phaser</a> = NULL; <span class="comment">/* clear memory pointer from HOST (which is garbage to the TGT) */</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a08736562d66b16003d4e795e95860cf7">zphaser</a> = NULL; <span class="comment">/* clear memory pointer from HOST (which is garbage to the TGT) */</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#af7f2aa8614e77ef8af0154c7e071ab0e">is_cleared_on_tgt</a> = TRUE;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  }</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  (void) (phaseenc_plan_ptr);</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;}</div><div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_af7f2aa8614e77ef8af0154c7e071ab0e"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#af7f2aa8614e77ef8af0154c7e071ab0e">KS_PHASEENCODING_PLAN::is_cleared_on_tgt</a></div><div class="ttdeci">int is_cleared_on_tgt</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1593</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a94a0ea2c005add8c48c0ce371cc15a76"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a94a0ea2c005add8c48c0ce371cc15a76">KS_PHASEENCODING_PLAN::entries</a></div><div class="ttdeci">KS_PHASEENCODING_COORD * entries</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1590</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a08736562d66b16003d4e795e95860cf7"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a08736562d66b16003d4e795e95860cf7">KS_PHASEENCODING_PLAN::zphaser</a></div><div class="ttdeci">KS_PHASER * zphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1592</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a706b4cec8ea7b1363975e556d74de924"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a706b4cec8ea7b1363975e556d74de924">KS_PHASEENCODING_PLAN::phaser</a></div><div class="ttdeci">KS_PHASER * phaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1591</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9712828cb11bdaf20671ac4e43c80d3a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9712828cb11bdaf20671ac4e43c80d3a">&#9670;&nbsp;</a></span>ks_phaseencoding_get()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html">KS_PHASEENCODING_COORD</a> ks_phaseencoding_get </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *&#160;</td>
          <td class="paramname"><em>phaseenc_plan_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>echo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>shot</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Get [ky,kz] coordinate from <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> for given echo and shot</h4>
</p>
<p>If the .ky and .kz values returned by this function is = KS_NOTSET (-1), it indicates that this echo/shot combination should have zero phase encoding and should be ignored. For 2D, .kz will always be KS_NOTSET</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">phaseenc_plan_ptr</td><td>Pointer to <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">echo</td><td>Echo index in the sequence ETL in range <code>[0,ETL-1]</code> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">shot</td><td>Shot index (i.e. how many times the sequence is played out per slice). For 3D, this is the combined number of shots over ky and kz </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">&lt;tt&gt;KS_PHASEENCODING_COORD&lt;/tt&gt;</td><td></td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                                                                                                                {</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  <span class="keywordtype">int</span> oktoset = ((phaseenc_plan_ptr != NULL) &amp;&amp; phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a> != <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>) &amp;&amp; (phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#af7f2aa8614e77ef8af0154c7e071ab0e">is_cleared_on_tgt</a>);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  <span class="keywordtype">int</span> oktoset = (phaseenc_plan_ptr != NULL) &amp;&amp; phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a> != <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;#endif</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  if (!oktoset || !(phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a94a0ea2c005add8c48c0ce371cc15a76">entries</a>) ||</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;      shot &lt; 0 || shot &gt;= phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#aa2f98be84137da8386df3fc88763823c">num_shots</a> ||</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      echo &lt; 0 || echo &gt;= phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a>) {</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html">KS_PHASEENCODING_COORD</a> fake_coords = <a class="code" href="_k_s_foundation_8h.html#ae5e9ce52cebc9a6543bc6e69e9a03148">KS_INIT_PHASEENCODING_COORD</a>;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="keywordflow">return</span> fake_coords;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  }</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  <span class="keywordflow">return</span> phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a94a0ea2c005add8c48c0ce371cc15a76">entries</a>[echo + phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a> * shot];</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_ae5e9ce52cebc9a6543bc6e69e9a03148"><div class="ttname"><a href="_k_s_foundation_8h.html#ae5e9ce52cebc9a6543bc6e69e9a03148">KS_INIT_PHASEENCODING_COORD</a></div><div class="ttdeci">#define KS_INIT_PHASEENCODING_COORD</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:139</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_af7f2aa8614e77ef8af0154c7e071ab0e"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#af7f2aa8614e77ef8af0154c7e071ab0e">KS_PHASEENCODING_PLAN::is_cleared_on_tgt</a></div><div class="ttdeci">int is_cleared_on_tgt</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1593</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_aa2f98be84137da8386df3fc88763823c"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#aa2f98be84137da8386df3fc88763823c">KS_PHASEENCODING_PLAN::num_shots</a></div><div class="ttdeci">int num_shots</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1587</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a94a0ea2c005add8c48c0ce371cc15a76"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a94a0ea2c005add8c48c0ce371cc15a76">KS_PHASEENCODING_PLAN::entries</a></div><div class="ttdeci">KS_PHASEENCODING_COORD * entries</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1590</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_afd953f31b866a09e0418967c2bf65a59"><div class="ttname"><a href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a></div><div class="ttdeci">#define KS_NOTSET</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:60</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d_html"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html">KS_PHASEENCODING_COORD</a></div><div class="ttdoc">Struct holding a 3D k-space phase encoding location (ky,kz)</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1552</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a7582325a159d8ec89a4a4ba0fb89e9a9"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">KS_PHASEENCODING_PLAN::etl</a></div><div class="ttdeci">int etl</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1588</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="abb524977b3e7a48a58dad2370166df9b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abb524977b3e7a48a58dad2370166df9b">&#9670;&nbsp;</a></span>ks_phaseencoding_set()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_phaseencoding_set </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *&#160;</td>
          <td class="paramname"><em>phaseenc_plan_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>echo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>shot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ky</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>kz</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Set [ky,kz] coordinate from <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> for given echo and shot</h4>
</p>
<p>If the .ky and .kz values passed to this function is = KS_NOTSET (-1), it indicates that this echo/shot combination should have zero phase encoding and should be ignored. However, ignored echo/shot combinations are not necessary since the etl*num_shots entries in <code>.entries</code> of <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> are always initialized to KS_NOTSET by <a class="el" href="_k_s_foundation_8h.html#ad3b39ba8c626f4580806078dc4f4b211" title="Reallocate memory for KS_PHASEENCODING_PLAN entries">ks_phaseencoding_resize()</a>. Hence, it is only necessary to explicitly set the echo/shot combination for ky/kz coordinates being acquired.</p>
<p>For 2D, kz (5th arg) should always be KS_NOTSET.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">phaseenc_plan_ptr</td><td>Pointer to <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">echo</td><td>Echo index in the sequence ETL in range <code>[0,ETL-1]</code> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">shot</td><td>Shot index (in range [0,how many times the sequence is played out per slice - 1]). For 3D, this is the combined number of shots over ky and kz </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ky</td><td>K-space coordinate along the first (only for 2D) phase encoding direction (integer) in range <code>[0, phaser.numlinestoacq-1]</code> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">kz</td><td>K-space coordinate along the second (use KS_NOTSET for 2D) phase encoding direction (integer) in range <code>[0, zphaser.numlinestoacq-1]</code> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                                                                                                        {</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  <span class="keywordtype">int</span> oktoset = (phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a> != <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>) &amp;&amp; (phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#af7f2aa8614e77ef8af0154c7e071ab0e">is_cleared_on_tgt</a>);</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;  <span class="keywordtype">int</span> oktoset = phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a> != <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  <span class="keywordflow">if</span> (!oktoset || !phaseenc_plan_ptr || !(phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a94a0ea2c005add8c48c0ce371cc15a76">entries</a>) ||</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      shot &lt; 0 || shot &gt;= phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#aa2f98be84137da8386df3fc88763823c">num_shots</a> ||</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      echo &lt; 0 || echo &gt;= phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a>) {</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  }</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  ky = (ky &lt; 0) ? <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a> : ky; <span class="comment">/* KS_NOTSET = shut off phase encoding */</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  kz = (kz &lt; 0) ? <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a> : kz;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a94a0ea2c005add8c48c0ce371cc15a76">entries</a>[echo + phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a> * shot].<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#ad097e95262501d52829d5cd9a827275c">ky</a> = ky;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a94a0ea2c005add8c48c0ce371cc15a76">entries</a>[echo + phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a> * shot].<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#a7894f45c2928e5a523eeafc5ef4ae8b7">kz</a> = kz;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;}</div><div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_af7f2aa8614e77ef8af0154c7e071ab0e"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#af7f2aa8614e77ef8af0154c7e071ab0e">KS_PHASEENCODING_PLAN::is_cleared_on_tgt</a></div><div class="ttdeci">int is_cleared_on_tgt</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1593</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_aa2f98be84137da8386df3fc88763823c"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#aa2f98be84137da8386df3fc88763823c">KS_PHASEENCODING_PLAN::num_shots</a></div><div class="ttdeci">int num_shots</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1587</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a94a0ea2c005add8c48c0ce371cc15a76"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a94a0ea2c005add8c48c0ce371cc15a76">KS_PHASEENCODING_PLAN::entries</a></div><div class="ttdeci">KS_PHASEENCODING_COORD * entries</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1590</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_afd953f31b866a09e0418967c2bf65a59"><div class="ttname"><a href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a></div><div class="ttdeci">#define KS_NOTSET</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:60</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d_html_ad097e95262501d52829d5cd9a827275c"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#ad097e95262501d52829d5cd9a827275c">KS_PHASEENCODING_COORD::ky</a></div><div class="ttdeci">int ky</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1553</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d_html_a7894f45c2928e5a523eeafc5ef4ae8b7"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#a7894f45c2928e5a523eeafc5ef4ae8b7">KS_PHASEENCODING_COORD::kz</a></div><div class="ttdeci">int kz</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1554</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a7582325a159d8ec89a4a4ba0fb89e9a9"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">KS_PHASEENCODING_PLAN::etl</a></div><div class="ttdeci">int etl</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1588</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab37bdbd70185618b80d077f99b253616"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab37bdbd70185618b80d077f99b253616">&#9670;&nbsp;</a></span>ks_phaseencoding_print()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_phaseencoding_print </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *&#160;</td>
          <td class="paramname"><em>phaseenc_plan_ptr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Print out <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> to a text file</h4>
</p>
<p>In SIM (WTools), a file ks_phaseencodingtable.txt will be generated in the current directory On HW (MR scanner), the same file will be located in /usr/g/mrraw</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">phaseenc_plan_ptr</td><td>Pointer to <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                                                                            {</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  <a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html">KS_PHASEENCODING_COORD</a> coord = <a class="code" href="_k_s_foundation_8h.html#ae5e9ce52cebc9a6543bc6e69e9a03148">KS_INIT_PHASEENCODING_COORD</a>;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  <span class="keywordtype">int</span> shot, echo;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="preprocessor">#ifdef PSD_HW</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  FILE *fp = fopen(<span class="stringliteral">&quot;/usr/g/mrraw/ks_phaseencodingtable.txt&quot;</span>, <span class="stringliteral">&quot;w&quot;</span>);</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  FILE *fp = fopen(<span class="stringliteral">&quot;./ks_phaseencodingtable.txt&quot;</span>, <span class="stringliteral">&quot;w&quot;</span>);</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  <span class="keywordflow">if</span> (phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a> == <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>) {</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="keywordflow">return</span>; <span class="comment">/* we haven&#39;t set it up yet */</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  }</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;numshots (vertical): %d, etl (horizontal): %d\n\n&quot;</span>, phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#aa2f98be84137da8386df3fc88763823c">num_shots</a>, phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a>);</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  <span class="keywordflow">for</span> (shot = 0; shot &lt; phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#aa2f98be84137da8386df3fc88763823c">num_shots</a>; shot++) {</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keywordflow">for</span> (echo = 0; echo &lt; phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a>; echo++) {</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        coord = <a class="code" href="_k_s_foundation__common_8c.html#a9712828cb11bdaf20671ac4e43c80d3a">ks_phaseencoding_get</a>(phaseenc_plan_ptr, echo, shot);</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        <span class="keywordflow">if</span> (coord.<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#ad097e95262501d52829d5cd9a827275c">ky</a> != <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>) {</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;[%03d&quot;</span>, coord.<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#ad097e95262501d52829d5cd9a827275c">ky</a>);</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;[***&quot;</span>);</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        }</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        <span class="keywordflow">if</span> (coord.<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#a7894f45c2928e5a523eeafc5ef4ae8b7">kz</a> != <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>) {</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;,%03d] &quot;</span>, coord.<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#a7894f45c2928e5a523eeafc5ef4ae8b7">kz</a>);</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;,***] &quot;</span>);</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        }</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;      }</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    fprintf(fp,<span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  }</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  fclose(fp);</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_ae5e9ce52cebc9a6543bc6e69e9a03148"><div class="ttname"><a href="_k_s_foundation_8h.html#ae5e9ce52cebc9a6543bc6e69e9a03148">KS_INIT_PHASEENCODING_COORD</a></div><div class="ttdeci">#define KS_INIT_PHASEENCODING_COORD</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:139</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_aa2f98be84137da8386df3fc88763823c"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#aa2f98be84137da8386df3fc88763823c">KS_PHASEENCODING_PLAN::num_shots</a></div><div class="ttdeci">int num_shots</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1587</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_afd953f31b866a09e0418967c2bf65a59"><div class="ttname"><a href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a></div><div class="ttdeci">#define KS_NOTSET</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:60</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d_html_ad097e95262501d52829d5cd9a827275c"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#ad097e95262501d52829d5cd9a827275c">KS_PHASEENCODING_COORD::ky</a></div><div class="ttdeci">int ky</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1553</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d_html_a7894f45c2928e5a523eeafc5ef4ae8b7"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#a7894f45c2928e5a523eeafc5ef4ae8b7">KS_PHASEENCODING_COORD::kz</a></div><div class="ttdeci">int kz</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1554</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d_html"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html">KS_PHASEENCODING_COORD</a></div><div class="ttdoc">Struct holding a 3D k-space phase encoding location (ky,kz)</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1552</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a7582325a159d8ec89a4a4ba0fb89e9a9"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">KS_PHASEENCODING_PLAN::etl</a></div><div class="ttdeci">int etl</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1588</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a9712828cb11bdaf20671ac4e43c80d3a"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a9712828cb11bdaf20671ac4e43c80d3a">ks_phaseencoding_get</a></div><div class="ttdeci">KS_PHASEENCODING_COORD ks_phaseencoding_get(const KS_PHASEENCODING_PLAN *phaseenc_plan_ptr, int echo, int shot)</div><div class="ttdoc">Get [ky,kz] coordinate from KS_PHASEENCODING_PLAN for given echo and shot</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:308</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad3b39ba8c626f4580806078dc4f4b211"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad3b39ba8c626f4580806078dc4f4b211">&#9670;&nbsp;</a></span>ks_phaseencoding_resize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_phaseencoding_resize </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *&#160;</td>
          <td class="paramname"><em>phaseenc_plan_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>etl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>num_shots</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Reallocate memory for <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> entries</h4>
</p>
<p>For every (and custom) ks_phaseencoding_generate_** functions, this function must be called before <a class="el" href="_k_s_foundation_8h.html#abb524977b3e7a48a58dad2370166df9b" title="Set [ky,kz] coordinate from KS_PHASEENCODING_PLAN for given echo and shot">ks_phaseencoding_set()</a> so that there is memory allocataed for the array of <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html" title="Struct holding a 3D k-space phase encoding location (ky,kz)">KS_PHASEENCODING_COORD</a></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">phaseenc_plan_ptr</td><td>Pointer to <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">etl</td><td>The number of acquisition window in the pulse sequence, or echo train length (ETL) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">num_shots</td><td>Number of shots (i.e. how many times the sequence is played out per slice). For 3D, shot is over both ky and kz </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                                                                                                 {</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  <span class="keywordtype">void</span> *ptr = NULL;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#a6ab9211cdefcc0e167b71289e23829bc">ks_phaseencoding_init_tgt</a>(phaseenc_plan_ptr);</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  ptr = realloc(phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a94a0ea2c005add8c48c0ce371cc15a76">entries</a>, etl * num_shots * <span class="keyword">sizeof</span>(<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html">KS_PHASEENCODING_COORD</a>));</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  <span class="keywordflow">if</span> (!ptr) {</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: failed reallocation&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  }</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a> = etl;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#aa2f98be84137da8386df3fc88763823c">num_shots</a> = num_shots;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;  phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a94a0ea2c005add8c48c0ce371cc15a76">entries</a> = (<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html">KS_PHASEENCODING_COORD</a> *) ptr;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; etl * num_shots; i++) {</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a94a0ea2c005add8c48c0ce371cc15a76">entries</a>[i].<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#ad097e95262501d52829d5cd9a827275c">ky</a> = <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a94a0ea2c005add8c48c0ce371cc15a76">entries</a>[i].<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#a7894f45c2928e5a523eeafc5ef4ae8b7">kz</a> = <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  }</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;}</div><div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_aa2f98be84137da8386df3fc88763823c"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#aa2f98be84137da8386df3fc88763823c">KS_PHASEENCODING_PLAN::num_shots</a></div><div class="ttdeci">int num_shots</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1587</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a94a0ea2c005add8c48c0ce371cc15a76"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a94a0ea2c005add8c48c0ce371cc15a76">KS_PHASEENCODING_PLAN::entries</a></div><div class="ttdeci">KS_PHASEENCODING_COORD * entries</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1590</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_afd953f31b866a09e0418967c2bf65a59"><div class="ttname"><a href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a></div><div class="ttdeci">#define KS_NOTSET</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:60</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d_html_ad097e95262501d52829d5cd9a827275c"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#ad097e95262501d52829d5cd9a827275c">KS_PHASEENCODING_COORD::ky</a></div><div class="ttdeci">int ky</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1553</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d_html_a7894f45c2928e5a523eeafc5ef4ae8b7"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#a7894f45c2928e5a523eeafc5ef4ae8b7">KS_PHASEENCODING_COORD::kz</a></div><div class="ttdeci">int kz</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1554</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d_html"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html">KS_PHASEENCODING_COORD</a></div><div class="ttdoc">Struct holding a 3D k-space phase encoding location (ky,kz)</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1552</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a7582325a159d8ec89a4a4ba0fb89e9a9"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">KS_PHASEENCODING_PLAN::etl</a></div><div class="ttdeci">int etl</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1588</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a6ab9211cdefcc0e167b71289e23829bc"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a6ab9211cdefcc0e167b71289e23829bc">ks_phaseencoding_init_tgt</a></div><div class="ttdeci">void ks_phaseencoding_init_tgt(KS_PHASEENCODING_PLAN *phaseenc_plan_ptr)</div><div class="ttdoc">Internal use for correct migration of KS_PHASEENCODING_PLAN from HOST to TGT (IPG)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:294</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa887db0578a0780ccd7ed143e858588c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa887db0578a0780ccd7ed143e858588c">&#9670;&nbsp;</a></span>ks_phaseencoding_generate_simple()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_phaseencoding_generate_simple </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *&#160;</td>
          <td class="paramname"><em>phaseenc_plan_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const&#160;</td>
          <td class="paramname"><em>desc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *&#160;</td>
          <td class="paramname"><em>phaser</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *&#160;</td>
          <td class="paramname"><em>zphaser</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Generation of a <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> for any sequence having only one echo (or same phasenc step for all echoes)</h4>
</p>
<p>For sequences having only one echo (ETL=1) or having more echoes but where all echoes have the same ky/kz coordinate, there is no special logic necessary regarding which order to traverse the ky-kz plane over shots.</p>
<p>Parallel imaging in ky (and kz for 3D), with acs lines, is set up as usual using <a class="el" href="_k_s_foundation_8h.html#acc45c24d1996acd3d95ae2866c5ffb2b" title="Sets up an acquisition window with a trapezoid with preset gradient constraints">ks_eval_phaser()</a> first before calling this function. For 2D, the phase encoding object (<a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a>) is then passed in as the 2nd arg to this function, with the 3rd arg being <code>NULL</code>. For 3D, both KS_PHASERs are passed in as 2nd and 3rd args, each with their own acceleration and resolution. For both 2D and 3D, the <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> will be set up based on the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER(s)</a>, but for 2D all entries.kz in the <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> will be KS_NOTSET (-1)</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">phaseenc_plan_ptr</td><td>Pointer to <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">desc</td><td>A description (text string) of the <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> object. This description is used in the psd plot. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">phaser</td><td>Pointer to the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object for the first (3D) / only (2D) phase encoding direction </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">zphaser</td><td>Pointer to the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object for the second phase encoding direction (NULL for 2D) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                                                                                                                                                  {</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  <span class="keywordtype">int</span> etl = 1;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  <span class="keywordtype">int</span> num_shots;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  <span class="keywordtype">int</span> shot, ky, kz;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  STATUS status;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  strncpy(phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, desc, <a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> - 1);</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>[<a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> - 1] = 0;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  <span class="comment">/* don&#39;t allow empty description or a description with leading space */</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  <span class="keywordflow">if</span> (phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a1c544bec41003a594ba4ec7d43a3a470">description</a> == NULL || phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>[0] == <span class="charliteral">&#39; &#39;</span>) {</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: description of phase encoding plan (2nd arg) cannot be NULL or leading space&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  }</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  num_shots = (zphaser != NULL) ? (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a> * zphaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a>) : phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a>;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  status = <a class="code" href="_k_s_foundation__common_8c.html#ad3b39ba8c626f4580806078dc4f4b211">ks_phaseencoding_resize</a>(phaseenc_plan_ptr, etl, num_shots);</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  <span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  shot = 0;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  <span class="keywordflow">if</span> (zphaser != NULL) { <span class="comment">/* 3D */</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <span class="keywordflow">for</span> (kz = 0; kz &lt; zphaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a>; kz++) {</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;      <span class="keywordflow">for</span> (ky = 0; ky &lt; phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a>; ky++) {</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        <a class="code" href="_k_s_foundation__common_8c.html#abb524977b3e7a48a58dad2370166df9b">ks_phaseencoding_set</a>(phaseenc_plan_ptr, 0, shot++, phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[ky], zphaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[kz]);</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;      }</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    }</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a08736562d66b16003d4e795e95860cf7">zphaser</a> = zphaser;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  } <span class="keywordflow">else</span> { <span class="comment">/* 2D */</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="keywordflow">for</span> (ky = 0; ky &lt; phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a>; ky++) {</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;      <a class="code" href="_k_s_foundation__common_8c.html#abb524977b3e7a48a58dad2370166df9b">ks_phaseencoding_set</a>(phaseenc_plan_ptr, 0, shot++, phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[ky], <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>);</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    }</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a08736562d66b16003d4e795e95860cf7">zphaser</a> = NULL;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  }</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;  phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a706b4cec8ea7b1363975e556d74de924">phaser</a> = phaser;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_abb524977b3e7a48a58dad2370166df9b"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abb524977b3e7a48a58dad2370166df9b">ks_phaseencoding_set</a></div><div class="ttdeci">void ks_phaseencoding_set(KS_PHASEENCODING_PLAN *phaseenc_plan_ptr, int echo, int shot, int ky, int kz)</div><div class="ttdoc">Set [ky,kz] coordinate from KS_PHASEENCODING_PLAN for given echo and shot</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:328</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_ad3b39ba8c626f4580806078dc4f4b211"><div class="ttname"><a href="_k_s_foundation__common_8c.html#ad3b39ba8c626f4580806078dc4f4b211">ks_phaseencoding_resize</a></div><div class="ttdeci">STATUS ks_phaseencoding_resize(KS_PHASEENCODING_PLAN *phaseenc_plan_ptr, int etl, int num_shots)</div><div class="ttdoc">Reallocate memory for KS_PHASEENCODING_PLAN entries</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:389</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_afd953f31b866a09e0418967c2bf65a59"><div class="ttname"><a href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a></div><div class="ttdeci">#define KS_NOTSET</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:60</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a09b1a7dc77a7cf8c4e8421a23608a42a"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">KS_PHASER::numlinestoacq</a></div><div class="ttdeci">int numlinestoacq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1532</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a090fbced834ec878a08eadc4f829b8a3"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">KS_PHASER::linetoacq</a></div><div class="ttdeci">int linetoacq[KS_MAX_PHASEDYN]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1533</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aacb2fe1d83c45e8d0525f363bdd6b8a6"><div class="ttname"><a href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a></div><div class="ttdeci">#define KS_DESCRIPTION_LENGTH</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:112</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a1c544bec41003a594ba4ec7d43a3a470">KS_PHASEENCODING_PLAN::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1589</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a08736562d66b16003d4e795e95860cf7"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a08736562d66b16003d4e795e95860cf7">KS_PHASEENCODING_PLAN::zphaser</a></div><div class="ttdeci">KS_PHASER * zphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1592</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a706b4cec8ea7b1363975e556d74de924"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a706b4cec8ea7b1363975e556d74de924">KS_PHASEENCODING_PLAN::phaser</a></div><div class="ttdeci">KS_PHASER * phaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1591</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa067bf0cb6e0bfc4a1d39f4fe760f213"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa067bf0cb6e0bfc4a1d39f4fe760f213">&#9670;&nbsp;</a></span>ks_phaseencoding_generate_simple_ellipse()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_phaseencoding_generate_simple_ellipse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *&#160;</td>
          <td class="paramname"><em>phaseenc_plan_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const&#160;</td>
          <td class="paramname"><em>desc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *&#160;</td>
          <td class="paramname"><em>phaser</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *&#160;</td>
          <td class="paramname"><em>zphaser</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Generation of a <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> for any sequence having only one echo (or same phasenc step for all echoes) - ellipse version</h4>
</p>
<p>For sequences having only one echo (ETL=1) or having more echoes but where all echoes have the same ky/kz coordinate, there is no special logic necessary regarding which order to traverse the ky-kz plane over shots.</p>
<p>Parallel imaging in ky (and kz for 3D), with acs lines, is set up as usual using <a class="el" href="_k_s_foundation_8h.html#acc45c24d1996acd3d95ae2866c5ffb2b" title="Sets up an acquisition window with a trapezoid with preset gradient constraints">ks_eval_phaser()</a> first before calling this function. For 2D, the phase encoding object (<a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a>) is then passed in as the 2nd arg to this function, with the 3rd arg being <code>NULL</code>. For 3D, both KS_PHASERs are passed in as 2nd and 3rd args, each with their own acceleration and resolution. For both 2D and 3D, the <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> will be set up based on the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER(s)</a>, but for 2D all entries.kz in the <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> will be KS_NOTSET (-1). This function will create an elliptical k-space in ky/kz. For rectangular k-space, use <code>ks_phaseencoding_generate_simple</code>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">phaseenc_plan_ptr</td><td>Pointer to <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">desc</td><td>A description (text string) of the <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> object. This description is used in the psd plot. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">phaser</td><td>Pointer to the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object for the first (3D) / only (2D) phase encoding direction </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">zphaser</td><td>Pointer to the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object for the second phase encoding direction (NULL for 2D) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                                                                                                                                                          {</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  <span class="keywordtype">int</span> etl = 1;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  <span class="keywordtype">int</span> ky, kz, i;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  <span class="keywordtype">float</span> radius_ky, radius_kz, center_ky, center_kz;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  <span class="keywordtype">float</span> x1, x2;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  STATUS status;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  <span class="keywordtype">int</span> inellipse; <span class="comment">/* Number of ky,kz points in the ellipse */</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  strncpy(phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, desc, <a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> - 1);</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>[<a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> - 1] = 0;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  <span class="comment">/* don&#39;t allow empty description or a description with leading space */</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  <span class="keywordflow">if</span> (phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a1c544bec41003a594ba4ec7d43a3a470">description</a> == NULL || phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>[0] == <span class="charliteral">&#39; &#39;</span>) {</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: description of phase encoding plan (2nd arg) cannot be NULL or leading space&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  }</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  <span class="keywordflow">if</span> (zphaser == NULL) { <span class="comment">/* We can&#39;t do ellipse k-space coverage (ky,kz) in 2D */</span></div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#aa887db0578a0780ccd7ed143e858588c">ks_phaseencoding_generate_simple</a>(phaseenc_plan_ptr, desc, phaser, NULL);</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  }</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a706b4cec8ea7b1363975e556d74de924">phaser</a> = phaser;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  radius_ky = phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a>/2.0;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  center_ky = phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a>/2.0 - 0.5;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a08736562d66b16003d4e795e95860cf7">zphaser</a> = zphaser;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  radius_kz = zphaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a>/2.0;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  center_kz = zphaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a>/2.0 - 0.5;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; 2; i++) { <span class="comment">/* i = 0: check how many. i = 1: set up coords */</span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="keywordflow">if</span> (i == 1) {</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;      status = <a class="code" href="_k_s_foundation__common_8c.html#ad3b39ba8c626f4580806078dc4f4b211">ks_phaseencoding_resize</a>(phaseenc_plan_ptr, etl, inellipse);</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;      <span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    }</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    inellipse = 0;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="keywordflow">for</span> (kz = 0; kz &lt; zphaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a>; kz++) {</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;      <span class="keywordflow">for</span> (ky = 0; ky &lt; phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a>; ky++) {</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;          x1 = (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[ky]  - center_ky) / (<span class="keywordtype">float</span>) radius_ky;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;          x2 = (zphaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[kz] - center_kz) / (<span class="keywordtype">float</span>) radius_kz;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;          <span class="keywordflow">if</span> ((x1 * x1 + x2 * x2) &lt;= 1.0) {</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;            <span class="keywordflow">if</span> (i == 1) {</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;              <a class="code" href="_k_s_foundation__common_8c.html#abb524977b3e7a48a58dad2370166df9b">ks_phaseencoding_set</a>(phaseenc_plan_ptr, 0, inellipse, phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[ky], zphaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[kz]);</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;            }</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;            inellipse++;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;          }</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;      } <span class="comment">/* ky */</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    } <span class="comment">/* kz */</span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  } <span class="comment">/* i */</span></div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_abb524977b3e7a48a58dad2370166df9b"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abb524977b3e7a48a58dad2370166df9b">ks_phaseencoding_set</a></div><div class="ttdeci">void ks_phaseencoding_set(KS_PHASEENCODING_PLAN *phaseenc_plan_ptr, int echo, int shot, int ky, int kz)</div><div class="ttdoc">Set [ky,kz] coordinate from KS_PHASEENCODING_PLAN for given echo and shot</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:328</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_ad3b39ba8c626f4580806078dc4f4b211"><div class="ttname"><a href="_k_s_foundation__common_8c.html#ad3b39ba8c626f4580806078dc4f4b211">ks_phaseencoding_resize</a></div><div class="ttdeci">STATUS ks_phaseencoding_resize(KS_PHASEENCODING_PLAN *phaseenc_plan_ptr, int etl, int num_shots)</div><div class="ttdoc">Reallocate memory for KS_PHASEENCODING_PLAN entries</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:389</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">KS_PHASER::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1527</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a09b1a7dc77a7cf8c4e8421a23608a42a"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">KS_PHASER::numlinestoacq</a></div><div class="ttdeci">int numlinestoacq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1532</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a090fbced834ec878a08eadc4f829b8a3"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">KS_PHASER::linetoacq</a></div><div class="ttdeci">int linetoacq[KS_MAX_PHASEDYN]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1533</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aacb2fe1d83c45e8d0525f363bdd6b8a6"><div class="ttname"><a href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a></div><div class="ttdeci">#define KS_DESCRIPTION_LENGTH</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:112</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a1c544bec41003a594ba4ec7d43a3a470">KS_PHASEENCODING_PLAN::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1589</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_aa887db0578a0780ccd7ed143e858588c"><div class="ttname"><a href="_k_s_foundation__common_8c.html#aa887db0578a0780ccd7ed143e858588c">ks_phaseencoding_generate_simple</a></div><div class="ttdeci">STATUS ks_phaseencoding_generate_simple(KS_PHASEENCODING_PLAN *phaseenc_plan_ptr, const char *const desc, KS_PHASER *phaser, KS_PHASER *zphaser)</div><div class="ttdoc">Generation of a KS_PHASEENCODING_PLAN for any sequence having only one echo (or same phasenc step for...</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:414</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a08736562d66b16003d4e795e95860cf7"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a08736562d66b16003d4e795e95860cf7">KS_PHASEENCODING_PLAN::zphaser</a></div><div class="ttdeci">KS_PHASER * zphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1592</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a706b4cec8ea7b1363975e556d74de924"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a706b4cec8ea7b1363975e556d74de924">KS_PHASEENCODING_PLAN::phaser</a></div><div class="ttdeci">KS_PHASER * phaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1591</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad6d4710baf0864b0e04ba55908a52666"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad6d4710baf0864b0e04ba55908a52666">&#9670;&nbsp;</a></span>ks_fse_calcecho()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_fse_calcecho </td>
          <td>(</td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>bestecho</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>optecho</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *&#160;</td>
          <td class="paramname"><em>pe</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>TE</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>etl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>esp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Calculates the ETL index corresponding the desired TE given a <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object and echo spacing</h4>
</p>
<p>Given the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object used in the FSE train (containing res and partial ky Fourier info), the desired effective echo time (<code>TE</code> [us]), the echo train length (<code>etl</code>) and the echo spacing between consecutive echoes (<code>esp</code> [us]), this function calculates two echo indices:</p>
<ul>
<li><code>bestecho</code>: is the 0-based index corresponding to the echo in the FSE train that should be placed in the center of k-space, i.e. the echo that most closely matches the desired TE. If <code>bestecho</code> is an integer value (although it is in double format), the data acquired for this echo should <em>straddle</em> the k-space center. <code>bestecho</code> can also be an interger + 0.5, indicating that there are two echo indices that should be placed around the k-space center. For example, floor(bestecho) corresponds to the echo index that should be placed just below the k-space center and ceil(bestecho) corresponds to the echo index that should be placed just above the k-space center. I.e. when <code>bestecho = *.5</code>, no single echo index will straddle the k-space center, and the k-space line located at ky position +0.5 will come from data acquired from echo #[floor(bestecho)] and ky position -0.5 correspondingly from echo #[ceil(bestecho)].</li>
<li><code>optecho</code>: is the 0-based index corresponding to an ideal TE choice that would allow the data from the echoes in the FSE train to be placed out linearly each time. Doing so will reduce ghosting and T2 blurring. Hence, <code>optecho</code> ignores the input TE value here, but the calling function can use this information to determine k-space acquisition order, but also to suggest a TE (optecho * esp) that would result in optimal image quality for the chosen ETL.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">bestecho</td><td>Pointer to the echo number in the train that should be placed at the center of k-space given the current ETL and ESP </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">optecho</td><td>Pointer to the optimal echo number in the train that would allow k-space to be sampled linearly (to reduce T2-blurring and ghosting) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pe</td><td>Pointer to a <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">TE</td><td>(Echo Time in [us]) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">etl</td><td>(EchoTrain Length) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">esp</td><td>(Echo Spacing in [us]) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                                                                                                   {</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  <span class="keywordtype">int</span> numshots, i;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  <span class="keywordtype">int</span> nacqlines_earlyside;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  <span class="keywordflow">if</span> (etl &lt; 1) {</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ksfse_calc_echo: ETL (arg 5) must be at least 1&quot;</span>);</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  }</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  <span class="keywordflow">if</span> (pe-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a> &lt; 1) {</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ksfse_calc_echo: field &#39;.numlinestoacq&#39; in 3rd arg must be at least 1&quot;</span>);</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;  }</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  <span class="keywordflow">if</span> (etl &gt; pe-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a>) {</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ksfse_calc_echo: ETL (arg 5) cannot exceed number of lines to acquire&quot;</span>);</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  }</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  <span class="keywordflow">if</span> (esp &lt;= 0) {</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ksfse_calc_echo: ESP (arg 6) must be larger than 1&quot;</span>);</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  }</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  <span class="comment">/* Number of shots */</span></div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  numshots = CEIL_DIV(pe-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a>, etl);</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  <span class="comment">/* index &#39;i&#39; will stop incrementing as we pass the center of k-space */</span></div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; pe-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a> - 1; i++) {</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="keywordflow">if</span> (((pe-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a> - 1) / 2.0 - pe-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[i]) &lt; 0)</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;  }</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;  <span class="keywordflow">if</span> (pe-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a> &gt;= 0) {</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <span class="comment">/* bottom-up (i.e. early echoes are below k-space center) */</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    nacqlines_earlyside = pe-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a> - i;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  }  <span class="keywordflow">else</span> {</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <span class="comment">/* top-down (i.e. early echoes are above k-space center) */</span></div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    nacqlines_earlyside = i;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;  }</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  <span class="keywordflow">if</span> (etl % 2) {</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    <span class="comment">/* etl is odd. The optimal echo will straddle around the center of k-space */</span></div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <span class="keywordflow">if</span> (optecho != NULL)</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;      *optecho = (double) CEIL_DIV((nacqlines_earlyside + numshots / 2), numshots); <span class="comment">/* integer value since ETL is odd */</span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="keywordflow">if</span> (bestecho != NULL) {</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;      *bestecho = floor((<span class="keywordtype">double</span>) TE / (<span class="keywordtype">double</span>) esp + 0.5); <span class="comment">/* integer */</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;      <span class="keywordflow">if</span> (*bestecho &lt; 1)</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        *bestecho = 1;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;      <span class="keywordflow">if</span> (*bestecho &gt; etl)</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        *bestecho = etl;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    }</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    <span class="comment">/* etl is even. The optimal two echoes will be placed above and below k-space center, respectively */</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <span class="keywordflow">if</span> (optecho != NULL)</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;      *optecho = (double) CEIL_DIV(nacqlines_earlyside, numshots) + 0.5; <span class="comment">/* half-integer value since ETL is even */</span></div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <span class="keywordflow">if</span> (bestecho != NULL) {</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;      <span class="keywordflow">if</span> (etl == 2) {</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;        <span class="comment">/* special case for ETL = 2 */</span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;        <span class="keywordflow">if</span> (TE &lt; 1.25 * esp)</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;          *bestecho = 1; <span class="comment">/* 1st echo straddling around k-space center */</span></div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (TE &lt; 1.75 * esp)</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;          *bestecho = 1.5; <span class="comment">/* 1st/end echo below/above k-space center */</span></div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;          *bestecho = 2; <span class="comment">/* 2nd echo straddling around k-space center */</span></div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        *bestecho = floor((<span class="keywordtype">double</span>) TE / (<span class="keywordtype">double</span>) esp) + 0.5; <span class="comment">/* half-integer */</span></div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        <span class="keywordflow">if</span> (*bestecho &lt;= 1.5)</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;          *bestecho = 1; <span class="comment">/* minTE, back to integer &#39;bestecho&#39; for center-out encoding */</span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        <span class="keywordflow">if</span> (*bestecho &gt;= (etl - 0.5))</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;          *bestecho = etl; <span class="comment">/* max TE, back to integer &#39;bestecho&#39; for out-center encoding */</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;      }</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    }</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;  }</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  <span class="keywordflow">if</span> (optecho != NULL) {</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="comment">/* Partial Fourier MinTE case, regardless if ETL is even or odd */</span></div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <span class="keywordflow">if</span> ((pe-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a> &gt; 0) &amp;&amp; (nacqlines_earlyside &lt;= numshots / 2))</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;      *optecho = 1;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <span class="comment">/* Partial Fourier MaxTE case, regardless if ETL is even or odd */</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    <span class="keywordflow">if</span> ((pe-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a> &lt; 0) &amp;&amp; (nacqlines_earlyside &gt;= (pe-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[i] - numshots / 2)))</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;      *optecho = etl;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;  }</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;} <span class="comment">/* ks_fse_calcecho() */</span></div><div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">KS_PHASER::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1527</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a09b1a7dc77a7cf8c4e8421a23608a42a"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">KS_PHASER::numlinestoacq</a></div><div class="ttdeci">int numlinestoacq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1532</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a090fbced834ec878a08eadc4f829b8a3"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">KS_PHASER::linetoacq</a></div><div class="ttdeci">int linetoacq[KS_MAX_PHASEDYN]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1533</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a29cf05caf131eb2c5915a41b18af16d0"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">KS_PHASER::nover</a></div><div class="ttdeci">int nover</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1528</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6101f1a037684c71a6c5d654671824f9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6101f1a037684c71a6c5d654671824f9">&#9670;&nbsp;</a></span>ks_phaseencoding_generate_2Dfse()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_phaseencoding_generate_2Dfse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *&#160;</td>
          <td class="paramname"><em>phaseenc_plan_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const&#160;</td>
          <td class="paramname"><em>desc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *&#160;</td>
          <td class="paramname"><em>phaser</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *&#160;</td>
          <td class="paramname"><em>zphaser</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>TE</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>etl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>esp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>2DFSE: Makes a <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> depending on etl, desired TE, and echo spacing (esp)</h4>
</p>
<p>This function is only executed on TGT and will return early when called on HOST.</p>
<p>The phase encoding sorting is depending on many factors. First, the desired TE will dictate which one (or two) of the echoes in the FSE train (of length <code>etl</code>) that should be placed in the center. This is determined based on the properties of the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object (phase encoding gradients in the FSE train), <code>TE</code> and <code>esp</code> by calling <a class="el" href="ksfse__implementation_8e.html#af287d52efc92c8e069e341c3eb00de99">ksfse_calc_echo()</a>.</p>
<p>Second, the sorting of the echoes will first of all depend on whether <code>bestecho</code> is equal to <code>optecho</code>. If it is, then the <code>etl</code> echoes can be placed out linearly in k-space (from the bottom-&gt;top of k-space, or vice versa). This will produce the best image quality with minimal T2-blurring and FSE ghosting.</p>
<p>As partial ky Fourier is allowed, this function first checks on which side (top or bottom half) of k-space that has more room for the echo indices that are either before or after the <code>bestecho</code> index corresponding to the desired <code>TE</code>. The goal with this is to try to sweep k-space as linearly as possible in as much of the center portion of k-space as possible when <code>bestecho != optecho</code>.</p>
<p>When <code>bestecho != optecho</code>, there will be data from either the first or last echo indices that won't fit in k-space if placed next to a neighboring index. If this data would be placed on the other size of k-space (that still needs lines to be filled in), where e.g. echo index #0 would be placed next to echo index #(etl-1), strong ghosting will occur due to the much strong signal from echo #0 compared to #(etl-1). With an echo train length of <code>etl</code>, k-space is filled in <code>numshots = ceil(numlinestoacq / etl</code>. Using half of the numshots lines for each echo index a linear sweep of the center half of k-space can is layed out. To avoid FSE ghosting, the numshots/2 remaining lines for each early or late echo index are placed such as neighboring ky lines will never have a change in echo index by more than one. For example if <code>etl = 8</code>, <code>esp = 10 ms</code> and <code>TE = 25</code>, then <code>bestecho = 1.5</code> and <code>optecho = 4.5</code>. We avoid to sort the echoes in the following k-space order for ghosting reasons: 7-6-0-1*2-3-4-5 (* = k-space center) since there will be a strong discontinuity between 6 and 0. Instead we use groups of numshots/2 per echo index (and get two groups per echo index in k-space): 5-4-3-2-1-0-0-1*2-3-4-5-6-7-6-5</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">phaseenc_plan_ptr</td><td>Pointer to <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">desc</td><td>A description (text string) of the <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> object. This description is used in the psd plot. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">phaser</td><td>Pointer to a <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">zphaser</td><td>Pointer to a <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> (3D) or NULL (2D) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">TE</td><td>(Echo Time in [us]) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">etl</td><td>(EchoTrain Length) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">esp</td><td>(Echo Spacing in [us]) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<p>Grouping shots for each of the ETL echoes in k-space: We don't place all shots for each echo together in k-space since we need to make a z-shaped pattern to avoid ghosting. Instead we let half of the shots be one group (of size 'cgroupsize') that we place in the central ~50% of k-space, which allows us to get a linear sweep in this central half of k-space using all 'etl' echoes, regardless of the chosen effective TE. The actual center-ness depends on TE, and the remaining of k-space is filled using the echoes belonging to the latter 'numshots-cgroupsize' number of shots. At the edges of k-space, numshots*etl seldom match up to the chosen opyres, but numshots*etl is always &gt;= opyres thanks to the CEIL_DIV at the beginning of this function. The surplus echoes we don't need are numshots*etl - opyres (for full Fourier and no ARC), and as they are already tagged as -1 = KS_NOTSET in the beginning of this function, they will be placed in baseline view (0) in the <a class="el" href="ksfse__implementation_8e.html#a1b80282dd477cfb811a5ca903a6616b1" title="Plays out all phase encodes for all slices belonging to one pass">ksfse_scan_acqloop()</a></p>
<div class="fragment"><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                                                                                                                                                                           {</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;  <span class="keywordtype">int</span> i, j, ky, kz;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  <span class="keywordtype">int</span> numshots, numkz;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;  <span class="keywordtype">double</span> bestecho, optecho;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;  <span class="keywordtype">int</span> nacqlines_earlyside;</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;  <span class="keywordtype">int</span> cgroupsize, halfgroupsize;</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;  <span class="keywordtype">int</span> bottomup = <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;  <span class="keywordtype">int</span> cstart, cshift;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;  STATUS status;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;  strncpy(phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, desc, <a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> - 1);</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;  phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>[<a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> - 1] = 0;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;  <span class="comment">/* don&#39;t allow empty description or a description with leading space */</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;  <span class="keywordflow">if</span> (phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a1c544bec41003a594ba4ec7d43a3a470">description</a> == NULL || phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>[0] == <span class="charliteral">&#39; &#39;</span>) {</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: description of phase encoding plan (2nd arg) cannot be NULL or leading space&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;  }</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;  <span class="keywordflow">if</span> (etl &lt; 1) {</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    <span class="keywordflow">return</span> SUCCESS; <span class="comment">/* we haven&#39;t set it up yet */</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;  }</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;  <span class="keywordflow">if</span> (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a> &lt; 2) {</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: field &#39;.numlinestoacq&#39; in 2nd arg must be at least 2&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;  }</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;  <span class="keywordflow">if</span> (etl &gt; phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a>) {</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: ETL cannot exceed number of lines to acquire&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;  }</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  <span class="comment">/* Number of shots (2D) */</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  numshots = CEIL_DIV(phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a>, etl);</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;  <span class="comment">/* Number of kz */</span></div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;  numkz = (zphaser != NULL) ? zphaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a> : 1;</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;  <span class="comment">/* allocate KS_PHASEENCODING_PLAN table (all entries will be initialized to KS_NOTSET) */</span></div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;  status = <a class="code" href="_k_s_foundation__common_8c.html#ad3b39ba8c626f4580806078dc4f4b211">ks_phaseencoding_resize</a>(phaseenc_plan_ptr, etl, numshots * numkz);</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;  phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a706b4cec8ea7b1363975e556d74de924">phaser</a> = phaser;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;  phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a08736562d66b16003d4e795e95860cf7">zphaser</a> = zphaser;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;  <span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;  <span class="keywordflow">for</span> (kz = 0; kz &lt; numkz; kz++) {</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    <span class="keywordflow">if</span> (etl == 1) {</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;      <span class="comment">/* Special case for ETL = 1. Just acquire the data in order */</span></div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;      <span class="keywordflow">for</span> (ky = 0; ky &lt; phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a>; ky++) {</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        <a class="code" href="_k_s_foundation__common_8c.html#abb524977b3e7a48a58dad2370166df9b">ks_phaseencoding_set</a>(phaseenc_plan_ptr,</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;                             0, ky + kz * phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a>,</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;                             phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[ky], (zphaser != NULL) ? zphaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[kz] : <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>);</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;      }</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;      <span class="comment">/* ETL &gt; 1 (this is a long else-statement) */</span></div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;      <span class="comment">/* index &#39;i&#39; will stop incrementing as we pass the center of k-space */</span></div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;      <span class="keywordflow">for</span> (i = 0; i &lt; phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a> - 1; i++) {</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;        <span class="keywordflow">if</span> (((phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a> - 1) / 2.0 - phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[i]) &lt; 0)</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;      }</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;      <span class="keywordflow">if</span> (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a> &gt;= 0) {</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        <span class="comment">/* bottom-up (i.e. early echoes are below k-space center) */</span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;        nacqlines_earlyside = phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a> - i;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;        bottomup = TRUE;</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;      }  <span class="keywordflow">else</span> {</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        <span class="comment">/* top-down (i.e. early echoes are above k-space center) */</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        nacqlines_earlyside = i;</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        bottomup = FALSE;</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;      }</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;      <span class="comment">/* get the best echo number for the given TE/ETL/ESP, and also the optimal echo number that would allow for a linear k-space sweep */</span></div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;      status = <a class="code" href="_k_s_foundation__common_8c.html#ad6d4710baf0864b0e04ba55908a52666">ks_fse_calcecho</a>(&amp;bestecho, &amp;optecho, phaser, TE, etl, esp);</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;      <span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;      <span class="keywordflow">if</span> (bestecho == optecho) {</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;        <span class="comment">/* we can place the echoes linearly in k-space in groups of &#39;numshots&#39; per echo given the current combination of TE, ETL and ESP */</span></div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;        cgroupsize = numshots;</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;        halfgroupsize = floor((<span class="keywordtype">float</span>) phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a> / (etl * 2.0) + 0.5);</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        cgroupsize = (int) ceil((<span class="keywordtype">float</span>) phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a> / (etl * 2.0)); <span class="comment">/* ~numshots/2 lines per etl in the central 50% of k-space */</span></div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;        halfgroupsize = floor((<span class="keywordtype">float</span>) phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a> / (etl * 4.0) + 0.5);</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;      }</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;      <span class="comment">/* if bestecho == optecho: Place out all echoes</span></div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;<span class="comment">        if bestecho != optecho: Place out the center half of lines */</span></div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;      <span class="keywordflow">if</span> (bestecho == 1) <span class="comment">/* minTE */</span></div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;        cshift = cgroupsize;</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bestecho == etl) <span class="comment">/* maxTE */</span></div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;        cshift = 0;</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;        cshift = halfgroupsize; <span class="comment">/* non-extreme TE */</span></div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;      cstart = (nacqlines_earlyside + cshift) - cgroupsize * bestecho;</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;      <span class="keywordflow">if</span> (bottomup == TRUE)</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;        cstart = phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a> - cstart - 1;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;      ky = cstart;</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;      <span class="keywordflow">for</span> (i = 0; i &lt; etl; i++) {</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;        <span class="keywordflow">for</span> (j = 0; j &lt; cgroupsize; j++) {</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;          <span class="keywordflow">if</span> (ky &gt;= 0 &amp;&amp; ky &lt; phaser-&gt;numlinestoacq) {</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;            <a class="code" href="_k_s_foundation__common_8c.html#abb524977b3e7a48a58dad2370166df9b">ks_phaseencoding_set</a>(phaseenc_plan_ptr, i, j + kz * numshots, phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[ky], (zphaser != NULL) ? zphaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[kz] : <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>);</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;          }</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;          <span class="keywordflow">if</span> (bottomup == TRUE)</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;            ky--;</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;            ky++;</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;        }</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;      }</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;      <span class="keywordflow">if</span> (bestecho != optecho) {</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;        <span class="comment">/* remaining &#39;numshots-cgroupsize&#39; number of shots for late echoes */</span></div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;        i = etl - 1;</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;        <span class="keywordflow">while</span> (i &gt;= 0) {</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;          <span class="keywordflow">for</span> (j = cgroupsize; j &lt; numshots; j++) {</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;            <span class="keywordflow">if</span> (ky &gt;= 0 &amp;&amp; ky &lt; phaser-&gt;numlinestoacq) {</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;              <a class="code" href="_k_s_foundation__common_8c.html#abb524977b3e7a48a58dad2370166df9b">ks_phaseencoding_set</a>(phaseenc_plan_ptr, i, j + kz * numshots, phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[ky], (zphaser != NULL) ? zphaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[kz] : <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>);</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;            }</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;            <span class="keywordflow">if</span> (bottomup == TRUE)</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;              ky--;</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;              ky++;</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;          } <span class="comment">/* for j */</span></div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;          i--;</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;        }</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;        <span class="comment">/* remaining &#39;numshots-cgroupsize&#39; number of shots for early echoes */</span></div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;        <span class="keywordflow">if</span> (bottomup == TRUE)</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;          ky = cstart + 1;</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;          ky = cstart - 1;</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        i = 0;</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;        <span class="keywordflow">while</span> (i &lt; etl) {</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;          <span class="keywordflow">for</span> (j = cgroupsize; j &lt; numshots; j++) {</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;            <span class="keywordflow">if</span> (ky &gt;= 0 &amp;&amp; ky &lt; phaser-&gt;numlinestoacq) {</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;              <a class="code" href="_k_s_foundation__common_8c.html#abb524977b3e7a48a58dad2370166df9b">ks_phaseencoding_set</a>(phaseenc_plan_ptr, i, j + kz * numshots, phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[ky], (zphaser != NULL) ? zphaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[kz] : <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>);</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;            }</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;            <span class="keywordflow">if</span> (bottomup == TRUE)</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;              ky++;</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;              ky--;</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;          } <span class="comment">/* for j */</span></div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;          i++;</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;        }</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;      } <span class="comment">/* bestecho != optecho */</span></div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    } <span class="comment">/* etl &gt; 1 */</span></div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;  } <span class="comment">/* numkz */</span></div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;} <span class="comment">/* ks_phaseencoding_generate_2Dfse() */</span></div><div class="ttc" id="_k_s_foundation__common_8c_html_abb524977b3e7a48a58dad2370166df9b"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abb524977b3e7a48a58dad2370166df9b">ks_phaseencoding_set</a></div><div class="ttdeci">void ks_phaseencoding_set(KS_PHASEENCODING_PLAN *phaseenc_plan_ptr, int echo, int shot, int ky, int kz)</div><div class="ttdoc">Set [ky,kz] coordinate from KS_PHASEENCODING_PLAN for given echo and shot</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:328</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_ad3b39ba8c626f4580806078dc4f4b211"><div class="ttname"><a href="_k_s_foundation__common_8c.html#ad3b39ba8c626f4580806078dc4f4b211">ks_phaseencoding_resize</a></div><div class="ttdeci">STATUS ks_phaseencoding_resize(KS_PHASEENCODING_PLAN *phaseenc_plan_ptr, int etl, int num_shots)</div><div class="ttdoc">Reallocate memory for KS_PHASEENCODING_PLAN entries</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:389</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">KS_PHASER::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1527</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_afd953f31b866a09e0418967c2bf65a59"><div class="ttname"><a href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a></div><div class="ttdeci">#define KS_NOTSET</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:60</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a09b1a7dc77a7cf8c4e8421a23608a42a"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">KS_PHASER::numlinestoacq</a></div><div class="ttdeci">int numlinestoacq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1532</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a090fbced834ec878a08eadc4f829b8a3"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">KS_PHASER::linetoacq</a></div><div class="ttdeci">int linetoacq[KS_MAX_PHASEDYN]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1533</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_ad6d4710baf0864b0e04ba55908a52666"><div class="ttname"><a href="_k_s_foundation__common_8c.html#ad6d4710baf0864b0e04ba55908a52666">ks_fse_calcecho</a></div><div class="ttdeci">STATUS ks_fse_calcecho(double *bestecho, double *optecho, KS_PHASER *pe, int TE, int etl, int esp)</div><div class="ttdoc">Calculates the ETL index corresponding the desired TE given a KS_PHASER object and echo spacing...</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:513</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aacb2fe1d83c45e8d0525f363bdd6b8a6"><div class="ttname"><a href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a></div><div class="ttdeci">#define KS_DESCRIPTION_LENGTH</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:112</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a1c544bec41003a594ba4ec7d43a3a470">KS_PHASEENCODING_PLAN::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1589</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a29cf05caf131eb2c5915a41b18af16d0"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">KS_PHASER::nover</a></div><div class="ttdeci">int nover</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1528</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a08736562d66b16003d4e795e95860cf7"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a08736562d66b16003d4e795e95860cf7">KS_PHASEENCODING_PLAN::zphaser</a></div><div class="ttdeci">KS_PHASER * zphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1592</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a706b4cec8ea7b1363975e556d74de924"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a706b4cec8ea7b1363975e556d74de924">KS_PHASEENCODING_PLAN::phaser</a></div><div class="ttdeci">KS_PHASER * phaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1591</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af63cac5b01cd2842a511f6e8e99472e9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af63cac5b01cd2842a511f6e8e99472e9">&#9670;&nbsp;</a></span>ks_phaseencoding_generate_epi()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_phaseencoding_generate_epi </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *&#160;</td>
          <td class="paramname"><em>phaseenc_plan_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const&#160;</td>
          <td class="paramname"><em>desc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *&#160;</td>
          <td class="paramname"><em>epitrain</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>blipsign</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>numkyshots</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>numsegments</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>caipi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>EPI: Makes a <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> suitable for 2D or 3D epi</h4>
</p>
<p>The etl is the number of readouts in the EPI train, derived from the phaser. The number of ky shots is also given by the phaser, while the number of kz shots is given by zphaser. Any partial fourier is handled by the phasers, and acceleration and acs lines in the z direction is handled by zphaser. For 3D EPI, the number of shots in the phase encoding plan will be the product of the number of shots in the ky direction and the number of kz lines to acquire.</p>
<p>Each shot will be played out in a single kz plane. The shot order will be linear in ky and kz. The ky shots will be in the inner loop, unless kzshotsfirst is TRUE.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">phaseenc_plan_ptr</td><td>Pointer to the phase encoding plan </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">desc</td><td>A description (text string) of the <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html" title="Phase encoding plan for the sequence (2D and 3D)">KS_PHASEENCODING_PLAN</a> object. This description is used in the psd plot. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">epitrain</td><td>Pointer to a <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">blipsign</td><td>Should be either <code>KS_EPI_POSBLIPS</code> or <code>KS_EPI_NEGBLIPS</code> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">numkyshots</td><td>Number of ky shots to play. Must be within 1-R and evenly divisble with R. Set =1 for single-shot EPI. Set to phaser.R for full multi-shot EPI. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">numsegments</td><td>Number of kz encodes to play <br />
</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">caipi</td><td>Use CAIPIRINHA sampling pattern (affects 3D epi only) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;                                                                                                                                                                                          {</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;  <span class="keywordflow">if</span> (epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a> &lt; 2 &amp;&amp; (epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a> != epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a>)) {</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: field &#39;.numlinestoacq&#39; of epitrain-&gt;blipphaser must be at least 2, not %d&quot;</span>, __FUNCTION__, epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a>);</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;  }</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;  strncpy(phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, desc, <a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> - 1);</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;  phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>[<a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> - 1] = 0;</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;  <span class="comment">/* don&#39;t allow empty description or a description with leading space */</span></div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;  <span class="keywordflow">if</span> (phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a1c544bec41003a594ba4ec7d43a3a470">description</a> == NULL || phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>[0] == <span class="charliteral">&#39; &#39;</span>) {</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: description of phase encoding plan (2nd arg) cannot be NULL or leading space&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;  }</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;  <span class="keywordtype">int</span> readout, shot, kyshot, kyview, kzview, kzind;</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;  <span class="keywordtype">int</span> etl, numfullsegments, numshots, totalnumshots;</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;  <span class="keywordtype">int</span> shift;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;  STATUS status;</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;  <span class="comment">/* Number of shots (2D) */</span></div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;  <span class="keywordflow">if</span> (numkyshots &lt; 1 || numkyshots &gt; epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a> || (epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a> % numkyshots != 0)) {</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: numkyshots (=%d) must be in range 1-R and evenly divisible with R (=%d)&quot;</span>, __FUNCTION__, numkyshots, epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a>);</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;  }</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;  <span class="comment">/* Number of segments (3D) */</span></div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;  <span class="keywordflow">if</span> (epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a> != <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a> &amp;&amp; (numsegments &lt; 1 || numsegments &gt; epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a>)) {</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: numsegments (=%d) must be in range 1-zphaser.numlinestoacq (=%d)&quot;</span>, __FUNCTION__, numsegments, epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a>);</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;  }</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;  <span class="comment">/* Number of readouts per EPI train (etl) */</span></div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;  etl = epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a>;</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;  <span class="comment">/* Check number of kz segments and how many should be fully sampled (controlled by zphaser.nacslines) */</span></div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;  <span class="keywordflow">if</span> (epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a> == <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>) { <span class="comment">/* 2D epi */</span></div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    numsegments = 1;</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    numfullsegments = (numkyshots == epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a>);</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;  } <span class="keywordflow">else</span> { <span class="comment">/* 3D epi */</span></div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    <span class="keywordflow">if</span> (epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a> == 1) {</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;      numfullsegments = epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a4762b9a6307f0223b3d1dfde7e8ddce8">nacslines</a>; <span class="comment">/* special interpretation for zR=1 */</span></div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    } <span class="keywordflow">else</span> { <span class="comment">/* zR &gt; 1 */</span></div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;      <span class="keywordflow">if</span> (epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a4762b9a6307f0223b3d1dfde7e8ddce8">nacslines</a> &gt; 0) {</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;        numfullsegments = 1; <span class="comment">/* initialize */</span></div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        <span class="keywordflow">for</span> (kzind = 1; kzind &lt; numsegments; kzind++) {</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;          <span class="keywordflow">if</span> (abs(epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[kzind]-epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[kzind-1])==1) {</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;            numfullsegments++;</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;          }</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;        }</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;      } <span class="keywordflow">else</span> { <span class="comment">/* no kz &quot;acs lines&quot; */</span></div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;        numfullsegments = 0;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;      }</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    }</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;  }</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;  <span class="comment">/* allocate KS_PHASEENCODING_PLAN table (all entries will be initialized to KS_NOTSET) */</span></div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;  totalnumshots = numfullsegments * epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a> + (numsegments-numfullsegments) * numkyshots;</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;  status = <a class="code" href="_k_s_foundation__common_8c.html#ad3b39ba8c626f4580806078dc4f4b211">ks_phaseencoding_resize</a>(phaseenc_plan_ptr, etl, totalnumshots);</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;  phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a706b4cec8ea7b1363975e556d74de924">phaser</a> = &amp;epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>;</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;  phaseenc_plan_ptr-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a08736562d66b16003d4e795e95860cf7">zphaser</a> = &amp;epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>;</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;  <span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;  shot = 0; <span class="comment">/* initialize */</span></div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;  <span class="keywordflow">for</span> (kzind = 0; kzind &lt; numsegments; kzind++) {</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    kzview = (epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a> &gt; 0) ? epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[kzind] : <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>;</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    </div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    if (kzview != <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a> &amp;&amp; abs(kzview*2 - (epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a>-1)) &lt;= numfullsegments) {</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;      numshots = epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a>;</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;      numshots = numkyshots;</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;    }</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    <span class="keywordflow">for</span> (kyshot = 0; kyshot &lt; numshots; kyshot++) {</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;      <span class="keywordflow">for</span> (readout = 0; readout &lt; etl; readout++) {</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;        shift = kyshot * (epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a> / numshots); <span class="comment">/* ky shot shift */</span></div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;        shift = (shift + (kzview/epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a>) * caipi_delta) % epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a>; <span class="comment">/* CAIPIRINHA shift */</span></div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;        <span class="keywordflow">if</span> (blipsign == <a class="code" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811a5b332d904cae8d59fc2f85b49ada0ae4">KS_EPI_NEGBLIPS</a>) {</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;          kyview = epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[readout] + shift;</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (blipsign == <a class="code" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811ab36b1c8bcdbe924fc9d4a36cde9ba4dd">KS_EPI_POSBLIPS</a>) {</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;          kyview = epitrain-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[(etl - 1) - readout] + shift;</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: blipsign must be KS_EPI_POSBLIPS or KS_EPI_NEGBLIPS, not %d&quot;</span>, __FUNCTION__, blipsign);</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;        }</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;        <a class="code" href="_k_s_foundation__common_8c.html#abb524977b3e7a48a58dad2370166df9b">ks_phaseencoding_set</a>(phaseenc_plan_ptr, readout, shot, kyview, kzview);</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;      } <span class="comment">/* readout */</span></div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;      shot++;</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    } <span class="comment">/* kyshot */</span></div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;  } <span class="comment">/* kzind */</span></div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;} <span class="comment">/* ks_phaseencoding_generate_epi() */</span></div><div class="ttc" id="_k_s_foundation__common_8c_html_abb524977b3e7a48a58dad2370166df9b"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abb524977b3e7a48a58dad2370166df9b">ks_phaseencoding_set</a></div><div class="ttdeci">void ks_phaseencoding_set(KS_PHASEENCODING_PLAN *phaseenc_plan_ptr, int echo, int shot, int ky, int kz)</div><div class="ttdoc">Set [ky,kz] coordinate from KS_PHASEENCODING_PLAN for given echo and shot</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:328</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a3d90133d3051fbc4816d02efd9566d8e"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">KS_PHASER::R</a></div><div class="ttdeci">int R</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1529</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_ad3b39ba8c626f4580806078dc4f4b211"><div class="ttname"><a href="_k_s_foundation__common_8c.html#ad3b39ba8c626f4580806078dc4f4b211">ks_phaseencoding_resize</a></div><div class="ttdeci">STATUS ks_phaseencoding_resize(KS_PHASEENCODING_PLAN *phaseenc_plan_ptr, int etl, int num_shots)</div><div class="ttdoc">Reallocate memory for KS_PHASEENCODING_PLAN entries</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:389</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">KS_PHASER::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1527</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a4762b9a6307f0223b3d1dfde7e8ddce8"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a4762b9a6307f0223b3d1dfde7e8ddce8">KS_PHASER::nacslines</a></div><div class="ttdeci">int nacslines</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1530</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_afd953f31b866a09e0418967c2bf65a59"><div class="ttname"><a href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a></div><div class="ttdeci">#define KS_NOTSET</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:60</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a22cd0313e5ffabe8393f77745dba8d52"><div class="ttname"><a href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">KS_EPI::blipphaser</a></div><div class="ttdeci">KS_PHASER blipphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1688</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a09b1a7dc77a7cf8c4e8421a23608a42a"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">KS_PHASER::numlinestoacq</a></div><div class="ttdeci">int numlinestoacq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1532</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_ad76a5ac226f0d25f70349ef83b5bc38a"><div class="ttname"><a href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">KS_EPI::zphaser</a></div><div class="ttdeci">KS_PHASER zphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1689</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a090fbced834ec878a08eadc4f829b8a3"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">KS_PHASER::linetoacq</a></div><div class="ttdeci">int linetoacq[KS_MAX_PHASEDYN]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1533</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aacb2fe1d83c45e8d0525f363bdd6b8a6"><div class="ttname"><a href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a></div><div class="ttdeci">#define KS_DESCRIPTION_LENGTH</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:112</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a1c544bec41003a594ba4ec7d43a3a470">KS_PHASEENCODING_PLAN::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1589</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ae3a267da7c3c7e4e6e523dafba9b7811ab36b1c8bcdbe924fc9d4a36cde9ba4dd"><div class="ttname"><a href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811ab36b1c8bcdbe924fc9d4a36cde9ba4dd">KS_EPI_POSBLIPS</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1741</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a08736562d66b16003d4e795e95860cf7"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a08736562d66b16003d4e795e95860cf7">KS_PHASEENCODING_PLAN::zphaser</a></div><div class="ttdeci">KS_PHASER * zphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1592</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ae3a267da7c3c7e4e6e523dafba9b7811a5b332d904cae8d59fc2f85b49ada0ae4"><div class="ttname"><a href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811a5b332d904cae8d59fc2f85b49ada0ae4">KS_EPI_NEGBLIPS</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1741</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a706b4cec8ea7b1363975e556d74de924"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a706b4cec8ea7b1363975e556d74de924">KS_PHASEENCODING_PLAN::phaser</a></div><div class="ttdeci">KS_PHASER * phaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1591</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a99557514f220cf0e97668286792e79cb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a99557514f220cf0e97668286792e79cb">&#9670;&nbsp;</a></span>ks_calc_sliceplan()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_calc_sliceplan </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_l_i_c_e___p_l_a_n.html">KS_SLICE_PLAN</a> *&#160;</td>
          <td class="paramname"><em>slice_plan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nslices</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>slperpass</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Calculates the data acquisition order for a standard interleaved 2D scans using one or more passes</h4>
</p>
<p>This function calls ks_calc_slice_acquisition_order_interleaved() with the last argument being 2, indicating an interleave factor of 2. This will make odd slices in each pass to be acquired first, followed by the even slices.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">slice_plan</td><td>The slice plan (<a class="el" href="struct_k_s___s_l_i_c_e___p_l_a_n.html" title="Struct holding all information about slice locations and aquisition order">KS_SLICE_PLAN</a>) set up earlier using <a class="el" href="_k_s_foundation_8h.html#a99557514f220cf0e97668286792e79cb" title="Calculates the data acquisition order for a standard interleaved 2D scans using one or more passes...">ks_calc_sliceplan()</a> or similar </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nslices</td><td>Total number of slices (usually opslquant) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">slperpass</td><td>Number of slices per pass (i.e. per TR) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;                                                                                {</div><div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;</div><div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__host_8c.html#a7f48f728f188959481f3a203f7ffe853">ks_calc_sliceplan_interleaved</a>(slice_plan, nslices, slperpass, 2);</div><div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;</div><div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;}</div><div class="ttc" id="_k_s_foundation__host_8c_html_a7f48f728f188959481f3a203f7ffe853"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a7f48f728f188959481f3a203f7ffe853">ks_calc_sliceplan_interleaved</a></div><div class="ttdeci">STATUS ks_calc_sliceplan_interleaved(KS_SLICE_PLAN *slice_plan, int nslices, int slperpass, int inpass_interleaves)</div><div class="ttdoc">Calculates the data acquisition order for custom interleaved 2D scans using one or more passes...</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3435</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7f48f728f188959481f3a203f7ffe853"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7f48f728f188959481f3a203f7ffe853">&#9670;&nbsp;</a></span>ks_calc_sliceplan_interleaved()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_calc_sliceplan_interleaved </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_l_i_c_e___p_l_a_n.html">KS_SLICE_PLAN</a> *&#160;</td>
          <td class="paramname"><em>slice_plan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nslices</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>slperpass</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>inpass_interleaves</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Calculates the data acquisition order for custom interleaved 2D scans using one or more passes</h4>
</p>
<p>The last argument to this function indicates the interleave factor of slices <em>within</em> each pass. If this value is</p><ul>
<li>1: The slices will be acquired in spatial order (<em>within</em> each pass)</li>
<li>2: The odd slices will be acquired first, followed by the even slices in each pass (standard practice)</li>
<li>3: etc.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">slice_plan</td><td>Pointer to the slice plan (<a class="el" href="struct_k_s___s_l_i_c_e___p_l_a_n.html" title="Struct holding all information about slice locations and aquisition order">KS_SLICE_PLAN</a>) set up earlier using <a class="el" href="_k_s_foundation_8h.html#a99557514f220cf0e97668286792e79cb" title="Calculates the data acquisition order for a standard interleaved 2D scans using one or more passes...">ks_calc_sliceplan()</a> or similar </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nslices</td><td>Total number of slices (usually opslquant) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">slperpass</td><td>Number of slices per pass (i.e. per TR) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">inpass_interleaves</td><td>Interleave factor of slices in a pass </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;                                                                                                                    {</div><div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;</div><div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;  <span class="keywordflow">if</span> (!slice_plan) {</div><div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: invalid input, slice_plan is NULL&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;  }</div><div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;</div><div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;  <span class="keywordflow">if</span> (nslices &lt;= 0 || slperpass &lt;= 0 || inpass_interleaves &lt;= 0) {</div><div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: invalid input (nslices: %d, slperpass: %d, inpass_interleaves: %d)&quot;</span>,</div><div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;             __FUNCTION__, nslices, slperpass, inpass_interleaves);</div><div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;  }</div><div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;</div><div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;  slice_plan-&gt;<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a3414dc896f1276457707d70318d46770">nslices</a> = nslices;</div><div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;  slice_plan-&gt;<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a3c4ea64a2a861da12849cb565afab129">nslices_per_pass</a> = slperpass;</div><div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;  slice_plan-&gt;<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a9cd9ebd93187231e5c4109d14c0dd69c">npasses</a> = CEIL_DIV(nslices, slperpass);</div><div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;</div><div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;  <span class="keywordtype">int</span> nslicesthispass[slice_plan-&gt;<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a9cd9ebd93187231e5c4109d14c0dd69c">npasses</a>];</div><div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;  <span class="keywordtype">int</span> sllocthispass[slice_plan-&gt;<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a9cd9ebd93187231e5c4109d14c0dd69c">npasses</a>][slperpass];</div><div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;  <span class="keywordtype">int</span> i, p, s, k, t, intleaves;</div><div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;<span class="comment">  - slice_plan-&gt;npasses: a.k.a. number of acquisitions (standard GE CV is: `acqs`)</span></div><div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;<span class="comment">  - slperpass: maximum number of slices in a pass (some passes may have fewer slices)</span></div><div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;<span class="comment">  - nslicesthispass[slice_plan-&gt;npasses]: Array where each element indicates how many slices to acquired in this pass</span></div><div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;<span class="comment">  - sllocthispass[slice_plan-&gt;npasses][slperpass]: Spatial location index into the prescribed slice stack, i.e. all slices</span></div><div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;<span class="comment">    for current pass and pass_sliceindx (spatially sorted)</span></div><div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;  <span class="keywordflow">for</span> (p = 0; p &lt; slice_plan-&gt;<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a9cd9ebd93187231e5c4109d14c0dd69c">npasses</a>; p++) {</div><div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;    nslicesthispass[p] = 0;</div><div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;    <span class="keywordflow">for</span> (s = 0; s &lt; slperpass; s++) {</div><div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;      sllocthispass[p][s] = -1;</div><div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;      <span class="keywordflow">if</span> (s * slice_plan-&gt;<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a9cd9ebd93187231e5c4109d14c0dd69c">npasses</a> + p &lt; nslices) {</div><div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;        nslicesthispass[p]++;</div><div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;        sllocthispass[p][s] = p + (s * slice_plan-&gt;<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a9cd9ebd93187231e5c4109d14c0dd69c">npasses</a>);</div><div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;      }</div><div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;    }</div><div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;  }</div><div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;</div><div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;  <span class="keywordflow">for</span> (p = 0; p &lt; slice_plan-&gt;<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a9cd9ebd93187231e5c4109d14c0dd69c">npasses</a>; p++) {</div><div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;    t = 0; <span class="comment">/* linearly increasing time index in current pass */</span></div><div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;    <span class="keywordflow">for</span> (intleaves = 0; intleaves &lt; inpass_interleaves; intleaves++) {</div><div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;      <span class="comment">/* intleaves: slice interleaves *within* each pass */</span></div><div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;      <span class="keywordflow">for</span> (i = 0; i &lt; CEIL_DIV(nslicesthispass[p], inpass_interleaves); i++) {</div><div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;        k = intleaves + i * inpass_interleaves; <span class="comment">/* pass_sliceindx */</span></div><div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;        <span class="keywordflow">if</span> (k &lt; nslicesthispass[p]) {</div><div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;          slice_plan-&gt;<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#af6c9bb6611e03718085512d2c90cfcd8">acq_order</a>[sllocthispass[p][k]].slloc  = sllocthispass[p][k]; <span class="comment">/* Spatial location index into the prescribed slice stack */</span></div><div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;          slice_plan-&gt;<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#af6c9bb6611e03718085512d2c90cfcd8">acq_order</a>[sllocthispass[p][k]].slpass = p; <span class="comment">/* pass index */</span></div><div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;          slice_plan-&gt;<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#af6c9bb6611e03718085512d2c90cfcd8">acq_order</a>[sllocthispass[p][k]].sltime = t++; <span class="comment">/* time index in current pass. 0-&gt;nslicesthispass[p] */</span></div><div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;        }</div><div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;      }</div><div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;    }</div><div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;  }</div><div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;</div><div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;}</div><div class="ttc" id="struct_k_s___s_l_i_c_e___p_l_a_n_html_af6c9bb6611e03718085512d2c90cfcd8"><div class="ttname"><a href="struct_k_s___s_l_i_c_e___p_l_a_n.html#af6c9bb6611e03718085512d2c90cfcd8">KS_SLICE_PLAN::acq_order</a></div><div class="ttdeci">DATA_ACQ_ORDER acq_order[SLICE_FACTOR *DATA_ACQ_MAX]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1203</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___s_l_i_c_e___p_l_a_n_html_a3c4ea64a2a861da12849cb565afab129"><div class="ttname"><a href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a3c4ea64a2a861da12849cb565afab129">KS_SLICE_PLAN::nslices_per_pass</a></div><div class="ttdeci">int nslices_per_pass</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1202</div></div>
<div class="ttc" id="struct_k_s___s_l_i_c_e___p_l_a_n_html_a9cd9ebd93187231e5c4109d14c0dd69c"><div class="ttname"><a href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a9cd9ebd93187231e5c4109d14c0dd69c">KS_SLICE_PLAN::npasses</a></div><div class="ttdeci">int npasses</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1201</div></div>
<div class="ttc" id="struct_k_s___s_l_i_c_e___p_l_a_n_html_a3414dc896f1276457707d70318d46770"><div class="ttname"><a href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a3414dc896f1276457707d70318d46770">KS_SLICE_PLAN::nslices</a></div><div class="ttdeci">int nslices</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1200</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aac2f0903f17dde40e22ddbf22cbd6986"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aac2f0903f17dde40e22ddbf22cbd6986">&#9670;&nbsp;</a></span>ks_calc_sliceplan_sms()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_calc_sliceplan_sms </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_l_i_c_e___p_l_a_n.html">KS_SLICE_PLAN</a> *&#160;</td>
          <td class="paramname"><em>slice_plan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nslices</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>slperpass</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>multiband_factor</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Calculates the data acquisition order for simulaneous-multi-slice (SMS)2D scans</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">slice_plan</td><td>The slice plan (<a class="el" href="struct_k_s___s_l_i_c_e___p_l_a_n.html" title="Struct holding all information about slice locations and aquisition order">KS_SLICE_PLAN</a>) set up earlier using <a class="el" href="_k_s_foundation_8h.html#a99557514f220cf0e97668286792e79cb" title="Calculates the data acquisition order for a standard interleaved 2D scans using one or more passes...">ks_calc_sliceplan()</a> or similar </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nslices</td><td>Total number of slices (usually opslquant) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">slperpass</td><td>Number of slices per pass (i.e. per TR) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">multiband_factor</td><td>Number of SMS slices </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;                                                                                                          {</div><div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;  <span class="keywordtype">int</span> slices_per_stack, passes_per_stack;</div><div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;  STATUS status;</div><div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;</div><div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;  <span class="comment">/* sanitize the input */</span></div><div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;  multiband_factor = multiband_factor &lt; 1 ? 1 : multiband_factor;</div><div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;  nslices = nslices &lt; 0 ? 1 : nslices;</div><div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;  slperpass = slperpass &lt; 0 ? 1 : slperpass;</div><div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160;</div><div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;  <span class="keywordflow">if</span> (slperpass &gt; nslices)</div><div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;    slperpass = nslices;</div><div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;</div><div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;  <span class="comment">/* no SMS?, fall back to standard slice plan */</span></div><div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;  <span class="keywordflow">if</span> (multiband_factor == 1) {</div><div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;    status = <a class="code" href="_k_s_foundation__host_8c.html#a99557514f220cf0e97668286792e79cb">ks_calc_sliceplan</a>(slice_plan, nslices, slperpass);</div><div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;    <span class="keywordflow">return</span> status;</div><div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;  }</div><div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;</div><div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;  <span class="comment">/* a &#39;stack&#39; is a group of slices out of the prescribed slices (opslquant), where the #slices in the stack is equal to</span></div><div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;<span class="comment">     opslquant / multiband_factor. The stack does only cover 1/multiband_factor of the entire slice FOV (i.e. not interleaved).</span></div><div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;<span class="comment">     The exact number of slices in each stack is ceil(opslquant/multiband_factor), which may often lead to that more slices than</span></div><div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;<span class="comment">     prescribed need to be acquired for divisibility */</span></div><div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;  slices_per_stack = CEIL_DIV(nslices, multiband_factor);</div><div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;</div><div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;  <span class="comment">/* number of passes per TR for one slice stack */</span></div><div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;  passes_per_stack = CEIL_DIV(slices_per_stack, slperpass);</div><div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;</div><div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;  <span class="keywordflow">if</span> (passes_per_stack == 1) {</div><div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;    <span class="comment">/* we can fit all slices in the stack in 1 pass (acquisition), i.e. one TR. Do SMS-specific slice interleaving */</span></div><div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;    <a class="code" href="_k_s_foundation__host_8c.html#a8f3e58077353097578c86efc198e8a6a">ks_calc_slice_acquisition_order_smssingleacq</a>(slice_plan-&gt;<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#af6c9bb6611e03718085512d2c90cfcd8">acq_order</a>, slices_per_stack);</div><div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;    <span class="comment">/* need 2+ acqs to acquire the &#39;slices_per_stack&#39; slices. Do standard slice interleaving */</span></div><div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;    <a class="code" href="_k_s_foundation__host_8c.html#a99557514f220cf0e97668286792e79cb">ks_calc_sliceplan</a>(slice_plan, slices_per_stack, slperpass);</div><div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;  }</div><div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;</div><div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;  <span class="comment">/* copy to stacks 2-&gt;multiband_factor */</span></div><div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;  slice_plan-&gt;<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a3414dc896f1276457707d70318d46770">nslices</a> = slices_per_stack * multiband_factor;</div><div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;  slice_plan-&gt;<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a9cd9ebd93187231e5c4109d14c0dd69c">npasses</a> = passes_per_stack * multiband_factor;</div><div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;</div><div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;  <span class="keywordflow">for</span> (i = slices_per_stack; i &lt; slice_plan-&gt;<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a3414dc896f1276457707d70318d46770">nslices</a>; i++) {</div><div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;    <span class="keywordtype">int</span> slice_in_stack = i % slices_per_stack;</div><div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;    <span class="keywordtype">int</span> stack = i / slices_per_stack;</div><div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;    slice_plan-&gt;<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#af6c9bb6611e03718085512d2c90cfcd8">acq_order</a>[i].slloc  = i;</div><div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;    slice_plan-&gt;<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#af6c9bb6611e03718085512d2c90cfcd8">acq_order</a>[i].slpass = slice_plan-&gt;<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#af6c9bb6611e03718085512d2c90cfcd8">acq_order</a>[slice_in_stack].slpass + stack * passes_per_stack;</div><div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;    slice_plan-&gt;<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#af6c9bb6611e03718085512d2c90cfcd8">acq_order</a>[i].sltime = slice_plan-&gt;<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#af6c9bb6611e03718085512d2c90cfcd8">acq_order</a>[slice_in_stack].sltime;</div><div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;  }</div><div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;</div><div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;}</div><div class="ttc" id="struct_k_s___s_l_i_c_e___p_l_a_n_html_af6c9bb6611e03718085512d2c90cfcd8"><div class="ttname"><a href="struct_k_s___s_l_i_c_e___p_l_a_n.html#af6c9bb6611e03718085512d2c90cfcd8">KS_SLICE_PLAN::acq_order</a></div><div class="ttdeci">DATA_ACQ_ORDER acq_order[SLICE_FACTOR *DATA_ACQ_MAX]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1203</div></div>
<div class="ttc" id="struct_k_s___s_l_i_c_e___p_l_a_n_html_a9cd9ebd93187231e5c4109d14c0dd69c"><div class="ttname"><a href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a9cd9ebd93187231e5c4109d14c0dd69c">KS_SLICE_PLAN::npasses</a></div><div class="ttdeci">int npasses</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1201</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a99557514f220cf0e97668286792e79cb"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a99557514f220cf0e97668286792e79cb">ks_calc_sliceplan</a></div><div class="ttdeci">STATUS ks_calc_sliceplan(KS_SLICE_PLAN *slice_plan, int nslices, int slperpass)</div><div class="ttdoc">Calculates the data acquisition order for a standard interleaved 2D scans using one or more passes...</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3429</div></div>
<div class="ttc" id="struct_k_s___s_l_i_c_e___p_l_a_n_html_a3414dc896f1276457707d70318d46770"><div class="ttname"><a href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a3414dc896f1276457707d70318d46770">KS_SLICE_PLAN::nslices</a></div><div class="ttdeci">int nslices</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1200</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a8f3e58077353097578c86efc198e8a6a"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a8f3e58077353097578c86efc198e8a6a">ks_calc_slice_acquisition_order_smssingleacq</a></div><div class="ttdeci">int ks_calc_slice_acquisition_order_smssingleacq(DATA_ACQ_ORDER *dacq, int nslices)</div><div class="ttdoc">Calculates the data acquisition order for single acquisition SMS</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3606</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8f3e58077353097578c86efc198e8a6a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8f3e58077353097578c86efc198e8a6a">&#9670;&nbsp;</a></span>ks_calc_slice_acquisition_order_smssingleacq()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_calc_slice_acquisition_order_smssingleacq </td>
          <td>(</td>
          <td class="paramtype">DATA_ACQ_ORDER *&#160;</td>
          <td class="paramname"><em>dacq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nslices</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Calculates the data acquisition order for single acquisition SMS</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">dacq</td><td>Data acquisition order array (local) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nslices</td><td>Total number of slices prescribed </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">int</td><td>Resulting number of passes (or acqs) (in this case 1) </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l03606"></a><span class="lineno"> 3606</span>&#160;                                                                                    {</div><div class="line"><a name="l03607"></a><span class="lineno"> 3607</span>&#160;</div><div class="line"><a name="l03608"></a><span class="lineno"> 3608</span>&#160;  <span class="keywordflow">return</span> nslices % 2 ?</div><div class="line"><a name="l03609"></a><span class="lineno"> 3609</span>&#160;    <a class="code" href="_k_s_foundation__host_8c.html#a958fb1bcfef5fdd1b4572da93b7fd846">ks_calc_slice_acquisition_order_smssingleacq_impl</a>(dacq, nslices, 2) :</div><div class="line"><a name="l03610"></a><span class="lineno"> 3610</span>&#160;    <a class="code" href="_k_s_foundation__host_8c.html#a958fb1bcfef5fdd1b4572da93b7fd846">ks_calc_slice_acquisition_order_smssingleacq_impl</a>(dacq, nslices, 3);</div><div class="line"><a name="l03611"></a><span class="lineno"> 3611</span>&#160;}</div><div class="ttc" id="_k_s_foundation__host_8c_html_a958fb1bcfef5fdd1b4572da93b7fd846"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a958fb1bcfef5fdd1b4572da93b7fd846">ks_calc_slice_acquisition_order_smssingleacq_impl</a></div><div class="ttdeci">int ks_calc_slice_acquisition_order_smssingleacq_impl(DATA_ACQ_ORDER *dacq, int nslices, int interleave)</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3569</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1b518a3194e4b40d969342a8c6c87357"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1b518a3194e4b40d969342a8c6c87357">&#9670;&nbsp;</a></span>ks_calc_sms_min_gap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_calc_sms_min_gap </td>
          <td>(</td>
          <td class="paramtype">DATA_ACQ_ORDER *&#160;</td>
          <td class="paramname"><em>dacq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nslices</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Calculates the minimum time gap between adjacent slices in a SMS acquisition</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">dacq</td><td>Data acquisition order array (local) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nslices</td><td>Total number of slices prescribed </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">int</td><td>The minimum time gap between adjacent slices </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;                                                           {</div><div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;  <span class="keywordtype">int</span> min_gap = nslices;</div><div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;  <span class="keywordtype">int</span> min_index = -1;</div><div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;</div><div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;  <span class="keywordflow">for</span> (i=1; i&lt;nslices; i++) {</div><div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;    <span class="keywordtype">int</span> gap = abs(dacq[i-1].sltime - dacq[i].sltime);</div><div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;    <span class="keywordflow">if</span> (gap &lt; min_gap) {</div><div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;      min_gap = gap;</div><div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;      min_index = i-1;</div><div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;    }</div><div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;  }</div><div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;</div><div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;  <span class="keywordtype">int</span> last_to_first = nslices - dacq[nslices-1].sltime;</div><div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160;  <span class="keywordflow">if</span> (last_to_first &lt; min_gap) {</div><div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;    min_gap = last_to_first;</div><div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;    min_index = nslices-1;</div><div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;  }</div><div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160;</div><div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;  <span class="keywordflow">return</span> min_gap;</div><div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a4052b13d56c45955a6bd6c8f57f4cbc6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4052b13d56c45955a6bd6c8f57f4cbc6">&#9670;&nbsp;</a></span>ks_print_sliceplan()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_print_sliceplan </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_k_s___s_l_i_c_e___p_l_a_n.html">KS_SLICE_PLAN</a>&#160;</td>
          <td class="paramname"><em>slice_plan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE *&#160;</td>
          <td class="paramname"><em>fp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Writes a <a class="el" href="struct_k_s___s_l_i_c_e___p_l_a_n.html" title="Struct holding all information about slice locations and aquisition order">KS_SLICE_PLAN</a> to a file pointer</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">slice_plan</td><td><a class="el" href="struct_k_s___s_l_i_c_e___p_l_a_n.html" title="Struct holding all information about slice locations and aquisition order">KS_SLICE_PLAN</a> for the sequence </td></tr>
    <tr><td class="paramname">fp</td><td>A file pointer (or <code>stderr</code>) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l03640"></a><span class="lineno"> 3640</span>&#160;                                                                  {</div><div class="line"><a name="l03641"></a><span class="lineno"> 3641</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l03642"></a><span class="lineno"> 3642</span>&#160;</div><div class="line"><a name="l03643"></a><span class="lineno"> 3643</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;\nSlice Plan:\n&quot;</span>);</div><div class="line"><a name="l03644"></a><span class="lineno"> 3644</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;=============================================\n&quot;</span>);</div><div class="line"><a name="l03645"></a><span class="lineno"> 3645</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;Number of slices: %d\n&quot;</span>, slice_plan.<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a3414dc896f1276457707d70318d46770">nslices</a>);</div><div class="line"><a name="l03646"></a><span class="lineno"> 3646</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;Number of passes: %d\n&quot;</span>, slice_plan.<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a9cd9ebd93187231e5c4109d14c0dd69c">npasses</a>);</div><div class="line"><a name="l03647"></a><span class="lineno"> 3647</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;Slices per pass:  %d\n&quot;</span>, slice_plan.<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a3c4ea64a2a861da12849cb565afab129">nslices_per_pass</a>);</div><div class="line"><a name="l03648"></a><span class="lineno"> 3648</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;\nslpass\tsltime\tslloc\n&quot;</span>);</div><div class="line"><a name="l03649"></a><span class="lineno"> 3649</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;---------------------------------------------\n&quot;</span>);</div><div class="line"><a name="l03650"></a><span class="lineno"> 3650</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; slice_plan.<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a3414dc896f1276457707d70318d46770">nslices</a>; i++) { <span class="comment">/* i = spatial location */</span></div><div class="line"><a name="l03651"></a><span class="lineno"> 3651</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;%03d   \t%03d   \t%03d\n&quot;</span>, slice_plan.<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#af6c9bb6611e03718085512d2c90cfcd8">acq_order</a>[i].slpass, slice_plan.<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#af6c9bb6611e03718085512d2c90cfcd8">acq_order</a>[i].sltime, slice_plan.<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#af6c9bb6611e03718085512d2c90cfcd8">acq_order</a>[i].slloc);</div><div class="line"><a name="l03652"></a><span class="lineno"> 3652</span>&#160;  }</div><div class="line"><a name="l03653"></a><span class="lineno"> 3653</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;=============================================\n\n&quot;</span>);</div><div class="line"><a name="l03654"></a><span class="lineno"> 3654</span>&#160;</div><div class="line"><a name="l03655"></a><span class="lineno"> 3655</span>&#160;}</div><div class="ttc" id="struct_k_s___s_l_i_c_e___p_l_a_n_html_af6c9bb6611e03718085512d2c90cfcd8"><div class="ttname"><a href="struct_k_s___s_l_i_c_e___p_l_a_n.html#af6c9bb6611e03718085512d2c90cfcd8">KS_SLICE_PLAN::acq_order</a></div><div class="ttdeci">DATA_ACQ_ORDER acq_order[SLICE_FACTOR *DATA_ACQ_MAX]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1203</div></div>
<div class="ttc" id="struct_k_s___s_l_i_c_e___p_l_a_n_html_a3c4ea64a2a861da12849cb565afab129"><div class="ttname"><a href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a3c4ea64a2a861da12849cb565afab129">KS_SLICE_PLAN::nslices_per_pass</a></div><div class="ttdeci">int nslices_per_pass</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1202</div></div>
<div class="ttc" id="struct_k_s___s_l_i_c_e___p_l_a_n_html_a9cd9ebd93187231e5c4109d14c0dd69c"><div class="ttname"><a href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a9cd9ebd93187231e5c4109d14c0dd69c">KS_SLICE_PLAN::npasses</a></div><div class="ttdeci">int npasses</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1201</div></div>
<div class="ttc" id="struct_k_s___s_l_i_c_e___p_l_a_n_html_a3414dc896f1276457707d70318d46770"><div class="ttname"><a href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a3414dc896f1276457707d70318d46770">KS_SLICE_PLAN::nslices</a></div><div class="ttdeci">int nslices</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1200</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a01d67d3faa8f2088f82af10aa0a28af0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a01d67d3faa8f2088f82af10aa0a28af0">&#9670;&nbsp;</a></span>ks_print_waveform()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_print_waveform </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a>&#160;</td>
          <td class="paramname"><em>waveform</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>filename</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>res</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Writes a KS_WAVEFORM to disk with the specified filename</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">waveform</td><td>A KS_WAVEFORM (i.e. float array) to be written </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">filename</td><td>String with the output file name </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">res</td><td>Number of elements in the waveform to be written </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l03658"></a><span class="lineno"> 3658</span>&#160;                                                                            {</div><div class="line"><a name="l03659"></a><span class="lineno"> 3659</span>&#160;</div><div class="line"><a name="l03660"></a><span class="lineno"> 3660</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l03661"></a><span class="lineno"> 3661</span>&#160;  FILE *asciiWaveFile;</div><div class="line"><a name="l03662"></a><span class="lineno"> 3662</span>&#160;  asciiWaveFile = fopen(filename, <span class="stringliteral">&quot;w&quot;</span>);</div><div class="line"><a name="l03663"></a><span class="lineno"> 3663</span>&#160;</div><div class="line"><a name="l03664"></a><span class="lineno"> 3664</span>&#160;  <span class="keywordflow">if</span> (asciiWaveFile == NULL) {</div><div class="line"><a name="l03665"></a><span class="lineno"> 3665</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l03666"></a><span class="lineno"> 3666</span>&#160;  }</div><div class="line"><a name="l03667"></a><span class="lineno"> 3667</span>&#160;</div><div class="line"><a name="l03668"></a><span class="lineno"> 3668</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; res; i++) {</div><div class="line"><a name="l03669"></a><span class="lineno"> 3669</span>&#160;    fprintf(asciiWaveFile, <span class="stringliteral">&quot;%d %f\n&quot;</span>, i, waveform[i]); fflush(asciiWaveFile);</div><div class="line"><a name="l03670"></a><span class="lineno"> 3670</span>&#160;  }</div><div class="line"><a name="l03671"></a><span class="lineno"> 3671</span>&#160;</div><div class="line"><a name="l03672"></a><span class="lineno"> 3672</span>&#160;  fclose(asciiWaveFile); <span class="comment">/* close ascii file */</span></div><div class="line"><a name="l03673"></a><span class="lineno"> 3673</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a3f19152aa56909ba2178e0266cce0928"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3f19152aa56909ba2178e0266cce0928">&#9670;&nbsp;</a></span>ks_print_read()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_print_read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_e_a_d.html">KS_READ</a>&#160;</td>
          <td class="paramname"><em>read</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE *&#160;</td>
          <td class="paramname"><em>fp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Writes out the contents of a <a class="el" href="struct_k_s___r_e_a_d.html" title="Core sequence object that handles a data acquisition window">KS_READ</a> sequence object for debugging</h4>
</p>
<p>If 2nd argument is <code>stderr</code> or <code>stdout</code>, the printed result will be seen in WTools for simulation. On the MR system, <code>stderr</code> will show up in one of the mgd_term windows. A file pointer (opened with e.g. fp = fopen("/usr/g/mrraw/myname.txt","w")) saves a text file to disk</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">read</td><td>A <a class="el" href="struct_k_s___r_e_a_d.html" title="Core sequence object that handles a data acquisition window">KS_READ</a> object to be printed </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fp</td><td>A file pointer (or <code>stderr</code>) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l03676"></a><span class="lineno"> 3676</span>&#160;                                        {</div><div class="line"><a name="l03677"></a><span class="lineno"> 3677</span>&#160;  <span class="keywordflow">if</span> (a.description == NULL || a.duration == 0)</div><div class="line"><a name="l03678"></a><span class="lineno"> 3678</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l03679"></a><span class="lineno"> 3679</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;%s.duration: %d\n&quot;</span>, a.description, a.duration);</div><div class="line"><a name="l03680"></a><span class="lineno"> 3680</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;%s.rbw: %g\n&quot;</span>, a.description, a.rbw);</div><div class="line"><a name="l03681"></a><span class="lineno"> 3681</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;%s.filt.decimation: %g\n&quot;</span>, a.description, a.filt.decimation);</div><div class="line"><a name="l03682"></a><span class="lineno"> 3682</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;%s.filt.tdaq: %d\n&quot;</span>, a.description, a.filt.tdaq);</div><div class="line"><a name="l03683"></a><span class="lineno"> 3683</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;%s.filt.bw: %g\n&quot;</span>, a.description , a.filt.bw);</div><div class="line"><a name="l03684"></a><span class="lineno"> 3684</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;%s.filt.tsp: %g\n&quot;</span>, a.description, a.filt.tsp);</div><div class="line"><a name="l03685"></a><span class="lineno"> 3685</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;%s.filt.outputs: %d\n&quot;</span>, a.description, a.filt.outputs);</div><div class="line"><a name="l03686"></a><span class="lineno"> 3686</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;%s.filt.prefills: %d\n&quot;</span>, a.description, a.filt.prefills);</div><div class="line"><a name="l03687"></a><span class="lineno"> 3687</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;%s.filt.taps: %d\n&quot;</span>, a.description, a.filt.taps);</div><div class="line"><a name="l03688"></a><span class="lineno"> 3688</span>&#160;  fflush(fp);</div><div class="line"><a name="l03689"></a><span class="lineno"> 3689</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a1abdbad21b51b6554580840ef8376e0d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1abdbad21b51b6554580840ef8376e0d">&#9670;&nbsp;</a></span>ks_print_trap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_print_trap </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a>&#160;</td>
          <td class="paramname"><em>trap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE *&#160;</td>
          <td class="paramname"><em>fp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Writes out the contents of a <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> sequence object for debugging</h4>
</p>
<p>If 2nd argument is <code>stderr</code> or <code>stdout</code>, the printed result will be seen in WTools for simulation. On the MR system, <code>stderr</code> will show up in one of the mgd_term windows. A file pointer (opened with e.g. fp = fopen("/usr/g/mrraw/myname.txt","w")) saves a text file to disk</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">trap</td><td>A <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object to be printed </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fp</td><td>A file pointer (or <code>stderr</code>) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l03691"></a><span class="lineno"> 3691</span>&#160;                                        {</div><div class="line"><a name="l03692"></a><span class="lineno"> 3692</span>&#160;  <span class="keywordflow">if</span> (t.description == NULL || t.duration == 0)</div><div class="line"><a name="l03693"></a><span class="lineno"> 3693</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l03694"></a><span class="lineno"> 3694</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;%s.amp: %g\n&quot;</span>, t.description, t.amp);</div><div class="line"><a name="l03695"></a><span class="lineno"> 3695</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;%s.ramptime: %d\n&quot;</span>, t.description, t.ramptime);</div><div class="line"><a name="l03696"></a><span class="lineno"> 3696</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;%s.plateautime: %d\n&quot;</span>, t.description, t.plateautime);</div><div class="line"><a name="l03697"></a><span class="lineno"> 3697</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;%s.duration: %d\n&quot;</span>, t.description , t.duration);</div><div class="line"><a name="l03698"></a><span class="lineno"> 3698</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;%s.area: %g\n&quot;</span>, t.description, t.area);</div><div class="line"><a name="l03699"></a><span class="lineno"> 3699</span>&#160;  fflush(fp);</div><div class="line"><a name="l03700"></a><span class="lineno"> 3700</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a13a8f8b8bd8fccfc5bae9cef555053ad"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a13a8f8b8bd8fccfc5bae9cef555053ad">&#9670;&nbsp;</a></span>ks_print_readtrap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_print_readtrap </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a>&#160;</td>
          <td class="paramname"><em>readtrap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE *&#160;</td>
          <td class="paramname"><em>fp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Writes out the contents of a <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> sequence object for debugging</h4>
</p>
<p>If 2nd argument is <code>stderr</code> or <code>stdout</code>, the printed result will be seen in WTools for simulation. On the MR system, <code>stderr</code> will show up in one of the mgd_term windows. A file pointer (opened with e.g. fp = fopen("/usr/g/mrraw/myname.txt","w")) saves a text file to disk</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">readtrap</td><td>A <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> object to be printed </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fp</td><td>A file pointer (or <code>stderr</code>) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l03702"></a><span class="lineno"> 3702</span>&#160;                                                {</div><div class="line"><a name="l03703"></a><span class="lineno"> 3703</span>&#160;    <span class="keywordflow">if</span> (r.grad.description == NULL || r.grad.duration == 0)</div><div class="line"><a name="l03704"></a><span class="lineno"> 3704</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l03705"></a><span class="lineno"> 3705</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;\nKS_READTRAP (%s):\n&quot;</span>, r.grad.description);</div><div class="line"><a name="l03706"></a><span class="lineno"> 3706</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;fov: %g\n&quot;</span>, r.fov);</div><div class="line"><a name="l03707"></a><span class="lineno"> 3707</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;res: %d\n&quot;</span>, r.res);</div><div class="line"><a name="l03708"></a><span class="lineno"> 3708</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;rampsampling: %d\n&quot;</span>, r.rampsampling);</div><div class="line"><a name="l03709"></a><span class="lineno"> 3709</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;nover: %d\n&quot;</span>, r.nover);</div><div class="line"><a name="l03710"></a><span class="lineno"> 3710</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;acqdelay: %d\n&quot;</span>, r.acqdelay);</div><div class="line"><a name="l03711"></a><span class="lineno"> 3711</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;area2center: %g\n&quot;</span>, r.area2center);</div><div class="line"><a name="l03712"></a><span class="lineno"> 3712</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;time2center: %d\n&quot;</span>, r.time2center);</div><div class="line"><a name="l03713"></a><span class="lineno"> 3713</span>&#160;  fflush(fp);</div><div class="line"><a name="l03714"></a><span class="lineno"> 3714</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#a945e0b44fe314e54891871b10c5853ef">ks_print_read</a>(r.acq, fp);</div><div class="line"><a name="l03715"></a><span class="lineno"> 3715</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#a62a0c665210657b3fec394fc2251b16a">ks_print_trap</a>(r.grad, fp);</div><div class="line"><a name="l03716"></a><span class="lineno"> 3716</span>&#160;  <span class="keywordflow">if</span> (r.omega.duration &gt; 0) {</div><div class="line"><a name="l03717"></a><span class="lineno"> 3717</span>&#160;    <a class="code" href="_k_s_foundation__host_8c.html#a62a0c665210657b3fec394fc2251b16a">ks_print_trap</a>(r.omega, fp);</div><div class="line"><a name="l03718"></a><span class="lineno"> 3718</span>&#160;  }</div><div class="line"><a name="l03719"></a><span class="lineno"> 3719</span>&#160;}</div><div class="ttc" id="_k_s_foundation__host_8c_html_a62a0c665210657b3fec394fc2251b16a"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a62a0c665210657b3fec394fc2251b16a">ks_print_trap</a></div><div class="ttdeci">void ks_print_trap(KS_TRAP t, FILE *fp)</div><div class="ttdoc">Writes out the contents of a KS_TRAP sequence object for debugging</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3691</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a945e0b44fe314e54891871b10c5853ef"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a945e0b44fe314e54891871b10c5853ef">ks_print_read</a></div><div class="ttdeci">void ks_print_read(KS_READ a, FILE *fp)</div><div class="ttdoc">Writes out the contents of a KS_READ sequence object for debugging</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3676</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4f5dffeec30279ac23c5f12ecb868575"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4f5dffeec30279ac23c5f12ecb868575">&#9670;&nbsp;</a></span>ks_print_phaser()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_print_phaser </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a>&#160;</td>
          <td class="paramname"><em>phaser</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE *&#160;</td>
          <td class="paramname"><em>fp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Writes out the contents of a <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> sequence object for debugging</h4>
</p>
<p>If 2nd argument is <code>stderr</code> or <code>stdout</code>, the printed result will be seen in WTools for simulation. On the MR system, <code>stderr</code> will show up in one of the mgd_term windows. A file pointer (opened with e.g. fp = fopen("/usr/g/mrraw/myname.txt","w")) saves a text file to disk</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">phaser</td><td>A <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object to be printed </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fp</td><td>A file pointer (or <code>stderr</code>) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l03721"></a><span class="lineno"> 3721</span>&#160;                                            {</div><div class="line"><a name="l03722"></a><span class="lineno"> 3722</span>&#160;  <span class="keywordflow">if</span> (p.grad.description == NULL || p.grad.duration == 0)</div><div class="line"><a name="l03723"></a><span class="lineno"> 3723</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l03724"></a><span class="lineno"> 3724</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;\nKS_PHASER (%s):\n&quot;</span>, p.grad.description);</div><div class="line"><a name="l03725"></a><span class="lineno"> 3725</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;fov: %g\n&quot;</span>, p.fov);</div><div class="line"><a name="l03726"></a><span class="lineno"> 3726</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;res: %d\n&quot;</span>, p.res);</div><div class="line"><a name="l03727"></a><span class="lineno"> 3727</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;nover: %d\n&quot;</span>, p.nover);</div><div class="line"><a name="l03728"></a><span class="lineno"> 3728</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;R: %d\n&quot;</span>, p.R);</div><div class="line"><a name="l03729"></a><span class="lineno"> 3729</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;nacslines: %d\n&quot;</span>, p.nacslines);</div><div class="line"><a name="l03730"></a><span class="lineno"> 3730</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;areaoffset: %g\n&quot;</span>, p.areaoffset);</div><div class="line"><a name="l03731"></a><span class="lineno"> 3731</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;numlinestoacq: %d\n&quot;</span>, p.numlinestoacq);</div><div class="line"><a name="l03732"></a><span class="lineno"> 3732</span>&#160;  fflush(fp);</div><div class="line"><a name="l03733"></a><span class="lineno"> 3733</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#a62a0c665210657b3fec394fc2251b16a">ks_print_trap</a>(p.grad, fp);</div><div class="line"><a name="l03734"></a><span class="lineno"> 3734</span>&#160;}</div><div class="ttc" id="_k_s_foundation__host_8c_html_a62a0c665210657b3fec394fc2251b16a"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a62a0c665210657b3fec394fc2251b16a">ks_print_trap</a></div><div class="ttdeci">void ks_print_trap(KS_TRAP t, FILE *fp)</div><div class="ttdoc">Writes out the contents of a KS_TRAP sequence object for debugging</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3691</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a11d7a5bdd7f74891cb50bff1401a339a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a11d7a5bdd7f74891cb50bff1401a339a">&#9670;&nbsp;</a></span>ks_print_epi()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_print_epi </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a>&#160;</td>
          <td class="paramname"><em>epi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE *&#160;</td>
          <td class="paramname"><em>fp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Writes out the contents of a <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> sequence object for debugging</h4>
</p>
<p>If 2nd argument is <code>stderr</code> or <code>stdout</code>, the printed result will be seen in WTools for simulation. On the MR system, <code>stderr</code> will show up in one of the mgd_term windows. A file pointer (opened with e.g. fp = fopen("/usr/g/mrraw/myname.txt","w")) saves a text file to disk</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">epi</td><td>A <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> object to be printed </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fp</td><td>A file pointer (or <code>stderr</code>) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l03754"></a><span class="lineno"> 3754</span>&#160;                                      {</div><div class="line"><a name="l03755"></a><span class="lineno"> 3755</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;\nKS_EPI (%s):\n&quot;</span>, s.read.grad.description);</div><div class="line"><a name="l03756"></a><span class="lineno"> 3756</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;etl: %d\n&quot;</span>, s.etl);</div><div class="line"><a name="l03757"></a><span class="lineno"> 3757</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;read_spacing: %.2f [ms]\n&quot;</span>, s.read_spacing / 1000.0);</div><div class="line"><a name="l03758"></a><span class="lineno"> 3758</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;duration: %.2f [ms]\n&quot;</span>, s.duration / 1000.0);</div><div class="line"><a name="l03759"></a><span class="lineno"> 3759</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;time2center: %.2f [ms]\n&quot;</span>, s.time2center / 1000.0);</div><div class="line"><a name="l03760"></a><span class="lineno"> 3760</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#a5162f015200730857e9b566df393cac6">ks_print_readtrap</a>(s.read, fp);</div><div class="line"><a name="l03761"></a><span class="lineno"> 3761</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#a62a0c665210657b3fec394fc2251b16a">ks_print_trap</a>(s.readphaser, fp);</div><div class="line"><a name="l03762"></a><span class="lineno"> 3762</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#a62a0c665210657b3fec394fc2251b16a">ks_print_trap</a>(s.blip, fp);</div><div class="line"><a name="l03763"></a><span class="lineno"> 3763</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#ab54bd6ee808fdba9f21b9f789e857aac">ks_print_phaser</a>(s.blipphaser, fp);</div><div class="line"><a name="l03764"></a><span class="lineno"> 3764</span>&#160;} <span class="comment">/* ks_print_epi */</span></div><div class="ttc" id="_k_s_foundation__host_8c_html_a62a0c665210657b3fec394fc2251b16a"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a62a0c665210657b3fec394fc2251b16a">ks_print_trap</a></div><div class="ttdeci">void ks_print_trap(KS_TRAP t, FILE *fp)</div><div class="ttdoc">Writes out the contents of a KS_TRAP sequence object for debugging</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3691</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a5162f015200730857e9b566df393cac6"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a5162f015200730857e9b566df393cac6">ks_print_readtrap</a></div><div class="ttdeci">void ks_print_readtrap(KS_READTRAP r, FILE *fp)</div><div class="ttdoc">Writes out the contents of a KS_READTRAP sequence object for debugging</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3702</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_ab54bd6ee808fdba9f21b9f789e857aac"><div class="ttname"><a href="_k_s_foundation__host_8c.html#ab54bd6ee808fdba9f21b9f789e857aac">ks_print_phaser</a></div><div class="ttdeci">void ks_print_phaser(KS_PHASER p, FILE *fp)</div><div class="ttdoc">Writes out the contents of a KS_PHASER sequence object for debugging</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3721</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af2b15d59387f060a3efb5841db53b1fe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af2b15d59387f060a3efb5841db53b1fe">&#9670;&nbsp;</a></span>ks_print_rf()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_print_rf </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_f.html">KS_RF</a>&#160;</td>
          <td class="paramname"><em>rf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE *&#160;</td>
          <td class="paramname"><em>fp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Writes out the contents of a <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> sequence object for debugging</h4>
</p>
<p>If 2nd argument is <code>stderr</code> or <code>stdout</code>, the printed result will be seen in WTools for simulation. On the MR system, <code>stderr</code> will show up in one of the mgd_term windows. A file pointer (opened with e.g. fp = fopen("/usr/g/mrraw/myname.txt","w")) saves a text file to disk</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">rf</td><td>A <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object to be printed </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fp</td><td>A file pointer (or <code>stderr</code>) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l03796"></a><span class="lineno"> 3796</span>&#160;                                    {</div><div class="line"><a name="l03797"></a><span class="lineno"> 3797</span>&#160;  <span class="keywordflow">if</span> (r.rfpulse.activity == 0) {</div><div class="line"><a name="l03798"></a><span class="lineno"> 3798</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l03799"></a><span class="lineno"> 3799</span>&#160;  }</div><div class="line"><a name="l03800"></a><span class="lineno"> 3800</span>&#160;</div><div class="line"><a name="l03801"></a><span class="lineno"> 3801</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;\nKS_RF (%s):\n&quot;</span>, r.rfwave.description);</div><div class="line"><a name="l03802"></a><span class="lineno"> 3802</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;%s\n&quot;</span>, r.designinfo);</div><div class="line"><a name="l03803"></a><span class="lineno"> 3803</span>&#160;  <span class="keywordflow">switch</span> (r.role) {</div><div class="line"><a name="l03804"></a><span class="lineno"> 3804</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedace0db3ff9bb8cad071dc42579e9aadaf">KS_RF_ROLE_NOTSET</a>: fprintf(fp, <span class="stringliteral">&quot;role: KS_RF_ROLE_NOTSET\n&quot;</span>); <span class="keywordflow">break</span>;</div><div class="line"><a name="l03805"></a><span class="lineno"> 3805</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedacc16dd3ca09dedaf6334a39ee4e46241">KS_RF_ROLE_EXC</a>: fprintf(fp, <span class="stringliteral">&quot;role: KS_RF_ROLE_EXC\n&quot;</span>); <span class="keywordflow">break</span>;</div><div class="line"><a name="l03806"></a><span class="lineno"> 3806</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142beda8f1b938816b04ffdeb45de47204252fd">KS_RF_ROLE_REF</a>: fprintf(fp, <span class="stringliteral">&quot;role: KS_RF_ROLE_REF\n&quot;</span>); <span class="keywordflow">break</span>;</div><div class="line"><a name="l03807"></a><span class="lineno"> 3807</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedaff51a67bd02398ae045fb3ebafa40abb">KS_RF_ROLE_CHEMSAT</a>: fprintf(fp, <span class="stringliteral">&quot;role: KS_RF_ROLE_CHEMSAT\n&quot;</span>); <span class="keywordflow">break</span>;</div><div class="line"><a name="l03808"></a><span class="lineno"> 3808</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142beda2e9a4ba49720b15631440951968c2865">KS_RF_ROLE_SPSAT</a>: fprintf(fp, <span class="stringliteral">&quot;role: KS_RF_ROLE_SPSAT\n&quot;</span>); <span class="keywordflow">break</span>;</div><div class="line"><a name="l03809"></a><span class="lineno"> 3809</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedac6b698b041a6da12fb9194c4947ec6e8">KS_RF_ROLE_INV</a>: fprintf(fp, <span class="stringliteral">&quot;role: KS_RF_ROLE_INV\n&quot;</span>); <span class="keywordflow">break</span>;</div><div class="line"><a name="l03810"></a><span class="lineno"> 3810</span>&#160;  }</div><div class="line"><a name="l03811"></a><span class="lineno"> 3811</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;rfwave.res: %d\n&quot;</span>, r.rfwave.res);</div><div class="line"><a name="l03812"></a><span class="lineno"> 3812</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;rfwave.duration: %d\n&quot;</span>, r.rfwave.duration);</div><div class="line"><a name="l03813"></a><span class="lineno"> 3813</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;amp: %g\n&quot;</span>, r.amp);</div><div class="line"><a name="l03814"></a><span class="lineno"> 3814</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;flip: %g\n&quot;</span>, r.flip);</div><div class="line"><a name="l03815"></a><span class="lineno"> 3815</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;bw: %g\n&quot;</span>, r.bw);</div><div class="line"><a name="l03816"></a><span class="lineno"> 3816</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;cf_offset: %g\n&quot;</span>, r.cf_offset);</div><div class="line"><a name="l03817"></a><span class="lineno"> 3817</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;start2iso: %d\n&quot;</span>, r.start2iso);</div><div class="line"><a name="l03818"></a><span class="lineno"> 3818</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;iso2end: %d\n&quot;</span>, r.iso2end);</div><div class="line"><a name="l03819"></a><span class="lineno"> 3819</span>&#160;</div><div class="line"><a name="l03820"></a><span class="lineno"> 3820</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#a609ddd32fdfbfa689c413d494a55d62c">ks_print_rfpulse</a>(r.rfpulse, fp);</div><div class="line"><a name="l03821"></a><span class="lineno"> 3821</span>&#160;</div><div class="line"><a name="l03822"></a><span class="lineno"> 3822</span>&#160;  <span class="keywordflow">if</span> (r.rfwave.res == 0)</div><div class="line"><a name="l03823"></a><span class="lineno"> 3823</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;     rfwave: OFF\n&quot;</span>);</div><div class="line"><a name="l03824"></a><span class="lineno"> 3824</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l03825"></a><span class="lineno"> 3825</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;     rfwave: Waveform assigned\n&quot;</span>);</div><div class="line"><a name="l03826"></a><span class="lineno"> 3826</span>&#160;</div><div class="line"><a name="l03827"></a><span class="lineno"> 3827</span>&#160;  <span class="keywordflow">if</span> (r.thetawave.res == 0)</div><div class="line"><a name="l03828"></a><span class="lineno"> 3828</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;     thetawave: OFF\n&quot;</span>);</div><div class="line"><a name="l03829"></a><span class="lineno"> 3829</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l03830"></a><span class="lineno"> 3830</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;     thetawave: Waveform assigned\n&quot;</span>);</div><div class="line"><a name="l03831"></a><span class="lineno"> 3831</span>&#160;</div><div class="line"><a name="l03832"></a><span class="lineno"> 3832</span>&#160;  fflush(fp);</div><div class="line"><a name="l03833"></a><span class="lineno"> 3833</span>&#160;</div><div class="line"><a name="l03834"></a><span class="lineno"> 3834</span>&#160;} <span class="comment">/* ks_print_rf */</span></div><div class="ttc" id="_k_s_foundation_8h_html_aa324c3517656b8ec032523397a142beda8f1b938816b04ffdeb45de47204252fd"><div class="ttname"><a href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142beda8f1b938816b04ffdeb45de47204252fd">KS_RF_ROLE_REF</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1750</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aa324c3517656b8ec032523397a142bedac6b698b041a6da12fb9194c4947ec6e8"><div class="ttname"><a href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedac6b698b041a6da12fb9194c4947ec6e8">KS_RF_ROLE_INV</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1750</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aa324c3517656b8ec032523397a142bedacc16dd3ca09dedaf6334a39ee4e46241"><div class="ttname"><a href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedacc16dd3ca09dedaf6334a39ee4e46241">KS_RF_ROLE_EXC</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1750</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aa324c3517656b8ec032523397a142bedace0db3ff9bb8cad071dc42579e9aadaf"><div class="ttname"><a href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedace0db3ff9bb8cad071dc42579e9aadaf">KS_RF_ROLE_NOTSET</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1750</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aa324c3517656b8ec032523397a142bedaff51a67bd02398ae045fb3ebafa40abb"><div class="ttname"><a href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedaff51a67bd02398ae045fb3ebafa40abb">KS_RF_ROLE_CHEMSAT</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1750</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a609ddd32fdfbfa689c413d494a55d62c"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a609ddd32fdfbfa689c413d494a55d62c">ks_print_rfpulse</a></div><div class="ttdeci">void ks_print_rfpulse(RF_PULSE rfpulse, FILE *fp)</div><div class="ttdoc">Writes out the contents of an RF_PULSE struct for debugging</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3769</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aa324c3517656b8ec032523397a142beda2e9a4ba49720b15631440951968c2865"><div class="ttname"><a href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142beda2e9a4ba49720b15631440951968c2865">KS_RF_ROLE_SPSAT</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1750</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a609ddd32fdfbfa689c413d494a55d62c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a609ddd32fdfbfa689c413d494a55d62c">&#9670;&nbsp;</a></span>ks_print_rfpulse()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_print_rfpulse </td>
          <td>(</td>
          <td class="paramtype">RF_PULSE&#160;</td>
          <td class="paramname"><em>rfpulse</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE *&#160;</td>
          <td class="paramname"><em>fp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Writes out the contents of an RF_PULSE struct for debugging</h4>
</p>
<p>If 2nd argument is <code>stderr</code> or <code>stdout</code>, the printed result will be seen in WTools for simulation. On the MR system, <code>stderr</code> will show up in one of the mgd_term windows. A file pointer (opened with e.g. fp = fopen("/usr/g/mrraw/myname.txt","w")) saves a text file to disk</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">rfpulse</td><td>An RF_PULSE struct (<code>&lt;rf&gt;.rfpulse</code>) to be printed </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fp</td><td>A file pointer (or <code>stderr</code>) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l03769"></a><span class="lineno"> 3769</span>&#160;                                                  {</div><div class="line"><a name="l03770"></a><span class="lineno"> 3770</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;     rfpulse.pw: %d\n&quot;</span>, *(<a class="code" href="grad__rf__empty_8h.html#a53f2690e6af35d559b80182016987d22">rfpulse</a>.pw));</div><div class="line"><a name="l03771"></a><span class="lineno"> 3771</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;     rfpulse.amp: %g\n&quot;</span>, *(<a class="code" href="grad__rf__empty_8h.html#a53f2690e6af35d559b80182016987d22">rfpulse</a>.amp));</div><div class="line"><a name="l03772"></a><span class="lineno"> 3772</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;     rfpulse.abswidth: %g\n&quot;</span>, <a class="code" href="grad__rf__empty_8h.html#a53f2690e6af35d559b80182016987d22">rfpulse</a>.abswidth);</div><div class="line"><a name="l03773"></a><span class="lineno"> 3773</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;     rfpulse.effwidth: %g\n&quot;</span>, <a class="code" href="grad__rf__empty_8h.html#a53f2690e6af35d559b80182016987d22">rfpulse</a>.effwidth);</div><div class="line"><a name="l03774"></a><span class="lineno"> 3774</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;     rfpulse.area: %g\n&quot;</span>, <a class="code" href="grad__rf__empty_8h.html#a53f2690e6af35d559b80182016987d22">rfpulse</a>.area);</div><div class="line"><a name="l03775"></a><span class="lineno"> 3775</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;     rfpulse.dtycyc: %g\n&quot;</span>, <a class="code" href="grad__rf__empty_8h.html#a53f2690e6af35d559b80182016987d22">rfpulse</a>.dtycyc);</div><div class="line"><a name="l03776"></a><span class="lineno"> 3776</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;     rfpulse.maxpw: %g\n&quot;</span>, <a class="code" href="grad__rf__empty_8h.html#a53f2690e6af35d559b80182016987d22">rfpulse</a>.maxpw);</div><div class="line"><a name="l03777"></a><span class="lineno"> 3777</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;     rfpulse.num: %d\n&quot;</span>, <a class="code" href="grad__rf__empty_8h.html#a53f2690e6af35d559b80182016987d22">rfpulse</a>.num);</div><div class="line"><a name="l03778"></a><span class="lineno"> 3778</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;     rfpulse.max_b1: %g\n&quot;</span>, <a class="code" href="grad__rf__empty_8h.html#a53f2690e6af35d559b80182016987d22">rfpulse</a>.max_b1);</div><div class="line"><a name="l03779"></a><span class="lineno"> 3779</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;     rfpulse.max_int_b1_sq: %g\n&quot;</span>, <a class="code" href="grad__rf__empty_8h.html#a53f2690e6af35d559b80182016987d22">rfpulse</a>.max_int_b1_sq);</div><div class="line"><a name="l03780"></a><span class="lineno"> 3780</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;     rfpulse.max_rms_b1: %g\n&quot;</span>, <a class="code" href="grad__rf__empty_8h.html#a53f2690e6af35d559b80182016987d22">rfpulse</a>.max_rms_b1);</div><div class="line"><a name="l03781"></a><span class="lineno"> 3781</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;     rfpulse.nom_fa: %g\n&quot;</span>, <a class="code" href="grad__rf__empty_8h.html#a53f2690e6af35d559b80182016987d22">rfpulse</a>.nom_fa);</div><div class="line"><a name="l03782"></a><span class="lineno"> 3782</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;     rfpulse.act_fa: %g\n&quot;</span>, *(<a class="code" href="grad__rf__empty_8h.html#a53f2690e6af35d559b80182016987d22">rfpulse</a>.act_fa));</div><div class="line"><a name="l03783"></a><span class="lineno"> 3783</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;     rfpulse.nom_pw: %g\n&quot;</span>, <a class="code" href="grad__rf__empty_8h.html#a53f2690e6af35d559b80182016987d22">rfpulse</a>.nom_pw);</div><div class="line"><a name="l03784"></a><span class="lineno"> 3784</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;     rfpulse.nom_bw: %g\n&quot;</span>, <a class="code" href="grad__rf__empty_8h.html#a53f2690e6af35d559b80182016987d22">rfpulse</a>.nom_bw);</div><div class="line"><a name="l03785"></a><span class="lineno"> 3785</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;     rfpulse.activity: %d\n&quot;</span>, <a class="code" href="grad__rf__empty_8h.html#a53f2690e6af35d559b80182016987d22">rfpulse</a>.activity);</div><div class="line"><a name="l03786"></a><span class="lineno"> 3786</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;     rfpulse.isodelay: %d\n&quot;</span>, <a class="code" href="grad__rf__empty_8h.html#a53f2690e6af35d559b80182016987d22">rfpulse</a>.isodelay);</div><div class="line"><a name="l03787"></a><span class="lineno"> 3787</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;     rfpulse.scale: %g\n&quot;</span>, <a class="code" href="grad__rf__empty_8h.html#a53f2690e6af35d559b80182016987d22">rfpulse</a>.scale);</div><div class="line"><a name="l03788"></a><span class="lineno"> 3788</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;     rfpulse.res: %d\n&quot;</span>, *(<a class="code" href="grad__rf__empty_8h.html#a53f2690e6af35d559b80182016987d22">rfpulse</a>.res));</div><div class="line"><a name="l03789"></a><span class="lineno"> 3789</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;     rfpulse.extgradfile: %d\n&quot;</span>, <a class="code" href="grad__rf__empty_8h.html#a53f2690e6af35d559b80182016987d22">rfpulse</a>.extgradfile);</div><div class="line"><a name="l03790"></a><span class="lineno"> 3790</span>&#160;</div><div class="line"><a name="l03791"></a><span class="lineno"> 3791</span>&#160;  fflush(fp);</div><div class="line"><a name="l03792"></a><span class="lineno"> 3792</span>&#160;</div><div class="line"><a name="l03793"></a><span class="lineno"> 3793</span>&#160;}</div><div class="ttc" id="grad__rf__empty_8h_html_a53f2690e6af35d559b80182016987d22"><div class="ttname"><a href="grad__rf__empty_8h.html#a53f2690e6af35d559b80182016987d22">rfpulse</a></div><div class="ttdeci">RF_PULSE rfpulse[RF_FREE]</div><div class="ttdef"><b>Definition:</b> grad_rf_empty.h:56</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a29a4c870ed4dcbee78d35bbbce9722b4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a29a4c870ed4dcbee78d35bbbce9722b4">&#9670;&nbsp;</a></span>ks_print_selrf()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_print_selrf </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a>&#160;</td>
          <td class="paramname"><em>selrf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE *&#160;</td>
          <td class="paramname"><em>fp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Writes out the contents of a <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> sequence object for debugging</h4>
</p>
<p>If 2nd argument is <code>stderr</code> or <code>stdout</code>, the printed result will be seen in WTools for simulation. On the MR system, <code>stderr</code> will show up in one of the mgd_term windows. A file pointer (opened with e.g. fp = fopen("/usr/g/mrraw/myname.txt","w")) saves a text file to disk</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">selrf</td><td>A <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> object to be printed </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fp</td><td>A file pointer (or <code>stderr</code>) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l03839"></a><span class="lineno"> 3839</span>&#160;                                          {</div><div class="line"><a name="l03840"></a><span class="lineno"> 3840</span>&#160;</div><div class="line"><a name="l03841"></a><span class="lineno"> 3841</span>&#160;  <span class="keywordflow">if</span> (r.rf.rfpulse.activity == 0 || r.rf.rfwave.description == NULL || r.rf.rfwave.duration == 0) {</div><div class="line"><a name="l03842"></a><span class="lineno"> 3842</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l03843"></a><span class="lineno"> 3843</span>&#160;  }</div><div class="line"><a name="l03844"></a><span class="lineno"> 3844</span>&#160;</div><div class="line"><a name="l03845"></a><span class="lineno"> 3845</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;\nKS_SELRF(%s):\n&quot;</span>, r.rf.rfwave.description);</div><div class="line"><a name="l03846"></a><span class="lineno"> 3846</span>&#160;</div><div class="line"><a name="l03847"></a><span class="lineno"> 3847</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;slthick: %g\n&quot;</span>, r.slthick);</div><div class="line"><a name="l03848"></a><span class="lineno"> 3848</span>&#160;  <span class="keywordflow">if</span> (r.rf.role == <a class="code" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142beda8f1b938816b04ffdeb45de47204252fd">KS_RF_ROLE_REF</a>)</div><div class="line"><a name="l03849"></a><span class="lineno"> 3849</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;crusherscale: %g\n&quot;</span>, r.crusherscale);</div><div class="line"><a name="l03850"></a><span class="lineno"> 3850</span>&#160;</div><div class="line"><a name="l03851"></a><span class="lineno"> 3851</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#a62a0c665210657b3fec394fc2251b16a">ks_print_trap</a>(r.pregrad, fp);</div><div class="line"><a name="l03852"></a><span class="lineno"> 3852</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#a62a0c665210657b3fec394fc2251b16a">ks_print_trap</a>(r.grad, fp);</div><div class="line"><a name="l03853"></a><span class="lineno"> 3853</span>&#160;  <span class="keywordflow">if</span> (r.gradwave.res &gt; 0) {</div><div class="line"><a name="l03854"></a><span class="lineno"> 3854</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;     gradwave: Waveform assigned\n&quot;</span>);</div><div class="line"><a name="l03855"></a><span class="lineno"> 3855</span>&#160;  }</div><div class="line"><a name="l03856"></a><span class="lineno"> 3856</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#a62a0c665210657b3fec394fc2251b16a">ks_print_trap</a>(r.postgrad, fp);</div><div class="line"><a name="l03857"></a><span class="lineno"> 3857</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#ad5129c546108e8413fb3a18e53876de9">ks_print_rf</a>(r.rf, fp);</div><div class="line"><a name="l03858"></a><span class="lineno"> 3858</span>&#160;</div><div class="line"><a name="l03859"></a><span class="lineno"> 3859</span>&#160;} <span class="comment">/* ks_print_selrf */</span></div><div class="ttc" id="_k_s_foundation__host_8c_html_a62a0c665210657b3fec394fc2251b16a"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a62a0c665210657b3fec394fc2251b16a">ks_print_trap</a></div><div class="ttdeci">void ks_print_trap(KS_TRAP t, FILE *fp)</div><div class="ttdoc">Writes out the contents of a KS_TRAP sequence object for debugging</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3691</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aa324c3517656b8ec032523397a142beda8f1b938816b04ffdeb45de47204252fd"><div class="ttname"><a href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142beda8f1b938816b04ffdeb45de47204252fd">KS_RF_ROLE_REF</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1750</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_ad5129c546108e8413fb3a18e53876de9"><div class="ttname"><a href="_k_s_foundation__host_8c.html#ad5129c546108e8413fb3a18e53876de9">ks_print_rf</a></div><div class="ttdeci">void ks_print_rf(KS_RF r, FILE *fp)</div><div class="ttdoc">Writes out the contents of a KS_RF sequence object for debugging</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3796</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a707df661a5fd67b70fa6da357573133c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a707df661a5fd67b70fa6da357573133c">&#9670;&nbsp;</a></span>ks_print_gradrfctrl()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_print_gradrfctrl </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html">KS_GRADRFCTRL</a>&#160;</td>
          <td class="paramname"><em>gradrfctrl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE *&#160;</td>
          <td class="paramname"><em>fp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Writes out the contents of <a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html" title="typedef struct that is a part of the KS_SEQ_CONTROL typedef struct, used internally to collect gradie...">KS_GRADRFCTRL</a> for debugging</h4>
</p>
<p>If 2nd argument is <code>stderr</code> or <code>stdout</code>, the printed result will be seen in WTools for simulation. On the MR system, <code>stderr</code> will show up in one of the mgd_term windows. A file pointer (opened with e.g. fp = fopen("/usr/g/mrraw/myname.txt","w")) saves a text file to disk</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">gradrfctrl</td><td>A <a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html" title="typedef struct that is a part of the KS_SEQ_CONTROL typedef struct, used internally to collect gradie...">KS_GRADRFCTRL</a> object to be printed </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fp</td><td>A file pointer (or <code>stderr</code>) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l03736"></a><span class="lineno"> 3736</span>&#160;                                                             {</div><div class="line"><a name="l03737"></a><span class="lineno"> 3737</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l03738"></a><span class="lineno"> 3738</span>&#160;</div><div class="line"><a name="l03739"></a><span class="lineno"> 3739</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; gradrfctrl.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ad1471d1cbc5ed7e8b1bc9d0987bf6eed">numrf</a>; i++) {</div><div class="line"><a name="l03740"></a><span class="lineno"> 3740</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;RF[%d] &#39;%s&#39;: %d times\n&quot;</span>, i, gradrfctrl.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a753f71c73d8169393fcbe8a9b3f4d2c2">rfptr</a>[i]-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, gradrfctrl.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a753f71c73d8169393fcbe8a9b3f4d2c2">rfptr</a>[i]-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>);</div><div class="line"><a name="l03741"></a><span class="lineno"> 3741</span>&#160;  }</div><div class="line"><a name="l03742"></a><span class="lineno"> 3742</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; gradrfctrl.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a576774535b3b72525cf3821a0ded5124">numtrap</a>; i++) {</div><div class="line"><a name="l03743"></a><span class="lineno"> 3743</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;TRAP[%d] &#39;%s&#39;: [%d, %d, %d] times on [X,Y,Z]\n&quot;</span>, i, gradrfctrl.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a218dab0fa00815bec264cb1170a615ef">trapptr</a>[i]-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, gradrfctrl.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a218dab0fa00815bec264cb1170a615ef">trapptr</a>[i]-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a3fb111f1302287e152078110b3b37d6f">gradnum</a>[XGRAD], gradrfctrl.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a218dab0fa00815bec264cb1170a615ef">trapptr</a>[i]-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a3fb111f1302287e152078110b3b37d6f">gradnum</a>[YGRAD], gradrfctrl.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a218dab0fa00815bec264cb1170a615ef">trapptr</a>[i]-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a3fb111f1302287e152078110b3b37d6f">gradnum</a>[ZGRAD]);</div><div class="line"><a name="l03744"></a><span class="lineno"> 3744</span>&#160;  }</div><div class="line"><a name="l03745"></a><span class="lineno"> 3745</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; gradrfctrl.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a176c1433ab0ff244ebdc3806d77fc3c9">numwave</a>; i++) {</div><div class="line"><a name="l03746"></a><span class="lineno"> 3746</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;WAVE[%d] &#39;%s&#39;: [%d, %d, %d] times on [X,Y,Z]\n&quot;</span>, i, gradrfctrl.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ac44d46e0aeb2f3842bf0cfc1e14ebadc">waveptr</a>[i]-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, gradrfctrl.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ac44d46e0aeb2f3842bf0cfc1e14ebadc">waveptr</a>[i]-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a3fb111f1302287e152078110b3b37d6f">gradnum</a>[XGRAD], gradrfctrl.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ac44d46e0aeb2f3842bf0cfc1e14ebadc">waveptr</a>[i]-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a3fb111f1302287e152078110b3b37d6f">gradnum</a>[YGRAD], gradrfctrl.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ac44d46e0aeb2f3842bf0cfc1e14ebadc">waveptr</a>[i]-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a3fb111f1302287e152078110b3b37d6f">gradnum</a>[ZGRAD]);</div><div class="line"><a name="l03747"></a><span class="lineno"> 3747</span>&#160;  }</div><div class="line"><a name="l03748"></a><span class="lineno"> 3748</span>&#160;</div><div class="line"><a name="l03749"></a><span class="lineno"> 3749</span>&#160;}</div><div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a753f71c73d8169393fcbe8a9b3f4d2c2"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a753f71c73d8169393fcbe8a9b3f4d2c2">KS_GRADRFCTRL::rfptr</a></div><div class="ttdeci">KS_RF * rfptr[KS_MAXUNIQUE_RF]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:815</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a576774535b3b72525cf3821a0ded5124"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a576774535b3b72525cf3821a0ded5124">KS_GRADRFCTRL::numtrap</a></div><div class="ttdeci">int numtrap</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:818</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a72a22b96ff3908d2b9a20a3a02647a2f"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">KS_BASE::ninst</a></div><div class="ttdeci">int ninst</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:261</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_ad1471d1cbc5ed7e8b1bc9d0987bf6eed"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ad1471d1cbc5ed7e8b1bc9d0987bf6eed">KS_GRADRFCTRL::numrf</a></div><div class="ttdeci">int numrf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:816</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a3fb111f1302287e152078110b3b37d6f"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a3fb111f1302287e152078110b3b37d6f">KS_WAVE::gradnum</a></div><div class="ttdeci">int gradnum[3]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:520</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_ac44d46e0aeb2f3842bf0cfc1e14ebadc"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ac44d46e0aeb2f3842bf0cfc1e14ebadc">KS_GRADRFCTRL::waveptr</a></div><div class="ttdeci">KS_WAVE * waveptr[KS_MAXUNIQUE_WAVE]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:819</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">KS_WAVE::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:516</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a2a9b610a78cdae3ac8ef682bd34f7e0d"><div class="ttname"><a href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">KS_RF::rfwave</a></div><div class="ttdeci">KS_WAVE rfwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:798</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">KS_WAVE::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:515</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a218dab0fa00815bec264cb1170a615ef"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a218dab0fa00815bec264cb1170a615ef">KS_GRADRFCTRL::trapptr</a></div><div class="ttdeci">KS_TRAP * trapptr[KS_MAXUNIQUE_TRAP]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:817</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">KS_TRAP::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:432</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a176c1433ab0ff244ebdc3806d77fc3c9"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a176c1433ab0ff244ebdc3806d77fc3c9">KS_GRADRFCTRL::numwave</a></div><div class="ttdeci">int numwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:820</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a3fb111f1302287e152078110b3b37d6f"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a3fb111f1302287e152078110b3b37d6f">KS_TRAP::gradnum</a></div><div class="ttdeci">int gradnum[3]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:438</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab08efc665b1013671852ab756840e1a5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab08efc665b1013671852ab756840e1a5">&#9670;&nbsp;</a></span>ks_error()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_error </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>format</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Common error message function for HOST and TGT</h4>
</p>
<ul>
<li>On the MR-scanner, this function will append error messages with a timestamp to the file <code>/usr/g/mrraw/ksf_errors.txt</code> in addition to sending an <code>epic_error()</code>, which will show the error at the bottom of the UI</li>
<li>In simluation, the error message will be seen both in Evaltool and in the main WTools window</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">format</td><td>Standard C printf input arguments </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td>Returns FAILURE </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a763989ed463b618658bef9c2485051eb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a763989ed463b618658bef9c2485051eb">&#9670;&nbsp;</a></span>ks_dbg()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS STATUS ks_dbg </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>format</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Common debug message function for HOST and TGT</h4>
</p>
<ul>
<li>On the MR-scanner, this function will append error messages with a timestamp to the file <code>/usr/g/mrraw/ksf_debug.txt</code></li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">format</td><td>Standard C printf input arguments </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td>Returns SUCCESS </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a4fe0c2fc567d0a9be5ec8d7e55b21a42"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4fe0c2fc567d0a9be5ec8d7e55b21a42">&#9670;&nbsp;</a></span>ks_syslimits_hasICEhardware()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS STATUS int ks_syslimits_hasICEhardware </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Check for ICE Hardware (e.g. RX27+ on SIGNA Premier)</h4>
</p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">int</td><td>1: ICE 0: MGD </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                                  {</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <span class="keywordtype">int</span> isice = FALSE;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="preprocessor">#if EPIC_RELEASE &gt;= 27</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  isice = <a class="code" href="_k_s_foundation__common_8c.html#a2ccc8c2f78537b7bc8c8a63ee32ac83f">cfssctype</a>;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  <span class="keywordflow">return</span> isice;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a2ccc8c2f78537b7bc8c8a63ee32ac83f"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a2ccc8c2f78537b7bc8c8a63ee32ac83f">cfssctype</a></div><div class="ttdeci">int cfssctype</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0077bec1cb7fd1cccf8f35a978242ff7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0077bec1cb7fd1cccf8f35a978242ff7">&#9670;&nbsp;</a></span>ks_dbg_reset()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_dbg_reset </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Clear debug file content</h4>
</p>
<div class="fragment"><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                    {</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  FILE *fp;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">/* if on MR scanner (HOST and TGT/IPG, HW=hardware=MRscanner) */</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="preprocessor">#ifdef PSD_HW</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  fp = fopen(<span class="stringliteral">&quot;/usr/g/mrraw/ks_debug.txt&quot;</span>, <span class="stringliteral">&quot;w&quot;</span>);</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  fp = fopen(<span class="stringliteral">&quot;./ks_debug.txt&quot;</span>, <span class="stringliteral">&quot;w&quot;</span>);</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;fclose(fp);</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a5c919c547ee396b18069ed505c695139"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5c919c547ee396b18069ed505c695139">&#9670;&nbsp;</a></span>ks_syslimits_ampmax()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_syslimits_ampmax </td>
          <td>(</td>
          <td class="paramtype">LOG_GRAD&#160;</td>
          <td class="paramname"><em>loggrd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the maximum gradient amplitude that can be used on all gradient boards simultaneously</h4>
</p>
<p>Since the waveform design (using <code>ks_eval_***()</code> functions) is separated from the placement of waveforms (using <code>ks_pg_***()</code> functions), the maximum gradient limit to use for gradient design must account for the least capable gradient board given the current slice angulation. <a class="el" href="_k_s_foundation_8h.html#a5c919c547ee396b18069ed505c695139" title="Returns the maximum gradient amplitude that can be used on all gradient boards simultaneously">ks_syslimits_ampmax()</a> assumes that all gradients may be on simultaneously</p>
<p>The return value from this function can be passed in as <code>ampmax</code> to all <code>ks_eval***_constrained()</code> functions</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">loggrd</td><td>GE's LOG_GRAD struct, dependent on the gradient system and current slice angulation </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">gradmax</td><td>Maximum gradient amplitude ([G/cm]) that can be used on all boards simultaneously </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                                           {</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <span class="keywordflow">return</span> (FMin(3, <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>.tx_xyz, <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>.ty_xyz, <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>.tz_xyz));</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4b3a3095702bf551f318ef9f03ff3403"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4b3a3095702bf551f318ef9f03ff3403">&#9670;&nbsp;</a></span>ks_syslimits_ampmax2()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_syslimits_ampmax2 </td>
          <td>(</td>
          <td class="paramtype">LOG_GRAD&#160;</td>
          <td class="paramname"><em>loggrd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the maximum gradient amplitude that can be used on two gradient boards simultaneously</h4>
</p>
<p>Since the waveform design (using <code>ks_eval_***()</code> functions) is separated from the placement of waveforms (using <code>ks_pg_***()</code> functions), the maximum gradient limit to use for gradient design must account for the least capable gradient board given the current slice angulation. <a class="el" href="_k_s_foundation_8h.html#a4b3a3095702bf551f318ef9f03ff3403" title="Returns the maximum gradient amplitude that can be used on two gradient boards simultaneously">ks_syslimits_ampmax2()</a> assumes that gradients are played out on at most one more board at the same time as the current trapezoid</p>
<p>The return value from this function can be passed in as <code>ampmax</code> to all <code>ks_eval***_constrained()</code> functions</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">loggrd</td><td>GE's LOG_GRAD struct, dependent on the gradient system and current slice angulation </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">gradmax</td><td>Maximum gradient amplitude ([G/cm]) that can be used on 2 boards simultaneously </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                                            {</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <span class="keywordflow">return</span> (FMin(6, <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>.tx_xy, <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>.tx_xz, <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>.ty_xy, <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>.ty_yz, <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>.tz_xz, <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>.tz_yz));</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a431729c0ecf331b33d84db72a80debaf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a431729c0ecf331b33d84db72a80debaf">&#9670;&nbsp;</a></span>ks_syslimits_ampmax1()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_syslimits_ampmax1 </td>
          <td>(</td>
          <td class="paramtype">LOG_GRAD&#160;</td>
          <td class="paramname"><em>loggrd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the maximum gradient amplitude that can be used on all gradient boards simultaneously</h4>
</p>
<p>Since the waveform design (using <code>ks_eval_***()</code> functions) is separated from the placement of waveforms (using <code>ks_pg_***()</code> functions), the maximum gradient limit to use for gradient design must account for the least capable gradient board given the current slice angulation. <a class="el" href="_k_s_foundation_8h.html#a431729c0ecf331b33d84db72a80debaf" title="Returns the maximum gradient amplitude that can be used on all gradient boards simultaneously">ks_syslimits_ampmax1()</a> assumes that no other gradient is played out on another board at the same time as the current trapezoid</p>
<p>The return value from this function can be passed in as <code>ampmax</code> to all <code>ks_eval***_constrained()</code> functions</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">loggrd</td><td>GE's LOG_GRAD struct, dependent on the gradient system and current slice angulation </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">gradmax</td><td>Maximum gradient amplitude ([G/cm]) that can be used on 2 boards simultaneously </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                                            {</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  <span class="keywordflow">return</span> (FMin(3, <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>.tx, <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>.ty, <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>.tz));</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a72446af13d4f4cd0dc9caf51bd58f88e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a72446af13d4f4cd0dc9caf51bd58f88e">&#9670;&nbsp;</a></span>ks_syslimits_ramptimemax()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_syslimits_ramptimemax </td>
          <td>(</td>
          <td class="paramtype">LOG_GRAD&#160;</td>
          <td class="paramname"><em>loggrd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the minimum ramp time to get from zero to full gradient scale</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">loggrd</td><td>GE's LOG_GRAD struct, dependent on the gradient system and current slice angulation </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">ramptime</td><td>Ramptime in [us] to get from zero to full gradient scale </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                                              {</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  <span class="comment">/* ramptime at full gradient scale */</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  <span class="keywordflow">return</span> IMax(3, <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>.xrt, <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>.yrt, <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>.zrt);</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a712d215e449900b4fc566fefff51b4e9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a712d215e449900b4fc566fefff51b4e9">&#9670;&nbsp;</a></span>ks_syslimits_slewrate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_syslimits_slewrate </td>
          <td>(</td>
          <td class="paramtype">LOG_GRAD&#160;</td>
          <td class="paramname"><em>loggrd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the maximum slewrate that can be used on all gradient boards simultaneously</h4>
</p>
<p>The return value from this function is the ratio of <a class="el" href="_k_s_foundation_8h.html#a5c919c547ee396b18069ed505c695139" title="Returns the maximum gradient amplitude that can be used on all gradient boards simultaneously">ks_syslimits_ampmax()</a> and <a class="el" href="_k_s_foundation_8h.html#a72446af13d4f4cd0dc9caf51bd58f88e" title="Returns the minimum ramp time to get from zero to full gradient scale">ks_syslimits_ramptimemax()</a> and can be passed in as <code>slewrate</code> to all <code>ks_eval***_constrained()</code> functions</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">loggrd</td><td>GE's LOG_GRAD struct, dependent on the gradient system and current slice angulation </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">slewrate</td><td>Maximum slewrate ([(G/cm) / us]) that can be used on all boards simultaneously </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                                             {</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  <span class="keywordflow">return</span> (<a class="code" href="_k_s_foundation__common_8c.html#a5c919c547ee396b18069ed505c695139">ks_syslimits_ampmax</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>) / <a class="code" href="_k_s_foundation__common_8c.html#a72446af13d4f4cd0dc9caf51bd58f88e">ks_syslimits_ramptimemax</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>));</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a5c919c547ee396b18069ed505c695139"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a5c919c547ee396b18069ed505c695139">ks_syslimits_ampmax</a></div><div class="ttdeci">float ks_syslimits_ampmax(LOG_GRAD loggrd)</div><div class="ttdoc">Returns the maximum gradient amplitude that can be used on all gradient boards simultaneously</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:163</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a72446af13d4f4cd0dc9caf51bd58f88e"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a72446af13d4f4cd0dc9caf51bd58f88e">ks_syslimits_ramptimemax</a></div><div class="ttdeci">int ks_syslimits_ramptimemax(LOG_GRAD loggrd)</div><div class="ttdoc">Returns the minimum ramp time to get from zero to full gradient scale</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:190</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a53d792432e1fd99fa597314576fa9e49"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a53d792432e1fd99fa597314576fa9e49">&#9670;&nbsp;</a></span>ks_syslimits_slewrate2()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_syslimits_slewrate2 </td>
          <td>(</td>
          <td class="paramtype">LOG_GRAD&#160;</td>
          <td class="paramname"><em>loggrd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the maximum slewrate that can be used on two gradient boards simultaneously</h4>
</p>
<p>The return value from this function is the ratio of <a class="el" href="_k_s_foundation_8h.html#a4b3a3095702bf551f318ef9f03ff3403" title="Returns the maximum gradient amplitude that can be used on two gradient boards simultaneously">ks_syslimits_ampmax2()</a> and <a class="el" href="_k_s_foundation_8h.html#a72446af13d4f4cd0dc9caf51bd58f88e" title="Returns the minimum ramp time to get from zero to full gradient scale">ks_syslimits_ramptimemax()</a> and can be passed in as <code>slewrate</code> to all <code>ks_eval***_constrained()</code> functions</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">loggrd</td><td>GE's LOG_GRAD struct, dependent on the gradient system and current slice angulation </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">slewrate</td><td>Maximum slewrate ([(G/cm) / us]) that can be used on all boards simultaneously </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                                              {</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  <span class="keywordflow">return</span> (<a class="code" href="_k_s_foundation__common_8c.html#a4b3a3095702bf551f318ef9f03ff3403">ks_syslimits_ampmax2</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>) / <a class="code" href="_k_s_foundation__common_8c.html#a72446af13d4f4cd0dc9caf51bd58f88e">ks_syslimits_ramptimemax</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>));</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a4b3a3095702bf551f318ef9f03ff3403"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a4b3a3095702bf551f318ef9f03ff3403">ks_syslimits_ampmax2</a></div><div class="ttdeci">float ks_syslimits_ampmax2(LOG_GRAD loggrd)</div><div class="ttdoc">Returns the maximum gradient amplitude that can be used on two gradient boards simultaneously</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:167</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a72446af13d4f4cd0dc9caf51bd58f88e"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a72446af13d4f4cd0dc9caf51bd58f88e">ks_syslimits_ramptimemax</a></div><div class="ttdeci">int ks_syslimits_ramptimemax(LOG_GRAD loggrd)</div><div class="ttdoc">Returns the minimum ramp time to get from zero to full gradient scale</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:190</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aaeea7c06ce455978cce287cf28c22a4f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaeea7c06ce455978cce287cf28c22a4f">&#9670;&nbsp;</a></span>ks_syslimits_slewrate1()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_syslimits_slewrate1 </td>
          <td>(</td>
          <td class="paramtype">LOG_GRAD&#160;</td>
          <td class="paramname"><em>loggrd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the maximum slewrate that can be used on one gradient board at a time</h4>
</p>
<p>The return value from this function is the ratio of <a class="el" href="_k_s_foundation_8h.html#a431729c0ecf331b33d84db72a80debaf" title="Returns the maximum gradient amplitude that can be used on all gradient boards simultaneously">ks_syslimits_ampmax1()</a> and <a class="el" href="_k_s_foundation_8h.html#a72446af13d4f4cd0dc9caf51bd58f88e" title="Returns the minimum ramp time to get from zero to full gradient scale">ks_syslimits_ramptimemax()</a> and can be passed in as <code>slewrate</code> to all <code>ks_eval***_constrained()</code> functions</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">loggrd</td><td>GE's LOG_GRAD struct, dependent on the gradient system and current slice angulation </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">slewrate</td><td>Maximum slewrate ([(G/cm) / us]) that can be used on all boards simultaneously </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                                              {</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <span class="keywordflow">return</span> (<a class="code" href="_k_s_foundation__common_8c.html#a431729c0ecf331b33d84db72a80debaf">ks_syslimits_ampmax1</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>) / <a class="code" href="_k_s_foundation__common_8c.html#a72446af13d4f4cd0dc9caf51bd58f88e">ks_syslimits_ramptimemax</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>));</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a431729c0ecf331b33d84db72a80debaf"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a431729c0ecf331b33d84db72a80debaf">ks_syslimits_ampmax1</a></div><div class="ttdeci">float ks_syslimits_ampmax1(LOG_GRAD loggrd)</div><div class="ttdoc">Returns the maximum gradient amplitude that can be used on all gradient boards simultaneously</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:171</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a72446af13d4f4cd0dc9caf51bd58f88e"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a72446af13d4f4cd0dc9caf51bd58f88e">ks_syslimits_ramptimemax</a></div><div class="ttdeci">int ks_syslimits_ramptimemax(LOG_GRAD loggrd)</div><div class="ttdoc">Returns the minimum ramp time to get from zero to full gradient scale</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:190</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa65115d54842eeffc47a1b324caa62ab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa65115d54842eeffc47a1b324caa62ab">&#9670;&nbsp;</a></span>ks_syslimits_gradtarget()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_syslimits_gradtarget </td>
          <td>(</td>
          <td class="paramtype">LOG_GRAD&#160;</td>
          <td class="paramname"><em>loggrd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">WF_PROCESSOR&#160;</td>
          <td class="paramname"><em>board</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the maximum target amplitude for a board (<em>internal use</em>)</h4>
</p>
<p>For gradient boards, the field <code>.tx</code>, <code>.ty</code> or <code>.tz</code> is returned. For non-gradient boards, 1.0 is returned. This function is used internally by <code>ks_pg_***()</code> functions and there should be no need to call it directly.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">loggrd</td><td>GE's LOG_GRAD struct, dependent on the gradient system and current slice angulation </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">board</td><td>The board on which the current trapezoid or waveform is to be played out on </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">gradamp</td><td>Maximum target amplitude for a board </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                                                                   {</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  <span class="keywordflow">switch</span> (board) {</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  <span class="keywordflow">case</span> XGRAD:</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>.tx;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  <span class="keywordflow">case</span> YGRAD:</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>.ty;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  <span class="keywordflow">case</span> ZGRAD:</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>.tz;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  <span class="keywordflow">default</span>:</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="keywordflow">return</span> 1.0;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  }</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a10d9f68352843144a68fb95081780b7a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a10d9f68352843144a68fb95081780b7a">&#9670;&nbsp;</a></span>ks_phase_radians2hw()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">short ks_phase_radians2hw </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>radphase</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the integer phase (<em>not in use</em>)</h4>
</p>
<p>All phase values in KSFoundation are in [degrees], including flip angles, RF/receive phases and THETA waveforms. This function is therefore currently not used. See instead <a class="el" href="_k_s_foundation_8h.html#acc2435255232dccd6cd217bc605422cd" title="Returns the integer phase (internal use)">ks_phase_degrees2hw()</a></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">radphase</td><td>Phase in radians </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">intphase</td><td>Integer phase to use on THETA board on hardware </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                                       {</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  <span class="keywordtype">short</span> iphase;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  UINT uiphase;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  <span class="keywordtype">double</span> dphase = (double) phase;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <span class="keywordtype">double</span> twopi = (double) 2.0 * PI;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  <span class="comment">/* Resolve angle to lie within range ( -2*pi &lt;= dphase &lt; 2*pi ) */</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  dphase = fmod(dphase, twopi);</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <span class="comment">/* Find the equivalent positive angle */</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <span class="keywordflow">if</span> (dphase &lt; 0.0)</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    dphase = twopi + dphase;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  <span class="comment">/* Convert the angle to exciter DDS phase representation where only the</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment">     upper 14 bits of 16 are used */</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  uiphase = (UINT) (dphase * 16384.0 / twopi + 0.5);</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <span class="keywordflow">if</span> (uiphase == 16384)</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    uiphase = 0;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <span class="comment">/* left shift the result by 2 bits */</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  iphase = (short) (uiphase &lt;&lt; 2);</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  <span class="keywordflow">return</span> iphase;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="acc2435255232dccd6cd217bc605422cd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acc2435255232dccd6cd217bc605422cd">&#9670;&nbsp;</a></span>ks_phase_degrees2hw()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">short ks_phase_degrees2hw </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>degphase</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the integer phase (<em>internal use</em>)</h4>
</p>
<p>All phase values in KSFoundation are in [degrees], including flip angles, RF/receive phases and THETA waveforms. This function is used internally by another internal function <a class="el" href="_k_s_foundation_8h.html#a016372aaa6f16b986000c56b9792fefd" title="(Internal use) Conversion of waveform content in a KS_WAVE sequence object to a short int array for u...">ks_wave2iwave()</a>, which is in turn called by <a class="el" href="_k_s_foundation_8h.html#afc06ade569c7b85c1aa5026fc2e1c710" title="Places a KS_WAVE sequence object on a board at some position in the pulse sequence">ks_pg_wave()</a></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">degphase</td><td>Phase in degrees </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">intphase</td><td>Integer phase to use on THETA board on hardware </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                                       {</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#a20bd7aa0fe253faf974ef414e91481a0">ks_phase_radians2hw</a>(phase * PI / 180.0);</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a20bd7aa0fe253faf974ef414e91481a0"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a20bd7aa0fe253faf974ef414e91481a0">ks_phase_radians2hw</a></div><div class="ttdeci">short ks_phase_radians2hw(float phase)</div><div class="ttdoc">Returns the integer phase (not in use)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:209</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9261718b4f0e64bab0da0b9e9c2c02f0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9261718b4f0e64bab0da0b9e9c2c02f0">&#9670;&nbsp;</a></span>ks_calc_selgradamp()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_calc_selgradamp </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>rfbw</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>slthick</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the gradient amplitude in [G/cm] necessary for slice selection (<em>internal use</em>)</h4>
</p>
<p>Given an RF bandwidth in [Hz] and a slice thickness in [mm], this function calculates the gradient strength in [G/cm] necessary to produce a slice with the given slice thickness</p>
<p>This function is used by <a class="el" href="_k_s_foundation_8h.html#a0c7c713519f3218a3b1afcb6917540c0" title="(Internal use) Sets up a trapezoid for RF slice selection">ks_eval_seltrap()</a>, <a class="el" href="_k_s_foundation_8h.html#a91443aae8a97c4481ba841f1bf3dc13a" title="Sets up a KS_SELRF object for RF slice selection, subject to gradients constraints specified as input...">ks_eval_selrf_constrained()</a> and <a class="el" href="_k_s_foundation_8h.html#ae8766ce800f95dd75ca2eece6638326c" title="Updates the frequency and phase of one or all instances of a slice selective RF pulse (KS_SELRF)...">ks_scan_selrf_setfreqphase()</a></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">rfbw</td><td>The bandwidth of the RF pulse to use with the gradient </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">slthick</td><td>The desired slice thickness in [mm] </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">gradamp</td><td>Gradient amplitude to use [G/cm] </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                                                    {</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  <span class="keywordflow">if</span> (slthick &gt; 0 &amp;&amp; rfbw &gt; 0)</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="keywordflow">return</span> (rfbw / (<a class="code" href="_k_s_foundation__common_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a> * slthick / 10.0));</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="keywordflow">return</span> 0.0; <span class="comment">/* return zero amp if requested slice thickness is &lt;= 0 */</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a2875ace95558531062d08465b2bcc282"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a></div><div class="ttdeci">float GAM</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa672c7e32ce3bce20534fa814901e720"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa672c7e32ce3bce20534fa814901e720">&#9670;&nbsp;</a></span>ks_wave_res()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_wave_res </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the number of samples in a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> sequence object</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">wave</td><td><a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">res</td><td>Resolution (i.e. number of samples) in the <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;                                     {</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;  <span class="keywordflow">if</span> (wave == NULL) {</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_wave_res: wave is NULL&quot;</span>);</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>;</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;  }</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;  <span class="keywordflow">if</span> (wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a> == NULL || wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>[0] == <span class="charliteral">&#39; &#39;</span>) {</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_wave_res: wave description not initialized or has leading space&quot;</span>);</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>;</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;  }</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;  <span class="keywordflow">if</span> (wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> &lt; 2 || wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> &gt; <a class="code" href="_k_s_foundation_8h.html#a3c3e362198a193a273f436e9e392188b">KS_MAXWAVELEN</a>) {</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_wave_res(%s): &#39;res&#39; (%d) is out of valid range [2, %d]&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>, <a class="code" href="_k_s_foundation_8h.html#a3c3e362198a193a273f436e9e392188b">KS_MAXWAVELEN</a>);</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>;</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;  }</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;  <span class="keywordflow">if</span> (wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> % 2) {</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_wave_res(%s): &#39;res&#39; (%d) must be even&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>);</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>;</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;  }</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;  <span class="keywordflow">return</span> wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>;</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_afd953f31b866a09e0418967c2bf65a59"><div class="ttname"><a href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a></div><div class="ttdeci">#define KS_NOTSET</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:60</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">KS_WAVE::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:516</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a3c3e362198a193a273f436e9e392188b"><div class="ttname"><a href="_k_s_foundation_8h.html#a3c3e362198a193a273f436e9e392188b">KS_MAXWAVELEN</a></div><div class="ttdeci">#define KS_MAXWAVELEN</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:113</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="adf7aec11f0fecce133070402558215ff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adf7aec11f0fecce133070402558215ff">&#9670;&nbsp;</a></span>ks_waveform_max()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_waveform_max </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a>&#160;</td>
          <td class="paramname"><em>waveform</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>res</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the maximum value in a KS_WAVEFORM</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">waveform</td><td>KS_WAVEFORM (float array) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">res</td><td>Resolution (i.e. number of samples) in the KS_WAVEFORM </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">maxval</td><td>Maximum value </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;                                                           {</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;  <span class="keywordtype">float</span> maxv = -1.0e38;</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;  <span class="keywordflow">if</span> (waveform == NULL) {</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_waveform_max: wave is NULL&quot;</span>);</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    <span class="keywordflow">return</span> maxv;</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;  }</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;  <span class="keywordflow">if</span> (res &lt;= 0) {</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    <span class="keywordflow">return</span> maxv;</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;  }</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; res; i++) {</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    <span class="keywordflow">if</span> (waveform[i] &gt; maxv)</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;      maxv = waveform[i];</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;  }</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;  <span class="keywordflow">return</span> maxv;</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8309ba456fc3e23a10111a1439b13e21"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8309ba456fc3e23a10111a1439b13e21">&#9670;&nbsp;</a></span>ks_wave_max()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_wave_max </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the maximum value in a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> sequence object</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">wave</td><td><a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">maxval</td><td>Maximum value </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;                                       {</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#adf7aec11f0fecce133070402558215ff">ks_waveform_max</a>(wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>);</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_adf7aec11f0fecce133070402558215ff"><div class="ttname"><a href="_k_s_foundation__common_8c.html#adf7aec11f0fecce133070402558215ff">ks_waveform_max</a></div><div class="ttdeci">float ks_waveform_max(const KS_WAVEFORM waveform, int res)</div><div class="ttdoc">Returns the maximum value in a KS_WAVEFORM</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:892</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a27640b66342aa92e2fecafb0e8471785"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">KS_WAVE::waveform</a></div><div class="ttdeci">KS_WAVEFORM waveform</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:519</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="abb6bc5f956fac809f44006a5b2698ee6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abb6bc5f956fac809f44006a5b2698ee6">&#9670;&nbsp;</a></span>ks_waveform_min()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_waveform_min </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a>&#160;</td>
          <td class="paramname"><em>waveform</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>res</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the minimum value in a KS_WAVEFORM</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">waveform</td><td>KS_WAVEFORM (float array) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">res</td><td>Resolution (i.e. number of samples) in the KS_WAVEFORM </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">minval</td><td>Minimum value </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;                                                           {</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;  <span class="keywordtype">float</span> minv = 1.0e38;</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;  <span class="keywordflow">if</span> (waveform == NULL) {</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_waveform_min: wave is NULL&quot;</span>);</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;    <span class="keywordflow">return</span> minv;</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;  }</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;  <span class="keywordflow">if</span> (res &lt;= 0) {</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    <span class="keywordflow">return</span> minv;</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;  }</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; res; i++) {</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    <span class="keywordflow">if</span> (waveform[i] &lt; minv)</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;      minv = waveform[i];</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;  }</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;  <span class="keywordflow">return</span> minv;</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="adce100a7702e71bfb10377f1652465a2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adce100a7702e71bfb10377f1652465a2">&#9670;&nbsp;</a></span>ks_wave_min()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_wave_min </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the minimum value in a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> sequence object</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">wave</td><td><a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">minval</td><td>Minimum value </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;                                       {</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abb6bc5f956fac809f44006a5b2698ee6">ks_waveform_min</a>(wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>);</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;}</div><div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abb6bc5f956fac809f44006a5b2698ee6"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abb6bc5f956fac809f44006a5b2698ee6">ks_waveform_min</a></div><div class="ttdeci">float ks_waveform_min(const KS_WAVEFORM waveform, int res)</div><div class="ttdoc">Returns the minimum value in a KS_WAVEFORM</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:918</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a27640b66342aa92e2fecafb0e8471785"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">KS_WAVE::waveform</a></div><div class="ttdeci">KS_WAVEFORM waveform</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:519</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="abf8e5bff3973c32360bc0e1505db61bc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abf8e5bff3973c32360bc0e1505db61bc">&#9670;&nbsp;</a></span>ks_waveform_absmax()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_waveform_absmax </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a>&#160;</td>
          <td class="paramname"><em>waveform</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>res</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the maximum absolute value in a KS_WAVEFORM</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">waveform</td><td>KS_WAVEFORM (float array) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">res</td><td>Resolution (i.e. number of samples) in the KS_WAVEFORM </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">absmaxval</td><td>Maximum absolute value </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;                                                              {</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;  <span class="keywordtype">float</span> maxv = -1.0e38;</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;  <span class="keywordflow">if</span> (waveform == NULL) {</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_waveform_absmax: wave is NULL&quot;</span>);</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    <span class="keywordflow">return</span> maxv;</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;  }</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;  <span class="keywordflow">if</span> (res &lt;= 0) {</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    <span class="keywordflow">return</span> maxv;</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;  }</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; res; i++) {</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    <span class="keywordflow">if</span> (fabs(waveform[i]) &gt; maxv)</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;      maxv = fabs(waveform[i]);</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;  }</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;  <span class="keywordflow">return</span> maxv;</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a838f4d91abbaf80203c3c6cc3797d036"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a838f4d91abbaf80203c3c6cc3797d036">&#9670;&nbsp;</a></span>ks_iwave_absmax()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">short ks_iwave_absmax </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#abba996c24da629eea72eecbd9a22a873">KS_IWAVE</a>&#160;</td>
          <td class="paramname"><em>waveform</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>res</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the maximum absolute value in a KS_IWAVE</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">waveform</td><td>KS_IWAVE (short int array) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">res</td><td>Resolution (i.e. number of samples) in the KS_IWAVE </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">absmaxval</td><td>Maximum absolute value </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;                                                        {</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;  <span class="keywordtype">short</span> maxv = 0;</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;  <span class="keywordflow">if</span> (waveform == NULL) {</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: wave is NULL&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;    <span class="keywordflow">return</span> maxv;</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;  }</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;  <span class="keywordflow">if</span> (res &lt;= 0) {</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    <span class="keywordflow">return</span> maxv;</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;  }</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; res; i++) {</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    <span class="keywordflow">if</span> (abs(waveform[i]) &gt; maxv)</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;      maxv = abs(waveform[i]);</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;  }</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;  <span class="keywordflow">return</span> maxv;</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2bfec427bf5a8966edf279b2eba23396"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2bfec427bf5a8966edf279b2eba23396">&#9670;&nbsp;</a></span>ks_wave_absmax()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_wave_absmax </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the maximum absolute value in a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> sequence object</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">wave</td><td><a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">absmaxval</td><td>Maximum absolute value </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;                                          {</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf8e5bff3973c32360bc0e1505db61bc">ks_waveform_absmax</a>(wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>);</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_abf8e5bff3973c32360bc0e1505db61bc"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf8e5bff3973c32360bc0e1505db61bc">ks_waveform_absmax</a></div><div class="ttdeci">float ks_waveform_absmax(const KS_WAVEFORM waveform, int res)</div><div class="ttdoc">Returns the maximum absolute value in a KS_WAVEFORM</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:965</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a27640b66342aa92e2fecafb0e8471785"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">KS_WAVE::waveform</a></div><div class="ttdeci">KS_WAVEFORM waveform</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:519</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7e9a8aad6f58220e83c48dd10d9a5e3c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7e9a8aad6f58220e83c48dd10d9a5e3c">&#9670;&nbsp;</a></span>ks_waveform_area()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_waveform_area </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a>&#160;</td>
          <td class="paramname"><em>waveform</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dwelltime</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the area of a KS_WAVEFORM over a specified interval given in [us]</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">waveform</td><td>KS_WAVEFORM (float array) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">start</td><td>[us] Start position of area calculation in [us] (0 = start of waveform) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">end</td><td>[us] End position of area calculation in [us] (res * dwelltime = end of waveform) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dwelltime</td><td>[us] of each waveform point (duration/res) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">area</td><td>The area of the KS_WAVEFORM over the specified interval in [(G/cm) * us] </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;                                                                                            {</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;  <span class="keywordtype">double</span> area = 0;</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;  <span class="keywordtype">int</span> start_indx = CEIL_DIV(start, dwelltime);</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;  <span class="keywordtype">int</span> end_indx = end / dwelltime;</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;  <span class="keywordflow">if</span> (waveform == NULL) {</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: wave is NULL&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;  }</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;  <span class="keywordflow">if</span> (start_indx &lt; 0) {</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: start must be &gt;= 0&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;  }</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;  <span class="keywordflow">if</span> (end_indx &gt; <a class="code" href="_k_s_foundation_8h.html#a3c3e362198a193a273f436e9e392188b">KS_MAXWAVELEN</a>) {</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: end cannot exceed %d&quot;</span>, __FUNCTION__, <a class="code" href="_k_s_foundation_8h.html#a3c3e362198a193a273f436e9e392188b">KS_MAXWAVELEN</a>);</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;  }</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;  <span class="keywordflow">for</span> (i = start_indx; i &lt; end_indx; i++) {</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;    area += waveform[i] * dwelltime;</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;  }</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;  <span class="comment">/* add potential partial dwell time due to CEIL_DIV, when start [us] is not divisible by dwelltime */</span></div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;  <span class="keywordflow">if</span> ((start_indx * dwelltime) &gt; start &amp;&amp; start_indx &gt; 0) {</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    area += waveform[start_indx - 1] * (((double) start_indx * dwelltime) - (double) start);</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;  }</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;  <span class="comment">/* add potential partial dwell time due to (floor) integer division, when end [us] is not divisible by dwelltime */</span></div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;  <span class="keywordflow">if</span> ((end_indx * dwelltime) &lt; end &amp;&amp; (end_indx &lt; (<a class="code" href="_k_s_foundation_8h.html#a3c3e362198a193a273f436e9e392188b">KS_MAXWAVELEN</a> - 1))) {</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    area += waveform[end_indx + 1] * ((double) end - ((<span class="keywordtype">double</span>) end_indx * dwelltime));</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;  }</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;  <span class="keywordflow">return</span> ((<span class="keywordtype">float</span>) area);</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a3c3e362198a193a273f436e9e392188b"><div class="ttname"><a href="_k_s_foundation_8h.html#a3c3e362198a193a273f436e9e392188b">KS_MAXWAVELEN</a></div><div class="ttdeci">#define KS_MAXWAVELEN</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:113</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1ed01e2c72db1252e516b9c2b098bbee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1ed01e2c72db1252e516b9c2b098bbee">&#9670;&nbsp;</a></span>ks_wave_area()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_wave_area </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>end</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the area of a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object over a specified interval given in [us]</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">wave</td><td><a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">start</td><td>[us] Start position of area calculation in [us] (0 = start of waveform) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">end</td><td>[us] End position of area calculation in <a href="`.duration` = end of waveform">us</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">area</td><td>The area of the <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object over the specified interval in [(G/cm) * us] </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;                                                                {</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;  <span class="keywordtype">int</span> dwelltime = wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> / wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>;</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#a7e9a8aad6f58220e83c48dd10d9a5e3c">ks_waveform_area</a>(wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, start, end, dwelltime);</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a7e9a8aad6f58220e83c48dd10d9a5e3c"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a7e9a8aad6f58220e83c48dd10d9a5e3c">ks_waveform_area</a></div><div class="ttdeci">float ks_waveform_area(const KS_WAVEFORM waveform, int start, int end, int dwelltime)</div><div class="ttdoc">Returns the area of a KS_WAVEFORM over a specified interval given in [us]</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:991</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a27640b66342aa92e2fecafb0e8471785"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">KS_WAVE::waveform</a></div><div class="ttdeci">KS_WAVEFORM waveform</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:519</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_WAVE::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:518</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a836fc0fca52fac39fbecc05b3f1b2329"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a836fc0fca52fac39fbecc05b3f1b2329">&#9670;&nbsp;</a></span>ks_waveform_sum()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_waveform_sum </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a>&#160;</td>
          <td class="paramname"><em>waveform</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>res</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the sum of a KS_WAVEFORM</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">waveform</td><td>KS_WAVEFORM (float array) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">res</td><td>Resolution (i.e. number of samples) in the KS_WAVEFORM </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">sum</td><td>The sum of the KS_WAVEFORM </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;                                                           {</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;  <span class="keywordtype">double</span> sum = 0;</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;  <span class="keywordflow">if</span> (waveform == NULL) {</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_waveform_sum: wave is NULL&quot;</span>);</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;  }</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;  <span class="keywordflow">if</span> (res &lt;= 0) {</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_waveform_sum: res must be positive&quot;</span>);</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;  }</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; res; i++) {</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;    sum += waveform[i];</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;  }</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;  <span class="keywordflow">return</span> (<span class="keywordtype">float</span>)sum;</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a147f6b9c40c1978fde2395ac2a97a88f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a147f6b9c40c1978fde2395ac2a97a88f">&#9670;&nbsp;</a></span>ks_wave_sum()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_wave_sum </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the sum of a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> sequence object</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">wave</td><td><a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">sum</td><td>The sum of the KS_WAVEFORM </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;                                       {</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#a836fc0fca52fac39fbecc05b3f1b2329">ks_waveform_sum</a>(wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>);</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a836fc0fca52fac39fbecc05b3f1b2329"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a836fc0fca52fac39fbecc05b3f1b2329">ks_waveform_sum</a></div><div class="ttdeci">float ks_waveform_sum(const KS_WAVEFORM waveform, int res)</div><div class="ttdoc">Returns the sum of a KS_WAVEFORM</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1030</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a27640b66342aa92e2fecafb0e8471785"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">KS_WAVE::waveform</a></div><div class="ttdeci">KS_WAVEFORM waveform</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:519</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a5128fc94664d4d81425a461ea4a73b09"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5128fc94664d4d81425a461ea4a73b09">&#9670;&nbsp;</a></span>ks_waveform_norm()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_waveform_norm </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a>&#160;</td>
          <td class="paramname"><em>waveform</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>res</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the 2-norm of a KS_WAVEFORM</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">waveform</td><td>KS_WAVEFORM (float array) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">res</td><td>Resolution (i.e. number of samples) in the KS_WAVEFORM </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">norm2</td><td>The 2-norm of a KS_WAVEFORM </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;                                                            {</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;  <span class="keywordtype">double</span> sum = 0;</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;  <span class="keywordflow">if</span> (waveform == NULL) {</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_waveform_norm: wave is NULL&quot;</span>);</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;  }</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;  <span class="keywordflow">if</span> (res &lt;= 0) {</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_waveform_norm: res must be positive&quot;</span>);</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;  }</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; res; i++) {</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    sum += pow(fabs(waveform[i]), 2.0);</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;  }</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;  <span class="keywordflow">return</span> (<span class="keywordtype">float</span>)sqrt(sum);</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4bc0ca8d038d6083ad28d01f37cb946c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4bc0ca8d038d6083ad28d01f37cb946c">&#9670;&nbsp;</a></span>ks_wave_norm()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_wave_norm </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the 2-norm of a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a></h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">wave</td><td><a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">norm2</td><td>The 2-norm of a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;                                        {</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#a5128fc94664d4d81425a461ea4a73b09">ks_waveform_norm</a>(wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>);</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a5128fc94664d4d81425a461ea4a73b09"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a5128fc94664d4d81425a461ea4a73b09">ks_waveform_norm</a></div><div class="ttdeci">float ks_waveform_norm(const KS_WAVEFORM waveform, int res)</div><div class="ttdoc">Returns the 2-norm of a KS_WAVEFORM</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1053</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a27640b66342aa92e2fecafb0e8471785"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">KS_WAVE::waveform</a></div><div class="ttdeci">KS_WAVEFORM waveform</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:519</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a01ad5d5e6870a3b956943a73b348d69d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a01ad5d5e6870a3b956943a73b348d69d">&#9670;&nbsp;</a></span>ks_waveform_cumsum()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_waveform_cumsum </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a>&#160;</td>
          <td class="paramname"><em>cumsumwaveform</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a>&#160;</td>
          <td class="paramname"><em>waveform</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>res</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Calculates a KS_WAVEFORM with the cumulative sum (i.e. integral) of a KS_WAVEFORM</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">cumsumwaveform</td><td>KS_WAVEFORM (float array) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">waveform</td><td>KS_WAVEFORM (float array) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">res</td><td>Resolution (i.e. number of samples) in the KS_WAVEFORM </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;                                                                                         {</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;  <span class="keywordtype">int</span> i, j;</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;  <span class="keywordflow">for</span> (j = 0; j &lt; res; j++) {</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;    <span class="keywordtype">double</span> sum = 0;</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; j; i++) {</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;      sum += waveform[i];</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    }</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;    cumsumwaveform[j] = (float)sum;</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;  }</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="af2f69e088a1a8833c9b3e1cad2119321"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af2f69e088a1a8833c9b3e1cad2119321">&#9670;&nbsp;</a></span>ks_wave_cumsum()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_wave_cumsum </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>cumsumwave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Calculates a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> with the cumulative sum (i.e. integral) of a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a></h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">cumsumwave</td><td><a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">wave</td><td><a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;                                                              {</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;  <span class="keywordtype">int</span> res;</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;  res = (cumsumwave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> &gt; wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>) ? wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> : cumsumwave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>; <span class="comment">/* smallest of the two */</span></div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#a01ad5d5e6870a3b956943a73b348d69d">ks_waveform_cumsum</a>(cumsumwave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, res);</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a01ad5d5e6870a3b956943a73b348d69d"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a01ad5d5e6870a3b956943a73b348d69d">ks_waveform_cumsum</a></div><div class="ttdeci">void ks_waveform_cumsum(KS_WAVEFORM cumsumwaveform, const KS_WAVEFORM waveform, int res)</div><div class="ttdoc">Calculates a KS_WAVEFORM with the cumulative sum (i.e. integral) of a KS_WAVEFORM</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1076</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a27640b66342aa92e2fecafb0e8471785"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">KS_WAVE::waveform</a></div><div class="ttdeci">KS_WAVEFORM waveform</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:519</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a183b6f1b3697030d122bb4a0cfda5619"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a183b6f1b3697030d122bb4a0cfda5619">&#9670;&nbsp;</a></span>ks_waveform_multiply()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_waveform_multiply </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a>&#160;</td>
          <td class="paramname"><em>waveform_mod</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a>&#160;</td>
          <td class="paramname"><em>waveform</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>res</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>In-place multiplication of one KS_WAVEFORM with another KS_WAVEFORM</h4>
</p>
<p>Multiplication of waveform <code>a</code> (arg 1) with waveform <code>b</code> (arg 2) as: <code>a *= b</code></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">waveform_mod</td><td><a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">waveform</td><td>KS_WAVEFORM (float array) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">res</td><td>Resolution (i.e. number of samples) in the KS_WAVEFORM </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;                                                                                         {</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; res; i++) {</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;    waveform_mod[i] *= waveform[i];</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;  }</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a89145883bc5e8fcf4a93002535aa50a3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a89145883bc5e8fcf4a93002535aa50a3">&#9670;&nbsp;</a></span>ks_wave_multiply()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_wave_multiply </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave_mod</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>In-place multiplication of one <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> with another <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a></h4>
</p>
<p>Multiplication of waveform <code>a</code> (arg 1) with waveform <code>b</code> (arg 2) as: <code>a *= b</code></p>
<p>If the duration of the two <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> objects have different resolution, the shorter <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> will be multiplied with the first part of the longer <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">wave_mod</td><td><a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">wave</td><td><a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;                                                              {</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;  <span class="keywordtype">int</span> res;</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;  res = (wave_mod-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> &gt; wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>) ? wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> : wave_mod-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>; <span class="comment">/* smallest of the two */</span></div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#a183b6f1b3697030d122bb4a0cfda5619">ks_waveform_multiply</a>(wave_mod-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, res);</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a183b6f1b3697030d122bb4a0cfda5619"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a183b6f1b3697030d122bb4a0cfda5619">ks_waveform_multiply</a></div><div class="ttdeci">void ks_waveform_multiply(KS_WAVEFORM waveform_mod, const KS_WAVEFORM waveform, int res)</div><div class="ttdoc">In-place multiplication of one KS_WAVEFORM with another KS_WAVEFORM</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1097</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a27640b66342aa92e2fecafb0e8471785"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">KS_WAVE::waveform</a></div><div class="ttdeci">KS_WAVEFORM waveform</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:519</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0a23f59d14bb955dd5a9e19bb705cb70"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0a23f59d14bb955dd5a9e19bb705cb70">&#9670;&nbsp;</a></span>ks_waveform_add()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_waveform_add </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a>&#160;</td>
          <td class="paramname"><em>waveform_mod</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a>&#160;</td>
          <td class="paramname"><em>waveform</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>res</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>In-place addition of one KS_WAVEFORM with another KS_WAVEFORM</h4>
</p>
<p>Addition of waveform <code>a</code> (arg 1) with waveform <code>b</code> (arg 2) as: <code>a += b</code></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">waveform_mod</td><td>KS_WAVEFORM (float array) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">waveform</td><td>KS_WAVEFORM (float array) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">res</td><td>Resolution (i.e. number of samples) in the KS_WAVEFORM </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;                                                                                    {</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; res; i++) {</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;    waveform_mod[i] += waveform[i];</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;  }</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a74cda06697c45a3c9914e6b091be5efb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a74cda06697c45a3c9914e6b091be5efb">&#9670;&nbsp;</a></span>ks_wave_add()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_wave_add </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave_mod</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>In-place addition of one <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> with another <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a></h4>
</p>
<p>Addition of waveform <code>a</code> (arg 1) with waveform <code>b</code> (arg 2) as: <code>a *= b</code></p>
<p>If the duration of the two <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> objects have different resolution, the shorter <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> will be added to the first part of the longer <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">wave_mod</td><td><a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">wave</td><td><a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;                                                         {</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;  <span class="keywordtype">int</span> res;</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;  res = (wave_mod-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> &gt; wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>) ? wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> : wave_mod-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>; <span class="comment">/* smallest of the two */</span></div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#a0a23f59d14bb955dd5a9e19bb705cb70">ks_waveform_add</a>(wave_mod-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, res);</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a0a23f59d14bb955dd5a9e19bb705cb70"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a0a23f59d14bb955dd5a9e19bb705cb70">ks_waveform_add</a></div><div class="ttdeci">void ks_waveform_add(KS_WAVEFORM waveform_mod, const KS_WAVEFORM waveform, int res)</div><div class="ttdoc">In-place addition of one KS_WAVEFORM with another KS_WAVEFORM</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1112</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a27640b66342aa92e2fecafb0e8471785"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">KS_WAVE::waveform</a></div><div class="ttdeci">KS_WAVEFORM waveform</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:519</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ace0cae3befbb3608319f34a61657bc26"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ace0cae3befbb3608319f34a61657bc26">&#9670;&nbsp;</a></span>ks_waveform_multiplyval()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_waveform_multiplyval </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a>&#160;</td>
          <td class="paramname"><em>waveform</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>val</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>res</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>In-place scalar multiplication of a KS_WAVEFORM</h4>
</p>
<p>The values in a KS_WAVEFORM are multiplied with a scalar value <code>val</code></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">waveform</td><td>KS_WAVEFORM (float array) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">val</td><td>Floating point value to multiply with </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">res</td><td>Resolution (i.e. number of samples) in the KS_WAVEFORM </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;                                                                       {</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; res; i++) {</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;    waveform[i] *= val;</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;  }</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a23b3d305df1e2ad0563f8a2fea2330df"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a23b3d305df1e2ad0563f8a2fea2330df">&#9670;&nbsp;</a></span>ks_wave_multiplyval()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_wave_multiplyval </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>val</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>In-place scalar multiplication of a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a></h4>
</p>
<p>The waveform values in a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> sequence object (<code>.waveform[]</code>) are multiplied with a scalar value <code>val</code></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">wave</td><td><a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">val</td><td>Floating point value to multiply with </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;                                                   {</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#ace0cae3befbb3608319f34a61657bc26">ks_waveform_multiplyval</a>(wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, val, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>);</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_ace0cae3befbb3608319f34a61657bc26"><div class="ttname"><a href="_k_s_foundation__common_8c.html#ace0cae3befbb3608319f34a61657bc26">ks_waveform_multiplyval</a></div><div class="ttdeci">void ks_waveform_multiplyval(KS_WAVEFORM waveform, float val, int res)</div><div class="ttdoc">In-place scalar multiplication of a KS_WAVEFORM</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1127</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a27640b66342aa92e2fecafb0e8471785"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">KS_WAVE::waveform</a></div><div class="ttdeci">KS_WAVEFORM waveform</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:519</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae029b50a84f55155fdca946ec828e3fc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae029b50a84f55155fdca946ec828e3fc">&#9670;&nbsp;</a></span>ks_waveform_addval()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_waveform_addval </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a>&#160;</td>
          <td class="paramname"><em>waveform</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>val</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>res</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>In-place scalar addition of a KS_WAVEFORM</h4>
</p>
<p>The values in a KS_WAVEFORM are added with a scalar value <code>val</code></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">waveform</td><td>KS_WAVEFORM (float array) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">val</td><td>Floating point value to add </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">res</td><td>Resolution (i.e. number of samples) in the KS_WAVEFORM </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;                                                                  {</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; res; i++) {</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;    waveform[i] += val;</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;  }</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a66a14bcaf8bf19a334866090c1f2ee49"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a66a14bcaf8bf19a334866090c1f2ee49">&#9670;&nbsp;</a></span>ks_wave_addval()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_wave_addval </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>val</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>In-place scalar addition of a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a></h4>
</p>
<p>The waveform values in a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> sequence object (<code>.waveform[]</code>) are added with a scalar value <code>val</code></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">wave</td><td><a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">val</td><td>Floating point value to add </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;                                              {</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#ae029b50a84f55155fdca946ec828e3fc">ks_waveform_addval</a>(wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, val, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>);</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_ae029b50a84f55155fdca946ec828e3fc"><div class="ttname"><a href="_k_s_foundation__common_8c.html#ae029b50a84f55155fdca946ec828e3fc">ks_waveform_addval</a></div><div class="ttdeci">void ks_waveform_addval(KS_WAVEFORM waveform, float val, int res)</div><div class="ttdoc">In-place scalar addition of a KS_WAVEFORM</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1140</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a27640b66342aa92e2fecafb0e8471785"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">KS_WAVE::waveform</a></div><div class="ttdeci">KS_WAVEFORM waveform</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:519</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="acce0c0e51575bd8ce71eafcf92e153e0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acce0c0e51575bd8ce71eafcf92e153e0">&#9670;&nbsp;</a></span>ks_waveform2iwave()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_waveform2iwave </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_k_s_foundation_8h.html#abba996c24da629eea72eecbd9a22a873">KS_IWAVE</a>&#160;</td>
          <td class="paramname"><em>iwave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a>&#160;</td>
          <td class="paramname"><em>waveform</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>res</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>board</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>(<em>Internal use</em>) Conversion of a KS_WAVEFORM to a short int array for use on hardware</h4>
</p>
<p>This function is used internally by <a class="el" href="_k_s_foundation_8h.html#afc06ade569c7b85c1aa5026fc2e1c710" title="Places a KS_WAVE sequence object on a board at some position in the pulse sequence">ks_pg_wave()</a> and there should be no need to call this function directly.</p>
<p>For all boards except THETA, this function auto-scales the (float) values in KS_WAVEFORM so that the maximum absolute value becomes +/- 32766. The output short int (KS_IWAVE) array is to be copied to hardware. For a KS_WAVEFORM on the THETA board, the necessary phase wraps and scaling to short int format is performed using <a class="el" href="_k_s_foundation_8h.html#acc2435255232dccd6cd217bc605422cd" title="Returns the integer phase (internal use)">ks_phase_degrees2hw()</a>. GE's requirement of only having even numbers in the waveform except for a final odd value (end-of-waveform) is also taken care of here</p>
<p>Note that the preservation of the physical units are done in <a class="el" href="_k_s_foundation_8h.html#afc06ade569c7b85c1aa5026fc2e1c710" title="Places a KS_WAVE sequence object on a board at some position in the pulse sequence">ks_pg_wave()</a> by setting the correct instruction amplitude to multiply this auto-scaled waveform with in the sequence's hardware memory</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">iwave</td><td>KS_IWAVE (short int array) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">waveform</td><td>KS_WAVEFORM </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">res</td><td>Resolution (i.e. number of samples) in the KS_WAVEFORM </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">board</td><td>One of XGRAD, YGRAD, ZGRAD, RHO, THETA, OMEGA </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;                                                                                         {</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;  <span class="keywordflow">if</span> (board != THETA) {</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;    <span class="keywordtype">float</span> absmax = <a class="code" href="_k_s_foundation__common_8c.html#abf8e5bff3973c32360bc0e1505db61bc">ks_waveform_absmax</a>(waveform, res);</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; res; i++) {</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;      iwave[i] = ((short) (max_pg_wamp * waveform[i] / absmax)) &amp; ~WEOS_BIT;</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;    }</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; res; i++) {</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;      iwave[i] = ((short) <a class="code" href="_k_s_foundation__common_8c.html#aa875ce80cee0a35eb44d31f981de253a">ks_phase_degrees2hw</a>(waveform[i])) &amp; ~WEOS_BIT;</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;    }</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;  }</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;  <span class="comment">/* set end-of-waveform flag */</span></div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;  iwave[res - 1] |= WEOS_BIT;</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;} <span class="comment">/* ks_wave2iwave() */</span></div><div class="ttc" id="_k_s_foundation__common_8c_html_abf8e5bff3973c32360bc0e1505db61bc"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf8e5bff3973c32360bc0e1505db61bc">ks_waveform_absmax</a></div><div class="ttdeci">float ks_waveform_absmax(const KS_WAVEFORM waveform, int res)</div><div class="ttdoc">Returns the maximum absolute value in a KS_WAVEFORM</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:965</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_aa875ce80cee0a35eb44d31f981de253a"><div class="ttname"><a href="_k_s_foundation__common_8c.html#aa875ce80cee0a35eb44d31f981de253a">ks_phase_degrees2hw</a></div><div class="ttdeci">short ks_phase_degrees2hw(float phase)</div><div class="ttdoc">Returns the integer phase (internal use)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:234</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a016372aaa6f16b986000c56b9792fefd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a016372aaa6f16b986000c56b9792fefd">&#9670;&nbsp;</a></span>ks_wave2iwave()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_wave2iwave </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_k_s_foundation_8h.html#abba996c24da629eea72eecbd9a22a873">KS_IWAVE</a>&#160;</td>
          <td class="paramname"><em>iwave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>board</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>(<em>Internal use</em>) Conversion of waveform content in a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> sequence object to a short int array for use on hardware</h4>
</p>
<p>This function is used internally by <a class="el" href="_k_s_foundation_8h.html#afc06ade569c7b85c1aa5026fc2e1c710" title="Places a KS_WAVE sequence object on a board at some position in the pulse sequence">ks_pg_wave()</a> and there should be no need to call this function directly.</p>
<p>For all boards except THETA, this function auto-scales the (float) values in the <code>.waveform[]</code> field so that the maximum absolute value becomes +/- 32766. The output short int (KS_IWAVE) array is to be copied to hardware. For a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> on the THETA board, the necessary phase wraps and scaling to short int format is performed using <a class="el" href="_k_s_foundation_8h.html#acc2435255232dccd6cd217bc605422cd" title="Returns the integer phase (internal use)">ks_phase_degrees2hw()</a>. GE's requirement of only having even numbers in the waveform except for a final odd value (end-of-waveform) is also taken care of here</p>
<p>Note that the preservation of the physical units are done in <a class="el" href="_k_s_foundation_8h.html#afc06ade569c7b85c1aa5026fc2e1c710" title="Places a KS_WAVE sequence object on a board at some position in the pulse sequence">ks_pg_wave()</a> by setting the correct instruction amplitude to multiply this auto-scaled waveform with in the sequence's hardware memory</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">iwave</td><td>KS_IWAVE (short int array) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">wave</td><td><a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">board</td><td>One of XGRAD, YGRAD, ZGRAD, RHO, THETA, OMEGA </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;                                                                     {</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#a8a25c2686e8915b6953cee6568ec69e3">ks_waveform2iwave</a>(iwave, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>, board);</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a8a25c2686e8915b6953cee6568ec69e3"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a8a25c2686e8915b6953cee6568ec69e3">ks_waveform2iwave</a></div><div class="ttdeci">STATUS ks_waveform2iwave(KS_IWAVE iwave, const KS_WAVEFORM waveform, int res, int board)</div><div class="ttdoc">(Internal use) Conversion of a KS_WAVEFORM to a short int array for use on hardware</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1155</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a27640b66342aa92e2fecafb0e8471785"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">KS_WAVE::waveform</a></div><div class="ttdeci">KS_WAVEFORM waveform</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:519</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a220c36b2fe5f7910508f38d66cfd6335"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a220c36b2fe5f7910508f38d66cfd6335">&#9670;&nbsp;</a></span>ks_pg_echossp()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">WF_PULSE* ks_pg_echossp </td>
          <td>(</td>
          <td class="paramtype">WF_PULSE *&#160;</td>
          <td class="paramname"><em>echo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>suffix</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the pointer to XTR or RBA for an echo WF_PULSE (<em>internal use</em>)</h4>
</p>
<p>This function is used internally by <a class="el" href="_k_s_foundation_8h.html#a5b50d0ffcc69966c42bceb7e67c70cbf" title="Places a KS_READ sequence object at some position in the pulse sequence">ks_pg_read()</a> to get pointers to the XTR and RBA SSP packets for an acquisition window</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">echo</td><td>Pointer to an echo (WF_PULSE) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">suffix</td><td>String being "xtr", "rba", or empty </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">wfptr</td><td>Pointer to a WF_PULSE </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;                                                       {</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;  <span class="keywordflow">if</span> (!strcmp(suffix, <span class="stringliteral">&quot;xtr&quot;</span>)) {</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;    <span class="keywordflow">return</span> echo-&gt;assoc_pulse;</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(suffix, <span class="stringliteral">&quot;rba&quot;</span>)) {</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;    <span class="keywordflow">return</span> echo-&gt;assoc_pulse-&gt;assoc_pulse;</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;    <span class="keywordflow">return</span> echo;</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;  }</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a61651c54c4dfd4388fc939d804a9964b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a61651c54c4dfd4388fc939d804a9964b">&#9670;&nbsp;</a></span>ks_pg_trap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_pg_trap </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> *&#160;</td>
          <td class="paramname"><em>trap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a>&#160;</td>
          <td class="paramname"><em>loc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>ctrl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Places a <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> sequence object on a board at some position in the pulse sequence</h4>
</p>
<p>This function should be called in the <code>@pg</code> section to place out a <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> sequence object that creates a static trapezoid in the pulse sequence. The same <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object can be freely placed on XGRAD, YGRAD and ZGRAD as many times as desired, by only changing the second argument each time (to avoid waveform overlaps). The second argument is a <a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> struct with three fields:</p><ul>
<li><code>.board</code>: Choose between XGRAD, YGRAD, ZGRAD (or OMEGA)</li>
<li><code>.pos</code>: Absolute time in [us] of the start of the attack ramp of the trapezoid</li>
<li><code>.ampscale</code>: A factor that must be in range [-1.0,1.0] that is multiplied with <code>.amp</code> to yield a per-instance (i.e. per-placement) amplitude ([G/cm]). The simplest is to use 1.0, which makes the <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object to be placed out on the board as initially designed using <a class="el" href="_k_s_foundation_8h.html#af40cc818066c7757959bf3712bfc5e6f" title="Sets up a trapezoid using a KS_TRAP sequence object with preset gradient constraints">ks_eval_trap()</a>. For the OMEGA board, this factor must be 1.0.</li>
</ul>
<p>Regardless of the order placed out in the <code>@pg</code> section, and on which boards (XGRAD, YGRAD, ZGRAD) the <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object is placed, the <em>instance</em> number of the <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> is automatically sorted in time. If two instances of one <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> occur at the same time (<code>.pos</code>) on different boards, XGRAD comes before YGRAD, which comes before ZGRAD. These abstract, sorted, instance numbers are used by <code>ks_scan_***()</code> functions in <a class="el" href="ksepi_8e.html#a1669428052472d00b1c55a1291f8032f">scan()</a> to refer to a specific instance of a <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object in the sequence</p>
<p>If the <code>.duration</code> field in the <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object is 0, <a class="el" href="_k_s_foundation_8h.html#a61651c54c4dfd4388fc939d804a9964b" title="Places a KS_TRAP sequence object on a board at some position in the pulse sequence">ks_pg_trap()</a> will return SUCCESS and quietly ignore placing it out. This is a part of the mechanism that setting the <code>.duration</code> field to 0 in <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code> should eliminate its existance in both timing calulations and in the pulse sequence generation in <code>@pg</code></p>
<p>When a trapezoid is placed on OMEGA, neither the designed amplitude (the <code>.amp</code> field in <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a>) nor the <code>.ampscale</code> (in <a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a>) has an effect on the final frequency modulation. Instead the run-time amplitude of a <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object on the OMEGA board is controlled in <a class="el" href="ksepi_8e.html#a1669428052472d00b1c55a1291f8032f">scan()</a> via a function called <a class="el" href="_k_s_foundation_8h.html#adbd649762fa938de96662bdc9a721863" title="Updates a KS_TRAP object on the OMEGA board to produce a frequency offset">ks_scan_omegatrap_hz()</a></p>
<p>GENERAL NOTE: It is a <b>requirement</b> that the function in the <code>@pg</code> section containing all <code>ks_pg_***()</code> calls is also called exactly once in <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code> after the calls to the corresponding <code>ks_eval_***()</code> functions that design the KS_*** sequence objects. Each <code>ks_pg_***()</code> will throw an error if this has not been done.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">trap</td><td>Pointer to a <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> sequence object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">loc</td><td><a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> struct to specify when and where to place the <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctrl</td><td>Pointer to the <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> struct corresponding to the sequence module for this <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;                                                                      {</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;  <span class="keywordtype">float</span> boardmax;</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;  <span class="keywordtype">char</span> boardc[7] = <span class="stringliteral">&quot;xyz---o&quot;</span>;</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;  boardmax = <a class="code" href="_k_s_foundation__common_8c.html#aa65115d54842eeffc47a1b324caa62ab">ks_syslimits_gradtarget</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>); <span class="comment">/* returns 1.0 for OMEGA board */</span></div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;  <span class="comment">/* checking for NULL pointers */</span></div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;  <span class="keywordflow">if</span> (trap == NULL) {</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_trap: First argument is NULL&quot;</span>);</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;  }</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;  <span class="comment">/* duration of 0 should not throw an error as this is a sign of that it has not been set up</span></div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;<span class="comment">     or has manually been disabled this way */</span></div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;  <span class="keywordflow">if</span> (trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> == 0) {</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;    <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;  }</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;  <span class="keywordflow">if</span> (trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a> == NULL || trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>[0] == 0 || trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>[0] == <span class="charliteral">&#39; &#39;</span>) {</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_trap: Invalid description (&#39;%s&#39;)&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;  }</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;  <span class="comment">/* TGT: Don&#39;t place anything on hardware if ctrl-&gt;duration = 0.</span></div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;<span class="comment">     This is in concert with:</span></div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;<span class="comment">     - not performing createseq() in KS_SEQLENGTH if seqctrl.duration = 0</span></div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;<span class="comment">     - not playing sequence modules in scan() using ks_scan_playsequence() if seqctrl.duration = 0</span></div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;  <span class="keywordflow">if</span> (ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> == 0) {</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s(%s): Refusing to place trap since seqctrl.duration = 0 (indicating `%s` not to be played in scan())&quot;</span>, __FUNCTION__, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;  }</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;  <span class="comment">/* input validation */</span></div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;  <span class="keywordflow">if</span> ((trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a> % 4) || (trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">plateautime</a> % 4) || (trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> % 4)) {</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_trap(%s): All timing parameters must be divisible by 4&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;  }</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;  <span class="keywordflow">if</span> ((trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a> &lt; 4) || (trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">plateautime</a> &lt; 4) || (trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> &lt; 4)) {</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_trap(%s): All timing parameters must be at least 4 us&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;  }</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> != loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a>) {</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_trap(%s): loc.ampscale NaN&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;  }</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> != loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>) {</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_trap(%s): loc.pos NaN&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;  }</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> != loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>) {</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_trap(%s): loc.board NaN&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;  }</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> &lt; GRAD_UPDATE_TIME || loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> &gt; 4e6) {</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_trap(%s): Invalid position %d, it must be between 4us and 4s&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>);</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;  }</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == OMEGA &amp;&amp; loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> != 1.0) {</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_trap(%s): ampscale must be +1.0 for OMEGA&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;  }</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> &lt; -1.0 || loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> &gt; 1.0) {</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_trap(%s): Invalid ampscale %g, it must be between -1.0 and 1.0&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a>);</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;  }</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> != XGRAD &amp;&amp; loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> != YGRAD &amp;&amp; loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> != ZGRAD &amp;&amp; loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> != OMEGA) {</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_trap(%s): Invalid board code %d, it must be %d (XGRAD), %d (YGRAD), %d (ZGRAD) or %d (OMEGA)&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>, XGRAD, YGRAD, ZGRAD, OMEGA);</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;  }</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;  <span class="keywordflow">if</span> (fabs(trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a> * loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a>) &gt; boardmax) {</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_trap(%s): trapezoid amplitude %g exceeds maximum (%g) for board %c&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a> * loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a>, boardmax, boardc[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>]);</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;  }</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;  loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> = RUP_GRD(loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>);</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;  {</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;    <span class="keywordtype">int</span> i;</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;    <span class="keywordtype">char</span> tmpstr[<a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> + 7];</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;    tmpstr[<a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> + 7 - 1] = 0;</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;    <span class="keywordflow">if</span> (trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a> &gt;= trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>) {</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;      <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_trap @tgt(%s): the number of instances generated on the target exceeds the number of ones generated on the host&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;      <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;    }</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;    <span class="keywordflow">if</span> (!ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#af7f2aa8614e77ef8af0154c7e071ab0e">is_cleared_on_tgt</a>) <span class="comment">/* Reset gradrfctrl on tgt to remove dead pointers copied from host. */</span></div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;    {</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;      <a class="code" href="_k_s_foundation_8h.html#a4ec679c0fb8eb62c1776e67434e25b77">ks_tgt_reset_gradrfctrl</a>(&amp;ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>);</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;    }</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;    <span class="comment">/* TODO: consider freeing memory if ngenerated is zero -- EA */</span></div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;    <span class="keywordflow">if</span> (trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a> == NULL) {</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;      WF_PULSE wfInit = INITPULSE;</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;      trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a> = (WF_PULSE **) AllocNode(8 * <span class="keyword">sizeof</span>(WF_PULSE *)); <span class="comment">/* X, Y, Z, (OMEGA = 6). Not applicable to other boards */</span></div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;      <span class="keywordflow">for</span> (i = XGRAD; i &lt;= OMEGA; i++) {</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;        <span class="keywordflow">if</span> (i == XGRAD || i == YGRAD || i == ZGRAD || i == OMEGA) {</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;          trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[i] = (WF_PULSE *) AllocNode(3 * <span class="keyword">sizeof</span>(WF_PULSE)); <span class="comment">/* attack, plateau, decay */</span></div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;          <span class="comment">/* init pulse structure */</span></div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;          trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[i][<a class="code" href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5ae2ef535229a83f6deb239caa1ff7120e">G_ATTACK</a>] = wfInit;</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;          trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[i][<a class="code" href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5ac00e089392912df36396789decb230a4">G_PLATEAU</a>] = wfInit;</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;          trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[i][<a class="code" href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5a8b1103e672a6fc1aa616ac7f422410de">G_DECAY</a>] = wfInit;</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;          <span class="comment">/* Name for WF_PULSEs */</span></div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;          sprintf(tmpstr, <span class="stringliteral">&quot;%s.%ca&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, boardc[i]); pulsename(&amp;(trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[i][<a class="code" href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5ae2ef535229a83f6deb239caa1ff7120e">G_ATTACK</a>]), tmpstr);</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;          sprintf(tmpstr, <span class="stringliteral">&quot;%s.%c&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>,  boardc[i]); pulsename(&amp;(trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[i][<a class="code" href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5ac00e089392912df36396789decb230a4">G_PLATEAU</a>]), tmpstr);</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;          sprintf(tmpstr, <span class="stringliteral">&quot;%s.%cd&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, boardc[i]); pulsename(&amp;(trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[i][<a class="code" href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5a8b1103e672a6fc1aa616ac7f422410de">G_DECAY</a>]), tmpstr);</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;          createramp(&amp;(trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[i][<a class="code" href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5ae2ef535229a83f6deb239caa1ff7120e">G_ATTACK</a>]), i, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a>, 0, max_pg_wamp,</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;                     <a class="code" href="_k_s_foundation__common_8c.html#ae202b6536335ff4d767690e182e8fc4f">maxGradRes</a> * (trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a> / GRAD_UPDATE_TIME), 1.0);</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;          createconst(&amp;(trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[i][<a class="code" href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5ac00e089392912df36396789decb230a4">G_PLATEAU</a>]), i, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">plateautime</a>, max_pg_wamp);</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;          createramp(&amp;(trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[i][<a class="code" href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5a8b1103e672a6fc1aa616ac7f422410de">G_DECAY</a>]), i, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a>, max_pg_wamp, 0,</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;                     <a class="code" href="_k_s_foundation__common_8c.html#ae202b6536335ff4d767690e182e8fc4f">maxGradRes</a> * (trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a> / GRAD_UPDATE_TIME), 1.0);</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;          linkpulses(3, &amp;(trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[i][<a class="code" href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5ac00e089392912df36396789decb230a4">G_PLATEAU</a>]), &amp;(trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[i][<a class="code" href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5ae2ef535229a83f6deb239caa1ff7120e">G_ATTACK</a>]), &amp;(trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[i][<a class="code" href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5a8b1103e672a6fc1aa616ac7f422410de">G_DECAY</a>]));</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;          trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[i] = NULL;</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;        }</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;      } <span class="comment">/* per board */</span></div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;    } <span class="comment">/* wfpulse == NULL */</span></div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;    <span class="comment">/* allocate the array of WFINSTANCE&#39;s if needed */</span></div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;    <span class="keywordflow">if</span> (!trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>) {</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;      trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">wfi</a> = (<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a> *) AllocNode(trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a> * <span class="keyword">sizeof</span>(<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a>));</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;    }</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;    <span class="comment">/* Set instruction amplitudes at the proper position and board */</span></div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;    {</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">int</span> corrected_pos = loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> + (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == OMEGA)*<a class="code" href="_k_s_foundation__common_8c.html#a636634b6eb50758af3826332f9180e9b">psd_rf_wait</a>;</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;      <span class="comment">/* creating new instructions */</span></div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;      createinstr(&amp;(trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>][<a class="code" href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5ae2ef535229a83f6deb239caa1ff7120e">G_ATTACK</a>]),</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;                  corrected_pos,</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;                  trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a>,</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;                  trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a> * loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> * MAX_PG_IAMP / boardmax);</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;      createinstr(&amp;(trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>][<a class="code" href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5ac00e089392912df36396789decb230a4">G_PLATEAU</a>]),</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;                  corrected_pos + trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a>,</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;                  trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">plateautime</a>,</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;                  trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a> * loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> * MAX_PG_IAMP / boardmax);</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;      createinstr(&amp;(trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>][<a class="code" href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5a8b1103e672a6fc1aa616ac7f422410de">G_DECAY</a>]),</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;                  corrected_pos + trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a> + trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">plateautime</a>,</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;                  trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a>,</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;                  trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a> * loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> * MAX_PG_IAMP / boardmax);</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;    }</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;    <span class="comment">/* initializing the corresponding KS_WFINSTANCE */</span></div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;    trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">boardinstance</a> = trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>][<a class="code" href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5ac00e089392912df36396789decb230a4">G_PLATEAU</a>].ninsts - 1; <span class="comment">/* zero based */</span></div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;    trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">wf</a> = &amp;(trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>][<a class="code" href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5ac00e089392912df36396789decb230a4">G_PLATEAU</a>]);</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;    trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a> = loc;</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;    trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>++;</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;    <span class="comment">/* sort after the last instance is generated */</span></div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;    <span class="keywordflow">if</span> (trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a> == trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>) {</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;      <a class="code" href="_k_s_foundation__common_8c.html#a0ae65ed3cc2deb47ccf50b7988239474">ks_sort_wfi_by_timeboard</a>(trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>);</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;    }</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;  }</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;<span class="preprocessor">#else </span><span class="comment">/* TGT(IPG) or HOST */</span><span class="preprocessor"></span></div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;  {</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;    <span class="comment">/* HOST */</span></div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;    trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a89785a274d251fd637bf40923ad5c345">locs</a>[trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>] = loc;</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;    <span class="comment">/* update instance counter on host only. This counter is used to allocate the right amount of WFINSTANCEs on IPG */</span></div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;    trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>++;</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;    <span class="comment">/* for trap, we also need to keep track of #instances per X, Y, Z for gradient heating calculations.</span></div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;<span class="comment">       As this needs to be done in HOST before the IPG (target), we can&#39;t use the wfi[...].boardinstance or .loc information above for this */</span></div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;    <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == XGRAD || loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == YGRAD || loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == ZGRAD)</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;      trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a3fb111f1302287e152078110b3b37d6f">gradnum</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>]++;</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;  }</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* IPG */</span><span class="preprocessor"></span></div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;    <span class="comment">/* register this KS_TRAP for later heating calculations */</span></div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;    {</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;      STATUS status = <a class="code" href="_k_s_foundation__common_8c.html#a88386ac54f37a7fb0dc91302e585ccae">ks_eval_addtraptogradrfctrl</a>(&amp;ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>, trap);</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;      <span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;    }</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;} <span class="comment">/* ks_pg_trap */</span></div><div class="ttc" id="_k_s_foundation__common_8c_html_a88386ac54f37a7fb0dc91302e585ccae"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a88386ac54f37a7fb0dc91302e585ccae">ks_eval_addtraptogradrfctrl</a></div><div class="ttdeci">STATUS ks_eval_addtraptogradrfctrl(KS_GRADRFCTRL *gradrfctrl, KS_TRAP *trap)</div><div class="ttdoc">*Internal use*. Adds a trapezoid (KS_TRAP) to the KS_GRADRFCTRL struct for later gradient heating cal...</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:3437</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a0ae65ed3cc2deb47ccf50b7988239474"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a0ae65ed3cc2deb47ccf50b7988239474">ks_sort_wfi_by_timeboard</a></div><div class="ttdeci">void ks_sort_wfi_by_timeboard(KS_WFINSTANCE *a, int nitems)</div><div class="ttdoc">Sort WF_INSTANCEs in time, then board</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2955</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a878bb367b07dc7dfb5fef5728d2e5b1d"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">KS_TRAP::plateautime</a></div><div class="ttdeci">int plateautime</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:436</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a42df2e3be0bda47009caae1a7042b522"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">KS_WFINSTANCE::boardinstance</a></div><div class="ttdeci">int boardinstance</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:251</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">KS_TRAP::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:431</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a1910d262855b71da353ed0d07a6c7823"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">KS_SEQLOC::pos</a></div><div class="ttdeci">int pos</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:242</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a></div><div class="ttdoc">(Internal use) Structure being a part of various sequence objects to sort them in time across boards...</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:250</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a72a22b96ff3908d2b9a20a3a02647a2f"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">KS_BASE::ninst</a></div><div class="ttdeci">int ninst</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:261</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a2e3f5254967cadb9a41167c6fbf6743e"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">KS_SEQLOC::board</a></div><div class="ttdeci">int board</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:241</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_SEQ_CONTROL::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:984</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a606fbf556e8a297aa1f68b098f6ac2a2"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">KS_SEQLOC::ampscale</a></div><div class="ttdeci">float ampscale</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:243</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a51a2c4637bfcef5c062d3c794ed4ded5ac00e089392912df36396789decb230a4"><div class="ttname"><a href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5ac00e089392912df36396789decb230a4">G_PLATEAU</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1737</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a2573e18f36ab5c3d3fc97072edcfab16"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">KS_SEQ_CONTROL::gradrf</a></div><div class="ttdeci">KS_GRADRFCTRL gradrf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:992</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a15be3edad342a49398ca841c2745dc9e"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">KS_TRAP::wfi</a></div><div class="ttdeci">KS_WFINSTANCE * wfi</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:441</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aacb2fe1d83c45e8d0525f363bdd6b8a6"><div class="ttname"><a href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a></div><div class="ttdeci">#define KS_DESCRIPTION_LENGTH</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:112</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_ae202b6536335ff4d767690e182e8fc4f"><div class="ttname"><a href="_k_s_foundation__common_8c.html#ae202b6536335ff4d767690e182e8fc4f">maxGradRes</a></div><div class="ttdeci">int maxGradRes</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a78e529e1d86855310035845e03a4c107"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">KS_WFINSTANCE::loc</a></div><div class="ttdeci">KS_SEQLOC loc</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:253</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_af7f2aa8614e77ef8af0154c7e071ab0e"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#af7f2aa8614e77ef8af0154c7e071ab0e">KS_GRADRFCTRL::is_cleared_on_tgt</a></div><div class="ttdeci">int is_cleared_on_tgt</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:823</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_aa65115d54842eeffc47a1b324caa62ab"><div class="ttname"><a href="_k_s_foundation__common_8c.html#aa65115d54842eeffc47a1b324caa62ab">ks_syslimits_gradtarget</a></div><div class="ttdeci">float ks_syslimits_gradtarget(LOG_GRAD loggrd, WF_PROCESSOR board)</div><div class="ttdoc">Returns the maximum target amplitude for a board (internal use)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:176</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ab508ded41392ee86a2a619d3e93d2373"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">KS_TRAP::amp</a></div><div class="ttdeci">float amp</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:433</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a89785a274d251fd637bf40923ad5c345"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a89785a274d251fd637bf40923ad5c345">KS_TRAP::locs</a></div><div class="ttdeci">KS_SEQLOC locs[KS_MAXINSTANCES]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:439</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a558b0ff480e8db364962bd0f203d6958"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">KS_WFINSTANCE::wf</a></div><div class="ttdeci">WF_PULSE * wf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:252</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">KS_TRAP::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:432</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4ec679c0fb8eb62c1776e67434e25b77"><div class="ttname"><a href="_k_s_foundation_8h.html#a4ec679c0fb8eb62c1776e67434e25b77">ks_tgt_reset_gradrfctrl</a></div><div class="ttdeci">void ks_tgt_reset_gradrfctrl(KS_GRADRFCTRL *gradrfctrl)</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1402</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">KS_SEQ_CONTROL::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:990</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a51a2c4637bfcef5c062d3c794ed4ded5ae2ef535229a83f6deb239caa1ff7120e"><div class="ttname"><a href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5ae2ef535229a83f6deb239caa1ff7120e">G_ATTACK</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1737</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a9428be182c75f60d1b4e6fe36c888afa"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">KS_TRAP::wfpulse</a></div><div class="ttdeci">WF_PULSE ** wfpulse</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:440</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_TRAP::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:437</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a636634b6eb50758af3826332f9180e9b"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a636634b6eb50758af3826332f9180e9b">psd_rf_wait</a></div><div class="ttdeci">int psd_rf_wait</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a3fb111f1302287e152078110b3b37d6f"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a3fb111f1302287e152078110b3b37d6f">KS_TRAP::gradnum</a></div><div class="ttdeci">int gradnum[3]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:438</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a51a2c4637bfcef5c062d3c794ed4ded5a8b1103e672a6fc1aa616ac7f422410de"><div class="ttname"><a href="_k_s_foundation_8h.html#a51a2c4637bfcef5c062d3c794ed4ded5a8b1103e672a6fc1aa616ac7f422410de">G_DECAY</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1737</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_acbc719dc4e48c2a2df0447875e4348ca"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">KS_TRAP::ramptime</a></div><div class="ttdeci">int ramptime</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:435</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a5b50d0ffcc69966c42bceb7e67c70cbf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5b50d0ffcc69966c42bceb7e67c70cbf">&#9670;&nbsp;</a></span>ks_pg_read()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_pg_read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_e_a_d.html">KS_READ</a> *&#160;</td>
          <td class="paramname"><em>read</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>ctrl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Places a <a class="el" href="struct_k_s___r_e_a_d.html" title="Core sequence object that handles a data acquisition window">KS_READ</a> sequence object at some position in the pulse sequence</h4>
</p>
<p>This function should be called in the <code>@pg</code> section to place out a <a class="el" href="struct_k_s___r_e_a_d.html" title="Core sequence object that handles a data acquisition window">KS_READ</a> sequence object that creates an acquisition window in the pulse sequence. The same <a class="el" href="struct_k_s___r_e_a_d.html" title="Core sequence object that handles a data acquisition window">KS_READ</a> object can be freely placed as many times as desired, by only changing the second argument each time (to avoid overlaps). The second argument is an integer with the absolute time in [us] of the start of the acquisition. System gradient delays are accounted for in <a class="el" href="_k_s_foundation_8h.html#a5b50d0ffcc69966c42bceb7e67c70cbf" title="Places a KS_READ sequence object at some position in the pulse sequence">ks_pg_read()</a> by internally adjusting the position by adding the system variable <code>psd_grd_wait</code> to the position value. This assures the gradients boards and acquisition window are in sync on the MR system.</p>
<p>Regardless of the order the acquisition windows are placed out in the <code>@pg</code> section, the <em>instance</em> number of the <a class="el" href="struct_k_s___r_e_a_d.html" title="Core sequence object that handles a data acquisition window">KS_READ</a> is automatically sorted in time</p>
<p>If the <code>.duration</code> field in the <a class="el" href="struct_k_s___r_e_a_d.html" title="Core sequence object that handles a data acquisition window">KS_READ</a> object is 0, <a class="el" href="_k_s_foundation_8h.html#a5b50d0ffcc69966c42bceb7e67c70cbf" title="Places a KS_READ sequence object at some position in the pulse sequence">ks_pg_read()</a> will return SUCCESS and quietly ignore placing it out. This is a part of the mechanism that setting the <code>.duration</code> field to 0 in <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code> should eliminate its existance in both timing calulations and in the pulse sequence generation in <code>@pg</code></p>
<p>GENERAL NOTE: It is a <b>requirement</b> that the function in the <code>@pg</code> section containing all <code>ks_pg_***()</code> calls is also called exactly once in <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code> after the calls to the corresponding <code>ks_eval_***()</code> functions that design the KS_*** sequence objects. Each <code>ks_pg_***()</code> will throw an error if this has not been done.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">read</td><td>Pointer to a <a class="el" href="struct_k_s___r_e_a_d.html" title="Core sequence object that handles a data acquisition window">KS_READ</a> sequence object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pos</td><td>Absolute time in [us] when to start data acquisition </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctrl</td><td>Pointer to the <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> struct corresponding to the sequence module for this <a class="el" href="struct_k_s___r_e_a_d.html" title="Core sequence object that handles a data acquisition window">KS_READ</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;                                                                {</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;  <span class="keywordtype">int</span> acqwin_start;</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;  <span class="keywordtype">int</span> placementindx;</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;  <span class="keywordtype">long</span> dab_pos;</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;  <span class="keywordtype">char</span> tmpstr[<a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> + 7];</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;  STATUS status;</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;  <span class="comment">/* duration of 0 should not throw an error as this is a sign of that it has not been set up or has manually been disabled this way */</span></div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;  <span class="keywordflow">if</span> (read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> == 0) {</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;    <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;  }</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;  {</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;    tmpstr[<a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> + 7 - 1] = 0;</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;    <span class="keywordflow">if</span> (read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a> &gt;= read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>) {</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;      <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_read @tgt(%s): the number of instances generated on the target exceeds the number of ones generated on the host&quot;</span>, read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;      <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;    }</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;    <span class="keywordflow">if</span> (!ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#af7f2aa8614e77ef8af0154c7e071ab0e">is_cleared_on_tgt</a>) { <span class="comment">/* Reset gradrfctrl on tgt to remove dead pointers copied from host. */</span></div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;      <a class="code" href="_k_s_foundation_8h.html#a4ec679c0fb8eb62c1776e67434e25b77">ks_tgt_reset_gradrfctrl</a>(&amp;ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>);</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;    }</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;    <span class="keywordflow">if</span> (read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a0e0bae3aa47ae5b8aae488fa0eb920ce">echo</a> == NULL) {</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;      <span class="comment">/* this relies on that we have run the sequence in cveval() (i.e. on host) before to get proper grad.ninst */</span></div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;      read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a0e0bae3aa47ae5b8aae488fa0eb920ce">echo</a> = (WF_PULSE *) AllocNode(read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a> * <span class="keyword">sizeof</span>(WF_PULSE));</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;    }</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;    placementindx = read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>; <span class="comment">/* not sorted in time, but in placement order */</span></div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;    acqwin_start = pos + <a class="code" href="_k_s_foundation__common_8c.html#aa4225c3edfbcb8e85d91fc491a495058">psd_grd_wait</a>;</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;    <span class="keywordflow">if</span> (placementindx == 0 || read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">filt</a>.tdaq &gt; 200) {</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;      dab_pos = DEFAULTPOS; <span class="comment">/* results in 200 us before RBA (DEFAULTPOS is defined as 0. See: /ESE_.../psd/include/private/pulsegen.h) */</span></div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;      <span class="comment">/* For small matrix sizes, the acq window is so short that the DAB packet</span></div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;<span class="comment">         for current lobe may collide with the RBA belonging to the previous lobe.</span></div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;<span class="comment">         We are not allowed to decrease the DAB-RBA distance below 200us. Instead,</span></div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;<span class="comment">         let&#39;s put it right after the end of the previous XTR pulse.</span></div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;<span class="comment">         With the default XTR-RBA offset of 143us, and since the RBA-RBA distance</span></div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;<span class="comment">         is equal to read-&gt;grad.duration, we will get a DAB-RBA offset of</span></div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;<span class="comment">      acqwin_duration + 143us - 17us (XTR duration)</span></div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;<span class="comment">      */</span></div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;      dab_pos = pbegallssp(<a class="code" href="_k_s_foundation__common_8c.html#a220c36b2fe5f7910508f38d66cfd6335">ks_pg_echossp</a>(&amp;read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a0e0bae3aa47ae5b8aae488fa0eb920ce">echo</a>[placementindx - 1], <span class="stringliteral">&quot;xtr&quot;</span>), 0) + 17;</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;      <span class="keywordflow">if</span> (dab_pos + 200 &gt; acqwin_start)</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;        dab_pos = DEFAULTPOS; <span class="comment">/* fallback to default pos. Perhaps the readouts were not placed out in time order in the PSD ? */</span></div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;    }</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;    <span class="comment">/* name the ACQ pulse */</span></div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;    sprintf(tmpstr, <span class="stringliteral">&quot;%s%03d&quot;</span>, read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, placementindx); pulsename(&amp;(read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a0e0bae3aa47ae5b8aae488fa0eb920ce">echo</a>[placementindx]), tmpstr);</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;    <span class="keywordflow">if</span> (read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">filt</a>.fslot == <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>) {</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;      <span class="comment">/* add &#39;return&#39; before ks_error once we&#39;ve got an answer from GE regarding acqq and setrfltrs() */</span></div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;      <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_read @tgt(%s): WARNING no filter slot assigned. First run setfilter(&amp;read.filt)&quot;</span>, read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;    }</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;    <span class="comment">/* place the ACQ pulse */</span></div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;    acqq(&amp;(read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a0e0bae3aa47ae5b8aae488fa0eb920ce">echo</a>[placementindx]),</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;         (<span class="keywordtype">long</span>) acqwin_start,</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;         (<span class="keywordtype">long</span>) dab_pos, <span class="comment">/* DAB */</span></div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;         (<span class="keywordtype">long</span>) DEFAULTPOS, <span class="comment">/* XTR */</span></div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;         read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">filt</a>.fslot, <span class="comment">/* filter slot */</span></div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;         (TYPDAB_PACKETS) DABNORM);</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;    read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>++;</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;    <span class="comment">/* sort after the last instance is generated */</span></div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;    <span class="keywordflow">if</span> (read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a> == read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>) {</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;      <a class="code" href="_k_s_foundation__common_8c.html#a42180e710dc1f89e9a557683f8f58dda">ks_sort_wfp_by_time</a>(read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a0e0bae3aa47ae5b8aae488fa0eb920ce">echo</a>, read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>);</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;    }</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;    <span class="comment">/* Associate this echo with a global filter slot number</span></div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;<span class="comment">       This number is generated by the GE function setfilter() in e.g. predownload(), before this function is called.</span></div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;<span class="comment">       For main sequences, there is also the wrapper function GEReq_predownload_setfilter() */</span></div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;    <span class="keywordflow">if</span> (read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">filt</a>.fslot &gt;= 0 &amp;&amp; read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">filt</a>.fslot &lt;= MAX_FILTER_SLOT) {</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;      setrfltrs((<span class="keywordtype">int</span>) read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">filt</a>.fslot, &amp;(read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a0e0bae3aa47ae5b8aae488fa0eb920ce">echo</a>[placementindx]));</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;    }</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;  }</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;<span class="preprocessor">#else </span><span class="comment">/* IPG */</span><span class="preprocessor"></span></div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;  {</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;    read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a94207eb79ef6154f75eb3f363bb5df0a">pos</a>[read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>] = pos;</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;    read-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>++; <span class="comment">/* update acq counter on host */</span></div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;  }</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* IPG */</span><span class="preprocessor"></span></div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;  status = <a class="code" href="_k_s_foundation__common_8c.html#a58400508a44d80fc140baeb987f7c435">ks_eval_addreadtogradrfctrl</a>(&amp;ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>, read);</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;  <span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;}</div><div class="ttc" id="struct_k_s___r_e_a_d_html_a0e0bae3aa47ae5b8aae488fa0eb920ce"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a0e0bae3aa47ae5b8aae488fa0eb920ce">KS_READ::echo</a></div><div class="ttdeci">WF_PULSE * echo</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:587</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a42180e710dc1f89e9a557683f8f58dda"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a42180e710dc1f89e9a557683f8f58dda">ks_sort_wfp_by_time</a></div><div class="ttdeci">void ks_sort_wfp_by_time(WF_PULSE *a, int nitems)</div><div class="ttdoc">Sort WF_PULSEs in time</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2964</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_afd953f31b866a09e0418967c2bf65a59"><div class="ttname"><a href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a></div><div class="ttdeci">#define KS_NOTSET</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:60</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a72a22b96ff3908d2b9a20a3a02647a2f"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">KS_BASE::ninst</a></div><div class="ttdeci">int ninst</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:261</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a58400508a44d80fc140baeb987f7c435"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a58400508a44d80fc140baeb987f7c435">ks_eval_addreadtogradrfctrl</a></div><div class="ttdeci">STATUS ks_eval_addreadtogradrfctrl(KS_GRADRFCTRL *gradrfctrl, KS_READ *read)</div><div class="ttdoc">*Internal use*. Adds an acquisition to the KS_GRADRFCTRL struct. Used for plotting</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:3521</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a220c36b2fe5f7910508f38d66cfd6335"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a220c36b2fe5f7910508f38d66cfd6335">ks_pg_echossp</a></div><div class="ttdeci">WF_PULSE * ks_pg_echossp(WF_PULSE *echo, char *suffix)</div><div class="ttdoc">Returns the pointer to XTR or RBA for an echo WF_PULSE (internal use)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1195</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">KS_READ::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:581</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a2573e18f36ab5c3d3fc97072edcfab16"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">KS_SEQ_CONTROL::gradrf</a></div><div class="ttdeci">KS_GRADRFCTRL gradrf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:992</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a1c544bec41003a594ba4ec7d43a3a470">KS_READ::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:582</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aacb2fe1d83c45e8d0525f363bdd6b8a6"><div class="ttname"><a href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a></div><div class="ttdeci">#define KS_DESCRIPTION_LENGTH</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:112</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_af7f2aa8614e77ef8af0154c7e071ab0e"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#af7f2aa8614e77ef8af0154c7e071ab0e">KS_GRADRFCTRL::is_cleared_on_tgt</a></div><div class="ttdeci">int is_cleared_on_tgt</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:823</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_READ::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:583</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a292f93e48d34cda511fcfb72a05558c2"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">KS_READ::filt</a></div><div class="ttdeci">FILTER_INFO filt</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:585</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_aa4225c3edfbcb8e85d91fc491a495058"><div class="ttname"><a href="_k_s_foundation__common_8c.html#aa4225c3edfbcb8e85d91fc491a495058">psd_grd_wait</a></div><div class="ttdeci">int psd_grd_wait</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4ec679c0fb8eb62c1776e67434e25b77"><div class="ttname"><a href="_k_s_foundation_8h.html#a4ec679c0fb8eb62c1776e67434e25b77">ks_tgt_reset_gradrfctrl</a></div><div class="ttdeci">void ks_tgt_reset_gradrfctrl(KS_GRADRFCTRL *gradrfctrl)</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1402</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a94207eb79ef6154f75eb3f363bb5df0a"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a94207eb79ef6154f75eb3f363bb5df0a">KS_READ::pos</a></div><div class="ttdeci">int pos[KS_MAXUNIQUE_READ]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:586</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a094595db960708064dc1b8b645c4be71"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a094595db960708064dc1b8b645c4be71">&#9670;&nbsp;</a></span>ks_pg_phaser()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_pg_phaser </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *&#160;</td>
          <td class="paramname"><em>phaser</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a>&#160;</td>
          <td class="paramname"><em>loc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>ctrl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Places a <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> sequence object on a board at some position in the pulse sequence</h4>
</p>
<p>This function should be called in the <code>@pg</code> section to place out a <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> sequence object that creates a dynamic trapezoid for phase encoding. For 3D applications, two different <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> objects should have been designed by calling <a class="el" href="_k_s_foundation_8h.html#acc45c24d1996acd3d95ae2866c5ffb2b" title="Sets up an acquisition window with a trapezoid with preset gradient constraints">ks_eval_phaser()</a> on each <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> as FOV and resolution typically differ for the two phase encoding directions. The same <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object can be freely placed on XGRAD, YGRAD and ZGRAD as many times as desired, by only changing the second argument each time (to avoid waveform overlaps). For Cartesian applications, phase encoding gradients such as <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> are typically placed out on YGRAD (phase encoding axis), for 3D also on ZGRAD. For 3D, the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object may embed a slice rephaser (static trapezoid) by setting <code>.areaoffset</code> to a non-zero value (see <a class="el" href="_k_s_foundation_8h.html#acc45c24d1996acd3d95ae2866c5ffb2b" title="Sets up an acquisition window with a trapezoid with preset gradient constraints">ks_eval_phaser()</a>). The second argument is a <a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> struct with three fields:</p><ul>
<li><code>.board</code>: Choose between XGRAD, YGRAD, ZGRAD</li>
<li><code>.pos</code>: Absolute time in [us] of the start of the attack ramp of the phase encoding trapezoid</li>
<li><code>.ampscale</code>: For <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> objects, this must be 1.0. If not, <a class="el" href="_k_s_foundation_8h.html#a094595db960708064dc1b8b645c4be71" title="Places a KS_PHASER sequence object on a board at some position in the pulse sequence">ks_pg_phaser()</a> will throw an error. Amplitude control should solely be done in scan using <a class="el" href="_k_s_foundation_8h.html#aff91e4da3b6ccabd607ec0da04f774ce" title="Updates the amplitude of a KS_PHASER sequence object to move from the k-space center to a desired k-s...">ks_scan_phaser_toline()</a> and <a class="el" href="_k_s_foundation_8h.html#a81a97893a74af952d90181aa858e709b" title="Updates the amplitude of a KS_PHASER sequence object to move from a k-space line to the k-space cente...">ks_scan_phaser_fromline()</a>.</li>
</ul>
<p>Regardless of the order placed out in the <code>@pg</code> section, and on which boards (XGRAD, YGRAD, ZGRAD) the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object is placed, the <em>instance</em> number of the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> is automatically sorted in time. If two instances of one <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> occur at the same time (<code>.pos</code>) on different boards, XGRAD comes before YGRAD, which comes before ZGRAD. These abstract, sorted, instance numbers are used by <code>ks_scan_***()</code> functions in <a class="el" href="ksepi_8e.html#a1669428052472d00b1c55a1291f8032f">scan()</a> to refer to a specific instance of a <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object in the sequence</p>
<p>If the <code>.duration</code> field in the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object is 0, <a class="el" href="_k_s_foundation_8h.html#a094595db960708064dc1b8b645c4be71" title="Places a KS_PHASER sequence object on a board at some position in the pulse sequence">ks_pg_phaser()</a> will return SUCCESS and quietly ignore placing it out. This is a part of the mechanism that setting the <code>.duration</code> field to 0 in <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code> should eliminate its existance in both timing calulations and in the pulse sequence generation in <code>@pg</code></p>
<p>GENERAL NOTE: It is a <b>requirement</b> that the function in the <code>@pg</code> section containing all <code>ks_pg_***()</code> calls is also called exactly once in <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code> after the calls to the corresponding <code>ks_eval_***()</code> functions that design the KS_*** sequence objects. Each <code>ks_pg_***()</code> will throw an error if this has not been done.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">phaser</td><td>Pointer to a <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> sequence object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">loc</td><td><a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> struct to specify when and where to place the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctrl</td><td>Pointer to the <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> struct corresponding to the sequence module for this <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;                                                                            {</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;  <span class="comment">/* loc.ampscale != 1.0 is not allowed  */</span></div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> != 1.0) {</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_phaser(%s): field &#39;ampscale&#39; in 2nd arg must be 1.0&quot;</span>, phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;  }</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;  <span class="comment">/* loc.board must be one of XGRAD, YGRAD, ZGRAD  */</span></div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> != XGRAD &amp;&amp; loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> != YGRAD &amp;&amp; loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> != ZGRAD) {</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_phaser(%s): field &#39;board&#39; in 2nd arg must be XGRAD, YGRAD, or ZGRAD&quot;</span>, phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;  }</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#ab3341eea000c35a438dfeb3cfc1da103">ks_pg_trap</a>(&amp;phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>, loc, ctrl);</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;}</div><div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">KS_PHASER::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1525</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a2e3f5254967cadb9a41167c6fbf6743e"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">KS_SEQLOC::board</a></div><div class="ttdeci">int board</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:241</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a606fbf556e8a297aa1f68b098f6ac2a2"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">KS_SEQLOC::ampscale</a></div><div class="ttdeci">float ampscale</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:243</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">KS_TRAP::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:432</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_ab3341eea000c35a438dfeb3cfc1da103"><div class="ttname"><a href="_k_s_foundation__common_8c.html#ab3341eea000c35a438dfeb3cfc1da103">ks_pg_trap</a></div><div class="ttdeci">STATUS ks_pg_trap(KS_TRAP *trap, KS_SEQLOC loc, KS_SEQ_CONTROL *ctrl)</div><div class="ttdoc">Places a KS_TRAP sequence object on a board at some position in the pulse sequence</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1212</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a21198913d5b1603f03a5e5d61d00408c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a21198913d5b1603f03a5e5d61d00408c">&#9670;&nbsp;</a></span>ks_pg_readtrap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_pg_readtrap </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a> *&#160;</td>
          <td class="paramname"><em>readtrap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a>&#160;</td>
          <td class="paramname"><em>loc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>ctrl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Places a <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> sequence object on a board at some position in the pulse sequence</h4>
</p>
<p>This function should be called in the <code>@pg</code> section to place out a <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> sequence object consisting of a trapezoid (<a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a>) and an acquisition window (<a class="el" href="struct_k_s___r_e_a_d.html" title="Core sequence object that handles a data acquisition window">KS_READ</a>). The same <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> object can be freely placed on XGRAD, YGRAD and ZGRAD as many times as desired, by only changing the second argument each time (to avoid waveform overlaps). For Cartesian applications, readouts such as <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> are typically placed on XGRAD (frequency encoding axis). The second argument is a <a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> struct with three fields:</p><ul>
<li><code>.board</code>: Choose between XGRAD, YGRAD, ZGRAD</li>
<li><code>.pos</code>: Absolute time in [us] of the start of the attack ramp of the readout trapezoid</li>
<li><code>.ampscale</code>: For <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> objects, this must be either +1.0 or -1.0 so that the FOV is not altered. Negative amplitudes will automatically be taken into account in <a class="el" href="_k_s_foundation_8h.html#a11a9b9d761ba64a74b88c222b2a949e3" title="Updates the frequency and phase of one or all instances of a KS_READTRAP to create a FOV shift...">ks_scan_offsetfov()</a> to create the necessary frequency offset</li>
</ul>
<p>Regardless of the order placed out in the <code>@pg</code> section, and on which boards (XGRAD, YGRAD, ZGRAD) the <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> object is placed, the <em>instance</em> number of the <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> is automatically sorted in time. If two instances of one <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> occur at the same time (<code>.pos</code>) on different boards, XGRAD comes before YGRAD, which comes before ZGRAD. These abstract, sorted, instance numbers are used by <code>ks_scan_***()</code> functions in <a class="el" href="ksepi_8e.html#a1669428052472d00b1c55a1291f8032f">scan()</a> to refer to a specific instance of a <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> object in the sequence.</p>
<p>If the <code>.duration</code> field in the <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> object is 0, <a class="el" href="_k_s_foundation_8h.html#a21198913d5b1603f03a5e5d61d00408c" title="Places a KS_READTRAP sequence object on a board at some position in the pulse sequence">ks_pg_readtrap()</a> will return SUCCESS and quietly ignore placing it out. This is a part of the mechanism that setting the <code>.duration</code> field to 0 in <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code> should eliminate its existance in both timing calulations and in the pulse sequence generation in <code>@pg</code></p>
<p>GENERAL NOTE: It is a <b>requirement</b> that the function in the <code>@pg</code> section containing all <code>ks_pg_***()</code> calls is also called exactly once in <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code> after the calls to the corresponding <code>ks_eval_***()</code> functions that design the KS_*** sequence objects. Each <code>ks_pg_***()</code> will throw an error if this has not been done.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">readtrap</td><td>Pointer to a <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> sequence object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">loc</td><td><a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> struct to specify when and where to place the <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctrl</td><td>Pointer to the <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> struct corresponding to the sequence module for this <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;                                                                                  {</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;  <a class="code" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> omegaloc;</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;  <span class="comment">/* checking for NULL pointers */</span></div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;  <span class="keywordflow">if</span> (readtrap == NULL) {</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: First argument is NULL&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;  }</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;  <span class="comment">/* duration of 0 should not throw an error as this is a sign of that it has not been set up</span></div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;<span class="comment">     or has manually been disabled this way */</span></div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;  <span class="keywordflow">if</span> (readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> == 0) {</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;    <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;  }</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;  <span class="keywordflow">if</span> (readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a> == NULL || readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>[0] == 0 || readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>[0] == <span class="charliteral">&#39; &#39;</span>) {</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: Invalid description (&#39;%s&#39;)&quot;</span>, __FUNCTION__, readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;  }</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;  <span class="comment">/* TGT (IPG): Don&#39;t place anything on hardware if ctrl-&gt;duration = 0.</span></div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;<span class="comment">      This is in concert with:</span></div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;<span class="comment">      - not performing createseq() in KS_SEQLENGTH if seqctrl.duration = 0</span></div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;<span class="comment">     - not playing sequence modules in scan() using ks_scan_playsequence() if seqctrl.duration = 0</span></div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;  <span class="keywordflow">if</span> (ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> == 0) {</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s(%s): Refusing to place readtrap since seqctrl.duration = 0 (indicating `%s` not to be played in scan())&quot;</span>, __FUNCTION__, readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;  }</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> != 1.0 &amp;&amp; loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> != -1.0) {</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s(%s): .ampscale %g must be exactly +1 or -1 for readout gradients&quot;</span>, __FUNCTION__, readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a>);</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;  }</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;  <span class="comment">/*** acq ***/</span></div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#a3bed936c3bb14d2d25d5ddbaa3d54007">ks_pg_read</a>(&amp;readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> + readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a13d3424b69abfaa66668757e06fed900">acqdelay</a>, ctrl) == FAILURE)</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;  <span class="comment">/*** trapezoid ***/</span></div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#ab3341eea000c35a438dfeb3cfc1da103">ks_pg_trap</a>(&amp;readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>, loc, ctrl) == FAILURE)</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;  <span class="comment">/* also place the omega wave form for rampsampled cases */</span></div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;  <span class="keywordflow">if</span> (readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#abd9ff216626c3fd76322a2a56dc606cc">omega</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> &gt; 0) {</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;    <span class="comment">/* omega trapezoid matching the readout lobe to allow for FOV offsets in freq dir. with ramp sampling */</span></div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;    omegaloc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> = OMEGA;</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;    omegaloc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> = loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>;</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;    omegaloc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> = 1.0; <span class="comment">/* just unity value for conformance. It does not matter during scanning, since ks_scan_omegahz() ignores this value */</span></div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#ab3341eea000c35a438dfeb3cfc1da103">ks_pg_trap</a>(&amp;readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#abd9ff216626c3fd76322a2a56dc606cc">omega</a>, omegaloc, ctrl) == FAILURE)</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;      <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;  }</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;} <span class="comment">/* ks_pg_readtrap */</span></div><div class="ttc" id="_k_s_foundation__common_8c_html_a3bed936c3bb14d2d25d5ddbaa3d54007"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a3bed936c3bb14d2d25d5ddbaa3d54007">ks_pg_read</a></div><div class="ttdeci">STATUS ks_pg_read(KS_READ *read, int pos, KS_SEQ_CONTROL *ctrl)</div><div class="ttdoc">Places a KS_READ sequence object at some position in the pulse sequence</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1431</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a1910d262855b71da353ed0d07a6c7823"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">KS_SEQLOC::pos</a></div><div class="ttdeci">int pos</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:242</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a2e3f5254967cadb9a41167c6fbf6743e"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">KS_SEQLOC::board</a></div><div class="ttdeci">int board</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:241</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_SEQ_CONTROL::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:984</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">KS_READTRAP::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1435</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a606fbf556e8a297aa1f68b098f6ac2a2"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">KS_SEQLOC::ampscale</a></div><div class="ttdeci">float ampscale</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:243</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_abd9ff216626c3fd76322a2a56dc606cc"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#abd9ff216626c3fd76322a2a56dc606cc">KS_READTRAP::omega</a></div><div class="ttdeci">KS_TRAP omega</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1436</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a></div><div class="ttdoc">typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:240</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">KS_TRAP::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:432</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">KS_SEQ_CONTROL::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:990</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_ac359c54a7c5f9e9a94105b3c0d0be9ea"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">KS_READTRAP::acq</a></div><div class="ttdeci">KS_READ acq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1423</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_TRAP::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:437</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_ab3341eea000c35a438dfeb3cfc1da103"><div class="ttname"><a href="_k_s_foundation__common_8c.html#ab3341eea000c35a438dfeb3cfc1da103">ks_pg_trap</a></div><div class="ttdeci">STATUS ks_pg_trap(KS_TRAP *trap, KS_SEQLOC loc, KS_SEQ_CONTROL *ctrl)</div><div class="ttdoc">Places a KS_TRAP sequence object on a board at some position in the pulse sequence</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1212</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_a13d3424b69abfaa66668757e06fed900"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#a13d3424b69abfaa66668757e06fed900">KS_READTRAP::acqdelay</a></div><div class="ttdeci">int acqdelay</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1429</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="afc06ade569c7b85c1aa5026fc2e1c710"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afc06ade569c7b85c1aa5026fc2e1c710">&#9670;&nbsp;</a></span>ks_pg_wave()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_pg_wave </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a>&#160;</td>
          <td class="paramname"><em>loc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>ctrl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Places a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> sequence object on a board at some position in the pulse sequence</h4>
</p>
<p>This function should be called in the <code>@pg</code> section to place out a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> sequence object that creates an arbitrary waveform in the pulse sequence. The same <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object can be placed on any board as many times as desired, by only changing the second argument each time (to avoid waveform overlaps). However, the RHO (RF) board should be avoided as this bypasses RF scaling and SAR calculations, providing no control over the flip angle. For RF waveforms, always use <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> (or <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a>). The second argument is a <a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> struct with three fields:</p><ul>
<li><code>.board</code>: Choose between XGRAD, YGRAD, ZGRAD, OMEGA, THETA</li>
<li><code>.pos</code>: Absolute time in [us] of the start of the waveform. For <code>RF</code>, OMEGA and THETA, <code>pos_rf_wait</code> will be added to this time to take system delays into account</li>
<li><code>.ampscale</code>: For gradient boards, this factor must be in range [-1.0,1.0] that is multiplied with the waveform to yield a per-instance (i.e. per-placement) amplitude ([G/cm]). For THETA, only values of +1.0 and -1.0 is allowed, and for OMEGA only 1.0 is allowed</li>
</ul>
<p>The <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> sequence object contains a KS_WAVEFORM (float[KS_MAXWAVELEN]) to hold the waveform. The physical unit of the waveform in the <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object depends the board on which it is placed using <a class="el" href="_k_s_foundation_8h.html#afc06ade569c7b85c1aa5026fc2e1c710" title="Places a KS_WAVE sequence object on a board at some position in the pulse sequence">ks_pg_wave()</a>. For the</p><ul>
<li>gradient boards (XGRAD, YGRAD, ZGRAD), the unit is [G/cm]</li>
<li>THETA board, the unit is [degrees]</li>
<li>RF (RHO) and OMEGA boards, the units are arbitrary (c.f. <a class="el" href="_k_s_foundation_8h.html#a187dd827bc0f2be7f9a00f20802fca91" title="Sets up a KS_RF object">ks_eval_rf()</a> and <a class="el" href="_k_s_foundation_8h.html#a3369441b24c1df15ba2193aae29d3e11" title="Sets up a KS_WAVE object based on a waveform (KS_WAVEFORM) in memory">ks_eval_wave()</a>). Don't call <a class="el" href="_k_s_foundation_8h.html#afc06ade569c7b85c1aa5026fc2e1c710" title="Places a KS_WAVE sequence object on a board at some position in the pulse sequence">ks_pg_wave()</a> directly to place a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> on the RF board</li>
</ul>
<p>When a waveform is placed on OMEGA, neither the waveform amplitude nor the <code>.ampscale</code> (in <a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a>) affects the final frequency modulation. Instead the run-time amplitude of a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object on the OMEGA board is controlled in <a class="el" href="ksepi_8e.html#a1669428052472d00b1c55a1291f8032f">scan()</a> via a function called <a class="el" href="_k_s_foundation_8h.html#a6c406ab72abe3eadd93f7e889e9afd32" title="Updates a KS_WAVE object on the OMEGA board to produce a frequency offset">ks_scan_omegawave_hz()</a>, where the largest value in the field <code>.waveform[]</code> in the <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> will correspond to the value in [Hz] provided.</p>
<p>If the <code>.duration</code> field in the <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object is 0, <a class="el" href="_k_s_foundation_8h.html#afc06ade569c7b85c1aa5026fc2e1c710" title="Places a KS_WAVE sequence object on a board at some position in the pulse sequence">ks_pg_wave()</a> will return SUCCESS and quietly ignore placing it out. This is a part of the mechanism that setting the <code>.duration</code> field to 0 in <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code> should eliminate its existance in both timing calulations and in the pulse sequence generation in <code>@pg</code></p>
<p>All <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> objects are double buffered in <a class="el" href="_k_s_foundation_8h.html#afc06ade569c7b85c1aa5026fc2e1c710" title="Places a KS_WAVE sequence object on a board at some position in the pulse sequence">ks_pg_wave()</a> so that waveforms can be replaced in run-time (<a class="el" href="ksepi_8e.html#a1669428052472d00b1c55a1291f8032f">scan()</a>) using <a class="el" href="_k_s_foundation_8h.html#a2e916337476b7566b3bf033824f964ba" title="Moves a waveform belonging to a KS_WAVE sequence object to hardware">ks_scan_wave2hardware()</a></p>
<p>Regardless of the order placed out in the <code>@pg</code> section, and on which boards (XGRAD, YGRAD, ZGRAD) the <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object is placed, the <em>instance</em> number of the <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> is automatically sorted in time. If two instances of one <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> occur at the same time (<code>.pos</code>) on different boards, XGRAD comes before YGRAD, which comes before ZGRAD. These abstract, sorted, instance numbers are used by <code>ks_scan_***()</code> functions in <a class="el" href="ksepi_8e.html#a1669428052472d00b1c55a1291f8032f">scan()</a> to refer to a specific instance of a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object in the sequence.</p>
<p>GENERAL NOTE: It is a <b>requirement</b> that the function in the <code>@pg</code> section containing all <code>ks_pg_***()</code> calls is also called exactly once in <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code> after the calls to the corresponding <code>ks_eval_***()</code> functions that design the KS_*** sequence objects. Each <code>ks_pg_***()</code> will throw an error if this has not been done.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">wave</td><td>Pointer to a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> sequence object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">loc</td><td><a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> struct to specify when and where to place the <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctrl</td><td>Pointer to the <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> struct corresponding to the sequence module for this <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;                                                                      {</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;  <span class="keywordtype">float</span> boardmax;</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;  <span class="keywordtype">char</span> boardc[7] = <span class="stringliteral">&quot;xyzrrto&quot;</span>; <span class="comment">/* x,y,z,rho1,rho2,theta,omega */</span></div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;  <span class="keywordtype">float</span> waveamp = <a class="code" href="_k_s_foundation__common_8c.html#a2bfec427bf5a8966edf279b2eba23396">ks_wave_absmax</a>(wave); <span class="comment">/* maximum amplitude in wave (in its own units, like e.g. [G/cm] or [degrees]) */</span></div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;  boardmax = <a class="code" href="_k_s_foundation__common_8c.html#aa65115d54842eeffc47a1b324caa62ab">ks_syslimits_gradtarget</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>); <span class="comment">/* returns 1.0 for non-gradients boards */</span></div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;  <span class="comment">/* checking for NULL pointers */</span></div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;  <span class="keywordflow">if</span> (wave == NULL) {</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wave: First argument is NULL&quot;</span>);</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;  }</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;  <span class="comment">/* duration of 0 should not throw an error as this is a sign of that it has not been set up</span></div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;<span class="comment">     or has manually been disabled this way */</span></div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;  <span class="keywordflow">if</span> (wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> == 0) {</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;    <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;  }</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;  <span class="keywordflow">if</span> (wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a> == NULL || wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>[0] == 0 || wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>[0] == <span class="charliteral">&#39; &#39;</span>) {</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wave: Invalid description (&#39;%s&#39;)&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;  }</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;  <span class="comment">/* TGT: Don&#39;t place anything on hardware if ctrl-&gt;duration = 0.</span></div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;<span class="comment">     This is in concert with:</span></div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;<span class="comment">     - not performing createseq() in KS_SEQLENGTH if seqctrl.duration = 0</span></div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;<span class="comment">     - not playing sequence modules in scan() using ks_scan_playsequence() if seqctrl.duration = 0</span></div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;  <span class="keywordflow">if</span> (ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> == 0) {</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s(%s): Refusing to place wave since seqctrl.duration = 0 (indicating `%s` not to be played in scan())&quot;</span>, __FUNCTION__, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;  }</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;  <span class="keywordflow">if</span> (!ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#af7f2aa8614e77ef8af0154c7e071ab0e">is_cleared_on_tgt</a>) <span class="comment">/* Reset gradrfctrl on tgt to remove dead pointers copied from host. */</span></div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;  {</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#a4ec679c0fb8eb62c1776e67434e25b77">ks_tgt_reset_gradrfctrl</a>(&amp;ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>);</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;  }</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;  <span class="comment">/* input validation */</span></div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;  <span class="keywordflow">if</span> (wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> % 4) {</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wave(%s): field &#39;duration&#39; (%d) must be divisible by 4&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>);</div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;  }</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;  <span class="keywordflow">if</span> (wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> == 0) {</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wave(%s): field &#39;res&#39; cannot be 0&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;  }</div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;  <span class="keywordflow">if</span> (wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> % 2) {</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wave(%s): field &#39;res&#39; (%d) must be even &quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>);</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;  }</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;  <span class="keywordflow">if</span> (wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> % wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>) {</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wave(%s): field &#39;duration&#39; (%d) must be divisible by &#39;res&#39; %d&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>);</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;  }</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == XGRAD || loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == YGRAD || loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == ZGRAD) {</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;    <span class="keywordflow">if</span> ((wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> / wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>) % GRAD_UPDATE_TIME) {</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wave(%s): field &#39;duration&#39; (%d) must a multiple of 4 times &#39;res&#39; (%d) for gradient boards&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>);</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;    }</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;    <span class="keywordflow">if</span> (wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a6aa33ad60a96c56283d44d989fe2d499">gradwave_units</a> == <a class="code" href="_k_s_foundation_8h.html#adfc20623c6ef26b08b99174a1a77323ca18c0e84d66e6f381b509ea483f7cc7fd">KS_GRADWAVE_ABSOLUTE</a> &amp;&amp; loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> != 1.0) {</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wave(%s): ampscale must be +1.0 for gradwave with absolute units&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;    }</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;    <span class="keywordflow">if</span> ((wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> / wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>) % RF_UPDATE_TIME) {</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wave(%s): field &#39;duration&#39; (%d) must a multiple of 2 times &#39;res&#39; (%d) for non-gradient boards&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>);</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;    }</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;  }</div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> != loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a>) {</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wave(%s): loc.ampscale NaN&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;  }</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> != loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>) {</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wave(%s): loc.pos NaN&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;  }</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> != loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>) {</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wave(%s): loc.board NaN&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;  }</div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> &lt; GRAD_UPDATE_TIME || loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> &gt; 4e6) {</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wave(%s): Invalid position %d, it must be between 4us and 4s&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>);</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;  }</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == OMEGA &amp;&amp; loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> != 1.0) {</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wave(%s): ampscale must be +1.0 for OMEGA&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;  }</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == THETA &amp;&amp; loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> != 1.0 &amp;&amp; loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> != -1.0) {</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wave(%s): ampscale must be +1.0 or -1.0 for THETA&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;  }</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> &lt; -1.0 || loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> &gt; 1.0) {</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wave(%s): Invalid ampscale %g, it must be between -1.0 and 1.0&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a>);</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;  }</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;  <span class="keywordflow">if</span> (fabs(waveamp * loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a>) &gt; boardmax &amp;&amp; loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> != THETA) {</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;    <span class="keywordflow">return</span>  <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wave(%s): wave amplitude (%.2f) exceeds maximum (%g) for board %c&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, waveamp * loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a>, boardmax, boardc[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>]);</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;  }</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;  loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> = RUP_GRD(loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>);</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;<span class="preprocessor">#ifdef HOST_TGT</span></div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;  <span class="comment">/* HOST */</span></div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;  wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a89785a274d251fd637bf40923ad5c345">locs</a>[wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>] = loc;</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;</div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;  <span class="comment">/* update instance counter on host only. This counter is used to allocate the right amount of WFINSTANCEs on IPG */</span></div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;  wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>++;</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;  <span class="comment">/* for wave, we also need to keep track of #instances per X, Y, Z for gradient heating calculations.</span></div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;<span class="comment">     As this needs to be done in HOST before the IPG (target), we can&#39;t use the wfi[...].boardinstance or .loc information above for this */</span></div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == XGRAD || loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == YGRAD || loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == ZGRAD) {</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;    wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a3fb111f1302287e152078110b3b37d6f">gradnum</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>]++;</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;  }</div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;</div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;  {</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;    <span class="keywordtype">int</span> i;</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;    <span class="keywordtype">int</span> wave_ptr, isrf, iamp;</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;    <span class="keywordtype">char</span> tmpstr[<a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> + 7];</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;    <span class="keywordflow">if</span> (wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a> &gt;= wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>) {</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;      <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wave @tgt(%s): the number of instances generated on the target exceeds the number of ones generated on the host&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;      <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;    }</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;    <span class="comment">/* first call on TGT, allocate WF_PULSE * array where each element corresponds to one board */</span></div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;    <span class="keywordflow">if</span> (wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a> == NULL) {</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;      wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a> = (WF_PULSE **) AllocNode(7 * <span class="keyword">sizeof</span>(WF_PULSE *)); <span class="comment">/* WF pointers for all boards (XGRAD-&gt;OMEGA) */</span></div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;    } <span class="comment">/* wfpulse == NULL */</span></div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;    <span class="comment">/* first call on TGT using this loc.board, make waveform memory (double buffered) */</span></div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;    <span class="keywordflow">if</span> (wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>] == NULL) {</div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;      WF_PULSE wfInit = INITPULSE;</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;      <a class="code" href="_k_s_foundation_8h.html#abba996c24da629eea72eecbd9a22a873">KS_IWAVE</a> iwave;</div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;      wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>] = (WF_PULSE *) AllocNode(<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1a6e84527e5ca18e299429a1d00297b47f">KS_WF_SIZE</a> * <span class="keyword">sizeof</span>(WF_PULSE)); <span class="comment">/* KS_WF_SIZE (3) to allow for double buffering */</span></div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;      <span class="keywordflow">for</span> (i = <a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a>; i &lt; <a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1a6e84527e5ca18e299429a1d00297b47f">KS_WF_SIZE</a>; i++)</div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;        wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>][i] = wfInit;</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;      sprintf(tmpstr, <span class="stringliteral">&quot;%s.%c&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, boardc[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>]);      pulsename(&amp;(wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>][<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a>]), tmpstr);</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;      sprintf(tmpstr, <span class="stringliteral">&quot;%s_buf1.%c&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, boardc[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>]); pulsename(&amp;(wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>][<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1acc45ff8f1dbeb7cef0129dd595e4031b">KS_WF_BUF1</a>]), tmpstr);</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;      sprintf(tmpstr, <span class="stringliteral">&quot;%s_buf2.%c&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, boardc[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>]); pulsename(&amp;(wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>][<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1a976ecf9c65bb6a43d7cb791d681f0adc">KS_WF_BUF2</a>]), tmpstr);</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;      <span class="comment">/* wave -&gt; short int wave for hardware use. All waveforms but THETA are autoscaled to +/- max_pg_wamp (32766)*/</span></div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#a9506a3d2dc5e084c69dda40e8e127a97">ks_wave2iwave</a>(iwave, wave, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>) == FAILURE)</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;        <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;      <span class="comment">/* reserve hardware memory to allow for double buffering */</span></div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;      <span class="keywordflow">for</span> (i = <a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a>; i &lt;= <a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1a976ecf9c65bb6a43d7cb791d681f0adc">KS_WF_BUF2</a>; i++) {</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;        createreserve(&amp;wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>][i], loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>);</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;        wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>][i].type = TYPEXTERNAL;</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;        movewaveimm(iwave, &amp;wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>][i], (<span class="keywordtype">int</span>) 0, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>, TOHARDWARE);</div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;      }</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;    } <span class="comment">/* wfpulse[loc.board] == NULL */</span></div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;    <span class="comment">/* create instruction at the current position */</span></div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;    isrf = loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == RHO || loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == RHO2 || loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == THETA || loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == OMEGA;</div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;</div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;    <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == THETA)</div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;      iamp = loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> * MAX_PG_IAMP;</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;      iamp = (waveamp * loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> / boardmax) * MAX_PG_IAMP;</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;    createinstr(&amp;wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>][<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a>],</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;                (<span class="keywordtype">long</span>) (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> + (<a class="code" href="_k_s_foundation__common_8c.html#a636634b6eb50758af3826332f9180e9b">psd_rf_wait</a> * isrf)),</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;                (<span class="keywordtype">long</span>) wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>,</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;                (<span class="keywordtype">long</span>) iamp);</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;    <span class="comment">/* WF instance bookkeeping */</span></div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;    <span class="keywordflow">if</span> (wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a> == NULL) {</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;      wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a> = (<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a> *) AllocNode(wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a> * <span class="keyword">sizeof</span>(<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a>));</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;    }</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;    wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">boardinstance</a> = wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>][<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a>].ninsts - 1;</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;    wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">wf</a> = wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>];</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;    wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a> = loc;</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;    <span class="comment">/* After instructions have been set, set the wfpulse[KS_WF_MAIN] to the first waveform buffer (_BUF1) */</span></div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;    getwave(&amp;wave_ptr, &amp;(wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>][<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1acc45ff8f1dbeb7cef0129dd595e4031b">KS_WF_BUF1</a>]));</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;    setwave(wave_ptr,  &amp;(wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>][<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a>]), wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">boardinstance</a>);</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;    wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>++;</div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;</div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;    <span class="comment">/* sort after the last instance is generated */</span></div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;    <span class="keywordflow">if</span> (wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a> == wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>) {</div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;      <a class="code" href="_k_s_foundation__common_8c.html#a0ae65ed3cc2deb47ccf50b7988239474">ks_sort_wfi_by_timeboard</a>(wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>);</div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;    }</div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;  }</div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* IPG or HOST */</span><span class="preprocessor"></span></div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;</div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;  <span class="comment">/* register this KS_WAVE for later heating calculations */</span></div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;  {</div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;    STATUS status = <a class="code" href="_k_s_foundation__common_8c.html#ad92221de8b8b3281d9bf0794c50a34bb">ks_eval_addwavetogradrfctrl</a>(&amp;ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>, wave);</div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;    <span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;  }</div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;</div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;} <span class="comment">/* ks_pg_wave */</span></div><div class="ttc" id="_k_s_foundation_8h_html_adfc20623c6ef26b08b99174a1a77323ca18c0e84d66e6f381b509ea483f7cc7fd"><div class="ttname"><a href="_k_s_foundation_8h.html#adfc20623c6ef26b08b99174a1a77323ca18c0e84d66e6f381b509ea483f7cc7fd">KS_GRADWAVE_ABSOLUTE</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1772</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a0ae65ed3cc2deb47ccf50b7988239474"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a0ae65ed3cc2deb47ccf50b7988239474">ks_sort_wfi_by_timeboard</a></div><div class="ttdeci">void ks_sort_wfi_by_timeboard(KS_WFINSTANCE *a, int nitems)</div><div class="ttdoc">Sort WF_INSTANCEs in time, then board</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2955</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_abba996c24da629eea72eecbd9a22a873"><div class="ttname"><a href="_k_s_foundation_8h.html#abba996c24da629eea72eecbd9a22a873">KS_IWAVE</a></div><div class="ttdeci">short KS_IWAVE[KS_MAXWAVELEN]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:180</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a42df2e3be0bda47009caae1a7042b522"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">KS_WFINSTANCE::boardinstance</a></div><div class="ttdeci">int boardinstance</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:251</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a2bfec427bf5a8966edf279b2eba23396"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a2bfec427bf5a8966edf279b2eba23396">ks_wave_absmax</a></div><div class="ttdeci">float ks_wave_absmax(const KS_WAVE *wave)</div><div class="ttdoc">Returns the maximum absolute value in a KS_WAVE sequence object</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:986</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ac91cb32048e29f6e58bbf2c1acb8fdf1acc45ff8f1dbeb7cef0129dd595e4031b"><div class="ttname"><a href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1acc45ff8f1dbeb7cef0129dd595e4031b">KS_WF_BUF1</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1754</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a1910d262855b71da353ed0d07a6c7823"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">KS_SEQLOC::pos</a></div><div class="ttdeci">int pos</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:242</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a89785a274d251fd637bf40923ad5c345"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a89785a274d251fd637bf40923ad5c345">KS_WAVE::locs</a></div><div class="ttdeci">KS_SEQLOC locs[KS_MAXINSTANCES]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:522</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a></div><div class="ttdoc">(Internal use) Structure being a part of various sequence objects to sort them in time across boards...</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:250</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a72a22b96ff3908d2b9a20a3a02647a2f"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">KS_BASE::ninst</a></div><div class="ttdeci">int ninst</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:261</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a6aa33ad60a96c56283d44d989fe2d499"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a6aa33ad60a96c56283d44d989fe2d499">KS_WAVE::gradwave_units</a></div><div class="ttdeci">int gradwave_units</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:521</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a2e3f5254967cadb9a41167c6fbf6743e"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">KS_SEQLOC::board</a></div><div class="ttdeci">int board</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:241</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_SEQ_CONTROL::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:984</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a606fbf556e8a297aa1f68b098f6ac2a2"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">KS_SEQLOC::ampscale</a></div><div class="ttdeci">float ampscale</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:243</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a2573e18f36ab5c3d3fc97072edcfab16"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">KS_SEQ_CONTROL::gradrf</a></div><div class="ttdeci">KS_GRADRFCTRL gradrf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:992</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a15be3edad342a49398ca841c2745dc9e"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">KS_WAVE::wfi</a></div><div class="ttdeci">KS_WFINSTANCE * wfi</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:524</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aacb2fe1d83c45e8d0525f363bdd6b8a6"><div class="ttname"><a href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a></div><div class="ttdeci">#define KS_DESCRIPTION_LENGTH</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:112</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a3fb111f1302287e152078110b3b37d6f"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a3fb111f1302287e152078110b3b37d6f">KS_WAVE::gradnum</a></div><div class="ttdeci">int gradnum[3]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:520</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a78e529e1d86855310035845e03a4c107"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">KS_WFINSTANCE::loc</a></div><div class="ttdeci">KS_SEQLOC loc</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:253</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">KS_WAVE::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:516</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_af7f2aa8614e77ef8af0154c7e071ab0e"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#af7f2aa8614e77ef8af0154c7e071ab0e">KS_GRADRFCTRL::is_cleared_on_tgt</a></div><div class="ttdeci">int is_cleared_on_tgt</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:823</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_ad92221de8b8b3281d9bf0794c50a34bb"><div class="ttname"><a href="_k_s_foundation__common_8c.html#ad92221de8b8b3281d9bf0794c50a34bb">ks_eval_addwavetogradrfctrl</a></div><div class="ttdeci">STATUS ks_eval_addwavetogradrfctrl(KS_GRADRFCTRL *gradrfctrl, KS_WAVE *wave)</div><div class="ttdoc">*Internal use*. Adds a wave (KS_WAVE) - if it is not a part of a KS_RF object - to the KS_GRADRFCTRL ...</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:3462</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a9428be182c75f60d1b4e6fe36c888afa"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">KS_WAVE::wfpulse</a></div><div class="ttdeci">WF_PULSE ** wfpulse</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:523</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_aa65115d54842eeffc47a1b324caa62ab"><div class="ttname"><a href="_k_s_foundation__common_8c.html#aa65115d54842eeffc47a1b324caa62ab">ks_syslimits_gradtarget</a></div><div class="ttdeci">float ks_syslimits_gradtarget(LOG_GRAD loggrd, WF_PROCESSOR board)</div><div class="ttdoc">Returns the maximum target amplitude for a board (internal use)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:176</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">KS_WAVE::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:515</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a558b0ff480e8db364962bd0f203d6958"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">KS_WFINSTANCE::wf</a></div><div class="ttdeci">WF_PULSE * wf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:252</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32"><div class="ttname"><a href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1754</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4ec679c0fb8eb62c1776e67434e25b77"><div class="ttname"><a href="_k_s_foundation_8h.html#a4ec679c0fb8eb62c1776e67434e25b77">ks_tgt_reset_gradrfctrl</a></div><div class="ttdeci">void ks_tgt_reset_gradrfctrl(KS_GRADRFCTRL *gradrfctrl)</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1402</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a9506a3d2dc5e084c69dda40e8e127a97"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a9506a3d2dc5e084c69dda40e8e127a97">ks_wave2iwave</a></div><div class="ttdeci">STATUS ks_wave2iwave(KS_IWAVE iwave, const KS_WAVE *wave, int board)</div><div class="ttdoc">(Internal use) Conversion of waveform content in a KS_WAVE sequence object to a short int array for u...</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1177</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">KS_SEQ_CONTROL::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:990</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a636634b6eb50758af3826332f9180e9b"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a636634b6eb50758af3826332f9180e9b">psd_rf_wait</a></div><div class="ttdeci">int psd_rf_wait</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ac91cb32048e29f6e58bbf2c1acb8fdf1a6e84527e5ca18e299429a1d00297b47f"><div class="ttname"><a href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1a6e84527e5ca18e299429a1d00297b47f">KS_WF_SIZE</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1754</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_WAVE::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:518</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ac91cb32048e29f6e58bbf2c1acb8fdf1a976ecf9c65bb6a43d7cb791d681f0adc"><div class="ttname"><a href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1a976ecf9c65bb6a43d7cb791d681f0adc">KS_WF_BUF2</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1754</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a853cff23395e570cc88aa3405b78c3a9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a853cff23395e570cc88aa3405b78c3a9">&#9670;&nbsp;</a></span>ks_pg_rf()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_pg_rf </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_f.html">KS_RF</a> *&#160;</td>
          <td class="paramname"><em>rf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a>&#160;</td>
          <td class="paramname"><em>loc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>ctrl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Places a <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> sequence object on a board at some position in the pulse sequence</h4>
</p>
<p>This function should be called in the <code>@pg</code> section to place out a <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> sequence object that creates an RF pulse in the pulse sequence. The same <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object can be placed out as many times as desired, by only changing the second argument each time (to avoid waveform overlaps). The second argument is a <a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> struct with three fields:</p><ul>
<li><code>.board</code>: <em>Ignored</em>. <code>.rfwave</code> will always be placed on RHO. If the resolution of <code>.omegawave</code> is non-zero it will be placed on OMEGA, and correspondingly for <code>.thetawave</code> on THETA</li>
<li><code>.pos</code>: Absolute time in [us] of the start of the waveform</li>
<li><code>.ampscale</code>: A factor that must be in range [-1.0,1.0] that is multiplied with <code>.amp</code> to yield a per-instance (i.e. per-placement) amplitude. For <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> objects this will cause the flip angle to be reduced on a per-instance basis. This can be used to generate a variable flip-angle train of RF pulses using a single <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object. An <code>.ampscale</code> of -1.0 is equivalent to adding a 180 degree RF phase shift to the RF pulse</li>
</ul>
<p>If the <code>rfwave.duration</code> field in the <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object is 0, <a class="el" href="_k_s_foundation_8h.html#a853cff23395e570cc88aa3405b78c3a9" title="Places a KS_RF sequence object on a board at some position in the pulse sequence">ks_pg_rf()</a> will return SUCCESS and quietly ignore placing it out. This is a part of the mechanism that setting the <code>.duration</code> field to 0 in <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code> should eliminate its existance in both timing calulations and in the pulse sequence generation in <code>@pg</code></p>
<p>As <a class="el" href="_k_s_foundation_8h.html#a853cff23395e570cc88aa3405b78c3a9" title="Places a KS_RF sequence object on a board at some position in the pulse sequence">ks_pg_rf()</a> internally calls <a class="el" href="_k_s_foundation_8h.html#afc06ade569c7b85c1aa5026fc2e1c710" title="Places a KS_WAVE sequence object on a board at some position in the pulse sequence">ks_pg_wave()</a> for its KS_WAVEs, double buffering will be used for all hardware waveforms, allowing waveforms to be replaced in run-time (<a class="el" href="ksepi_8e.html#a1669428052472d00b1c55a1291f8032f">scan()</a>) using <a class="el" href="_k_s_foundation_8h.html#a2e916337476b7566b3bf033824f964ba" title="Moves a waveform belonging to a KS_WAVE sequence object to hardware">ks_scan_wave2hardware()</a></p>
<p>Regardless of the order placed out in the <code>@pg</code> section the <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object is placed, the <em>instance</em> number of the <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> is automatically sorted in time. These abstract, sorted, instance numbers are used by <code>ks_scan_***()</code> functions in <a class="el" href="ksepi_8e.html#a1669428052472d00b1c55a1291f8032f">scan()</a> to refer to a specific instance of a <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object in the sequence.</p>
<p>GENERAL NOTE: It is a <b>requirement</b> that the function in the <code>@pg</code> section containing all <code>ks_pg_***()</code> calls is also called exactly once in <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code> after the calls to the corresponding <code>ks_eval_***()</code> functions that design the KS_*** sequence objects. Each <code>ks_pg_***()</code> will throw an error if this has not been done.</p>
<p>When <a class="el" href="_k_s_foundation_8h.html#a853cff23395e570cc88aa3405b78c3a9" title="Places a KS_RF sequence object on a board at some position in the pulse sequence">ks_pg_rf()</a> is run in <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code> (on HOST), the field <code>.rfpulse.activity</code> that was first set to 0 by <a class="el" href="_k_s_foundation_8h.html#a187dd827bc0f2be7f9a00f20802fca91" title="Sets up a KS_RF object">ks_eval_rf()</a> is now set to <code>PSD_APS2_ON + PSD_MPS2_ON + PSD_SCAN_ON</code> by <a class="el" href="_k_s_foundation_8h.html#a853cff23395e570cc88aa3405b78c3a9" title="Places a KS_RF sequence object on a board at some position in the pulse sequence">ks_pg_rf()</a>. This triggers the RF functions used in <a class="el" href="_k_s_foundation_8h.html#ab4c6e9f82b55a3db56765fc22f21b7b5" title="Returns the time required to play out a certain number of sequence modules over some interval...">ks_eval_gradrflimits()</a> to include this <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object in RF scaling and SAR calculations. Each time <a class="el" href="_k_s_foundation_8h.html#a853cff23395e570cc88aa3405b78c3a9" title="Places a KS_RF sequence object on a board at some position in the pulse sequence">ks_pg_rf()</a> is called, the field <code>.rfpulse.num</code> is incremented after being first set to 0 by <a class="el" href="_k_s_foundation_8h.html#a187dd827bc0f2be7f9a00f20802fca91" title="Sets up a KS_RF object">ks_eval_rf()</a>. Hence, it is crucial that the <em>sequence generating</em> function (c.f. <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a>) containing all <code>ks_pg_***()</code> calls is executed between the <a class="el" href="_k_s_foundation_8h.html#a187dd827bc0f2be7f9a00f20802fca91" title="Sets up a KS_RF object">ks_eval_rf()</a> setup call and the call to <a class="el" href="_k_s_foundation_8h.html#ab4c6e9f82b55a3db56765fc22f21b7b5" title="Returns the time required to play out a certain number of sequence modules over some interval...">ks_eval_gradrflimits()</a></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">rf</td><td>Pointer to a <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> sequence object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">loc</td><td><a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> struct to specify when to place the <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctrl</td><td>Pointer to the <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> struct corresponding to the sequence module for this <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;                                                                {</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;  <span class="comment">/* input validation */</span></div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;  <span class="keywordflow">if</span> (rf == NULL) {</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: First argument is NULL&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;  }</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;</div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;  <span class="comment">/* duration of 0 should not throw an error as this is a sign of that it has not been set up</span></div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;<span class="comment">     or has manually been disabled this way */</span></div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;  <span class="keywordflow">if</span> (rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> == 0) {</div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;    <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;  }</div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;  <span class="keywordflow">if</span> (rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a> == NULL || rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>[0] == 0 || rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>[0] == <span class="charliteral">&#39; &#39;</span>) {</div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_rf: Invalid description (&#39;%s&#39;)&quot;</span>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;  }</div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;</div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;  <span class="comment">/* TGT: Don&#39;t place anything on hardware if ctrl-&gt;duration = 0.</span></div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;<span class="comment">     This is in concert with:</span></div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;<span class="comment">     - not performing createseq() in KS_SEQLENGTH if seqctrl.duration = 0</span></div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;<span class="comment">     - not playing sequence modules in scan() using ks_scan_playsequence() if seqctrl.duration = 0</span></div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;  <span class="keywordflow">if</span> (ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> == 0) {</div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s(%s): Refusing to place RF since seqctrl.duration = 0 (indicating `%s` not to be played in scan())&quot;</span>, __FUNCTION__, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;  }</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;  <span class="comment">/* TGT: make sure (the RF pulses in) the sequence module were a part of the seqcollection when GEReq_eval_rfscaling() was called */</span></div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;  <span class="keywordflow">if</span> (ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a729d02cb24cec9beeaf9a22ac9390754">rfscalingdone</a> == FALSE &amp;&amp; ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> &gt; 0) {</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s(%s): Missing RF scaling for sequence module with non-zero duration. Add `%s` to seqcollection *before* calling GEReq_eval_rfscaling(seqcollection)&quot;</span>, __FUNCTION__, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;  }</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;  <span class="keywordflow">if</span> (!ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#af7f2aa8614e77ef8af0154c7e071ab0e">is_cleared_on_tgt</a>) <span class="comment">/* Reset gradrfctrl on tgt to remove dead pointers copied from host. */</span></div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;  {</div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#a4ec679c0fb8eb62c1776e67434e25b77">ks_tgt_reset_gradrfctrl</a>(&amp;ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>);</div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;  }</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;  loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> = RUP_RF(loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>);</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;  RFEnvelopeWaveformGeneratorCheck(rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, <a class="code" href="_k_s_foundation__common_8c.html#a4dcd93b4f67aeb25541105ec7953c67e">ks_rhoboard</a>);</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;</div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;  <span class="keywordflow">if</span> (rf-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>) {</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;    <span class="keywordflow">if</span> (rf-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> != rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>) {</div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;      <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_rf (%s): The duration of the omega waveform must be equal to the RF duration&quot;</span>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;      <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;    }</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;  }</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;  <span class="keywordflow">if</span> (rf-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>) {</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;    <span class="keywordflow">if</span> (rf-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> != rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>) {</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;      <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_rf (%s): The duration of the theta waveform must be equal to the RF duration&quot;</span>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;      <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;    }</div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;  }</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;</div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;  <span class="comment">/* Set ctrl-&gt;momentstart if this is an excitation pulse */</span></div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;  <span class="keywordflow">if</span> (rf-&gt;<a class="code" href="struct_k_s___r_f.html#aea7921a9aa2757a88e843476848ddd55">role</a> == <a class="code" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedacc16dd3ca09dedaf6334a39ee4e46241">KS_RF_ROLE_EXC</a>) {</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;    ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ab9bf2aebde69b811853b4febc57ff5f8">momentstart</a> = RUP_GRD(loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> + rf-&gt;<a class="code" href="struct_k_s___r_f.html#af9bc4afb4579b2bf18259e70175090a3">start2iso</a>); <span class="comment">/* RUP_GRD: make sure it is on a 4us raster too for gradient timing calcs */</span></div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;  }</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;  <span class="comment">/* register this KS_RF for later heating calculations - and do this *before* calls to ks_pg_wave() below (in this function) to avoid double registrations (c.f. ks_eval_addwavetogradrfctrl()).</span></div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;<span class="comment">     N.B.: While RF/sar calcs (ks_eval_rfscaling()) are not affected by this, registering the rf-&gt;rfwave both as a part of the RF object and as a separate wave in ctrl-&gt;gradrf would otherwise lead to problems for</span></div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;<span class="comment">     ks_gnuplot_seqmodule(). This would cause the RF pulse to show up twice in the plot / pdf / image.</span></div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;<span class="comment">     ks_eval_addwavetogradrfctrl() is called in ks_pg_wave() and checks if this wave also belongs to a parent registered RF pulse in which case the wave will not be registered again */</span></div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;  {</div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;    STATUS status = <a class="code" href="_k_s_foundation__common_8c.html#a75283b5758c55ab4d0530fb9f05b22fd">ks_eval_addrftogradrfctrl</a>(&amp;ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>, rf);</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;    <span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;  }</div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;<span class="preprocessor">#ifdef HOST_TGT</span></div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;</div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;  <span class="comment">/* update rfpulse.num counter on host only. We can use this ninst variable as info</span></div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;<span class="comment">     for RF heating calculations */</span></div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.num++;</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;  <span class="comment">/* now that we have shown that we are really going to use this pulse, set its</span></div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;<span class="comment">     activity flag to SCAN, APS2, MPS2 */</span></div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.activity = PSD_APS2_ON + PSD_MPS2_ON + PSD_SCAN_ON;</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;  <span class="keywordflow">if</span> (rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.num == 0) {</div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_rf @tgt(%s): pulsegen was never run on HOST (rf-&gt;rfpulse.num = 0)&quot;</span>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;  }</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;  <span class="keywordflow">if</span> (rf-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.activity == 0) {</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_rf @tgt(%s): RF pulse with zero activity&quot;</span>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;  }</div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;</div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;  <span class="comment">/* The values in rf-&gt;rfwave.waveform[] are relative (unit-less). The actual amplitude of the RF wave</span></div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;<span class="comment">     is only controlled by rf-&gt;amp (which in turn is set by GE&#39;s setScale() and indirectly by peakB1()).</span></div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;<span class="comment">     Prepare RF waveform with correct amplitude on TGT side that can be used with ks_pg_wave() to give the right</span></div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;<span class="comment">     RF amplitude, after we have done RF scaling on HOST and hence have a final value for rf-&gt;amp.</span></div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;<span class="comment">     The units of this RF waveform, before and after calling ks_wave_multiplywal(), are relative (not [G])</span></div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;<span class="comment">     due to GE&#39;s RF scaling process involving e.g. xmtaddScan.</span></div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;<span class="comment">     Look in GERequired.e:GEReq_eval_gradrflimits() for more info on how peakB1() and setScale() are used. */</span></div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#a23b3d305df1e2ad0563f8a2fea2330df">ks_wave_multiplyval</a>(&amp;rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#ab508ded41392ee86a2a619d3e93d2373">amp</a> / <a class="code" href="_k_s_foundation__common_8c.html#a2bfec427bf5a8966edf279b2eba23396">ks_wave_absmax</a>(&amp;rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>));</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;</div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;  <span class="comment">/* place the RF wave */</span></div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;  loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> = RHO;</div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#a9c5ace140d91043230e2e5364a0be90b">ks_pg_wave</a>(&amp;rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>, loc, ctrl) == FAILURE)</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;  <span class="comment">/* add SSP RF bits that handles the frequency control and blanking/unblanking the receiver */</span></div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;  addrfbits(&amp;rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[RHO][<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a>], 0, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> + <a class="code" href="_k_s_foundation__common_8c.html#a636634b6eb50758af3826332f9180e9b">psd_rf_wait</a>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>);</div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;  <span class="comment">/* set RF frequency offset */</span></div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;  setfrequency(rf-&gt;<a class="code" href="struct_k_s___r_f.html#add1e81760153252b7f921b8f9118edb2">cf_offset</a> / TARDIS_FREQ_RES, &amp;rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[RHO][<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a>], INSTRALL);</div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;  <span class="comment">/* set ampscale to 1. If you want to scale the omega or theata board, do it seperatly */</span></div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;  loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> = 1;</div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;</div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;  <span class="comment">/* place the OMEGA wave */</span></div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;  loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> = OMEGA;</div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;  <span class="keywordflow">if</span> (rf-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>) {</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#a9c5ace140d91043230e2e5364a0be90b">ks_pg_wave</a>(&amp;rf-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>, loc, ctrl) == FAILURE)</div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;      <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;  }</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;  <span class="keywordflow">if</span> (rf-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>) {</div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;    <span class="comment">/* add SSP RF bits that handles the frequency control and blanking/unblanking the receiver */</span></div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;    addrfbits(&amp;rf-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[OMEGA][<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a>], 0, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> + <a class="code" href="_k_s_foundation__common_8c.html#a636634b6eb50758af3826332f9180e9b">psd_rf_wait</a>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>);</div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;  }</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;  <span class="comment">/* place the THETA wave */</span></div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;  loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> = THETA;</div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;  <span class="keywordflow">if</span> (rf-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>) {</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#a9c5ace140d91043230e2e5364a0be90b">ks_pg_wave</a>(&amp;rf-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>, loc, ctrl) == FAILURE)</div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;      <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;  }</div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;</div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;  <span class="keywordflow">if</span> (rf-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>) {</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;    <span class="comment">/* add SSP RF bits that handles the frequency control and blanking/unblanking the receiver */</span></div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;    addrfbits(&amp;rf-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[THETA][<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a>], 0, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> + <a class="code" href="_k_s_foundation__common_8c.html#a636634b6eb50758af3826332f9180e9b">psd_rf_wait</a>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>);</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;  }</div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;</div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;</div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;} <span class="comment">/* ks_pg_rf */</span></div><div class="ttc" id="_k_s_foundation__common_8c_html_a9c5ace140d91043230e2e5364a0be90b"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a9c5ace140d91043230e2e5364a0be90b">ks_pg_wave</a></div><div class="ttdeci">STATUS ks_pg_wave(KS_WAVE *wave, KS_SEQLOC loc, KS_SEQ_CONTROL *ctrl)</div><div class="ttdoc">Places a KS_WAVE sequence object on a board at some position in the pulse sequence</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1593</div></div>
<div class="ttc" id="struct_k_s___r_f_html_add1e81760153252b7f921b8f9118edb2"><div class="ttname"><a href="struct_k_s___r_f.html#add1e81760153252b7f921b8f9118edb2">KS_RF::cf_offset</a></div><div class="ttdeci">float cf_offset</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:791</div></div>
<div class="ttc" id="struct_k_s___r_f_html_af9bc4afb4579b2bf18259e70175090a3"><div class="ttname"><a href="struct_k_s___r_f.html#af9bc4afb4579b2bf18259e70175090a3">KS_RF::start2iso</a></div><div class="ttdeci">int start2iso</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:793</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a2bfec427bf5a8966edf279b2eba23396"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a2bfec427bf5a8966edf279b2eba23396">ks_wave_absmax</a></div><div class="ttdeci">float ks_wave_absmax(const KS_WAVE *wave)</div><div class="ttdoc">Returns the maximum absolute value in a KS_WAVE sequence object</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:986</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a1910d262855b71da353ed0d07a6c7823"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">KS_SEQLOC::pos</a></div><div class="ttdeci">int pos</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:242</div></div>
<div class="ttc" id="struct_k_s___r_f_html_aea7921a9aa2757a88e843476848ddd55"><div class="ttname"><a href="struct_k_s___r_f.html#aea7921a9aa2757a88e843476848ddd55">KS_RF::role</a></div><div class="ttdeci">int role</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:788</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a4dcd93b4f67aeb25541105ec7953c67e"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a4dcd93b4f67aeb25541105ec7953c67e">ks_rhoboard</a></div><div class="ttdeci">int ks_rhoboard</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:46</div></div>
<div class="ttc" id="struct_k_s___r_f_html_ae183c3e4095d1c6d14b3d59a0da97928"><div class="ttname"><a href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">KS_RF::rfpulse</a></div><div class="ttdeci">RF_PULSE rfpulse</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:797</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a729d02cb24cec9beeaf9a22ac9390754"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a729d02cb24cec9beeaf9a22ac9390754">KS_SEQ_CONTROL::rfscalingdone</a></div><div class="ttdeci">int rfscalingdone</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:988</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_ab9bf2aebde69b811853b4febc57ff5f8"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ab9bf2aebde69b811853b4febc57ff5f8">KS_SEQ_CONTROL::momentstart</a></div><div class="ttdeci">int momentstart</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:985</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a2e3f5254967cadb9a41167c6fbf6743e"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">KS_SEQLOC::board</a></div><div class="ttdeci">int board</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:241</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_SEQ_CONTROL::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:984</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aa324c3517656b8ec032523397a142bedacc16dd3ca09dedaf6334a39ee4e46241"><div class="ttname"><a href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedacc16dd3ca09dedaf6334a39ee4e46241">KS_RF_ROLE_EXC</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1750</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a606fbf556e8a297aa1f68b098f6ac2a2"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">KS_SEQLOC::ampscale</a></div><div class="ttdeci">float ampscale</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:243</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a2573e18f36ab5c3d3fc97072edcfab16"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">KS_SEQ_CONTROL::gradrf</a></div><div class="ttdeci">KS_GRADRFCTRL gradrf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:992</div></div>
<div class="ttc" id="struct_k_s___r_f_html_aecd8b68c159a31a28e2a2ec003b593e2"><div class="ttname"><a href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">KS_RF::thetawave</a></div><div class="ttdeci">KS_WAVE thetawave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:800</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">KS_WAVE::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:516</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_af7f2aa8614e77ef8af0154c7e071ab0e"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#af7f2aa8614e77ef8af0154c7e071ab0e">KS_GRADRFCTRL::is_cleared_on_tgt</a></div><div class="ttdeci">int is_cleared_on_tgt</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:823</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a9428be182c75f60d1b4e6fe36c888afa"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">KS_WAVE::wfpulse</a></div><div class="ttdeci">WF_PULSE ** wfpulse</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:523</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a2a9b610a78cdae3ac8ef682bd34f7e0d"><div class="ttname"><a href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">KS_RF::rfwave</a></div><div class="ttdeci">KS_WAVE rfwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:798</div></div>
<div class="ttc" id="struct_k_s___r_f_html_ab508ded41392ee86a2a619d3e93d2373"><div class="ttname"><a href="struct_k_s___r_f.html#ab508ded41392ee86a2a619d3e93d2373">KS_RF::amp</a></div><div class="ttdeci">float amp</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:792</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32"><div class="ttname"><a href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1754</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4ec679c0fb8eb62c1776e67434e25b77"><div class="ttname"><a href="_k_s_foundation_8h.html#a4ec679c0fb8eb62c1776e67434e25b77">ks_tgt_reset_gradrfctrl</a></div><div class="ttdeci">void ks_tgt_reset_gradrfctrl(KS_GRADRFCTRL *gradrfctrl)</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1402</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a75283b5758c55ab4d0530fb9f05b22fd"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a75283b5758c55ab4d0530fb9f05b22fd">ks_eval_addrftogradrfctrl</a></div><div class="ttdeci">STATUS ks_eval_addrftogradrfctrl(KS_GRADRFCTRL *gradrfctrl, KS_RF *rf)</div><div class="ttdoc">*Internal use*. Adds an RF pulse to the KS_GRADRFCTRL struct for later SAR &amp; RF power calculations in...</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:3496</div></div>
<div class="ttc" id="struct_k_s___r_f_html_aa283d0a503cfda1c25da9f9b9a0d8b1c"><div class="ttname"><a href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">KS_RF::omegawave</a></div><div class="ttdeci">KS_WAVE omegawave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:799</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">KS_SEQ_CONTROL::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:990</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a23b3d305df1e2ad0563f8a2fea2330df"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a23b3d305df1e2ad0563f8a2fea2330df">ks_wave_multiplyval</a></div><div class="ttdeci">void ks_wave_multiplyval(KS_WAVE *wave, float val)</div><div class="ttdoc">In-place scalar multiplication of a KS_WAVE</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1135</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a636634b6eb50758af3826332f9180e9b"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a636634b6eb50758af3826332f9180e9b">psd_rf_wait</a></div><div class="ttdeci">int psd_rf_wait</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_WAVE::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:518</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6e727c3449c63278cbfc2e35cfcfa9fa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6e727c3449c63278cbfc2e35cfcfa9fa">&#9670;&nbsp;</a></span>ks_pg_selrf()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_pg_selrf </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *&#160;</td>
          <td class="paramname"><em>selrf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a>&#160;</td>
          <td class="paramname"><em>loc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>ctrl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Places a <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> sequence object on a gradient (and RF) board at some position in the pulse sequence</h4>
</p>
<p>This function should be called in the <code>@pg</code> section to place out a <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> sequence object that creates an RF pulse with associated trapezoids in the pulse sequence. The same <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> object can be placed out as many times as desired, by only changing the second argument each time (to avoid waveform overlaps). The second argument is a <a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> struct with three fields:</p><ul>
<li><code>.board</code>: Choose between XGRAD, YGRAD, ZGRAD for the board on which <code>.pregrad</code>, <code>.grad</code> (or <code>.gradwave</code>) and <code>.postgrad</code> should be placed</li>
<li><code>.pos</code>: Absolute time in [us] of the start of the <code>.pregrad</code> attack ramp. If <code>.pregrad</code> has zero duration, <code>.pos</code> will in effect refer to the start of the <code>.grad</code> attack ramp</li>
<li><code>.ampscale</code>: A factor that must be in range [-1.0,1.0] that is multiplied with <code>rf.rfwave.amp</code> to yield a per-instance (i.e. per-placement) amplitude. For <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> objects the <code>.ampscale</code> value will be passed on its internal call to <a class="el" href="_k_s_foundation_8h.html#a853cff23395e570cc88aa3405b78c3a9" title="Places a KS_RF sequence object on a board at some position in the pulse sequence">ks_pg_rf()</a>, but not to its internal <a class="el" href="_k_s_foundation_8h.html#a61651c54c4dfd4388fc939d804a9964b" title="Places a KS_TRAP sequence object on a board at some position in the pulse sequence">ks_pg_trap()</a> calls. Hence <code>.ampscale</code> will have the same effect for <a class="el" href="_k_s_foundation_8h.html#a6e727c3449c63278cbfc2e35cfcfa9fa" title="Places a KS_SELRF sequence object on a gradient (and RF) board at some position in the pulse sequence...">ks_pg_selrf()</a> as for <a class="el" href="_k_s_foundation_8h.html#a853cff23395e570cc88aa3405b78c3a9" title="Places a KS_RF sequence object on a board at some position in the pulse sequence">ks_pg_rf()</a>, with no per-instance control of the amplitude of the gradients involved. A reduced <code>.ampscale</code> will cause the flip angle to be reduced on a per-instance basis. This can be used to generate a variable flip-angle train of selective RF pulses using a single <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> object. An <code>.ampscale</code> of -1.0 is equivalent to adding a 180 degree RF phase shift to the RF pulse</li>
</ul>
<p>If the <code>.gradwave</code> field has a non-zero resolution, <a class="el" href="_k_s_foundation_8h.html#a6e727c3449c63278cbfc2e35cfcfa9fa" title="Places a KS_SELRF sequence object on a gradient (and RF) board at some position in the pulse sequence...">ks_pg_selrf()</a> will place out the <code>.gradwave</code> (<a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a>) instead of the <code>.grad</code> (<a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a>) during the time the RF pulse is played out. An error is thrown if <code>.gradwave.duration</code> (if <code>.gradwave.res</code> &gt; 0) is not equal to the <code>.rf.rfwave.duration</code>. If <code>.pregrad</code> or <code>.postgrad</code> has zero duration, they will not be placed out. The <em>existance</em> of non-zero <code>.pregrad</code> and <code>.postgrad</code> is determined by <a class="el" href="_k_s_foundation_8h.html#ad77a28d39f423bca930ee2f8f392de17" title="Sets up a KS_SELRF object for RF slice selection with preset gradient constraints">ks_eval_selrf()</a> based on <code>.rf.role</code></p>
<p>As <a class="el" href="_k_s_foundation_8h.html#a6e727c3449c63278cbfc2e35cfcfa9fa" title="Places a KS_SELRF sequence object on a gradient (and RF) board at some position in the pulse sequence...">ks_pg_selrf()</a> internally calls <a class="el" href="_k_s_foundation_8h.html#afc06ade569c7b85c1aa5026fc2e1c710" title="Places a KS_WAVE sequence object on a board at some position in the pulse sequence">ks_pg_wave()</a> for its KS_WAVEs, hardware double buffering will be used for all waveforms, allowing waveforms to be replaced in run-time (<a class="el" href="ksepi_8e.html#a1669428052472d00b1c55a1291f8032f">scan()</a>) using <a class="el" href="_k_s_foundation_8h.html#a2e916337476b7566b3bf033824f964ba" title="Moves a waveform belonging to a KS_WAVE sequence object to hardware">ks_scan_wave2hardware()</a></p>
<p>Regardless of the order placed out in the <code>@pg</code> section the <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> object is placed, the <em>instance</em> number of the <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> is automatically sorted in time. These abstract, sorted, instance numbers are used by <code>ks_scan_***()</code> functions in <a class="el" href="ksepi_8e.html#a1669428052472d00b1c55a1291f8032f">scan()</a> to refer to a specific instance of a <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> object in the sequence.</p>
<p>GENERAL NOTE: It is a <b>requirement</b> that the function in the <code>@pg</code> section containing all <code>ks_pg_***()</code> calls is also called exactly once in <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code> after the calls to the corresponding <code>ks_eval_***()</code> functions that design the KS_*** sequence objects. Each <code>ks_pg_***()</code> will throw an error if this has not been done.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">selrf</td><td>Pointer to a <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> sequence object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">loc</td><td><a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> struct to specify when and where to place the <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctrl</td><td>Pointer to the <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> struct corresponding to the sequence module for this <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;                                                                         {</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;  <a class="code" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> rfloc;</div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;  <a class="code" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> gradloc;</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;  <span class="keywordtype">float</span> gradmax;</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;</div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> != XGRAD &amp;&amp; loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> != YGRAD &amp;&amp; loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> != ZGRAD) {</div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s(%s): loc.board (2nd arg) must be a gradient board&quot;</span>, __FUNCTION__, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;  }</div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;  <span class="comment">/* gradient max on current logical board */</span></div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;  gradmax = <a class="code" href="_k_s_foundation__common_8c.html#aa65115d54842eeffc47a1b324caa62ab">ks_syslimits_gradtarget</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>);</div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;</div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;  <span class="comment">/* loc.ampscale should only affect the RF amp, not the gradients */</span></div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;  gradloc = loc; gradloc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> = 1.0;</div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;  rfloc = loc; rfloc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> = RHO;</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;  <span class="comment">/* RF starts after the preselgrad (if present) */</span></div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;  rfloc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> += selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a35145c98c931f54a8bf2b97edfb3e4c6">pregrad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>;</div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;  <span class="comment">/* delay the RF pulse start by the ramptime of the slice sel gradient</span></div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;<span class="comment">     when .gradwave is used, .grad.ramptime will be correctly zero  */</span></div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;  rfloc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> += selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a>;</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;</div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;  <span class="comment">/************* generate the RF (incl. optional THETA &amp; OMEGA) *************/</span></div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;</div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#acc74b390428f6607e8c540f6b4182407">ks_pg_rf</a>(&amp;selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>, rfloc, ctrl) == FAILURE)</div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;</div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;  <span class="comment">/************************ place gradients *********************************/</span></div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;  <span class="comment">/* Pre-slice sel gradient. Roles: e.g. left crusher or dephasing gradient in bSSFP */</span></div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#ab3341eea000c35a438dfeb3cfc1da103">ks_pg_trap</a>(&amp;selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a35145c98c931f54a8bf2b97edfb3e4c6">pregrad</a>, gradloc, ctrl) == FAILURE)</div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;  gradloc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> += selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a35145c98c931f54a8bf2b97edfb3e4c6">pregrad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>;</div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;</div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;</div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;</div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;  <span class="comment">/* slice select gradient */</span></div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;  <span class="keywordflow">if</span> (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>) {</div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;    <span class="comment">/* use gradwave (not trapezoid) */</span></div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;</div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;    <span class="keywordflow">if</span> (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> != (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>) || (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> * GRAD_UPDATE_TIME != selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>)) {</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s(%s): The duration of &#39;gradwave&#39; (%d [us]) must equal the RF duration (%d [us])&quot;</span>, __FUNCTION__,</div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;                      selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>);</div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;    }</div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;</div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#a9c5ace140d91043230e2e5364a0be90b">ks_pg_wave</a>(&amp;selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>, gradloc, ctrl) == FAILURE)</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;      <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;</div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;    gradloc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> += selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>;</div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;</div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;    <span class="comment">/* use trapezoid (not gradwave) */</span></div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;    <span class="keywordflow">if</span> (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">plateautime</a> != selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>) {</div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s(%s): Plateau time of slice select (%d) != RF duration (%d)&quot;</span>, __FUNCTION__, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">plateautime</a>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>);</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#ab3341eea000c35a438dfeb3cfc1da103">ks_pg_trap</a>(&amp;selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#af33317a98ade78e3ac252b33cbb794af">grad</a>, gradloc, ctrl) == FAILURE)</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;        <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;</div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;      gradloc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> += selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>;</div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;    }</div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;</div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;  } <span class="comment">/* slice select */</span></div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;</div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;  <span class="comment">/* post-slice sel gradient. Roles: e.g. right crusher or refocusing gradient */</span></div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#ab3341eea000c35a438dfeb3cfc1da103">ks_pg_trap</a>(&amp;selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a5ac7ed86029ab647ba0c9a656ae9fb37">postgrad</a>, gradloc, ctrl) == FAILURE)</div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;  gradloc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> += selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a5ac7ed86029ab647ba0c9a656ae9fb37">postgrad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>;</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;</div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;} <span class="comment">/* ks_pg_selrf */</span></div><div class="ttc" id="struct_k_s___t_r_a_p_html_a878bb367b07dc7dfb5fef5728d2e5b1d"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">KS_TRAP::plateautime</a></div><div class="ttdeci">int plateautime</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:436</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#af33317a98ade78e3ac252b33cbb794af">KS_SELRF::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1340</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a9c5ace140d91043230e2e5364a0be90b"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a9c5ace140d91043230e2e5364a0be90b">ks_pg_wave</a></div><div class="ttdeci">STATUS ks_pg_wave(KS_WAVE *wave, KS_SEQLOC loc, KS_SEQ_CONTROL *ctrl)</div><div class="ttdoc">Places a KS_WAVE sequence object on a board at some position in the pulse sequence</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1593</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a1910d262855b71da353ed0d07a6c7823"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">KS_SEQLOC::pos</a></div><div class="ttdeci">int pos</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:242</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_a607347e9c1c7a9eef21fff556faccc3f"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">KS_SELRF::gradwave</a></div><div class="ttdeci">KS_WAVE gradwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1342</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a2e3f5254967cadb9a41167c6fbf6743e"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">KS_SEQLOC::board</a></div><div class="ttdeci">int board</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:241</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a606fbf556e8a297aa1f68b098f6ac2a2"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">KS_SEQLOC::ampscale</a></div><div class="ttdeci">float ampscale</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:243</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_a35145c98c931f54a8bf2b97edfb3e4c6"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#a35145c98c931f54a8bf2b97edfb3e4c6">KS_SELRF::pregrad</a></div><div class="ttdeci">KS_TRAP pregrad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1339</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_acc74b390428f6607e8c540f6b4182407"><div class="ttname"><a href="_k_s_foundation__common_8c.html#acc74b390428f6607e8c540f6b4182407">ks_pg_rf</a></div><div class="ttdeci">STATUS ks_pg_rf(KS_RF *rf, KS_SEQLOC loc, KS_SEQ_CONTROL *ctrl)</div><div class="ttdoc">Places a KS_RF sequence object on a board at some position in the pulse sequence</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1799</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_adeab1cc34f1a7f20f41e8825d849981e"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">KS_SELRF::rf</a></div><div class="ttdeci">KS_RF rf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1334</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">KS_WAVE::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:516</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_aa65115d54842eeffc47a1b324caa62ab"><div class="ttname"><a href="_k_s_foundation__common_8c.html#aa65115d54842eeffc47a1b324caa62ab">ks_syslimits_gradtarget</a></div><div class="ttdeci">float ks_syslimits_gradtarget(LOG_GRAD loggrd, WF_PROCESSOR board)</div><div class="ttdoc">Returns the maximum target amplitude for a board (internal use)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:176</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a2a9b610a78cdae3ac8ef682bd34f7e0d"><div class="ttname"><a href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">KS_RF::rfwave</a></div><div class="ttdeci">KS_WAVE rfwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:798</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a></div><div class="ttdoc">typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:240</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_a5ac7ed86029ab647ba0c9a656ae9fb37"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#a5ac7ed86029ab647ba0c9a656ae9fb37">KS_SELRF::postgrad</a></div><div class="ttdeci">KS_TRAP postgrad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1341</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_TRAP::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:437</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_ab3341eea000c35a438dfeb3cfc1da103"><div class="ttname"><a href="_k_s_foundation__common_8c.html#ab3341eea000c35a438dfeb3cfc1da103">ks_pg_trap</a></div><div class="ttdeci">STATUS ks_pg_trap(KS_TRAP *trap, KS_SEQLOC loc, KS_SEQ_CONTROL *ctrl)</div><div class="ttdoc">Places a KS_TRAP sequence object on a board at some position in the pulse sequence</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1212</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_acbc719dc4e48c2a2df0447875e4348ca"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">KS_TRAP::ramptime</a></div><div class="ttdeci">int ramptime</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:435</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_WAVE::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:518</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af03615e60a63da6332e04a37aa801984"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af03615e60a63da6332e04a37aa801984">&#9670;&nbsp;</a></span>ks_pg_wait()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_pg_wait </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___w_a_i_t.html">KS_WAIT</a> *&#160;</td>
          <td class="paramname"><em>wait</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a>&#160;</td>
          <td class="paramname"><em>loc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>ctrl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Places a <a class="el" href="struct_k_s___w_a_i_t.html" title="Core sequence object that adds wait periods in the pulse sequence (see ks_eval_wait(), ks_pg_wait()). Can be placed on any sequence board">KS_WAIT</a> sequence object on all boards at some position in the pulse sequence</h4>
</p>
<p>This function should be called in the <code>@pg</code> section to place out a <a class="el" href="struct_k_s___w_a_i_t.html" title="Core sequence object that adds wait periods in the pulse sequence (see ks_eval_wait(), ks_pg_wait()). Can be placed on any sequence board">KS_WAIT</a> sequence object that creates a wait pulse. The same <a class="el" href="struct_k_s___w_a_i_t.html" title="Core sequence object that adds wait periods in the pulse sequence (see ks_eval_wait(), ks_pg_wait()). Can be placed on any sequence board">KS_WAIT</a> object can be placed out as many times as desired, by only changing the second argument each time (to avoid waveform overlaps). The second argument is a <a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> struct with three fields:</p><ul>
<li><code>.board</code>: <em>Ignored</em></li>
<li><code>.pos</code>: Absolute time in [us] of the start of the wait pulse</li>
<li><code>.ampscale</code>: <em>Ignored</em></li>
</ul>
<p>This function will insert a deadtime of duration equal to the <code>.duration</code> field in the <a class="el" href="struct_k_s___w_a_i_t.html" title="Core sequence object that adds wait periods in the pulse sequence (see ks_eval_wait(), ks_pg_wait()). Can be placed on any sequence board">KS_WAIT</a> object at position <code>.pos</code>. This delay can be changed in run-time by calling <a class="el" href="_k_s_foundation_8h.html#a196a10609c8f75d0ff6d7a520d0b7c27" title="Updates the wait period of all instances of a KS_WAIT sequence object. The value of waitperiod must n...">ks_scan_wait()</a>.</p>
<p>GENERAL NOTE: It is a <b>requirement</b> that the function in the <code>@pg</code> section containing all <code>ks_pg_***()</code> calls is also called exactly once in <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code> after the calls to the corresponding <code>ks_eval_***()</code> functions that design the KS_*** sequence objects. Each <code>ks_pg_***()</code> will throw an error if this has not been done.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">wait</td><td>Pointer to a <a class="el" href="struct_k_s___w_a_i_t.html" title="Core sequence object that adds wait periods in the pulse sequence (see ks_eval_wait(), ks_pg_wait()). Can be placed on any sequence board">KS_WAIT</a> sequence object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">loc</td><td><a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> struct to specify when and where to place the <a class="el" href="struct_k_s___w_a_i_t.html" title="Core sequence object that adds wait periods in the pulse sequence (see ks_eval_wait(), ks_pg_wait()). Can be placed on any sequence board">KS_WAIT</a> </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctrl</td><td>Pointer to the <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> struct corresponding to the sequence module for this <a class="el" href="struct_k_s___w_a_i_t.html" title="Core sequence object that adds wait periods in the pulse sequence (see ks_eval_wait(), ks_pg_wait()). Can be placed on any sequence board">KS_WAIT</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;                                                                      {</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> first = loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a839a809fe0e8486a8cd3d41788349129">KS_ALL</a> ? XGRAD : loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>;</div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> last = loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a839a809fe0e8486a8cd3d41788349129">KS_ALL</a> ? SSP : loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>;</div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;  <span class="comment">/* checking for NULL pointers */</span></div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;  <span class="keywordflow">if</span> (wait == NULL) {</div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wait: First argument is NULL&quot;</span>);</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;  }</div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;</div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;  <span class="comment">/* duration of 0 should not throw an error as this is a sign of that it has not been set up</span></div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;<span class="comment">     or has manually been disabled this way */</span></div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;  <span class="keywordflow">if</span> (wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> == 0) {</div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;    <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;  }</div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;</div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;  <span class="keywordflow">if</span> (wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a1c544bec41003a594ba4ec7d43a3a470">description</a> == NULL || wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>[0] == 0 || wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>[0] == <span class="charliteral">&#39; &#39;</span>) {</div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wait: Invalid description (&#39;%s&#39;)&quot;</span>, wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;  }</div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;</div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;  <span class="comment">/* disallow EPI dual boards */</span></div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> &gt;= <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a6016c24e63f250c7e49d537c9b01dea1">KS_FREQX_PHASEY</a> &amp;&amp; loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> &lt;= <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a888d3c7138175390df8ccde3cf29c868">KS_XYZ</a>) {</div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wait(%s): Invalid board selection: %d&quot;</span>, wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>);</div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;  }</div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;</div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;  loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> = RUP_GRD(loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>);</div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;</div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;  {</div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;</div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;    <span class="comment">/* TGT: Don&#39;t place anything on hardware if ctrl-&gt;duration = 0.</span></div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;<span class="comment">       This is in concert with:</span></div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;<span class="comment">       - not performing createseq() in KS_SEQLENGTH if seqctrl.duration = 0</span></div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;<span class="comment">       - not playing sequence modules in scan() using ks_scan_playsequence() if seqctrl.duration = 0</span></div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;    <span class="keywordflow">if</span> (ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> == 0) {</div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;      <a class="code" href="_k_s_foundation__common_8c.html#abdc1fc916ea7bfbc3ce222f646ee3ae9">ks_dbg</a>(<span class="stringliteral">&quot;%s(%s): Refusing to place wait pulse since seqctrl.duration = 0 (indicating `%s` not to be played in scan())&quot;</span>, __FUNCTION__, wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;      <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;    }</div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;</div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;    <span class="keywordflow">if</span> (wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a> &gt;= wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>) {</div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_wait @tgt(%s): the number of instances generated on the target exceed the number of ones generated on the host&quot;</span>, wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;    }</div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;</div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;    <span class="keywordflow">if</span> (wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#aeb311c3018cbffb0db0463280f3c4cd5">wfpulse</a> == NULL) {</div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;      WF_PULSE wfInit = INITPULSE;</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;</div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> boardc[8] = <span class="stringliteral">&quot;xyzrrtos&quot;</span>;</div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;      <span class="keywordtype">char</span> tmpstr[<a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> + 4];</div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;      tmpstr[<a class="code" href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a> + 4 - 1] = 0;</div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;</div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;      wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#aeb311c3018cbffb0db0463280f3c4cd5">wfpulse</a> = (WF_PULSE *) AllocNode(8 * <span class="keyword">sizeof</span>(WF_PULSE));</div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;      <span class="keywordflow">for</span> (i = XGRAD; i &lt;= SSP; i++) {</div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;        <span class="keywordflow">if</span> (i != RHO2){</div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;          <span class="comment">/* init pulse structure */</span></div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;          wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#aeb311c3018cbffb0db0463280f3c4cd5">wfpulse</a>[i] = wfInit;</div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;</div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;          <span class="comment">/* Name for WF_PULSEs */</span></div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;          sprintf(tmpstr, <span class="stringliteral">&quot;%s.w%c&quot;</span>, wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, boardc[i]); pulsename(&amp;(wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#aeb311c3018cbffb0db0463280f3c4cd5">wfpulse</a>[i]), tmpstr);</div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;          createconst(&amp;(wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#aeb311c3018cbffb0db0463280f3c4cd5">wfpulse</a>[i]), i, wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>, 0);</div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;</div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;        } <span class="comment">/* per board */</span></div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;      }</div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;</div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;    } <span class="comment">/* wfpulse == NULL */</span></div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;</div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;    <span class="keywordflow">if</span> (!wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>) {</div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;      wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a15be3edad342a49398ca841c2745dc9e">wfi</a> = (<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a> *) AllocNode(wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a> * <span class="keyword">sizeof</span>(<a class="code" href="struct_k_s___w_a_i_t.html">KS_WAIT</a>));</div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;    }</div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;</div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;    <span class="keywordflow">for</span> (i = first; i &lt;= last; ++i) {</div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;      <span class="keywordflow">if</span> (i == <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8aebefea71c9bec2b927545759821d6657">KS_RHO2</a>) <span class="keywordflow">continue</span>; <span class="comment">/* skip RHO2 */</span></div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;      </div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;      loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> = i;</div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;      <span class="keywordtype">int</span> isrf = loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == RHO || loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == RHO2 || loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == THETA || loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == OMEGA;</div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;      <span class="keywordtype">int</span> isssp = loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == SSP;</div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;</div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;      createinstr(&amp;(wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#aeb311c3018cbffb0db0463280f3c4cd5">wfpulse</a>[i]), loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> + (isrf * <a class="code" href="_k_s_foundation__common_8c.html#a636634b6eb50758af3826332f9180e9b">psd_rf_wait</a>) + (isssp * <a class="code" href="_k_s_foundation__common_8c.html#aa4225c3edfbcb8e85d91fc491a495058">psd_grd_wait</a>), wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>, 0);</div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;      wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">boardinstance</a> = wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#aeb311c3018cbffb0db0463280f3c4cd5">wfpulse</a>[i].ninsts - 1; <span class="comment">/* zero based */</span></div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;      wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">wf</a> = &amp;(wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#aeb311c3018cbffb0db0463280f3c4cd5">wfpulse</a>[i]);</div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;      wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a> = loc;</div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;      wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>++;</div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;    }</div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;</div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;    <span class="comment">/* sort after the last instance is generated */</span></div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;    <span class="keywordflow">if</span> (wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a> == wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>) {</div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;      <a class="code" href="_k_s_foundation__common_8c.html#a0ae65ed3cc2deb47ccf50b7988239474">ks_sort_wfi_by_timeboard</a>(wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>, wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>);</div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;    }</div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;  }</div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;  {</div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;    <span class="keywordflow">for</span> (i = first; i &lt;= last; ++i) {</div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;      <span class="keywordflow">if</span> (i == <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8aebefea71c9bec2b927545759821d6657">KS_RHO2</a>) <span class="keywordflow">continue</span>; <span class="comment">/* skip RHO2 */</span></div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;      loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> = i;</div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;      wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a89785a274d251fd637bf40923ad5c345">locs</a>[wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>] = loc;</div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;      wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>++;</div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;    }</div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;  }</div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;</div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;</div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;} <span class="comment">/* ks_pg_wait */</span></div><div class="ttc" id="_k_s_foundation__common_8c_html_a0ae65ed3cc2deb47ccf50b7988239474"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a0ae65ed3cc2deb47ccf50b7988239474">ks_sort_wfi_by_timeboard</a></div><div class="ttdeci">void ks_sort_wfi_by_timeboard(KS_WFINSTANCE *a, int nitems)</div><div class="ttdoc">Sort WF_INSTANCEs in time, then board</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2955</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8a6016c24e63f250c7e49d537c9b01dea1"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a6016c24e63f250c7e49d537c9b01dea1">KS_FREQX_PHASEY</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a42df2e3be0bda47009caae1a7042b522"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">KS_WFINSTANCE::boardinstance</a></div><div class="ttdeci">int boardinstance</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:251</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a1910d262855b71da353ed0d07a6c7823"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">KS_SEQLOC::pos</a></div><div class="ttdeci">int pos</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:242</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8aebefea71c9bec2b927545759821d6657"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8aebefea71c9bec2b927545759821d6657">KS_RHO2</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a></div><div class="ttdoc">(Internal use) Structure being a part of various sequence objects to sort them in time across boards...</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:250</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a72a22b96ff3908d2b9a20a3a02647a2f"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">KS_BASE::ninst</a></div><div class="ttdeci">int ninst</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:261</div></div>
<div class="ttc" id="struct_k_s___w_a_i_t_html"><div class="ttname"><a href="struct_k_s___w_a_i_t.html">KS_WAIT</a></div><div class="ttdoc">Core sequence object that adds wait periods in the pulse sequence (see ks_eval_wait(), ks_pg_wait()). Can be placed on any sequence board</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:308</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abdc1fc916ea7bfbc3ce222f646ee3ae9"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abdc1fc916ea7bfbc3ce222f646ee3ae9">ks_dbg</a></div><div class="ttdeci">STATUS ks_dbg(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:114</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a2e3f5254967cadb9a41167c6fbf6743e"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">KS_SEQLOC::board</a></div><div class="ttdeci">int board</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:241</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8a888d3c7138175390df8ccde3cf29c868"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a888d3c7138175390df8ccde3cf29c868">KS_XYZ</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_SEQ_CONTROL::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:984</div></div>
<div class="ttc" id="struct_k_s___w_a_i_t_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___w_a_i_t.html#a1c544bec41003a594ba4ec7d43a3a470">KS_WAIT::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:310</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8a839a809fe0e8486a8cd3d41788349129"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a839a809fe0e8486a8cd3d41788349129">KS_ALL</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aacb2fe1d83c45e8d0525f363bdd6b8a6"><div class="ttname"><a href="_k_s_foundation_8h.html#aacb2fe1d83c45e8d0525f363bdd6b8a6">KS_DESCRIPTION_LENGTH</a></div><div class="ttdeci">#define KS_DESCRIPTION_LENGTH</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:112</div></div>
<div class="ttc" id="struct_k_s___w_a_i_t_html_a89785a274d251fd637bf40923ad5c345"><div class="ttname"><a href="struct_k_s___w_a_i_t.html#a89785a274d251fd637bf40923ad5c345">KS_WAIT::locs</a></div><div class="ttdeci">KS_SEQLOC locs[KS_MAXINSTANCES]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:312</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a78e529e1d86855310035845e03a4c107"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">KS_WFINSTANCE::loc</a></div><div class="ttdeci">KS_SEQLOC loc</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:253</div></div>
<div class="ttc" id="struct_k_s___w_a_i_t_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">KS_WAIT::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:309</div></div>
<div class="ttc" id="struct_k_s___w_a_i_t_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___w_a_i_t.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_WAIT::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:311</div></div>
<div class="ttc" id="struct_k_s___w_a_i_t_html_a15be3edad342a49398ca841c2745dc9e"><div class="ttname"><a href="struct_k_s___w_a_i_t.html#a15be3edad342a49398ca841c2745dc9e">KS_WAIT::wfi</a></div><div class="ttdeci">KS_WFINSTANCE * wfi</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:314</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a558b0ff480e8db364962bd0f203d6958"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">KS_WFINSTANCE::wf</a></div><div class="ttdeci">WF_PULSE * wf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:252</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_aa4225c3edfbcb8e85d91fc491a495058"><div class="ttname"><a href="_k_s_foundation__common_8c.html#aa4225c3edfbcb8e85d91fc491a495058">psd_grd_wait</a></div><div class="ttdeci">int psd_grd_wait</div></div>
<div class="ttc" id="struct_k_s___w_a_i_t_html_aeb311c3018cbffb0db0463280f3c4cd5"><div class="ttname"><a href="struct_k_s___w_a_i_t.html#aeb311c3018cbffb0db0463280f3c4cd5">KS_WAIT::wfpulse</a></div><div class="ttdeci">WF_PULSE * wfpulse</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:313</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">KS_SEQ_CONTROL::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:990</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a636634b6eb50758af3826332f9180e9b"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a636634b6eb50758af3826332f9180e9b">psd_rf_wait</a></div><div class="ttdeci">int psd_rf_wait</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a67d0db25c6c69ee17a9b4b0ee79b7fb7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a67d0db25c6c69ee17a9b4b0ee79b7fb7">&#9670;&nbsp;</a></span>ks_pg_isirot()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_pg_isirot </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___i_s_i_r_o_t.html">KS_ISIROT</a> *&#160;</td>
          <td class="paramname"><em>isirot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SCAN_INFO&#160;</td>
          <td class="paramname"><em>scan_info</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>rotfun</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>ctrl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Places out an intersequence interrupt at a specific time in the sequence module</h4>
</p>
<p>This function connects the execution of a psd-specific rotation function in realtime when time passes this point in the sequence. This is done by two <a class="el" href="struct_k_s___w_a_i_t.html" title="Core sequence object that adds wait periods in the pulse sequence (see ks_eval_wait(), ks_pg_wait()). Can be placed on any sequence board">KS_WAIT</a> pulses (being part of <a class="el" href="struct_k_s___i_s_i_r_o_t.html" title="Struct for in-sequence rotations using ISI vector interupts">KS_ISIROT</a>) on the SSP board.</p>
<p>Example of use in a <code>myseqmodule_pg()</code> function of the sequence module (in <a class="el" href="ksepi_8e.html#a9229731c099971b90dbf7721bad586a9">pulsegen()</a>):</p>
<div class="fragment"><div class="line"><span class="comment">// add some padding time before the SSP pulses (not well tested how much of KS_ISI_predelay that is necessary)</span></div><div class="line">mypos += RUP_GRD(<a class="code" href="_k_s_foundation_8h.html#ab70ad63ae09d81e0c912e61d3fbef0fa">KS_ISI_predelay</a>);</div><div class="line"></div><div class="line">status = <a class="code" href="_k_s_foundation_8h.html#a67d0db25c6c69ee17a9b4b0ee79b7fb7">ks_pg_isirot</a>(&amp;myisirot, myscaninfo, mypos, myisirotatefun, myseqctrl);</div><div class="line"><span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"></div><div class="line"><span class="comment">// add some padding time after the SSP pulses (not well tested how much of KS_ISI_postdelay that is necessary)</span></div><div class="line">mypos += RUP_GRD(myisirot.duration + <a class="code" href="_k_s_foundation_8h.html#af1033833702a65e227f5dcd4b0e29e74">KS_ISI_postdelay</a>);</div></div><!-- fragment --><p>where the psd-specific rotation function is declared as:</p>
<div class="fragment"><div class="line"><span class="comment">// Intra sequence interrupts placed as WAIT pulses on the SSP board may be used to call for an immediate</span></div><div class="line"><span class="comment">// rotation of the logical coordinate system in real time as these WAIT pulses are played out, as</span></div><div class="line"><span class="comment">// opposed to during the SSI time for the sequence module.</span></div><div class="line"><span class="comment">// The WAIT pulse is assigned a control number (isi number) that is then connected to this void function</span></div><div class="line"><span class="comment">// using `isivector()` in ks_pg_isirot(). No input arguments can be passed to this function. Instead the</span></div><div class="line"><span class="comment">// rotation information specific to the sequence module is provided in `myscaninfo.oprot`. The acutal</span></div><div class="line"><span class="comment">// rotation work, incl. keeping track of number of isi pulses played out is done by ks_scan_isirotate().</span></div><div class="line"><span class="keywordtype">void</span> myisirotatefun() {</div><div class="line"></div><div class="line"><span class="preprocessor">#ifdef IPG</span></div><div class="line">  <a class="code" href="_k_s_foundation_8h.html#a520240c3153cf9ffe25a7617b2c72149">ks_scan_isirotate</a>(&amp;myisirot);</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line">}</div></div><!-- fragment --><p> Note that the only difference between the psd-specific <code>myisirotatefun()</code> and the general <a class="el" href="_k_s_foundation_8h.html#a520240c3153cf9ffe25a7617b2c72149" title="Performs an immediate rotation of the logical system on hardware (WARP)">ks_scan_isirotate()</a> is that <code>myisirotatefun()</code> has no input arguments. Input arguments cannot be used as it is called from an interrupt routine, not from some other parent function.</p>
<p>Care must be taken when mixing the use of <a class="el" href="_k_s_foundation_8h.html#a2fdfe2e655a76c4cd4fb1dac16d1834b" title="Performs a rotation of the logical system on hardware (WARP)">ks_scan_rotate()</a> (executing during the SSI time) and these ISI interrupts, so that they are executed in the correct order. One way is to consistently avoid the use of <a class="el" href="_k_s_foundation_8h.html#a2fdfe2e655a76c4cd4fb1dac16d1834b" title="Performs a rotation of the logical system on hardware (WARP)">ks_scan_rotate()</a> and instead return to the prescribed slice rotation by calling <a class="el" href="_k_s_foundation_8h.html#a67d0db25c6c69ee17a9b4b0ee79b7fb7" title="Places out an intersequence interrupt at a specific time in the sequence module">ks_pg_isirot()</a> again, last in the same <code>myseqmodule_pg()</code> function, this time using the prescribed scan_info struct:</p>
<div class="fragment"><div class="line">status = <a class="code" href="_k_s_foundation_8h.html#a67d0db25c6c69ee17a9b4b0ee79b7fb7">ks_pg_isirot</a>(&amp;myisirot, <a class="code" href="_g_e_required_8e.html#aedd5d7c8a00be480230531f3ab5f8bdb">ks_scan_info</a>[0], mypos, myisirotatefun, myseqctrl);</div><div class="line"><span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div></div><!-- fragment --><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">isirot</td><td>Pointer to a <a class="el" href="struct_k_s___i_s_i_r_o_t.html" title="Struct for in-sequence rotations using ISI vector interupts">KS_ISIROT</a> sequence object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">scan_info</td><td>SCAN_INFO struct holding an <code>.oprot</code> matrix to be used for real-time rotation </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pos</td><td>Absolute position in [us] in the pulse sequence when this rotation should occur </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rotfun</td><td>Function pointer to the psd-specific rotation function </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctrl</td><td>Pointer to the <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> struct corresponding to the sequence module </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;                                                                                                         {</div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;  <a class="code" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> tmploc = <a class="code" href="_k_s_foundation_8h.html#ad01dd4f06fe226a502e872d4173ba7ae">KS_INIT_SEQLOC</a>;</div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;</div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;  <span class="keywordflow">if</span> (! isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>) {</div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;    <span class="comment">/* must have called ks_eval_isirot() first */</span></div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;    <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;  }</div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;</div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;  <span class="keywordflow">if</span> (rotfun == NULL)</div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: 4th arg (rotfun) cannot be NULL&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;</div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;</div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;  <span class="comment">/* Set the ctrl_word to binary match the isi vector interupt number */</span></div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;  <span class="comment">/* /--------------------------------------------------------------\ */</span></div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;  <span class="comment">/* | interupt number | ctrl_word                                  | */</span></div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;  <span class="comment">/* |--------------------------------------------------------------| */</span></div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;  <span class="comment">/* | 4               | PSD_ISI2_BIT                               | */</span></div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;  <span class="comment">/* | 5               | PSD_ISI0_BIT + PSD_ISI2_BIT                | */</span></div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;  <span class="comment">/* | 6               | PSD_ISI1_BIT + PSD_ISI2_BIT                | */</span></div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;  <span class="comment">/* | 7               | PSD_ISI0_BIT + PSD_ISI1_BIT + PSD_ISI2_BIT | */</span></div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;  <span class="comment">/* \--------------------------------------------------------------/ */</span></div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;</div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;  tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> = SSP;</div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;  tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> = RUP_GRD(pos);</div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#aeea9a34f36ca48eda6882d9426a4e638">ks_pg_wait</a>(&amp;isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#ae1657bcc1ec96d5840d39d301f6f296c">waitfun</a>, tmploc, ctrl) == FAILURE)</div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;</div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;  tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> += RUP_GRD(isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#ae1657bcc1ec96d5840d39d301f6f296c">waitfun</a>.<a class="code" href="struct_k_s___w_a_i_t.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>);</div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;</div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#aeea9a34f36ca48eda6882d9426a4e638">ks_pg_wait</a>(&amp;isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#ad8daa9629fb2aa8f141f7be2fef5a62d">waitrot</a>, tmploc, ctrl) == FAILURE)</div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;</div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;</div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;  {</div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;    <span class="keywordtype">long</span> ctrl_word = 0;</div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;    <span class="keywordtype">int</span> placementindx = isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#ae1657bcc1ec96d5840d39d301f6f296c">waitfun</a>.<a class="code" href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a> - 1;</div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;</div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;    <span class="comment">/* SSP ISI number */</span></div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;    getctrl(&amp;ctrl_word, &amp;isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#ae1657bcc1ec96d5840d39d301f6f296c">waitfun</a>.<a class="code" href="struct_k_s___w_a_i_t.html#aeb311c3018cbffb0db0463280f3c4cd5">wfpulse</a>[SSP], isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#ae1657bcc1ec96d5840d39d301f6f296c">waitfun</a>.<a class="code" href="struct_k_s___w_a_i_t.html#aeb311c3018cbffb0db0463280f3c4cd5">wfpulse</a>[SSP].ninsts - 1);</div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;</div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;    <span class="keywordflow">if</span> (isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#a0e1954c05e7f29d42ad9f68ea2b38559">isinumber</a> == 4)</div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;      ctrl_word  = ctrl_word | PSD_ISI2_BIT;</div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#a0e1954c05e7f29d42ad9f68ea2b38559">isinumber</a> == 5)</div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;      ctrl_word  = ctrl_word | PSD_ISI0_BIT | PSD_ISI2_BIT;</div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#a0e1954c05e7f29d42ad9f68ea2b38559">isinumber</a> == 6)</div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;      ctrl_word  = ctrl_word | PSD_ISI1_BIT | PSD_ISI2_BIT;</div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#a0e1954c05e7f29d42ad9f68ea2b38559">isinumber</a> == 7)</div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;      ctrl_word  = ctrl_word | PSD_ISI0_BIT | PSD_ISI1_BIT | PSD_ISI2_BIT;</div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;</div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;    setctrl(ctrl_word, &amp;isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#ae1657bcc1ec96d5840d39d301f6f296c">waitfun</a>.<a class="code" href="struct_k_s___w_a_i_t.html#aeb311c3018cbffb0db0463280f3c4cd5">wfpulse</a>[SSP], isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#ae1657bcc1ec96d5840d39d301f6f296c">waitfun</a>.<a class="code" href="struct_k_s___w_a_i_t.html#aeb311c3018cbffb0db0463280f3c4cd5">wfpulse</a>[SSP].ninsts - 1);</div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;</div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;    <span class="comment">/* SSP Rotation */</span></div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;    getctrl(&amp;ctrl_word, &amp;isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#ad8daa9629fb2aa8f141f7be2fef5a62d">waitrot</a>.<a class="code" href="struct_k_s___w_a_i_t.html#aeb311c3018cbffb0db0463280f3c4cd5">wfpulse</a>[SSP], isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#ad8daa9629fb2aa8f141f7be2fef5a62d">waitrot</a>.<a class="code" href="struct_k_s___w_a_i_t.html#aeb311c3018cbffb0db0463280f3c4cd5">wfpulse</a>[SSP].ninsts - 1);</div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;    ctrl_word |= PSD_MTX_UPDT;</div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;    setctrl(ctrl_word, &amp;isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#ad8daa9629fb2aa8f141f7be2fef5a62d">waitrot</a>.<a class="code" href="struct_k_s___w_a_i_t.html#aeb311c3018cbffb0db0463280f3c4cd5">wfpulse</a>[SSP], isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#ad8daa9629fb2aa8f141f7be2fef5a62d">waitrot</a>.<a class="code" href="struct_k_s___w_a_i_t.html#aeb311c3018cbffb0db0463280f3c4cd5">wfpulse</a>[SSP].ninsts - 1);</div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;</div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;    <span class="comment">/* Allocate memory for scan info array */</span></div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;    <span class="keywordflow">if</span> (isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#a401a138c899d31df5f63f1971febe233">scan_info</a> == NULL) {</div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;      isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#a401a138c899d31df5f63f1971febe233">scan_info</a> = (SCAN_INFO *) AllocNode(isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#aa571b5a96556f71c84be339d2e9193b4">numinstances</a> * <span class="keyword">sizeof</span>(SCAN_INFO));</div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;    }</div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;</div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;    <span class="comment">/* Store the scan info for current ISI, where scan_info.oprot contains the rotation matrix */</span></div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;    isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#a401a138c899d31df5f63f1971febe233">scan_info</a>[placementindx] = scan_info;</div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;</div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;    <span class="comment">/* Reset num ISI and counter */</span></div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;    isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#a617a47c70795bcff659815ad0efd2266">counter</a> = 0; <span class="comment">/* make sure it is zero before scan starts */</span></div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;</div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;    <span class="comment">/* Connect ths isi number with the function pointer */</span></div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;    isivector((<span class="keywordtype">short</span>) isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#a0e1954c05e7f29d42ad9f68ea2b38559">isinumber</a>, rotfun, (<span class="keywordtype">short</span>) FALSE);</div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;</div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;  }</div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;</div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;  <span class="keywordflow">if</span> (0) { <span class="comment">/* make sure the WAIT pulses have been placed out in temporal order */</span></div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;    <span class="keywordtype">int</span> i;</div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;    <span class="keywordtype">int</span> lastpos = -1;</div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;    WF_INSTR_HDR *instr = isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#ae1657bcc1ec96d5840d39d301f6f296c">waitfun</a>.<a class="code" href="struct_k_s___w_a_i_t.html#aeb311c3018cbffb0db0463280f3c4cd5">wfpulse</a>[SSP].inst_hdr_tail;</div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; (isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#ae1657bcc1ec96d5840d39d301f6f296c">waitfun</a>.<a class="code" href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a> - 1); i++) {</div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;      <span class="keywordflow">if</span> (lastpos &gt; instr-&gt;start) {</div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;%s: Must place the ISI pulses in temporal order&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;        lastpos = instr-&gt;start;</div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;        instr = instr-&gt;next;</div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;      }</div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;    }</div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;  }</div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;</div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;  <span class="comment">/* copy for convenience */</span></div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;  isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#aa571b5a96556f71c84be339d2e9193b4">numinstances</a> = isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#ae1657bcc1ec96d5840d39d301f6f296c">waitfun</a>.<a class="code" href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>;</div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;</div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;</div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;    <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;</div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;} <span class="comment">/* ks_pg_isirot() */</span></div><div class="ttc" id="struct_k_s___i_s_i_r_o_t_html_a0e1954c05e7f29d42ad9f68ea2b38559"><div class="ttname"><a href="struct_k_s___i_s_i_r_o_t.html#a0e1954c05e7f29d42ad9f68ea2b38559">KS_ISIROT::isinumber</a></div><div class="ttdeci">int isinumber</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:325</div></div>
<div class="ttc" id="struct_k_s___i_s_i_r_o_t_html_a401a138c899d31df5f63f1971febe233"><div class="ttname"><a href="struct_k_s___i_s_i_r_o_t.html#a401a138c899d31df5f63f1971febe233">KS_ISIROT::scan_info</a></div><div class="ttdeci">SCAN_INFO * scan_info</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:324</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a1910d262855b71da353ed0d07a6c7823"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">KS_SEQLOC::pos</a></div><div class="ttdeci">int pos</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:242</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a72a22b96ff3908d2b9a20a3a02647a2f"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">KS_BASE::ninst</a></div><div class="ttdeci">int ninst</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:261</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a2e3f5254967cadb9a41167c6fbf6743e"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">KS_SEQLOC::board</a></div><div class="ttdeci">int board</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:241</div></div>
<div class="ttc" id="struct_k_s___i_s_i_r_o_t_html_ae1657bcc1ec96d5840d39d301f6f296c"><div class="ttname"><a href="struct_k_s___i_s_i_r_o_t.html#ae1657bcc1ec96d5840d39d301f6f296c">KS_ISIROT::waitfun</a></div><div class="ttdeci">KS_WAIT waitfun</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:322</div></div>
<div class="ttc" id="struct_k_s___w_a_i_t_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">KS_WAIT::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:309</div></div>
<div class="ttc" id="struct_k_s___i_s_i_r_o_t_html_a617a47c70795bcff659815ad0efd2266"><div class="ttname"><a href="struct_k_s___i_s_i_r_o_t.html#a617a47c70795bcff659815ad0efd2266">KS_ISIROT::counter</a></div><div class="ttdeci">int counter</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:327</div></div>
<div class="ttc" id="struct_k_s___w_a_i_t_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___w_a_i_t.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_WAIT::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:311</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a></div><div class="ttdoc">typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:240</div></div>
<div class="ttc" id="struct_k_s___i_s_i_r_o_t_html_aa571b5a96556f71c84be339d2e9193b4"><div class="ttname"><a href="struct_k_s___i_s_i_r_o_t.html#aa571b5a96556f71c84be339d2e9193b4">KS_ISIROT::numinstances</a></div><div class="ttdeci">int numinstances</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:328</div></div>
<div class="ttc" id="struct_k_s___i_s_i_r_o_t_html_ad8daa9629fb2aa8f141f7be2fef5a62d"><div class="ttname"><a href="struct_k_s___i_s_i_r_o_t.html#ad8daa9629fb2aa8f141f7be2fef5a62d">KS_ISIROT::waitrot</a></div><div class="ttdeci">KS_WAIT waitrot</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:323</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_aeea9a34f36ca48eda6882d9426a4e638"><div class="ttname"><a href="_k_s_foundation__common_8c.html#aeea9a34f36ca48eda6882d9426a4e638">ks_pg_wait</a></div><div class="ttdeci">STATUS ks_pg_wait(KS_WAIT *wait, KS_SEQLOC loc, KS_SEQ_CONTROL *ctrl)</div><div class="ttdoc">Places a KS_WAIT sequence object on all boards at some position in the pulse sequence</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2038</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ad01dd4f06fe226a502e872d4173ba7ae"><div class="ttname"><a href="_k_s_foundation_8h.html#ad01dd4f06fe226a502e872d4173ba7ae">KS_INIT_SEQLOC</a></div><div class="ttdeci">#define KS_INIT_SEQLOC</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:128</div></div>
<div class="ttc" id="struct_k_s___w_a_i_t_html_aeb311c3018cbffb0db0463280f3c4cd5"><div class="ttname"><a href="struct_k_s___w_a_i_t.html#aeb311c3018cbffb0db0463280f3c4cd5">KS_WAIT::wfpulse</a></div><div class="ttdeci">WF_PULSE * wfpulse</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:313</div></div>
<div class="ttc" id="struct_k_s___i_s_i_r_o_t_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___i_s_i_r_o_t.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_ISIROT::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:326</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4f4a69e9025fa9af8593354660731487"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4f4a69e9025fa9af8593354660731487">&#9670;&nbsp;</a></span>ks_pg_epi_dephasers()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_pg_epi_dephasers </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *&#160;</td>
          <td class="paramname"><em>epi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a>&#160;</td>
          <td class="paramname"><em>loc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>ctrl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Places out the dephasing gradients of a <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> object (<em>used by <a class="el" href="_k_s_foundation_8h.html#a804f4f4b870338386e1dea3a877f5bd2" title="Places out a KS_EPI object (EPI train including dephaser and rephaser gradients)">ks_pg_epi()</a></em>)</h4>
</p>
<p>This function is called internally by <a class="el" href="_k_s_foundation_8h.html#a804f4f4b870338386e1dea3a877f5bd2" title="Places out a KS_EPI object (EPI train including dephaser and rephaser gradients)">ks_pg_epi()</a> to place out the dephasing gradients of a <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> object. See <a class="el" href="_k_s_foundation_8h.html#a804f4f4b870338386e1dea3a877f5bd2" title="Places out a KS_EPI object (EPI train including dephaser and rephaser gradients)">ks_pg_epi()</a> for more details</p>
<p>For advanced usage of <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a>, it is possible to call ks_pg_epi_dephaser(), <a class="el" href="_k_s_foundation_8h.html#a0d7fe8d68dfb536eb3e903b1ab58e615" title="Places out the core part a KS_EPI object (used by ks_pg_epi())">ks_pg_epi_echo()</a> and <a class="el" href="_k_s_foundation_8h.html#aeaa0bf154295359cf8e84cedfbfdbe8b" title="Places out the rephasing gradients of a KS_EPI object (used by ks_pg_epi())">ks_pg_epi_rephasers()</a> separately instead of the single call to <a class="el" href="_k_s_foundation_8h.html#a804f4f4b870338386e1dea3a877f5bd2" title="Places out a KS_EPI object (EPI train including dephaser and rephaser gradients)">ks_pg_epi()</a>. This allows the dephasing and rephasing gradients to be detached from the core EPI readout part</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">epi</td><td>Pointer to a <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> sequence object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">loc</td><td><a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> struct to specify when and where to place the dephasers of the <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ctrl</td><td>Pointer to the <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> struct corresponding to the sequence module for this <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;                                                                             {</div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;  <span class="keywordtype">int</span> readaxis, blipaxis, sliceaxis;</div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;  <a class="code" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> tmploc = <a class="code" href="_k_s_foundation_8h.html#ad01dd4f06fe226a502e872d4173ba7ae">KS_INIT_SEQLOC</a>;</div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;  <span class="keywordtype">int</span> maxduration;</div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;</div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;  <span class="keywordflow">if</span> (!epi) { <span class="keywordflow">return</span> FAILURE; }</div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;</div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;  <span class="comment">/* loc.ampscale may only be +1 or -1 and will control the read polarity.</span></div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;<span class="comment">   The blip polarity is controlled in run time with ks_scan_epi_shotcontrol() */</span></div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> != 1.0 &amp;&amp; loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> != -1.0) {</div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_epi_dephasers: loc.ampscale must be +1 or -1 (controls read polarity)&quot;</span>);</div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;  }</div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;</div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;  loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> = RDN_GRD(loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>);</div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;</div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;  <span class="keywordflow">switch</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>) {</div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a6016c24e63f250c7e49d537c9b01dea1">KS_FREQX_PHASEY</a>:</div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;    readaxis = XGRAD; blipaxis = YGRAD; sliceaxis = ZGRAD; <span class="keywordflow">break</span>;</div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a9bc0b0996e2ac9c6a131209ae4c88629">KS_FREQY_PHASEX</a>:</div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;    readaxis = YGRAD; blipaxis = XGRAD; sliceaxis = ZGRAD; <span class="keywordflow">break</span>;</div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ae0b83b9295764e027abbf88b95b09879">KS_FREQX_PHASEZ</a>:</div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;    readaxis = XGRAD; blipaxis = ZGRAD; sliceaxis = YGRAD; <span class="keywordflow">break</span>;</div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ae2467923eda691b22f68ca96bd7e1c1f">KS_FREQZ_PHASEX</a>:</div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;    readaxis = ZGRAD; blipaxis = XGRAD; sliceaxis = YGRAD; <span class="keywordflow">break</span>;</div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8afa622a33dd2854dfe97a4056ecec5b67">KS_FREQY_PHASEZ</a>:</div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;    readaxis = YGRAD; blipaxis = ZGRAD; sliceaxis = XGRAD; <span class="keywordflow">break</span>;</div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ad53040a098477496911fa2b1850a2d93">KS_FREQZ_PHASEY</a>:</div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;    readaxis = ZGRAD; blipaxis = YGRAD; sliceaxis = XGRAD; <span class="keywordflow">break</span>;</div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;  <span class="keywordflow">default</span>:</div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_epi_dephasers: loc.board is not valid: %d&quot;</span>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>);</div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;  }</div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;</div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;  <span class="comment">/* allocate time corresponding to the longest of the three, but push the dephasers to the right below */</span></div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;  maxduration = IMax(3, epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#abc81c5867684b6e31b65459ec9431269">readphaser</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>, epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>, epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>);</div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;</div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;  <span class="comment">/* read phaser (same KS_TRAP for DE/REphasing =&gt; 2 instances per EPI) */</span></div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;  <span class="keywordflow">if</span> (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#abc81c5867684b6e31b65459ec9431269">readphaser</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> &gt; 0) {</div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;    tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> = readaxis;</div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;    tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> = loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a>;</div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;    tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> = loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> + maxduration - epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#abc81c5867684b6e31b65459ec9431269">readphaser</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>;</div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#ab3341eea000c35a438dfeb3cfc1da103">ks_pg_trap</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#abc81c5867684b6e31b65459ec9431269">readphaser</a>, tmploc, ctrl) == FAILURE)</div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;      <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;  }</div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;</div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;  <span class="comment">/* blip phaser (same KS_PHASER for DE/REphasing =&gt; 2 instances per EPI) */</span></div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;  <span class="keywordflow">if</span> (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> &gt; 0) {</div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;    tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> = blipaxis;</div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;    tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> = 1.0;</div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;    tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> = loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> + maxduration - epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>;</div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#a82a797ba7a2ddcd48502d834c2a067b6">ks_pg_phaser</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>, tmploc, ctrl) == FAILURE)</div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;      <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;  }</div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;</div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;  <span class="comment">/* slice phaser (same KS_PHASER for DE/REphasing =&gt; 2 instances per EPI) */</span></div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;  <span class="keywordflow">if</span> (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> &gt; 0) {</div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;    tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> = sliceaxis;</div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;    tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> = 1.0;</div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;    tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> = loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> + maxduration - epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>;</div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#a82a797ba7a2ddcd48502d834c2a067b6">ks_pg_phaser</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>, tmploc, ctrl) == FAILURE)</div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;      <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;  }</div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;</div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;} <span class="comment">/* ks_pg_epi_dephasers */</span></div><div class="ttc" id="_k_s_foundation__common_8c_html_a82a797ba7a2ddcd48502d834c2a067b6"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a82a797ba7a2ddcd48502d834c2a067b6">ks_pg_phaser</a></div><div class="ttdeci">STATUS ks_pg_phaser(KS_PHASER *phaser, KS_SEQLOC loc, KS_SEQ_CONTROL *ctrl)</div><div class="ttdoc">Places a KS_PHASER sequence object on a board at some position in the pulse sequence</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1412</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8a6016c24e63f250c7e49d537c9b01dea1"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a6016c24e63f250c7e49d537c9b01dea1">KS_FREQX_PHASEY</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">KS_PHASER::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1525</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a1910d262855b71da353ed0d07a6c7823"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">KS_SEQLOC::pos</a></div><div class="ttdeci">int pos</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:242</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8ae0b83b9295764e027abbf88b95b09879"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ae0b83b9295764e027abbf88b95b09879">KS_FREQX_PHASEZ</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a22cd0313e5ffabe8393f77745dba8d52"><div class="ttname"><a href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">KS_EPI::blipphaser</a></div><div class="ttdeci">KS_PHASER blipphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1688</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a2e3f5254967cadb9a41167c6fbf6743e"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">KS_SEQLOC::board</a></div><div class="ttdeci">int board</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:241</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_ad76a5ac226f0d25f70349ef83b5bc38a"><div class="ttname"><a href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">KS_EPI::zphaser</a></div><div class="ttdeci">KS_PHASER zphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1689</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8ad53040a098477496911fa2b1850a2d93"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ad53040a098477496911fa2b1850a2d93">KS_FREQZ_PHASEY</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a606fbf556e8a297aa1f68b098f6ac2a2"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">KS_SEQLOC::ampscale</a></div><div class="ttdeci">float ampscale</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:243</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8ae2467923eda691b22f68ca96bd7e1c1f"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ae2467923eda691b22f68ca96bd7e1c1f">KS_FREQZ_PHASEX</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8a9bc0b0996e2ac9c6a131209ae4c88629"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a9bc0b0996e2ac9c6a131209ae4c88629">KS_FREQY_PHASEX</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a></div><div class="ttdoc">typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:240</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8afa622a33dd2854dfe97a4056ecec5b67"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8afa622a33dd2854dfe97a4056ecec5b67">KS_FREQY_PHASEZ</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_abc81c5867684b6e31b65459ec9431269"><div class="ttname"><a href="struct_k_s___e_p_i.html#abc81c5867684b6e31b65459ec9431269">KS_EPI::readphaser</a></div><div class="ttdeci">KS_TRAP readphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1686</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ad01dd4f06fe226a502e872d4173ba7ae"><div class="ttname"><a href="_k_s_foundation_8h.html#ad01dd4f06fe226a502e872d4173ba7ae">KS_INIT_SEQLOC</a></div><div class="ttdeci">#define KS_INIT_SEQLOC</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:128</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_TRAP::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:437</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_ab3341eea000c35a438dfeb3cfc1da103"><div class="ttname"><a href="_k_s_foundation__common_8c.html#ab3341eea000c35a438dfeb3cfc1da103">ks_pg_trap</a></div><div class="ttdeci">STATUS ks_pg_trap(KS_TRAP *trap, KS_SEQLOC loc, KS_SEQ_CONTROL *ctrl)</div><div class="ttdoc">Places a KS_TRAP sequence object on a board at some position in the pulse sequence</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1212</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aeaa0bf154295359cf8e84cedfbfdbe8b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeaa0bf154295359cf8e84cedfbfdbe8b">&#9670;&nbsp;</a></span>ks_pg_epi_rephasers()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_pg_epi_rephasers </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *&#160;</td>
          <td class="paramname"><em>epi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a>&#160;</td>
          <td class="paramname"><em>loc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>ctrl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Places out the rephasing gradients of a <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> object (<em>used by <a class="el" href="_k_s_foundation_8h.html#a804f4f4b870338386e1dea3a877f5bd2" title="Places out a KS_EPI object (EPI train including dephaser and rephaser gradients)">ks_pg_epi()</a></em>)</h4>
</p>
<p>This function is called internally by <a class="el" href="_k_s_foundation_8h.html#a804f4f4b870338386e1dea3a877f5bd2" title="Places out a KS_EPI object (EPI train including dephaser and rephaser gradients)">ks_pg_epi()</a> to place out the rephasing gradients of a <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> object. See <a class="el" href="_k_s_foundation_8h.html#a804f4f4b870338386e1dea3a877f5bd2" title="Places out a KS_EPI object (EPI train including dephaser and rephaser gradients)">ks_pg_epi()</a> for more details</p>
<p>For advanced usage of <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a>, it is possible to call ks_pg_epi_dephaser(), <a class="el" href="_k_s_foundation_8h.html#a0d7fe8d68dfb536eb3e903b1ab58e615" title="Places out the core part a KS_EPI object (used by ks_pg_epi())">ks_pg_epi_echo()</a> and <a class="el" href="_k_s_foundation_8h.html#aeaa0bf154295359cf8e84cedfbfdbe8b" title="Places out the rephasing gradients of a KS_EPI object (used by ks_pg_epi())">ks_pg_epi_rephasers()</a> separately instead of the single call to <a class="el" href="_k_s_foundation_8h.html#a804f4f4b870338386e1dea3a877f5bd2" title="Places out a KS_EPI object (EPI train including dephaser and rephaser gradients)">ks_pg_epi()</a>. This allows the dephasing and rephasing gradients to be detached from the core EPI readout part</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">epi</td><td>Pointer to a <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> sequence object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">loc</td><td><a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> struct to specify when to place the rephasers of the <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ctrl</td><td>Pointer to the <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> struct corresponding to the sequence module for this <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;                                                                             {</div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;  <span class="keywordtype">int</span> readaxis, blipaxis, sliceaxis;</div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;  <a class="code" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> tmploc = <a class="code" href="_k_s_foundation_8h.html#ad01dd4f06fe226a502e872d4173ba7ae">KS_INIT_SEQLOC</a>;</div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;</div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;  <span class="keywordflow">if</span> (!epi) { <span class="keywordflow">return</span> FAILURE; }</div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;</div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;  <span class="comment">/* loc.ampscale may only be +1 or -1 and will control the read polarity.</span></div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;<span class="comment">    The blip polarity is controlled in run time with ks_scan_epi_shotcontrol() */</span></div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> != 1.0 &amp;&amp; loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> != -1.0) {</div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_epi_rephasers: loc.ampscale must be +1 or -1 (controls read polarity)&quot;</span>);</div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;  }</div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;</div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;  loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> = RDN_GRD(loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>);</div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;</div><div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;  <span class="keywordflow">switch</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>) {</div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a6016c24e63f250c7e49d537c9b01dea1">KS_FREQX_PHASEY</a>:</div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;    readaxis = XGRAD; blipaxis = YGRAD; sliceaxis = ZGRAD; <span class="keywordflow">break</span>;</div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a9bc0b0996e2ac9c6a131209ae4c88629">KS_FREQY_PHASEX</a>:</div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;    readaxis = YGRAD; blipaxis = XGRAD; sliceaxis = ZGRAD; <span class="keywordflow">break</span>;</div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ae0b83b9295764e027abbf88b95b09879">KS_FREQX_PHASEZ</a>:</div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;    readaxis = XGRAD; blipaxis = ZGRAD; sliceaxis = YGRAD; <span class="keywordflow">break</span>;</div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ae2467923eda691b22f68ca96bd7e1c1f">KS_FREQZ_PHASEX</a>:</div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;    readaxis = ZGRAD; blipaxis = XGRAD; sliceaxis = YGRAD; <span class="keywordflow">break</span>;</div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8afa622a33dd2854dfe97a4056ecec5b67">KS_FREQY_PHASEZ</a>:</div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;    readaxis = YGRAD; blipaxis = ZGRAD; sliceaxis = XGRAD; <span class="keywordflow">break</span>;</div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ad53040a098477496911fa2b1850a2d93">KS_FREQZ_PHASEY</a>:</div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;    readaxis = ZGRAD; blipaxis = YGRAD; sliceaxis = XGRAD; <span class="keywordflow">break</span>;</div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;  <span class="keywordflow">default</span>:</div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_epi_rephasers: loc.board is not valid: %d&quot;</span>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>);</div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;  }</div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;</div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;  <span class="comment">/* read phaser (same KS_TRAP for DE/REphasing =&gt; 2 instances per EPI) */</span></div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;  <span class="keywordflow">if</span> (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#abc81c5867684b6e31b65459ec9431269">readphaser</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> &gt; 0) {</div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;    tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> = readaxis;</div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;    tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> = loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>;</div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;    <span class="keywordflow">if</span> (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a> % 2) <span class="comment">/* same polarity of rephaser as dephaser if odd ETL */</span></div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;      tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> = loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a>;</div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;      tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> = -loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a>;</div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#ab3341eea000c35a438dfeb3cfc1da103">ks_pg_trap</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#abc81c5867684b6e31b65459ec9431269">readphaser</a>, tmploc, ctrl) == FAILURE)</div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;      <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;  }</div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;</div><div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;  <span class="comment">/* blip phaser (same KS_PHASER for DE/REphasing =&gt; 2 instances per EPI) */</span></div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;  <span class="keywordflow">if</span> (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> &gt; 0) {</div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;    tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> = blipaxis;</div><div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;    tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> = loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>;</div><div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;    tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> = 1.0;</div><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#a82a797ba7a2ddcd48502d834c2a067b6">ks_pg_phaser</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>, tmploc, ctrl) == FAILURE)</div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;      <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;  }</div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;</div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;  <span class="comment">/* slice phaser (same KS_PHASER for DE/REphasing =&gt; 2 instances per EPI) */</span></div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;  <span class="keywordflow">if</span> (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> &gt; 0) {</div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;    tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> = sliceaxis;</div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;    tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> = loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>;</div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;    tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> = 1.0;</div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#a82a797ba7a2ddcd48502d834c2a067b6">ks_pg_phaser</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>, tmploc, ctrl) == FAILURE)</div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;      <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;  }</div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;</div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;} <span class="comment">/* ks_pg_epi_rephasers */</span></div><div class="ttc" id="_k_s_foundation__common_8c_html_a82a797ba7a2ddcd48502d834c2a067b6"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a82a797ba7a2ddcd48502d834c2a067b6">ks_pg_phaser</a></div><div class="ttdeci">STATUS ks_pg_phaser(KS_PHASER *phaser, KS_SEQLOC loc, KS_SEQ_CONTROL *ctrl)</div><div class="ttdoc">Places a KS_PHASER sequence object on a board at some position in the pulse sequence</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1412</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8a6016c24e63f250c7e49d537c9b01dea1"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a6016c24e63f250c7e49d537c9b01dea1">KS_FREQX_PHASEY</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">KS_PHASER::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1525</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a1910d262855b71da353ed0d07a6c7823"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">KS_SEQLOC::pos</a></div><div class="ttdeci">int pos</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:242</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8ae0b83b9295764e027abbf88b95b09879"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ae0b83b9295764e027abbf88b95b09879">KS_FREQX_PHASEZ</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a22cd0313e5ffabe8393f77745dba8d52"><div class="ttname"><a href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">KS_EPI::blipphaser</a></div><div class="ttdeci">KS_PHASER blipphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1688</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a2e3f5254967cadb9a41167c6fbf6743e"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">KS_SEQLOC::board</a></div><div class="ttdeci">int board</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:241</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_ad76a5ac226f0d25f70349ef83b5bc38a"><div class="ttname"><a href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">KS_EPI::zphaser</a></div><div class="ttdeci">KS_PHASER zphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1689</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8ad53040a098477496911fa2b1850a2d93"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ad53040a098477496911fa2b1850a2d93">KS_FREQZ_PHASEY</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a606fbf556e8a297aa1f68b098f6ac2a2"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">KS_SEQLOC::ampscale</a></div><div class="ttdeci">float ampscale</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:243</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8ae2467923eda691b22f68ca96bd7e1c1f"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ae2467923eda691b22f68ca96bd7e1c1f">KS_FREQZ_PHASEX</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a7582325a159d8ec89a4a4ba0fb89e9a9"><div class="ttname"><a href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">KS_EPI::etl</a></div><div class="ttdeci">int etl</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1690</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8a9bc0b0996e2ac9c6a131209ae4c88629"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a9bc0b0996e2ac9c6a131209ae4c88629">KS_FREQY_PHASEX</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a></div><div class="ttdoc">typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:240</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8afa622a33dd2854dfe97a4056ecec5b67"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8afa622a33dd2854dfe97a4056ecec5b67">KS_FREQY_PHASEZ</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_abc81c5867684b6e31b65459ec9431269"><div class="ttname"><a href="struct_k_s___e_p_i.html#abc81c5867684b6e31b65459ec9431269">KS_EPI::readphaser</a></div><div class="ttdeci">KS_TRAP readphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1686</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ad01dd4f06fe226a502e872d4173ba7ae"><div class="ttname"><a href="_k_s_foundation_8h.html#ad01dd4f06fe226a502e872d4173ba7ae">KS_INIT_SEQLOC</a></div><div class="ttdeci">#define KS_INIT_SEQLOC</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:128</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_TRAP::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:437</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_ab3341eea000c35a438dfeb3cfc1da103"><div class="ttname"><a href="_k_s_foundation__common_8c.html#ab3341eea000c35a438dfeb3cfc1da103">ks_pg_trap</a></div><div class="ttdeci">STATUS ks_pg_trap(KS_TRAP *trap, KS_SEQLOC loc, KS_SEQ_CONTROL *ctrl)</div><div class="ttdoc">Places a KS_TRAP sequence object on a board at some position in the pulse sequence</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1212</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0d7fe8d68dfb536eb3e903b1ab58e615"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0d7fe8d68dfb536eb3e903b1ab58e615">&#9670;&nbsp;</a></span>ks_pg_epi_echo()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_pg_epi_echo </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *&#160;</td>
          <td class="paramname"><em>epi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a>&#160;</td>
          <td class="paramname"><em>loc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>ctrl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Places out the core part a <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> object (<em>used by <a class="el" href="_k_s_foundation_8h.html#a804f4f4b870338386e1dea3a877f5bd2" title="Places out a KS_EPI object (EPI train including dephaser and rephaser gradients)">ks_pg_epi()</a></em>)</h4>
</p>
<p>This function is called internally by <a class="el" href="_k_s_foundation_8h.html#a804f4f4b870338386e1dea3a877f5bd2" title="Places out a KS_EPI object (EPI train including dephaser and rephaser gradients)">ks_pg_epi()</a> to place out the core part of a <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> object. The core part is the EPI train without leading dephaser gradients or trailing rephaser gradients. See <a class="el" href="_k_s_foundation_8h.html#a804f4f4b870338386e1dea3a877f5bd2" title="Places out a KS_EPI object (EPI train including dephaser and rephaser gradients)">ks_pg_epi()</a> for more details</p>
<p>For advanced usage of <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a>, it is possible to call ks_pg_epi_dephaser(), <a class="el" href="_k_s_foundation_8h.html#a0d7fe8d68dfb536eb3e903b1ab58e615" title="Places out the core part a KS_EPI object (used by ks_pg_epi())">ks_pg_epi_echo()</a> and <a class="el" href="_k_s_foundation_8h.html#aeaa0bf154295359cf8e84cedfbfdbe8b" title="Places out the rephasing gradients of a KS_EPI object (used by ks_pg_epi())">ks_pg_epi_rephasers()</a> separately instead of the single call to <a class="el" href="_k_s_foundation_8h.html#a804f4f4b870338386e1dea3a877f5bd2" title="Places out a KS_EPI object (EPI train including dephaser and rephaser gradients)">ks_pg_epi()</a>. This allows the dephasing and rephasing gradients to be detached from the core EPI readout part</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">epi</td><td>Pointer to a <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> sequence object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">loc</td><td><a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> struct to specify when to place the core part of the <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ctrl</td><td>Pointer to the <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> struct corresponding to the sequence module for this <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;                                                                        {</div><div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;  <span class="keywordtype">int</span> readaxis, blipaxis;</div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;  <a class="code" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> readloc, bliploc;</div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;</div><div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;  <span class="keywordflow">if</span> (!epi || !epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>) { <span class="keywordflow">return</span> FAILURE; }</div><div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;</div><div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;  <span class="comment">/* loc.ampscale may only be +1 or -1 and will control the read polarity.&lt;/</span></div><div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;<span class="comment">     The blip polarity is controlled in run time with ks_scan_epi_shotcontrol() */</span></div><div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> != 1.0 &amp;&amp; loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> != -1.0) {</div><div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_epi_echo: loc.ampscale must be +1 or -1 (controls read polarity)&quot;</span>);</div><div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;  }</div><div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;</div><div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;  loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> = RUP_GRD(loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>);</div><div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;</div><div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;  readloc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> = loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>;</div><div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;</div><div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;  <span class="keywordflow">switch</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>) {</div><div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a6016c24e63f250c7e49d537c9b01dea1">KS_FREQX_PHASEY</a>:</div><div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;    readaxis = XGRAD; blipaxis = YGRAD; <span class="keywordflow">break</span>;</div><div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a9bc0b0996e2ac9c6a131209ae4c88629">KS_FREQY_PHASEX</a>:</div><div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;    readaxis = YGRAD; blipaxis = XGRAD; <span class="keywordflow">break</span>;</div><div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ae0b83b9295764e027abbf88b95b09879">KS_FREQX_PHASEZ</a>:</div><div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;    readaxis = XGRAD; blipaxis = ZGRAD; <span class="keywordflow">break</span>;</div><div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ae2467923eda691b22f68ca96bd7e1c1f">KS_FREQZ_PHASEX</a>:</div><div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;    readaxis = ZGRAD; blipaxis = XGRAD; <span class="keywordflow">break</span>;</div><div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8afa622a33dd2854dfe97a4056ecec5b67">KS_FREQY_PHASEZ</a>:</div><div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;    readaxis = YGRAD; blipaxis = ZGRAD; <span class="keywordflow">break</span>;</div><div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ad53040a098477496911fa2b1850a2d93">KS_FREQZ_PHASEY</a>:</div><div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;    readaxis = ZGRAD; blipaxis = YGRAD; <span class="keywordflow">break</span>;</div><div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;  <span class="keywordflow">default</span>:</div><div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;    <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_epi_echo: field &#39;board&#39; in 2nd arg is not valid: %d&quot;</span>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>);</div><div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;  }</div><div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;</div><div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;  <span class="keywordflow">if</span> (fabs(loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a>) != 1.0) {</div><div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_epi_echo: field &#39;ampscale&#39; in 2nd arg must be +1 or -1 (controls read lobe polarity)&quot;</span>);</div><div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;  }</div><div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;</div><div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;</div><div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a>; i++) {</div><div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;</div><div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;    <span class="comment">/* read trapezoid */</span></div><div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;    readloc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> = readaxis;</div><div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;    readloc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> = (float) (i % 2) ? -loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> : loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a>; <span class="comment">/* +1 or -1 */</span></div><div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#a9310a853d09f6db581a771a9b274f01d">ks_pg_readtrap</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>, readloc, ctrl) == FAILURE)</div><div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;      <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;</div><div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;    <span class="comment">/* phase encoding blip */</span></div><div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;    <span class="keywordflow">if</span> (i &lt; epi-&gt;etl - 1) {</div><div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;      <span class="comment">/* etl-1, since no blip after the last read lobe */</span></div><div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;      bliploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> = blipaxis;</div><div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;      bliploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> = RUP_GRD(readloc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> + epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> - epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#aaa0021ab8174eb7806de89d599769a9b">blip</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> / 2 + epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a035bb76f8cc944eff7afd9333c2688e3">read_spacing</a> / 2);</div><div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;      bliploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> = 1.0;</div><div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#ab3341eea000c35a438dfeb3cfc1da103">ks_pg_trap</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#aaa0021ab8174eb7806de89d599769a9b">blip</a>, bliploc, ctrl) == FAILURE)</div><div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;        <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;    }</div><div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;</div><div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;    <span class="comment">/* read_spacing is additional gap between lobes (normally 0) */</span></div><div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;    readloc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> += RUP_GRD(epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> + epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a035bb76f8cc944eff7afd9333c2688e3">read_spacing</a>);</div><div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;</div><div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;  } <span class="comment">/* etl */</span></div><div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;</div><div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;</div><div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;</div><div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;} <span class="comment">/* ks_pg_epi_echo */</span></div><div class="ttc" id="struct_k_s___e_p_i_html_aaa0021ab8174eb7806de89d599769a9b"><div class="ttname"><a href="struct_k_s___e_p_i.html#aaa0021ab8174eb7806de89d599769a9b">KS_EPI::blip</a></div><div class="ttdeci">KS_TRAP blip</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1687</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8a6016c24e63f250c7e49d537c9b01dea1"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a6016c24e63f250c7e49d537c9b01dea1">KS_FREQX_PHASEY</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a1910d262855b71da353ed0d07a6c7823"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">KS_SEQLOC::pos</a></div><div class="ttdeci">int pos</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:242</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8ae0b83b9295764e027abbf88b95b09879"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ae0b83b9295764e027abbf88b95b09879">KS_FREQX_PHASEZ</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a2e3f5254967cadb9a41167c6fbf6743e"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">KS_SEQLOC::board</a></div><div class="ttdeci">int board</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:241</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8ad53040a098477496911fa2b1850a2d93"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ad53040a098477496911fa2b1850a2d93">KS_FREQZ_PHASEY</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">KS_READTRAP::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1435</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a606fbf556e8a297aa1f68b098f6ac2a2"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">KS_SEQLOC::ampscale</a></div><div class="ttdeci">float ampscale</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:243</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8ae2467923eda691b22f68ca96bd7e1c1f"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8ae2467923eda691b22f68ca96bd7e1c1f">KS_FREQZ_PHASEX</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a7582325a159d8ec89a4a4ba0fb89e9a9"><div class="ttname"><a href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">KS_EPI::etl</a></div><div class="ttdeci">int etl</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1690</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a03d42c44e323f3203fe5beabcefa47a5"><div class="ttname"><a href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">KS_EPI::read</a></div><div class="ttdeci">KS_READTRAP read</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1685</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8a9bc0b0996e2ac9c6a131209ae4c88629"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8a9bc0b0996e2ac9c6a131209ae4c88629">KS_FREQY_PHASEX</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a></div><div class="ttdoc">typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:240</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">KS_TRAP::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:432</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5a6c30061dd7a6d943e51c3697727ba8afa622a33dd2854dfe97a4056ecec5b67"><div class="ttname"><a href="_k_s_foundation_8h.html#a5a6c30061dd7a6d943e51c3697727ba8afa622a33dd2854dfe97a4056ecec5b67">KS_FREQY_PHASEZ</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1738</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a035bb76f8cc944eff7afd9333c2688e3"><div class="ttname"><a href="struct_k_s___e_p_i.html#a035bb76f8cc944eff7afd9333c2688e3">KS_EPI::read_spacing</a></div><div class="ttdeci">int read_spacing</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1691</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_TRAP::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:437</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a9310a853d09f6db581a771a9b274f01d"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a9310a853d09f6db581a771a9b274f01d">ks_pg_readtrap</a></div><div class="ttdeci">STATUS ks_pg_readtrap(KS_READTRAP *readtrap, KS_SEQLOC loc, KS_SEQ_CONTROL *ctrl)</div><div class="ttdoc">Places a KS_READTRAP sequence object on a board at some position in the pulse sequence</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1529</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_ab3341eea000c35a438dfeb3cfc1da103"><div class="ttname"><a href="_k_s_foundation__common_8c.html#ab3341eea000c35a438dfeb3cfc1da103">ks_pg_trap</a></div><div class="ttdeci">STATUS ks_pg_trap(KS_TRAP *trap, KS_SEQLOC loc, KS_SEQ_CONTROL *ctrl)</div><div class="ttdoc">Places a KS_TRAP sequence object on a board at some position in the pulse sequence</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1212</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a804f4f4b870338386e1dea3a877f5bd2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a804f4f4b870338386e1dea3a877f5bd2">&#9670;&nbsp;</a></span>ks_pg_epi()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_pg_epi </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *&#160;</td>
          <td class="paramname"><em>epi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a>&#160;</td>
          <td class="paramname"><em>loc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>ctrl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Places out a <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> object (EPI train including dephaser and rephaser gradients)</h4>
</p>
<p>This function should be called in the <code>@pg</code> section to place out a <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> sequence object that creates an EPI readout including dephaser and rephaser gradients. The moments of all trapezoids in the <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> object sum to zero on the two axes the <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> object is placed on. The <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> object is to be placed on two out of three gradients, why special values for the field <code>loc.board</code> must be used. The value should state which logical board (X,Y or Z) that should be used for the readout lobes (FREQ) and which logical board (X, Y or Z) that should be used for the blips (PHASE). One example is KS_FREQX_PHASEY, which will put the EPI readout lobes on XGRAD and the phase encoding blips on YGRAD</p>
<p>The same <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> object can be placed out 16 times per sequence. This limitation is due to the hard limitation on the number of echoes (i.e. different k-spaces per image plane and image volume) that can be acquired per scan. Each time an instance of the <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> object is placed out using <a class="el" href="_k_s_foundation_8h.html#a804f4f4b870338386e1dea3a877f5bd2" title="Places out a KS_EPI object (EPI train including dephaser and rephaser gradients)">ks_pg_epi()</a>, the second argument (the <a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> struct) should be modified:</p><ul>
<li><code>.board</code>: Choose between <code>KS_FREQX_PHASEY</code>, <code>KS_FREQY_PHASEX</code>, <code>KS_FREQX_PHASEZ</code>, <code>KS_FREQZ_PHASEX</code>, <code>KS_FREQY_PHASEZ</code>, <code>KS_FREQZ_PHASEY</code></li>
<li><code>.pos</code>: Absolute time in [us] of the start of the first dephaser gradient</li>
<li><code>.ampscale</code>: For <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> objects, valid values are only +1.0 and -1.0, and this will control the polarity of the first readout gradient. This is rarely needed, and 1.0 should be the standard choice as this does only affect gradient delays and Nyquist ghosting, not the geometric distortion direction.</li>
</ul>
<p>The <em>sign</em> of the EPI blips will control the direction of the geometric distortions, and this is <em>not</em> done via <code>.ampscale</code> but in run-time using <a class="el" href="_k_s_foundation_8h.html#a0d83cf730d82612a87abc0f024bea336" title="Changes the gradient state of a KS_EPI object for the given slice information">ks_scan_epi_shotcontrol()</a></p>
<p>For advanced usage of <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a>, it is possible to call ks_pg_epi_dephaser(), <a class="el" href="_k_s_foundation_8h.html#a0d7fe8d68dfb536eb3e903b1ab58e615" title="Places out the core part a KS_EPI object (used by ks_pg_epi())">ks_pg_epi_echo()</a> and <a class="el" href="_k_s_foundation_8h.html#aeaa0bf154295359cf8e84cedfbfdbe8b" title="Places out the rephasing gradients of a KS_EPI object (used by ks_pg_epi())">ks_pg_epi_rephasers()</a> separately instead of the single call to <a class="el" href="_k_s_foundation_8h.html#a804f4f4b870338386e1dea3a877f5bd2" title="Places out a KS_EPI object (EPI train including dephaser and rephaser gradients)">ks_pg_epi()</a>. This allows the dephasing and rephasing gradients to be detached from the core EPI readout part</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">epi</td><td>Pointer to a <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> sequence object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">loc</td><td><a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> struct to specify when to place the core part of the <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ctrl</td><td>Pointer to the <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> struct corresponding to the sequence module for this <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;                                                                   {</div><div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;  <a class="code" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> tmploc = loc;</div><div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;</div><div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;  <span class="comment">/* loc.ampscale may only be +1 or -1 and will control the read polarity.</span></div><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;<span class="comment">    The blip polarity is controlled in run time with ks_scan_epi_shotcontrol() */</span></div><div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;  <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> != 1.0 &amp;&amp; loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> != -1.0) {</div><div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a>(<span class="stringliteral">&quot;ks_pg_epi: loc.ampscale must be +1 or -1 (controls read polarity)&quot;</span>);</div><div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;  }</div><div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;</div><div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#a5f4f5dedf466061d2d764c1a11e2b06c">ks_pg_epi_dephasers</a>(epi, tmploc, ctrl) == FAILURE)</div><div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;</div><div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;  tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> += IMax(3, epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#abc81c5867684b6e31b65459ec9431269">readphaser</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>, epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>, epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>);</div><div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;</div><div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#a57a2d3f6e79ef085c2918652d22a3296">ks_pg_epi_echo</a>(epi, tmploc, ctrl) == FAILURE) <span class="comment">/* main epi train (w/o DE/REphasers) */</span></div><div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;</div><div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;  tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> += epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> * epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a>;</div><div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#a14fed222bd2a857b8e1514f2e8e958c8">ks_pg_epi_rephasers</a>(epi, tmploc, ctrl) == FAILURE)</div><div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;</div><div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;} <span class="comment">/* ks_pg_epi */</span></div><div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">KS_PHASER::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1525</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a1910d262855b71da353ed0d07a6c7823"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">KS_SEQLOC::pos</a></div><div class="ttdeci">int pos</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:242</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a57a2d3f6e79ef085c2918652d22a3296"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a57a2d3f6e79ef085c2918652d22a3296">ks_pg_epi_echo</a></div><div class="ttdeci">STATUS ks_pg_epi_echo(KS_EPI *epi, KS_SEQLOC loc, KS_SEQ_CONTROL *ctrl)</div><div class="ttdoc">Places out the core part a KS_EPI object (used by ks_pg_epi())</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2384</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a22cd0313e5ffabe8393f77745dba8d52"><div class="ttname"><a href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">KS_EPI::blipphaser</a></div><div class="ttdeci">KS_PHASER blipphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1688</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_abf203f668f25e2c05338fddeb1bb1434"><div class="ttname"><a href="_k_s_foundation__common_8c.html#abf203f668f25e2c05338fddeb1bb1434">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:49</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_ad76a5ac226f0d25f70349ef83b5bc38a"><div class="ttname"><a href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">KS_EPI::zphaser</a></div><div class="ttdeci">KS_PHASER zphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1689</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">KS_READTRAP::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1435</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a606fbf556e8a297aa1f68b098f6ac2a2"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">KS_SEQLOC::ampscale</a></div><div class="ttdeci">float ampscale</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:243</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a7582325a159d8ec89a4a4ba0fb89e9a9"><div class="ttname"><a href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">KS_EPI::etl</a></div><div class="ttdeci">int etl</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1690</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a03d42c44e323f3203fe5beabcefa47a5"><div class="ttname"><a href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">KS_EPI::read</a></div><div class="ttdeci">KS_READTRAP read</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1685</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a5f4f5dedf466061d2d764c1a11e2b06c"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a5f4f5dedf466061d2d764c1a11e2b06c">ks_pg_epi_dephasers</a></div><div class="ttdeci">STATUS ks_pg_epi_dephasers(KS_EPI *epi, KS_SEQLOC loc, KS_SEQ_CONTROL *ctrl)</div><div class="ttdoc">Places out the dephasing gradients of a KS_EPI object (used by ks_pg_epi())</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2247</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a></div><div class="ttdoc">typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:240</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_abc81c5867684b6e31b65459ec9431269"><div class="ttname"><a href="struct_k_s___e_p_i.html#abc81c5867684b6e31b65459ec9431269">KS_EPI::readphaser</a></div><div class="ttdeci">KS_TRAP readphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1686</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_TRAP::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:437</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a14fed222bd2a857b8e1514f2e8e958c8"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a14fed222bd2a857b8e1514f2e8e958c8">ks_pg_epi_rephasers</a></div><div class="ttdeci">STATUS ks_pg_epi_rephasers(KS_EPI *epi, KS_SEQLOC loc, KS_SEQ_CONTROL *ctrl)</div><div class="ttdoc">Places out the rephasing gradients of a KS_EPI object (used by ks_pg_epi())</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2316</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7a01a25fab5445b8ba0d31def1d8eb22"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7a01a25fab5445b8ba0d31def1d8eb22">&#9670;&nbsp;</a></span>ks_mat4_zero()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_mat4_zero </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a>&#160;</td>
          <td class="paramname"><em>m</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Makes a 4x4 zero matrix</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">m</td><td>Matrix (KS_MAT4x4) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;                               {</div><div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; 16; i++) {</div><div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;    m[i] = 0.0;</div><div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;  }</div><div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a3cf10f4e08ef58cf5122ed6bbef18cd8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3cf10f4e08ef58cf5122ed6bbef18cd8">&#9670;&nbsp;</a></span>ks_mat4_identity()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_mat4_identity </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a>&#160;</td>
          <td class="paramname"><em>m</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Creates a 4x4 identity matrix</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">m</td><td>Matrix (KS_MAT4x4) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;                                   {</div><div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#a7a01a25fab5445b8ba0d31def1d8eb22">ks_mat4_zero</a>(m);</div><div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; 4; i++) {</div><div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;    m[i + (i * 4)] = 1.0;</div><div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;  }</div><div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a7a01a25fab5445b8ba0d31def1d8eb22"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a7a01a25fab5445b8ba0d31def1d8eb22">ks_mat4_zero</a></div><div class="ttdeci">void ks_mat4_zero(KS_MAT4x4 m)</div><div class="ttdoc">Makes a 4x4 zero matrix</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2628</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af4ff614f0e15263516162ae891a85e3b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af4ff614f0e15263516162ae891a85e3b">&#9670;&nbsp;</a></span>ks_mat4_print()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_mat4_print </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a>&#160;</td>
          <td class="paramname"><em>m</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Prints a 4x4 matrix to stdout</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">m</td><td>Matrix (KS_MAT4x4) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;                                      {</div><div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; 4; i++) {</div><div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;    printf(<span class="stringliteral">&quot;| %0.4f %0.4f %0.4f %0.4f |\n&quot;</span>, m[i], m[i + 4], m[i + 8], m[i + 12]);</div><div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;  }</div><div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;  fflush(stdout);</div><div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a7860cb28ef3d14b565548f0cf546ef9b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7860cb28ef3d14b565548f0cf546ef9b">&#9670;&nbsp;</a></span>ks_mat4_multiply()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_mat4_multiply </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a>&#160;</td>
          <td class="paramname"><em>lhs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a>&#160;</td>
          <td class="paramname"><em>rhs_left</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a>&#160;</td>
          <td class="paramname"><em>rhs_right</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Multiplication of two 4x4 matrices</h4>
</p>
<p>Matrix product: [rhs_left] * [rhs_right]</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">lhs</td><td>Matrix product (KS_MAT4x4) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rhs_left</td><td>Left matrix (KS_MAT4x4) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rhs_right</td><td>Right matrix (KS_MAT4x4) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;                                                                                          {</div><div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;</div><div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;  <span class="comment">/* Define local variables */</span></div><div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;  <span class="keywordtype">int</span> m, n, k;</div><div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;  <span class="keywordtype">int</span> msize = 4;</div><div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a> Mtmp;</div><div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;  <span class="keywordtype">double</span> *ptr;</div><div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;</div><div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;  <span class="keywordflow">if</span> (lhs == rhs_left || lhs == rhs_right) { <span class="comment">/* Check if output is equal to any input */</span></div><div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;    ptr = Mtmp;</div><div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;    ptr = lhs;</div><div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;  }</div><div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;  <span class="keywordflow">for</span> (k = 0; k &lt; (msize * msize); k++) { <span class="comment">/* Zero left-hand side*/</span></div><div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;    ptr[k] = 0.0;</div><div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;  }</div><div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;</div><div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;  <span class="comment">/* Multiply the matrices*/</span></div><div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;  <span class="keywordflow">for</span> (n = 0; n &lt; msize; n++) {</div><div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;    <span class="keywordflow">for</span> (m = 0; m &lt; msize; m++) {</div><div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;      <span class="keywordflow">for</span> (k = 0; k &lt; msize; k++) {</div><div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;        ptr[m + (n * msize)] += rhs_left[m + (k * msize)] * rhs_right[k + (n * msize)];</div><div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;      }</div><div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;    }</div><div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;  }</div><div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;</div><div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;  <span class="keywordflow">if</span> (lhs == rhs_left || lhs == rhs_right ) { <span class="comment">/* Write back (if needed) */</span></div><div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;    <span class="keywordflow">for</span> (k = 0; k &lt; (msize * msize); k++) {</div><div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;      lhs[k] = ptr[k];</div><div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;    }</div><div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;  }</div><div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_a7b8e8b52358de55dd1fb64ef924b2f48"><div class="ttname"><a href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a></div><div class="ttdeci">double KS_MAT4x4[16]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:182</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa73a59f910febec479331b756b4e0b0b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa73a59f910febec479331b756b4e0b0b">&#9670;&nbsp;</a></span>ks_mat4_invert()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_mat4_invert </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a>&#160;</td>
          <td class="paramname"><em>lhs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a>&#160;</td>
          <td class="paramname"><em>rhs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Inversion of a 4x4 matrix</h4>
</p>
<p>4x4 matrix inversion (<a href="http://download.intel.com/design/PentiumIII/sml/24504301.pdf">http://download.intel.com/design/PentiumIII/sml/24504301.pdf</a></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">lhs</td><td>Inverted matrix (KS_MAT4x4) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rhs</td><td>Matrix to be inverted (KS_MAT4x4) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;                                                        {</div><div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;  <span class="keywordtype">double</span> tmp[12]; <span class="comment">/* temp array for pairs */</span></div><div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;  <span class="keywordtype">double</span> src[16]; <span class="comment">/* array of transpose source rhsrix */</span></div><div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;  <span class="keywordtype">double</span> det; <span class="comment">/* determinant */</span></div><div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;  <span class="keywordtype">int</span> i, j;</div><div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;</div><div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;  <span class="comment">/* transpose rhsrix */</span></div><div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; 4; i++) {</div><div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;    src[i] = rhs[i * 4];</div><div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;    src[i + 4] = rhs[i * 4 + 1];</div><div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;    src[i + 8] = rhs[i * 4 + 2];</div><div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;    src[i + 12] = rhs[i * 4 + 3];</div><div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;  }</div><div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;</div><div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;  <span class="comment">/* calculate pairs for first 8 elements (cofactors) */</span></div><div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;  tmp[0] = src[10] * src[15];</div><div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;  tmp[1] = src[11] * src[14];</div><div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;  tmp[2] = src[9] * src[15];</div><div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;  tmp[3] = src[11] * src[13];</div><div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;  tmp[4] = src[9] * src[14];</div><div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;  tmp[5] = src[10] * src[13];</div><div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;  tmp[6] = src[8] * src[15];</div><div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;  tmp[7] = src[11] * src[12];</div><div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;  tmp[8] = src[8] * src[14];</div><div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;  tmp[9] = src[10] * src[12];</div><div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;  tmp[10] = src[8] * src[13];</div><div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;  tmp[11] = src[9] * src[12];</div><div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;</div><div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;  <span class="comment">/* calculate first 8 elements (cofactors) */</span></div><div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;  lhs[0] = tmp[0] * src[5] + tmp[3] * src[6] + tmp[4] * src[7];</div><div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;  lhs[0] -= tmp[1] * src[5] + tmp[2] * src[6] + tmp[5] * src[7];</div><div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;  lhs[1] = tmp[1] * src[4] + tmp[6] * src[6] + tmp[9] * src[7];</div><div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;  lhs[1] -= tmp[0] * src[4] + tmp[7] * src[6] + tmp[8] * src[7];</div><div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;  lhs[2] = tmp[2] * src[4] + tmp[7] * src[5] + tmp[10] * src[7];</div><div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;  lhs[2] -= tmp[3] * src[4] + tmp[6] * src[5] + tmp[11] * src[7];</div><div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;  lhs[3] = tmp[5] * src[4] + tmp[8] * src[5] + tmp[11] * src[6];</div><div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;  lhs[3] -= tmp[4] * src[4] + tmp[9] * src[5] + tmp[10] * src[6];</div><div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;  lhs[4] = tmp[1] * src[1] + tmp[2] * src[2] + tmp[5] * src[3];</div><div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;  lhs[4] -= tmp[0] * src[1] + tmp[3] * src[2] + tmp[4] * src[3];</div><div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;  lhs[5] = tmp[0] * src[0] + tmp[7] * src[2] + tmp[8] * src[3];</div><div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;  lhs[5] -= tmp[1] * src[0] + tmp[6] * src[2] + tmp[9] * src[3];</div><div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;  lhs[6] = tmp[3] * src[0] + tmp[6] * src[1] + tmp[11] * src[3];</div><div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;  lhs[6] -= tmp[2] * src[0] + tmp[7] * src[1] + tmp[10] * src[3];</div><div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;  lhs[7] = tmp[4] * src[0] + tmp[9] * src[1] + tmp[10] * src[2];</div><div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;  lhs[7] -= tmp[5] * src[0] + tmp[8] * src[1] + tmp[11] * src[2];</div><div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;</div><div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;  <span class="comment">/* calculate pairs for second 8 elements (cofactors) */</span></div><div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;  tmp[0] = src[2] * src[7];</div><div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;  tmp[1] = src[3] * src[6];</div><div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;  tmp[2] = src[1] * src[7];</div><div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;  tmp[3] = src[3] * src[5];</div><div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;  tmp[4] = src[1] * src[6];</div><div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;  tmp[5] = src[2] * src[5];</div><div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;  tmp[6] = src[0] * src[7];</div><div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;  tmp[7] = src[3] * src[4];</div><div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;  tmp[8] = src[0] * src[6];</div><div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;  tmp[9] = src[2] * src[4];</div><div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;  tmp[10] = src[0] * src[5];</div><div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;  tmp[11] = src[1] * src[4];</div><div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;</div><div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;  <span class="comment">/* calculate second 8 elements (cofactors) */</span></div><div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;  lhs[8] = tmp[0] * src[13] + tmp[3] * src[14] + tmp[4] * src[15];</div><div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;  lhs[8] -= tmp[1] * src[13] + tmp[2] * src[14] + tmp[5] * src[15];</div><div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;  lhs[9] = tmp[1] * src[12] + tmp[6] * src[14] + tmp[9] * src[15];</div><div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;  lhs[9] -= tmp[0] * src[12] + tmp[7] * src[14] + tmp[8] * src[15];</div><div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;  lhs[10] = tmp[2] * src[12] + tmp[7] * src[13] + tmp[10] * src[15];</div><div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;  lhs[10] -= tmp[3] * src[12] + tmp[6] * src[13] + tmp[11] * src[15];</div><div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;  lhs[11] = tmp[5] * src[12] + tmp[8] * src[13] + tmp[11] * src[14];</div><div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;  lhs[11] -= tmp[4] * src[12] + tmp[9] * src[13] + tmp[10] * src[14];</div><div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;  lhs[12] = tmp[2] * src[10] + tmp[5] * src[11] + tmp[1] * src[9];</div><div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;  lhs[12] -= tmp[4] * src[11] + tmp[0] * src[9] + tmp[3] * src[10];</div><div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;  lhs[13] = tmp[8] * src[11] + tmp[0] * src[8] + tmp[7] * src[10];</div><div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;  lhs[13] -= tmp[6] * src[10] + tmp[9] * src[11] + tmp[1] * src[8];</div><div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;  lhs[14] = tmp[6] * src[9] + tmp[11] * src[11] + tmp[3] * src[8];</div><div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;  lhs[14] -= tmp[10] * src[11] + tmp[2] * src[8] + tmp[7] * src[9];</div><div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;  lhs[15] = tmp[10] * src[10] + tmp[4] * src[8] + tmp[9] * src[9];</div><div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;  lhs[15] -= tmp[8] * src[9] + tmp[11] * src[10] + tmp[5] * src[8];</div><div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;</div><div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;  <span class="comment">/* calculate determinant */</span></div><div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;  det = src[0] * lhs[0] + src[1] * lhs[1] + src[2] * lhs[2] + src[3] * lhs[3];</div><div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;</div><div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;  <span class="comment">/* calculate rhsrix inverse */</span></div><div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;  det = 1 / det;</div><div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;  <span class="keywordflow">for</span> (j = 0; j &lt; 16; j++)</div><div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;    lhs[j] *= det;</div><div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a72637d90aca1ebbbbc0fa6b9fa905070"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a72637d90aca1ebbbbc0fa6b9fa905070">&#9670;&nbsp;</a></span>ks_mat4_setgeometry()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_mat4_setgeometry </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a>&#160;</td>
          <td class="paramname"><em>lhs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>z</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>xr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>yr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>zr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Set geometry for KS_MAT4x4</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">lhs</td><td>set matrix (KS_MAT4x4) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">x</td><td>displacement (mm) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">y</td><td>displacement (mm) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">z</td><td>displacement (mm) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">xr</td><td>rotation (deg) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">yr</td><td>rotation (deg) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">zr</td><td>rotation (deg) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;                                                                                                             {</div><div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;  <span class="keywordtype">double</span> cosa;</div><div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;  <span class="keywordtype">double</span> sina;</div><div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;  <span class="keywordtype">double</span> cosb;</div><div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;  <span class="keywordtype">double</span> sinb;</div><div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;  <span class="keywordtype">double</span> cosg;</div><div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;  <span class="keywordtype">double</span> sing;</div><div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;</div><div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#a3cf10f4e08ef58cf5122ed6bbef18cd8">ks_mat4_identity</a>(lhs);</div><div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;</div><div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;  xr *= PI / 180.0;</div><div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;  yr *= PI / 180.0;</div><div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;  zr *= PI / 180.0;</div><div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;</div><div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;<span class="comment">  Rotation matrices for positive counterclockwise angles about the positive</span></div><div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;<span class="comment">  coordinate axis for a right handed coordinate system:</span></div><div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;<span class="comment">                | 1      0       0    |</span></div><div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;<span class="comment">    R1(xr) =    | 0  cos(xr)  -sin(xr)|</span></div><div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;<span class="comment">                | 0  sin(xr)   cos(xr)|</span></div><div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;<span class="comment">                | cos(yr)   0   sin(yr) |</span></div><div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;<span class="comment">    R2(yr)  =   | 0         1     0     |</span></div><div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;<span class="comment">                | -sin(yr)  0   cos(yr) |</span></div><div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;<span class="comment">                | cos(zr) -sin(zr)  0 |</span></div><div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;<span class="comment">    R3(zr) =    | sin(zr)  cos(zr)  0 |</span></div><div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;<span class="comment">                |   0        0      1 |</span></div><div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;</div><div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;  cosa = cos(xr);</div><div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;  sina = sin(xr);</div><div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;  cosb = cos(yr);</div><div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;  sinb = sin(yr);</div><div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;  cosg = cos(zr);</div><div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;  sing = sin(zr);</div><div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;</div><div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;  <span class="comment">/* Rotations: R_z * R_y * R_x */</span></div><div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;  lhs[ 0] =  cosb * cosg;</div><div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;  lhs[ 1] =  sina * sinb * cosg - cosa * sing;</div><div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;  lhs[ 2] =  cosa * sinb * cosg + sina * sing;</div><div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;  lhs[ 4] =  cosb * sing;</div><div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;  lhs[ 5] =  sina * sinb * sing + cosa * cosg;</div><div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;  lhs[ 6] =  cosa * sinb * sing - sina * cosg;</div><div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;  lhs[ 8] =  -sinb;</div><div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;  lhs[ 9] =  sina * cosb;</div><div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;  lhs[10] =  cosa * cosb;</div><div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;</div><div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;  <span class="comment">/* Translations */</span></div><div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;  lhs[ 3] = x;</div><div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;  lhs[ 7] = y;</div><div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;  lhs[11] = z;</div><div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a3cf10f4e08ef58cf5122ed6bbef18cd8"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a3cf10f4e08ef58cf5122ed6bbef18cd8">ks_mat4_identity</a></div><div class="ttdeci">void ks_mat4_identity(KS_MAT4x4 m)</div><div class="ttdoc">Creates a 4x4 identity matrix</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2636</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a52b5ac8e52a9813764edfb25fc43842e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a52b5ac8e52a9813764edfb25fc43842e">&#9670;&nbsp;</a></span>ks_mat4_setrotation1axis()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_mat4_setrotation1axis </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a>&#160;</td>
          <td class="paramname"><em>rhs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>rot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&#160;</td>
          <td class="paramname"><em>axis</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Create a new 4x4 matrix with a rotation around a single axis</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">rhs</td><td>Rotation matrix (KS_MAT4x4) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rot</td><td>Amount of rotation around <code>axis</code> [degrees] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">axis</td><td>One of (include the quotes): 'x', 'y', 'z' </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;                                                                   {</div><div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#a3cf10f4e08ef58cf5122ed6bbef18cd8">ks_mat4_identity</a>(rhs);</div><div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;</div><div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;  rot *= PI / 180.0; <span class="comment">/* deg-&gt;rad */</span></div><div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;</div><div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;  <span class="keywordflow">switch</span> (axis) {</div><div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;  <span class="keywordflow">case</span> <span class="charliteral">&#39;x&#39;</span>:</div><div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;    rhs[5]  =  cos(rot);</div><div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;    rhs[6]  =  sin(rot);</div><div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;    rhs[9]  = -sin(rot);</div><div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;    rhs[10] =  cos(rot);</div><div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;  <span class="keywordflow">case</span> <span class="charliteral">&#39;y&#39;</span>:</div><div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;    rhs[0]  =  cos(rot);</div><div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;    rhs[2]  =  sin(rot);</div><div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;    rhs[8]  = -sin(rot);</div><div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;    rhs[10] =  cos(rot);</div><div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;  <span class="keywordflow">case</span> <span class="charliteral">&#39;z&#39;</span>:</div><div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;    rhs[0]  =  cos(rot);</div><div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;    rhs[1]  =  sin(rot);</div><div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;    rhs[4]  = -sin(rot);</div><div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;    rhs[5]  =  cos(rot);</div><div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;  }</div><div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;</div><div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a3cf10f4e08ef58cf5122ed6bbef18cd8"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a3cf10f4e08ef58cf5122ed6bbef18cd8">ks_mat4_identity</a></div><div class="ttdeci">void ks_mat4_identity(KS_MAT4x4 m)</div><div class="ttdoc">Creates a 4x4 identity matrix</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2636</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ace371e00b197f1e2810b8d113b367266"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ace371e00b197f1e2810b8d113b367266">&#9670;&nbsp;</a></span>ks_mat4_extractrotation()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_mat4_extractrotation </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a>&#160;</td>
          <td class="paramname"><em>R</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a>&#160;</td>
          <td class="paramname"><em>M</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Extract a 3x3 rotation matrix from a 4x4 transformation matrix</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">R</td><td>3x3 rotation matrix (KS_MAT3x3), row major </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">M</td><td>Transformation matrix (KS_MAT4x4), row major </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;                                                             {</div><div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;  <span class="keywordtype">int</span> i, j;</div><div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; 3; ++i) {</div><div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;    <span class="keywordflow">for</span> (j = 0; j &lt; 3; ++j) {</div><div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;      R[3 * i + j] = M[4 * i + j];</div><div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;    }</div><div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;  }</div><div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a5367cf93c8126b5e1ebe7af1455bd12f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5367cf93c8126b5e1ebe7af1455bd12f">&#9670;&nbsp;</a></span>ks_mat4_extracttranslation()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_mat4_extracttranslation </td>
          <td>(</td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>T</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a>&#160;</td>
          <td class="paramname"><em>M</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Extract a 3 element array with translations from a 4x4 transformation matrix</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">T</td><td>Float array with 3 elements (must be allocated) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">M</td><td>Transformation matrix (KS_MAT4x4), row major </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;                                                              {</div><div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; 3; ++i) {</div><div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;    T[i] = M[4 * i + 3];</div><div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;  }</div><div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a90b2a40a2ec0d6386acd1a882826db29"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a90b2a40a2ec0d6386acd1a882826db29">&#9670;&nbsp;</a></span>ks_mat3_identity()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_mat3_identity </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a>&#160;</td>
          <td class="paramname"><em>m</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Creates a 3x3 identity matrix</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">m</td><td>Matrix (KS_MAT3x3) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;                                   {</div><div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; 9; ++i) {</div><div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;    m[i] = 0;</div><div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;  }</div><div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;  m[0] = 1;</div><div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;  m[4] = 1;</div><div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;  m[8] = 1;</div><div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="aef9748ef561f24658a823f99823bf9f3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aef9748ef561f24658a823f99823bf9f3">&#9670;&nbsp;</a></span>ks_mat3_multiply()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_mat3_multiply </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a>&#160;</td>
          <td class="paramname"><em>lhs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a>&#160;</td>
          <td class="paramname"><em>rhs_left</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a>&#160;</td>
          <td class="paramname"><em>rhs_right</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Multiplication of two 3x3 matrices</h4>
</p>
<p>Matrix product: [rhs_left] * [rhs_right]</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">lhs</td><td>Matrix product (KS_MAT3x3) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rhs_left</td><td>Left matrix (KS_MAT3x3) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rhs_right</td><td>Right matrix (KS_MAT3x3) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;                                                                                          {</div><div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;</div><div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;  <span class="comment">/* TODO: add checks for overlapping arrays */</span></div><div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;</div><div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;  <span class="keywordtype">int</span> i, j, k;</div><div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; 3; ++i) {</div><div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;    <span class="keywordflow">for</span> (j = 0; j &lt; 3; ++j) {</div><div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;      <span class="keywordtype">double</span> acc = 0;</div><div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;      <span class="keywordflow">for</span> (k = 0; k &lt; 3; ++k) {</div><div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;        acc += rhs_left[3 * i + k] * rhs_right[3 * k + j];</div><div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;      }</div><div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;      lhs[3 * i + j] = acc;</div><div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;    }</div><div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;  }</div><div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="aa256047bba2d4ee8f8b0244323dc4d65"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa256047bba2d4ee8f8b0244323dc4d65">&#9670;&nbsp;</a></span>ks_mat3_print()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_mat3_print </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a>&#160;</td>
          <td class="paramname"><em>m</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Prints a 3x3 matrix to stdout</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">m</td><td>Matrix (KS_MAT3x3) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;                                      {</div><div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; 3; ++i) {</div><div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;    fprintf(stderr, <span class="stringliteral">&quot;|%.2f,\t%.2f\t%.2f|\n&quot;</span>, m[3 * i], m[3 * i + 1], m[3 * i + 2]);</div><div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;  }</div><div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;  fprintf(stderr, <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a028d9a1107a86d282f556e43658ada9b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a028d9a1107a86d282f556e43658ada9b">&#9670;&nbsp;</a></span>ks_mat3_apply()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_mat3_apply </td>
          <td>(</td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>w</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a>&#160;</td>
          <td class="paramname"><em>R</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double *&#160;</td>
          <td class="paramname"><em>v</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Rotate a 3x1 vector by a 3x3 rotation matrix (alibi)</h4>
</p>
<p>Apply an active (alibi) rotation &ndash; i.e w = R * v</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">w</td><td>Output vector (float array with 3 elements) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">R</td><td>Rotation matrix (KS_MAT3x3) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">v</td><td>Input vector (float array with 3 elements) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;                                                                  {</div><div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;  <span class="keywordtype">int</span> i, j;</div><div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; 3; ++i) {</div><div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;    <span class="keywordtype">double</span> acc = 0;</div><div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;    <span class="keywordflow">for</span> (j = 0; j &lt; 3; ++j) {</div><div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;      acc += R[3 * i + j] * v[j];</div><div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;    }</div><div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;    w[i] = acc;</div><div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;  }</div><div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a22ac65cbd45dee4eec9f4f2612af92a8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a22ac65cbd45dee4eec9f4f2612af92a8">&#9670;&nbsp;</a></span>ks_mat3_invapply()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_mat3_invapply </td>
          <td>(</td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>w</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a>&#160;</td>
          <td class="paramname"><em>R</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double *&#160;</td>
          <td class="paramname"><em>v</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Rotate a 3x1 vector by the inverse of 3x3 rotation matrix (alias)</h4>
</p>
<p>Apply a passive (alias) rotation &ndash; i.e w = R' * v = R^-1 * v</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">w</td><td>Output vector (float array with 3 elements) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">R</td><td>Rotation matrix (KS_MAT3x3) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">v</td><td>Input vector (float array with 3 elements) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;                                                                     {</div><div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;  <span class="keywordtype">int</span> i, j;</div><div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; 3; ++i) {</div><div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;    <span class="keywordtype">double</span> acc = 0;</div><div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;    <span class="keywordflow">for</span> (j = 0; j &lt; 3; ++j) {</div><div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;      acc += v[j] * R[3 * j + i];</div><div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;    }</div><div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;    w[i] = acc;</div><div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;  }</div><div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a1a51b640b1005f02c4475a1c5f673adb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1a51b640b1005f02c4475a1c5f673adb">&#9670;&nbsp;</a></span>ks_scan_update_slice_location()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_update_slice_location </td>
          <td>(</td>
          <td class="paramtype">SCAN_INFO *&#160;</td>
          <td class="paramname"><em>new_loc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const SCAN_INFO&#160;</td>
          <td class="paramname"><em>orig_loc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a>&#160;</td>
          <td class="paramname"><em>M_physical</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a>&#160;</td>
          <td class="paramname"><em>M_logical</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Updates a SCAN_INFO struct using physical and logical 4x4 transformation matrices</h4>
</p>
<p>Updates the slice location &ndash; e.g for motion correction (physical space) or propeller rotations (logical space)</p>
<p>M_physical and M_logical are row-major 4x4 matricies that describe rotations (R_physical, R_logical) and translations (T_physical, T_logical) of the FOV in the physical and logical coordinate systems, respectively. If R_slice and T_slice describe the position of the prescribed FOV contained in orig_loc then new_loc will describe the overall rotation R_new and translation T_new of the FOV such that:</p>
<p><code>R_new = R_physical * R_slice * R_logical</code></p>
<p><code>T_new = R_logical^-1 * (R_slice^-1 * R_physical^-1 * T_physical + T_slice + T_logical)</code></p>
<p>NOTE: All transformations are expected to be active (alibi) that denote a change of position/orientation, not passive (alias) that denote a change of coordinates system. See <a href="https://en.wikipedia.org/wiki/Active_and_passive_transformation">https://en.wikipedia.org/wiki/Active_and_passive_transformation</a></p>
<p>SCAN_INFO is defined in $ESE_TOP/psd/include/epic_geometry_types.h and the global <code>scan_info</code> variable is an array of SCAN_INFO structs holding information of the graphically prescribed slices</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">new_loc</td><td>Pointer to a SCAN_INFO struct holding the new slice information </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">orig_loc</td><td>SCAN_INFO struct holding the original slice information </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">M_physical</td><td>Transformation matrix (4x4) in the physical space </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">M_logical</td><td>Transformation matrix (4x4) in the logical (i.e. XGRAD, YGRAD, ZGRAD) space </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;                                                                                                                                        {</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a> R_m;</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a> R_l;</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a> R_ms;</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a> R_msl;</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> T_s[3] = {orig_loc.oprloc, orig_loc.opphasoff, orig_loc.optloc};</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;  <span class="keywordtype">double</span> T_m[3];</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;  <span class="keywordtype">double</span> T_l[3];</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;  <span class="keywordtype">double</span> T_msl[3];</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;  <span class="keywordtype">double</span> T_new[3];</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;  <span class="comment">/* initialize to identity matrix (will be used if NULL in 3rd or 4th arg) */</span></div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a> Mphys = <a class="code" href="_k_s_foundation_8h.html#afdbaf673741ec0d6d5ebb7ab5974338e">KS_MAT4x4_IDENTITY</a>;</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a> Mlog = <a class="code" href="_k_s_foundation_8h.html#afdbaf673741ec0d6d5ebb7ab5974338e">KS_MAT4x4_IDENTITY</a>;</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;  <span class="comment">/* copy slice rotation and translation */</span></div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a> R_s;</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; 9; i++) {</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;    R_s[i] = orig_loc.oprot[i];</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;  }</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;  <span class="comment">/* copy transformation matrices (if they are not NULL) to local matrices */</span></div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;  <span class="keywordflow">if</span> (M_physical != NULL) {</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    memcpy(Mphys, M_physical, <span class="keyword">sizeof</span>(<a class="code" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a>));</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;  }</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;  <span class="keywordflow">if</span> (M_logical != NULL) {</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    memcpy(Mlog, M_logical, <span class="keyword">sizeof</span>(<a class="code" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a>));</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;  }</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#ace371e00b197f1e2810b8d113b367266">ks_mat4_extractrotation</a>(R_m, Mphys);</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#ace371e00b197f1e2810b8d113b367266">ks_mat4_extractrotation</a>(R_l, Mlog);</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a5367cf93c8126b5e1ebe7af1455bd12f">ks_mat4_extracttranslation</a>(T_m, Mphys);</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a5367cf93c8126b5e1ebe7af1455bd12f">ks_mat4_extracttranslation</a>(T_l, Mlog);</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;  <span class="comment">/* R_ms = R_m * R_s */</span></div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#aef9748ef561f24658a823f99823bf9f3">ks_mat3_multiply</a>(R_ms, R_m, R_s);</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;  <span class="comment">/* R_ms^-1 * T_m = T_m&#39; * R_ms&#39; */</span></div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a22ac65cbd45dee4eec9f4f2612af92a8">ks_mat3_invapply</a>(T_msl, R_ms, T_m);</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; 3; ++i) {</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    T_msl[i] += T_s[i] + T_l[i];</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;  }</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a22ac65cbd45dee4eec9f4f2612af92a8">ks_mat3_invapply</a>(T_new, R_l, T_msl);</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;  new_loc-&gt;oprloc = T_new[0];</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;  new_loc-&gt;opphasoff = T_new[1];</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;  new_loc-&gt;optloc = T_new[2];</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#aef9748ef561f24658a823f99823bf9f3">ks_mat3_multiply</a>(R_msl, R_ms, R_l);</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;  <span class="keywordflow">for</span> (i=0; i&lt;9; ++i) {</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    new_loc-&gt;oprot[i] = R_msl[i];</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;  }</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;} <span class="comment">/* ks_scan_update_slice_location */</span></div><div class="ttc" id="_k_s_foundation_8h_html_aef9748ef561f24658a823f99823bf9f3"><div class="ttname"><a href="_k_s_foundation_8h.html#aef9748ef561f24658a823f99823bf9f3">ks_mat3_multiply</a></div><div class="ttdeci">void ks_mat3_multiply(KS_MAT3x3 lhs, const KS_MAT3x3 rhs_left, const KS_MAT3x3 rhs_right)</div><div class="ttdoc">Multiplication of two 3x3 matrices</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2888</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a7b8e8b52358de55dd1fb64ef924b2f48"><div class="ttname"><a href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a></div><div class="ttdeci">double KS_MAT4x4[16]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:182</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ace371e00b197f1e2810b8d113b367266"><div class="ttname"><a href="_k_s_foundation_8h.html#ace371e00b197f1e2810b8d113b367266">ks_mat4_extractrotation</a></div><div class="ttdeci">void ks_mat4_extractrotation(KS_MAT3x3 R, const KS_MAT4x4 M)</div><div class="ttdoc">Extract a 3x3 rotation matrix from a 4x4 transformation matrix</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2861</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aeecaa16a2b55b6aa37e125536b565657"><div class="ttname"><a href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a></div><div class="ttdeci">double KS_MAT3x3[9]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:181</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_afdbaf673741ec0d6d5ebb7ab5974338e"><div class="ttname"><a href="_k_s_foundation_8h.html#afdbaf673741ec0d6d5ebb7ab5974338e">KS_MAT4x4_IDENTITY</a></div><div class="ttdeci">#define KS_MAT4x4_IDENTITY</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:173</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5367cf93c8126b5e1ebe7af1455bd12f"><div class="ttname"><a href="_k_s_foundation_8h.html#a5367cf93c8126b5e1ebe7af1455bd12f">ks_mat4_extracttranslation</a></div><div class="ttdeci">void ks_mat4_extracttranslation(double *T, const KS_MAT4x4 M)</div><div class="ttdoc">Extract a 3 element array with translations from a 4x4 transformation matrix</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2870</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a22ac65cbd45dee4eec9f4f2612af92a8"><div class="ttname"><a href="_k_s_foundation_8h.html#a22ac65cbd45dee4eec9f4f2612af92a8">ks_mat3_invapply</a></div><div class="ttdeci">void ks_mat3_invapply(double *w, const KS_MAT3x3 R, const double *v)</div><div class="ttdoc">Rotate a 3x1 vector by the inverse of 3x3 rotation matrix (alias)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2923</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2fdfe2e655a76c4cd4fb1dac16d1834b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2fdfe2e655a76c4cd4fb1dac16d1834b">&#9670;&nbsp;</a></span>ks_scan_rotate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_rotate </td>
          <td>(</td>
          <td class="paramtype">SCAN_INFO&#160;</td>
          <td class="paramname"><em>slice_info</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Performs a rotation of the logical system on hardware (WARP)</h4>
</p>
<p>The field <code>.oprot</code> (9-element array) in the SCAN_INFO struct holds the rotation matrix that should be played out</p>
<p>This function performs the necessary scaling of the rotation matrix using <code>loggrd</code> and <code>phygrd</code> and then calls <code>setrotatearray()</code>, which performs the actual rotation on hardware during the next SSI time.</p>
<p>See <a class="el" href="_k_s_foundation_8h.html#a1a51b640b1005f02c4475a1c5f673adb" title="Updates a SCAN_INFO struct using physical and logical 4x4 transformation matrices">ks_scan_update_slice_location()</a> for detail on how to create new SCAN_INFO structs in run-time</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">slice_info</td><td>SCAN_INFO struct holding new slice information </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;                                          {</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;  <span class="comment">/* scale to long int rotation matrix (accounting for gradient scaling) */</span></div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;  scale(&amp;slice_info.oprot, &amp;<a class="code" href="_k_s_foundation__tgt_8c.html#a327dd261edd2ec61105487e4073cba27">rsprot</a>[0], 1, &amp;<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>, &amp;<a class="code" href="_k_s_foundation_8h.html#af51ba165cbaf874219789beaa48f2464">phygrd</a>, 0);</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;  setrotatearray(1, <a class="code" href="_k_s_foundation__tgt_8c.html#a327dd261edd2ec61105487e4073cba27">rsprot</a>[0]);</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_af51ba165cbaf874219789beaa48f2464"><div class="ttname"><a href="_k_s_foundation_8h.html#af51ba165cbaf874219789beaa48f2464">phygrd</a></div><div class="ttdeci">PHYS_GRAD phygrd</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a327dd261edd2ec61105487e4073cba27"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a327dd261edd2ec61105487e4073cba27">rsprot</a></div><div class="ttdeci">long rsprot[DATA_ACQ_MAX][9]</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a520240c3153cf9ffe25a7617b2c72149"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a520240c3153cf9ffe25a7617b2c72149">&#9670;&nbsp;</a></span>ks_scan_isirotate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_isirotate </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___i_s_i_r_o_t.html">KS_ISIROT</a> *&#160;</td>
          <td class="paramname"><em>isirot</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Performs an immediate rotation of the logical system on hardware (WARP)</h4>
</p>
<p>This function needs a psd-specific wrapper function to execute (see <a class="el" href="_k_s_foundation_8h.html#a67d0db25c6c69ee17a9b4b0ee79b7fb7" title="Places out an intersequence interrupt at a specific time in the sequence module">ks_pg_isirot()</a>) since the ISI interupt routine is calling a void function without input arguments. This psd-specific wrapper function should only contain the call to <a class="el" href="_k_s_foundation_8h.html#a520240c3153cf9ffe25a7617b2c72149" title="Performs an immediate rotation of the logical system on hardware (WARP)">ks_scan_isirotate()</a> with the psd-specific <a class="el" href="struct_k_s___i_s_i_r_o_t.html" title="Struct for in-sequence rotations using ISI vector interupts">KS_ISIROT</a> set up in <a class="el" href="ksepi_8e.html#a9229731c099971b90dbf7721bad586a9">pulsegen()</a>.</p>
<p>For N number of calls to <a class="el" href="_k_s_foundation_8h.html#a67d0db25c6c69ee17a9b4b0ee79b7fb7" title="Places out an intersequence interrupt at a specific time in the sequence module">ks_pg_isirot()</a> in the sequence module's pg-function, the field <code>isirot.numinstances</code> will be set to N, and this many ISI interrupt with a corresponding <code>isirot.isinumber</code> exist in the sequence module. Valid ISI numbers are 4-7, and one available number should be linked to one specific wrapper function using <a class="el" href="_k_s_foundation_8h.html#a1d053f6867254f3b3acfc0589e490b5f" title="Sets up a KS_ISIROT object to be used for real-time coordinate rotations">ks_eval_isirot()</a> and <a class="el" href="_k_s_foundation_8h.html#a67d0db25c6c69ee17a9b4b0ee79b7fb7" title="Places out an intersequence interrupt at a specific time in the sequence module">ks_pg_isirot()</a>.</p>
<p>In real-time, <a class="el" href="_k_s_foundation_8h.html#a520240c3153cf9ffe25a7617b2c72149" title="Performs an immediate rotation of the logical system on hardware (WARP)">ks_scan_isirotate()</a> will increment the <code>isirot.counter</code> field by 1 and restart at 0 after <code>isirot-&gt;numinstances</code>. <code>isirot.counter</code> is set to 0 in <a class="el" href="_k_s_foundation_8h.html#a67d0db25c6c69ee17a9b4b0ee79b7fb7" title="Places out an intersequence interrupt at a specific time in the sequence module">ks_pg_isirot()</a>. Based on the value of the <code>.counter</code> field, it will assign a pre-stored SCAN_INFO struct corresponding to this counter value. Again, this connection is done by <a class="el" href="_k_s_foundation_8h.html#a67d0db25c6c69ee17a9b4b0ee79b7fb7" title="Places out an intersequence interrupt at a specific time in the sequence module">ks_pg_isirot()</a>.</p>
<p><a class="el" href="_k_s_foundation_8h.html#a520240c3153cf9ffe25a7617b2c72149" title="Performs an immediate rotation of the logical system on hardware (WARP)">ks_scan_isirotate()</a> takes the current SCAN_INFO and converts it to long int, and then calls setrotateimm(..., WARP_UPDATE_ON_SSP_INT);</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">isirot</td><td>Pointer to the <a class="el" href="struct_k_s___i_s_i_r_o_t.html" title="Struct for in-sequence rotations using ISI vector interupts">KS_ISIROT</a> struct set up by <a class="el" href="_k_s_foundation_8h.html#a67d0db25c6c69ee17a9b4b0ee79b7fb7" title="Places out an intersequence interrupt at a specific time in the sequence module">ks_pg_isirot()</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;                                          {</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;  <span class="keywordflow">if</span> (isirot == NULL || isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#aa571b5a96556f71c84be339d2e9193b4">numinstances</a> &lt; 1)</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;  <span class="comment">/* wrap around after numinstances interupts */</span></div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;  isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#a617a47c70795bcff659815ad0efd2266">counter</a> = isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#a617a47c70795bcff659815ad0efd2266">counter</a> % isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#aa571b5a96556f71c84be339d2e9193b4">numinstances</a>;</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;  <span class="comment">/* scale to long int rotation matrix (accounting for gradient scaling) */</span></div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;  scale(&amp;isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#a401a138c899d31df5f63f1971febe233">scan_info</a>[isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#a617a47c70795bcff659815ad0efd2266">counter</a>++].oprot, &amp;<a class="code" href="_k_s_foundation__tgt_8c.html#a327dd261edd2ec61105487e4073cba27">rsprot</a>[0], 1, &amp;<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>, &amp;<a class="code" href="_k_s_foundation_8h.html#af51ba165cbaf874219789beaa48f2464">phygrd</a>, 0);</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;  <span class="comment">/* rotate on SSP interrupt */</span></div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;  setrotateimm(<a class="code" href="_k_s_foundation__tgt_8c.html#a327dd261edd2ec61105487e4073cba27">rsprot</a>[0], WARP_UPDATE_ON_SSP_INT);</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;}</div><div class="ttc" id="struct_k_s___i_s_i_r_o_t_html_a401a138c899d31df5f63f1971febe233"><div class="ttname"><a href="struct_k_s___i_s_i_r_o_t.html#a401a138c899d31df5f63f1971febe233">KS_ISIROT::scan_info</a></div><div class="ttdeci">SCAN_INFO * scan_info</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:324</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_af51ba165cbaf874219789beaa48f2464"><div class="ttname"><a href="_k_s_foundation_8h.html#af51ba165cbaf874219789beaa48f2464">phygrd</a></div><div class="ttdeci">PHYS_GRAD phygrd</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a327dd261edd2ec61105487e4073cba27"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a327dd261edd2ec61105487e4073cba27">rsprot</a></div><div class="ttdeci">long rsprot[DATA_ACQ_MAX][9]</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
<div class="ttc" id="struct_k_s___i_s_i_r_o_t_html_a617a47c70795bcff659815ad0efd2266"><div class="ttname"><a href="struct_k_s___i_s_i_r_o_t.html#a617a47c70795bcff659815ad0efd2266">KS_ISIROT::counter</a></div><div class="ttdeci">int counter</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:327</div></div>
<div class="ttc" id="struct_k_s___i_s_i_r_o_t_html_aa571b5a96556f71c84be339d2e9193b4"><div class="ttname"><a href="struct_k_s___i_s_i_r_o_t.html#aa571b5a96556f71c84be339d2e9193b4">KS_ISIROT::numinstances</a></div><div class="ttdeci">int numinstances</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:328</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="adee331638310d0a0ed1c726c02051e1b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adee331638310d0a0ed1c726c02051e1b">&#9670;&nbsp;</a></span>ks_pg_fse_flip_angle_taperoff()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_pg_fse_flip_angle_taperoff </td>
          <td>(</td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>flip_angles</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>etl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>flip1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>flip2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>flip3</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>target_flip</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>start_middle</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;                                                       {</div><div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;</div><div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;</div><div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;  flip_angles[0] = flip1;</div><div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;  flip_angles[1] = flip2;</div><div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;  <span class="keywordflow">for</span> (i = 2; i &lt; etl; i++) {</div><div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;    flip_angles[i] = flip3;</div><div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;  }</div><div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;</div><div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;  <span class="keywordflow">if</span> (flip3 &lt;= target_flip || etl &lt; 5) {</div><div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;    <span class="comment">/* flip3 must be larger than target_flip and etl must be larger than 4 */</span></div><div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;    <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;  }</div><div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;</div><div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;  <span class="comment">/* after half of the echo train or third pulse, ramp down flip angles to last_flip */</span></div><div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;  <span class="keywordtype">double</span> first_flip = flip3;</div><div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;  <span class="keywordtype">double</span> last_flip = target_flip;</div><div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;  <span class="keywordtype">int</span> start_pulse = start_middle ? etl/2 : 2;</div><div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;  <span class="keywordflow">for</span> (i = start_pulse; i &lt; etl; i++) {</div><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;    flip_angles[i] = first_flip + (((last_flip - first_flip)/(etl - start_pulse - 1)) * (i - start_pulse));</div><div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;  }</div><div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;</div><div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;</div><div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;} <span class="comment">/* ks_pg_fse_flip_angle_taperoff */</span></div></div><!-- fragment -->
</div>
</div>
<a id="a43efb5f9eb84e0ace408cd1a74825f3f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a43efb5f9eb84e0ace408cd1a74825f3f">&#9670;&nbsp;</a></span>ks_pg_mod_fse_rfpulse_structs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_pg_mod_fse_rfpulse_structs </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *&#160;</td>
          <td class="paramname"><em>rf1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *&#160;</td>
          <td class="paramname"><em>rf2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *&#160;</td>
          <td class="paramname"><em>rf3</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double *&#160;</td>
          <td class="paramname"><em>flip_angles</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>etl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;                                                  {</div><div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;</div><div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;  <span class="keywordtype">float</span> SAR_scale_1 = 0.0;</div><div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;  <span class="keywordtype">float</span> SAR_scale_2 = 0.0;</div><div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;  <span class="keywordtype">float</span> SAR_scale_3 = 0.0;</div><div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;</div><div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;  SAR_scale_1 = pow(flip_angles[0] / rf1-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a7ab9fec3ad0848d2dff5db7279f1a806">flip</a>, 2.0);</div><div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;  SAR_scale_2 = pow(flip_angles[1] / rf2-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a7ab9fec3ad0848d2dff5db7279f1a806">flip</a>, 2.0);</div><div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;  <span class="keywordflow">for</span> (i = 2; i &lt; etl; i++) {</div><div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;    SAR_scale_3 += pow(flip_angles[i] / rf3-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a7ab9fec3ad0848d2dff5db7279f1a806">flip</a>, 2.0);</div><div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;  }</div><div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;  SAR_scale_3 /= etl - 2;</div><div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;</div><div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;  rf1-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.effwidth *= SAR_scale_1;</div><div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;  rf1-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.max_rms_b1 *= sqrt(SAR_scale_1);</div><div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;  rf1-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.abswidth *= sqrt(SAR_scale_1);</div><div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;</div><div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;  rf2-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.effwidth *= SAR_scale_2;</div><div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;  rf2-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.max_rms_b1 *= sqrt(SAR_scale_2);</div><div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;  rf2-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.abswidth *= sqrt(SAR_scale_2);</div><div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;</div><div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;  rf3-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.effwidth *= SAR_scale_3;</div><div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;  rf3-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.max_rms_b1 *= sqrt(SAR_scale_3);</div><div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;  rf3-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.abswidth *= sqrt(SAR_scale_3);</div><div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;</div><div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;} <span class="comment">/* ks_pg_mod_fse_rfpulse_structs */</span></div><div class="ttc" id="struct_k_s___r_f_html_ae183c3e4095d1c6d14b3d59a0da97928"><div class="ttname"><a href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">KS_RF::rfpulse</a></div><div class="ttdeci">RF_PULSE rfpulse</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:797</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a7ab9fec3ad0848d2dff5db7279f1a806"><div class="ttname"><a href="struct_k_s___r_f.html#a7ab9fec3ad0848d2dff5db7279f1a806">KS_RF::flip</a></div><div class="ttdeci">float flip</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:789</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_adeab1cc34f1a7f20f41e8825d849981e"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">KS_SELRF::rf</a></div><div class="ttdeci">KS_RF rf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1334</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad4f6f11e79e686edc745fb372307da07"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad4f6f11e79e686edc745fb372307da07">&#9670;&nbsp;</a></span>ks_instancereset_trap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_instancereset_trap </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> *&#160;</td>
          <td class="paramname"><em>trap</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Resets the usage counters on TGT for a <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> sequence object (<em>advanced use</em>)</h4>
</p>
<p>This function is for <em>advanced use</em> where a single <em>sequence generating</em> function is used in parallel in multiple sequences (i.e. in different SEQLENGTH()). This should be called after calling <a class="el" href="_k_s_foundation_8h.html#a8d73c466af30e53064824044894067a9" title="Create a copy of any sequence object with a KS_BASE as first member">ks_copy_and_reset_obj()</a></p>
<p>The function sets <code>.base.ngenerated</code> to 0 (counter for number of times placed out on TGT), and sets <code>.wfpulse</code> and <code>.wfi</code> to NULL to trigger the allocation of new hardware memory, before running the <em>sequence generating</em> function again.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">trap</td><td>Pointer to a <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> sequence object </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;                                          {</div><div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;  <span class="keywordflow">if</span> (!trap) { <span class="keywordflow">return</span>; }</div><div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;</div><div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;  trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a> = 0;</div><div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;  trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a> = NULL;</div><div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;  trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">wfi</a> = NULL;</div><div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;}</div><div class="ttc" id="struct_k_s___t_r_a_p_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">KS_TRAP::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:431</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a15be3edad342a49398ca841c2745dc9e"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">KS_TRAP::wfi</a></div><div class="ttdeci">KS_WFINSTANCE * wfi</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:441</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a9428be182c75f60d1b4e6fe36c888afa"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">KS_TRAP::wfpulse</a></div><div class="ttdeci">WF_PULSE ** wfpulse</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:440</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aad9c2e7d88da5870c5326fff22fef2b8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aad9c2e7d88da5870c5326fff22fef2b8">&#9670;&nbsp;</a></span>ks_instancereset_wait()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_instancereset_wait </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___w_a_i_t.html">KS_WAIT</a> *&#160;</td>
          <td class="paramname"><em>wait</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Resets the usage counters on TGT for a <a class="el" href="struct_k_s___w_a_i_t.html" title="Core sequence object that adds wait periods in the pulse sequence (see ks_eval_wait(), ks_pg_wait()). Can be placed on any sequence board">KS_WAIT</a> sequence object (<em>advanced use</em>)</h4>
</p>
<p>This function is for <em>advanced use</em> where a single <em>sequence generating</em> function is used in parallel in multiple sequences (i.e. in different SEQLENGTH()). This should be called after calling <a class="el" href="_k_s_foundation_8h.html#a8d73c466af30e53064824044894067a9" title="Create a copy of any sequence object with a KS_BASE as first member">ks_copy_and_reset_obj()</a></p>
<p>The function sets <code>.base.ngenerated</code> to 0 (counter for number of times placed out on TGT), and sets <code>.wfpulse</code> and <code>.wfi</code> to NULL to trigger the allocation of new hardware memory, before running the <em>sequence generating</em> function again.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">wait</td><td>Pointer to a <a class="el" href="struct_k_s___w_a_i_t.html" title="Core sequence object that adds wait periods in the pulse sequence (see ks_eval_wait(), ks_pg_wait()). Can be placed on any sequence board">KS_WAIT</a> sequence object </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;                                          {</div><div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;  <span class="keywordflow">if</span> (!wait) { <span class="keywordflow">return</span>; }</div><div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;</div><div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;  wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a> = 0;</div><div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;  wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#aeb311c3018cbffb0db0463280f3c4cd5">wfpulse</a> = NULL;</div><div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;  wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a15be3edad342a49398ca841c2745dc9e">wfi</a> = NULL;</div><div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;}</div><div class="ttc" id="struct_k_s___w_a_i_t_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">KS_WAIT::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:309</div></div>
<div class="ttc" id="struct_k_s___w_a_i_t_html_a15be3edad342a49398ca841c2745dc9e"><div class="ttname"><a href="struct_k_s___w_a_i_t.html#a15be3edad342a49398ca841c2745dc9e">KS_WAIT::wfi</a></div><div class="ttdeci">KS_WFINSTANCE * wfi</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:314</div></div>
<div class="ttc" id="struct_k_s___w_a_i_t_html_aeb311c3018cbffb0db0463280f3c4cd5"><div class="ttname"><a href="struct_k_s___w_a_i_t.html#aeb311c3018cbffb0db0463280f3c4cd5">KS_WAIT::wfpulse</a></div><div class="ttdeci">WF_PULSE * wfpulse</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:313</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ace40879ab8ead831e2cb4813d0c129c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ace40879ab8ead831e2cb4813d0c129c7">&#9670;&nbsp;</a></span>ks_instancereset_phaser()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_instancereset_phaser </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *&#160;</td>
          <td class="paramname"><em>phaser</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Resets the usage counters on TGT for a <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> sequence object (<em>advanced use</em>)</h4>
</p>
<p>This function is for <em>advanced use</em> where a single <em>sequence generating</em> function is used in parallel in multiple sequences (i.e. in different SEQLENGTH()). This should be called after calling <a class="el" href="_k_s_foundation_8h.html#a8d73c466af30e53064824044894067a9" title="Create a copy of any sequence object with a KS_BASE as first member">ks_copy_and_reset_obj()</a></p>
<p>The function sets <code>.base.ngenerated</code> to 0 (counter for number of times placed out on TGT), and sets <code>.wfpulse</code> and <code>.wfi</code> to NULL to trigger the allocation of new hardware memory, before running the <em>sequence generating</em> function again.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">phaser</td><td>Pointer to a <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> sequence object </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;                                                {</div><div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;  <span class="keywordflow">if</span> (!phaser) { <span class="keywordflow">return</span>; }</div><div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;</div><div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#ad4f6f11e79e686edc745fb372307da07">ks_instancereset_trap</a>(&amp;phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>);</div><div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;}</div><div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">KS_PHASER::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1525</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_ad4f6f11e79e686edc745fb372307da07"><div class="ttname"><a href="_k_s_foundation__common_8c.html#ad4f6f11e79e686edc745fb372307da07">ks_instancereset_trap</a></div><div class="ttdeci">void ks_instancereset_trap(KS_TRAP *trap)</div><div class="ttdoc">Resets the usage counters on TGT for a KS_TRAP sequence object (advanced use)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2548</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa383b0d8b9fefba159e34ed921350522"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa383b0d8b9fefba159e34ed921350522">&#9670;&nbsp;</a></span>ks_instancereset_readtrap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_instancereset_readtrap </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a> *&#160;</td>
          <td class="paramname"><em>readtrap</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Resets the usage counters on TGT for a <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> sequence object (<em>advanced use</em>)</h4>
</p>
<p>This function is for <em>advanced use</em> where a single <em>sequence generating</em> function is used in parallel in multiple sequences (i.e. in different SEQLENGTH()). This should be called after calling <a class="el" href="_k_s_foundation_8h.html#a8d73c466af30e53064824044894067a9" title="Create a copy of any sequence object with a KS_BASE as first member">ks_copy_and_reset_obj()</a></p>
<p>The function sets <code>.base.ngenerated</code> to 0 (counter for number of times placed out on TGT), and sets <code>.wfpulse</code> and <code>.wfi</code> to NULL to trigger the allocation of new hardware memory, before running the <em>sequence generating</em> function again.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">readtrap</td><td>Pointer to a <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> sequence object </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;                                                  {</div><div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;  <span class="keywordflow">if</span> (!read) { <span class="keywordflow">return</span>; }</div><div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;</div><div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;  read-&gt;acq.base.ngenerated = 0;</div><div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;  read-&gt;acq.echo = NULL;</div><div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;</div><div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#ad4f6f11e79e686edc745fb372307da07">ks_instancereset_trap</a>(&amp;read-&gt;grad);</div><div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#ad4f6f11e79e686edc745fb372307da07">ks_instancereset_trap</a>(&amp;read-&gt;omega);</div><div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_ad4f6f11e79e686edc745fb372307da07"><div class="ttname"><a href="_k_s_foundation__common_8c.html#ad4f6f11e79e686edc745fb372307da07">ks_instancereset_trap</a></div><div class="ttdeci">void ks_instancereset_trap(KS_TRAP *trap)</div><div class="ttdoc">Resets the usage counters on TGT for a KS_TRAP sequence object (advanced use)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2548</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7f71a623c82d573e0418c143e8ecec56"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7f71a623c82d573e0418c143e8ecec56">&#9670;&nbsp;</a></span>ks_instancereset_rf()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_instancereset_rf </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_f.html">KS_RF</a> *&#160;</td>
          <td class="paramname"><em>rf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Resets the usage counters on TGT for a <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> sequence object (<em>advanced use</em>)</h4>
</p>
<p>This function is for <em>advanced use</em> where a single <em>sequence generating</em> function is used in parallel in multiple sequences (i.e. in different SEQLENGTH()). This should be called after calling <a class="el" href="_k_s_foundation_8h.html#a8d73c466af30e53064824044894067a9" title="Create a copy of any sequence object with a KS_BASE as first member">ks_copy_and_reset_obj()</a></p>
<p>The function sets <code>.base.ngenerated</code> to 0 (counter for number of times placed out on TGT), and sets <code>.wfpulse</code> and <code>.wfi</code> to NULL to trigger the allocation of new hardware memory, before running the <em>sequence generating</em> function again.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">rf</td><td>Pointer to a <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> sequence object </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;                                    {</div><div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;  <span class="keywordflow">if</span> (!rf) { <span class="keywordflow">return</span>; }</div><div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;</div><div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#a6ef78e75e7d598cbd08cf10cb31f0220">ks_instancereset_wave</a>(&amp;rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>);</div><div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#a6ef78e75e7d598cbd08cf10cb31f0220">ks_instancereset_wave</a>(&amp;rf-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>);</div><div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#a6ef78e75e7d598cbd08cf10cb31f0220">ks_instancereset_wave</a>(&amp;rf-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>);</div><div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;</div><div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;}</div><div class="ttc" id="struct_k_s___r_f_html_aecd8b68c159a31a28e2a2ec003b593e2"><div class="ttname"><a href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">KS_RF::thetawave</a></div><div class="ttdeci">KS_WAVE thetawave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:800</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a2a9b610a78cdae3ac8ef682bd34f7e0d"><div class="ttname"><a href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">KS_RF::rfwave</a></div><div class="ttdeci">KS_WAVE rfwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:798</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a6ef78e75e7d598cbd08cf10cb31f0220"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a6ef78e75e7d598cbd08cf10cb31f0220">ks_instancereset_wave</a></div><div class="ttdeci">void ks_instancereset_wave(KS_WAVE *wave)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2557</div></div>
<div class="ttc" id="struct_k_s___r_f_html_aa283d0a503cfda1c25da9f9b9a0d8b1c"><div class="ttname"><a href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">KS_RF::omegawave</a></div><div class="ttdeci">KS_WAVE omegawave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:799</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ace7a321746aada2f87551d05f5a4a77f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ace7a321746aada2f87551d05f5a4a77f">&#9670;&nbsp;</a></span>ks_instancereset_selrf()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_instancereset_selrf </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *&#160;</td>
          <td class="paramname"><em>selrf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Resets the usage counters on TGT for a <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> sequence object (<em>advanced use</em>)</h4>
</p>
<p>This function is for <em>advanced use</em> where a single <em>sequence generating</em> function is used in parallel in multiple sequences (i.e. in different SEQLENGTH()). This should be called after calling <a class="el" href="_k_s_foundation_8h.html#a8d73c466af30e53064824044894067a9" title="Create a copy of any sequence object with a KS_BASE as first member">ks_copy_and_reset_obj()</a></p>
<p>The function sets <code>.base.ngenerated</code> to 0 (counter for number of times placed out on TGT), and sets <code>.wfpulse</code> and <code>.wfi</code> to NULL to trigger the allocation of new hardware memory, before running the <em>sequence generating</em> function again.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">selrf</td><td>Pointer to a <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> sequence object </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;                                             {</div><div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;  <span class="keywordflow">if</span> (!selrf) { <span class="keywordflow">return</span>; }</div><div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;</div><div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#a7f71a623c82d573e0418c143e8ecec56">ks_instancereset_rf</a>(&amp;selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>);</div><div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#ad4f6f11e79e686edc745fb372307da07">ks_instancereset_trap</a>(&amp;selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a35145c98c931f54a8bf2b97edfb3e4c6">pregrad</a>);</div><div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#ad4f6f11e79e686edc745fb372307da07">ks_instancereset_trap</a>(&amp;selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#af33317a98ade78e3ac252b33cbb794af">grad</a>);</div><div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#ad4f6f11e79e686edc745fb372307da07">ks_instancereset_trap</a>(&amp;selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a5ac7ed86029ab647ba0c9a656ae9fb37">postgrad</a>);</div><div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;</div><div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#a6ef78e75e7d598cbd08cf10cb31f0220">ks_instancereset_wave</a>(&amp;selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>);</div><div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;</div><div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;}</div><div class="ttc" id="struct_k_s___s_e_l_r_f_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#af33317a98ade78e3ac252b33cbb794af">KS_SELRF::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1340</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_a607347e9c1c7a9eef21fff556faccc3f"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">KS_SELRF::gradwave</a></div><div class="ttdeci">KS_WAVE gradwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1342</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_a35145c98c931f54a8bf2b97edfb3e4c6"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#a35145c98c931f54a8bf2b97edfb3e4c6">KS_SELRF::pregrad</a></div><div class="ttdeci">KS_TRAP pregrad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1339</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_adeab1cc34f1a7f20f41e8825d849981e"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">KS_SELRF::rf</a></div><div class="ttdeci">KS_RF rf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1334</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a6ef78e75e7d598cbd08cf10cb31f0220"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a6ef78e75e7d598cbd08cf10cb31f0220">ks_instancereset_wave</a></div><div class="ttdeci">void ks_instancereset_wave(KS_WAVE *wave)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2557</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a7f71a623c82d573e0418c143e8ecec56"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a7f71a623c82d573e0418c143e8ecec56">ks_instancereset_rf</a></div><div class="ttdeci">void ks_instancereset_rf(KS_RF *rf)</div><div class="ttdoc">Resets the usage counters on TGT for a KS_RF sequence object (advanced use)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2590</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_a5ac7ed86029ab647ba0c9a656ae9fb37"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#a5ac7ed86029ab647ba0c9a656ae9fb37">KS_SELRF::postgrad</a></div><div class="ttdeci">KS_TRAP postgrad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1341</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_ad4f6f11e79e686edc745fb372307da07"><div class="ttname"><a href="_k_s_foundation__common_8c.html#ad4f6f11e79e686edc745fb372307da07">ks_instancereset_trap</a></div><div class="ttdeci">void ks_instancereset_trap(KS_TRAP *trap)</div><div class="ttdoc">Resets the usage counters on TGT for a KS_TRAP sequence object (advanced use)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2548</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3944bb2736d992be3c1b512d8dfb0ce8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3944bb2736d992be3c1b512d8dfb0ce8">&#9670;&nbsp;</a></span>ks_instancereset_epi()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_instancereset_epi </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *&#160;</td>
          <td class="paramname"><em>epi</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Resets the usage counters on TGT for a <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> sequence object (<em>advanced use</em>)</h4>
</p>
<p>This function is for <em>advanced use</em> where a single <em>sequence generating</em> function is used in parallel in multiple sequences (i.e. in different SEQLENGTH()). This should be called after calling <a class="el" href="_k_s_foundation_8h.html#a8d73c466af30e53064824044894067a9" title="Create a copy of any sequence object with a KS_BASE as first member">ks_copy_and_reset_obj()</a></p>
<p>The function sets <code>.base.ngenerated</code> to 0 (counter for number of times placed out on TGT), and sets <code>.wfpulse</code> and <code>.wfi</code> to NULL to trigger the allocation of new hardware memory, before running the <em>sequence generating</em> function again.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">epi</td><td>Pointer to a <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> sequence object </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;                                       {</div><div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;  <span class="keywordflow">if</span> (!epi) { <span class="keywordflow">return</span>; }</div><div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;</div><div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#aeb15e81750dea5de7e46585faf05cdc7">ks_instancereset_readtrap</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>);</div><div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#ad4f6f11e79e686edc745fb372307da07">ks_instancereset_trap</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#abc81c5867684b6e31b65459ec9431269">readphaser</a>);</div><div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#ad4f6f11e79e686edc745fb372307da07">ks_instancereset_trap</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#aaa0021ab8174eb7806de89d599769a9b">blip</a>);</div><div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#ace40879ab8ead831e2cb4813d0c129c7">ks_instancereset_phaser</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>);</div><div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;}</div><div class="ttc" id="struct_k_s___e_p_i_html_aaa0021ab8174eb7806de89d599769a9b"><div class="ttname"><a href="struct_k_s___e_p_i.html#aaa0021ab8174eb7806de89d599769a9b">KS_EPI::blip</a></div><div class="ttdeci">KS_TRAP blip</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1687</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_ace40879ab8ead831e2cb4813d0c129c7"><div class="ttname"><a href="_k_s_foundation__common_8c.html#ace40879ab8ead831e2cb4813d0c129c7">ks_instancereset_phaser</a></div><div class="ttdeci">void ks_instancereset_phaser(KS_PHASER *phaser)</div><div class="ttdoc">Resets the usage counters on TGT for a KS_PHASER sequence object (advanced use)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2574</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a22cd0313e5ffabe8393f77745dba8d52"><div class="ttname"><a href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">KS_EPI::blipphaser</a></div><div class="ttdeci">KS_PHASER blipphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1688</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_aeb15e81750dea5de7e46585faf05cdc7"><div class="ttname"><a href="_k_s_foundation__common_8c.html#aeb15e81750dea5de7e46585faf05cdc7">ks_instancereset_readtrap</a></div><div class="ttdeci">void ks_instancereset_readtrap(KS_READTRAP *read)</div><div class="ttdoc">Resets the usage counters on TGT for a KS_READTRAP sequence object (advanced use)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2580</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a03d42c44e323f3203fe5beabcefa47a5"><div class="ttname"><a href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">KS_EPI::read</a></div><div class="ttdeci">KS_READTRAP read</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1685</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_abc81c5867684b6e31b65459ec9431269"><div class="ttname"><a href="struct_k_s___e_p_i.html#abc81c5867684b6e31b65459ec9431269">KS_EPI::readphaser</a></div><div class="ttdeci">KS_TRAP readphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1686</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_ad4f6f11e79e686edc745fb372307da07"><div class="ttname"><a href="_k_s_foundation__common_8c.html#ad4f6f11e79e686edc745fb372307da07">ks_instancereset_trap</a></div><div class="ttdeci">void ks_instancereset_trap(KS_TRAP *trap)</div><div class="ttdoc">Resets the usage counters on TGT for a KS_TRAP sequence object (advanced use)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2548</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="acee69d0d4db843c9923ab78fd3939009"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acee69d0d4db843c9923ab78fd3939009">&#9670;&nbsp;</a></span>ks_compare_wfi_by_timeboard()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_compare_wfi_by_timeboard </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a> *&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a> *&#160;</td>
          <td class="paramname"><em>b</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Compares two WF_INSTANCEs by time, then board</h4>
</p>
<p>This function is used by the qsort() routine in <a class="el" href="_k_s_foundation_8h.html#acee69d0d4db843c9923ab78fd3939009" title="Compares two WF_INSTANCEs by time, then board">ks_compare_wfi_by_timeboard()</a></p>
<p>If two WF_INSTANCEs occur at the same time, XGRAD will come before YGRAD and YGRAD before ZGRAD</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">a</td><td>Pointer to the first <a class="el" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html" title="(Internal use) Structure being a part of various sequence objects to sort them in time across boards...">KS_WFINSTANCE</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">b</td><td>Pointer to the second <a class="el" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html" title="(Internal use) Structure being a part of various sequence objects to sort them in time across boards...">KS_WFINSTANCE</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">value</td><td>Larger or less than 0 depending on sorting order </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;                                                                                {</div><div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;</div><div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;  <span class="keywordflow">return</span> (a-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> &gt; b-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>) - (a-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> &lt; b-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>) +</div><div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;         (a-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> == b-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>) * ((a-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> &gt; b-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>) - (a-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> &lt; b-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>));</div><div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;}</div><div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a1910d262855b71da353ed0d07a6c7823"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">KS_SEQLOC::pos</a></div><div class="ttdeci">int pos</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:242</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a2e3f5254967cadb9a41167c6fbf6743e"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">KS_SEQLOC::board</a></div><div class="ttdeci">int board</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:241</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a78e529e1d86855310035845e03a4c107"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">KS_WFINSTANCE::loc</a></div><div class="ttdeci">KS_SEQLOC loc</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:253</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="addfe7afa496fc5757c450680db49dc5f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#addfe7afa496fc5757c450680db49dc5f">&#9670;&nbsp;</a></span>ks_compare_wfi_by_boardtime()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_compare_wfi_by_boardtime </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a> *&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a> *&#160;</td>
          <td class="paramname"><em>b</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Compares two WF_INSTANCES by board, then time</h4>
</p>
<p>This function is used by the qsort() routine in <a class="el" href="_k_s_foundation_8h.html#addfe7afa496fc5757c450680db49dc5f" title="Compares two WF_INSTANCES by board, then time">ks_compare_wfi_by_boardtime()</a></p>
<p>WF_INSTANCEs are sorted first by board. If two WF_INSTANCEs occur on the same board, t they will be sorted in time</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">a</td><td>Pointer to the first <a class="el" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html" title="(Internal use) Structure being a part of various sequence objects to sort them in time across boards...">KS_WFINSTANCE</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">b</td><td>Pointer to the second <a class="el" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html" title="(Internal use) Structure being a part of various sequence objects to sort them in time across boards...">KS_WFINSTANCE</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">value</td><td>Larger or less than 0 depending on sorting order </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;                                                                                {</div><div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;</div><div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;  <span class="keywordflow">return</span> (a-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> &gt; b-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>) - (a-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> &lt; b-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>) +</div><div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;         (a-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == b-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>) * ((a-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> &gt; b-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>) - (a-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> &lt; b-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>));</div><div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;}</div><div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a1910d262855b71da353ed0d07a6c7823"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">KS_SEQLOC::pos</a></div><div class="ttdeci">int pos</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:242</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a2e3f5254967cadb9a41167c6fbf6743e"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">KS_SEQLOC::board</a></div><div class="ttdeci">int board</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:241</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a78e529e1d86855310035845e03a4c107"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">KS_WFINSTANCE::loc</a></div><div class="ttdeci">KS_SEQLOC loc</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:253</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3d24ff69a16ddb94bd6317e6c5594fe1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3d24ff69a16ddb94bd6317e6c5594fe1">&#9670;&nbsp;</a></span>ks_compare_wfp_by_time()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_compare_wfp_by_time </td>
          <td>(</td>
          <td class="paramtype">const WF_PULSE *&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const WF_PULSE *&#160;</td>
          <td class="paramname"><em>b</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Compares two WF_PULSES in time</h4>
</p>
<p>This function is used by the qsort() routine in <a class="el" href="_k_s_foundation_8h.html#a42180e710dc1f89e9a557683f8f58dda" title="Sort WF_PULSEs in time">ks_sort_wfp_by_time()</a>, which is called from <a class="el" href="_k_s_foundation_8h.html#a5b50d0ffcc69966c42bceb7e67c70cbf" title="Places a KS_READ sequence object at some position in the pulse sequence">ks_pg_read()</a> for data acquisition sorting purposes. It is assumed both WF_PULSEs have only one instance</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">a</td><td>Pointer to the first WF_PULSE </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">b</td><td>Pointer to the second WF_PULSE </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">value</td><td>Larger or less than 0 depending on sorting order </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;                                                                 {</div><div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;</div><div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;  <span class="keywordflow">return</span> (a-&gt;inst_hdr_head-&gt;start &gt; b-&gt;inst_hdr_head-&gt;start) - (a-&gt;inst_hdr_head-&gt;start &lt; b-&gt;inst_hdr_head-&gt;start);</div><div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="ad09ed4b8371bcc1dd3d873c1ee5587ed"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad09ed4b8371bcc1dd3d873c1ee5587ed">&#9670;&nbsp;</a></span>ks_compare_pint()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_compare_pint </td>
          <td>(</td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>v1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>v2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Compares two int pointers</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">v1</td><td>Pointer to the first int pointer </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">v2</td><td>Pointer to the second int pointer </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">value</td><td>Larger or less than 0 depending on sorting order </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;                                                    {</div><div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> i1 = **(<span class="keyword">const</span> <span class="keywordtype">int</span> **) v1;</div><div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> i2 = **(<span class="keyword">const</span> <span class="keywordtype">int</span> **) v2;</div><div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;</div><div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;  <span class="keywordflow">return</span> i1 &lt; i2 ? -1 : (i1 &gt; i2);</div><div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a768cbf2348344d4c2203bb79b821b2ff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a768cbf2348344d4c2203bb79b821b2ff">&#9670;&nbsp;</a></span>ks_compare_pshort()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_compare_pshort </td>
          <td>(</td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>v1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>v2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Compares two short pointers</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">v1</td><td>Pointer to the first short pointer </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">v2</td><td>Pointer to the second shot pointer </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">value</td><td>Larger or less than 0 depending on sorting order </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;                                                      {</div><div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">short</span> i1 = **(<span class="keyword">const</span> <span class="keywordtype">short</span> **) v1;</div><div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">short</span> i2 = **(<span class="keyword">const</span> <span class="keywordtype">short</span> **) v2;</div><div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;</div><div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;  <span class="keywordflow">return</span> i1 &lt; i2 ? -1 : (i1 &gt; i2);</div><div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a4fb225b10c94cbba0ea15b6a97848c3d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4fb225b10c94cbba0ea15b6a97848c3d">&#9670;&nbsp;</a></span>ks_compare_pfloat()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_compare_pfloat </td>
          <td>(</td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>v1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>v2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Compares two float pointers</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">v1</td><td>Pointer to the first float pointer </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">v2</td><td>Pointer to the second float pointer </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">value</td><td>Larger or less than 0 depending on sorting order </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;                                                      {</div><div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">float</span> i1 = **(<span class="keyword">const</span> <span class="keywordtype">float</span> **) v1;</div><div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">float</span> i2 = **(<span class="keyword">const</span> <span class="keywordtype">float</span> **) v2;</div><div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;</div><div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;  <span class="keywordflow">return</span> i1 &lt; i2 ? -1 : (i1 &gt; i2);</div><div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a3ba108e0606acf6fca3664f186be0289"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3ba108e0606acf6fca3664f186be0289">&#9670;&nbsp;</a></span>ks_compare_int()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_compare_int </td>
          <td>(</td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>v1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>v2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Compares two integers (int)</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">v1</td><td>Pointer to the first int </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">v2</td><td>Pointer to the second int </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">value</td><td>Larger or less than 0 depending on sorting order </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;                                                   {</div><div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> i1 = *(<span class="keyword">const</span> <span class="keywordtype">int</span> *) v1;</div><div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> i2 = *(<span class="keyword">const</span> <span class="keywordtype">int</span> *) v2;</div><div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;</div><div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;  <span class="keywordflow">return</span> i1 &lt; i2 ? -1 : (i1 &gt; i2);</div><div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a7e439a9bad95e13f0909674391e7f0fc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7e439a9bad95e13f0909674391e7f0fc">&#9670;&nbsp;</a></span>ks_compare_short()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_compare_short </td>
          <td>(</td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>v1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>v2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Compares two integers (short)</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">v1</td><td>Pointer to the first short </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">v2</td><td>Pointer to the second short </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">value</td><td>Larger or less than 0 depending on sorting order </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;                                                     {</div><div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">short</span> i1 = *(<span class="keyword">const</span> <span class="keywordtype">short</span> *) v1;</div><div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">short</span> i2 = *(<span class="keyword">const</span> <span class="keywordtype">short</span> *) v2;</div><div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;</div><div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;  <span class="keywordflow">return</span> i1 &lt; i2 ? -1 : (i1 &gt; i2);</div><div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a39ba8e8e94e7a55ea699b0f29c862016"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a39ba8e8e94e7a55ea699b0f29c862016">&#9670;&nbsp;</a></span>ks_compare_float()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_compare_float </td>
          <td>(</td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>v1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>v2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Compares two floats</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">v1</td><td>Pointer to the first float </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">v2</td><td>Pointer to the second float </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">value</td><td>Larger or less than 0 depending on sorting order </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;                                                     {</div><div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">float</span> i1 = *(<span class="keyword">const</span> <span class="keywordtype">float</span> *) v1;</div><div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">float</span> i2 = *(<span class="keyword">const</span> <span class="keywordtype">float</span> *) v2;</div><div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;</div><div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;  <span class="keywordflow">return</span> i1 &lt; i2 ? -1 : (i1 &gt; i2);</div><div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a72adf83f1d9ed4592227259113eed4ea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a72adf83f1d9ed4592227259113eed4ea">&#9670;&nbsp;</a></span>ks_sort_getsortedindx()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_sort_getsortedindx </td>
          <td>(</td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>sortedindx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>array</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sort an array of integers (int)</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">sortedindx</td><td>Array of indices into the <code>array</code> to make it sorted </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">array</td><td>Array to be sorted </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">n</td><td>Number of elements in array </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;                                                               {</div><div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;  <span class="keywordtype">int</span> *parray[n];</div><div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;</div><div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; n; i++)</div><div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;    parray[i] = &amp;array[i];</div><div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;</div><div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;  qsort(parray, n, <span class="keyword">sizeof</span> * parray, <a class="code" href="_k_s_foundation__common_8c.html#ad09ed4b8371bcc1dd3d873c1ee5587ed">ks_compare_pint</a>);</div><div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;</div><div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; n; i++)</div><div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;    sortedindx[i] = parray[i] - array;</div><div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;</div><div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_ad09ed4b8371bcc1dd3d873c1ee5587ed"><div class="ttname"><a href="_k_s_foundation__common_8c.html#ad09ed4b8371bcc1dd3d873c1ee5587ed">ks_compare_pint</a></div><div class="ttdeci">int ks_compare_pint(const void *v1, const void *v2)</div><div class="ttdoc">Compares two int pointers</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2980</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a39b939060ef2d2772d6ab7a0817c0ec2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a39b939060ef2d2772d6ab7a0817c0ec2">&#9670;&nbsp;</a></span>ks_sort_getsortedindx_s()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_sort_getsortedindx_s </td>
          <td>(</td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>sortedindx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">short *&#160;</td>
          <td class="paramname"><em>array</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sort an array of integers (short)</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">sortedindx</td><td>Array of indices into the <code>array</code> to make it sorted </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">array</td><td>Array to be sorted </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">n</td><td>Number of elements in array </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;                                                                   {</div><div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;  <span class="keywordtype">short</span> *parray[n];</div><div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;</div><div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; n; i++)</div><div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;    parray[i] = &amp;array[i];</div><div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;</div><div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;  qsort(parray, n, <span class="keyword">sizeof</span> * parray, <a class="code" href="_k_s_foundation__common_8c.html#a768cbf2348344d4c2203bb79b821b2ff">ks_compare_pshort</a>);</div><div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;</div><div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; n; i++)</div><div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;    sortedindx[i] = parray[i] - array;</div><div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;</div><div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a768cbf2348344d4c2203bb79b821b2ff"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a768cbf2348344d4c2203bb79b821b2ff">ks_compare_pshort</a></div><div class="ttdeci">int ks_compare_pshort(const void *v1, const void *v2)</div><div class="ttdoc">Compares two short pointers</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2972</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa8ba7c47c66d40b3df50e6228f66920d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa8ba7c47c66d40b3df50e6228f66920d">&#9670;&nbsp;</a></span>ks_sort_getsortedindx_f()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_sort_getsortedindx_f </td>
          <td>(</td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>sortedindx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>array</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sort an array of floats</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">sortedindx</td><td>Array of indices into the <code>array</code> to make it sorted </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">array</td><td>Array to be sorted </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">n</td><td>Number of elements in array </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;                                                                   {</div><div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;  <span class="keywordtype">float</span> *parray[n];</div><div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;</div><div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; n; i++)</div><div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;    parray[i] = &amp;array[i];</div><div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;</div><div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;  qsort(parray, n, <span class="keyword">sizeof</span> * parray, <a class="code" href="_k_s_foundation__common_8c.html#a4fb225b10c94cbba0ea15b6a97848c3d">ks_compare_pfloat</a>);</div><div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;</div><div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; n; i++)</div><div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;    sortedindx[i] = parray[i] - array;</div><div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;</div><div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a4fb225b10c94cbba0ea15b6a97848c3d"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a4fb225b10c94cbba0ea15b6a97848c3d">ks_compare_pfloat</a></div><div class="ttdeci">int ks_compare_pfloat(const void *v1, const void *v2)</div><div class="ttdoc">Compares two float pointers</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2988</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0ae65ed3cc2deb47ccf50b7988239474"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0ae65ed3cc2deb47ccf50b7988239474">&#9670;&nbsp;</a></span>ks_sort_wfi_by_timeboard()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_sort_wfi_by_timeboard </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a> *&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nitems</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sort WF_INSTANCEs in time, then board</h4>
</p>
<p>This is the sorting method used in all ks_pg_***() functions</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">a</td><td>Array of <a class="el" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html" title="(Internal use) Structure being a part of various sequence objects to sort them in time across boards...">KS_WFINSTANCE</a> elements </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nitems</td><td>Number of elements in array </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;                                                            {</div><div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;  qsort(a, nitems, <span class="keyword">sizeof</span>(<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a>),</div><div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;        (<span class="keywordtype">int</span>(*)(<span class="keyword">const</span> <span class="keywordtype">void</span> *, <span class="keyword">const</span> <span class="keywordtype">void</span> *))<a class="code" href="_k_s_foundation__common_8c.html#acee69d0d4db843c9923ab78fd3939009">ks_compare_wfi_by_timeboard</a>);</div><div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;}</div><div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a></div><div class="ttdoc">(Internal use) Structure being a part of various sequence objects to sort them in time across boards...</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:250</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_acee69d0d4db843c9923ab78fd3939009"><div class="ttname"><a href="_k_s_foundation__common_8c.html#acee69d0d4db843c9923ab78fd3939009">ks_compare_wfi_by_timeboard</a></div><div class="ttdeci">int ks_compare_wfi_by_timeboard(const KS_WFINSTANCE *a, const KS_WFINSTANCE *b)</div><div class="ttdoc">Compares two WF_INSTANCEs by time, then board</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2937</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a007ba9525cc536f29132ee8e320fa08a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a007ba9525cc536f29132ee8e320fa08a">&#9670;&nbsp;</a></span>ks_sort_wfi_by_boardtime()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_sort_wfi_by_boardtime </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a> *&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nitems</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sort WF_INSTANCEs by board, then time</h4>
</p>
<p>This function is an alternative to <a class="el" href="_k_s_foundation_8h.html#a0ae65ed3cc2deb47ccf50b7988239474" title="Sort WF_INSTANCEs in time, then board">ks_sort_wfi_by_timeboard()</a>, which is <em>not</em> used at the moment</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">a</td><td>Array of <a class="el" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html" title="(Internal use) Structure being a part of various sequence objects to sort them in time across boards...">KS_WFINSTANCE</a> elements </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nitems</td><td>Number of elements in array </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;                                                            {</div><div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;  qsort(a, nitems, <span class="keyword">sizeof</span>(<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a>), (<span class="keywordtype">int</span>(*)(<span class="keyword">const</span> <span class="keywordtype">void</span> *, <span class="keyword">const</span> <span class="keywordtype">void</span> *))<a class="code" href="_k_s_foundation__common_8c.html#addfe7afa496fc5757c450680db49dc5f">ks_compare_wfi_by_boardtime</a>);</div><div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;}</div><div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a></div><div class="ttdoc">(Internal use) Structure being a part of various sequence objects to sort them in time across boards...</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:250</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_addfe7afa496fc5757c450680db49dc5f"><div class="ttname"><a href="_k_s_foundation__common_8c.html#addfe7afa496fc5757c450680db49dc5f">ks_compare_wfi_by_boardtime</a></div><div class="ttdeci">int ks_compare_wfi_by_boardtime(const KS_WFINSTANCE *a, const KS_WFINSTANCE *b)</div><div class="ttdoc">Compares two WF_INSTANCES by board, then time</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2944</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a42180e710dc1f89e9a557683f8f58dda"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a42180e710dc1f89e9a557683f8f58dda">&#9670;&nbsp;</a></span>ks_sort_wfp_by_time()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_sort_wfp_by_time </td>
          <td>(</td>
          <td class="paramtype">WF_PULSE *&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nitems</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sort WF_PULSEs in time</h4>
</p>
<p>This is the sorting method used in <a class="el" href="_k_s_foundation_8h.html#a5b50d0ffcc69966c42bceb7e67c70cbf" title="Places a KS_READ sequence object at some position in the pulse sequence">ks_pg_read()</a></p>
<p>It is assumed that all a[idx] for idx in [0,nitems) have only one instance each</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">a</td><td>Array of WF_PULSE elements </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nitems</td><td>Number of elements in array </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;                                                  {</div><div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;  qsort(a, nitems, <span class="keyword">sizeof</span>(WF_PULSE),</div><div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;        (<span class="keywordtype">int</span>(*)(<span class="keyword">const</span> <span class="keywordtype">void</span> *, <span class="keyword">const</span> <span class="keywordtype">void</span> *))<a class="code" href="_k_s_foundation__common_8c.html#a3d24ff69a16ddb94bd6317e6c5594fe1">ks_compare_wfp_by_time</a>);</div><div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;}</div><div class="ttc" id="_k_s_foundation__common_8c_html_a3d24ff69a16ddb94bd6317e6c5594fe1"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a3d24ff69a16ddb94bd6317e6c5594fe1">ks_compare_wfp_by_time</a></div><div class="ttdeci">int ks_compare_wfp_by_time(const WF_PULSE *a, const WF_PULSE *b)</div><div class="ttdoc">Compares two WF_PULSES in time</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2950</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae136d8a2e504e06e8592185e85fecfde"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae136d8a2e504e06e8592185e85fecfde">&#9670;&nbsp;</a></span>ks_plot_slicetime_begin()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_plot_slicetime_begin </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;                               {</div><div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;  <span class="keywordflow">return</span>;</div><div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a5e19e5d936d4f3c39078da5b6e6ed7f1">ks_plot_host_slicetime_begin</a>();</div><div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_a5e19e5d936d4f3c39078da5b6e6ed7f1"><div class="ttname"><a href="_k_s_foundation_8h.html#a5e19e5d936d4f3c39078da5b6e6ed7f1">ks_plot_host_slicetime_begin</a></div><div class="ttdeci">void ks_plot_host_slicetime_begin()</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3901</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac0c669d4d641190116b6886e0976fd47"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac0c669d4d641190116b6886e0976fd47">&#9670;&nbsp;</a></span>ks_plot_slicetime()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_plot_slicetime </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>ctrl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nslices</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>slicepos_mm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>slthick_mm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_k_s_foundation_8h.html#a0ba82984ac3a22ad68cab5bce5224cf9">KS_PLOT_EXCITATION_MODE</a>&#160;</td>
          <td class="paramname"><em>exctype</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;                                                                                                                                 {</div><div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;  <span class="keywordflow">return</span>;</div><div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a2cc0a4e9542bfa5b8a93ca3a12a81c24">ks_plot_host_slicetime</a>(ctrl, nslices, slicepos_mm, slthick_mm, excmode);</div><div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_a2cc0a4e9542bfa5b8a93ca3a12a81c24"><div class="ttname"><a href="_k_s_foundation_8h.html#a2cc0a4e9542bfa5b8a93ca3a12a81c24">ks_plot_host_slicetime</a></div><div class="ttdeci">void ks_plot_host_slicetime(KS_SEQ_CONTROL *ctrl, int nslices, float *slicepos_mm, float slthick_mm, KS_PLOT_EXCITATION_MODE exctype)</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3980</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aadb6109f3b3f75f81b46e153f9eb11f0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aadb6109f3b3f75f81b46e153f9eb11f0">&#9670;&nbsp;</a></span>ks_plot_slicetime_endofslicegroup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_plot_slicetime_endofslicegroup </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>desc</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;                                                         {</div><div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;  <span class="keywordflow">return</span>;</div><div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#afaafc1f357c7766042d78af3c456380a">ks_plot_host_slicetime_endofslicegroup</a>(desc);</div><div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_afaafc1f357c7766042d78af3c456380a"><div class="ttname"><a href="_k_s_foundation_8h.html#afaafc1f357c7766042d78af3c456380a">ks_plot_host_slicetime_endofslicegroup</a></div><div class="ttdeci">void ks_plot_host_slicetime_endofslicegroup(const char *desc)</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3932</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab8c26ea9ee8534faf737bbc61223253e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab8c26ea9ee8534faf737bbc61223253e">&#9670;&nbsp;</a></span>ks_plot_slicetime_endofpass()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_plot_slicetime_endofpass </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a6eab83ca87166f306eb449a94a354ec6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6eab83ca87166f306eb449a94a354ec6">&#9670;&nbsp;</a></span>ks_plot_slicetime_end()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_plot_slicetime_end </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;                             {</div><div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;  <span class="keywordflow">return</span>;</div><div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#ad67bd9fb00d294b98a0a3a7fbaac8550">ks_plot_host_slicetime_end</a>();</div><div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_ad67bd9fb00d294b98a0a3a7fbaac8550"><div class="ttname"><a href="_k_s_foundation_8h.html#ad67bd9fb00d294b98a0a3a7fbaac8550">ks_plot_host_slicetime_end</a></div><div class="ttdeci">void ks_plot_host_slicetime_end()</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:4031</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a5e19e5d936d4f3c39078da5b6e6ed7f1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5e19e5d936d4f3c39078da5b6e6ed7f1">&#9670;&nbsp;</a></span>ks_plot_host_slicetime_begin()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_plot_host_slicetime_begin </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l03901"></a><span class="lineno"> 3901</span>&#160;                                    {</div><div class="line"><a name="l03902"></a><span class="lineno"> 3902</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__host_8c.html#adf724d7e25607bea3d8bf36bb6f8060d">ks_plot_filefmt</a> == <a class="code" href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5fadd75ba7d05d9527ea99f8643787d46ac">KS_PLOT_OFF</a>) {</div><div class="line"><a name="l03903"></a><span class="lineno"> 3903</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l03904"></a><span class="lineno"> 3904</span>&#160;  }</div><div class="line"><a name="l03905"></a><span class="lineno"> 3905</span>&#160;  <span class="keyword">extern</span> <span class="keywordtype">int</span> optr;</div><div class="line"><a name="l03906"></a><span class="lineno"> 3906</span>&#160;  <span class="keyword">extern</span> <span class="keywordtype">float</span> pitscan;</div><div class="line"><a name="l03907"></a><span class="lineno"> 3907</span>&#160;  <span class="keywordtype">char</span> path[250];</div><div class="line"><a name="l03908"></a><span class="lineno"> 3908</span>&#160;  <span class="keywordtype">char</span> fname[500];</div><div class="line"><a name="l03909"></a><span class="lineno"> 3909</span>&#160;  <span class="keywordtype">char</span> cmd[300];</div><div class="line"><a name="l03910"></a><span class="lineno"> 3910</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#a9354e57ac3b36228518c6f49e3fb8a27">ks_plot_host_slicetime_path</a>(path);</div><div class="line"><a name="l03911"></a><span class="lineno"> 3911</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#aadd2989ca80c0b8efa26f44eba1ea152">ks_plot_host_slicetime_fullfile</a>(fname);</div><div class="line"><a name="l03912"></a><span class="lineno"> 3912</span>&#160;</div><div class="line"><a name="l03913"></a><span class="lineno"> 3913</span>&#160;  sprintf(cmd, <span class="stringliteral">&quot;mkdir -p %s &gt; /dev/null&quot;</span>, path);</div><div class="line"><a name="l03914"></a><span class="lineno"> 3914</span>&#160;  system(cmd);</div><div class="line"><a name="l03915"></a><span class="lineno"> 3915</span>&#160;  sprintf(fname, <span class="stringliteral">&quot;%s%s_slicetime.json&quot;</span>, path, <a class="code" href="_k_s_foundation__host_8c.html#af846b49be109f687e9863f2016029516">ks_psdname</a>);</div><div class="line"><a name="l03916"></a><span class="lineno"> 3916</span>&#160;  <span class="comment">/* Reset file */</span></div><div class="line"><a name="l03917"></a><span class="lineno"> 3917</span>&#160;  FILE* fp = fopen(fname, <span class="stringliteral">&quot;w&quot;</span>);</div><div class="line"><a name="l03918"></a><span class="lineno"> 3918</span>&#160;  fprintf(fp,</div><div class="line"><a name="l03919"></a><span class="lineno"> 3919</span>&#160;   <span class="stringliteral">&quot;{\n&quot;</span></div><div class="line"><a name="l03920"></a><span class="lineno"> 3920</span>&#160;   <span class="stringliteral">&quot;\&quot;metadata\&quot;: {\n&quot;</span></div><div class="line"><a name="l03921"></a><span class="lineno"> 3921</span>&#160;   <span class="stringliteral">&quot;\t\&quot;psdname\&quot;: \&quot;%s\&quot;,\n&quot;</span></div><div class="line"><a name="l03922"></a><span class="lineno"> 3922</span>&#160;   <span class="stringliteral">&quot;\t\&quot;optr\&quot;: %d,\n&quot;</span></div><div class="line"><a name="l03923"></a><span class="lineno"> 3923</span>&#160;   <span class="stringliteral">&quot;\t\&quot;pitscan\&quot;: %.0f\n&quot;</span></div><div class="line"><a name="l03924"></a><span class="lineno"> 3924</span>&#160;   <span class="stringliteral">&quot;},\n&quot;</span></div><div class="line"><a name="l03925"></a><span class="lineno"> 3925</span>&#160;   <span class="stringliteral">&quot;\&quot;passes\&quot;: [ {\n&quot;</span></div><div class="line"><a name="l03926"></a><span class="lineno"> 3926</span>&#160;   <span class="stringliteral">&quot;\t\&quot;slicegroups\&quot;: [\n\t[{},\n\t&quot;</span>,</div><div class="line"><a name="l03927"></a><span class="lineno"> 3927</span>&#160;   <a class="code" href="_k_s_foundation__host_8c.html#af846b49be109f687e9863f2016029516">ks_psdname</a>, optr, pitscan);</div><div class="line"><a name="l03928"></a><span class="lineno"> 3928</span>&#160;  fclose(fp);</div><div class="line"><a name="l03929"></a><span class="lineno"> 3929</span>&#160;}</div><div class="ttc" id="_k_s_foundation__host_8c_html_aadd2989ca80c0b8efa26f44eba1ea152"><div class="ttname"><a href="_k_s_foundation__host_8c.html#aadd2989ca80c0b8efa26f44eba1ea152">ks_plot_host_slicetime_fullfile</a></div><div class="ttdeci">void ks_plot_host_slicetime_fullfile(char *fullfile)</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3895</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a0af3c4f49a609b3bc02c7be25b9c7c5fadd75ba7d05d9527ea99f8643787d46ac"><div class="ttname"><a href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5fadd75ba7d05d9527ea99f8643787d46ac">KS_PLOT_OFF</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:188</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a9354e57ac3b36228518c6f49e3fb8a27"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a9354e57ac3b36228518c6f49e3fb8a27">ks_plot_host_slicetime_path</a></div><div class="ttdeci">void ks_plot_host_slicetime_path(char *path)</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3887</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_adf724d7e25607bea3d8bf36bb6f8060d"><div class="ttname"><a href="_k_s_foundation__host_8c.html#adf724d7e25607bea3d8bf36bb6f8060d">ks_plot_filefmt</a></div><div class="ttdeci">int ks_plot_filefmt</div><div class="ttdef"><b>Definition:</b> GERequired.e:242</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_af846b49be109f687e9863f2016029516"><div class="ttname"><a href="_k_s_foundation__host_8c.html#af846b49be109f687e9863f2016029516">ks_psdname</a></div><div class="ttdeci">char ks_psdname[256]</div><div class="ttdef"><b>Definition:</b> GERequired.e:218</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2cc0a4e9542bfa5b8a93ca3a12a81c24"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2cc0a4e9542bfa5b8a93ca3a12a81c24">&#9670;&nbsp;</a></span>ks_plot_host_slicetime()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_plot_host_slicetime </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>ctrl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nslices</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>slicepos_mm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>slthick_mm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_k_s_foundation_8h.html#a0ba82984ac3a22ad68cab5bce5224cf9">KS_PLOT_EXCITATION_MODE</a>&#160;</td>
          <td class="paramname"><em>exctype</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l03984"></a><span class="lineno"> 3984</span>&#160;                                                        {</div><div class="line"><a name="l03985"></a><span class="lineno"> 3985</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__host_8c.html#adf724d7e25607bea3d8bf36bb6f8060d">ks_plot_filefmt</a> == <a class="code" href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5fadd75ba7d05d9527ea99f8643787d46ac">KS_PLOT_OFF</a> || ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> &lt;= 0) {</div><div class="line"><a name="l03986"></a><span class="lineno"> 3986</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l03987"></a><span class="lineno"> 3987</span>&#160;  }</div><div class="line"><a name="l03988"></a><span class="lineno"> 3988</span>&#160;  <span class="keyword">static</span> FILE *fp;</div><div class="line"><a name="l03989"></a><span class="lineno"> 3989</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l03990"></a><span class="lineno"> 3990</span>&#160;  <span class="keywordtype">char</span> excmode_str[50];</div><div class="line"><a name="l03991"></a><span class="lineno"> 3991</span>&#160;  <span class="keywordtype">char</span> fname[1000];</div><div class="line"><a name="l03992"></a><span class="lineno"> 3992</span>&#160;  </div><div class="line"><a name="l03993"></a><span class="lineno"> 3993</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#aadd2989ca80c0b8efa26f44eba1ea152">ks_plot_host_slicetime_fullfile</a>(fname);</div><div class="line"><a name="l03994"></a><span class="lineno"> 3994</span>&#160;  <span class="keywordflow">switch</span> (excmode) {</div><div class="line"><a name="l03995"></a><span class="lineno"> 3995</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#a0ba82984ac3a22ad68cab5bce5224cf9a31ef5b1dd7ca976daa060cd0bb7aa679">KS_PLOT_STANDARD</a>: strcpy(excmode_str, <span class="stringliteral">&quot;KS_PLOT_STANDARD&quot;</span>); <span class="keywordflow">break</span>;</div><div class="line"><a name="l03996"></a><span class="lineno"> 3996</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="_k_s_foundation_8h.html#a0ba82984ac3a22ad68cab5bce5224cf9adbb6a4373075b4e441df71373a3d55ad">KS_PLOT_NO_EXCITATION</a>: strcpy(excmode_str, <span class="stringliteral">&quot;KS_PLOT_NO_EXCITATION&quot;</span>); <span class="keywordflow">break</span>;</div><div class="line"><a name="l03997"></a><span class="lineno"> 3997</span>&#160;  }</div><div class="line"><a name="l03998"></a><span class="lineno"> 3998</span>&#160;</div><div class="line"><a name="l03999"></a><span class="lineno"> 3999</span>&#160;  <span class="keywordflow">if</span> (ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> &gt; 0) {</div><div class="line"><a name="l04000"></a><span class="lineno"> 4000</span>&#160;    fp = fopen(fname, <span class="stringliteral">&quot;r+&quot;</span>);</div><div class="line"><a name="l04001"></a><span class="lineno"> 4001</span>&#160;    <span class="keywordflow">if</span> (fp == NULL) {<span class="keywordflow">return</span>;}</div><div class="line"><a name="l04002"></a><span class="lineno"> 4002</span>&#160;    fseek(fp, 0, SEEK_END);</div><div class="line"><a name="l04003"></a><span class="lineno"> 4003</span>&#160;    <span class="comment">/* fputs(&quot; {\n&quot;, fp); */</span></div><div class="line"><a name="l04004"></a><span class="lineno"> 4004</span>&#160;    fprintf(fp,</div><div class="line"><a name="l04005"></a><span class="lineno"> 4005</span>&#160;            <span class="stringliteral">&quot;{\n&quot;</span></div><div class="line"><a name="l04006"></a><span class="lineno"> 4006</span>&#160;            <span class="stringliteral">&quot;\t\t\&quot;description\&quot;: \&quot;%s\&quot;,\n&quot;</span></div><div class="line"><a name="l04007"></a><span class="lineno"> 4007</span>&#160;            <span class="stringliteral">&quot;\t\t\&quot;excitationmode\&quot;: \&quot;%s\&quot;,\n&quot;</span></div><div class="line"><a name="l04008"></a><span class="lineno"> 4008</span>&#160;            <span class="stringliteral">&quot;\t\t\&quot;duration\&quot;: %0.3f,\n&quot;</span></div><div class="line"><a name="l04009"></a><span class="lineno"> 4009</span>&#160;            <span class="stringliteral">&quot;\t\t\&quot;nseqinstances\&quot;: %d,\n&quot;</span></div><div class="line"><a name="l04010"></a><span class="lineno"> 4010</span>&#160;            <span class="stringliteral">&quot;\t\t\&quot;minduration\&quot;: %0.3f,\n&quot;</span></div><div class="line"><a name="l04011"></a><span class="lineno"> 4011</span>&#160;            <span class="stringliteral">&quot;\t\t\&quot;numrf\&quot;: %d,\n&quot;</span></div><div class="line"><a name="l04012"></a><span class="lineno"> 4012</span>&#160;            <span class="stringliteral">&quot;\t\t\&quot;numtrap\&quot;: %d,\n&quot;</span></div><div class="line"><a name="l04013"></a><span class="lineno"> 4013</span>&#160;            <span class="stringliteral">&quot;\t\t\&quot;numwave\&quot;: %d,\n&quot;</span></div><div class="line"><a name="l04014"></a><span class="lineno"> 4014</span>&#160;            <span class="stringliteral">&quot;\t\t\&quot;numacq\&quot;: %d,\n&quot;</span></div><div class="line"><a name="l04015"></a><span class="lineno"> 4015</span>&#160;            <span class="stringliteral">&quot;\t\t\&quot;slicethickness\&quot;: %0.3f,\n&quot;</span></div><div class="line"><a name="l04016"></a><span class="lineno"> 4016</span>&#160;            <span class="stringliteral">&quot;\t\t\&quot;slicepos\&quot;: [&quot;</span>,</div><div class="line"><a name="l04017"></a><span class="lineno"> 4017</span>&#160;            ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, excmode_str, ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> / 1000.00, ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a5af9f3a7de19e7493ce64776bd8f3556">nseqinstances</a> , ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a901ce6fe6b2fa774dc95ea6bab219bd0">min_duration</a> / 1000.00, ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ad1471d1cbc5ed7e8b1bc9d0987bf6eed">numrf</a>, ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a576774535b3b72525cf3821a0ded5124">numtrap</a>, ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a176c1433ab0ff244ebdc3806d77fc3c9">numwave</a>, ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#abe25ffea5925df8869e60f527ce583b4">numacq</a>, slthick_mm);</div><div class="line"><a name="l04018"></a><span class="lineno"> 4018</span>&#160;</div><div class="line"><a name="l04019"></a><span class="lineno"> 4019</span>&#160;    <span class="comment">/* SMS slice locations */</span></div><div class="line"><a name="l04020"></a><span class="lineno"> 4020</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; (nslices - 1); i++) {</div><div class="line"><a name="l04021"></a><span class="lineno"> 4021</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;%0.3f, &quot;</span>, slicepos_mm == NULL ? 0.0 : slicepos_mm[i]);</div><div class="line"><a name="l04022"></a><span class="lineno"> 4022</span>&#160;    }</div><div class="line"><a name="l04023"></a><span class="lineno"> 4023</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;%0.3f]\n\t},&quot;</span>, slicepos_mm == NULL ? 0.0 : slicepos_mm[nslices - 1]);</div><div class="line"><a name="l04024"></a><span class="lineno"> 4024</span>&#160;    fflush(fp);</div><div class="line"><a name="l04025"></a><span class="lineno"> 4025</span>&#160;    fclose(fp);</div><div class="line"><a name="l04026"></a><span class="lineno"> 4026</span>&#160;  }</div><div class="line"><a name="l04027"></a><span class="lineno"> 4027</span>&#160;  </div><div class="line"><a name="l04028"></a><span class="lineno"> 4028</span>&#160;}</div><div class="ttc" id="_k_s_foundation__host_8c_html_aadd2989ca80c0b8efa26f44eba1ea152"><div class="ttname"><a href="_k_s_foundation__host_8c.html#aadd2989ca80c0b8efa26f44eba1ea152">ks_plot_host_slicetime_fullfile</a></div><div class="ttdeci">void ks_plot_host_slicetime_fullfile(char *fullfile)</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3895</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a0af3c4f49a609b3bc02c7be25b9c7c5fadd75ba7d05d9527ea99f8643787d46ac"><div class="ttname"><a href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5fadd75ba7d05d9527ea99f8643787d46ac">KS_PLOT_OFF</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:188</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a576774535b3b72525cf3821a0ded5124"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a576774535b3b72525cf3821a0ded5124">KS_GRADRFCTRL::numtrap</a></div><div class="ttdeci">int numtrap</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:818</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_SEQ_CONTROL::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:984</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a5af9f3a7de19e7493ce64776bd8f3556"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a5af9f3a7de19e7493ce64776bd8f3556">KS_SEQ_CONTROL::nseqinstances</a></div><div class="ttdeci">int nseqinstances</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:982</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_ad1471d1cbc5ed7e8b1bc9d0987bf6eed"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ad1471d1cbc5ed7e8b1bc9d0987bf6eed">KS_GRADRFCTRL::numrf</a></div><div class="ttdeci">int numrf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:816</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a2573e18f36ab5c3d3fc97072edcfab16"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">KS_SEQ_CONTROL::gradrf</a></div><div class="ttdeci">KS_GRADRFCTRL gradrf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:992</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a901ce6fe6b2fa774dc95ea6bab219bd0"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a901ce6fe6b2fa774dc95ea6bab219bd0">KS_SEQ_CONTROL::min_duration</a></div><div class="ttdeci">int min_duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:981</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a0ba82984ac3a22ad68cab5bce5224cf9adbb6a4373075b4e441df71373a3d55ad"><div class="ttname"><a href="_k_s_foundation_8h.html#a0ba82984ac3a22ad68cab5bce5224cf9adbb6a4373075b4e441df71373a3d55ad">KS_PLOT_NO_EXCITATION</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:195</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a0ba82984ac3a22ad68cab5bce5224cf9a31ef5b1dd7ca976daa060cd0bb7aa679"><div class="ttname"><a href="_k_s_foundation_8h.html#a0ba82984ac3a22ad68cab5bce5224cf9a31ef5b1dd7ca976daa060cd0bb7aa679">KS_PLOT_STANDARD</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:194</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_adf724d7e25607bea3d8bf36bb6f8060d"><div class="ttname"><a href="_k_s_foundation__host_8c.html#adf724d7e25607bea3d8bf36bb6f8060d">ks_plot_filefmt</a></div><div class="ttdeci">int ks_plot_filefmt</div><div class="ttdef"><b>Definition:</b> GERequired.e:242</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a176c1433ab0ff244ebdc3806d77fc3c9"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a176c1433ab0ff244ebdc3806d77fc3c9">KS_GRADRFCTRL::numwave</a></div><div class="ttdeci">int numwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:820</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">KS_SEQ_CONTROL::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:990</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_abe25ffea5925df8869e60f527ce583b4"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#abe25ffea5925df8869e60f527ce583b4">KS_GRADRFCTRL::numacq</a></div><div class="ttdeci">int numacq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:822</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="afaafc1f357c7766042d78af3c456380a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afaafc1f357c7766042d78af3c456380a">&#9670;&nbsp;</a></span>ks_plot_host_slicetime_endofslicegroup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_plot_host_slicetime_endofslicegroup </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>desc</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l03932"></a><span class="lineno"> 3932</span>&#160;                                                              {</div><div class="line"><a name="l03933"></a><span class="lineno"> 3933</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__host_8c.html#adf724d7e25607bea3d8bf36bb6f8060d">ks_plot_filefmt</a> == <a class="code" href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5fadd75ba7d05d9527ea99f8643787d46ac">KS_PLOT_OFF</a>) {</div><div class="line"><a name="l03934"></a><span class="lineno"> 3934</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l03935"></a><span class="lineno"> 3935</span>&#160;  }</div><div class="line"><a name="l03936"></a><span class="lineno"> 3936</span>&#160;  <span class="keywordtype">char</span> fname[500];</div><div class="line"><a name="l03937"></a><span class="lineno"> 3937</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#aadd2989ca80c0b8efa26f44eba1ea152">ks_plot_host_slicetime_fullfile</a>(fname);</div><div class="line"><a name="l03938"></a><span class="lineno"> 3938</span>&#160;  FILE* fp = fopen(fname, <span class="stringliteral">&quot;r+&quot;</span>);</div><div class="line"><a name="l03939"></a><span class="lineno"> 3939</span>&#160;  <span class="keywordflow">if</span> (fp == NULL) {<span class="keywordflow">return</span>;}</div><div class="line"><a name="l03940"></a><span class="lineno"> 3940</span>&#160;  fseek(fp, 0, SEEK_END);</div><div class="line"><a name="l03941"></a><span class="lineno"> 3941</span>&#160;  fprintf(fp,</div><div class="line"><a name="l03942"></a><span class="lineno"> 3942</span>&#160;          <span class="stringliteral">&quot;{\n\t&quot;</span></div><div class="line"><a name="l03943"></a><span class="lineno"> 3943</span>&#160;          <span class="stringliteral">&quot;\&quot;groupdescription\&quot;: \&quot;%s\&quot;\n\t&quot;</span></div><div class="line"><a name="l03944"></a><span class="lineno"> 3944</span>&#160;          <span class="stringliteral">&quot;}&quot;</span>, desc == NULL ? <span class="stringliteral">&quot;N/A&quot;</span> : desc);</div><div class="line"><a name="l03945"></a><span class="lineno"> 3945</span>&#160;  fputs(<span class="stringliteral">&quot;],[\n\t{},\n\t&quot;</span>, fp);</div><div class="line"><a name="l03946"></a><span class="lineno"> 3946</span>&#160;  fflush(fp);</div><div class="line"><a name="l03947"></a><span class="lineno"> 3947</span>&#160;  fclose(fp);</div><div class="line"><a name="l03948"></a><span class="lineno"> 3948</span>&#160;}</div><div class="ttc" id="_k_s_foundation__host_8c_html_aadd2989ca80c0b8efa26f44eba1ea152"><div class="ttname"><a href="_k_s_foundation__host_8c.html#aadd2989ca80c0b8efa26f44eba1ea152">ks_plot_host_slicetime_fullfile</a></div><div class="ttdeci">void ks_plot_host_slicetime_fullfile(char *fullfile)</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3895</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a0af3c4f49a609b3bc02c7be25b9c7c5fadd75ba7d05d9527ea99f8643787d46ac"><div class="ttname"><a href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5fadd75ba7d05d9527ea99f8643787d46ac">KS_PLOT_OFF</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:188</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_adf724d7e25607bea3d8bf36bb6f8060d"><div class="ttname"><a href="_k_s_foundation__host_8c.html#adf724d7e25607bea3d8bf36bb6f8060d">ks_plot_filefmt</a></div><div class="ttdeci">int ks_plot_filefmt</div><div class="ttdef"><b>Definition:</b> GERequired.e:242</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af2d5190dc4e1ba1de783916a4c66fc96"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af2d5190dc4e1ba1de783916a4c66fc96">&#9670;&nbsp;</a></span>ks_plot_host_slicetime_endofpass()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_plot_host_slicetime_endofpass </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ad67bd9fb00d294b98a0a3a7fbaac8550"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad67bd9fb00d294b98a0a3a7fbaac8550">&#9670;&nbsp;</a></span>ks_plot_host_slicetime_end()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_plot_host_slicetime_end </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l04031"></a><span class="lineno"> 4031</span>&#160;                                  {</div><div class="line"><a name="l04032"></a><span class="lineno"> 4032</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__host_8c.html#adf724d7e25607bea3d8bf36bb6f8060d">ks_plot_filefmt</a> == <a class="code" href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5fadd75ba7d05d9527ea99f8643787d46ac">KS_PLOT_OFF</a>) {</div><div class="line"><a name="l04033"></a><span class="lineno"> 4033</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l04034"></a><span class="lineno"> 4034</span>&#160;  }</div><div class="line"><a name="l04035"></a><span class="lineno"> 4035</span>&#160;  <span class="keywordtype">char</span> outputdir_uid[250];</div><div class="line"><a name="l04036"></a><span class="lineno"> 4036</span>&#160;  <span class="keywordtype">char</span> cmd[1000];</div><div class="line"><a name="l04037"></a><span class="lineno"> 4037</span>&#160;</div><div class="line"><a name="l04038"></a><span class="lineno"> 4038</span>&#160;  <span class="keywordtype">char</span> path[250];</div><div class="line"><a name="l04039"></a><span class="lineno"> 4039</span>&#160;  <span class="keywordtype">char</span> fname[500];</div><div class="line"><a name="l04040"></a><span class="lineno"> 4040</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#a9354e57ac3b36228518c6f49e3fb8a27">ks_plot_host_slicetime_path</a>(path);</div><div class="line"><a name="l04041"></a><span class="lineno"> 4041</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#aadd2989ca80c0b8efa26f44eba1ea152">ks_plot_host_slicetime_fullfile</a>(fname);</div><div class="line"><a name="l04042"></a><span class="lineno"> 4042</span>&#160;  </div><div class="line"><a name="l04043"></a><span class="lineno"> 4043</span>&#160;  FILE *fp = fopen(fname, <span class="stringliteral">&quot;r+&quot;</span>);</div><div class="line"><a name="l04044"></a><span class="lineno"> 4044</span>&#160;  <span class="keywordtype">int</span> fd = fileno(fp);</div><div class="line"><a name="l04045"></a><span class="lineno"> 4045</span>&#160;  <span class="keywordflow">if</span> (!fp) {<span class="keywordflow">return</span>;}</div><div class="line"><a name="l04046"></a><span class="lineno"> 4046</span>&#160;  fseek(fp, -28, SEEK_END);</div><div class="line"><a name="l04047"></a><span class="lineno"> 4047</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;]\n}&quot;</span>);</div><div class="line"><a name="l04048"></a><span class="lineno"> 4048</span>&#160;  fflush(fp);</div><div class="line"><a name="l04049"></a><span class="lineno"> 4049</span>&#160;  ftruncate(fd, ftell(fp));</div><div class="line"><a name="l04050"></a><span class="lineno"> 4050</span>&#160;  fclose(fp);</div><div class="line"><a name="l04051"></a><span class="lineno"> 4051</span>&#160;  </div><div class="line"><a name="l04052"></a><span class="lineno"> 4052</span>&#160;  outputdir_uid[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l04053"></a><span class="lineno"> 4053</span>&#160;<span class="preprocessor">#ifdef PSD_HW</span></div><div class="line"><a name="l04054"></a><span class="lineno"> 4054</span>&#160;  <span class="comment">/* on MR-scanner */</span></div><div class="line"><a name="l04055"></a><span class="lineno"> 4055</span>&#160;  <span class="keywordtype">char</span> outputdir[250];</div><div class="line"><a name="l04056"></a><span class="lineno"> 4056</span>&#160;  <span class="keywordtype">char</span> pythonpath[] = <span class="stringliteral">&quot;/usr/local/bin/apython&quot;</span>;</div><div class="line"><a name="l04057"></a><span class="lineno"> 4057</span>&#160;  <span class="keywordtype">char</span> psdplotpath[] = <span class="stringliteral">&quot;/usr/local/bin/psdplot_slicetime.py&quot;</span>;</div><div class="line"><a name="l04058"></a><span class="lineno"> 4058</span>&#160;  sprintf(outputdir, <span class="stringliteral">&quot;/usr/g/mrraw/plot/%s/&quot;</span>, <a class="code" href="_k_s_foundation__host_8c.html#af846b49be109f687e9863f2016029516">ks_psdname</a>);</div><div class="line"><a name="l04059"></a><span class="lineno"> 4059</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__host_8c.html#ad3bedeb2f38e3e2bcce90c31354a91d6">ks_plot_kstmp</a>) {</div><div class="line"><a name="l04060"></a><span class="lineno"> 4060</span>&#160;    sprintf(outputdir_uid, <span class="stringliteral">&quot;/usr/g/mrraw/kstmp/%010d/plot/&quot;</span>, <a class="code" href="_k_s_foundation__host_8c.html#a2e788c6338615164f241b755f219c961">rhkacq_uid</a>);</div><div class="line"><a name="l04061"></a><span class="lineno"> 4061</span>&#160;  }</div><div class="line"><a name="l04062"></a><span class="lineno"> 4062</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l04063"></a><span class="lineno"> 4063</span>&#160;  <span class="comment">/* in Simulation */</span></div><div class="line"><a name="l04064"></a><span class="lineno"> 4064</span>&#160;  <span class="keywordtype">char</span> outputdir[] = <span class="stringliteral">&quot;./plot/&quot;</span>;</div><div class="line"><a name="l04065"></a><span class="lineno"> 4065</span>&#160;  <span class="keywordtype">char</span> pythonpath[] = <span class="stringliteral">&quot;apython&quot;</span>;</div><div class="line"><a name="l04066"></a><span class="lineno"> 4066</span>&#160;  <span class="keywordtype">char</span> psdplotpath[] = <span class="stringliteral">&quot;../KSFoundation/psdplot/psdplot_slicetime.py&quot;</span>;</div><div class="line"><a name="l04067"></a><span class="lineno"> 4067</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l04068"></a><span class="lineno"> 4068</span>&#160;</div><div class="line"><a name="l04069"></a><span class="lineno"> 4069</span>&#160;    sprintf(cmd, <span class="stringliteral">&quot;%s %s &quot;</span></div><div class="line"><a name="l04070"></a><span class="lineno"> 4070</span>&#160;                 <span class="stringliteral">&quot;%s &quot;</span></div><div class="line"><a name="l04071"></a><span class="lineno"> 4071</span>&#160;                 <span class="stringliteral">&quot;--outputdir %s %s &amp;&quot;</span>,</div><div class="line"><a name="l04072"></a><span class="lineno"> 4072</span>&#160;            pythonpath, psdplotpath, fname, outputdir, outputdir_uid);</div><div class="line"><a name="l04073"></a><span class="lineno"> 4073</span>&#160;    system(cmd);</div><div class="line"><a name="l04074"></a><span class="lineno"> 4074</span>&#160;</div><div class="line"><a name="l04075"></a><span class="lineno"> 4075</span>&#160;  <span class="keywordflow">return</span>;</div><div class="line"><a name="l04076"></a><span class="lineno"> 4076</span>&#160;}</div><div class="ttc" id="_k_s_foundation__host_8c_html_aadd2989ca80c0b8efa26f44eba1ea152"><div class="ttname"><a href="_k_s_foundation__host_8c.html#aadd2989ca80c0b8efa26f44eba1ea152">ks_plot_host_slicetime_fullfile</a></div><div class="ttdeci">void ks_plot_host_slicetime_fullfile(char *fullfile)</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3895</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a0af3c4f49a609b3bc02c7be25b9c7c5fadd75ba7d05d9527ea99f8643787d46ac"><div class="ttname"><a href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5fadd75ba7d05d9527ea99f8643787d46ac">KS_PLOT_OFF</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:188</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a9354e57ac3b36228518c6f49e3fb8a27"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a9354e57ac3b36228518c6f49e3fb8a27">ks_plot_host_slicetime_path</a></div><div class="ttdeci">void ks_plot_host_slicetime_path(char *path)</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3887</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a2e788c6338615164f241b755f219c961"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a2e788c6338615164f241b755f219c961">rhkacq_uid</a></div><div class="ttdeci">int rhkacq_uid</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_ad3bedeb2f38e3e2bcce90c31354a91d6"><div class="ttname"><a href="_k_s_foundation__host_8c.html#ad3bedeb2f38e3e2bcce90c31354a91d6">ks_plot_kstmp</a></div><div class="ttdeci">int ks_plot_kstmp</div><div class="ttdef"><b>Definition:</b> GERequired.e:243</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_adf724d7e25607bea3d8bf36bb6f8060d"><div class="ttname"><a href="_k_s_foundation__host_8c.html#adf724d7e25607bea3d8bf36bb6f8060d">ks_plot_filefmt</a></div><div class="ttdeci">int ks_plot_filefmt</div><div class="ttdef"><b>Definition:</b> GERequired.e:242</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_af846b49be109f687e9863f2016029516"><div class="ttname"><a href="_k_s_foundation__host_8c.html#af846b49be109f687e9863f2016029516">ks_psdname</a></div><div class="ttdeci">char ks_psdname[256]</div><div class="ttdef"><b>Definition:</b> GERequired.e:218</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9cc16cc637cbb032a1df9434ab3ae900"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9cc16cc637cbb032a1df9434ab3ae900">&#9670;&nbsp;</a></span>ks_plot_host()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_plot_host </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html">KS_SEQ_COLLECTION</a> *&#160;</td>
          <td class="paramname"><em>seqcollection</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *&#160;</td>
          <td class="paramname"><em>plan</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l04079"></a><span class="lineno"> 4079</span>&#160;                                                                                 {</div><div class="line"><a name="l04080"></a><span class="lineno"> 4080</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l04081"></a><span class="lineno"> 4081</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a65c4aa433169274a52c448793e82e12e">numseq</a>; i++) {</div><div class="line"><a name="l04082"></a><span class="lineno"> 4082</span>&#160;    <a class="code" href="_k_s_foundation__host_8c.html#a8f60bc64f5da613130a7b7bfec468476">ks_plot_host_seqctrl</a>(<a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">seqctrlptr</a>[i], plan);</div><div class="line"><a name="l04083"></a><span class="lineno"> 4083</span>&#160;  }</div><div class="line"><a name="l04084"></a><span class="lineno"> 4084</span>&#160;  <span class="keywordflow">return</span>;</div><div class="line"><a name="l04085"></a><span class="lineno"> 4085</span>&#160;}</div><div class="ttc" id="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n_html_a8ab39b275ee333fc1e568a0994db98d1"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">KS_SEQ_COLLECTION::seqctrlptr</a></div><div class="ttdeci">KS_SEQ_CONTROL * seqctrlptr[KS_MAXUNIQUE_SEQUENCES]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1155</div></div>
<div class="ttc" id="ksepi_8e_html_ab5adb9efc118dc1cc8a0dc3c32cb73bf"><div class="ttname"><a href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a></div><div class="ttdeci">KS_SEQ_COLLECTION seqcollection</div><div class="ttdef"><b>Definition:</b> ksepi.e:79</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a8f60bc64f5da613130a7b7bfec468476"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a8f60bc64f5da613130a7b7bfec468476">ks_plot_host_seqctrl</a></div><div class="ttdeci">void ks_plot_host_seqctrl(KS_SEQ_CONTROL *ctrl, KS_PHASEENCODING_PLAN *plan)</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:4088</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n_html_a65c4aa433169274a52c448793e82e12e"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a65c4aa433169274a52c448793e82e12e">KS_SEQ_COLLECTION::numseq</a></div><div class="ttdeci">int numseq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1149</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8f60bc64f5da613130a7b7bfec468476"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8f60bc64f5da613130a7b7bfec468476">&#9670;&nbsp;</a></span>ks_plot_host_seqctrl()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_plot_host_seqctrl </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>ctrl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *&#160;</td>
          <td class="paramname"><em>plan</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l04088"></a><span class="lineno"> 4088</span>&#160;                                                                             {</div><div class="line"><a name="l04089"></a><span class="lineno"> 4089</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#a8c8572af2a79b563b18b80e710bafc0a">ks_plot_host_seqctrl_manyplans</a>(ctrl, &amp;plan, 1);</div><div class="line"><a name="l04090"></a><span class="lineno"> 4090</span>&#160;}</div><div class="ttc" id="_k_s_foundation__host_8c_html_a8c8572af2a79b563b18b80e710bafc0a"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a8c8572af2a79b563b18b80e710bafc0a">ks_plot_host_seqctrl_manyplans</a></div><div class="ttdeci">void ks_plot_host_seqctrl_manyplans(KS_SEQ_CONTROL *ctrl, KS_PHASEENCODING_PLAN **plans, const int num_plans)</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:4093</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad673a4b23913c3c006b3b0052b98e0df"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad673a4b23913c3c006b3b0052b98e0df">&#9670;&nbsp;</a></span>ks_plot_host_seqctrl_manyplans()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_plot_host_seqctrl_manyplans </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>ctrl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> **&#160;</td>
          <td class="paramname"><em>plan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>num_plans</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l04093"></a><span class="lineno"> 4093</span>&#160;                                                                                                              {</div><div class="line"><a name="l04094"></a><span class="lineno"> 4094</span>&#160;</div><div class="line"><a name="l04095"></a><span class="lineno"> 4095</span>&#160;  <span class="keywordtype">char</span> boardc[7] = <span class="stringliteral">&quot;xyzrRto&quot;</span>; <span class="comment">/* x,y,z,rho1, theta, omega */</span></div><div class="line"><a name="l04096"></a><span class="lineno"> 4096</span>&#160;  <span class="keywordtype">char</span> fname[1000];</div><div class="line"><a name="l04097"></a><span class="lineno"> 4097</span>&#160;  <span class="keywordtype">char</span> cmd[250];</div><div class="line"><a name="l04098"></a><span class="lineno"> 4098</span>&#160;  <span class="keywordtype">char</span> outputdir_uid[250];</div><div class="line"><a name="l04099"></a><span class="lineno"> 4099</span>&#160;  FILE* fp;</div><div class="line"><a name="l04100"></a><span class="lineno"> 4100</span>&#160;  <span class="keywordtype">int</span> plan_idx, i, j, w;</div><div class="line"><a name="l04101"></a><span class="lineno"> 4101</span>&#160;  <a class="code" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> loc;</div><div class="line"><a name="l04102"></a><span class="lineno"> 4102</span>&#160;  <a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a>* plan;</div><div class="line"><a name="l04103"></a><span class="lineno"> 4103</span>&#160;</div><div class="line"><a name="l04104"></a><span class="lineno"> 4104</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__host_8c.html#adf724d7e25607bea3d8bf36bb6f8060d">ks_plot_filefmt</a> == <a class="code" href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5fadd75ba7d05d9527ea99f8643787d46ac">KS_PLOT_OFF</a> || ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> == 0 || ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a5af9f3a7de19e7493ce64776bd8f3556">nseqinstances</a> ==  0) {</div><div class="line"><a name="l04105"></a><span class="lineno"> 4105</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l04106"></a><span class="lineno"> 4106</span>&#160;  }</div><div class="line"><a name="l04107"></a><span class="lineno"> 4107</span>&#160;</div><div class="line"><a name="l04108"></a><span class="lineno"> 4108</span>&#160;  <span class="keywordtype">char</span> fileformat_str[10];</div><div class="line"><a name="l04109"></a><span class="lineno"> 4109</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__host_8c.html#adf724d7e25607bea3d8bf36bb6f8060d">ks_plot_filefmt</a> == <a class="code" href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5faac5f8bbc7e8971122b8a663e191d381f">KS_PLOT_MAKEPDF</a>) { strcpy(fileformat_str, <span class="stringliteral">&quot;pdf&quot;</span>); }</div><div class="line"><a name="l04110"></a><span class="lineno"> 4110</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__host_8c.html#adf724d7e25607bea3d8bf36bb6f8060d">ks_plot_filefmt</a> == <a class="code" href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5fae199cefaae88fb3ffc5eee3109bbe3d7">KS_PLOT_MAKEPNG</a> ) { strcpy(fileformat_str, <span class="stringliteral">&quot;png&quot;</span>); }</div><div class="line"><a name="l04111"></a><span class="lineno"> 4111</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__host_8c.html#adf724d7e25607bea3d8bf36bb6f8060d">ks_plot_filefmt</a> == <a class="code" href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5fa79f80dc07b43457247759abc36002038">KS_PLOT_MAKESVG</a> ) { strcpy(fileformat_str, <span class="stringliteral">&quot;svg&quot;</span>); }</div><div class="line"><a name="l04112"></a><span class="lineno"> 4112</span>&#160;</div><div class="line"><a name="l04113"></a><span class="lineno"> 4113</span>&#160;  outputdir_uid[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l04114"></a><span class="lineno"> 4114</span>&#160;</div><div class="line"><a name="l04115"></a><span class="lineno"> 4115</span>&#160;<span class="preprocessor">#ifdef PSD_HW</span></div><div class="line"><a name="l04116"></a><span class="lineno"> 4116</span>&#160;  <span class="comment">/* on MR-scanner */</span></div><div class="line"><a name="l04117"></a><span class="lineno"> 4117</span>&#160;  <span class="keywordtype">char</span> path[250];</div><div class="line"><a name="l04118"></a><span class="lineno"> 4118</span>&#160;  sprintf(path,  <span class="stringliteral">&quot;/usr/g/mrraw/plot/%s/host/&quot;</span>, <a class="code" href="_k_s_foundation__host_8c.html#af846b49be109f687e9863f2016029516">ks_psdname</a>);</div><div class="line"><a name="l04119"></a><span class="lineno"> 4119</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__host_8c.html#ad3bedeb2f38e3e2bcce90c31354a91d6">ks_plot_kstmp</a>) {</div><div class="line"><a name="l04120"></a><span class="lineno"> 4120</span>&#160;    sprintf(outputdir_uid, <span class="stringliteral">&quot;/usr/g/mrraw/kstmp/%010d/plot/&quot;</span>, <a class="code" href="_k_s_foundation__host_8c.html#a2e788c6338615164f241b755f219c961">rhkacq_uid</a>);</div><div class="line"><a name="l04121"></a><span class="lineno"> 4121</span>&#160;  }</div><div class="line"><a name="l04122"></a><span class="lineno"> 4122</span>&#160;  sprintf(cmd, <span class="stringliteral">&quot;mkdir -p %s &gt; /dev/null&quot;</span>, outputdir_uid);</div><div class="line"><a name="l04123"></a><span class="lineno"> 4123</span>&#160;  system(cmd);</div><div class="line"><a name="l04124"></a><span class="lineno"> 4124</span>&#160;  <span class="keywordtype">char</span> outputdir[250];</div><div class="line"><a name="l04125"></a><span class="lineno"> 4125</span>&#160;  sprintf(outputdir, <span class="stringliteral">&quot;/usr/g/mrraw/plot/%s/&quot;</span>, <a class="code" href="_k_s_foundation__host_8c.html#af846b49be109f687e9863f2016029516">ks_psdname</a>);</div><div class="line"><a name="l04126"></a><span class="lineno"> 4126</span>&#160;  <span class="keywordtype">char</span> pythonpath[] = <span class="stringliteral">&quot;/usr/local/bin/apython&quot;</span>;</div><div class="line"><a name="l04127"></a><span class="lineno"> 4127</span>&#160;  <span class="keywordtype">char</span> psdplotpath[] = <span class="stringliteral">&quot;/usr/local/bin/psdplot.py&quot;</span>;</div><div class="line"><a name="l04128"></a><span class="lineno"> 4128</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l04129"></a><span class="lineno"> 4129</span>&#160;  <span class="comment">/* on IPG and on scanner, i.e. we are actually scanning. return quietly */</span></div><div class="line"><a name="l04130"></a><span class="lineno"> 4130</span>&#160;  <span class="keywordflow">return</span>;</div><div class="line"><a name="l04131"></a><span class="lineno"> 4131</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l04132"></a><span class="lineno"> 4132</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l04133"></a><span class="lineno"> 4133</span>&#160;  <span class="comment">/* in Simulation */</span></div><div class="line"><a name="l04134"></a><span class="lineno"> 4134</span>&#160;  <span class="keywordtype">char</span> path[] = <span class="stringliteral">&quot;./plot/host/&quot;</span>;</div><div class="line"><a name="l04135"></a><span class="lineno"> 4135</span>&#160;  <span class="keywordtype">char</span> outputdir[] = <span class="stringliteral">&quot;./plot/&quot;</span>;</div><div class="line"><a name="l04136"></a><span class="lineno"> 4136</span>&#160;  <span class="keywordtype">char</span> pythonpath[] = <span class="stringliteral">&quot;apython&quot;</span>;</div><div class="line"><a name="l04137"></a><span class="lineno"> 4137</span>&#160;  <span class="keywordtype">char</span> psdplotpath[] = <span class="stringliteral">&quot;../KSFoundation/psdplot/psdplot.py&quot;</span>;</div><div class="line"><a name="l04138"></a><span class="lineno"> 4138</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l04139"></a><span class="lineno"> 4139</span>&#160;  sprintf(cmd, <span class="stringliteral">&quot;mkdir -p %s &gt; /dev/null&quot;</span>, path);</div><div class="line"><a name="l04140"></a><span class="lineno"> 4140</span>&#160;  system(cmd);</div><div class="line"><a name="l04141"></a><span class="lineno"> 4141</span>&#160;  <span class="keywordflow">if</span> (ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> &lt;= 0) {</div><div class="line"><a name="l04142"></a><span class="lineno"> 4142</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l04143"></a><span class="lineno"> 4143</span>&#160;  }</div><div class="line"><a name="l04144"></a><span class="lineno"> 4144</span>&#160;  <span class="comment">/* open files */</span></div><div class="line"><a name="l04145"></a><span class="lineno"> 4145</span>&#160;  sprintf(fname, <span class="stringliteral">&quot;%spsdplot_%s_%s.json&quot;</span>, path, <a class="code" href="_k_s_foundation__host_8c.html#af846b49be109f687e9863f2016029516">ks_psdname</a>, ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l04146"></a><span class="lineno"> 4146</span>&#160;  fp = fopen(fname, <span class="stringliteral">&quot;w&quot;</span>);</div><div class="line"><a name="l04147"></a><span class="lineno"> 4147</span>&#160;  <span class="keyword">extern</span> _cvfloat _optr;</div><div class="line"><a name="l04148"></a><span class="lineno"> 4148</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;{\n&quot;</span>);</div><div class="line"><a name="l04149"></a><span class="lineno"> 4149</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;\&quot;metadata\&quot;: {\n&quot;</span>);</div><div class="line"><a name="l04150"></a><span class="lineno"> 4150</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;\t\&quot;mode\&quot;: \&quot;host\&quot;,\n&quot;</span>);</div><div class="line"><a name="l04151"></a><span class="lineno"> 4151</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;\t\&quot;psdname\&quot;:  \&quot;%s\&quot;,\n&quot;</span>, <a class="code" href="_k_s_foundation__host_8c.html#af846b49be109f687e9863f2016029516">ks_psdname</a>);</div><div class="line"><a name="l04152"></a><span class="lineno"> 4152</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;\t\&quot;sequence\&quot;: \&quot;%s\&quot;,\n&quot;</span>, ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l04153"></a><span class="lineno"> 4153</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;\t\&quot;duration\&quot;: %0.3f,\n&quot;</span>, ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>/1000.0);</div><div class="line"><a name="l04154"></a><span class="lineno"> 4154</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;\t\&quot;min_duration\&quot;: %0.3f,\n&quot;</span>, ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a901ce6fe6b2fa774dc95ea6bab219bd0">min_duration</a>/1000.0);</div><div class="line"><a name="l04155"></a><span class="lineno"> 4155</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;\t\&quot;ssi_time\&quot;: %0.3f,\n&quot;</span>, ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6037d68ff7b6f66735a92611628df57">ssi_time</a>/1000.0);</div><div class="line"><a name="l04156"></a><span class="lineno"> 4156</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;\t\&quot;momentstart\&quot;: %.3f,\n&quot;</span>, ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ab9bf2aebde69b811853b4febc57ff5f8">momentstart</a>/1000.0);</div><div class="line"><a name="l04157"></a><span class="lineno"> 4157</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;\t\&quot;optr_desc\&quot;: \&quot;%s\&quot;\n&quot;</span>, _optr.descr);</div><div class="line"><a name="l04158"></a><span class="lineno"> 4158</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;},\n&quot;</span>);</div><div class="line"><a name="l04159"></a><span class="lineno"> 4159</span>&#160;</div><div class="line"><a name="l04160"></a><span class="lineno"> 4160</span>&#160;  <span class="comment">/* PHASE ENCODING PLANS */</span></div><div class="line"><a name="l04161"></a><span class="lineno"> 4161</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;\&quot;phaseencplans\&quot;: [\n&quot;</span>);</div><div class="line"><a name="l04162"></a><span class="lineno"> 4162</span>&#160;  <span class="keywordflow">for</span> (plan_idx = 0; plan_idx &lt; num_plans; plan_idx++) {</div><div class="line"><a name="l04163"></a><span class="lineno"> 4163</span>&#160;    plan = plans[plan_idx];</div><div class="line"><a name="l04164"></a><span class="lineno"> 4164</span>&#160;    <span class="keywordflow">if</span> (plan) {</div><div class="line"><a name="l04165"></a><span class="lineno"> 4165</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;{\n&quot;</span>);</div><div class="line"><a name="l04166"></a><span class="lineno"> 4166</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\&quot;description\&quot;: \&quot;%s\&quot;,\n&quot;</span>, plan-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l04167"></a><span class="lineno"> 4167</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\&quot;num_shots\&quot;: %d,\n&quot;</span>, plan-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#aa2f98be84137da8386df3fc88763823c">num_shots</a>);</div><div class="line"><a name="l04168"></a><span class="lineno"> 4168</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\&quot;etl\&quot;: %d,\n&quot;</span>, plan-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a>);</div><div class="line"><a name="l04169"></a><span class="lineno"> 4169</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\&quot;entries\&quot;: [\n&quot;</span>);</div><div class="line"><a name="l04170"></a><span class="lineno"> 4170</span>&#160;      <span class="keywordtype">int</span> echo, shot;</div><div class="line"><a name="l04171"></a><span class="lineno"> 4171</span>&#160;      <span class="keywordflow">for</span> (shot = 0; shot &lt; plan-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#aa2f98be84137da8386df3fc88763823c">num_shots</a>; shot++) {</div><div class="line"><a name="l04172"></a><span class="lineno"> 4172</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t[&quot;</span>);</div><div class="line"><a name="l04173"></a><span class="lineno"> 4173</span>&#160;        <span class="keywordflow">for</span> (echo = 0; echo &lt; plan-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a>; echo++) {</div><div class="line"><a name="l04174"></a><span class="lineno"> 4174</span>&#160;          <a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html">KS_PHASEENCODING_COORD</a> coord = <a class="code" href="_k_s_foundation_8h.html#a9712828cb11bdaf20671ac4e43c80d3a">ks_phaseencoding_get</a>(plan, echo, shot);</div><div class="line"><a name="l04175"></a><span class="lineno"> 4175</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;[%d, %d]&quot;</span>, coord.<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#ad097e95262501d52829d5cd9a827275c">ky</a>, coord.<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#a7894f45c2928e5a523eeafc5ef4ae8b7">kz</a>);</div><div class="line"><a name="l04176"></a><span class="lineno"> 4176</span>&#160;          <span class="keywordflow">if</span> (echo &lt; (plan-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a> - 1)) {</div><div class="line"><a name="l04177"></a><span class="lineno"> 4177</span>&#160;            fprintf(fp, <span class="stringliteral">&quot;, &quot;</span>);</div><div class="line"><a name="l04178"></a><span class="lineno"> 4178</span>&#160;          }</div><div class="line"><a name="l04179"></a><span class="lineno"> 4179</span>&#160;        }</div><div class="line"><a name="l04180"></a><span class="lineno"> 4180</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;]&quot;</span>);</div><div class="line"><a name="l04181"></a><span class="lineno"> 4181</span>&#160;        <span class="keywordflow">if</span> (shot &lt; (plan-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#aa2f98be84137da8386df3fc88763823c">num_shots</a> - 1)) {</div><div class="line"><a name="l04182"></a><span class="lineno"> 4182</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;,\n&quot;</span>);</div><div class="line"><a name="l04183"></a><span class="lineno"> 4183</span>&#160;        }</div><div class="line"><a name="l04184"></a><span class="lineno"> 4184</span>&#160;      }</div><div class="line"><a name="l04185"></a><span class="lineno"> 4185</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;]\n&quot;</span>);</div><div class="line"><a name="l04186"></a><span class="lineno"> 4186</span>&#160;</div><div class="line"><a name="l04187"></a><span class="lineno"> 4187</span>&#160;      <span class="keywordflow">if</span> (plan_idx &lt; (num_plans-1)) {</div><div class="line"><a name="l04188"></a><span class="lineno"> 4188</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;},\n&quot;</span>);</div><div class="line"><a name="l04189"></a><span class="lineno"> 4189</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04190"></a><span class="lineno"> 4190</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;}\n&quot;</span>);</div><div class="line"><a name="l04191"></a><span class="lineno"> 4191</span>&#160;      }</div><div class="line"><a name="l04192"></a><span class="lineno"> 4192</span>&#160;    }</div><div class="line"><a name="l04193"></a><span class="lineno"> 4193</span>&#160;  }</div><div class="line"><a name="l04194"></a><span class="lineno"> 4194</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;],\n&quot;</span>);</div><div class="line"><a name="l04195"></a><span class="lineno"> 4195</span>&#160;</div><div class="line"><a name="l04196"></a><span class="lineno"> 4196</span>&#160;  <span class="comment">/* TRAPEZOIDS */</span></div><div class="line"><a name="l04197"></a><span class="lineno"> 4197</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;\&quot;frames\&quot;: [\n&quot;</span>);</div><div class="line"><a name="l04198"></a><span class="lineno"> 4198</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;{},\n&quot;</span>);</div><div class="line"><a name="l04199"></a><span class="lineno"> 4199</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;{\n\&quot;trapz\&quot;: {\n&quot;</span>);</div><div class="line"><a name="l04200"></a><span class="lineno"> 4200</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a576774535b3b72525cf3821a0ded5124">numtrap</a>; i++) { <span class="comment">/* each unique trap object */</span></div><div class="line"><a name="l04201"></a><span class="lineno"> 4201</span>&#160;    <a class="code" href="struct_k_s___t_r_a_p.html">KS_TRAP</a>* trap = ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a218dab0fa00815bec264cb1170a615ef">trapptr</a>[i];</div><div class="line"><a name="l04202"></a><span class="lineno"> 4202</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;\t\&quot;%s\&quot;: {\n&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l04203"></a><span class="lineno"> 4203</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;ramptime\&quot;: %0.3f,\n&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a> / 1000.0);</div><div class="line"><a name="l04204"></a><span class="lineno"> 4204</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;plateautime\&quot;: %0.3f,\n&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">plateautime</a> / 1000.0);</div><div class="line"><a name="l04205"></a><span class="lineno"> 4205</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;duration\&quot;: %0.3f,\n&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> / 1000.0);</div><div class="line"><a name="l04206"></a><span class="lineno"> 4206</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;amp\&quot;: %0.6f,\n&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a>);</div><div class="line"><a name="l04207"></a><span class="lineno"> 4207</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;instances\&quot;: [{\n&quot;</span>);</div><div class="line"><a name="l04208"></a><span class="lineno"> 4208</span>&#160;</div><div class="line"><a name="l04209"></a><span class="lineno"> 4209</span>&#160;    <span class="keywordflow">for</span> (j = 0; j &lt; trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>; j++) { <span class="comment">/* each instance of the trap */</span></div><div class="line"><a name="l04210"></a><span class="lineno"> 4210</span>&#160;      loc = trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a89785a274d251fd637bf40923ad5c345">locs</a>[j];</div><div class="line"><a name="l04211"></a><span class="lineno"> 4211</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;board\&quot;: \&quot;%c\&quot;,\n&quot;</span>, boardc[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>]);</div><div class="line"><a name="l04212"></a><span class="lineno"> 4212</span>&#160;      fprintf(fp,<span class="stringliteral">&quot;\t\t\t\&quot;time\&quot;: %0.3f,\n&quot;</span>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> / 1000.0);</div><div class="line"><a name="l04213"></a><span class="lineno"> 4213</span>&#160;      fprintf(fp,<span class="stringliteral">&quot;\t\t\t\&quot;rtscale\&quot;: %0.6f,\n&quot;</span>, (trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a997cdc9de09fbf7b61842aeb8ad3dfbb">rtscale</a> == NULL) ? 1.0f : trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a997cdc9de09fbf7b61842aeb8ad3dfbb">rtscale</a>[j]);</div><div class="line"><a name="l04214"></a><span class="lineno"> 4214</span>&#160;      fprintf(fp,<span class="stringliteral">&quot;\t\t\t\&quot;ampscale\&quot;: %0.6f\n&quot;</span>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a>);</div><div class="line"><a name="l04215"></a><span class="lineno"> 4215</span>&#160;      <span class="keywordflow">if</span> (j == (trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a> -1)) {</div><div class="line"><a name="l04216"></a><span class="lineno"> 4216</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t}]\n&quot;</span>);</div><div class="line"><a name="l04217"></a><span class="lineno"> 4217</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04218"></a><span class="lineno"> 4218</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t},{\n&quot;</span>);</div><div class="line"><a name="l04219"></a><span class="lineno"> 4219</span>&#160;      }</div><div class="line"><a name="l04220"></a><span class="lineno"> 4220</span>&#160;</div><div class="line"><a name="l04221"></a><span class="lineno"> 4221</span>&#160;    }</div><div class="line"><a name="l04222"></a><span class="lineno"> 4222</span>&#160;    <span class="keywordflow">if</span> (i == (ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a576774535b3b72525cf3821a0ded5124">numtrap</a> -1)) {</div><div class="line"><a name="l04223"></a><span class="lineno"> 4223</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t}\n&quot;</span>);</div><div class="line"><a name="l04224"></a><span class="lineno"> 4224</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04225"></a><span class="lineno"> 4225</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t},\n&quot;</span>);</div><div class="line"><a name="l04226"></a><span class="lineno"> 4226</span>&#160;    }</div><div class="line"><a name="l04227"></a><span class="lineno"> 4227</span>&#160;  }</div><div class="line"><a name="l04228"></a><span class="lineno"> 4228</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;},\n&quot;</span>);</div><div class="line"><a name="l04229"></a><span class="lineno"> 4229</span>&#160;</div><div class="line"><a name="l04230"></a><span class="lineno"> 4230</span>&#160;  <span class="comment">/* ACQUISITIONS */</span></div><div class="line"><a name="l04231"></a><span class="lineno"> 4231</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;\&quot;acquisitions\&quot;: [\n&quot;</span>);</div><div class="line"><a name="l04232"></a><span class="lineno"> 4232</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#abe25ffea5925df8869e60f527ce583b4">numacq</a>; i++) { <span class="comment">/* Each unique KS_READ object */</span></div><div class="line"><a name="l04233"></a><span class="lineno"> 4233</span>&#160;    <a class="code" href="struct_k_s___r_e_a_d.html">KS_READ</a>* acq = ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a2389836ad299458a5470e252c06b91dd">readptr</a>[i];</div><div class="line"><a name="l04234"></a><span class="lineno"> 4234</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;\t{\n&quot;</span>);</div><div class="line"><a name="l04235"></a><span class="lineno"> 4235</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;description\&quot;: \&quot;%s\&quot;,\n&quot;</span>, acq-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l04236"></a><span class="lineno"> 4236</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;duration\&quot;: %0.3f,\n&quot;</span>, acq-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> / 1000.0);</div><div class="line"><a name="l04237"></a><span class="lineno"> 4237</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;rbw\&quot;: %0.3f,\n&quot;</span>, acq-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a544d58cc06d73e0f73e464114f6e5318">rbw</a>);</div><div class="line"><a name="l04238"></a><span class="lineno"> 4238</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;samples\&quot;: %d,\n&quot;</span>, acq-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">filt</a>.outputs);</div><div class="line"><a name="l04239"></a><span class="lineno"> 4239</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;time\&quot;: [&quot;</span>);</div><div class="line"><a name="l04240"></a><span class="lineno"> 4240</span>&#160;    <span class="keywordflow">for</span> (j = 0; j &lt; acq-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>; ++j) {</div><div class="line"><a name="l04241"></a><span class="lineno"> 4241</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;%0.3f&quot;</span>, acq-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a94207eb79ef6154f75eb3f363bb5df0a">pos</a>[j] / 1000.0);</div><div class="line"><a name="l04242"></a><span class="lineno"> 4242</span>&#160;      <span class="keywordflow">if</span> (j == (acq-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a> -1)) {</div><div class="line"><a name="l04243"></a><span class="lineno"> 4243</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;]\n&quot;</span>);</div><div class="line"><a name="l04244"></a><span class="lineno"> 4244</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04245"></a><span class="lineno"> 4245</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;, &quot;</span>);</div><div class="line"><a name="l04246"></a><span class="lineno"> 4246</span>&#160;      }</div><div class="line"><a name="l04247"></a><span class="lineno"> 4247</span>&#160;    }</div><div class="line"><a name="l04248"></a><span class="lineno"> 4248</span>&#160;    <span class="keywordflow">if</span> (i == (ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#abe25ffea5925df8869e60f527ce583b4">numacq</a> -1)) {</div><div class="line"><a name="l04249"></a><span class="lineno"> 4249</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t}\n&quot;</span>);</div><div class="line"><a name="l04250"></a><span class="lineno"> 4250</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04251"></a><span class="lineno"> 4251</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t},\n&quot;</span>);</div><div class="line"><a name="l04252"></a><span class="lineno"> 4252</span>&#160;    }</div><div class="line"><a name="l04253"></a><span class="lineno"> 4253</span>&#160;  }</div><div class="line"><a name="l04254"></a><span class="lineno"> 4254</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;],\n&quot;</span>);</div><div class="line"><a name="l04255"></a><span class="lineno"> 4255</span>&#160;</div><div class="line"><a name="l04256"></a><span class="lineno"> 4256</span>&#160;  <span class="comment">/* RF (RHO1) */</span></div><div class="line"><a name="l04257"></a><span class="lineno"> 4257</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;\&quot;rf\&quot;: {\n&quot;</span>);</div><div class="line"><a name="l04258"></a><span class="lineno"> 4258</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ad1471d1cbc5ed7e8b1bc9d0987bf6eed">numrf</a>; i++) { <span class="comment">/* each unique RF object */</span></div><div class="line"><a name="l04259"></a><span class="lineno"> 4259</span>&#160;    <a class="code" href="struct_k_s___r_f.html">KS_RF</a>* rfptr = ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a753f71c73d8169393fcbe8a9b3f4d2c2">rfptr</a>[i];</div><div class="line"><a name="l04260"></a><span class="lineno"> 4260</span>&#160;    <span class="keywordflow">if</span> (rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> &gt; 0) {</div><div class="line"><a name="l04261"></a><span class="lineno"> 4261</span>&#160;      <span class="keywordtype">char</span> roledesc[50];</div><div class="line"><a name="l04262"></a><span class="lineno"> 4262</span>&#160;      <span class="keywordflow">if</span> (rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aea7921a9aa2757a88e843476848ddd55">role</a> == <a class="code" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedacc16dd3ca09dedaf6334a39ee4e46241">KS_RF_ROLE_EXC</a>) {</div><div class="line"><a name="l04263"></a><span class="lineno"> 4263</span>&#160;        strcpy(roledesc,<span class="stringliteral">&quot;KS_RF_ROLE_EXC&quot;</span>);</div><div class="line"><a name="l04264"></a><span class="lineno"> 4264</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aea7921a9aa2757a88e843476848ddd55">role</a> ==  <a class="code" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142beda8f1b938816b04ffdeb45de47204252fd">KS_RF_ROLE_REF</a>) {</div><div class="line"><a name="l04265"></a><span class="lineno"> 4265</span>&#160;        strcpy(roledesc,<span class="stringliteral">&quot;KS_RF_ROLE_REF&quot;</span>);</div><div class="line"><a name="l04266"></a><span class="lineno"> 4266</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aea7921a9aa2757a88e843476848ddd55">role</a> ==  <a class="code" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142beda2e9a4ba49720b15631440951968c2865">KS_RF_ROLE_SPSAT</a>) {</div><div class="line"><a name="l04267"></a><span class="lineno"> 4267</span>&#160;        strcpy(roledesc,<span class="stringliteral">&quot;KS_RF_ROLE_SPSAT&quot;</span>);</div><div class="line"><a name="l04268"></a><span class="lineno"> 4268</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aea7921a9aa2757a88e843476848ddd55">role</a> == <a class="code" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedaff51a67bd02398ae045fb3ebafa40abb">KS_RF_ROLE_CHEMSAT</a>) {</div><div class="line"><a name="l04269"></a><span class="lineno"> 4269</span>&#160;        strcpy(roledesc, <span class="stringliteral">&quot;KS_RF_ROLE_CHEMSAT&quot;</span>);</div><div class="line"><a name="l04270"></a><span class="lineno"> 4270</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aea7921a9aa2757a88e843476848ddd55">role</a> == <a class="code" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedac6b698b041a6da12fb9194c4947ec6e8">KS_RF_ROLE_INV</a>) {</div><div class="line"><a name="l04271"></a><span class="lineno"> 4271</span>&#160;        strcpy(roledesc, <span class="stringliteral">&quot;KS_RF_ROLE_INV&quot;</span>);</div><div class="line"><a name="l04272"></a><span class="lineno"> 4272</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aea7921a9aa2757a88e843476848ddd55">role</a> == <a class="code" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142beda2e9a4ba49720b15631440951968c2865">KS_RF_ROLE_SPSAT</a>) {</div><div class="line"><a name="l04273"></a><span class="lineno"> 4273</span>&#160;        strcpy(roledesc, <span class="stringliteral">&quot;KS_RF_ROLE_SPSAT&quot;</span>);</div><div class="line"><a name="l04274"></a><span class="lineno"> 4274</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04275"></a><span class="lineno"> 4275</span>&#160;        strcpy(roledesc,<span class="stringliteral">&quot;NONE&quot;</span>);</div><div class="line"><a name="l04276"></a><span class="lineno"> 4276</span>&#160;      }</div><div class="line"><a name="l04277"></a><span class="lineno"> 4277</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\&quot;%s\&quot;: {\n&quot;</span>, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l04278"></a><span class="lineno"> 4278</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;description\&quot;: \&quot;%s\&quot;,\n&quot;</span>, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l04279"></a><span class="lineno"> 4279</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;flipangle\&quot;: %0.3f,\n&quot;</span>, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#a7ab9fec3ad0848d2dff5db7279f1a806">flip</a>);</div><div class="line"><a name="l04280"></a><span class="lineno"> 4280</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;nominal_flipangle\&quot;: %0.3f,\n&quot;</span>, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.nom_fa);</div><div class="line"><a name="l04281"></a><span class="lineno"> 4281</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;max_b1\&quot;: %0.6f,\n&quot;</span>, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.max_b1);</div><div class="line"><a name="l04282"></a><span class="lineno"> 4282</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;amp\&quot;: %0.6f,\n&quot;</span>, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#ab508ded41392ee86a2a619d3e93d2373">amp</a>);</div><div class="line"><a name="l04283"></a><span class="lineno"> 4283</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;isodelay\&quot;: %0.3f,\n&quot;</span>, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#af9bc4afb4579b2bf18259e70175090a3">start2iso</a> / 1000.0);</div><div class="line"><a name="l04284"></a><span class="lineno"> 4284</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;duration\&quot;: %0.3f,\n&quot;</span>, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> / 1000.0);</div><div class="line"><a name="l04285"></a><span class="lineno"> 4285</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;role\&quot;: \&quot;%s\&quot;,\n&quot;</span>, roledesc);</div><div class="line"><a name="l04286"></a><span class="lineno"> 4286</span>&#160;</div><div class="line"><a name="l04287"></a><span class="lineno"> 4287</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;omega\&quot;: {\n&quot;</span>);</div><div class="line"><a name="l04288"></a><span class="lineno"> 4288</span>&#160;      <span class="keywordflow">if</span> (rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> &gt; 0) {</div><div class="line"><a name="l04289"></a><span class="lineno"> 4289</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;description\&quot;: \&quot;%s\&quot;,\n&quot;</span>, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l04290"></a><span class="lineno"> 4290</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;duration\&quot;: %0.3f,\n&quot;</span>, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> / 1000.0);</div><div class="line"><a name="l04291"></a><span class="lineno"> 4291</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;waveform\&quot;: [0.0,&quot;</span>);</div><div class="line"><a name="l04292"></a><span class="lineno"> 4292</span>&#160;        <span class="keywordflow">for</span> (w = 0; w &lt; rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>; w++) {</div><div class="line"><a name="l04293"></a><span class="lineno"> 4293</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;%0.6f,&quot;</span>, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[w]);</div><div class="line"><a name="l04294"></a><span class="lineno"> 4294</span>&#160;        }</div><div class="line"><a name="l04295"></a><span class="lineno"> 4295</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;0.0],\n&quot;</span>);</div><div class="line"><a name="l04296"></a><span class="lineno"> 4296</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;instances\&quot;: [{\n&quot;</span>);</div><div class="line"><a name="l04297"></a><span class="lineno"> 4297</span>&#160;        <span class="keywordflow">for</span> (j = 0; j &lt; rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>; j++) {</div><div class="line"><a name="l04298"></a><span class="lineno"> 4298</span>&#160;          loc = rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a89785a274d251fd637bf40923ad5c345">locs</a>[j];</div><div class="line"><a name="l04299"></a><span class="lineno"> 4299</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;\t\t\t\t\&quot;time\&quot;: %0.3f,\n&quot;</span>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>/1000.0);</div><div class="line"><a name="l04300"></a><span class="lineno"> 4300</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;\t\t\t\t\&quot;board\&quot;: \&quot;%c\&quot;,\n&quot;</span>, boardc[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>]);</div><div class="line"><a name="l04301"></a><span class="lineno"> 4301</span>&#160;          fprintf(fp,<span class="stringliteral">&quot;\t\t\t\t\&quot;rtscale\&quot;: %0.6f,\n&quot;</span>, (rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a997cdc9de09fbf7b61842aeb8ad3dfbb">rtscale</a> == NULL) ? 1.0f : rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a997cdc9de09fbf7b61842aeb8ad3dfbb">rtscale</a>[j]);</div><div class="line"><a name="l04302"></a><span class="lineno"> 4302</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;\t\t\t\t\&quot;ampscale\&quot;: %0.6f\n&quot;</span>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a>);</div><div class="line"><a name="l04303"></a><span class="lineno"> 4303</span>&#160;          <span class="keywordflow">if</span> (j == (rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a> -1)) {</div><div class="line"><a name="l04304"></a><span class="lineno"> 4304</span>&#160;            fprintf(fp, <span class="stringliteral">&quot;\t\t\t}]\n&quot;</span>);</div><div class="line"><a name="l04305"></a><span class="lineno"> 4305</span>&#160;          } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04306"></a><span class="lineno"> 4306</span>&#160;            fprintf(fp, <span class="stringliteral">&quot;\t\t\t},{\n&quot;</span>);</div><div class="line"><a name="l04307"></a><span class="lineno"> 4307</span>&#160;          }</div><div class="line"><a name="l04308"></a><span class="lineno"> 4308</span>&#160;        }</div><div class="line"><a name="l04309"></a><span class="lineno"> 4309</span>&#160;      }</div><div class="line"><a name="l04310"></a><span class="lineno"> 4310</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t},\n&quot;</span>); <span class="comment">/* Omega */</span></div><div class="line"><a name="l04311"></a><span class="lineno"> 4311</span>&#160;</div><div class="line"><a name="l04312"></a><span class="lineno"> 4312</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;theta\&quot;: {\n&quot;</span>);</div><div class="line"><a name="l04313"></a><span class="lineno"> 4313</span>&#160;      <span class="keywordflow">if</span> (rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> &gt; 0) {</div><div class="line"><a name="l04314"></a><span class="lineno"> 4314</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;description\&quot;: \&quot;%s\&quot;,\n&quot;</span>, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l04315"></a><span class="lineno"> 4315</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;duration\&quot;: %0.3f,\n&quot;</span>, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> / 1000.0);</div><div class="line"><a name="l04316"></a><span class="lineno"> 4316</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;waveform\&quot;: [0.0,&quot;</span>);</div><div class="line"><a name="l04317"></a><span class="lineno"> 4317</span>&#160;        <span class="keywordflow">for</span> (w = 0; w &lt; rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>; w++) {</div><div class="line"><a name="l04318"></a><span class="lineno"> 4318</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;%0.6f,&quot;</span>, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[w]);</div><div class="line"><a name="l04319"></a><span class="lineno"> 4319</span>&#160;        }</div><div class="line"><a name="l04320"></a><span class="lineno"> 4320</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;0.0],\n&quot;</span>);</div><div class="line"><a name="l04321"></a><span class="lineno"> 4321</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;instances\&quot;: [{\n&quot;</span>);</div><div class="line"><a name="l04322"></a><span class="lineno"> 4322</span>&#160;        <span class="keywordflow">for</span> (j = 0; j &lt; rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>; j++) {</div><div class="line"><a name="l04323"></a><span class="lineno"> 4323</span>&#160;          loc = rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a89785a274d251fd637bf40923ad5c345">locs</a>[j];</div><div class="line"><a name="l04324"></a><span class="lineno"> 4324</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;\t\t\t\t\&quot;time\&quot;: %0.3f,\n&quot;</span>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>/1000.0);</div><div class="line"><a name="l04325"></a><span class="lineno"> 4325</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;\t\t\t\t\&quot;board\&quot;: \&quot;%c\&quot;,\n&quot;</span>, boardc[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>]);</div><div class="line"><a name="l04326"></a><span class="lineno"> 4326</span>&#160;          fprintf(fp,<span class="stringliteral">&quot;\t\t\t\t\&quot;rtscale\&quot;: %0.6f,\n&quot;</span>, (rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a997cdc9de09fbf7b61842aeb8ad3dfbb">rtscale</a> == NULL) ? 1.0f : rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a997cdc9de09fbf7b61842aeb8ad3dfbb">rtscale</a>[j]);</div><div class="line"><a name="l04327"></a><span class="lineno"> 4327</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;\t\t\t\t\&quot;ampscale\&quot;: %0.6f\n&quot;</span>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a>);</div><div class="line"><a name="l04328"></a><span class="lineno"> 4328</span>&#160;          <span class="keywordflow">if</span> (j == (rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a> -1)) {</div><div class="line"><a name="l04329"></a><span class="lineno"> 4329</span>&#160;            fprintf(fp, <span class="stringliteral">&quot;\t\t\t}]\n&quot;</span>);</div><div class="line"><a name="l04330"></a><span class="lineno"> 4330</span>&#160;          } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04331"></a><span class="lineno"> 4331</span>&#160;            fprintf(fp, <span class="stringliteral">&quot;\t\t\t},{\n&quot;</span>);</div><div class="line"><a name="l04332"></a><span class="lineno"> 4332</span>&#160;          }</div><div class="line"><a name="l04333"></a><span class="lineno"> 4333</span>&#160;        }</div><div class="line"><a name="l04334"></a><span class="lineno"> 4334</span>&#160;      }</div><div class="line"><a name="l04335"></a><span class="lineno"> 4335</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t},\n&quot;</span>);  <span class="comment">/* Theta */</span></div><div class="line"><a name="l04336"></a><span class="lineno"> 4336</span>&#160;</div><div class="line"><a name="l04337"></a><span class="lineno"> 4337</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;waveform\&quot;: [0.0,&quot;</span>);</div><div class="line"><a name="l04338"></a><span class="lineno"> 4338</span>&#160;      <span class="keywordflow">for</span> (w = 0; w &lt; rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>; w++) {</div><div class="line"><a name="l04339"></a><span class="lineno"> 4339</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;%0.6f,&quot;</span>, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[w]);</div><div class="line"><a name="l04340"></a><span class="lineno"> 4340</span>&#160;      }</div><div class="line"><a name="l04341"></a><span class="lineno"> 4341</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;0.0],\n&quot;</span>);</div><div class="line"><a name="l04342"></a><span class="lineno"> 4342</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;instances\&quot;: [{\n&quot;</span>);</div><div class="line"><a name="l04343"></a><span class="lineno"> 4343</span>&#160;      <span class="keywordflow">for</span> (j = 0; j &lt; rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>; j++) { <span class="comment">/* each instance of the wave (RHO1) */</span></div><div class="line"><a name="l04344"></a><span class="lineno"> 4344</span>&#160;        loc = rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a89785a274d251fd637bf40923ad5c345">locs</a>[j];</div><div class="line"><a name="l04345"></a><span class="lineno"> 4345</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;time\&quot;: %0.3f,\n&quot;</span>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>/1000.0);</div><div class="line"><a name="l04346"></a><span class="lineno"> 4346</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;board\&quot;: \&quot;%c\&quot;,\n&quot;</span>, boardc[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>]);</div><div class="line"><a name="l04347"></a><span class="lineno"> 4347</span>&#160;        fprintf(fp,<span class="stringliteral">&quot;\t\t\t\&quot;rtscale\&quot;: %0.6f,\n&quot;</span>, (rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a997cdc9de09fbf7b61842aeb8ad3dfbb">rtscale</a> == NULL) ? 1.0f : rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a997cdc9de09fbf7b61842aeb8ad3dfbb">rtscale</a>[j]);</div><div class="line"><a name="l04348"></a><span class="lineno"> 4348</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;ampscale\&quot;: %0.6f\n&quot;</span>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a>);</div><div class="line"><a name="l04349"></a><span class="lineno"> 4349</span>&#160;        <span class="keywordflow">if</span> (j == (rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a> -1)) {</div><div class="line"><a name="l04350"></a><span class="lineno"> 4350</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;\t\t}]\n&quot;</span>);</div><div class="line"><a name="l04351"></a><span class="lineno"> 4351</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04352"></a><span class="lineno"> 4352</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;\t\t},{\n&quot;</span>);</div><div class="line"><a name="l04353"></a><span class="lineno"> 4353</span>&#160;        }</div><div class="line"><a name="l04354"></a><span class="lineno"> 4354</span>&#160;      }</div><div class="line"><a name="l04355"></a><span class="lineno"> 4355</span>&#160;</div><div class="line"><a name="l04356"></a><span class="lineno"> 4356</span>&#160;      <span class="keywordflow">if</span> (i == (ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ad1471d1cbc5ed7e8b1bc9d0987bf6eed">numrf</a> -1)) {</div><div class="line"><a name="l04357"></a><span class="lineno"> 4357</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t}\n&quot;</span>);</div><div class="line"><a name="l04358"></a><span class="lineno"> 4358</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04359"></a><span class="lineno"> 4359</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t},\n&quot;</span>);</div><div class="line"><a name="l04360"></a><span class="lineno"> 4360</span>&#160;      }</div><div class="line"><a name="l04361"></a><span class="lineno"> 4361</span>&#160;    } <span class="comment">/* res &gt; 0 */</span></div><div class="line"><a name="l04362"></a><span class="lineno"> 4362</span>&#160;  } <span class="comment">/* rf */</span></div><div class="line"><a name="l04363"></a><span class="lineno"> 4363</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;},\n&quot;</span>);</div><div class="line"><a name="l04364"></a><span class="lineno"> 4364</span>&#160;</div><div class="line"><a name="l04365"></a><span class="lineno"> 4365</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;\&quot;waves\&quot;: {\n&quot;</span>);</div><div class="line"><a name="l04366"></a><span class="lineno"> 4366</span>&#160;    <span class="comment">/* other (non-RF) waves */</span></div><div class="line"><a name="l04367"></a><span class="lineno"> 4367</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a176c1433ab0ff244ebdc3806d77fc3c9">numwave</a>; i++) {</div><div class="line"><a name="l04368"></a><span class="lineno"> 4368</span>&#160;      <a class="code" href="struct_k_s___w_a_v_e.html">KS_WAVE</a>* waveptr = ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ac44d46e0aeb2f3842bf0cfc1e14ebadc">waveptr</a>[i];</div><div class="line"><a name="l04369"></a><span class="lineno"> 4369</span>&#160;      <span class="keywordflow">if</span> (waveptr-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> &gt; 0) {</div><div class="line"><a name="l04370"></a><span class="lineno"> 4370</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\&quot;%s\&quot;: {\n&quot;</span>, waveptr-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l04371"></a><span class="lineno"> 4371</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;description\&quot;: \&quot;%s\&quot;,\n&quot;</span>, waveptr-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l04372"></a><span class="lineno"> 4372</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;duration\&quot;: %0.3f,\n&quot;</span>, waveptr-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> / 1000.0);</div><div class="line"><a name="l04373"></a><span class="lineno"> 4373</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;waveform\&quot;: [0.0,&quot;</span>);</div><div class="line"><a name="l04374"></a><span class="lineno"> 4374</span>&#160;        <span class="keywordflow">for</span> (w = 0; w &lt; waveptr-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>; w++) {</div><div class="line"><a name="l04375"></a><span class="lineno"> 4375</span>&#160;            fprintf(fp, <span class="stringliteral">&quot;%0.6f,&quot;</span>, waveptr-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[w]);</div><div class="line"><a name="l04376"></a><span class="lineno"> 4376</span>&#160;        }</div><div class="line"><a name="l04377"></a><span class="lineno"> 4377</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;0.0],\n&quot;</span>);</div><div class="line"><a name="l04378"></a><span class="lineno"> 4378</span>&#160;</div><div class="line"><a name="l04379"></a><span class="lineno"> 4379</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;instances\&quot;: [{\n&quot;</span>);</div><div class="line"><a name="l04380"></a><span class="lineno"> 4380</span>&#160;        <span class="keywordflow">for</span> (j = 0; j &lt; waveptr-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>; j++) { <span class="comment">/* each instance of the wave */</span></div><div class="line"><a name="l04381"></a><span class="lineno"> 4381</span>&#160;          loc = waveptr-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a89785a274d251fd637bf40923ad5c345">locs</a>[j];</div><div class="line"><a name="l04382"></a><span class="lineno"> 4382</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;board\&quot;: \&quot;%c\&quot;,\n&quot;</span>, boardc[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>]);</div><div class="line"><a name="l04383"></a><span class="lineno"> 4383</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;time\&quot;: %0.3f,\n&quot;</span>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>/1000.0);</div><div class="line"><a name="l04384"></a><span class="lineno"> 4384</span>&#160;          fprintf(fp,<span class="stringliteral">&quot;\t\t\t\&quot;rtscale\&quot;: %0.6f,\n&quot;</span>, (waveptr-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a997cdc9de09fbf7b61842aeb8ad3dfbb">rtscale</a> == NULL) ? 1.0f : waveptr-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a997cdc9de09fbf7b61842aeb8ad3dfbb">rtscale</a>[j]);</div><div class="line"><a name="l04385"></a><span class="lineno"> 4385</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;ampscale\&quot;: %0.6f\n&quot;</span>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a>);</div><div class="line"><a name="l04386"></a><span class="lineno"> 4386</span>&#160;          <span class="keywordflow">if</span> (j == (waveptr-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a> -1)) {</div><div class="line"><a name="l04387"></a><span class="lineno"> 4387</span>&#160;            fprintf(fp, <span class="stringliteral">&quot;\t\t}]\n&quot;</span>);</div><div class="line"><a name="l04388"></a><span class="lineno"> 4388</span>&#160;          } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04389"></a><span class="lineno"> 4389</span>&#160;            fprintf(fp, <span class="stringliteral">&quot;\t\t},{\n&quot;</span>);</div><div class="line"><a name="l04390"></a><span class="lineno"> 4390</span>&#160;          }</div><div class="line"><a name="l04391"></a><span class="lineno"> 4391</span>&#160;        }</div><div class="line"><a name="l04392"></a><span class="lineno"> 4392</span>&#160;        <span class="keywordflow">if</span> (i == (ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a176c1433ab0ff244ebdc3806d77fc3c9">numwave</a> -1)) {</div><div class="line"><a name="l04393"></a><span class="lineno"> 4393</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;\t}\n&quot;</span>);</div><div class="line"><a name="l04394"></a><span class="lineno"> 4394</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04395"></a><span class="lineno"> 4395</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;\t},\n&quot;</span>);</div><div class="line"><a name="l04396"></a><span class="lineno"> 4396</span>&#160;        }</div><div class="line"><a name="l04397"></a><span class="lineno"> 4397</span>&#160;      } <span class="comment">/* res &gt; 0 */</span></div><div class="line"><a name="l04398"></a><span class="lineno"> 4398</span>&#160;    }</div><div class="line"><a name="l04399"></a><span class="lineno"> 4399</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;}\n&quot;</span>); <span class="comment">/* End waves */</span></div><div class="line"><a name="l04400"></a><span class="lineno"> 4400</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;}\n&quot;</span>); <span class="comment">/* End frame */</span></div><div class="line"><a name="l04401"></a><span class="lineno"> 4401</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;]\n&quot;</span>); <span class="comment">/* End frames */</span></div><div class="line"><a name="l04402"></a><span class="lineno"> 4402</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;}&quot;</span>); <span class="comment">/* End */</span></div><div class="line"><a name="l04403"></a><span class="lineno"> 4403</span>&#160;  fflush(fp);</div><div class="line"><a name="l04404"></a><span class="lineno"> 4404</span>&#160;  fclose(fp);</div><div class="line"><a name="l04405"></a><span class="lineno"> 4405</span>&#160;</div><div class="line"><a name="l04406"></a><span class="lineno"> 4406</span>&#160;  {</div><div class="line"><a name="l04407"></a><span class="lineno"> 4407</span>&#160;    <span class="keywordtype">char</span> cmd[1000];</div><div class="line"><a name="l04408"></a><span class="lineno"> 4408</span>&#160;    sprintf(cmd, <span class="stringliteral">&quot;%s %s %s &quot;</span></div><div class="line"><a name="l04409"></a><span class="lineno"> 4409</span>&#160;                 <span class="stringliteral">&quot;--outputdir %s %s &amp;&quot;</span>,</div><div class="line"><a name="l04410"></a><span class="lineno"> 4410</span>&#160;            pythonpath, psdplotpath, fname,</div><div class="line"><a name="l04411"></a><span class="lineno"> 4411</span>&#160;            outputdir, outputdir_uid);</div><div class="line"><a name="l04412"></a><span class="lineno"> 4412</span>&#160;    system(cmd);</div><div class="line"><a name="l04413"></a><span class="lineno"> 4413</span>&#160;<span class="preprocessor">#ifdef PSD_HW</span></div><div class="line"><a name="l04414"></a><span class="lineno"> 4414</span>&#160;    sprintf(cmd, <span class="stringliteral">&quot;cp %s*.json %s &gt; /dev/null&quot;</span>, path, outputdir_uid);</div><div class="line"><a name="l04415"></a><span class="lineno"> 4415</span>&#160;    system(cmd);</div><div class="line"><a name="l04416"></a><span class="lineno"> 4416</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l04417"></a><span class="lineno"> 4417</span>&#160;  }</div><div class="line"><a name="l04418"></a><span class="lineno"> 4418</span>&#160;  <span class="keywordflow">return</span>;</div><div class="line"><a name="l04419"></a><span class="lineno"> 4419</span>&#160;}</div><div class="ttc" id="struct_k_s___w_a_v_e_html_a997cdc9de09fbf7b61842aeb8ad3dfbb"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a997cdc9de09fbf7b61842aeb8ad3dfbb">KS_WAVE::rtscale</a></div><div class="ttdeci">float * rtscale</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:525</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a878bb367b07dc7dfb5fef5728d2e5b1d"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">KS_TRAP::plateautime</a></div><div class="ttdeci">int plateautime</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:436</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html"><div class="ttname"><a href="struct_k_s___t_r_a_p.html">KS_TRAP</a></div><div class="ttdoc">Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:430</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_aa2f98be84137da8386df3fc88763823c"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#aa2f98be84137da8386df3fc88763823c">KS_PHASEENCODING_PLAN::num_shots</a></div><div class="ttdeci">int num_shots</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1587</div></div>
<div class="ttc" id="struct_k_s___r_f_html_af9bc4afb4579b2bf18259e70175090a3"><div class="ttname"><a href="struct_k_s___r_f.html#af9bc4afb4579b2bf18259e70175090a3">KS_RF::start2iso</a></div><div class="ttdeci">int start2iso</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:793</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a></div><div class="ttdoc">Phase encoding plan for the sequence (2D and 3D)</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1586</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">KS_TRAP::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:431</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a0af3c4f49a609b3bc02c7be25b9c7c5fadd75ba7d05d9527ea99f8643787d46ac"><div class="ttname"><a href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5fadd75ba7d05d9527ea99f8643787d46ac">KS_PLOT_OFF</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:188</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a1910d262855b71da353ed0d07a6c7823"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">KS_SEQLOC::pos</a></div><div class="ttdeci">int pos</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:242</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a753f71c73d8169393fcbe8a9b3f4d2c2"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a753f71c73d8169393fcbe8a9b3f4d2c2">KS_GRADRFCTRL::rfptr</a></div><div class="ttdeci">KS_RF * rfptr[KS_MAXUNIQUE_RF]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:815</div></div>
<div class="ttc" id="struct_k_s___r_f_html_aea7921a9aa2757a88e843476848ddd55"><div class="ttname"><a href="struct_k_s___r_f.html#aea7921a9aa2757a88e843476848ddd55">KS_RF::role</a></div><div class="ttdeci">int role</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:788</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html"><div class="ttname"><a href="struct_k_s___w_a_v_e.html">KS_WAVE</a></div><div class="ttdoc">Core sequence object making arbitrary waveforms on any board (using float data format)</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:514</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a0af3c4f49a609b3bc02c7be25b9c7c5fae199cefaae88fb3ffc5eee3109bbe3d7"><div class="ttname"><a href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5fae199cefaae88fb3ffc5eee3109bbe3d7">KS_PLOT_MAKEPNG</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:191</div></div>
<div class="ttc" id="struct_k_s___r_f_html_ae183c3e4095d1c6d14b3d59a0da97928"><div class="ttname"><a href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">KS_RF::rfpulse</a></div><div class="ttdeci">RF_PULSE rfpulse</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:797</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a89785a274d251fd637bf40923ad5c345"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a89785a274d251fd637bf40923ad5c345">KS_WAVE::locs</a></div><div class="ttdeci">KS_SEQLOC locs[KS_MAXINSTANCES]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:522</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aa324c3517656b8ec032523397a142beda8f1b938816b04ffdeb45de47204252fd"><div class="ttname"><a href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142beda8f1b938816b04ffdeb45de47204252fd">KS_RF_ROLE_REF</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1750</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aa324c3517656b8ec032523397a142bedac6b698b041a6da12fb9194c4947ec6e8"><div class="ttname"><a href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedac6b698b041a6da12fb9194c4947ec6e8">KS_RF_ROLE_INV</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1750</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a576774535b3b72525cf3821a0ded5124"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a576774535b3b72525cf3821a0ded5124">KS_GRADRFCTRL::numtrap</a></div><div class="ttdeci">int numtrap</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:818</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a72a22b96ff3908d2b9a20a3a02647a2f"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">KS_BASE::ninst</a></div><div class="ttdeci">int ninst</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:261</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_ab9bf2aebde69b811853b4febc57ff5f8"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ab9bf2aebde69b811853b4febc57ff5f8">KS_SEQ_CONTROL::momentstart</a></div><div class="ttdeci">int momentstart</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:985</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d_html_ad097e95262501d52829d5cd9a827275c"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#ad097e95262501d52829d5cd9a827275c">KS_PHASEENCODING_COORD::ky</a></div><div class="ttdeci">int ky</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1553</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a2e3f5254967cadb9a41167c6fbf6743e"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">KS_SEQLOC::board</a></div><div class="ttdeci">int board</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:241</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a544d58cc06d73e0f73e464114f6e5318"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a544d58cc06d73e0f73e464114f6e5318">KS_READ::rbw</a></div><div class="ttdeci">float rbw</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:584</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_SEQ_CONTROL::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:984</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a5af9f3a7de19e7493ce64776bd8f3556"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a5af9f3a7de19e7493ce64776bd8f3556">KS_SEQ_CONTROL::nseqinstances</a></div><div class="ttdeci">int nseqinstances</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:982</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aa324c3517656b8ec032523397a142bedacc16dd3ca09dedaf6334a39ee4e46241"><div class="ttname"><a href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedacc16dd3ca09dedaf6334a39ee4e46241">KS_RF_ROLE_EXC</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1750</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_ad1471d1cbc5ed7e8b1bc9d0987bf6eed"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ad1471d1cbc5ed7e8b1bc9d0987bf6eed">KS_GRADRFCTRL::numrf</a></div><div class="ttdeci">int numrf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:816</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a606fbf556e8a297aa1f68b098f6ac2a2"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">KS_SEQLOC::ampscale</a></div><div class="ttdeci">float ampscale</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:243</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a7ab9fec3ad0848d2dff5db7279f1a806"><div class="ttname"><a href="struct_k_s___r_f.html#a7ab9fec3ad0848d2dff5db7279f1a806">KS_RF::flip</a></div><div class="ttdeci">float flip</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:789</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d_html_a7894f45c2928e5a523eeafc5ef4ae8b7"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#a7894f45c2928e5a523eeafc5ef4ae8b7">KS_PHASEENCODING_COORD::kz</a></div><div class="ttdeci">int kz</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1554</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">KS_READ::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:581</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a2573e18f36ab5c3d3fc97072edcfab16"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">KS_SEQ_CONTROL::gradrf</a></div><div class="ttdeci">KS_GRADRFCTRL gradrf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:992</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a1c544bec41003a594ba4ec7d43a3a470">KS_READ::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:582</div></div>
<div class="ttc" id="struct_k_s___r_f_html"><div class="ttname"><a href="struct_k_s___r_f.html">KS_RF</a></div><div class="ttdoc">Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:787</div></div>
<div class="ttc" id="struct_k_s___r_f_html_aecd8b68c159a31a28e2a2ec003b593e2"><div class="ttname"><a href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">KS_RF::thetawave</a></div><div class="ttdeci">KS_WAVE thetawave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:800</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d_html"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html">KS_PHASEENCODING_COORD</a></div><div class="ttdoc">Struct holding a 3D k-space phase encoding location (ky,kz)</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1552</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a9712828cb11bdaf20671ac4e43c80d3a"><div class="ttname"><a href="_k_s_foundation_8h.html#a9712828cb11bdaf20671ac4e43c80d3a">ks_phaseencoding_get</a></div><div class="ttdeci">KS_PHASEENCODING_COORD ks_phaseencoding_get(const KS_PHASEENCODING_PLAN *phaseenc_plan_ptr, int echo, int shot)</div><div class="ttdoc">Get [ky,kz] coordinate from KS_PHASEENCODING_PLAN for given echo and shot</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:308</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a2e788c6338615164f241b755f219c961"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a2e788c6338615164f241b755f219c961">rhkacq_uid</a></div><div class="ttdeci">int rhkacq_uid</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_ad3bedeb2f38e3e2bcce90c31354a91d6"><div class="ttname"><a href="_k_s_foundation__host_8c.html#ad3bedeb2f38e3e2bcce90c31354a91d6">ks_plot_kstmp</a></div><div class="ttdeci">int ks_plot_kstmp</div><div class="ttdef"><b>Definition:</b> GERequired.e:243</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_ac44d46e0aeb2f3842bf0cfc1e14ebadc"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ac44d46e0aeb2f3842bf0cfc1e14ebadc">KS_GRADRFCTRL::waveptr</a></div><div class="ttdeci">KS_WAVE * waveptr[KS_MAXUNIQUE_WAVE]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:819</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a1c544bec41003a594ba4ec7d43a3a470">KS_PHASEENCODING_PLAN::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1589</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a7582325a159d8ec89a4a4ba0fb89e9a9"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">KS_PHASEENCODING_PLAN::etl</a></div><div class="ttdeci">int etl</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1588</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">KS_WAVE::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:516</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a2a9b610a78cdae3ac8ef682bd34f7e0d"><div class="ttname"><a href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">KS_RF::rfwave</a></div><div class="ttdeci">KS_WAVE rfwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:798</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a901ce6fe6b2fa774dc95ea6bab219bd0"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a901ce6fe6b2fa774dc95ea6bab219bd0">KS_SEQ_CONTROL::min_duration</a></div><div class="ttdeci">int min_duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:981</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">KS_WAVE::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:515</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html"><div class="ttname"><a href="struct_k_s___r_e_a_d.html">KS_READ</a></div><div class="ttdoc">Core sequence object that handles a data acquisition window</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:580</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_READ::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:583</div></div>
<div class="ttc" id="struct_k_s___r_f_html_ab508ded41392ee86a2a619d3e93d2373"><div class="ttname"><a href="struct_k_s___r_f.html#ab508ded41392ee86a2a619d3e93d2373">KS_RF::amp</a></div><div class="ttdeci">float amp</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:792</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ab508ded41392ee86a2a619d3e93d2373"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">KS_TRAP::amp</a></div><div class="ttdeci">float amp</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:433</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a></div><div class="ttdoc">typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:240</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a0af3c4f49a609b3bc02c7be25b9c7c5faac5f8bbc7e8971122b8a663e191d381f"><div class="ttname"><a href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5faac5f8bbc7e8971122b8a663e191d381f">KS_PLOT_MAKEPDF</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:189</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_adf724d7e25607bea3d8bf36bb6f8060d"><div class="ttname"><a href="_k_s_foundation__host_8c.html#adf724d7e25607bea3d8bf36bb6f8060d">ks_plot_filefmt</a></div><div class="ttdeci">int ks_plot_filefmt</div><div class="ttdef"><b>Definition:</b> GERequired.e:242</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a89785a274d251fd637bf40923ad5c345"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a89785a274d251fd637bf40923ad5c345">KS_TRAP::locs</a></div><div class="ttdeci">KS_SEQLOC locs[KS_MAXINSTANCES]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:439</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a218dab0fa00815bec264cb1170a615ef"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a218dab0fa00815bec264cb1170a615ef">KS_GRADRFCTRL::trapptr</a></div><div class="ttdeci">KS_TRAP * trapptr[KS_MAXUNIQUE_TRAP]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:817</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_ac6037d68ff7b6f66735a92611628df57"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6037d68ff7b6f66735a92611628df57">KS_SEQ_CONTROL::ssi_time</a></div><div class="ttdeci">int ssi_time</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:983</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">KS_TRAP::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:432</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a176c1433ab0ff244ebdc3806d77fc3c9"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a176c1433ab0ff244ebdc3806d77fc3c9">KS_GRADRFCTRL::numwave</a></div><div class="ttdeci">int numwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:820</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_af846b49be109f687e9863f2016029516"><div class="ttname"><a href="_k_s_foundation__host_8c.html#af846b49be109f687e9863f2016029516">ks_psdname</a></div><div class="ttdeci">char ks_psdname[256]</div><div class="ttdef"><b>Definition:</b> GERequired.e:218</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aa324c3517656b8ec032523397a142bedaff51a67bd02398ae045fb3ebafa40abb"><div class="ttname"><a href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedaff51a67bd02398ae045fb3ebafa40abb">KS_RF_ROLE_CHEMSAT</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1750</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a292f93e48d34cda511fcfb72a05558c2"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">KS_READ::filt</a></div><div class="ttdeci">FILTER_INFO filt</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:585</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a0af3c4f49a609b3bc02c7be25b9c7c5fa79f80dc07b43457247759abc36002038"><div class="ttname"><a href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5fa79f80dc07b43457247759abc36002038">KS_PLOT_MAKESVG</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:190</div></div>
<div class="ttc" id="struct_k_s___r_f_html_aa283d0a503cfda1c25da9f9b9a0d8b1c"><div class="ttname"><a href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">KS_RF::omegawave</a></div><div class="ttdeci">KS_WAVE omegawave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:799</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">KS_SEQ_CONTROL::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:990</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_TRAP::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:437</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a2389836ad299458a5470e252c06b91dd"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a2389836ad299458a5470e252c06b91dd">KS_GRADRFCTRL::readptr</a></div><div class="ttdeci">KS_READ * readptr[KS_MAXUNIQUE_READ]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:821</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a997cdc9de09fbf7b61842aeb8ad3dfbb"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a997cdc9de09fbf7b61842aeb8ad3dfbb">KS_TRAP::rtscale</a></div><div class="ttdeci">float * rtscale</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:442</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aa324c3517656b8ec032523397a142beda2e9a4ba49720b15631440951968c2865"><div class="ttname"><a href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142beda2e9a4ba49720b15631440951968c2865">KS_RF_ROLE_SPSAT</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1750</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a27640b66342aa92e2fecafb0e8471785"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">KS_WAVE::waveform</a></div><div class="ttdeci">KS_WAVEFORM waveform</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:519</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_acbc719dc4e48c2a2df0447875e4348ca"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">KS_TRAP::ramptime</a></div><div class="ttdeci">int ramptime</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:435</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_WAVE::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:518</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_abe25ffea5925df8869e60f527ce583b4"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#abe25ffea5925df8869e60f527ce583b4">KS_GRADRFCTRL::numacq</a></div><div class="ttdeci">int numacq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:822</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a94207eb79ef6154f75eb3f363bb5df0a"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a94207eb79ef6154f75eb3f363bb5df0a">KS_READ::pos</a></div><div class="ttdeci">int pos[KS_MAXUNIQUE_READ]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:586</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="abb36a5018815d55e357775e8515f220d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abb36a5018815d55e357775e8515f220d">&#9670;&nbsp;</a></span>ks_plot_tgt_reset()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_plot_tgt_reset </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>ctrl</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;                                             {</div><div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;  FILE *fp;</div><div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;  <span class="keywordtype">char</span> fname_json[1000];</div><div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;  <span class="keywordtype">char</span> cmd[200];</div><div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;<span class="preprocessor">  #ifdef PSD_HW</span></div><div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;<span class="preprocessor">  #endif</span></div><div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;</div><div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;</div><div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#adf724d7e25607bea3d8bf36bb6f8060d">ks_plot_filefmt</a> == <a class="code" href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5fadd75ba7d05d9527ea99f8643787d46ac">KS_PLOT_OFF</a>) {</div><div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;  }</div><div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;</div><div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;  system(<span class="stringliteral">&quot;mkdir -p ./plot/tgt/&quot;</span>);</div><div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;  sprintf(fname_json, <span class="stringliteral">&quot;./plot/tgt/psdplot_tgt_%s_%s.json&quot;</span>, <a class="code" href="_k_s_foundation__common_8c.html#af846b49be109f687e9863f2016029516">ks_psdname</a>, ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;  sprintf(cmd, <span class="stringliteral">&quot;rm -f %s ./plot/tgt/%s_%s_*_tgt.*&quot;</span>,</div><div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;          fname_json, <a class="code" href="_k_s_foundation__common_8c.html#af846b49be109f687e9863f2016029516">ks_psdname</a>, ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;  system(cmd);</div><div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;  fp = fopen(fname_json, <span class="stringliteral">&quot;w&quot;</span>);</div><div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;{\n&quot;</span></div><div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;              <span class="stringliteral">&quot;\&quot;metadata\&quot;: {\n&quot;</span></div><div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;              <span class="stringliteral">&quot;\t\&quot;mode\&quot;: \&quot;tgt\&quot;,\n&quot;</span></div><div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;              <span class="stringliteral">&quot;\t\&quot;psdname\&quot;:  \&quot;%s\&quot;,\n&quot;</span></div><div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;              <span class="stringliteral">&quot;\t\&quot;sequence\&quot;: \&quot;%s\&quot;,\n&quot;</span></div><div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;              <span class="stringliteral">&quot;\t\&quot;duration\&quot;: %0.3f,\n&quot;</span></div><div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;              <span class="stringliteral">&quot;\t\&quot;min_duration\&quot;: %0.3f,\n&quot;</span></div><div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;              <span class="stringliteral">&quot;\t\&quot;ssi_time\&quot;: %0.3f,\n&quot;</span></div><div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;              <span class="stringliteral">&quot;\t\&quot;momentstart\&quot;: %.3f\n&quot;</span></div><div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;              <span class="stringliteral">&quot;},\n&quot;</span></div><div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;              <span class="stringliteral">&quot;\&quot;frames\&quot;: [\n&quot;</span></div><div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;              <span class="stringliteral">&quot;{}]}&quot;</span>,</div><div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;              <a class="code" href="_k_s_foundation__common_8c.html#af846b49be109f687e9863f2016029516">ks_psdname</a>,</div><div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;              ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>,</div><div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;              ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>/1000.0,</div><div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;              ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a901ce6fe6b2fa774dc95ea6bab219bd0">min_duration</a>/1000.0,</div><div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;              ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6037d68ff7b6f66735a92611628df57">ssi_time</a>/1000.0,</div><div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;              ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ab9bf2aebde69b811853b4febc57ff5f8">momentstart</a>/1000.0</div><div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;          );</div><div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;  fclose(fp);</div><div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_a0af3c4f49a609b3bc02c7be25b9c7c5fadd75ba7d05d9527ea99f8643787d46ac"><div class="ttname"><a href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5fadd75ba7d05d9527ea99f8643787d46ac">KS_PLOT_OFF</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:188</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_ab9bf2aebde69b811853b4febc57ff5f8"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ab9bf2aebde69b811853b4febc57ff5f8">KS_SEQ_CONTROL::momentstart</a></div><div class="ttdeci">int momentstart</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:985</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_SEQ_CONTROL::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:984</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_adf724d7e25607bea3d8bf36bb6f8060d"><div class="ttname"><a href="_k_s_foundation__common_8c.html#adf724d7e25607bea3d8bf36bb6f8060d">ks_plot_filefmt</a></div><div class="ttdeci">int ks_plot_filefmt</div><div class="ttdef"><b>Definition:</b> GERequired.e:242</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a901ce6fe6b2fa774dc95ea6bab219bd0"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a901ce6fe6b2fa774dc95ea6bab219bd0">KS_SEQ_CONTROL::min_duration</a></div><div class="ttdeci">int min_duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:981</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_ac6037d68ff7b6f66735a92611628df57"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6037d68ff7b6f66735a92611628df57">KS_SEQ_CONTROL::ssi_time</a></div><div class="ttdeci">int ssi_time</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:983</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_af846b49be109f687e9863f2016029516"><div class="ttname"><a href="_k_s_foundation__common_8c.html#af846b49be109f687e9863f2016029516">ks_psdname</a></div><div class="ttdeci">char ks_psdname[256]</div><div class="ttdef"><b>Definition:</b> GERequired.e:218</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">KS_SEQ_CONTROL::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:990</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa4d70e1b753a44f18ce002ecb84cd16e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa4d70e1b753a44f18ce002ecb84cd16e">&#9670;&nbsp;</a></span>ks_plot_tgt_addframe()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_plot_tgt_addframe </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>ctrl</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Writes a plot frame to file </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ctrl</td><td>Pointer to sequence control </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;                                                {</div><div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;<span class="preprocessor">  #if (!(defined(SIM) &amp;&amp; defined(IPG)))</span></div><div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;<span class="preprocessor">  #endif</span></div><div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;</div><div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__common_8c.html#adf724d7e25607bea3d8bf36bb6f8060d">ks_plot_filefmt</a> == <a class="code" href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5fadd75ba7d05d9527ea99f8643787d46ac">KS_PLOT_OFF</a>) {</div><div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;  }</div><div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;</div><div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;  <span class="keywordtype">char</span> boardc[7] = <span class="stringliteral">&quot;xyzrRto&quot;</span>; <span class="comment">/* x,y,z,rho1, rho2, theta, omega*/</span></div><div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;  <span class="keywordtype">char</span> fname[1000];</div><div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;  sprintf(fname, <span class="stringliteral">&quot;./plot/tgt/psdplot_tgt_%s_%s.json&quot;</span>, <a class="code" href="_k_s_foundation__common_8c.html#af846b49be109f687e9863f2016029516">ks_psdname</a>, ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;  FILE *fp;</div><div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;  <span class="keywordtype">int</span> i, w, inst, dwell, boardinstance;</div><div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;  <a class="code" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> loc;</div><div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;  fp = fopen(fname, <span class="stringliteral">&quot;r+&quot;</span>);</div><div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;  fseek(fp, -2, SEEK_END);</div><div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;  fputs(<span class="stringliteral">&quot;,{\n&quot;</span>, fp);</div><div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;  <span class="keywordtype">short</span> iamp, gradmax;</div><div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;  <span class="keywordtype">float</span> amp;</div><div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;</div><div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;  <span class="comment">/* TRAPEZOIDS */</span></div><div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;\&quot;trapz\&quot;: {\n&quot;</span>);</div><div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;  fflush(fp);</div><div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;  <a class="code" href="struct_k_s___t_r_a_p.html">KS_TRAP</a>* trap;</div><div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a576774535b3b72525cf3821a0ded5124">numtrap</a>; i++) { <span class="comment">/* Each unique trap object */</span></div><div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;    trap = ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a218dab0fa00815bec264cb1170a615ef">trapptr</a>[i];</div><div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;\t\&quot;%s\&quot;: {\n&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;ramptime\&quot;: %0.3f,\n&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a> / 1000.0);</div><div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;plateautime\&quot;: %0.3f,\n&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">plateautime</a> / 1000.0);</div><div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;duration\&quot;: %0.3f,\n&quot;</span>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> / 1000.0);</div><div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;amp\&quot;: %0.6f,\n&quot;</span>, 1.0);</div><div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;instances\&quot;: [{\n&quot;</span>);</div><div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;    fflush(fp);</div><div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;    <span class="keywordflow">for</span> (inst = 0; inst &lt; ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a218dab0fa00815bec264cb1170a615ef">trapptr</a>[i]-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>; inst++) { <span class="comment">/* Each instance of this trap */</span></div><div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;      loc = trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a89785a274d251fd637bf40923ad5c345">locs</a>[inst];</div><div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;board\&quot;: \&quot;%c\&quot;,\n&quot;</span>, boardc[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>]);</div><div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;time\&quot;: %0.3f,\n&quot;</span>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> / 1000.0);</div><div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;</div><div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;      WF_PULSE* plateau_ptr = trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[inst].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">wf</a>;</div><div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;      boardinstance = trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[inst].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">boardinstance</a>;</div><div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;       <span class="comment">/* Get the linked list of the plateau (used to get the position of all wf instances) */</span></div><div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;      <span class="comment">/* WF_INSTR_HDR instr_plateau = plateau_ptr-&gt;inst_hdr_tail; */</span></div><div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;      <span class="comment">/* WF_INSTR_HDR instr_attack = plateau_ptr-&gt;assoc_pulse-&gt;inst_hdr_tail; */</span> <span class="comment">/* Attack is the associated pulse of the plateau */</span></div><div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;      <span class="comment">/* WF_INSTR_HDR instr_decay = plateau_ptr-&gt;assoc_pulse-&gt;assoc_pulse-&gt;inst_hdr_tail; */</span> <span class="comment">/* Decay is the associated pulse of the attack */</span></div><div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;<span class="comment">      for (idx = 0; idx &lt; (boardinstance); idx++) {</span></div><div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;<span class="comment">        instr_plateau = instr_plateau-&gt;next;</span></div><div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;<span class="comment">        instr_attack = instr_attack-&gt;next;</span></div><div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;<span class="comment">        instr_decay = instr_decay-&gt;next;</span></div><div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;<span class="comment">      }</span></div><div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;<span class="comment">      */</span></div><div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;      <span class="comment">/* Plateau amplitude is written in G/cm */</span></div><div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;      getiamp(&amp;iamp, plateau_ptr, boardinstance);</div><div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;ampscale\&quot;: 1.0,\n&quot;</span>);</div><div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;      gradmax = <a class="code" href="_k_s_foundation__common_8c.html#aa65115d54842eeffc47a1b324caa62ab">ks_syslimits_gradtarget</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>, trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[inst].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>);</div><div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;      <span class="keywordflow">if</span> (loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == OMEGA || loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == THETA) {</div><div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;        gradmax = 1;</div><div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;      }</div><div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;      amp = gradmax * (float)iamp / MAX_PG_IAMP;</div><div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;rtscale\&quot;: %.12f\n&quot;</span>, amp);</div><div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;</div><div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;      <span class="comment">/* char pulsename[100]; */</span></div><div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;      <span class="comment">/* (float)pbeg(plateau_ptr, pulsename, boardinstance)/1000.0 */</span></div><div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;      <span class="comment">/* sprintf(pulsename, &quot;%s%s&quot;, plateau_ptr-&gt;pulsename, &quot;a&quot;); */</span></div><div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;</div><div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;      <span class="keywordflow">if</span> (inst == (trap-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a> -1)) {</div><div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t}]\n&quot;</span>);</div><div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t},{\n&quot;</span>);</div><div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;      }</div><div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;    } <span class="comment">/* inst */</span></div><div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;    <span class="keywordflow">if</span> (i == (ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a576774535b3b72525cf3821a0ded5124">numtrap</a> -1)) {</div><div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t}\n&quot;</span>);</div><div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t},\n&quot;</span>);</div><div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;    }</div><div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;  }</div><div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;},\n&quot;</span>); <span class="comment">/* Trapezoids */</span></div><div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;</div><div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;\&quot;acquisitions\&quot;: [\n&quot;</span>);</div><div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;  <span class="comment">/* ACQUISITIONS */</span></div><div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#abe25ffea5925df8869e60f527ce583b4">numacq</a>; i++) { <span class="comment">/* Each unique KS_READ object */</span></div><div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;    <a class="code" href="struct_k_s___r_e_a_d.html">KS_READ</a>* acq = ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a2389836ad299458a5470e252c06b91dd">readptr</a>[i];</div><div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;\t{\n&quot;</span>);</div><div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;description\&quot;: \&quot;%s\&quot;,\n&quot;</span>, acq-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;duration\&quot;: %0.3f,\n&quot;</span>, acq-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> / 1000.0);</div><div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;rbw\&quot;: %0.3f,\n&quot;</span>, acq-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a544d58cc06d73e0f73e464114f6e5318">rbw</a>);</div><div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;samples\&quot;: %d,\n&quot;</span>, acq-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">filt</a>.outputs);</div><div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;time\&quot;: [&quot;</span>);</div><div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;    <span class="keywordflow">for</span> (inst = 0; inst &lt; acq-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>; ++inst) {</div><div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;%0.3f&quot;</span>, acq-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a94207eb79ef6154f75eb3f363bb5df0a">pos</a>[inst] / 1000.0);</div><div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;      <span class="keywordflow">if</span> (inst == (acq-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a> -1)) {</div><div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;]\n&quot;</span>);</div><div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;, &quot;</span>);</div><div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;      }</div><div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;    } <span class="comment">/* inst */</span></div><div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;    <span class="keywordflow">if</span> (i == (ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#abe25ffea5925df8869e60f527ce583b4">numacq</a> -1)) {</div><div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t}\n&quot;</span>);</div><div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t},\n&quot;</span>);</div><div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;    }</div><div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;  } <span class="comment">/* ACQUISITIONS */</span></div><div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;],\n&quot;</span>); <span class="comment">/* End acquisitions */</span></div><div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;</div><div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;  <span class="comment">/* RF */</span></div><div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;  WF_PULSE* rf_wf;</div><div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;  WF_PULSE* omega_wf;</div><div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;  WF_PULSE* theta_wf;</div><div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;  <span class="keywordtype">short</span> new_wave_iamp;</div><div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#abba996c24da629eea72eecbd9a22a873">KS_IWAVE</a> acquired_wave; <span class="comment">/* short int array */</span></div><div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;\&quot;rf\&quot;: {\n&quot;</span>);</div><div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ad1471d1cbc5ed7e8b1bc9d0987bf6eed">numrf</a>; ++i) { <span class="comment">/* Each unique KS_RF object */</span></div><div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;    <a class="code" href="struct_k_s___r_f.html">KS_RF</a>* rfptr = ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a753f71c73d8169393fcbe8a9b3f4d2c2">rfptr</a>[i];</div><div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;</div><div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;    <span class="keywordflow">if</span> (rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> &gt; 0) {</div><div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;      dwell = rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> / rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>;</div><div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;      <span class="comment">/* RHO */</span></div><div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;      <span class="keywordtype">char</span> roledesc[50];</div><div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;      <span class="keywordflow">if</span> (rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aea7921a9aa2757a88e843476848ddd55">role</a> == <a class="code" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedacc16dd3ca09dedaf6334a39ee4e46241">KS_RF_ROLE_EXC</a>) {</div><div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;        strcpy(roledesc,<span class="stringliteral">&quot;KS_RF_ROLE_EXC&quot;</span>);</div><div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aea7921a9aa2757a88e843476848ddd55">role</a> ==  <a class="code" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142beda8f1b938816b04ffdeb45de47204252fd">KS_RF_ROLE_REF</a>) {</div><div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;        strcpy(roledesc,<span class="stringliteral">&quot;KS_RF_ROLE_REF&quot;</span>);</div><div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aea7921a9aa2757a88e843476848ddd55">role</a> == <a class="code" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedaff51a67bd02398ae045fb3ebafa40abb">KS_RF_ROLE_CHEMSAT</a>) {</div><div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;        strcpy(roledesc, <span class="stringliteral">&quot;KS_RF_ROLE_CHEMSAT&quot;</span>);</div><div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aea7921a9aa2757a88e843476848ddd55">role</a> == <a class="code" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedac6b698b041a6da12fb9194c4947ec6e8">KS_RF_ROLE_INV</a>) {</div><div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;        strcpy(roledesc, <span class="stringliteral">&quot;KS_RF_ROLE_INV&quot;</span>);</div><div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aea7921a9aa2757a88e843476848ddd55">role</a> == <a class="code" href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142beda2e9a4ba49720b15631440951968c2865">KS_RF_ROLE_SPSAT</a>) {</div><div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;        strcpy(roledesc, <span class="stringliteral">&quot;KS_RF_ROLE_SPSAT&quot;</span>);</div><div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;        strcpy(roledesc,<span class="stringliteral">&quot;NONE&quot;</span>);</div><div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;      }</div><div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\&quot;%s\&quot;: {\n&quot;</span>, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;description\&quot;: \&quot;%s\&quot;,\n&quot;</span>, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;flipangle\&quot;: %0.3f,\n&quot;</span>, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#a7ab9fec3ad0848d2dff5db7279f1a806">flip</a>);</div><div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;nominal_flipangle\&quot;: %0.3f,\n&quot;</span>, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.nom_fa);</div><div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;max_b1\&quot;: %0.6f,\n&quot;</span>, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">rfpulse</a>.max_b1);</div><div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;isodelay\&quot;: %0.3f,\n&quot;</span>, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#af9bc4afb4579b2bf18259e70175090a3">start2iso</a> / 1000.0);</div><div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;duration\&quot;: %0.3f,\n&quot;</span>, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> / 1000.0);</div><div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;role\&quot;: \&quot;%s\&quot;,\n&quot;</span>, roledesc);</div><div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;amp\&quot;: %.3f,\n&quot;</span>, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#ab508ded41392ee86a2a619d3e93d2373">amp</a>);</div><div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;      <span class="comment">/* OMEGA */</span></div><div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;omega\&quot;: {\n&quot;</span>);</div><div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;      <span class="keywordflow">if</span> (rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> &gt; 0) {</div><div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;description\&quot;: \&quot;%s\&quot;,\n&quot;</span>, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;duration\&quot;: %0.3f,\n&quot;</span>, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> / 1000.0);</div><div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;instances\&quot;: [{\n&quot;</span>);</div><div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;        <span class="keywordflow">for</span> (inst = 0; inst &lt; rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>; ++inst) {</div><div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;          loc = rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a89785a274d251fd637bf40923ad5c345">locs</a>[inst];</div><div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;          boardinstance = rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[inst].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">boardinstance</a>;</div><div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;          omega_wf = &amp;(rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[OMEGA][<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a>]);</div><div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;          movewaveimm(acquired_wave, omega_wf, boardinstance, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>, FROMHARDWARE);</div><div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;          getiamp(&amp;new_wave_iamp, omega_wf, boardinstance);</div><div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;\t\t\t\t\&quot;waveform\&quot;: [0,&quot;</span>);</div><div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;          <span class="keywordflow">for</span> (w = 0; w &lt; rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>; w++) {</div><div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;            fprintf(fp, <span class="stringliteral">&quot;%d,&quot;</span>, acquired_wave[w]);</div><div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;          }</div><div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;0],\n&quot;</span>);</div><div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;\t\t\t\t\&quot;time\&quot;: %0.3f,\n&quot;</span>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>/1000.0);</div><div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;\t\t\t\t\&quot;board\&quot;: \&quot;%c\&quot;,\n&quot;</span>, boardc[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>]);</div><div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;\t\t\t\t\&quot;ampscale\&quot;: 1.0,\n&quot;</span>);</div><div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;\t\t\t\t\&quot;rtscale\&quot;: %0.12f\n&quot;</span>, (<span class="keywordtype">float</span>)(new_wave_iamp) / (max_pg_wamp * max_pg_wamp));</div><div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;          <span class="keywordflow">if</span> (inst == (rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a> -1)) {</div><div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;            fprintf(fp, <span class="stringliteral">&quot;\t\t\t}]\n&quot;</span>);</div><div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;          } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;            fprintf(fp, <span class="stringliteral">&quot;\t\t\t},{\n&quot;</span>);</div><div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;          }</div><div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;        }</div><div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;      }</div><div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t},\n&quot;</span>); <span class="comment">/* Omega */</span></div><div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;</div><div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;      <span class="comment">/* THETA */</span></div><div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;theta\&quot;: {\n&quot;</span>);</div><div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;      <span class="keywordflow">if</span> (rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> &gt; 0) {</div><div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;description\&quot;: \&quot;%s\&quot;,\n&quot;</span>, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;duration\&quot;: %0.3f,\n&quot;</span>, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> / 1000.0);</div><div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;instances\&quot;: [{\n&quot;</span>);</div><div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;        <span class="keywordflow">for</span> (inst = 0; inst &lt; rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>; ++inst) {</div><div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;          loc = rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a89785a274d251fd637bf40923ad5c345">locs</a>[inst];</div><div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;          boardinstance = rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[inst].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">boardinstance</a>;</div><div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;          theta_wf = &amp;(rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[THETA][<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a>]);</div><div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;          movewaveimm(acquired_wave, theta_wf, boardinstance, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>, FROMHARDWARE);</div><div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;          getiamp(&amp;new_wave_iamp, theta_wf, boardinstance);</div><div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;\t\t\t\t\&quot;waveform\&quot;: [0&quot;</span>);</div><div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;          <span class="keywordflow">for</span> (w = 0; w &lt; rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>; w++) {</div><div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;            fprintf(fp, <span class="stringliteral">&quot;%d,&quot;</span>, acquired_wave[w]);</div><div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;          }</div><div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;0],\n&quot;</span>);</div><div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;\t\t\t\t\&quot;time\&quot;: %0.3f,\n&quot;</span>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>/1000.0);</div><div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;\t\t\t\t\&quot;board\&quot;: \&quot;%c\&quot;,\n&quot;</span>, boardc[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>]);</div><div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;\t\t\t\t\&quot;ampscale\&quot;: 1.0,\n&quot;</span>);</div><div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;\t\t\t\t\&quot;rtscale\&quot;: %0.12f\n&quot;</span>, (<span class="keywordtype">float</span>)(new_wave_iamp) / (max_pg_wamp * max_pg_wamp));</div><div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;          <span class="keywordflow">if</span> (inst == (rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a> -1)) {</div><div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;            fprintf(fp, <span class="stringliteral">&quot;\t\t\t}]\n&quot;</span>);</div><div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;          } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;            fprintf(fp, <span class="stringliteral">&quot;\t\t\t},{\n&quot;</span>);</div><div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;          }</div><div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;        }</div><div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;      }</div><div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t},\n&quot;</span>); <span class="comment">/* Theta */</span></div><div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;</div><div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;instances\&quot;: [{\n&quot;</span>);</div><div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;      <span class="keywordflow">for</span> (inst = 0; inst &lt; rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>; ++inst) {</div><div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;        loc = rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a89785a274d251fd637bf40923ad5c345">locs</a>[inst];</div><div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;        boardinstance = rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[inst].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">boardinstance</a>;</div><div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;        rf_wf = &amp;(rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[RHO][<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a>]);</div><div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;        <span class="comment">/* Get waveform from hardware */</span></div><div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;        movewaveimm(acquired_wave, rf_wf, boardinstance, rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>, FROMHARDWARE);</div><div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;        <span class="comment">/* B1max recalculations */</span></div><div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;        getiamp(&amp;new_wave_iamp, rf_wf, boardinstance);</div><div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;waveform\&quot;: [0,&quot;</span>);</div><div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;        <span class="keywordflow">for</span> (w = 0; w &lt; rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>; w++) {</div><div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;%d,&quot;</span>, acquired_wave[w]);</div><div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;        }</div><div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;0],\n&quot;</span>);</div><div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;board\&quot;: \&quot;%c\&quot;,\n&quot;</span>, boardc[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>]);</div><div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;time\&quot;: %0.3f,\n&quot;</span>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>/1000.0);</div><div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;ampscale\&quot;: 1.0,\n&quot;</span>);</div><div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;rtscale\&quot;: %0.12f\n&quot;</span>, (<span class="keywordtype">float</span>)new_wave_iamp / (rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#ab508ded41392ee86a2a619d3e93d2373">amp</a> * max_pg_wamp * max_pg_wamp));</div><div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;        <span class="keywordflow">if</span> (inst == (rfptr-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a> -1)) {</div><div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;\t\t}]\n&quot;</span>);</div><div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;\t\t},{\n&quot;</span>);</div><div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;        }</div><div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;      }</div><div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;      <span class="keywordflow">if</span> (i == (ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ad1471d1cbc5ed7e8b1bc9d0987bf6eed">numrf</a> -1)) {</div><div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t}\n&quot;</span>);</div><div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t},\n&quot;</span>);</div><div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;      }</div><div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;    } <span class="comment">/* res &gt; 0 */</span></div><div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;</div><div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;</div><div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;  } <span class="comment">/* End RF */</span></div><div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;},\n&quot;</span>); <span class="comment">/* End RF */</span></div><div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;  <span class="comment">/* other (non-RF) waves */</span></div><div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;\&quot;waves\&quot;: {\n&quot;</span>);</div><div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;</div><div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a176c1433ab0ff244ebdc3806d77fc3c9">numwave</a>; i++) { <span class="comment">/* each unique wave object */</span></div><div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;    <a class="code" href="struct_k_s___w_a_v_e.html">KS_WAVE</a>* waveptr = ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ac44d46e0aeb2f3842bf0cfc1e14ebadc">waveptr</a>[i];</div><div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;    dwell = waveptr-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> / waveptr-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>;</div><div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;    <span class="keywordflow">if</span> (waveptr-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> &gt; 0) {</div><div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\&quot;%s\&quot;: {\n&quot;</span>, waveptr-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;description\&quot;: \&quot;%s\&quot;,\n&quot;</span>, waveptr-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;duration\&quot;: %0.3f,\n&quot;</span>, waveptr-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> / 1000.0);</div><div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;      fprintf(fp, <span class="stringliteral">&quot;\t\t\&quot;instances\&quot;: [{\n&quot;</span>);</div><div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;      <span class="keywordflow">for</span> (inst = 0; inst &lt; waveptr-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>; inst++) { <span class="comment">/* each instance of the wave */</span></div><div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;        loc = waveptr-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a89785a274d251fd637bf40923ad5c345">locs</a>[inst];</div><div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;        boardinstance = waveptr-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">boardinstance</a>;</div><div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;        WF_PULSE* other_wf = &amp;(waveptr-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>][<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a>]);</div><div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;        movewaveimm(acquired_wave, other_wf, boardinstance, waveptr-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>, FROMHARDWARE);</div><div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;        getiamp(&amp;new_wave_iamp, other_wf, boardinstance);</div><div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;waveform\&quot;: [0,&quot;</span>);</div><div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;        <span class="keywordflow">for</span> (w = 0; w &lt; waveptr-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>; w++) {</div><div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;%d,&quot;</span>, acquired_wave[w]); <span class="comment">/* Or just waveptr-&gt;waveform[w] ? */</span></div><div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;        }</div><div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;0],\n&quot;</span>);</div><div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;board\&quot;: \&quot;%c\&quot;,\n&quot;</span>, boardc[loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>]);</div><div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;time\&quot;: %0.3f,\n&quot;</span>, loc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>/1000.0);</div><div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;ampscale\&quot;: 1.0,\n&quot;</span>);</div><div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t\t\t\&quot;rtscale\&quot;: %0.12f\n&quot;</span>, (<span class="keywordtype">float</span>)new_wave_iamp / (max_pg_wamp * max_pg_wamp));</div><div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;        <span class="keywordflow">if</span> (inst == (waveptr-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a> -1)) {</div><div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;\t\t}]\n&quot;</span>);</div><div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;\t\t},{\n&quot;</span>);</div><div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;        }</div><div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;      }</div><div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;      <span class="keywordflow">if</span> (i == (ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a>.<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a176c1433ab0ff244ebdc3806d77fc3c9">numwave</a> -1)) {</div><div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t}\n&quot;</span>);</div><div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;        fprintf(fp, <span class="stringliteral">&quot;\t},\n&quot;</span>);</div><div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;      }</div><div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;    } <span class="comment">/* res &gt; 0 */</span></div><div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;  }</div><div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;}\n&quot;</span>); <span class="comment">/* End waves */</span></div><div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;}\n&quot;</span>); <span class="comment">/* End frame */</span></div><div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;  fprintf(fp,<span class="stringliteral">&quot;]}&quot;</span>); <span class="comment">/* End frames*/</span></div><div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;</div><div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;  fflush(fp);</div><div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;  fclose(fp);</div><div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;  <span class="keywordflow">return</span>;</div><div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;}</div><div class="ttc" id="struct_k_s___t_r_a_p_html_a878bb367b07dc7dfb5fef5728d2e5b1d"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">KS_TRAP::plateautime</a></div><div class="ttdeci">int plateautime</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:436</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_abba996c24da629eea72eecbd9a22a873"><div class="ttname"><a href="_k_s_foundation_8h.html#abba996c24da629eea72eecbd9a22a873">KS_IWAVE</a></div><div class="ttdeci">short KS_IWAVE[KS_MAXWAVELEN]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:180</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a42df2e3be0bda47009caae1a7042b522"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">KS_WFINSTANCE::boardinstance</a></div><div class="ttdeci">int boardinstance</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:251</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html"><div class="ttname"><a href="struct_k_s___t_r_a_p.html">KS_TRAP</a></div><div class="ttdoc">Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:430</div></div>
<div class="ttc" id="struct_k_s___r_f_html_af9bc4afb4579b2bf18259e70175090a3"><div class="ttname"><a href="struct_k_s___r_f.html#af9bc4afb4579b2bf18259e70175090a3">KS_RF::start2iso</a></div><div class="ttdeci">int start2iso</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:793</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">KS_TRAP::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:431</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a0af3c4f49a609b3bc02c7be25b9c7c5fadd75ba7d05d9527ea99f8643787d46ac"><div class="ttname"><a href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5fadd75ba7d05d9527ea99f8643787d46ac">KS_PLOT_OFF</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:188</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a1910d262855b71da353ed0d07a6c7823"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">KS_SEQLOC::pos</a></div><div class="ttdeci">int pos</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:242</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a753f71c73d8169393fcbe8a9b3f4d2c2"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a753f71c73d8169393fcbe8a9b3f4d2c2">KS_GRADRFCTRL::rfptr</a></div><div class="ttdeci">KS_RF * rfptr[KS_MAXUNIQUE_RF]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:815</div></div>
<div class="ttc" id="struct_k_s___r_f_html_aea7921a9aa2757a88e843476848ddd55"><div class="ttname"><a href="struct_k_s___r_f.html#aea7921a9aa2757a88e843476848ddd55">KS_RF::role</a></div><div class="ttdeci">int role</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:788</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html"><div class="ttname"><a href="struct_k_s___w_a_v_e.html">KS_WAVE</a></div><div class="ttdoc">Core sequence object making arbitrary waveforms on any board (using float data format)</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:514</div></div>
<div class="ttc" id="struct_k_s___r_f_html_ae183c3e4095d1c6d14b3d59a0da97928"><div class="ttname"><a href="struct_k_s___r_f.html#ae183c3e4095d1c6d14b3d59a0da97928">KS_RF::rfpulse</a></div><div class="ttdeci">RF_PULSE rfpulse</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:797</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a89785a274d251fd637bf40923ad5c345"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a89785a274d251fd637bf40923ad5c345">KS_WAVE::locs</a></div><div class="ttdeci">KS_SEQLOC locs[KS_MAXINSTANCES]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:522</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aa324c3517656b8ec032523397a142beda8f1b938816b04ffdeb45de47204252fd"><div class="ttname"><a href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142beda8f1b938816b04ffdeb45de47204252fd">KS_RF_ROLE_REF</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1750</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aa324c3517656b8ec032523397a142bedac6b698b041a6da12fb9194c4947ec6e8"><div class="ttname"><a href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedac6b698b041a6da12fb9194c4947ec6e8">KS_RF_ROLE_INV</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1750</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a576774535b3b72525cf3821a0ded5124"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a576774535b3b72525cf3821a0ded5124">KS_GRADRFCTRL::numtrap</a></div><div class="ttdeci">int numtrap</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:818</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a72a22b96ff3908d2b9a20a3a02647a2f"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">KS_BASE::ninst</a></div><div class="ttdeci">int ninst</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:261</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a2e3f5254967cadb9a41167c6fbf6743e"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">KS_SEQLOC::board</a></div><div class="ttdeci">int board</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:241</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a544d58cc06d73e0f73e464114f6e5318"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a544d58cc06d73e0f73e464114f6e5318">KS_READ::rbw</a></div><div class="ttdeci">float rbw</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:584</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aa324c3517656b8ec032523397a142bedacc16dd3ca09dedaf6334a39ee4e46241"><div class="ttname"><a href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedacc16dd3ca09dedaf6334a39ee4e46241">KS_RF_ROLE_EXC</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1750</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_ad1471d1cbc5ed7e8b1bc9d0987bf6eed"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ad1471d1cbc5ed7e8b1bc9d0987bf6eed">KS_GRADRFCTRL::numrf</a></div><div class="ttdeci">int numrf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:816</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a7ab9fec3ad0848d2dff5db7279f1a806"><div class="ttname"><a href="struct_k_s___r_f.html#a7ab9fec3ad0848d2dff5db7279f1a806">KS_RF::flip</a></div><div class="ttdeci">float flip</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:789</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">KS_READ::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:581</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a2573e18f36ab5c3d3fc97072edcfab16"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">KS_SEQ_CONTROL::gradrf</a></div><div class="ttdeci">KS_GRADRFCTRL gradrf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:992</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a15be3edad342a49398ca841c2745dc9e"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">KS_TRAP::wfi</a></div><div class="ttdeci">KS_WFINSTANCE * wfi</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:441</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a1c544bec41003a594ba4ec7d43a3a470">KS_READ::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:582</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a15be3edad342a49398ca841c2745dc9e"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">KS_WAVE::wfi</a></div><div class="ttdeci">KS_WFINSTANCE * wfi</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:524</div></div>
<div class="ttc" id="struct_k_s___r_f_html"><div class="ttname"><a href="struct_k_s___r_f.html">KS_RF</a></div><div class="ttdoc">Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:787</div></div>
<div class="ttc" id="struct_k_s___r_f_html_aecd8b68c159a31a28e2a2ec003b593e2"><div class="ttname"><a href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">KS_RF::thetawave</a></div><div class="ttdeci">KS_WAVE thetawave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:800</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a78e529e1d86855310035845e03a4c107"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">KS_WFINSTANCE::loc</a></div><div class="ttdeci">KS_SEQLOC loc</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:253</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_ac44d46e0aeb2f3842bf0cfc1e14ebadc"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ac44d46e0aeb2f3842bf0cfc1e14ebadc">KS_GRADRFCTRL::waveptr</a></div><div class="ttdeci">KS_WAVE * waveptr[KS_MAXUNIQUE_WAVE]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:819</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">KS_WAVE::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:516</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a9428be182c75f60d1b4e6fe36c888afa"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">KS_WAVE::wfpulse</a></div><div class="ttdeci">WF_PULSE ** wfpulse</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:523</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_aa65115d54842eeffc47a1b324caa62ab"><div class="ttname"><a href="_k_s_foundation__common_8c.html#aa65115d54842eeffc47a1b324caa62ab">ks_syslimits_gradtarget</a></div><div class="ttdeci">float ks_syslimits_gradtarget(LOG_GRAD loggrd, WF_PROCESSOR board)</div><div class="ttdoc">Returns the maximum target amplitude for a board (internal use)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:176</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a2a9b610a78cdae3ac8ef682bd34f7e0d"><div class="ttname"><a href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">KS_RF::rfwave</a></div><div class="ttdeci">KS_WAVE rfwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:798</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_adf724d7e25607bea3d8bf36bb6f8060d"><div class="ttname"><a href="_k_s_foundation__common_8c.html#adf724d7e25607bea3d8bf36bb6f8060d">ks_plot_filefmt</a></div><div class="ttdeci">int ks_plot_filefmt</div><div class="ttdef"><b>Definition:</b> GERequired.e:242</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">KS_WAVE::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:515</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html"><div class="ttname"><a href="struct_k_s___r_e_a_d.html">KS_READ</a></div><div class="ttdoc">Core sequence object that handles a data acquisition window</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:580</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_READ::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:583</div></div>
<div class="ttc" id="struct_k_s___r_f_html_ab508ded41392ee86a2a619d3e93d2373"><div class="ttname"><a href="struct_k_s___r_f.html#ab508ded41392ee86a2a619d3e93d2373">KS_RF::amp</a></div><div class="ttdeci">float amp</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:792</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a></div><div class="ttdoc">typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:240</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a558b0ff480e8db364962bd0f203d6958"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">KS_WFINSTANCE::wf</a></div><div class="ttdeci">WF_PULSE * wf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:252</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a89785a274d251fd637bf40923ad5c345"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a89785a274d251fd637bf40923ad5c345">KS_TRAP::locs</a></div><div class="ttdeci">KS_SEQLOC locs[KS_MAXINSTANCES]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:439</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a218dab0fa00815bec264cb1170a615ef"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a218dab0fa00815bec264cb1170a615ef">KS_GRADRFCTRL::trapptr</a></div><div class="ttdeci">KS_TRAP * trapptr[KS_MAXUNIQUE_TRAP]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:817</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32"><div class="ttname"><a href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1754</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">KS_TRAP::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:432</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a176c1433ab0ff244ebdc3806d77fc3c9"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a176c1433ab0ff244ebdc3806d77fc3c9">KS_GRADRFCTRL::numwave</a></div><div class="ttdeci">int numwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:820</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aa324c3517656b8ec032523397a142bedaff51a67bd02398ae045fb3ebafa40abb"><div class="ttname"><a href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142bedaff51a67bd02398ae045fb3ebafa40abb">KS_RF_ROLE_CHEMSAT</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1750</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a292f93e48d34cda511fcfb72a05558c2"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">KS_READ::filt</a></div><div class="ttdeci">FILTER_INFO filt</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:585</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_af846b49be109f687e9863f2016029516"><div class="ttname"><a href="_k_s_foundation__common_8c.html#af846b49be109f687e9863f2016029516">ks_psdname</a></div><div class="ttdeci">char ks_psdname[256]</div><div class="ttdef"><b>Definition:</b> GERequired.e:218</div></div>
<div class="ttc" id="struct_k_s___r_f_html_aa283d0a503cfda1c25da9f9b9a0d8b1c"><div class="ttname"><a href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">KS_RF::omegawave</a></div><div class="ttdeci">KS_WAVE omegawave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:799</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">KS_SEQ_CONTROL::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:990</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_TRAP::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:437</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a2389836ad299458a5470e252c06b91dd"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a2389836ad299458a5470e252c06b91dd">KS_GRADRFCTRL::readptr</a></div><div class="ttdeci">KS_READ * readptr[KS_MAXUNIQUE_READ]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:821</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aa324c3517656b8ec032523397a142beda2e9a4ba49720b15631440951968c2865"><div class="ttname"><a href="_k_s_foundation_8h.html#aa324c3517656b8ec032523397a142beda2e9a4ba49720b15631440951968c2865">KS_RF_ROLE_SPSAT</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1750</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_acbc719dc4e48c2a2df0447875e4348ca"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">KS_TRAP::ramptime</a></div><div class="ttdeci">int ramptime</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:435</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_WAVE::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:518</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_abe25ffea5925df8869e60f527ce583b4"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#abe25ffea5925df8869e60f527ce583b4">KS_GRADRFCTRL::numacq</a></div><div class="ttdeci">int numacq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:822</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a94207eb79ef6154f75eb3f363bb5df0a"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a94207eb79ef6154f75eb3f363bb5df0a">KS_READ::pos</a></div><div class="ttdeci">int pos[KS_MAXUNIQUE_READ]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:586</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aefb58d645ca29e4cfa68403df396e53f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aefb58d645ca29e4cfa68403df396e53f">&#9670;&nbsp;</a></span>ks_scan_rf_ampscale()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_rf_ampscale </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_f.html">KS_RF</a> *&#160;</td>
          <td class="paramname"><em>rf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>instanceno</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>ampscale</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Changes the amplitude of one or all instances of an RF pulse (<a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a>)</h4>
</p>
<p>This function multiplies one instance of a <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object with an amplitude scale factor (3rd arg) that must be in range [-1.0,1.0]. To change all instances of a <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object, use <code>INSTRALL</code> as the 2nd argument.</p>
<p>The actual flip angle for an instance of a <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object is the multiplication of the three factors:</p><ol type="1">
<li>The designed flip angle</li>
<li>The per-instance <code>.ampscale</code> in the <a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> struct passed to <a class="el" href="_k_s_foundation_8h.html#a853cff23395e570cc88aa3405b78c3a9" title="Places a KS_RF sequence object on a board at some position in the pulse sequence">ks_pg_rf()</a></li>
<li>The <code>ampscale</code> value passed in as 3rd argument to this function. Since both ampscale factors are forced to be in range [-1.0,1.0], it is not possible to increase the flip angle beyond the designed value (<code>.flip</code>)</li>
</ol>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">rf</td><td>Pointer to <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">instanceno</td><td>Instance of <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> to change (<code>INSTRALL</code> changes all instances) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ampscale</td><td>RF amplitude scale factor in range [-1.0,1.0] </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                                                                    {</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  <span class="keywordtype">int</span> firstinstance, lastinstance, i;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  <span class="keywordtype">int</span> instramp;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  <a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a> *wfi;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  <span class="keywordtype">int</span> numplaced = rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  <span class="keywordtype">int</span> numplaced = rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  <span class="keywordflow">if</span> (!numplaced) {</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  }</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  <span class="keywordtype">float</span>* tmp = (<span class="keywordtype">float</span>*)realloc(rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a997cdc9de09fbf7b61842aeb8ad3dfbb">rtscale</a>, numplaced * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  <span class="keywordflow">if</span> (!tmp) {</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: rtscale realloc failed&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  }</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a997cdc9de09fbf7b61842aeb8ad3dfbb">rtscale</a> = tmp;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  <span class="keywordflow">if</span> (instanceno == INSTRALL) {</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    firstinstance = 0;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    lastinstance = numplaced - 1;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    firstinstance = instanceno;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    lastinstance = instanceno;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  }</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  <span class="comment">/* input validation */</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  <span class="keywordflow">if</span> (numplaced == 0) {</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  }</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  <span class="keywordflow">if</span> (firstinstance &lt; 0 || lastinstance &gt;= numplaced) {</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_rf_ampscale(%s): instanceno (%d) out of range [0,%d]&quot;</span>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, instanceno, numplaced - 1);</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  }</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  <span class="keywordflow">if</span> (fabs(ampscale) &gt; 1.0) {</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_rf_ampscale(%s): ampscale too large (%f)&quot;</span>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, ampscale);</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  }</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;  <span class="comment">/* set amplitude(s) */</span></div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  <span class="keywordflow">for</span> (i = firstinstance; i &lt;= lastinstance; i++) {</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    wfi = &amp;rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[i];</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    instramp = rf-&gt;<a class="code" href="struct_k_s___r_f.html#ab508ded41392ee86a2a619d3e93d2373">amp</a> * wfi-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> * ampscale * MAX_PG_IAMP;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    setiamp(instramp, wfi-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">wf</a>, wfi-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">boardinstance</a>);</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  } <span class="comment">/* for */</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  <span class="keywordflow">for</span> (i = firstinstance; i &lt;= lastinstance; i++) {</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a997cdc9de09fbf7b61842aeb8ad3dfbb">rtscale</a>[i] = ampscale;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  }</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;} <span class="comment">/* ks_scan_rf_ampscale */</span></div><div class="ttc" id="struct_k_s___w_a_v_e_html_a997cdc9de09fbf7b61842aeb8ad3dfbb"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a997cdc9de09fbf7b61842aeb8ad3dfbb">KS_WAVE::rtscale</a></div><div class="ttdeci">float * rtscale</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:525</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a42df2e3be0bda47009caae1a7042b522"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">KS_WFINSTANCE::boardinstance</a></div><div class="ttdeci">int boardinstance</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:251</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a></div><div class="ttdoc">(Internal use) Structure being a part of various sequence objects to sort them in time across boards...</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:250</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a72a22b96ff3908d2b9a20a3a02647a2f"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">KS_BASE::ninst</a></div><div class="ttdeci">int ninst</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:261</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a606fbf556e8a297aa1f68b098f6ac2a2"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">KS_SEQLOC::ampscale</a></div><div class="ttdeci">float ampscale</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:243</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a15be3edad342a49398ca841c2745dc9e"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">KS_WAVE::wfi</a></div><div class="ttdeci">KS_WFINSTANCE * wfi</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:524</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a78e529e1d86855310035845e03a4c107"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">KS_WFINSTANCE::loc</a></div><div class="ttdeci">KS_SEQLOC loc</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:253</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">KS_WAVE::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:516</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a2a9b610a78cdae3ac8ef682bd34f7e0d"><div class="ttname"><a href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">KS_RF::rfwave</a></div><div class="ttdeci">KS_WAVE rfwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:798</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">KS_WAVE::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:515</div></div>
<div class="ttc" id="struct_k_s___r_f_html_ab508ded41392ee86a2a619d3e93d2373"><div class="ttname"><a href="struct_k_s___r_f.html#ab508ded41392ee86a2a619d3e93d2373">KS_RF::amp</a></div><div class="ttdeci">float amp</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:792</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a558b0ff480e8db364962bd0f203d6958"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">KS_WFINSTANCE::wf</a></div><div class="ttdeci">WF_PULSE * wf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:252</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ada6d1910f42394dc7fb363d85bd6e9c5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ada6d1910f42394dc7fb363d85bd6e9c5">&#9670;&nbsp;</a></span>ks_scan_rf_on()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_rf_on </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_f.html">KS_RF</a> *&#160;</td>
          <td class="paramname"><em>rf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>instanceno</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Resets the amplitude of one or all instances of an RF pulse (<a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a>)</h4>
</p>
<p>This function (re)sets the RF amplitude to the state given by <a class="el" href="_k_s_foundation_8h.html#a853cff23395e570cc88aa3405b78c3a9" title="Places a KS_RF sequence object on a board at some position in the pulse sequence">ks_pg_rf()</a></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">rf</td><td>Pointer to <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">instanceno</td><td>Instance of <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> to change (<code>INSTRALL</code> changes all instances) </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                                              {</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  <a class="code" href="_k_s_foundation__tgt_8c.html#aefb58d645ca29e4cfa68403df396e53f">ks_scan_rf_ampscale</a>(rf, instanceno, 1.0);</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;}</div><div class="ttc" id="_k_s_foundation__tgt_8c_html_aefb58d645ca29e4cfa68403df396e53f"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#aefb58d645ca29e4cfa68403df396e53f">ks_scan_rf_ampscale</a></div><div class="ttdeci">void ks_scan_rf_ampscale(KS_RF *rf, int instanceno, float ampscale)</div><div class="ttdoc">Changes the amplitude of one or all instances of an RF pulse (KS_RF)</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:358</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa67267b854dda4b52334ba189f876bd7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa67267b854dda4b52334ba189f876bd7">&#9670;&nbsp;</a></span>ks_scan_rf_on_chop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_rf_on_chop </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_f.html">KS_RF</a> *&#160;</td>
          <td class="paramname"><em>rf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>instanceno</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Resets the amplitude of one or all instances of an RF pulse (<a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a>) and toggles the sign (chopping)</h4>
</p>
<p>Everytime this function is called, the magnitude of the RF amplitude will be (re)set the RF amplitude to the state given by <a class="el" href="_k_s_foundation_8h.html#a853cff23395e570cc88aa3405b78c3a9" title="Places a KS_RF sequence object on a board at some position in the pulse sequence">ks_pg_rf()</a> and the polarity of the RF amplitude will be changed. If this function is called each TR (RF chopping) for a linear single-line k-space acquisition, a FOV/2 shift will occur in the image with any DC component shifted out to the edges of the image FOV.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">rf</td><td>Pointer to <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">instanceno</td><td>Instance of <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> to change (<code>INSTRALL</code> changes all instances) </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;                                                   {</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">int</span> chopsign = 1.0;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  <a class="code" href="_k_s_foundation__tgt_8c.html#aefb58d645ca29e4cfa68403df396e53f">ks_scan_rf_ampscale</a>(rf, instanceno, (<span class="keywordtype">float</span>) chopsign);</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  chopsign *= -1;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;}</div><div class="ttc" id="_k_s_foundation__tgt_8c_html_aefb58d645ca29e4cfa68403df396e53f"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#aefb58d645ca29e4cfa68403df396e53f">ks_scan_rf_ampscale</a></div><div class="ttdeci">void ks_scan_rf_ampscale(KS_RF *rf, int instanceno, float ampscale)</div><div class="ttdoc">Changes the amplitude of one or all instances of an RF pulse (KS_RF)</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:358</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a99675ab672242a3f37444f01b1246bda"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a99675ab672242a3f37444f01b1246bda">&#9670;&nbsp;</a></span>ks_scan_rf_off()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_rf_off </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_f.html">KS_RF</a> *&#160;</td>
          <td class="paramname"><em>rf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>instanceno</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets the amplitude of one or all instances of an RF pulse (<a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a>) to zero</h4>
</p>
<p>This can be undone by calling <a class="el" href="_k_s_foundation_8h.html#ada6d1910f42394dc7fb363d85bd6e9c5" title="Resets the amplitude of one or all instances of an RF pulse (KS_RF)">ks_scan_rf_on()</a>, <a class="el" href="_k_s_foundation_8h.html#aa67267b854dda4b52334ba189f876bd7" title="Resets the amplitude of one or all instances of an RF pulse (KS_RF) and toggles the sign (chopping)...">ks_scan_rf_on_chop()</a>, or <a class="el" href="_k_s_foundation_8h.html#aefb58d645ca29e4cfa68403df396e53f" title="Changes the amplitude of one or all instances of an RF pulse (KS_RF)">ks_scan_rf_ampscale()</a></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">rf</td><td>Pointer to <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">instanceno</td><td>Instance of <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> to change (<code>INSTRALL</code> changes all instances) </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                                               {</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  <a class="code" href="_k_s_foundation__tgt_8c.html#aefb58d645ca29e4cfa68403df396e53f">ks_scan_rf_ampscale</a>(rf, instanceno, 0.0);</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;}</div><div class="ttc" id="_k_s_foundation__tgt_8c_html_aefb58d645ca29e4cfa68403df396e53f"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#aefb58d645ca29e4cfa68403df396e53f">ks_scan_rf_ampscale</a></div><div class="ttdeci">void ks_scan_rf_ampscale(KS_RF *rf, int instanceno, float ampscale)</div><div class="ttdoc">Changes the amplitude of one or all instances of an RF pulse (KS_RF)</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:358</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae8766ce800f95dd75ca2eece6638326c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae8766ce800f95dd75ca2eece6638326c">&#9670;&nbsp;</a></span>ks_scan_selrf_setfreqphase()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_selrf_setfreqphase </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *&#160;</td>
          <td class="paramname"><em>selrf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>instanceno</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SCAN_INFO&#160;</td>
          <td class="paramname"><em>sliceinfo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>rfphase</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Updates the frequency and phase of one or all instances of a slice selective RF pulse (<a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a>)</h4>
</p>
<p>This function alters the frequency of the RF pulse in a <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> object to excite a spatial location corresponding to the information in <code>sliceinfo.tloc</code>. The phase of the RF pulse is also updated</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">selrf</td><td>Pointer to <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">instanceno</td><td>Instance of <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> to change (<code>INSTRALL</code> changes all instances) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sliceinfo</td><td>SCAN_INFO struct for the current slice to be played out </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rfphase</td><td>Phase of the RF pulse in [degrees] </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                                                                                                       {</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  <span class="keywordtype">int</span> firstinstance, lastinstance;</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;  <span class="keywordtype">float</span> freqoffHz, hertzPerMm, ampscale;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;  <span class="keywordtype">float</span> tloc = sliceinfo.optloc;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;  <span class="keywordtype">int</span> numplaced = selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  <span class="keywordtype">float</span> tloc = 1.0; <span class="comment">/* Simulate offset of 1 mm for plotting in units of [Hz/mm] */</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  <span class="keywordtype">int</span> numplaced = selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;  <span class="keywordflow">if</span> (instanceno == INSTRALL) {</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    firstinstance = 0;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    lastinstance = numplaced - 1;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    firstinstance = instanceno;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    lastinstance = instanceno;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  }</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;  <span class="keywordflow">if</span> (numplaced == 0) {</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  }</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;  <span class="keywordflow">if</span> (firstinstance &lt; 0 || lastinstance &gt;= numplaced) {</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_selrf_setfreqphase(%s): instanceno (%d) out of range [0,%d]&quot;</span>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, instanceno, numplaced - 1);</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  }</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  <span class="comment">/* set frequency */</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  <span class="keywordflow">for</span> (i = firstinstance; i &lt;= lastinstance; i++) {</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  <span class="keywordflow">if</span> (!(i &lt; selrf-&gt;rf.rfwave.base.ngenerated &amp;&amp;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[i].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">wf</a>-&gt;wavegen_type == TYPRHO1 &amp;&amp;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[i].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">wf</a>-&gt;assoc_pulse-&gt;tag == SSPFREQ)) { <span class="comment">/* make sure it has been set up properly */</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_rf_setfreqphase(%s): RF pulse not properly set up or instance # too high&quot;</span>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;  }</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;  <span class="keywordflow">if</span> (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> &gt; 0) {</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <span class="comment">/* gradwave */</span></div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <span class="keywordflow">if</span> (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a> != NULL) {</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;      ampscale = selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[i].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a>;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;      <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_rf_setfreqphase(%s): no gradwave has been set up, setting ampscale = 0&quot;</span>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;      ampscale = 0;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    }</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <span class="comment">/* trapezoid */</span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <span class="keywordflow">if</span> (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">wfi</a> != NULL) {</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;      ampscale = selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[i].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a>;</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;      <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_rf_setfreqphase(%s): no grad has been set up, setting ampscale = 0&quot;</span>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;      ampscale = 0; <span class="comment">/* protect against wfi[i] = NULL, then return 0 amp */</span></div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    }</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;  }</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;  ampscale = (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> &gt; 0) ? selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a89785a274d251fd637bf40923ad5c345">locs</a>[i].<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a></div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                                             : selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a89785a274d251fd637bf40923ad5c345">locs</a>[i].<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a>;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;#endif</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <span class="comment">/* ampscale (a.u.) * GAM [Hz/G] / 10.0 [cm-&gt;mm] * gradamp [G/cm] = [Hz/mm] */</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    hertzPerMm = ampscale * <a class="code" href="_k_s_foundation__tgt_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a> / 10.0 *</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;                 ((selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> &gt; 0) ? <a class="code" href="_k_s_foundation_8h.html#a9261718b4f0e64bab0da0b9e9c2c02f0">ks_calc_selgradamp</a>(selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a6b955cde0388e60c3ec5f602072a8e0f">bw</a>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#aa89aa200e4334657ad976733bebcbc2a">slthick</a>) <span class="comment">/* gradwave slice selection */</span></div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;                                             : selrf-&gt;grad.amp); <span class="comment">/* trapezoid slice selection */</span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    freqoffHz = selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#add1e81760153252b7f921b8f9118edb2">cf_offset</a>; <span class="comment">/* [Hz] */</span></div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <span class="comment">/* optloc-dependent freq offset */</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <span class="keywordflow">if</span> (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> &gt; 0) {</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;      <a class="code" href="_k_s_foundation__tgt_8c.html#a6c406ab72abe3eadd93f7e889e9afd32">ks_scan_omegawave_hz</a>(&amp;selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>, i, hertzPerMm * tloc <span class="comment">/* [Hz] */</span>);</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;      freqoffHz += hertzPerMm * tloc; <span class="comment">/* [Hz] */</span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    }</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="comment">/* set RF frequency offset */</span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    setfrequency(freqoffHz / TARDIS_FREQ_RES, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[i].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">wf</a>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[i].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">boardinstance</a>);</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    <span class="comment">/* calculate phase */</span></div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    {</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;      <span class="keywordtype">double</span> ftime_delay;           <span class="comment">/* floating point time delay in seconds */</span></div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;      <span class="keywordtype">double</span> temp_freq;             <span class="comment">/* frequency offset */</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;      <span class="keywordtype">double</span> tmpphase;</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;      <span class="keywordtype">int</span> syncpos, rfstartpos, time_delay;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;      <span class="comment">/* start of RF pulse wave form (for 1st boardinstance) */</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;      rfstartpos = selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[i].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">wf</a>-&gt;inst_hdr_tail-&gt;start;</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;      <span class="comment">/* start of RF SSP frq pulse  (for 1st boardinstance) */</span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;      syncpos = selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[i].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">wf</a>-&gt;assoc_pulse-&gt;inst_hdr_tail-&gt;start;</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;      <span class="comment">/* time difference between SSP frq and isocenter of RF pulse */</span></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;      time_delay = rfstartpos - syncpos - 9 <span class="comment">/* frq2sync_dly */</span> + RUP_FACTOR(selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> - selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#afa10c3dbec21b5cc34276e741deeb97e">iso2end</a>, 2);</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;      <span class="comment">/*** Modified from GE&#39;s setupphases() ***/</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;      ftime_delay = ((double)time_delay) / ((double) 1.0e6);</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;      temp_freq = (double) freqoffHz;</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;      tmpphase = (rfphase / 360.0 <span class="comment">/* deg-&gt;cycles */</span> - ( temp_freq * ftime_delay )) * 2.0 * PI; <span class="comment">/* radians */</span></div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;      setphase(tmpphase,  selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[i].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">wf</a>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[i].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">boardinstance</a>);</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    }</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  } <span class="comment">/* for each instance */</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;} <span class="comment">/* ks_scan_selrf_setfreqphase */</span></div><div class="ttc" id="struct_k_s___s_e_l_r_f_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#af33317a98ade78e3ac252b33cbb794af">KS_SELRF::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1340</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a42df2e3be0bda47009caae1a7042b522"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">KS_WFINSTANCE::boardinstance</a></div><div class="ttdeci">int boardinstance</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:251</div></div>
<div class="ttc" id="struct_k_s___r_f_html_add1e81760153252b7f921b8f9118edb2"><div class="ttname"><a href="struct_k_s___r_f.html#add1e81760153252b7f921b8f9118edb2">KS_RF::cf_offset</a></div><div class="ttdeci">float cf_offset</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:791</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_a607347e9c1c7a9eef21fff556faccc3f"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">KS_SELRF::gradwave</a></div><div class="ttdeci">KS_WAVE gradwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1342</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a89785a274d251fd637bf40923ad5c345"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a89785a274d251fd637bf40923ad5c345">KS_WAVE::locs</a></div><div class="ttdeci">KS_SEQLOC locs[KS_MAXINSTANCES]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:522</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a72a22b96ff3908d2b9a20a3a02647a2f"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">KS_BASE::ninst</a></div><div class="ttdeci">int ninst</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:261</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a606fbf556e8a297aa1f68b098f6ac2a2"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">KS_SEQLOC::ampscale</a></div><div class="ttdeci">float ampscale</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:243</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a15be3edad342a49398ca841c2745dc9e"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">KS_TRAP::wfi</a></div><div class="ttdeci">KS_WFINSTANCE * wfi</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:441</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a15be3edad342a49398ca841c2745dc9e"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">KS_WAVE::wfi</a></div><div class="ttdeci">KS_WFINSTANCE * wfi</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:524</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a78e529e1d86855310035845e03a4c107"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">KS_WFINSTANCE::loc</a></div><div class="ttdeci">KS_SEQLOC loc</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:253</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_adeab1cc34f1a7f20f41e8825d849981e"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">KS_SELRF::rf</a></div><div class="ttdeci">KS_RF rf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1334</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">KS_WAVE::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:516</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a6c406ab72abe3eadd93f7e889e9afd32"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a6c406ab72abe3eadd93f7e889e9afd32">ks_scan_omegawave_hz</a></div><div class="ttdeci">void ks_scan_omegawave_hz(KS_WAVE *wave, int instanceno, float Hz)</div><div class="ttdoc">Updates a KS_WAVE object on the OMEGA board to produce a frequency offset</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:40</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a2a9b610a78cdae3ac8ef682bd34f7e0d"><div class="ttname"><a href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">KS_RF::rfwave</a></div><div class="ttdeci">KS_WAVE rfwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:798</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">KS_WAVE::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:515</div></div>
<div class="ttc" id="struct_k_s___r_f_html_afa10c3dbec21b5cc34276e741deeb97e"><div class="ttname"><a href="struct_k_s___r_f.html#afa10c3dbec21b5cc34276e741deeb97e">KS_RF::iso2end</a></div><div class="ttdeci">int iso2end</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:794</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a89785a274d251fd637bf40923ad5c345"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a89785a274d251fd637bf40923ad5c345">KS_TRAP::locs</a></div><div class="ttdeci">KS_SEQLOC locs[KS_MAXINSTANCES]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:439</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a558b0ff480e8db364962bd0f203d6958"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">KS_WFINSTANCE::wf</a></div><div class="ttdeci">WF_PULSE * wf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:252</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a9261718b4f0e64bab0da0b9e9c2c02f0"><div class="ttname"><a href="_k_s_foundation_8h.html#a9261718b4f0e64bab0da0b9e9c2c02f0">ks_calc_selgradamp</a></div><div class="ttdeci">float ks_calc_selgradamp(float rfbw, float slthick)</div><div class="ttdoc">Returns the gradient amplitude in [G/cm] necessary for slice selection (internal use)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:242</div></div>
<div class="ttc" id="struct_k_s___r_f_html_aa283d0a503cfda1c25da9f9b9a0d8b1c"><div class="ttname"><a href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">KS_RF::omegawave</a></div><div class="ttdeci">KS_WAVE omegawave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:799</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a2875ace95558531062d08465b2bcc282"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a></div><div class="ttdeci">float GAM</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_WAVE::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:518</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_aa89aa200e4334657ad976733bebcbc2a"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#aa89aa200e4334657ad976733bebcbc2a">KS_SELRF::slthick</a></div><div class="ttdeci">float slthick</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1336</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a6b955cde0388e60c3ec5f602072a8e0f"><div class="ttname"><a href="struct_k_s___r_f.html#a6b955cde0388e60c3ec5f602072a8e0f">KS_RF::bw</a></div><div class="ttdeci">float bw</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:790</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="adb1b77a3c2cb4a699081c3ba79ba428c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adb1b77a3c2cb4a699081c3ba79ba428c">&#9670;&nbsp;</a></span>ks_scan_selrf_setfreqphase_pins()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_selrf_setfreqphase_pins </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *&#160;</td>
          <td class="paramname"><em>selrf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>instanceno</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SCAN_INFO&#160;</td>
          <td class="paramname"><em>sliceinfo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sms_multiband_factor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>sms_slice_gap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>rfphase</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Updates the off-center phase-modulation of one or all instances of a PINS RF pulse (<a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a>)</h4>
</p>
<p>This function alters the phase of the PINS RF pulse in a <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> object to excite spatial locations corresponding to the information in <code>sliceinfo.tloc</code>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">selrf</td><td>Pointer to <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">instanceno</td><td>Instance of <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> to change (<code>INSTRALL</code> changes all instances) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sliceinfo</td><td>SCAN_INFO struct for the current slice to be played out </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sms_multiband_factor</td><td></td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sms_slice_gap</td><td>in [mm] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rfphase</td><td>Phase of the RF pulse in [degrees] </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                                                      {</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  <span class="keywordtype">int</span> firstinstance, lastinstance, j;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  <span class="keywordtype">int</span> phaseIndex = 1;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  <a class="code" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> newwave = <a class="code" href="_k_s_foundation_8h.html#ae837f68085b812e9e22a659cc26a42cc">KS_INIT_WAVE</a>;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  <span class="keywordtype">float</span> locOffset;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  <span class="keywordtype">float</span> phaseIncrement;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  <span class="keywordtype">int</span> numplaced = selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>;</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  <span class="keywordtype">int</span> numplaced = selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  <span class="keywordflow">if</span> (instanceno == INSTRALL) {</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    firstinstance = 0;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    lastinstance = numplaced - 1;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    firstinstance = instanceno;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    lastinstance = instanceno;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  }</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  <span class="keywordflow">if</span> (numplaced == 0) {</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  }</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  <span class="keywordflow">if</span> (firstinstance &lt; 0 || lastinstance &gt;= numplaced) {</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_selrf_setfreqphase_pins(%s): instanceno (%d) out of range [0,%d]&quot;</span>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, instanceno, numplaced - 1);</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  }</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  newwave = selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  locOffset = sliceinfo.optloc;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  phaseIncrement = (360.0 / sms_slice_gap) * locOffset;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  <span class="comment">/* If the MB-factor is even, center the slice group */</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  <span class="keywordflow">if</span> (sms_multiband_factor % 2 == 0) {</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    phaseIncrement += 180.0;</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  }</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  <span class="keywordflow">for</span> (j = 0; j &lt; selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>; j++) {</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <span class="keywordflow">if</span> (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[j] != 0) {</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;      newwave.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[j] = selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[j] + ((float)phaseIndex * phaseIncrement) + rfphase;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    }</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <span class="keywordflow">if</span> (j &lt; selrf-&gt;rf.thetawave.res - 1) {</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;      <span class="keywordflow">if</span> ((selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[j] != 0) &amp;&amp; (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[j + 1] == 0)) {</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        phaseIndex++;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;      }</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    }</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  }</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;  <span class="keywordflow">for</span> (i = firstinstance; i &lt;= lastinstance; i++) {</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <span class="comment">/* set RF frequency &amp; phase offset to zero */</span></div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    setfrequency(0.0, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[i].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">wf</a>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[i].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">boardinstance</a>);</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    setphase(0.0, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[i].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">wf</a>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[i].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">boardinstance</a>);</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <span class="comment">/* move modified thetawave to hardware */</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <a class="code" href="_k_s_foundation__tgt_8c.html#a2e916337476b7566b3bf033824f964ba">ks_scan_wave2hardware</a>(&amp;selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>, newwave.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>);</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  }</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;} <span class="comment">/* ks_scan_selrf_setfreqphase_pins */</span></div><div class="ttc" id="_k_s_foundation__tgt_8c_html_a2e916337476b7566b3bf033824f964ba"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a2e916337476b7566b3bf033824f964ba">ks_scan_wave2hardware</a></div><div class="ttdeci">void ks_scan_wave2hardware(KS_WAVE *wave, const KS_WAVEFORM newwave)</div><div class="ttdoc">Moves a waveform belonging to a KS_WAVE sequence object to hardware</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:694</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a42df2e3be0bda47009caae1a7042b522"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">KS_WFINSTANCE::boardinstance</a></div><div class="ttdeci">int boardinstance</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:251</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html"><div class="ttname"><a href="struct_k_s___w_a_v_e.html">KS_WAVE</a></div><div class="ttdoc">Core sequence object making arbitrary waveforms on any board (using float data format)</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:514</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ae837f68085b812e9e22a659cc26a42cc"><div class="ttname"><a href="_k_s_foundation_8h.html#ae837f68085b812e9e22a659cc26a42cc">KS_INIT_WAVE</a></div><div class="ttdeci">#define KS_INIT_WAVE</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:145</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a72a22b96ff3908d2b9a20a3a02647a2f"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">KS_BASE::ninst</a></div><div class="ttdeci">int ninst</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:261</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a15be3edad342a49398ca841c2745dc9e"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">KS_WAVE::wfi</a></div><div class="ttdeci">KS_WFINSTANCE * wfi</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:524</div></div>
<div class="ttc" id="struct_k_s___r_f_html_aecd8b68c159a31a28e2a2ec003b593e2"><div class="ttname"><a href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">KS_RF::thetawave</a></div><div class="ttdeci">KS_WAVE thetawave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:800</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_adeab1cc34f1a7f20f41e8825d849981e"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">KS_SELRF::rf</a></div><div class="ttdeci">KS_RF rf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1334</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">KS_WAVE::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:516</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a2a9b610a78cdae3ac8ef682bd34f7e0d"><div class="ttname"><a href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">KS_RF::rfwave</a></div><div class="ttdeci">KS_WAVE rfwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:798</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">KS_WAVE::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:515</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a558b0ff480e8db364962bd0f203d6958"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">KS_WFINSTANCE::wf</a></div><div class="ttdeci">WF_PULSE * wf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:252</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a27640b66342aa92e2fecafb0e8471785"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">KS_WAVE::waveform</a></div><div class="ttdeci">KS_WAVEFORM waveform</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:519</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="abaf9de92fbb264944d41ef719f5bc438"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abaf9de92fbb264944d41ef719f5bc438">&#9670;&nbsp;</a></span>ks_scan_rf_setphase()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_rf_setphase </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_f.html">KS_RF</a> *&#160;</td>
          <td class="paramname"><em>rf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>instanceno</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>rfphase</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Updates the phase of one or all instances of an RF pulse (<a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a>)</h4>
</p>
<p>This function sets the phase of an RF pulse object (<a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a>). Can be used for RF spoiling</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">rf</td><td>Pointer to KS_SEL </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">instanceno</td><td>Instance of <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> to change (<code>INSTRALL</code> changes all instances) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rfphase</td><td>Phase of the RF pulse in [degrees] </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                                                                     {</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;  <span class="keywordtype">int</span> firstinstance, lastinstance;</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;<span class="preprocessor">  #ifdef IPG</span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    <span class="keywordtype">int</span> numplaced = rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="preprocessor">  #else</span></div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <span class="keywordtype">int</span> numplaced = rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="preprocessor">  #endif</span></div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;  <span class="keywordflow">if</span> (instanceno == INSTRALL) {</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    firstinstance = 0;</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    lastinstance = numplaced - 1;</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    firstinstance = instanceno;</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    lastinstance = instanceno;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;  }</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;  <span class="keywordflow">if</span> (numplaced == 0) {</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;  }</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;  <span class="keywordflow">if</span> (firstinstance &lt; 0 || lastinstance &gt;= numplaced) {</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s(%s): instanceno (%d) out of range [0,%d]&quot;</span>, __FUNCTION__, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, instanceno, numplaced - 1);</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;  }</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;<span class="preprocessor">  #ifdef IPG</span></div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;  <span class="comment">/* set frequency */</span></div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;  <span class="keywordflow">for</span> (i = firstinstance; i &lt;= lastinstance; i++) {</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    <span class="comment">/* calculate phase */</span></div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    {</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;      <span class="keywordtype">double</span> ftime_delay;           <span class="comment">/* floating point time delay in seconds */</span></div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;      <span class="keywordtype">double</span> cf_offset = (double) rf-&gt;<a class="code" href="struct_k_s___r_f.html#add1e81760153252b7f921b8f9118edb2">cf_offset</a>;             <span class="comment">/* frequency offset */</span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;      <span class="keywordtype">double</span> tmpphase;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;      <span class="keywordtype">int</span> syncpos, rfstartpos, time_delay;</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;      <span class="comment">/* start of RF pulse wave form (for 1st boardinstance) */</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;      rfstartpos = rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[i].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">wf</a>-&gt;inst_hdr_tail-&gt;start;</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;      <span class="comment">/* start of RF SSP frq pulse  (for 1st boardinstance) */</span></div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;      syncpos = rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[i].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">wf</a>-&gt;assoc_pulse-&gt;inst_hdr_tail-&gt;start;</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;      <span class="comment">/* time difference between SSP frq and isocenter of RF pulse */</span></div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;      time_delay = rfstartpos - syncpos - 9 <span class="comment">/* frq2sync_dly */</span> + RUP_FACTOR(rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> - rf-&gt;<a class="code" href="struct_k_s___r_f.html#afa10c3dbec21b5cc34276e741deeb97e">iso2end</a>, 2);</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;      <span class="comment">/*** Modified from GE&#39;s setupphases() ***/</span></div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;      ftime_delay = ((double)time_delay) / ((double) 1.0e6);</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;      tmpphase = (rfphase / 360.0 <span class="comment">/* deg-&gt;cycles */</span> - ( cf_offset * ftime_delay )) * 2.0 * PI; <span class="comment">/* radians */</span></div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;      setphase(tmpphase,  rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[i].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">wf</a>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[i].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">boardinstance</a>);</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    }</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;  } <span class="comment">/* for each instance */</span></div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;<span class="preprocessor">  #endif</span></div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;} <span class="comment">/* ks_scan_rf_setphase */</span></div><div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a42df2e3be0bda47009caae1a7042b522"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">KS_WFINSTANCE::boardinstance</a></div><div class="ttdeci">int boardinstance</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:251</div></div>
<div class="ttc" id="struct_k_s___r_f_html_add1e81760153252b7f921b8f9118edb2"><div class="ttname"><a href="struct_k_s___r_f.html#add1e81760153252b7f921b8f9118edb2">KS_RF::cf_offset</a></div><div class="ttdeci">float cf_offset</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:791</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a72a22b96ff3908d2b9a20a3a02647a2f"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">KS_BASE::ninst</a></div><div class="ttdeci">int ninst</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:261</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a15be3edad342a49398ca841c2745dc9e"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">KS_WAVE::wfi</a></div><div class="ttdeci">KS_WFINSTANCE * wfi</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:524</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">KS_WAVE::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:516</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a2a9b610a78cdae3ac8ef682bd34f7e0d"><div class="ttname"><a href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">KS_RF::rfwave</a></div><div class="ttdeci">KS_WAVE rfwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:798</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">KS_WAVE::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:515</div></div>
<div class="ttc" id="struct_k_s___r_f_html_afa10c3dbec21b5cc34276e741deeb97e"><div class="ttname"><a href="struct_k_s___r_f.html#afa10c3dbec21b5cc34276e741deeb97e">KS_RF::iso2end</a></div><div class="ttdeci">int iso2end</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:794</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a558b0ff480e8db364962bd0f203d6958"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">KS_WFINSTANCE::wf</a></div><div class="ttdeci">WF_PULSE * wf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:252</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_WAVE::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:518</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2e916337476b7566b3bf033824f964ba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2e916337476b7566b3bf033824f964ba">&#9670;&nbsp;</a></span>ks_scan_wave2hardware()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_wave2hardware </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a>&#160;</td>
          <td class="paramname"><em>newwave</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Moves a waveform belonging to a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> sequence object to hardware</h4>
</p>
<p>This function copies a waveform to one of the two hardware waveform buffers (belonging to the <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object) that is currently not in use for the current sequence playout. The selection of which buffer to update is handled automatically by the function, which will also change the waveform pointer to the updated buffer so it will be used for the next sequence playout</p>
<p>If the 2nd argument (<code>newwave</code>, of type KS_WAVEFORM (float array)) is</p><ol type="1">
<li>not NULL, the content of <code>newwave</code> is used</li>
<li>NULL, it is assumed that the <code>.waveform</code> field of <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> has been updated with new contents and is copied to hardware instead of <code>newwave</code></li>
</ol>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">wave</td><td>Pointer to <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">newwave</td><td>KS_WAVEFORM to copy to hardware (if <code>NULL</code>, the <code>.waveform</code> field in <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> will be used instead) </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;                                                                     {</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#abba996c24da629eea72eecbd9a22a873">KS_IWAVE</a> iwave;</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;  WF_PULSE *wfpulse;</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;  LONG current_wave_ptrs[<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1a6e84527e5ca18e299429a1d00297b47f">KS_WF_SIZE</a>];</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;  LONG wave_ptr;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;  <span class="keywordtype">int</span> i,j;</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;  STATUS status;</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;  <span class="keywordtype">int</span> numplaced = wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>;</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  <span class="keywordtype">int</span> numplaced = wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>;</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;  <span class="keywordflow">if</span> (numplaced == 0) {</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;  }</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; 7; i++) {</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    wfpulse = wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[i];</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    <span class="keywordflow">if</span> (!wfpulse) {</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    }</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    <span class="keywordflow">if</span> (newwave != NULL) {</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;      <span class="comment">/* use the new float array passed in as 3rd argument */</span></div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;      status = <a class="code" href="_k_s_foundation_8h.html#acce0c0e51575bd8ce71eafcf92e153e0">ks_waveform2iwave</a>(iwave, newwave, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>, i);</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;      <span class="comment">/* use the data in the `.waveform` field of the KS_WAVE (1st arg) */</span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;      status = <a class="code" href="_k_s_foundation_8h.html#a016372aaa6f16b986000c56b9792fefd">ks_wave2iwave</a>(iwave, wave, i); <span class="comment">/* iwave is waveform memory */</span></div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    }</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    <span class="comment">/* Extract current wave pointers */</span></div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    <span class="keywordflow">for</span> (j = <a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a>; j &lt; <a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1a6e84527e5ca18e299429a1d00297b47f">KS_WF_SIZE</a>; j++) {</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;      getwave(&amp;current_wave_ptrs[j], &amp;wfpulse[j]);</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    }</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <span class="comment">/* Compare the main pointer with the buffers and find wich buffer was used </span></div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;<span class="comment">       last time, then move the new waveform to the other one. Also, get the new pointer. </span></div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;<span class="comment">       movewaveimm might take some time to compute if the wave is long, consider increasing</span></div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;<span class="comment">       the SSI-time if you expericence any problems */</span></div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    <span class="keywordflow">if</span> (current_wave_ptrs[<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a>] == current_wave_ptrs[<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1a976ecf9c65bb6a43d7cb791d681f0adc">KS_WF_BUF2</a>]) {</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;      movewaveimm(iwave, &amp;wfpulse[<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1acc45ff8f1dbeb7cef0129dd595e4031b">KS_WF_BUF1</a>], (<span class="keywordtype">int</span>) 0, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>, TOHARDWARE);</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;      getwave(&amp;wave_ptr, &amp;wfpulse[<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1acc45ff8f1dbeb7cef0129dd595e4031b">KS_WF_BUF1</a>]);</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;      movewaveimm(iwave, &amp;wfpulse[<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1a976ecf9c65bb6a43d7cb791d681f0adc">KS_WF_BUF2</a>], (<span class="keywordtype">int</span>) 0, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>, TOHARDWARE);</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;      getwave(&amp;wave_ptr, &amp;wfpulse[<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1a976ecf9c65bb6a43d7cb791d681f0adc">KS_WF_BUF2</a>]);</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    }</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    <span class="comment">/* Make the new pointer the main one */</span></div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    setwave(wave_ptr, &amp;wfpulse[<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a>], -1);</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;  } <span class="comment">/* for */</span></div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;} <span class="comment">/* ks_scan_wave2hardware */</span></div><div class="ttc" id="_k_s_foundation_8h_html_abba996c24da629eea72eecbd9a22a873"><div class="ttname"><a href="_k_s_foundation_8h.html#abba996c24da629eea72eecbd9a22a873">KS_IWAVE</a></div><div class="ttdeci">short KS_IWAVE[KS_MAXWAVELEN]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:180</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ac91cb32048e29f6e58bbf2c1acb8fdf1acc45ff8f1dbeb7cef0129dd595e4031b"><div class="ttname"><a href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1acc45ff8f1dbeb7cef0129dd595e4031b">KS_WF_BUF1</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1754</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a72a22b96ff3908d2b9a20a3a02647a2f"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">KS_BASE::ninst</a></div><div class="ttdeci">int ninst</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:261</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a9428be182c75f60d1b4e6fe36c888afa"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">KS_WAVE::wfpulse</a></div><div class="ttdeci">WF_PULSE ** wfpulse</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:523</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">KS_WAVE::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:515</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_acce0c0e51575bd8ce71eafcf92e153e0"><div class="ttname"><a href="_k_s_foundation_8h.html#acce0c0e51575bd8ce71eafcf92e153e0">ks_waveform2iwave</a></div><div class="ttdeci">STATUS ks_waveform2iwave(KS_IWAVE iwave, const KS_WAVEFORM waveform, int res, int board) WARN_UNUSED_RESULT</div><div class="ttdoc">(Internal use) Conversion of a KS_WAVEFORM to a short int array for use on hardware</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1155</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32"><div class="ttname"><a href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1754</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ac91cb32048e29f6e58bbf2c1acb8fdf1a6e84527e5ca18e299429a1d00297b47f"><div class="ttname"><a href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1a6e84527e5ca18e299429a1d00297b47f">KS_WF_SIZE</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1754</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a016372aaa6f16b986000c56b9792fefd"><div class="ttname"><a href="_k_s_foundation_8h.html#a016372aaa6f16b986000c56b9792fefd">ks_wave2iwave</a></div><div class="ttdeci">STATUS ks_wave2iwave(KS_IWAVE iwave, const KS_WAVE *wave, int board) WARN_UNUSED_RESULT</div><div class="ttdoc">(Internal use) Conversion of waveform content in a KS_WAVE sequence object to a short int array for u...</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1177</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ac91cb32048e29f6e58bbf2c1acb8fdf1a976ecf9c65bb6a43d7cb791d681f0adc"><div class="ttname"><a href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1a976ecf9c65bb6a43d7cb791d681f0adc">KS_WF_BUF2</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1754</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a27f5cab084726434159934c2b1594eb6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a27f5cab084726434159934c2b1594eb6">&#9670;&nbsp;</a></span>ks_scan_offsetfov_iso()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_offsetfov_iso </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a> *&#160;</td>
          <td class="paramname"><em>readtrap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>instanceno</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SCAN_INFO&#160;</td>
          <td class="paramname"><em>sliceinfo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>ky</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>kz</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>rcvphase</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Updates the frequency and phase to create a FOV shift assuming that the k-space voxels/pixels are isometric</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">readtrap</td><td>Pointer to <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">instanceno</td><td>Instance of <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> to change (<code>INSTRALL</code> changes all instances) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sliceinfo</td><td>SCAN_INFO struct for the current slice to be played out </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ky</td><td>phase offset in k-space measured in voxels/pixels </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">kz</td><td>phase offset in k-space measured in voxels/pixels </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rcvphase</td><td>Receiver phase in [degrees] of the acquisition window corresponding to the <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> and instanceno </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;                                                                                                                              {</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;  <span class="comment">/* Warning: We never have more than one instance (i.e. instruction) per readtrap.echo[i] (see ks_pg_readtrap())</span></div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;<span class="comment">     unlike KS_TRAP and KS_RF. This means that the 2nd input arg here (&#39;instanceno&#39;) means the instanceno&#39;th echo. */</span></div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> numplaced = readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>;</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> halfreadoutdur = ((readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">filt</a>.outputs - 1) * readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">filt</a>.tsp / 2.0) * 1e-6; <span class="comment">/* [s], not [us] */</span></div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> numplaced = readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>;</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;  <span class="keywordtype">int</span> firstreadout, lastreadout;</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;  <span class="keywordflow">if</span> (instanceno == INSTRALL) {</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    firstreadout = 0;</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;    lastreadout = numplaced - 1;</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    firstreadout = instanceno;</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    lastreadout = instanceno;</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;  }</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;  <span class="keywordflow">if</span> (numplaced == 0) {</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;  }</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;  <span class="keywordflow">if</span> (firstreadout &lt; 0 || lastreadout &gt;= numplaced) {</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_offsetfov(%s): readout instance (%d) out of range [0,%d]&quot;</span>, readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, instanceno, numplaced - 1);</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;  }</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;  <span class="keywordflow">for</span> (i = firstreadout; i &lt;= lastreadout; i++) {</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    <span class="comment">/* gradient amplitude for this instance -&gt; Hz */</span></div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> mmtoHz = readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a> * readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[i].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> * <a class="code" href="_k_s_foundation__tgt_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a> / 10.0; <span class="comment">/* [Hz/mm]. designed amp [G/cm] * instance amp * GAM [Hz/G] / 10.0 [cm-&gt;mm] */</span></div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    <span class="keywordtype">float</span> rloc = sliceinfo.oprloc;</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> mmtoHz = readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a> * readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a89785a274d251fd637bf40923ad5c345">locs</a>[i].<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> * <a class="code" href="_k_s_foundation__tgt_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a> / 10.0;</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    <span class="keywordtype">float</span> rloc = 1;</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    </div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    <span class="comment">/* omega offset for rampsampled cases */</span></div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    <span class="keywordflow">if</span> (readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#abd9ff216626c3fd76322a2a56dc606cc">omega</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> &gt; 0) {</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;      <a class="code" href="_k_s_foundation__tgt_8c.html#a53e38393648beaa5a1d6ed9da63c6875">ks_scan_omegatrap_hz</a>(&amp;readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#abd9ff216626c3fd76322a2a56dc606cc">omega</a>, i,  mmtoHz * rloc <span class="comment">/* [Hz] */</span>);</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    }</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> gradsign = (mmtoHz &gt;= 0) ? 1 : -1;</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    <span class="comment">/* Frequency offsets [Hz]:</span></div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;<span class="comment">       - cfreceiveroffsetfreq: GE&#39;s standard frequency offset</span></div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;<span class="comment">       - readtrap-&gt;freqoffHz: Additional frequency offset for current KS_READTRAP. This value is multiplied with the gradient polarity sign</span></div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;<span class="comment">       - mmtoHz * sliceinfo.oprloc: Slice-dependent and gradient polarity dependent frequency offset (when omega is off) */</span></div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> freqoffHz = <a class="code" href="_k_s_foundation__tgt_8c.html#af07bb294f9364bf5dc24e6cfca153409">cfreceiveroffsetfreq</a> + readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a33b2ed586c0bf44c2c8991f0ab1610c8">freqoffHz</a> * gradsign + (readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#abd9ff216626c3fd76322a2a56dc606cc">omega</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> == 0) * (mmtoHz * rloc); <span class="comment">/* [Hz] */</span></div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    <span class="comment">/* set readout frequency offset */</span></div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    <span class="keywordflow">if</span> (i &lt; readtrap-&gt;acq.base.ngenerated &amp;&amp; readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a0e0bae3aa47ae5b8aae488fa0eb920ce">echo</a>[i].tag == SSPDAB) { <span class="comment">/* make sure it has been set up properly */</span></div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;      setfrequency(freqoffHz / TARDIS_FREQ_RES, &amp;readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a0e0bae3aa47ae5b8aae488fa0eb920ce">echo</a>[i], 0);</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    }</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    <span class="comment">/* set phase offset */</span></div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    <span class="keywordflow">if</span> (i &lt; readtrap-&gt;acq.base.ngenerated &amp;&amp; readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a0e0bae3aa47ae5b8aae488fa0eb920ce">echo</a>[i].tag == SSPDAB) {</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> phase_due_to_freqoffset = 2 * PI * (mmtoHz * rloc) * halfreadoutdur; <span class="comment">/* [rad.] */</span></div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> phase_1ky = -2.0 * PI * sliceinfo.opphasoff / readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#abfd94a01fc71278021802ca0d1e25e16">fov</a>;</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> phase_1kz = -2.0 * PI * sliceinfo.optloc / readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#abfd94a01fc71278021802ca0d1e25e16">fov</a>;</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;      setphase((<span class="keywordtype">float</span>) (phase_1ky * ky + phase_1kz * kz + rcvphase * PI / 180.0 - phase_due_to_freqoffset),  &amp;readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a0e0bae3aa47ae5b8aae488fa0eb920ce">echo</a>[i], 0);</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    }</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;  } <span class="comment">/* for */</span></div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;} <span class="comment">/* ks_scan_offsetfov_iso */</span></div><div class="ttc" id="struct_k_s___r_e_a_d_html_a0e0bae3aa47ae5b8aae488fa0eb920ce"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a0e0bae3aa47ae5b8aae488fa0eb920ce">KS_READ::echo</a></div><div class="ttdeci">WF_PULSE * echo</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:587</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a53e38393648beaa5a1d6ed9da63c6875"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a53e38393648beaa5a1d6ed9da63c6875">ks_scan_omegatrap_hz</a></div><div class="ttdeci">void ks_scan_omegatrap_hz(KS_TRAP *trp, int instanceno, float Hz)</div><div class="ttdoc">Updates a KS_TRAP object on the OMEGA board to produce a frequency offset</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:88</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a72a22b96ff3908d2b9a20a3a02647a2f"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">KS_BASE::ninst</a></div><div class="ttdeci">int ninst</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:261</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_abfd94a01fc71278021802ca0d1e25e16"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#abfd94a01fc71278021802ca0d1e25e16">KS_READTRAP::fov</a></div><div class="ttdeci">float fov</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1425</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_af07bb294f9364bf5dc24e6cfca153409"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#af07bb294f9364bf5dc24e6cfca153409">cfreceiveroffsetfreq</a></div><div class="ttdeci">int cfreceiveroffsetfreq</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">KS_READTRAP::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1435</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a606fbf556e8a297aa1f68b098f6ac2a2"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">KS_SEQLOC::ampscale</a></div><div class="ttdeci">float ampscale</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:243</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">KS_READ::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:581</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a15be3edad342a49398ca841c2745dc9e"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">KS_TRAP::wfi</a></div><div class="ttdeci">KS_WFINSTANCE * wfi</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:441</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a78e529e1d86855310035845e03a4c107"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">KS_WFINSTANCE::loc</a></div><div class="ttdeci">KS_SEQLOC loc</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:253</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_abd9ff216626c3fd76322a2a56dc606cc"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#abd9ff216626c3fd76322a2a56dc606cc">KS_READTRAP::omega</a></div><div class="ttdeci">KS_TRAP omega</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1436</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ab508ded41392ee86a2a619d3e93d2373"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">KS_TRAP::amp</a></div><div class="ttdeci">float amp</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:433</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a89785a274d251fd637bf40923ad5c345"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a89785a274d251fd637bf40923ad5c345">KS_TRAP::locs</a></div><div class="ttdeci">KS_SEQLOC locs[KS_MAXINSTANCES]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:439</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">KS_TRAP::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:432</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a292f93e48d34cda511fcfb72a05558c2"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">KS_READ::filt</a></div><div class="ttdeci">FILTER_INFO filt</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:585</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_a33b2ed586c0bf44c2c8991f0ab1610c8"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#a33b2ed586c0bf44c2c8991f0ab1610c8">KS_READTRAP::freqoffHz</a></div><div class="ttdeci">float freqoffHz</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1431</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_ac359c54a7c5f9e9a94105b3c0d0be9ea"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">KS_READTRAP::acq</a></div><div class="ttdeci">KS_READ acq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1423</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_TRAP::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:437</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a2875ace95558531062d08465b2bcc282"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a></div><div class="ttdeci">float GAM</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a11a9b9d761ba64a74b88c222b2a949e3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a11a9b9d761ba64a74b88c222b2a949e3">&#9670;&nbsp;</a></span>ks_scan_offsetfov()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_offsetfov </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a> *&#160;</td>
          <td class="paramname"><em>readtrap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>instanceno</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SCAN_INFO&#160;</td>
          <td class="paramname"><em>sliceinfo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>phasefovratio</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>rcvphase</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Updates the frequency and phase of one or all instances of a <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> to create a FOV shift</h4>
</p>
<p>This function can be used by 2D Cartesian pulse sequences to build up the phase ramp in k-space necessary to shift the image FOV. The desired image FOV shift is given by the SCAN_INFO struct passed in as 3rd argument. The <code>view</code> field and the <code>phasefovratio</code> arguments are necessary to know where in the physical k-space the acquired data is placed. Knowing this and the FOV offset in the phase encoding direction, the necessary receiver phase for the current <code>view</code> can be set. After this function has been called for all <code>view</code> numbers, the necessary phase ramp has been set up in k-space to perform the phase FOV shift in the image domain. The <code>rcvphase</code> is added to the receive phase required for the FOV shift. In general, the <code>rcvphase</code> should be the same as the phase of the RF excitation pulse.</p>
<p>For rampsampled acquisitions (<code>.rampsampling</code> = 1 in <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a>), the <a class="el" href="_k_s_foundation_8h.html#a27f5cab084726434159934c2b1594eb6" title="Updates the frequency and phase to create a FOV shift assuming that the k-space voxels/pixels are iso...">ks_scan_offsetfov_iso()</a> function called will internally call <a class="el" href="_k_s_foundation_8h.html#adbd649762fa938de96662bdc9a721863" title="Updates a KS_TRAP object on the OMEGA board to produce a frequency offset">ks_scan_omegatrap_hz()</a> for FOV shifts in the readout direction. Both <a class="el" href="_k_s_foundation_8h.html#a11a9b9d761ba64a74b88c222b2a949e3" title="Updates the frequency and phase of one or all instances of a KS_READTRAP to create a FOV shift...">ks_scan_offsetfov()</a> and <a class="el" href="_k_s_foundation_8h.html#a368695617a7edf4fdba05325573efb12" title="Updates the frequency and phase of one or all instances of a KS_READTRAP to create a FOV shift...">ks_scan_offsetfov3D()</a> calls the same <a class="el" href="_k_s_foundation_8h.html#a27f5cab084726434159934c2b1594eb6" title="Updates the frequency and phase to create a FOV shift assuming that the k-space voxels/pixels are iso...">ks_scan_offsetfov_iso()</a> function after performing unit conversions of the input arguments.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">readtrap</td><td>Pointer to <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">instanceno</td><td>Instance of <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> to change (<code>INSTRALL</code> changes all instances) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sliceinfo</td><td>SCAN_INFO struct for the current slice to be played out </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">view</td><td>Phase encoding line to acquire with index corresponding to a fully sampled k-space [0, res-1] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">phasefovratio</td><td>The ratio of FOVphase/FOVfreq (as <code>opphasefov</code>) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rcvphase</td><td>Receiver phase in [degrees] of the acquisition window corresponding to the <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> and instanceno </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;                                                                                                                                      {</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> validkyindx = (kyview &gt;= 0);</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> koffset = (double)(validkyindx * kyview) / phasefovratio;</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;  <a class="code" href="_k_s_foundation__tgt_8c.html#a27f5cab084726434159934c2b1594eb6">ks_scan_offsetfov_iso</a>(readtrap, instanceno, sliceinfo, koffset, 0, rcvphase);</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;}</div><div class="ttc" id="_k_s_foundation__tgt_8c_html_a27f5cab084726434159934c2b1594eb6"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a27f5cab084726434159934c2b1594eb6">ks_scan_offsetfov_iso</a></div><div class="ttdeci">void ks_scan_offsetfov_iso(KS_READTRAP *readtrap, int instanceno, SCAN_INFO sliceinfo, double ky, double kz, double rcvphase)</div><div class="ttdoc">Updates the frequency and phase to create a FOV shift assuming that the k-space voxels/pixels are iso...</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:758</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a368695617a7edf4fdba05325573efb12"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a368695617a7edf4fdba05325573efb12">&#9670;&nbsp;</a></span>ks_scan_offsetfov3D()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_offsetfov3D </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a> *&#160;</td>
          <td class="paramname"><em>readtrap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>instanceno</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SCAN_INFO&#160;</td>
          <td class="paramname"><em>sliceinfo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>kyview</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>phasefovratio</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>kzview</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>zphasefovratio</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>rcvphase</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Updates the frequency and phase of one or all instances of a <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> to create a FOV shift</h4>
</p>
<p>This function can be used by 3D Cartesian pulse sequences to build up the phase ramp in k-space necessary to shift the image FOV. The desired image FOV shift is given by the SCAN_INFO struct passed in as 3rd argument. The <code>kyview</code>/<code>kzview</code> field and the <code>phasefovratio</code>/<code>zphasefovratio</code> arguments are necessary to know where in the physical k-space the acquired data is placed. Knowing this and the FOV offset in both phase encoding directions, the necessary receiver phase for the current <code>kyview</code>/<code>kzview</code> can be set. After this function has been called for all <code>kyview</code>/<code>kzview</code> numbers, the necessary phase ramp has been set up in k-space to perform the phase FOV shift in the image domain. The <code>rcvphase</code> is added to the receive phase required for the FOV shift. In general, the <code>rcvphase</code> should be the same as the phase of the RF excitation pulse.</p>
<p>For rampsampled acquisitions (<code>.rampsampling</code> = 1 in <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a>), the <a class="el" href="_k_s_foundation_8h.html#a27f5cab084726434159934c2b1594eb6" title="Updates the frequency and phase to create a FOV shift assuming that the k-space voxels/pixels are iso...">ks_scan_offsetfov_iso()</a> function called will internally call <a class="el" href="_k_s_foundation_8h.html#adbd649762fa938de96662bdc9a721863" title="Updates a KS_TRAP object on the OMEGA board to produce a frequency offset">ks_scan_omegatrap_hz()</a> for FOV shifts in the readout direction. Both <a class="el" href="_k_s_foundation_8h.html#a11a9b9d761ba64a74b88c222b2a949e3" title="Updates the frequency and phase of one or all instances of a KS_READTRAP to create a FOV shift...">ks_scan_offsetfov()</a> and <a class="el" href="_k_s_foundation_8h.html#a368695617a7edf4fdba05325573efb12" title="Updates the frequency and phase of one or all instances of a KS_READTRAP to create a FOV shift...">ks_scan_offsetfov3D()</a> calls the same <a class="el" href="_k_s_foundation_8h.html#a27f5cab084726434159934c2b1594eb6" title="Updates the frequency and phase to create a FOV shift assuming that the k-space voxels/pixels are iso...">ks_scan_offsetfov_iso()</a> function after performing unit conversions of the input arguments.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">readtrap</td><td>Pointer to <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">instanceno</td><td>Instance of <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> to change (<code>INSTRALL</code> changes all instances) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sliceinfo</td><td>SCAN_INFO struct for the current slice to be played out </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">kyview</td><td>Phase encoding line to acquire with index corresponding to a fully sampled k-space [0, res-1] (YGRAD) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">phasefovratio</td><td>The ratio of FOVphase/FOVfreq (as <code>opphasefov</code>) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">kzview</td><td>Z Phase encoding line to acquire with index corresponding to a fully sampled k-space [0, res-1] (ZGRAD) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">zphasefovratio</td><td>The ratio of FOVslice/FOVfreq (as <code>(opslquant * opslthick) / opfov</code>) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rcvphase</td><td>Receiver phase in [degrees] of the acquisition window corresponding to the <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> and instanceno </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;                                                                                                                                                                          {</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> validkyindx = (kyview &gt;= 0);</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> kyoffset = (double)(validkyindx * kyview) / phasefovratio;</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> validkzindx = (kzview &gt;= 0);</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> kzoffset = (double)(validkzindx * kzview) / zphasefovratio;</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;  <a class="code" href="_k_s_foundation__tgt_8c.html#a27f5cab084726434159934c2b1594eb6">ks_scan_offsetfov_iso</a>(readtrap, instanceno, sliceinfo, kyoffset, kzoffset, rcvphase);</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;}</div><div class="ttc" id="_k_s_foundation__tgt_8c_html_a27f5cab084726434159934c2b1594eb6"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a27f5cab084726434159934c2b1594eb6">ks_scan_offsetfov_iso</a></div><div class="ttdeci">void ks_scan_offsetfov_iso(KS_READTRAP *readtrap, int instanceno, SCAN_INFO sliceinfo, double ky, double kz, double rcvphase)</div><div class="ttdoc">Updates the frequency and phase to create a FOV shift assuming that the k-space voxels/pixels are iso...</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:758</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af21da495bf5fc72d19915129fdcbebe4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af21da495bf5fc72d19915129fdcbebe4">&#9670;&nbsp;</a></span>ks_scan_offsetfov_readwave()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_offsetfov_readwave </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_e_a_d_w_a_v_e.html">KS_READWAVE</a> *&#160;</td>
          <td class="paramname"><em>readwave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>instanceno</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SCAN_INFO&#160;</td>
          <td class="paramname"><em>sliceinfo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>kyview</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>phasefovratio</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>rcvphase</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;                                                                                                                                             {</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> validkyindx = (kyview &gt;= 0);</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> koffset = (double)(validkyindx * kyview) / phasefovratio;</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;  <a class="code" href="_k_s_foundation__tgt_8c.html#a13039d7727a8f50dd649fb36c9f7d3a6">ks_scan_offsetfov_iso_readwave</a>(readwave, instanceno, sliceinfo, koffset, 0, rcvphase);</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;}</div><div class="ttc" id="_k_s_foundation__tgt_8c_html_a13039d7727a8f50dd649fb36c9f7d3a6"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a13039d7727a8f50dd649fb36c9f7d3a6">ks_scan_offsetfov_iso_readwave</a></div><div class="ttdeci">void ks_scan_offsetfov_iso_readwave(KS_READWAVE *readwave, int instanceno, SCAN_INFO sliceinfo, double ky, double kz, double rcvphase)</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:829</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="adbd649762fa938de96662bdc9a721863"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adbd649762fa938de96662bdc9a721863">&#9670;&nbsp;</a></span>ks_scan_omegatrap_hz()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_omegatrap_hz </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> *&#160;</td>
          <td class="paramname"><em>trap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>instanceno</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>Hz</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Updates a <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object on the OMEGA board to produce a frequency offset</h4>
</p>
<p>A <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object on OMEGA is used for rampsampled acquisitions and is placed out using <a class="el" href="_k_s_foundation_8h.html#a21198913d5b1603f03a5e5d61d00408c" title="Places a KS_READTRAP sequence object on a board at some position in the pulse sequence">ks_pg_readtrap()</a> for a <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> object if the field <code>.rampsampling</code> = 1. This will cause a trapezoidal frequency shift during the readout instead of a fixed frequency offset when rampsampling is not used. An error is returned if the current instance of the <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> is on another board than OMEGA</p>
<p>For Cartesian applications, there is no need to call this function directly, since <a class="el" href="_k_s_foundation_8h.html#a11a9b9d761ba64a74b88c222b2a949e3" title="Updates the frequency and phase of one or all instances of a KS_READTRAP to create a FOV shift...">ks_scan_offsetfov()</a> already calls this function</p>
<p>Special note for OMEGA: Neither the <code>.amp</code> field nor the <code>.ampscale</code> field passed in to <a class="el" href="_k_s_foundation_8h.html#a61651c54c4dfd4388fc939d804a9964b" title="Places a KS_TRAP sequence object on a board at some position in the pulse sequence">ks_pg_trap()</a> has an effect. Only the <code>Hz</code> argument controls the frequency shift</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">trap</td><td>Pointer to <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">instanceno</td><td>Instance of <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> to change (<code>INSTRALL</code> changes all instances) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Hz</td><td>Desired frequency offset in [Hz] at the plateau of the trapezoid </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;                                                                  {</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <span class="keywordtype">int</span> iamp;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <span class="keywordtype">float</span> omega_scale = 256.0;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  iamp = (int) (Hz / (TARDIS_FREQ_RES * omega_scale));</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="keywordflow">if</span> (abs(iamp) &gt; 32768) {</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_omegatrap_hz(%s): the integer amplitude is too large (%d) for instance %d&quot;</span>, trp-&gt;description, iamp, instanceno);</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  }</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <span class="keywordflow">if</span> (trp-&gt;wfi[instanceno].loc.board != OMEGA) {</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_omegatrap_hz(%s): Wrong function - use ks_scan_trap_ampscale() KS_TRAPs on XGRAD, YGRAD, ZGRAD&quot;</span>, trp-&gt;description);</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  }</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  <span class="comment">/* input validation */</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  <span class="keywordflow">if</span> (instanceno &lt; 0 || instanceno &gt;= trp-&gt;base.ngenerated) {</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_omegatrap_hz(%s): instanceno (%d) out of range [0,%d)&quot;</span>, trp-&gt;description, instanceno, trp-&gt;base.ngenerated);</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  }</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  <span class="keywordflow">if</span> (setiampt((<span class="keywordtype">short</span>) iamp, trp-&gt;wfi[instanceno].wf, trp-&gt;wfi[instanceno].boardinstance) != SUCCESS) {</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_omegatrap_hz(%s): An error occurred calling &#39;setiampt()&#39;&quot;</span>, trp-&gt;description);</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  }</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <span class="keywordtype">int</span> numplaced = trp-&gt;base.ninst;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <span class="keywordflow">if</span> (!numplaced) {</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  }</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  <span class="keywordtype">float</span>* tmp = (<span class="keywordtype">float</span>*)realloc(trp-&gt;rtscale, numplaced * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <span class="keywordflow">if</span> (!tmp) {</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: rtscale realloc failed&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  }</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  trp-&gt;rtscale = tmp;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  trp-&gt;rtscale[instanceno] = Hz;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;} <span class="comment">/* ks_scan_omegatrap_hz */</span></div><div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6c406ab72abe3eadd93f7e889e9afd32"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6c406ab72abe3eadd93f7e889e9afd32">&#9670;&nbsp;</a></span>ks_scan_omegawave_hz()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_omegawave_hz </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>instanceno</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>Hz</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Updates a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object on the OMEGA board to produce a frequency offset</h4>
</p>
<p>A <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object on OMEGA can be used to perform a dynamic frequency offset</p><ol type="1">
<li>while an RF pulse is played out. One example is Spectral-Spatial RF pulses</li>
<li>during data acquisition</li>
</ol>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">wave</td><td>Pointer to <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">instanceno</td><td>Instance of <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> to change (<code>INSTRALL</code> changes all instances) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Hz</td><td>Desired frequency offset in [Hz] for the point in the <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> with the largest absolute amplitude </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;                                                                   {</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <span class="keywordtype">int</span> iamp;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  <span class="keywordtype">float</span> omega_scale = 256.0;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  iamp = (int) (Hz / (TARDIS_FREQ_RES * omega_scale));</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  <span class="keywordflow">if</span> (abs(iamp) &gt; 32768) {</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_omegawave_hz(%s): the integer amplitude is too large (%d) for instance %d&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, iamp, instanceno);</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  }</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="keywordflow">if</span> (wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[instanceno].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> != OMEGA) {</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_omegawave_hz(%s): Only omega board is supported&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  }</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <span class="comment">/* input validation */</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <span class="keywordflow">if</span> (instanceno &lt; 0 || instanceno &gt;= wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>) {</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_omegawave_hz(%s): instanceno (%d) out of range [0,%d)&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, instanceno, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>);</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  }</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <span class="keywordflow">if</span> (setiamp((<span class="keywordtype">short</span>) iamp, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[instanceno].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">wf</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[instanceno].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">boardinstance</a>) != SUCCESS) {</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_omegawave_hz(%s): An error occurred calling &#39;setiampt()&#39;&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  }</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <span class="keywordtype">int</span> numplaced = wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="keywordflow">if</span> (!numplaced) {</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  }</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <span class="keywordtype">float</span>* tmp = (<span class="keywordtype">float</span>*)realloc(wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a997cdc9de09fbf7b61842aeb8ad3dfbb">rtscale</a>, numplaced * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  <span class="keywordflow">if</span> (!tmp) {</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: rtscale realloc failed&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  }</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a997cdc9de09fbf7b61842aeb8ad3dfbb">rtscale</a> = tmp;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a997cdc9de09fbf7b61842aeb8ad3dfbb">rtscale</a>[instanceno] = Hz;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;} <span class="comment">/* ks_scan_omegawave_hz */</span></div><div class="ttc" id="struct_k_s___w_a_v_e_html_a997cdc9de09fbf7b61842aeb8ad3dfbb"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a997cdc9de09fbf7b61842aeb8ad3dfbb">KS_WAVE::rtscale</a></div><div class="ttdeci">float * rtscale</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:525</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a42df2e3be0bda47009caae1a7042b522"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">KS_WFINSTANCE::boardinstance</a></div><div class="ttdeci">int boardinstance</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:251</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a72a22b96ff3908d2b9a20a3a02647a2f"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">KS_BASE::ninst</a></div><div class="ttdeci">int ninst</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:261</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a2e3f5254967cadb9a41167c6fbf6743e"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">KS_SEQLOC::board</a></div><div class="ttdeci">int board</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:241</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a15be3edad342a49398ca841c2745dc9e"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">KS_WAVE::wfi</a></div><div class="ttdeci">KS_WFINSTANCE * wfi</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:524</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a78e529e1d86855310035845e03a4c107"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">KS_WFINSTANCE::loc</a></div><div class="ttdeci">KS_SEQLOC loc</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:253</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">KS_WAVE::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:516</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">KS_WAVE::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:515</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a558b0ff480e8db364962bd0f203d6958"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">KS_WFINSTANCE::wf</a></div><div class="ttdeci">WF_PULSE * wf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:252</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a196a10609c8f75d0ff6d7a520d0b7c27"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a196a10609c8f75d0ff6d7a520d0b7c27">&#9670;&nbsp;</a></span>ks_scan_wait()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_wait </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___w_a_i_t.html">KS_WAIT</a> *&#160;</td>
          <td class="paramname"><em>wait</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>waitperiod</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Updates the wait period of all instances of a <a class="el" href="struct_k_s___w_a_i_t.html" title="Core sequence object that adds wait periods in the pulse sequence (see ks_eval_wait(), ks_pg_wait()). Can be placed on any sequence board">KS_WAIT</a> sequence object. The value of <code>waitperiod</code> must not exceed</h4>
<code>.duration</code>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">wait</td><td>Pointer to <a class="el" href="struct_k_s___w_a_i_t.html" title="Core sequence object that adds wait periods in the pulse sequence (see ks_eval_wait(), ks_pg_wait()). Can be placed on any sequence board">KS_WAIT</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">waitperiod</td><td>Time in [us] to wait </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                                                 {</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  <span class="keywordtype">int</span> numplaced = wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <span class="keywordtype">int</span> numplaced = wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <span class="keywordflow">if</span> (numplaced == 0) {</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  }</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  <span class="comment">/* input validation */</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  <span class="keywordflow">if</span> (waitperiod &lt; 0) {</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_wait(%s): wait period %d is negative&quot;</span>, wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, waitperiod);</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  }</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  <span class="keywordflow">if</span> (waitperiod &lt; GRAD_UPDATE_TIME) {</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    waitperiod = GRAD_UPDATE_TIME;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  }</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  <span class="keywordflow">if</span> (waitperiod % GRAD_UPDATE_TIME) {</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_wait(%s): waitperiod (3rd arg) on gradient boards must be divisible by 4&quot;</span>, wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  }</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <span class="keywordflow">if</span> (wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a15be3edad342a49398ca841c2745dc9e">wfi</a> == NULL) {</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_wait(%s): WF_INSTANCE of trap is NULL&quot;</span>, wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  }</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  <span class="comment">/* set amplitude(s) */</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; numplaced; i++) {</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="keywordflow">if</span> (setperiod(waitperiod, wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[i].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">wf</a>, wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[i].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">boardinstance</a>) != SUCCESS) {</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;      <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_wait(%s): An error occurred calling &#39;setperiod()&#39;&quot;</span>, wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    }</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  }</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;} <span class="comment">/* ks_scan_wait */</span></div><div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a42df2e3be0bda47009caae1a7042b522"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">KS_WFINSTANCE::boardinstance</a></div><div class="ttdeci">int boardinstance</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:251</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a72a22b96ff3908d2b9a20a3a02647a2f"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">KS_BASE::ninst</a></div><div class="ttdeci">int ninst</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:261</div></div>
<div class="ttc" id="struct_k_s___w_a_i_t_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___w_a_i_t.html#a1c544bec41003a594ba4ec7d43a3a470">KS_WAIT::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:310</div></div>
<div class="ttc" id="struct_k_s___w_a_i_t_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">KS_WAIT::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:309</div></div>
<div class="ttc" id="struct_k_s___w_a_i_t_html_a15be3edad342a49398ca841c2745dc9e"><div class="ttname"><a href="struct_k_s___w_a_i_t.html#a15be3edad342a49398ca841c2745dc9e">KS_WAIT::wfi</a></div><div class="ttdeci">KS_WFINSTANCE * wfi</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:314</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a558b0ff480e8db364962bd0f203d6958"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">KS_WFINSTANCE::wf</a></div><div class="ttdeci">WF_PULSE * wf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:252</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2c01e4ef0737a46f9c973b77ca284424"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2c01e4ef0737a46f9c973b77ca284424">&#9670;&nbsp;</a></span>ks_scan_trap_ampscale()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_trap_ampscale </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> *&#160;</td>
          <td class="paramname"><em>trap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>instanceno</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>ampscale</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Updates the amplitude of one or all instances of a <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> sequence object</h4>
</p>
<p>This function multiplies one instance of a <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object with an amplitude scale factor (3rd arg) that should be in range [-1.0,1.0] to avoid slewrate issues. To change all instances of a <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object, use <code>INSTRALL</code> as the 2nd argument.</p>
<p>The actual amplitude for an instance of a <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object is the multiplication of the three factors:</p><ol type="1">
<li>The designed amplitude [G/cm]</li>
<li>The per-instance <code>.ampscale</code> in the <a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> struct passed to <a class="el" href="_k_s_foundation_8h.html#a61651c54c4dfd4388fc939d804a9964b" title="Places a KS_TRAP sequence object on a board at some position in the pulse sequence">ks_pg_trap()</a></li>
<li>The <code>ampscale</code> value passed in as 3rd argument to this function.</li>
</ol>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">trap</td><td>Pointer to <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">instanceno</td><td>Instance of <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> to change (<code>INSTRALL</code> changes all instances) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ampscale</td><td>Gradient amplitude scale factor, normally in range [-1.0,1.0], but the range [-1.2, 1.2] is allowed to allow certain run-time gradient corrections </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                                                                         {</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  <span class="keywordtype">int</span> firstinstance, lastinstance, i;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  <span class="keywordtype">int</span> iamp;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  <span class="keywordtype">float</span> gradmax;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <span class="keywordtype">int</span> numplaced = trp-&gt;base.ngenerated;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <span class="keywordtype">int</span> numplaced = trp-&gt;base.ninst;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  <span class="keywordflow">if</span> (!numplaced) {</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  }</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  <span class="keywordtype">float</span>* tmp = (<span class="keywordtype">float</span>*)realloc(trp-&gt;rtscale, numplaced * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  <span class="keywordflow">if</span> (!tmp) {</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: rtscale realloc failed&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  }</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  trp-&gt;rtscale = tmp;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  <span class="keywordflow">if</span> (instanceno == INSTRALL) {</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    firstinstance = 0;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    lastinstance = numplaced - 1;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    firstinstance = instanceno;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    lastinstance = instanceno;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  }</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  <span class="comment">/* input validation */</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  <span class="keywordflow">if</span> (numplaced == 0) {</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  }</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <span class="keywordflow">if</span> (firstinstance &lt; 0 || lastinstance &gt;= numplaced) {</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_trap_ampscale(%s): instanceno (%d) out of range [0,%d]&quot;</span>, trp-&gt;description, instanceno, numplaced - 1);</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  }</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <span class="comment">/* Allow ampscale to be 20% larger than 1. This, to allow future minor runtime changes of trapezoid amplitudes</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">     for e.g. (future possible implementations):</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">     - oblique ghost correction for EPI, where odd/even blip amps need to be made smaller/larger depending on slice angle and delays</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">     - eddy current correction for DW-EPI, where readout lobe amp needs to be changed per diffusion direction etc.</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">     If &#39;ampscale&#39; is larger than 1.0 (i.e. between 1.0 and 1.2), the trapezoid must have been designed with a slewrate that is slightly</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment">     under the very limit of the system (and the dB/dt limits for PNS). Use with caution. */</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <span class="keywordflow">if</span> (fabs(ampscale) &gt; sqrt(3)) {</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_trap_ampscale(%s): ampscale too large (%f)&quot;</span>, trp-&gt;description, ampscale);</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  }</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">    - trp-&gt;amp: The amplitude that was initially designed for the KS_TRAP. Should never be exceeded, or slew rate issues will occur</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment">    - trp-&gt;wfi[i].loc.ampscale: -1.0 -&gt; +1.0. Amp scale factor for each instance of the KS_TRAP placed in the sequence.</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment">    - ampscale (3rd input arg): -1.0 -&gt; +1.0 (in normal cases). The dynamic amp scale (i.e. over time, or TRs).</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">   The product [trp-&gt;wfi[i].loc.ampscale * ampscale] should be in range [-1, 1] to avoid slew rate issues.</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  <span class="keywordflow">if</span> (trp-&gt;wfi == NULL) {</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_trap_ampscale(%s): WF_INSTANCE of trap is NULL&quot;</span>, trp-&gt;description);</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  }</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  <span class="comment">/* set amplitude(s) */</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="keywordflow">for</span> (i = firstinstance; i &lt;= lastinstance; i++) {</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    gradmax = <a class="code" href="_k_s_foundation_8h.html#aa65115d54842eeffc47a1b324caa62ab">ks_syslimits_gradtarget</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>, trp-&gt;wfi[i].loc.board);</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    iamp = ((ampscale * trp-&gt;wfi[i].loc.ampscale * trp-&gt;amp / gradmax) * MAX_PG_IAMP);</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <span class="keywordflow">if</span> (abs(iamp) &gt; 32768) {</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_trap_ampscale(%s): the integer amplitude is too large (%d) for instance %d&quot;</span>, trp-&gt;description, iamp, i);</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    }</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="keywordflow">if</span> (trp-&gt;wfi[i].loc.board == OMEGA) {</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_trap_ampscale(%s): Instance %d on board OMEGA. Please use ks_scan_omegatrap_hz() instead&quot;</span>, trp-&gt;description, i);</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    }</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="keywordflow">if</span> (setiampt((<span class="keywordtype">short</span>) iamp, trp-&gt;wfi[i].wf, trp-&gt;wfi[i].boardinstance) != SUCCESS) {</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;      <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_trap_ampscale(%s): An error occurred calling &#39;setiampt()&#39;&quot;</span>, trp-&gt;description);</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    }</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  }</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  <span class="keywordflow">for</span> (i = firstinstance; i &lt;= lastinstance; i++) {</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    trp-&gt;rtscale[i] = ampscale;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  }</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;} <span class="comment">/* ks_scan_trap_ampscale */</span></div><div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aa65115d54842eeffc47a1b324caa62ab"><div class="ttname"><a href="_k_s_foundation_8h.html#aa65115d54842eeffc47a1b324caa62ab">ks_syslimits_gradtarget</a></div><div class="ttdeci">float ks_syslimits_gradtarget(LOG_GRAD loggrd, WF_PROCESSOR board)</div><div class="ttdoc">Returns the maximum target amplitude for a board (internal use)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:176</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae825e40f6c103ac27a1d1c309e8e8835"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae825e40f6c103ac27a1d1c309e8e8835">&#9670;&nbsp;</a></span>ks_scan_trap_ampscale_slice()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_trap_ampscale_slice </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> *&#160;</td>
          <td class="paramname"><em>trap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>skip</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>count</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>ampscale</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Updates the amplitude of a selection of instances of a <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> sequence object</h4>
</p>
<p>This function multiplies some instances of a <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object with an amplitude scale factor (5th arg) that should be in range [-1.0,1.0] to avoid slewrate issues.</p>
<p>The instances to change are <code>start + i * skip</code>, where <code>i</code> goes from 0 to <code>count</code>. FAILURE is returned if either start or <code>start</code> + <code>count</code> * <code>skip</code> out of range or <code>count</code> is negative</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">trap</td><td>Pointer to <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">start</td><td>First instance number of the <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">skip</td><td>Difference in instance number between consecutive instances </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">count</td><td>Number of instances to change in total </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ampscale</td><td>Gradient amplitude scale factor, normally in range [-1.0,1.0], but the range [-1.2, 1.2] is allowed to allow certain run-time gradient corrections </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                                                                                               {</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  <span class="keywordtype">int</span> numplaced = trp-&gt;base.ngenerated;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <span class="keywordtype">int</span> numplaced = trp-&gt;base.ninst;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <span class="comment">/* check range */</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> end = start + (count - 1) * skip;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <span class="keywordflow">if</span> (start &lt; 0 || start &gt;= numplaced || end &lt; 0 || end &gt;= numplaced || count &lt; 0) {</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_trap_ampscale_slice(%s): slice with start = %d, skip = %d and count = %d has endpoints outside [0,%d)&quot;</span>, trp-&gt;description, start, skip, count, numplaced);</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  }</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; count; ++i) {</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <a class="code" href="_k_s_foundation__tgt_8c.html#a981da87d928a921e5d179e8268b92f1f">ks_scan_trap_ampscale</a>(trp, start + i * skip, ampscale);</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  }</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;} <span class="comment">/* ks_scan_trap_ampscale_slice */</span></div><div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a981da87d928a921e5d179e8268b92f1f"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a981da87d928a921e5d179e8268b92f1f">ks_scan_trap_ampscale</a></div><div class="ttdeci">void ks_scan_trap_ampscale(KS_TRAP *trp, int instanceno, float ampscale)</div><div class="ttdoc">Updates the amplitude of one or all instances of a KS_TRAP sequence object</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:182</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a183aef5f28e9491f792465e4b6d2b112"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a183aef5f28e9491f792465e4b6d2b112">&#9670;&nbsp;</a></span>ks_scan_phaser_kmove()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_phaser_kmove </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *&#160;</td>
          <td class="paramname"><em>phaser</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>instanceno</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>pixelunits</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Updates the amplitude of a <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> sequence object to move some arbitrary distance in k-space</h4>
</p>
<p>This function sets the amplitude of the gradient for a <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object so that a shift in k-space of <code>pixelunits</code> number of pixels is produced. If <code>pixelunits</code> is 1.0, the gradient area corresponds to one pixel shift in a fully sampled k-space (no parallel imaging) along the board the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object is placed on. <code>pixelunits</code> is of type <code>float</code> and any non-integer value is accepted, and the sign of <code>pixelunits</code> determines the direction of k-space shift</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">phaser</td><td>Pointer to <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">instanceno</td><td>Instance of <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> to change (<code>INSTRALL</code> changes all instances) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pixelunits</td><td>Non-integer pixel units in a fully sampled k-space to move </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                                                                                {</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  <span class="keywordtype">double</span> phasepixelarea = (double) <a class="code" href="_k_s_foundation_8h.html#aeb07c1278254f0a40622fbbe10566f57">ks_calc_fov2gradareapixel</a>(phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#abfd94a01fc71278021802ca0d1e25e16">fov</a>);</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  <span class="keywordtype">double</span> newarea = pixelunits * phasepixelarea + (double) phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aad774d0423b06e30276673c8100a8ade">areaoffset</a>;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <span class="keywordtype">double</span> ampscale = newarea / phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a97ab43f6fd28920a42d987c8fec4afec">area</a>;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  if (phaser == NULL)</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  <span class="keywordflow">if</span> (fabs(ampscale) &gt; 1.00003) {  <span class="comment">/* 1.00003 corresponds to 32768 / 32767, i.e. excess of one short int */</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="preprocessor">#ifndef IPG</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_phaser_kmove(%s): Too large value (%g) in 3rd arg&quot;</span>, phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, pixelunits);</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fabs(ampscale) &gt; 1.0) {</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="comment">/* small round-off fix when ampscale is in range [1.0, 1.00003] */</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    ampscale = ampscale &lt; 0 ? -1.0 : 1.0;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  }</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  <a class="code" href="_k_s_foundation__tgt_8c.html#a981da87d928a921e5d179e8268b92f1f">ks_scan_trap_ampscale</a>(&amp;phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>, instanceno, ampscale);</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;} <span class="comment">/* ks_scan_phaser_kmove */</span></div><div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">KS_PHASER::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1525</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aeb07c1278254f0a40622fbbe10566f57"><div class="ttname"><a href="_k_s_foundation_8h.html#aeb07c1278254f0a40622fbbe10566f57">ks_calc_fov2gradareapixel</a></div><div class="ttdeci">float ks_calc_fov2gradareapixel(float fov)</div><div class="ttdoc">Calculates the gradient area needed to move one pixel in k-space</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:279</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_aad774d0423b06e30276673c8100a8ade"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#aad774d0423b06e30276673c8100a8ade">KS_PHASER::areaoffset</a></div><div class="ttdeci">float areaoffset</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1531</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a97ab43f6fd28920a42d987c8fec4afec"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a97ab43f6fd28920a42d987c8fec4afec">KS_TRAP::area</a></div><div class="ttdeci">float area</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:434</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">KS_TRAP::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:432</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a981da87d928a921e5d179e8268b92f1f"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a981da87d928a921e5d179e8268b92f1f">ks_scan_trap_ampscale</a></div><div class="ttdeci">void ks_scan_trap_ampscale(KS_TRAP *trp, int instanceno, float ampscale)</div><div class="ttdoc">Updates the amplitude of one or all instances of a KS_TRAP sequence object</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:182</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_abfd94a01fc71278021802ca0d1e25e16"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#abfd94a01fc71278021802ca0d1e25e16">KS_PHASER::fov</a></div><div class="ttdeci">float fov</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1526</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aff91e4da3b6ccabd607ec0da04f774ce"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aff91e4da3b6ccabd607ec0da04f774ce">&#9670;&nbsp;</a></span>ks_scan_phaser_toline()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_phaser_toline </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *&#160;</td>
          <td class="paramname"><em>phaser</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>instanceno</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>view</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Updates the amplitude of a <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> sequence object to move from the k-space center to a desired k-space line</h4>
</p>
<p>This function sets the amplitude of the gradient for a <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object to produce a k-space shift <em>from</em> the center of k-space <em>to</em> the <code>view</code> number (3rd arg). The <code>view</code> number must be an integer in range [0, <code>.res</code>-1], and the number refers to a fully sampled k-space (without parallel imaging)</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">phaser</td><td>Pointer to <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">instanceno</td><td>Instance of <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> to change (<code>INSTRALL</code> changes all instances) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">view</td><td>Phase encoding line to acquire with index corresponding to a fully sampled k-space [0, res-1] </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                                                                        {</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  <span class="keywordtype">double</span> kmax;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  <span class="keywordflow">if</span> (phaser == NULL)</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  <span class="keywordflow">if</span> (view &lt; 0 || view &gt;= phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a>) {</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <a class="code" href="_k_s_foundation__tgt_8c.html#a183aef5f28e9491f792465e4b6d2b112">ks_scan_phaser_kmove</a>(phaser, instanceno, 0.0);</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  }</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  <span class="comment">/* KSFoundation &#39;view&#39; is always 0-based: e.g. res = 256: view = 0-&gt;255. */</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  kmax = ((phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a> - 1.0) / 2.0);</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;  <a class="code" href="_k_s_foundation__tgt_8c.html#a183aef5f28e9491f792465e4b6d2b112">ks_scan_phaser_kmove</a>(phaser, instanceno, kmax - <a class="code" href="_g_e_required_8e.html#a1cb6f035a0e9565bbf12c3ef04c3c229">view</a>);</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;} <span class="comment">/* ks_scan_phaser_toline */</span></div><div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">KS_PHASER::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1527</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a183aef5f28e9491f792465e4b6d2b112"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a183aef5f28e9491f792465e4b6d2b112">ks_scan_phaser_kmove</a></div><div class="ttdeci">void ks_scan_phaser_kmove(KS_PHASER *phaser, int instanceno, double pixelunits)</div><div class="ttdoc">Updates the amplitude of a KS_PHASER sequence object to move some arbitrary distance in k-space...</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:297</div></div>
<div class="ttc" id="_g_e_required_8e_html_a1cb6f035a0e9565bbf12c3ef04c3c229"><div class="ttname"><a href="_g_e_required_8e.html#a1cb6f035a0e9565bbf12c3ef04c3c229">view</a></div><div class="ttdeci">int view</div><div class="ttdef"><b>Definition:</b> GERequired.e:2630</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a81a97893a74af952d90181aa858e709b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a81a97893a74af952d90181aa858e709b">&#9670;&nbsp;</a></span>ks_scan_phaser_fromline()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_phaser_fromline </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *&#160;</td>
          <td class="paramname"><em>phaser</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>instanceno</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>view</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Updates the amplitude of a <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> sequence object to move from a k-space line to the k-space center</h4>
</p>
<p>This function sets the amplitude of the gradient for a <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object to produce a k-space shift <em>from</em> the <code>view</code> number (3rd arg) <em>to</em> the k-space center. The <code>view</code> number must be an integer in range [0, <code>.res</code>-1], and the number refers to a fully sampled k-space (without parallel imaging)</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">phaser</td><td>Pointer to <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">instanceno</td><td>Instance of <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> to change (<code>INSTRALL</code> changes all instances) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">view</td><td>Phase encoding line to acquire with index corresponding to a fully sampled k-space [0, res-1] </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                                                                          {</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  <span class="keywordtype">double</span> kmax;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  <span class="keywordflow">if</span> (phaser == NULL)</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  <span class="keywordflow">if</span> (view &lt; 0 || view &gt;= phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a>) {</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <a class="code" href="_k_s_foundation__tgt_8c.html#a183aef5f28e9491f792465e4b6d2b112">ks_scan_phaser_kmove</a>(phaser, instanceno, 0.0);</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  }</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  <span class="comment">/* KSFoundation &#39;view&#39; is always 0-based: e.g. res = 256: view = 0-&gt;255. */</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  kmax = ((phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a> - 1.0) / 2.0);</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  <a class="code" href="_k_s_foundation__tgt_8c.html#a183aef5f28e9491f792465e4b6d2b112">ks_scan_phaser_kmove</a>(phaser, instanceno, <a class="code" href="_g_e_required_8e.html#a1cb6f035a0e9565bbf12c3ef04c3c229">view</a> - kmax);</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;} <span class="comment">/* ks_scan_phaser_fromline */</span></div><div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">KS_PHASER::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1527</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a183aef5f28e9491f792465e4b6d2b112"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a183aef5f28e9491f792465e4b6d2b112">ks_scan_phaser_kmove</a></div><div class="ttdeci">void ks_scan_phaser_kmove(KS_PHASER *phaser, int instanceno, double pixelunits)</div><div class="ttdoc">Updates the amplitude of a KS_PHASER sequence object to move some arbitrary distance in k-space...</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:297</div></div>
<div class="ttc" id="_g_e_required_8e_html_a1cb6f035a0e9565bbf12c3ef04c3c229"><div class="ttname"><a href="_g_e_required_8e.html#a1cb6f035a0e9565bbf12c3ef04c3c229">view</a></div><div class="ttdeci">int view</div><div class="ttdef"><b>Definition:</b> GERequired.e:2630</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa3ed2adea6f1023e3f926978e9a7b856"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa3ed2adea6f1023e3f926978e9a7b856">&#9670;&nbsp;</a></span>ks_scan_getsliceloc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_scan_getsliceloc </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_k_s___s_l_i_c_e___p_l_a_n.html">KS_SLICE_PLAN</a> *&#160;</td>
          <td class="paramname"><em>slice_plan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>passindx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sltimeinpass</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the spatially sorted slice index from a DATA_ACQ_ORDER struct array</h4>
</p>
<p>This function finds the spatially sorted slice index (<code>.slloc</code>) in range [0, nslices-1] given the sequence's DATA_ACQ_ORDER struct array (in slice_plan.acq_order)</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">slice_plan</td><td>Pointer to the slice plan (<a class="el" href="struct_k_s___s_l_i_c_e___p_l_a_n.html" title="Struct holding all information about slice locations and aquisition order">KS_SLICE_PLAN</a>) for the sequence </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">passindx</td><td>Current pass index ([0, acqs-1]) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sltimeinpass</td><td>Temporal index of the <code>n</code> slices acquired in each pass ([0, n-1]) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">slloc</td><td>Spatially sorted slice index </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;                                                                                         {</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; slice_plan-&gt;<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a3414dc896f1276457707d70318d46770">nslices</a>; i++) {</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;    <span class="keywordflow">if</span> (slice_plan-&gt;<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#af6c9bb6611e03718085512d2c90cfcd8">acq_order</a>[i].slpass == <a class="code" href="ksfse__implementation_8e.html#aae477e374b559bf16a475321797d62cb">passindx</a> &amp;&amp; slice_plan-&gt;<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#af6c9bb6611e03718085512d2c90cfcd8">acq_order</a>[i].sltime == sltimeinpass) {</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;      <span class="keywordflow">return</span> slice_plan-&gt;<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#af6c9bb6611e03718085512d2c90cfcd8">acq_order</a>[i].slloc;</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;    }</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;  }</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>;</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;}</div><div class="ttc" id="struct_k_s___s_l_i_c_e___p_l_a_n_html_af6c9bb6611e03718085512d2c90cfcd8"><div class="ttname"><a href="struct_k_s___s_l_i_c_e___p_l_a_n.html#af6c9bb6611e03718085512d2c90cfcd8">KS_SLICE_PLAN::acq_order</a></div><div class="ttdeci">DATA_ACQ_ORDER acq_order[SLICE_FACTOR *DATA_ACQ_MAX]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1203</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_afd953f31b866a09e0418967c2bf65a59"><div class="ttname"><a href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a></div><div class="ttdeci">#define KS_NOTSET</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:60</div></div>
<div class="ttc" id="ksfse__implementation_8e_html_aae477e374b559bf16a475321797d62cb"><div class="ttname"><a href="ksfse__implementation_8e.html#aae477e374b559bf16a475321797d62cb">passindx</a></div><div class="ttdeci">int passindx</div><div class="ttdef"><b>Definition:</b> ksfse_implementation.e:2829</div></div>
<div class="ttc" id="struct_k_s___s_l_i_c_e___p_l_a_n_html_a3414dc896f1276457707d70318d46770"><div class="ttname"><a href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a3414dc896f1276457707d70318d46770">KS_SLICE_PLAN::nslices</a></div><div class="ttdeci">int nslices</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1200</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8fd0ecd6b54b0baaa731127c4520a3dd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8fd0ecd6b54b0baaa731127c4520a3dd">&#9670;&nbsp;</a></span>ks_scan_getslicetime()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_scan_getslicetime </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_k_s___s_l_i_c_e___p_l_a_n.html">KS_SLICE_PLAN</a> *&#160;</td>
          <td class="paramname"><em>slice_plan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>passindx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>slloc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the temporally sorted slice index from a DATA_ACQ_ORDER struct array</h4>
</p>
<p>This function finds the temporally sorted slice index (<code>.sltime</code>) in range [0, nslices-1] given the sequence's DATA_ACQ_ORDER struct array (in slice_plan.acq_order)</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">slice_plan</td><td>Pointer to the slice plan (<a class="el" href="struct_k_s___s_l_i_c_e___p_l_a_n.html" title="Struct holding all information about slice locations and aquisition order">KS_SLICE_PLAN</a>) for the sequence </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">passindx</td><td>Current pass index ([0, acqs-1]) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">slloc</td><td>Spatially sorted slice index [0, nslices-1] </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">sltimeinpass</td><td>Temporal index of the <code>n</code> slices acquired in each pass ([0, n-1]) </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;                                                                                   {</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; slice_plan-&gt;<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a3414dc896f1276457707d70318d46770">nslices</a>; i++) {</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;    <span class="keywordflow">if</span> (slice_plan-&gt;<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#af6c9bb6611e03718085512d2c90cfcd8">acq_order</a>[i].slpass == <a class="code" href="ksfse__implementation_8e.html#aae477e374b559bf16a475321797d62cb">passindx</a> &amp;&amp; slice_plan-&gt;<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#af6c9bb6611e03718085512d2c90cfcd8">acq_order</a>[i].slloc == slloc) {</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;      <span class="keywordflow">return</span> slice_plan-&gt;<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#af6c9bb6611e03718085512d2c90cfcd8">acq_order</a>[i].sltime;</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    }</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;  }</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>;</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;}</div><div class="ttc" id="struct_k_s___s_l_i_c_e___p_l_a_n_html_af6c9bb6611e03718085512d2c90cfcd8"><div class="ttname"><a href="struct_k_s___s_l_i_c_e___p_l_a_n.html#af6c9bb6611e03718085512d2c90cfcd8">KS_SLICE_PLAN::acq_order</a></div><div class="ttdeci">DATA_ACQ_ORDER acq_order[SLICE_FACTOR *DATA_ACQ_MAX]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1203</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_afd953f31b866a09e0418967c2bf65a59"><div class="ttname"><a href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a></div><div class="ttdeci">#define KS_NOTSET</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:60</div></div>
<div class="ttc" id="ksfse__implementation_8e_html_aae477e374b559bf16a475321797d62cb"><div class="ttname"><a href="ksfse__implementation_8e.html#aae477e374b559bf16a475321797d62cb">passindx</a></div><div class="ttdeci">int passindx</div><div class="ttdef"><b>Definition:</b> ksfse_implementation.e:2829</div></div>
<div class="ttc" id="struct_k_s___s_l_i_c_e___p_l_a_n_html_a3414dc896f1276457707d70318d46770"><div class="ttname"><a href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a3414dc896f1276457707d70318d46770">KS_SLICE_PLAN::nslices</a></div><div class="ttdeci">int nslices</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1200</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a27071ced949f926058771246110c119c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a27071ced949f926058771246110c119c">&#9670;&nbsp;</a></span>ks_scan_epi_verify_phaseenc_plan()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811">ks_enum_epiblipsign</a> ks_scan_epi_verify_phaseenc_plan </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *&#160;</td>
          <td class="paramname"><em>epi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *&#160;</td>
          <td class="paramname"><em>phaseenc_plan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>shot</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;                                                                                                                  {</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;  <span class="keywordtype">int</span> kystep[epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a>];</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811">ks_enum_epiblipsign</a> blipsign = <a class="code" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811a38ffa981f0cb6b0e4660575afb14f751">KS_EPI_NOBLIPS</a>;</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;  <a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html">KS_PHASEENCODING_COORD</a> coord = <a class="code" href="_k_s_foundation_8h.html#ae5e9ce52cebc9a6543bc6e69e9a03148">KS_INIT_PHASEENCODING_COORD</a>;</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;  <span class="keywordflow">if</span> (phaseenc_plan == NULL) {</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;    <span class="keywordflow">return</span> blipsign;</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;  }</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;  <span class="comment">/* verify phase encoding plan has equidistant ky step size */</span></div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;  <span class="comment">/* first store ky coords */</span></div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a>; i++) {</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;    coord = <a class="code" href="_k_s_foundation_8h.html#a9712828cb11bdaf20671ac4e43c80d3a">ks_phaseencoding_get</a>(phaseenc_plan, i, shot);</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;    kystep[i] = coord.<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#ad097e95262501d52829d5cd9a827275c">ky</a>;</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;  }</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a>-1; i++) {</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    kystep[i] = kystep[i+1] - kystep[i]; <span class="comment">/* calculate ky step */</span></div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    <span class="keywordflow">if</span> (i &gt; 0) {</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;      <span class="comment">/* check that kystep is consistent */</span></div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;      <span class="keywordflow">if</span> (kystep[i] != kystep[0]) {</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;        <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: KS_EPI does not support varying ky step size&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811a38ffa981f0cb6b0e4660575afb14f751">KS_EPI_NOBLIPS</a>;</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;      }</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    }</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;  }</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;  <span class="keywordflow">if</span> (kystep[0] &lt; 0) {</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    blipsign = <a class="code" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811ab36b1c8bcdbe924fc9d4a36cde9ba4dd">KS_EPI_POSBLIPS</a>;</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (kystep[0] &gt; 0) {</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;    blipsign = <a class="code" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811a5b332d904cae8d59fc2f85b49ada0ae4">KS_EPI_NEGBLIPS</a>;</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;  }</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;  <span class="keywordflow">return</span> blipsign;</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_ae5e9ce52cebc9a6543bc6e69e9a03148"><div class="ttname"><a href="_k_s_foundation_8h.html#ae5e9ce52cebc9a6543bc6e69e9a03148">KS_INIT_PHASEENCODING_COORD</a></div><div class="ttdeci">#define KS_INIT_PHASEENCODING_COORD</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:139</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d_html_ad097e95262501d52829d5cd9a827275c"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#ad097e95262501d52829d5cd9a827275c">KS_PHASEENCODING_COORD::ky</a></div><div class="ttdeci">int ky</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1553</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a7582325a159d8ec89a4a4ba0fb89e9a9"><div class="ttname"><a href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">KS_EPI::etl</a></div><div class="ttdeci">int etl</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1690</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d_html"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html">KS_PHASEENCODING_COORD</a></div><div class="ttdoc">Struct holding a 3D k-space phase encoding location (ky,kz)</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1552</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a9712828cb11bdaf20671ac4e43c80d3a"><div class="ttname"><a href="_k_s_foundation_8h.html#a9712828cb11bdaf20671ac4e43c80d3a">ks_phaseencoding_get</a></div><div class="ttdeci">KS_PHASEENCODING_COORD ks_phaseencoding_get(const KS_PHASEENCODING_PLAN *phaseenc_plan_ptr, int echo, int shot)</div><div class="ttdoc">Get [ky,kz] coordinate from KS_PHASEENCODING_PLAN for given echo and shot</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:308</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ae3a267da7c3c7e4e6e523dafba9b7811ab36b1c8bcdbe924fc9d4a36cde9ba4dd"><div class="ttname"><a href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811ab36b1c8bcdbe924fc9d4a36cde9ba4dd">KS_EPI_POSBLIPS</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1741</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ae3a267da7c3c7e4e6e523dafba9b7811"><div class="ttname"><a href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811">ks_enum_epiblipsign</a></div><div class="ttdeci">ks_enum_epiblipsign</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1741</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ae3a267da7c3c7e4e6e523dafba9b7811a38ffa981f0cb6b0e4660575afb14f751"><div class="ttname"><a href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811a38ffa981f0cb6b0e4660575afb14f751">KS_EPI_NOBLIPS</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1741</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ae3a267da7c3c7e4e6e523dafba9b7811a5b332d904cae8d59fc2f85b49ada0ae4"><div class="ttname"><a href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811a5b332d904cae8d59fc2f85b49ada0ae4">KS_EPI_NEGBLIPS</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1741</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0d83cf730d82612a87abc0f024bea336"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0d83cf730d82612a87abc0f024bea336">&#9670;&nbsp;</a></span>ks_scan_epi_shotcontrol()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_epi_shotcontrol </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *&#160;</td>
          <td class="paramname"><em>epi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>echo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SCAN_INFO&#160;</td>
          <td class="paramname"><em>sliceinfo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *&#160;</td>
          <td class="paramname"><em>phaseenc_plan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>shot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>rcvphase</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Changes the gradient state of a <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> object for the given slice information</h4>
</p>
<p>This function has two different tasks. First, it controls the EPI blips and sets the EPI dephaser and rephaser amplitude given the current <code>phaseshot</code> and <code>blipsign</code>. If <code>phaseshot</code> is outside the valid range ([0, <code>.blipphaser.R</code>-1], all gradient amplitudes on the blip (phase encoding) axis will be zero. This can be useful to acquire a refscan for Nyquist ghost correction. Second, it sets up the proper frequency and phase modulation per readout lobe to produce the desired FOV offset in both the frequency and phase encoding directions</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">epi</td><td>Pointer to <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">echo</td><td>EPI echo index (up to 16 EPI trains supported) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sliceinfo</td><td>SCAN_INFO struct for the current slice to be played out </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">phaseenc_plan</td><td>Pointer to the phase encoding plan </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">shot</td><td>Linear ky kz <code>shot</code> index in range <code>[0, (phaseenc_plan.num_shots-1)]</code> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rcvphase</td><td>Receiver phase in degrees, for RF spoiling. </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;                                                                                                                                         {</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;  <span class="keywordtype">float</span> blipampscale = 1.0;</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;  <span class="keywordtype">float</span> yfovratio, zfovratio;</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;  <span class="keywordtype">int</span> i, readindx, blipindx, kyview, kzview;</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;  <span class="keywordtype">int</span> numblips = (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a> - 1);</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;  <a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html">KS_PHASEENCODING_COORD</a> coord = <a class="code" href="_k_s_foundation_8h.html#ae5e9ce52cebc9a6543bc6e69e9a03148">KS_INIT_PHASEENCODING_COORD</a>;</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;  </div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811">ks_enum_epiblipsign</a> blipsign = <a class="code" href="_k_s_foundation__tgt_8c.html#a27071ced949f926058771246110c119c">ks_scan_epi_verify_phaseenc_plan</a>(epi, phaseenc_plan, shot);</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;  <span class="keywordflow">if</span> (phaseenc_plan != NULL &amp;&amp; (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a> != phaseenc_plan-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a>)) {</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: ETL of KS_EPI (%d) and KS_PHASEENCODING_PLAN (%d) do not match&quot;</span>, __FUNCTION__, epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a>, phaseenc_plan-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a>);</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;    blipsign = <a class="code" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811a38ffa981f0cb6b0e4660575afb14f751">KS_EPI_NOBLIPS</a>;</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;  }</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;  <span class="comment">/* EPI read &amp; blips for current &#39;echo&#39; = EPI train. */</span></div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a>; i++) {</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;    coord = <a class="code" href="_k_s_foundation_8h.html#a9712828cb11bdaf20671ac4e43c80d3a">ks_phaseencoding_get</a>(phaseenc_plan, i, shot);</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;    kyview = (blipsign != <a class="code" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811a38ffa981f0cb6b0e4660575afb14f751">KS_EPI_NOBLIPS</a>) ? coord.<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#ad097e95262501d52829d5cd9a827275c">ky</a> : <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>;</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;    kzview = (blipsign != <a class="code" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811a38ffa981f0cb6b0e4660575afb14f751">KS_EPI_NOBLIPS</a>) ? coord.<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#a7894f45c2928e5a523eeafc5ef4ae8b7">kz</a> : <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>;</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;    <span class="keywordflow">if</span> (i == 0) { <span class="comment">/* EPI dephaser. From k-space center to this line */</span></div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;      <a class="code" href="_k_s_foundation__tgt_8c.html#aff91e4da3b6ccabd607ec0da04f774ce">ks_scan_phaser_toline</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>, 0 + 2 * echo, kyview); <span class="comment">/* KS_NOTSET =&gt; zero amplitude */</span></div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;      <span class="keywordflow">if</span> (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> &gt; 0) {</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;        <span class="comment">/* 3D epi z dephaser(s) for even instances &#39;2*echo&#39; */</span></div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;        <a class="code" href="_k_s_foundation__tgt_8c.html#aff91e4da3b6ccabd607ec0da04f774ce">ks_scan_phaser_toline</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>, 0 + 2 * echo, kzview);</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;      }</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;    }</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;    </div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;    <span class="keywordflow">if</span> (i == epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a>-1) { <span class="comment">/* EPI rephaser. From this line to k-space center */</span></div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;      <a class="code" href="_k_s_foundation__tgt_8c.html#a81a97893a74af952d90181aa858e709b">ks_scan_phaser_fromline</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>, 1 + 2 * echo, kyview); <span class="comment">/* KS_NOTSET =&gt; zero amplitude */</span></div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;      <span class="keywordflow">if</span> (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> &gt; 0) {</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;        <span class="comment">/* 3D epi z rephaser(s) for odd instances &#39;1+2*echo&#39; */</span></div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;        <a class="code" href="_k_s_foundation__tgt_8c.html#a81a97893a74af952d90181aa858e709b">ks_scan_phaser_fromline</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>, 1 + 2 * echo, kzview);</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;      }</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    }</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;    readindx = i + echo * epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a>; <span class="comment">/* ETL# of readouts */</span></div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;    blipindx = i + echo * numblips;  <span class="comment">/* (ETL-1)# of blips */</span></div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;    <span class="keywordflow">if</span> (i &lt; numblips) {</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;      <span class="comment">/* FUTURE: at this point, we could increase/decrease blipampscale for odd/even blips for oblique ghost correction */</span></div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;      blipampscale = blipsign / epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#ab758140f3ca23e746a312f34a0d9c3a9">blipoversize</a>;</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;      <a class="code" href="_k_s_foundation__tgt_8c.html#a981da87d928a921e5d179e8268b92f1f">ks_scan_trap_ampscale</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#aaa0021ab8174eb7806de89d599769a9b">blip</a>, blipindx, blipampscale);</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;    }</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;    <span class="comment">/* FOV offsets (by changing freq/phase of epi.read) */</span></div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;    yfovratio = epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#abfd94a01fc71278021802ca0d1e25e16">fov</a> / epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#abfd94a01fc71278021802ca0d1e25e16">fov</a>;</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;    <span class="keywordflow">if</span> (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> &gt; 0) {</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;      zfovratio = epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#abfd94a01fc71278021802ca0d1e25e16">fov</a> / epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#abfd94a01fc71278021802ca0d1e25e16">fov</a>;</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;      <a class="code" href="_k_s_foundation__tgt_8c.html#a368695617a7edf4fdba05325573efb12">ks_scan_offsetfov3D</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>, readindx, sliceinfo, kyview, yfovratio, kzview, zfovratio, rcvphase);</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;      <a class="code" href="_k_s_foundation__tgt_8c.html#a567f7714943a0c78a422ee41defe2acf">ks_scan_offsetfov</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>, readindx, sliceinfo, kyview, yfovratio, rcvphase);</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;    }</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;  } <span class="comment">/* for etl */</span></div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;} <span class="comment">/* ks_scan_epi_shotcontrol */</span></div><div class="ttc" id="struct_k_s___e_p_i_html_ab758140f3ca23e746a312f34a0d9c3a9"><div class="ttname"><a href="struct_k_s___e_p_i.html#ab758140f3ca23e746a312f34a0d9c3a9">KS_EPI::blipoversize</a></div><div class="ttdeci">float blipoversize</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1694</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_aaa0021ab8174eb7806de89d599769a9b"><div class="ttname"><a href="struct_k_s___e_p_i.html#aaa0021ab8174eb7806de89d599769a9b">KS_EPI::blip</a></div><div class="ttdeci">KS_TRAP blip</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1687</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ae5e9ce52cebc9a6543bc6e69e9a03148"><div class="ttname"><a href="_k_s_foundation_8h.html#ae5e9ce52cebc9a6543bc6e69e9a03148">KS_INIT_PHASEENCODING_COORD</a></div><div class="ttdeci">#define KS_INIT_PHASEENCODING_COORD</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:139</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_aff91e4da3b6ccabd607ec0da04f774ce"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#aff91e4da3b6ccabd607ec0da04f774ce">ks_scan_phaser_toline</a></div><div class="ttdeci">void ks_scan_phaser_toline(KS_PHASER *phaser, int instanceno, int view)</div><div class="ttdoc">Updates the amplitude of a KS_PHASER sequence object to move from the k-space center to a desired k-s...</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:319</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">KS_PHASER::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1525</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a567f7714943a0c78a422ee41defe2acf"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a567f7714943a0c78a422ee41defe2acf">ks_scan_offsetfov</a></div><div class="ttdeci">void ks_scan_offsetfov(KS_READTRAP *readtrap, int instanceno, SCAN_INFO sliceinfo, int kyview, float phasefovratio, float rcvphase)</div><div class="ttdoc">Updates the frequency and phase of one or all instances of a KS_READTRAP to create a FOV shift...</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:905</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_afd953f31b866a09e0418967c2bf65a59"><div class="ttname"><a href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a></div><div class="ttdeci">#define KS_NOTSET</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:60</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_abfd94a01fc71278021802ca0d1e25e16"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#abfd94a01fc71278021802ca0d1e25e16">KS_READTRAP::fov</a></div><div class="ttdeci">float fov</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1425</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a22cd0313e5ffabe8393f77745dba8d52"><div class="ttname"><a href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">KS_EPI::blipphaser</a></div><div class="ttdeci">KS_PHASER blipphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1688</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d_html_ad097e95262501d52829d5cd9a827275c"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#ad097e95262501d52829d5cd9a827275c">KS_PHASEENCODING_COORD::ky</a></div><div class="ttdeci">int ky</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1553</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_ad76a5ac226f0d25f70349ef83b5bc38a"><div class="ttname"><a href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">KS_EPI::zphaser</a></div><div class="ttdeci">KS_PHASER zphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1689</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a27071ced949f926058771246110c119c"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a27071ced949f926058771246110c119c">ks_scan_epi_verify_phaseenc_plan</a></div><div class="ttdeci">ks_enum_epiblipsign ks_scan_epi_verify_phaseenc_plan(KS_EPI *epi, KS_PHASEENCODING_PLAN *phaseenc_plan, int shot)</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1049</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d_html_a7894f45c2928e5a523eeafc5ef4ae8b7"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#a7894f45c2928e5a523eeafc5ef4ae8b7">KS_PHASEENCODING_COORD::kz</a></div><div class="ttdeci">int kz</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1554</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a7582325a159d8ec89a4a4ba0fb89e9a9"><div class="ttname"><a href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">KS_EPI::etl</a></div><div class="ttdeci">int etl</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1690</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d_html"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html">KS_PHASEENCODING_COORD</a></div><div class="ttdoc">Struct holding a 3D k-space phase encoding location (ky,kz)</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1552</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a9712828cb11bdaf20671ac4e43c80d3a"><div class="ttname"><a href="_k_s_foundation_8h.html#a9712828cb11bdaf20671ac4e43c80d3a">ks_phaseencoding_get</a></div><div class="ttdeci">KS_PHASEENCODING_COORD ks_phaseencoding_get(const KS_PHASEENCODING_PLAN *phaseenc_plan_ptr, int echo, int shot)</div><div class="ttdoc">Get [ky,kz] coordinate from KS_PHASEENCODING_PLAN for given echo and shot</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:308</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a7582325a159d8ec89a4a4ba0fb89e9a9"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">KS_PHASEENCODING_PLAN::etl</a></div><div class="ttdeci">int etl</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1588</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a03d42c44e323f3203fe5beabcefa47a5"><div class="ttname"><a href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">KS_EPI::read</a></div><div class="ttdeci">KS_READTRAP read</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1685</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a368695617a7edf4fdba05325573efb12"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a368695617a7edf4fdba05325573efb12">ks_scan_offsetfov3D</a></div><div class="ttdeci">void ks_scan_offsetfov3D(KS_READTRAP *readtrap, int instanceno, SCAN_INFO sliceinfo, int kyview, float phasefovratio, int kzview, float zphasefovratio, float rcvphase)</div><div class="ttdoc">Updates the frequency and phase of one or all instances of a KS_READTRAP to create a FOV shift...</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:912</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ae3a267da7c3c7e4e6e523dafba9b7811"><div class="ttname"><a href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811">ks_enum_epiblipsign</a></div><div class="ttdeci">ks_enum_epiblipsign</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1741</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a981da87d928a921e5d179e8268b92f1f"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a981da87d928a921e5d179e8268b92f1f">ks_scan_trap_ampscale</a></div><div class="ttdeci">void ks_scan_trap_ampscale(KS_TRAP *trp, int instanceno, float ampscale)</div><div class="ttdoc">Updates the amplitude of one or all instances of a KS_TRAP sequence object</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:182</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a81a97893a74af952d90181aa858e709b"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a81a97893a74af952d90181aa858e709b">ks_scan_phaser_fromline</a></div><div class="ttdeci">void ks_scan_phaser_fromline(KS_PHASER *phaser, int instanceno, int view)</div><div class="ttdoc">Updates the amplitude of a KS_PHASER sequence object to move from a k-space line to the k-space cente...</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:338</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_TRAP::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:437</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ae3a267da7c3c7e4e6e523dafba9b7811a38ffa981f0cb6b0e4660575afb14f751"><div class="ttname"><a href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811a38ffa981f0cb6b0e4660575afb14f751">KS_EPI_NOBLIPS</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1741</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_abfd94a01fc71278021802ca0d1e25e16"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#abfd94a01fc71278021802ca0d1e25e16">KS_PHASER::fov</a></div><div class="ttdeci">float fov</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1526</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a27b64905234db826096802c5a1f5bd6e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a27b64905234db826096802c5a1f5bd6e">&#9670;&nbsp;</a></span>ks_scan_epi_loadecho()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_epi_loadecho </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *&#160;</td>
          <td class="paramname"><em>epi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>echo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>storeecho</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>slice</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *&#160;</td>
          <td class="paramname"><em>phaseenc_plan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>shot</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Loads the data storage information to hardware for the acquisition windows in a <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> sequence object</h4>
</p>
<p>This function specifies where to store the data acquired for each readout lobe in the <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> train given current:</p><ul>
<li><code>echo</code>: First instance of the <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> train is 0</li>
<li><code>slice</code>: Slice index, 0-based</li>
<li><code>shot</code>: Linear ky kz <code>shot</code> index in range <code>[0, (phaseenc_plan.num_shots-1)]</code></li>
<li><code>phaseenc_plan</code>: phaseenc_plan Pointer to the phase encoding plan</li>
</ul>
<p>If <code>shot</code> is outside the valid range, a baseline view (view 0 in loaddab()) will be acquired.</p>
<p>If <code>slice</code> is &lt; 0, data acquisition is turned <em>off</em> in loaddab()</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">epi</td><td>Pointer to <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">echo</td><td>EPI echo index to work on (up to 16 EPI trains supported) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">storeecho</td><td>EPI echo index for storing (usually the same as echo) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">slice</td><td>Slice index where to store the data (0-based) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">phaseenc_plan</td><td>Pointer to the phase encoding plan </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">shot</td><td>Linear ky kz <code>shot</code> index in range <code>[0, (phaseenc_plan.num_shots-1)]</code> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;                                                                                                                           {</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;  <span class="keywordtype">int</span> i, readindx;</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;  <span class="keywordtype">int</span> validsliceindx = (slice &gt;= 0 &amp;&amp; slice &lt; 2048);</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;  <span class="keywordtype">int</span> validshotindx = (shot &gt;= 0 &amp;&amp; (phaseenc_plan == NULL || shot &lt; phaseenc_plan-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#aa2f98be84137da8386df3fc88763823c">num_shots</a>));</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;  <span class="keywordtype">int</span> kyview = <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>;</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;  TYPDAB_PACKETS dabacqctrl;</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;  <a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html">KS_PHASEENCODING_COORD</a> coord = <a class="code" href="_k_s_foundation_8h.html#ae5e9ce52cebc9a6543bc6e69e9a03148">KS_INIT_PHASEENCODING_COORD</a>;</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811">ks_enum_epiblipsign</a> blipsign = <a class="code" href="_k_s_foundation__tgt_8c.html#a27071ced949f926058771246110c119c">ks_scan_epi_verify_phaseenc_plan</a>(epi, phaseenc_plan, shot);</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;  <span class="keywordtype">int</span> centerecho = epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#aa29afe5800d6b5d4be29e1da24c63caf">time2center</a> / epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>; <span class="comment">/* etl index corresponding to k-space center */</span></div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;  <span class="keywordtype">int</span> numplaced = epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>;</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;  <span class="keywordtype">int</span> numplaced = epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>;</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;  <span class="keywordflow">if</span> (numplaced == 0) {</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;  }</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;  <span class="keywordflow">if</span> (storeecho &lt; 0 || storeecho &gt; 15) {</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: storeecho must be in range [0:15]&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;  }</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;  <span class="keywordflow">if</span> (echo &lt; 0 || (echo + 1) * epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a> &gt; numplaced) {</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: echo (%d) must be in range [0:%d]&quot;</span>, __FUNCTION__, echo, numplaced/epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a>-1);</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;  }</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a>; i++) {</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;    readindx = i + echo * epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a>; <span class="comment">/* N.B.: &#39;echo&#39; is # of EPI trains, not EPI readout lobes (up to 16 possible, set by opnecho) */</span></div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;    <span class="keywordflow">if</span> (readindx &gt;= numplaced) {</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;      <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_epi_loadecho(%s): Readout lobe index %d has not been placed in PG&quot;</span>, epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, readindx);</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;    }</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;    <span class="keywordflow">if</span> (validshotindx &amp;&amp; (blipsign != <a class="code" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811a38ffa981f0cb6b0e4660575afb14f751">KS_EPI_NOBLIPS</a>)) {</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;      coord = <a class="code" href="_k_s_foundation_8h.html#a9712828cb11bdaf20671ac4e43c80d3a">ks_phaseencoding_get</a>(phaseenc_plan, i, shot);</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;      kyview = coord.<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#ad097e95262501d52829d5cd9a827275c">ky</a>;</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__tgt_8c.html#ad152641fe076fd7c466bf3eff5d0a13f">rhasset</a> == ASSET_SCAN &amp;&amp; epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a> &gt; 1 &amp;&amp; epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a4762b9a6307f0223b3d1dfde7e8ddce8">nacslines</a> == 0) {</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;        <span class="comment">/* Auto-detect ASSET scan, which uses compressed storage of accelerated data, i.e. only</span></div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;<span class="comment">           storing the acquired lines, without inteleaving with blank unacquired lines */</span></div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;        <span class="keywordflow">if</span> (blipsign == <a class="code" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811ab36b1c8bcdbe924fc9d4a36cde9ba4dd">KS_EPI_POSBLIPS</a>) {</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;          kyview = epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a>-1 - i;</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (blipsign == <a class="code" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811a5b332d904cae8d59fc2f85b49ada0ae4">KS_EPI_NEGBLIPS</a>) {</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;          kyview = i;</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;        }</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;      }</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;    }</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;    <span class="keywordflow">if</span> (validsliceindx &amp;&amp; validshotindx) {</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;      dabacqctrl = DABON; <span class="comment">/* turn receiver on */</span></div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;      dabacqctrl = DABOFF; <span class="comment">/* turn receiver off */</span></div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;      slice = 0; <span class="comment">/* necessary? */</span></div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;    }</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__tgt_8c.html#adbed7cbe302ef957a49dead6990d286f">rspent</a> == L_APS2 || <a class="code" href="_k_s_foundation__tgt_8c.html#adbed7cbe302ef957a49dead6990d286f">rspent</a> == L_MPS2) {</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;      <span class="comment">/* Prescan (R1 &amp; R2) */</span></div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;      <span class="keywordflow">if</span> (readindx == centerecho)</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;        loaddab(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a0e0bae3aa47ae5b8aae488fa0eb920ce">echo</a>[readindx], slice, storeecho, DABSTORE, 0, dabacqctrl, PSD_LOAD_DAB_ALL); <span class="comment">/* turn on acquisition for center echo of 1st EPI train */</span></div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;        loaddab(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a0e0bae3aa47ae5b8aae488fa0eb920ce">echo</a>[readindx], slice, storeecho, DABSTORE, 0, DABOFF, PSD_LOAD_DAB_ALL); <span class="comment">/* turn off acquisition for all other lobes (and all later EPI trains) */</span></div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;      <span class="comment">/* N.B.: kyview = KS_NOTSET (-1) if shot = KS_NOTSET. Hence kyview + 1 = dabview = 0 without phase encodes */</span></div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;      loaddab(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a0e0bae3aa47ae5b8aae488fa0eb920ce">echo</a>[readindx], slice, storeecho, DABSTORE, kyview + 1 <span class="comment">/* GE&#39;s views are 1-based */</span>, dabacqctrl, PSD_LOAD_DAB_ALL);</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;    }</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;  } <span class="comment">/* per acq window (readout lobe) */</span></div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;} <span class="comment">/* ks_scan_epi_loadecho */</span></div><div class="ttc" id="_k_s_foundation_8h_html_ae5e9ce52cebc9a6543bc6e69e9a03148"><div class="ttname"><a href="_k_s_foundation_8h.html#ae5e9ce52cebc9a6543bc6e69e9a03148">KS_INIT_PHASEENCODING_COORD</a></div><div class="ttdeci">#define KS_INIT_PHASEENCODING_COORD</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:139</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a3d90133d3051fbc4816d02efd9566d8e"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">KS_PHASER::R</a></div><div class="ttdeci">int R</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1529</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a0e0bae3aa47ae5b8aae488fa0eb920ce"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a0e0bae3aa47ae5b8aae488fa0eb920ce">KS_READ::echo</a></div><div class="ttdeci">WF_PULSE * echo</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:587</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_aa2f98be84137da8386df3fc88763823c"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#aa2f98be84137da8386df3fc88763823c">KS_PHASEENCODING_PLAN::num_shots</a></div><div class="ttdeci">int num_shots</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1587</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a4762b9a6307f0223b3d1dfde7e8ddce8"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a4762b9a6307f0223b3d1dfde7e8ddce8">KS_PHASER::nacslines</a></div><div class="ttdeci">int nacslines</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1530</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_afd953f31b866a09e0418967c2bf65a59"><div class="ttname"><a href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a></div><div class="ttdeci">#define KS_NOTSET</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:60</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a72a22b96ff3908d2b9a20a3a02647a2f"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">KS_BASE::ninst</a></div><div class="ttdeci">int ninst</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:261</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a22cd0313e5ffabe8393f77745dba8d52"><div class="ttname"><a href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">KS_EPI::blipphaser</a></div><div class="ttdeci">KS_PHASER blipphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1688</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d_html_ad097e95262501d52829d5cd9a827275c"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#ad097e95262501d52829d5cd9a827275c">KS_PHASEENCODING_COORD::ky</a></div><div class="ttdeci">int ky</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1553</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_adbed7cbe302ef957a49dead6990d286f"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#adbed7cbe302ef957a49dead6990d286f">rspent</a></div><div class="ttdeci">int rspent</div><div class="ttdef"><b>Definition:</b> GERequired.e:2614</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a27071ced949f926058771246110c119c"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a27071ced949f926058771246110c119c">ks_scan_epi_verify_phaseenc_plan</a></div><div class="ttdeci">ks_enum_epiblipsign ks_scan_epi_verify_phaseenc_plan(KS_EPI *epi, KS_PHASEENCODING_PLAN *phaseenc_plan, int shot)</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1049</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">KS_READTRAP::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1435</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">KS_READ::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:581</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a7582325a159d8ec89a4a4ba0fb89e9a9"><div class="ttname"><a href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">KS_EPI::etl</a></div><div class="ttdeci">int etl</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1690</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d_html"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html">KS_PHASEENCODING_COORD</a></div><div class="ttdoc">Struct holding a 3D k-space phase encoding location (ky,kz)</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1552</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a9712828cb11bdaf20671ac4e43c80d3a"><div class="ttname"><a href="_k_s_foundation_8h.html#a9712828cb11bdaf20671ac4e43c80d3a">ks_phaseencoding_get</a></div><div class="ttdeci">KS_PHASEENCODING_COORD ks_phaseencoding_get(const KS_PHASEENCODING_PLAN *phaseenc_plan_ptr, int echo, int shot)</div><div class="ttdoc">Get [ky,kz] coordinate from KS_PHASEENCODING_PLAN for given echo and shot</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:308</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a03d42c44e323f3203fe5beabcefa47a5"><div class="ttname"><a href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">KS_EPI::read</a></div><div class="ttdeci">KS_READTRAP read</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1685</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_ad152641fe076fd7c466bf3eff5d0a13f"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#ad152641fe076fd7c466bf3eff5d0a13f">rhasset</a></div><div class="ttdeci">int rhasset</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ae3a267da7c3c7e4e6e523dafba9b7811ab36b1c8bcdbe924fc9d4a36cde9ba4dd"><div class="ttname"><a href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811ab36b1c8bcdbe924fc9d4a36cde9ba4dd">KS_EPI_POSBLIPS</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1741</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">KS_TRAP::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:432</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ae3a267da7c3c7e4e6e523dafba9b7811"><div class="ttname"><a href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811">ks_enum_epiblipsign</a></div><div class="ttdeci">ks_enum_epiblipsign</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1741</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_aa29afe5800d6b5d4be29e1da24c63caf"><div class="ttname"><a href="struct_k_s___e_p_i.html#aa29afe5800d6b5d4be29e1da24c63caf">KS_EPI::time2center</a></div><div class="ttdeci">int time2center</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1693</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_ac359c54a7c5f9e9a94105b3c0d0be9ea"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">KS_READTRAP::acq</a></div><div class="ttdeci">KS_READ acq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1423</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_TRAP::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:437</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ae3a267da7c3c7e4e6e523dafba9b7811a38ffa981f0cb6b0e4660575afb14f751"><div class="ttname"><a href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811a38ffa981f0cb6b0e4660575afb14f751">KS_EPI_NOBLIPS</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1741</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ae3a267da7c3c7e4e6e523dafba9b7811a5b332d904cae8d59fc2f85b49ada0ae4"><div class="ttname"><a href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811a5b332d904cae8d59fc2f85b49ada0ae4">KS_EPI_NEGBLIPS</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1741</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab251dc87ba751fcc5be656cf3cc5037f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab251dc87ba751fcc5be656cf3cc5037f">&#9670;&nbsp;</a></span>ks_scan_acq_to_rtp()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_acq_to_rtp </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_e_a_d.html">KS_READ</a> *&#160;</td>
          <td class="paramname"><em>read</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">TYPDAB_PACKETS&#160;</td>
          <td class="paramname"><em>dabacqctrl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>fatoffset</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Data routing control for RTP</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">read</td><td>Pointer to <a class="el" href="struct_k_s___r_e_a_d.html" title="Core sequence object that handles a data acquisition window">KS_READ</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dabacqctrl</td><td>DABON or DABOFF </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fatoffset</td><td>Frequency offset in [Hz] for the current data acquisition window </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;                                                                                  {</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;  WF_PULSE *echo_ptr;</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;  WF_PULSE *xtr_ptr;</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;  WF_PULSE *rba_ptr;</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; acq-&gt;base.ngenerated; ++i) {</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;    echo_ptr = &amp;acq-&gt;echo[i];</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;    setrfltrs((<span class="keywordtype">int</span>) acq-&gt;filt.fslot, echo_ptr);</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;    getssppulse(&amp;rba_ptr, echo_ptr, <span class="stringliteral">&quot;rba&quot;</span>, 0);</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;    getssppulse(&amp;xtr_ptr, echo_ptr, <span class="stringliteral">&quot;xtr&quot;</span>, 0);</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;    acqctrl(dabacqctrl, (INT)0, rba_ptr);</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;    setfreqphase((<span class="keywordtype">int</span>)(fatoffset / TARDIS_FREQ_RES), <span class="comment">/* freq ctrl */</span></div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;                 0, <span class="comment">/* phase ctrl */</span></div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;                 xtr_ptr);</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;    <span class="comment">/* TODO: Add r1 scaling here! */</span></div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;    <span class="comment">/*if (r1_scale != 1.0 &amp;&amp; (rspent==L_SCAN)) {</span></div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;<span class="comment">      newR1 = ceil(pscR1 * r1_scale);</span></div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;<span class="comment">      if (newR1 &gt; 13)</span></div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;<span class="comment">    newR1 = 13;</span></div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;<span class="comment">      else if (newR1 &lt; 1)</span></div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;<span class="comment">    newR1 = 1;</span></div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;<span class="comment">      loaddab_hub_r1(echo_ptr, dabslice, dabecho, DABSTORE, dabview, 0, newR1, dabacqctrl, PSD_LOAD_DAB_ALL | PSD_LOAD_DAB_R1);</span></div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;<span class="comment">      }*/</span> <span class="comment">/* if R1 change */</span></div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;    routeDataFrameDab(echo_ptr, ROUTE_TO_RTP, <a class="code" href="_k_s_foundation__tgt_8c.html#addb9fdd9991d3e67d8449a10df030b07">cfcoilswitchmethod</a>);</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;  }</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;}</div><div class="ttc" id="_k_s_foundation__tgt_8c_html_addb9fdd9991d3e67d8449a10df030b07"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#addb9fdd9991d3e67d8449a10df030b07">cfcoilswitchmethod</a></div><div class="ttdeci">int cfcoilswitchmethod</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a595f599c90a3cb1f300c3c83b5fa116d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a595f599c90a3cb1f300c3c83b5fa116d">&#9670;&nbsp;</a></span>ks_scan_switch_to_sequence()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_switch_to_sequence </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>ctrl</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;                                                      {</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;  <span class="keywordflow">if</span> (ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> &gt; 0) {</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;    <a class="code" href="_k_s_foundation__tgt_8c.html#a17778e7ed4abcb39ee14e9e4d2966b18">boffset</a>(ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a0dd6f20330fb1abf528ca46f34299f7c">handle</a>.<a class="code" href="struct_k_s___s_e_q___h_a_n_d_l_e.html#a625adc8d3d12f5199327f158aa4d166b">offset</a>);</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;  }</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;}</div><div class="ttc" id="_k_s_foundation__tgt_8c_html_a17778e7ed4abcb39ee14e9e4d2966b18"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a17778e7ed4abcb39ee14e9e4d2966b18">boffset</a></div><div class="ttdeci">STATUS boffset(long *offsets)</div></div>
<div class="ttc" id="struct_k_s___s_e_q___h_a_n_d_l_e_html_a625adc8d3d12f5199327f158aa4d166b"><div class="ttname"><a href="struct_k_s___s_e_q___h_a_n_d_l_e.html#a625adc8d3d12f5199327f158aa4d166b">KS_SEQ_HANDLE::offset</a></div><div class="ttdeci">long * offset</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:835</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_SEQ_CONTROL::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:984</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a0dd6f20330fb1abf528ca46f34299f7c"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a0dd6f20330fb1abf528ca46f34299f7c">KS_SEQ_CONTROL::handle</a></div><div class="ttdeci">KS_SEQ_HANDLE handle</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:991</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a02e188307a4bd9dfdb00d37688c0487e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a02e188307a4bd9dfdb00d37688c0487e">&#9670;&nbsp;</a></span>ks_scan_playsequence()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_scan_playsequence </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>ctrl</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;                                               {</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;  <span class="keywordflow">if</span> (ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> &gt; 0) {</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;    {</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;      <a class="code" href="_k_s_foundation__tgt_8c.html#a595f599c90a3cb1f300c3c83b5fa116d">ks_scan_switch_to_sequence</a>(ctrl);</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;      <a class="code" href="_k_s_foundation__tgt_8c.html#a70f8570a5d1cca01d8d49d9cd34bed79">setssitime</a>(ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6037d68ff7b6f66735a92611628df57">ssi_time</a> / <a class="code" href="_k_s_foundation__tgt_8c.html#a3d585d11b35cba1755ed2e74ae864997">cfhwgut</a>);</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;      <a class="code" href="_k_s_foundation__tgt_8c.html#a7a93838e7d53ff7ec9fbe98843181d03">startseq</a>(0, (<span class="keywordtype">short</span>) MAY_PAUSE); <span class="comment">/* play out the sequence in real time */</span></div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;    }</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;    <span class="comment">/* HOST */</span></div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;    ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a5af9f3a7de19e7493ce64776bd8f3556">nseqinstances</a>++;</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;  } <span class="comment">/* ctrl-&gt;duration &gt; 0 */</span></div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;  <span class="keywordflow">return</span> ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>;</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;}</div><div class="ttc" id="_k_s_foundation__tgt_8c_html_a7a93838e7d53ff7ec9fbe98843181d03"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a7a93838e7d53ff7ec9fbe98843181d03">startseq</a></div><div class="ttdeci">STATUS startseq(s16, s16)</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a70f8570a5d1cca01d8d49d9cd34bed79"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a70f8570a5d1cca01d8d49d9cd34bed79">setssitime</a></div><div class="ttdeci">STATUS setssitime(long)</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a3d585d11b35cba1755ed2e74ae864997"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a3d585d11b35cba1755ed2e74ae864997">cfhwgut</a></div><div class="ttdeci">int cfhwgut</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_SEQ_CONTROL::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:984</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a5af9f3a7de19e7493ce64776bd8f3556"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a5af9f3a7de19e7493ce64776bd8f3556">KS_SEQ_CONTROL::nseqinstances</a></div><div class="ttdeci">int nseqinstances</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:982</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a595f599c90a3cb1f300c3c83b5fa116d"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a595f599c90a3cb1f300c3c83b5fa116d">ks_scan_switch_to_sequence</a></div><div class="ttdeci">void ks_scan_switch_to_sequence(KS_SEQ_CONTROL *ctrl)</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1269</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_ac6037d68ff7b6f66735a92611628df57"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6037d68ff7b6f66735a92611628df57">KS_SEQ_CONTROL::ssi_time</a></div><div class="ttdeci">int ssi_time</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:983</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3a09974d212d39bdc19d41b3fb3f1535"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3a09974d212d39bdc19d41b3fb3f1535">&#9670;&nbsp;</a></span>ks_scan_loaddabwithindices()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_scan_loaddabwithindices </td>
          <td>(</td>
          <td class="paramtype">WF_PULSE_ADDR&#160;</td>
          <td class="paramname"><em>pulse</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LONG&#160;</td>
          <td class="paramname"><em>slice</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LONG&#160;</td>
          <td class="paramname"><em>echo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LONG&#160;</td>
          <td class="paramname"><em>view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>acq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>vol</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">TYPDAB_PACKETS&#160;</td>
          <td class="paramname"><em>acqon_flag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>loaddab() with extra arguments for current acquisition and image volume</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pulse</td><td>Pointer to WF_PULSE in a <a class="el" href="struct_k_s___r_e_a_d.html" title="Core sequence object that handles a data acquisition window">KS_READ</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">slice</td><td>0-based <em>temporal</em> slice index (2D) or kz encoding step typically (3D) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">echo</td><td>0-based echo in the echo train </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">view</td><td>1-based ky view number </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">acq</td><td>0-based acquisition index (always 0 if all slices fit in one TR) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">vol</td><td>0-based volume index (always 0 if only one volume) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">acqon_flag</td><td>DABON or DABOFF </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;                                                             {</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__tgt_8c.html#aa4c29e21c8d521ebb578246daeb29178">ks_scan_loaddabwithindices_nex</a>(pulse, slice, echo, <a class="code" href="_g_e_required_8e.html#a1cb6f035a0e9565bbf12c3ef04c3c229">view</a>, acq, vol, DABSTORE, acqon_flag);</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;}</div><div class="ttc" id="_k_s_foundation__tgt_8c_html_aa4c29e21c8d521ebb578246daeb29178"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#aa4c29e21c8d521ebb578246daeb29178">ks_scan_loaddabwithindices_nex</a></div><div class="ttdeci">STATUS ks_scan_loaddabwithindices_nex(WF_PULSE_ADDR pulse, LONG slice, LONG echo, LONG view, uint8_t acq, uint8_t vol, LONG operation, TYPDAB_PACKETS acqon_flag)</div><div class="ttdoc">loaddab() with extra arguments for current acquisition and image volume and current excitation (NEX)...</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1305</div></div>
<div class="ttc" id="_g_e_required_8e_html_a1cb6f035a0e9565bbf12c3ef04c3c229"><div class="ttname"><a href="_g_e_required_8e.html#a1cb6f035a0e9565bbf12c3ef04c3c229">view</a></div><div class="ttdeci">int view</div><div class="ttdef"><b>Definition:</b> GERequired.e:2630</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa4c29e21c8d521ebb578246daeb29178"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa4c29e21c8d521ebb578246daeb29178">&#9670;&nbsp;</a></span>ks_scan_loaddabwithindices_nex()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_scan_loaddabwithindices_nex </td>
          <td>(</td>
          <td class="paramtype">WF_PULSE_ADDR&#160;</td>
          <td class="paramname"><em>pulse</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LONG&#160;</td>
          <td class="paramname"><em>slice</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LONG&#160;</td>
          <td class="paramname"><em>echo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LONG&#160;</td>
          <td class="paramname"><em>view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>acq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>vol</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LONG&#160;</td>
          <td class="paramname"><em>operation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">TYPDAB_PACKETS&#160;</td>
          <td class="paramname"><em>acqon_flag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>loaddab() with extra arguments for current acquisition and image volume and current excitation (NEX)</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pulse</td><td>Pointer to WF_PULSE in a <a class="el" href="struct_k_s___r_e_a_d.html" title="Core sequence object that handles a data acquisition window">KS_READ</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">slice</td><td>0-based <em>temporal</em> slice index (2D) or kz encoding step typically (3D) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">echo</td><td>0-based echo in the echo train </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">view</td><td>1-based ky view number </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">acq</td><td>0-based acquisition index (always 0 if all slices fit in one TR) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">vol</td><td>0-based volume index (always 0 if only one volume) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">operation</td><td>DABSTORE, DABADD (for 2nd to last excitation) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">acqon_flag</td><td>DABON or DABOFF </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;                                                             {</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;<span class="preprocessor">#if EPIC_RELEASE &lt; 26</span></div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;  acq = acq;</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;  vol = vol;</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;  <span class="keywordflow">return</span> loaddab(pulse, slice, echo, operation, <a class="code" href="_g_e_required_8e.html#a1cb6f035a0e9565bbf12c3ef04c3c229">view</a>, acqon_flag, PSD_LOAD_DAB_ALL);</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;  <span class="keyword">union </span><a class="code" href="union_indices.html">Indices</a> idx;</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;  idx.<a class="code" href="union_indices.html#acb607650af9713167c308f9121560425">c</a>[0] = acq;</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;  idx.c[1] = vol;</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;  <span class="keywordflow">return</span> loaddabwithangle(pulse, idx.i, slice, echo, operation, <a class="code" href="_g_e_required_8e.html#a1cb6f035a0e9565bbf12c3ef04c3c229">view</a>, acqon_flag, PSD_LOAD_DAB_ALL);</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;}</div><div class="ttc" id="union_indices_html"><div class="ttname"><a href="union_indices.html">Indices</a></div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1300</div></div>
<div class="ttc" id="_g_e_required_8e_html_a1cb6f035a0e9565bbf12c3ef04c3c229"><div class="ttname"><a href="_g_e_required_8e.html#a1cb6f035a0e9565bbf12c3ef04c3c229">view</a></div><div class="ttdeci">int view</div><div class="ttdef"><b>Definition:</b> GERequired.e:2630</div></div>
<div class="ttc" id="union_indices_html_acb607650af9713167c308f9121560425"><div class="ttname"><a href="union_indices.html#acb607650af9713167c308f9121560425">Indices::c</a></div><div class="ttdeci">uint8_t c[4]</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1301</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a95c41e5b4697083f1c9840f70b157c31"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a95c41e5b4697083f1c9840f70b157c31">&#9670;&nbsp;</a></span>ks_scan_wait_for_rtp()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_scan_wait_for_rtp </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>rtpmsg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>maxmsgsize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>maxwait</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>waitctrl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>play a wait sequence in a loop untill a RTP message is received.</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">rtpmsg</td><td>pointer to memory that will be filled by the RTP message </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">maxmsgsize</td><td>size in bytes of the memory pointed by rtpmsg </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">maxwait</td><td>timing out period in [ms] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">waitctrl</td><td>pointer to the <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> of a wait sequence. If NULL, the provided maxwait is ignored and a value of zero used instead. </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">size</td><td>of the received message, zero if timed out </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;                                                                                              {</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;  <span class="keywordtype">int</span> maxplayouts;</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;  <span class="keywordtype">int</span> nBytes = 0;</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;  n32 packed = 1;</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;  setscantimestop();</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;  maxplayouts =  waitctrl ? maxwait / waitctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> : 0;</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;  <span class="keywordflow">if</span> (maxplayouts &lt; 1) {</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;    waitctrl = NULL;</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;    maxplayouts = 0;</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;  }</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt;= maxplayouts; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> != 0 &amp;&amp; waitctrl) {</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;      <a class="code" href="_k_s_foundation__tgt_8c.html#a02e188307a4bd9dfdb00d37688c0487e">ks_scan_playsequence</a>(waitctrl);</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;    }</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;    nBytes = 0;</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;<span class="preprocessor">#if defined(MGD_TGT) &amp;&amp; defined(PSD_HW)</span></div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;<span class="preprocessor">#if EPIC_RELEASE&lt;26</span></div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;    nBytes = rtp_get_feedback_data(rtpmsg, maxmsgsize, &amp;packed);</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;    nBytes = rtp_get_feedback_data(rtpmsg, maxmsgsize, &amp;packed, 2, RTP_QUEUE_OLDEST); <span class="comment">/*according to RTP_RESULT_PROMO=2, defined in lx/include/PromoCommon.h */</span></div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;    <span class="keywordflow">if</span> (nBytes&gt;0 &amp;&amp; !packed) {</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;    }</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;  }</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;  setscantimestart();</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;  <span class="keywordflow">return</span> nBytes;</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;}</div><div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_SEQ_CONTROL::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:984</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a02e188307a4bd9dfdb00d37688c0487e"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a02e188307a4bd9dfdb00d37688c0487e">ks_scan_playsequence</a></div><div class="ttdeci">int ks_scan_playsequence(KS_SEQ_CONTROL *ctrl)</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1281</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8d73c466af30e53064824044894067a9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8d73c466af30e53064824044894067a9">&#9670;&nbsp;</a></span>ks_copy_and_reset_obj()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_copy_and_reset_obj </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>pobj</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Create a copy of any sequence object with a <a class="el" href="struct_k_s___b_a_s_e.html" title="(Internal use) Structure being a part of various sequence object to keep count of instances on HOST a...">KS_BASE</a> as first member</h4>
</p>
<p>Create a copy of the object pointed by pobj and insert it into the linked list in second position. finally reset the (base part of) original object.</p>
<p>It is <em>required</em> that <code>pobj</code> can be casted to (<a class="el" href="struct_k_s___b_a_s_e.html" title="(Internal use) Structure being a part of various sequence object to keep count of instances on HOST a...">KS_BASE</a> *), which is the pointed object should have a <a class="el" href="struct_k_s___b_a_s_e.html" title="(Internal use) Structure being a part of various sequence object to keep count of instances on HOST a...">KS_BASE</a> as first member. Note that other, object-specific, actions may need to be performed to finalize the reset. This includes calls to ks_instancereset_***() functions on each member of the current <code>pobj</code> </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pobj</td><td>Pointer to a sequence object of some kind </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;                                       {</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;  <a class="code" href="struct_k_s___b_a_s_e.html">KS_BASE</a> *head = (<a class="code" href="struct_k_s___b_a_s_e.html">KS_BASE</a>*) pobj;</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;  <span class="comment">/* create a copy */</span></div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;  <a class="code" href="struct_k_s___b_a_s_e.html">KS_BASE</a> *copy = (<a class="code" href="struct_k_s___b_a_s_e.html">KS_BASE</a>*) AllocNode(head-&gt;<a class="code" href="struct_k_s___b_a_s_e.html#a439227feff9d7f55384e8780cfc2eb82">size</a>);</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;  memcpy(copy, head, head-&gt;<a class="code" href="struct_k_s___b_a_s_e.html#a439227feff9d7f55384e8780cfc2eb82">size</a>);</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;  <span class="comment">/* link to the copy */</span></div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;  head-&gt;<a class="code" href="struct_k_s___b_a_s_e.html#a75b19ffcca77bfc647ff02695958fd95">next</a> = copy;</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;  <span class="comment">/* reset the count of generated instances */</span></div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;  head-&gt;<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a> = 0;</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;}</div><div class="ttc" id="struct_k_s___b_a_s_e_html_a75b19ffcca77bfc647ff02695958fd95"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a75b19ffcca77bfc647ff02695958fd95">KS_BASE::next</a></div><div class="ttdeci">void * next</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:263</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html"><div class="ttname"><a href="struct_k_s___b_a_s_e.html">KS_BASE</a></div><div class="ttdoc">(Internal use) Structure being a part of various sequence object to keep count of instances on HOST a...</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:260</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a439227feff9d7f55384e8780cfc2eb82"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a439227feff9d7f55384e8780cfc2eb82">KS_BASE::size</a></div><div class="ttdeci">int size</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:264</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa5b257c3f42fff01e0a368d6c60e5919"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa5b257c3f42fff01e0a368d6c60e5919">&#9670;&nbsp;</a></span>ks_show_clock()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_show_clock </td>
          <td>(</td>
          <td class="paramtype">FLOAT&#160;</td>
          <td class="paramname"><em>scantime</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Show the clock in the UI with the remaining scan time</h4>
</p>
<div class="fragment"><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;                                   {</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;  setscantimestop();</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;  setscantimeimm(PSD_CLOCK_NORM, (<span class="keywordtype">float</span>)scantime, <a class="code" href="_k_s_foundation__tgt_8c.html#aadbc69c4efac6c7b4d9ed5e6e2124ce3">piviews</a>, (<span class="keywordtype">float</span>)<a class="code" href="_k_s_foundation__tgt_8c.html#a5df117f51af67768c0a73513fb6b5e71">pitslice</a>, <a class="code" href="_k_s_foundation__tgt_8c.html#afcd1565ad59c6149ca316adbd09a3328">opslicecnt</a>);</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;  setscantimestart();</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;}</div><div class="ttc" id="_k_s_foundation__tgt_8c_html_aadbc69c4efac6c7b4d9ed5e6e2124ce3"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#aadbc69c4efac6c7b4d9ed5e6e2124ce3">piviews</a></div><div class="ttdeci">int piviews</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_afcd1565ad59c6149ca316adbd09a3328"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#afcd1565ad59c6149ca316adbd09a3328">opslicecnt</a></div><div class="ttdeci">int opslicecnt</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a5df117f51af67768c0a73513fb6b5e71"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a5df117f51af67768c0a73513fb6b5e71">pitslice</a></div><div class="ttdeci">int pitslice</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a48609b98dac5c8f7619bc0521f58d6e3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a48609b98dac5c8f7619bc0521f58d6e3">&#9670;&nbsp;</a></span>ks_scan_rf_phase_spoiling()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_scan_rf_phase_spoiling </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>counter</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns spoiling phase for a given RF counter</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">counter</td><td>[RF number] </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>phase [Phase in degrees] </dd></dl>
<div class="fragment"><div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;                                             {</div><div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;  <span class="keywordtype">double</span> phase = 117.0 * ((double) counter * ((<span class="keywordtype">double</span>) counter + 1.0)) / 2.0;</div><div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;</div><div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;  <span class="comment">/* fmod() does not seem to work on TGT on hardware (MR scanner) */</span></div><div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;</div><div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;  <span class="keywordtype">int</span> phase_fulllaps = (int) (phase / 360.0);</div><div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;</div><div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;  phase = phase - (phase_fulllaps * 360.0);</div><div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;</div><div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;  <span class="keywordflow">return</span> ((<span class="keywordtype">float</span>) phase);</div><div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a4ec679c0fb8eb62c1776e67434e25b77"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4ec679c0fb8eb62c1776e67434e25b77">&#9670;&nbsp;</a></span>ks_tgt_reset_gradrfctrl()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_tgt_reset_gradrfctrl </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html">KS_GRADRFCTRL</a> *&#160;</td>
          <td class="paramname"><em>gradrfctrl</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Clears <a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html" title="typedef struct that is a part of the KS_SEQ_CONTROL typedef struct, used internally to collect gradie...">KS_GRADRFCTRL</a> on TGT. Called in ks_pg_trap, ks_pg_wave, and ks_pg_rf if the field <code>is_cleared_on_tgt</code> is false. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">gradrfctrl</td><td>[pointer to <a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html" title="typedef struct that is a part of the KS_SEQ_CONTROL typedef struct, used internally to collect gradie...">KS_GRADRFCTRL</a>] </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;                                                        {</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0;</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ad1471d1cbc5ed7e8b1bc9d0987bf6eed">numrf</a>; ++<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>) {</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;    gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a753f71c73d8169393fcbe8a9b3f4d2c2">rfptr</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] = NULL;</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;  }</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a576774535b3b72525cf3821a0ded5124">numtrap</a>; ++<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>) {</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;    gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a218dab0fa00815bec264cb1170a615ef">trapptr</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] = NULL;</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;  }</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a176c1433ab0ff244ebdc3806d77fc3c9">numwave</a>; ++<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>) {</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;    gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ac44d46e0aeb2f3842bf0cfc1e14ebadc">waveptr</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] = NULL;</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;  }</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#abe25ffea5925df8869e60f527ce583b4">numacq</a>; ++<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>) {</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;    gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a2389836ad299458a5470e252c06b91dd">readptr</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] = NULL;</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;  }</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;  gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ad1471d1cbc5ed7e8b1bc9d0987bf6eed">numrf</a> = 0;</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;  gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a576774535b3b72525cf3821a0ded5124">numtrap</a> = 0;</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;  gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a176c1433ab0ff244ebdc3806d77fc3c9">numwave</a> = 0;</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;  gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#abe25ffea5925df8869e60f527ce583b4">numacq</a> = 0;</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;  gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#af7f2aa8614e77ef8af0154c7e071ab0e">is_cleared_on_tgt</a> = TRUE;</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;}</div><div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a753f71c73d8169393fcbe8a9b3f4d2c2"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a753f71c73d8169393fcbe8a9b3f4d2c2">KS_GRADRFCTRL::rfptr</a></div><div class="ttdeci">KS_RF * rfptr[KS_MAXUNIQUE_RF]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:815</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a576774535b3b72525cf3821a0ded5124"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a576774535b3b72525cf3821a0ded5124">KS_GRADRFCTRL::numtrap</a></div><div class="ttdeci">int numtrap</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:818</div></div>
<div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_ad1471d1cbc5ed7e8b1bc9d0987bf6eed"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ad1471d1cbc5ed7e8b1bc9d0987bf6eed">KS_GRADRFCTRL::numrf</a></div><div class="ttdeci">int numrf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:816</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_ac44d46e0aeb2f3842bf0cfc1e14ebadc"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ac44d46e0aeb2f3842bf0cfc1e14ebadc">KS_GRADRFCTRL::waveptr</a></div><div class="ttdeci">KS_WAVE * waveptr[KS_MAXUNIQUE_WAVE]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:819</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_af7f2aa8614e77ef8af0154c7e071ab0e"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#af7f2aa8614e77ef8af0154c7e071ab0e">KS_GRADRFCTRL::is_cleared_on_tgt</a></div><div class="ttdeci">int is_cleared_on_tgt</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:823</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a218dab0fa00815bec264cb1170a615ef"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a218dab0fa00815bec264cb1170a615ef">KS_GRADRFCTRL::trapptr</a></div><div class="ttdeci">KS_TRAP * trapptr[KS_MAXUNIQUE_TRAP]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:817</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a176c1433ab0ff244ebdc3806d77fc3c9"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a176c1433ab0ff244ebdc3806d77fc3c9">KS_GRADRFCTRL::numwave</a></div><div class="ttdeci">int numwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:820</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a2389836ad299458a5470e252c06b91dd"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a2389836ad299458a5470e252c06b91dd">KS_GRADRFCTRL::readptr</a></div><div class="ttdeci">KS_READ * readptr[KS_MAXUNIQUE_READ]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:821</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_abe25ffea5925df8869e60f527ce583b4"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#abe25ffea5925df8869e60f527ce583b4">KS_GRADRFCTRL::numacq</a></div><div class="ttdeci">int numacq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:822</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7fa5f9c7d6c866530c0fe422c9b7cbdb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7fa5f9c7d6c866530c0fe422c9b7cbdb">&#9670;&nbsp;</a></span>ks_eval_clear_readwave()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_eval_clear_readwave </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_e_a_d_w_a_v_e.html">KS_READWAVE</a> *&#160;</td>
          <td class="paramname"><em>readwave</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l03862"></a><span class="lineno"> 3862</span>&#160;                                                  {</div><div class="line"><a name="l03863"></a><span class="lineno"> 3863</span>&#160;  <a class="code" href="struct_k_s___r_e_a_d_w_a_v_e.html">KS_READWAVE</a> def_readwave;</div><div class="line"><a name="l03864"></a><span class="lineno"> 3864</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#a17152525ac5b5d4593e423d016d41d29">ks_init_readwave</a>(&amp;def_readwave);</div><div class="line"><a name="l03865"></a><span class="lineno"> 3865</span>&#160;  def_readwave.<a class="code" href="struct_k_s___r_e_a_d_w_a_v_e.html#a33b2ed586c0bf44c2c8991f0ab1610c8">freqoffHz</a> = readwave-&gt;<a class="code" href="struct_k_s___r_e_a_d_w_a_v_e.html#a33b2ed586c0bf44c2c8991f0ab1610c8">freqoffHz</a>;</div><div class="line"><a name="l03866"></a><span class="lineno"> 3866</span>&#160;  def_readwave.<a class="code" href="struct_k_s___r_e_a_d_w_a_v_e.html#abfd94a01fc71278021802ca0d1e25e16">fov</a>  = readwave-&gt;<a class="code" href="struct_k_s___r_e_a_d_w_a_v_e.html#abfd94a01fc71278021802ca0d1e25e16">fov</a>;</div><div class="line"><a name="l03867"></a><span class="lineno"> 3867</span>&#160;  def_readwave.<a class="code" href="struct_k_s___r_e_a_d_w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> = readwave-&gt;<a class="code" href="struct_k_s___r_e_a_d_w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>;</div><div class="line"><a name="l03868"></a><span class="lineno"> 3868</span>&#160;  *readwave = def_readwave;</div><div class="line"><a name="l03869"></a><span class="lineno"> 3869</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l03870"></a><span class="lineno"> 3870</span>&#160;}</div><div class="ttc" id="struct_k_s___r_e_a_d_w_a_v_e_html_abfd94a01fc71278021802ca0d1e25e16"><div class="ttname"><a href="struct_k_s___r_e_a_d_w_a_v_e.html#abfd94a01fc71278021802ca0d1e25e16">KS_READWAVE::fov</a></div><div class="ttdeci">float fov</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1448</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_w_a_v_e_html_a33b2ed586c0bf44c2c8991f0ab1610c8"><div class="ttname"><a href="struct_k_s___r_e_a_d_w_a_v_e.html#a33b2ed586c0bf44c2c8991f0ab1610c8">KS_READWAVE::freqoffHz</a></div><div class="ttdeci">float freqoffHz</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1447</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a17152525ac5b5d4593e423d016d41d29"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a17152525ac5b5d4593e423d016d41d29">ks_init_readwave</a></div><div class="ttdeci">void ks_init_readwave(KS_READWAVE *readwave)</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:85</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_w_a_v_e_html"><div class="ttname"><a href="struct_k_s___r_e_a_d_w_a_v_e.html">KS_READWAVE</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1440</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___r_e_a_d_w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_READWAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1449</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a20cde73a2d93c278b92a33cf3b2848ad"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a20cde73a2d93c278b92a33cf3b2848ad">&#9670;&nbsp;</a></span>ks_eval_clear_dualreadtrap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_eval_clear_dualreadtrap </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___d_i_x_o_n___d_u_a_l_r_e_a_d_t_r_a_p.html">KS_DIXON_DUALREADTRAP</a> *&#160;</td>
          <td class="paramname"><em>dual_read</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l03872"></a><span class="lineno"> 3872</span>&#160;                                                                 {</div><div class="line"><a name="l03873"></a><span class="lineno"> 3873</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#a7fa5f9c7d6c866530c0fe422c9b7cbdb">ks_eval_clear_readwave</a>(&amp;dual_read-&gt;<a class="code" href="struct_k_s___d_i_x_o_n___d_u_a_l_r_e_a_d_t_r_a_p.html#ae9f37c298ab1d16ad5f94af53dfdc217">readwave</a>);</div><div class="line"><a name="l03874"></a><span class="lineno"> 3874</span>&#160;  <a class="code" href="struct_k_s___d_i_x_o_n___d_u_a_l_r_e_a_d_t_r_a_p.html">KS_DIXON_DUALREADTRAP</a> def_dualread;</div><div class="line"><a name="l03875"></a><span class="lineno"> 3875</span>&#160;  <a class="code" href="_k_s_foundation__host_8c.html#a12bc11f81cb70202d41d89e2bfe245dc">ks_init_dixon_dualreadtrap</a>(&amp;def_dualread);</div><div class="line"><a name="l03876"></a><span class="lineno"> 3876</span>&#160;  def_dualread.<a class="code" href="struct_k_s___d_i_x_o_n___d_u_a_l_r_e_a_d_t_r_a_p.html#ae9f37c298ab1d16ad5f94af53dfdc217">readwave</a> = dual_read-&gt;<a class="code" href="struct_k_s___d_i_x_o_n___d_u_a_l_r_e_a_d_t_r_a_p.html#ae9f37c298ab1d16ad5f94af53dfdc217">readwave</a>;</div><div class="line"><a name="l03877"></a><span class="lineno"> 3877</span>&#160;  def_dualread.<a class="code" href="struct_k_s___d_i_x_o_n___d_u_a_l_r_e_a_d_t_r_a_p.html#a77cdd4dbe4a9b13460af07539f4e26ab">available_acq_time</a> = dual_read-&gt;<a class="code" href="struct_k_s___d_i_x_o_n___d_u_a_l_r_e_a_d_t_r_a_p.html#a77cdd4dbe4a9b13460af07539f4e26ab">available_acq_time</a>;</div><div class="line"><a name="l03878"></a><span class="lineno"> 3878</span>&#160;  def_dualread.<a class="code" href="struct_k_s___d_i_x_o_n___d_u_a_l_r_e_a_d_t_r_a_p.html#a27bcab6a850006178697e513fa326e95">spare_time_pre</a> = dual_read-&gt;<a class="code" href="struct_k_s___d_i_x_o_n___d_u_a_l_r_e_a_d_t_r_a_p.html#a27bcab6a850006178697e513fa326e95">spare_time_pre</a>;</div><div class="line"><a name="l03879"></a><span class="lineno"> 3879</span>&#160;  def_dualread.<a class="code" href="struct_k_s___d_i_x_o_n___d_u_a_l_r_e_a_d_t_r_a_p.html#a1404eb1a55c2599b9dbe0c6460e37358">spare_time_post</a> = dual_read-&gt;<a class="code" href="struct_k_s___d_i_x_o_n___d_u_a_l_r_e_a_d_t_r_a_p.html#a1404eb1a55c2599b9dbe0c6460e37358">spare_time_post</a>;</div><div class="line"><a name="l03880"></a><span class="lineno"> 3880</span>&#160;  def_dualread.<a class="code" href="struct_k_s___d_i_x_o_n___d_u_a_l_r_e_a_d_t_r_a_p.html#a7b4b12fa67dc95bb4552131565ab9f63">allowed_overflow_post</a> = dual_read-&gt;<a class="code" href="struct_k_s___d_i_x_o_n___d_u_a_l_r_e_a_d_t_r_a_p.html#a7b4b12fa67dc95bb4552131565ab9f63">allowed_overflow_post</a>;</div><div class="line"><a name="l03881"></a><span class="lineno"> 3881</span>&#160;  def_dualread.<a class="code" href="struct_k_s___d_i_x_o_n___d_u_a_l_r_e_a_d_t_r_a_p.html#a304cb284861ddcc08f2e4d24b3d30ff2">paddingarea</a> = dual_read-&gt;<a class="code" href="struct_k_s___d_i_x_o_n___d_u_a_l_r_e_a_d_t_r_a_p.html#a304cb284861ddcc08f2e4d24b3d30ff2">paddingarea</a>;</div><div class="line"><a name="l03882"></a><span class="lineno"> 3882</span>&#160;  def_dualread.<a class="code" href="struct_k_s___d_i_x_o_n___d_u_a_l_r_e_a_d_t_r_a_p.html#a0ce69da2ae616c582b49adec7d5e343b">min_nover</a> = dual_read-&gt;<a class="code" href="struct_k_s___d_i_x_o_n___d_u_a_l_r_e_a_d_t_r_a_p.html#a0ce69da2ae616c582b49adec7d5e343b">min_nover</a>;</div><div class="line"><a name="l03883"></a><span class="lineno"> 3883</span>&#160;  *dual_read = def_dualread;</div><div class="line"><a name="l03884"></a><span class="lineno"> 3884</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l03885"></a><span class="lineno"> 3885</span>&#160;}</div><div class="ttc" id="struct_k_s___d_i_x_o_n___d_u_a_l_r_e_a_d_t_r_a_p_html_a77cdd4dbe4a9b13460af07539f4e26ab"><div class="ttname"><a href="struct_k_s___d_i_x_o_n___d_u_a_l_r_e_a_d_t_r_a_p.html#a77cdd4dbe4a9b13460af07539f4e26ab">KS_DIXON_DUALREADTRAP::available_acq_time</a></div><div class="ttdeci">int available_acq_time</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1703</div></div>
<div class="ttc" id="struct_k_s___d_i_x_o_n___d_u_a_l_r_e_a_d_t_r_a_p_html_a1404eb1a55c2599b9dbe0c6460e37358"><div class="ttname"><a href="struct_k_s___d_i_x_o_n___d_u_a_l_r_e_a_d_t_r_a_p.html#a1404eb1a55c2599b9dbe0c6460e37358">KS_DIXON_DUALREADTRAP::spare_time_post</a></div><div class="ttdeci">int spare_time_post</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1705</div></div>
<div class="ttc" id="struct_k_s___d_i_x_o_n___d_u_a_l_r_e_a_d_t_r_a_p_html_a7b4b12fa67dc95bb4552131565ab9f63"><div class="ttname"><a href="struct_k_s___d_i_x_o_n___d_u_a_l_r_e_a_d_t_r_a_p.html#a7b4b12fa67dc95bb4552131565ab9f63">KS_DIXON_DUALREADTRAP::allowed_overflow_post</a></div><div class="ttdeci">int allowed_overflow_post</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1706</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a7fa5f9c7d6c866530c0fe422c9b7cbdb"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a7fa5f9c7d6c866530c0fe422c9b7cbdb">ks_eval_clear_readwave</a></div><div class="ttdeci">int ks_eval_clear_readwave(KS_READWAVE *readwave)</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3862</div></div>
<div class="ttc" id="struct_k_s___d_i_x_o_n___d_u_a_l_r_e_a_d_t_r_a_p_html_ae9f37c298ab1d16ad5f94af53dfdc217"><div class="ttname"><a href="struct_k_s___d_i_x_o_n___d_u_a_l_r_e_a_d_t_r_a_p.html#ae9f37c298ab1d16ad5f94af53dfdc217">KS_DIXON_DUALREADTRAP::readwave</a></div><div class="ttdeci">KS_READWAVE readwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1700</div></div>
<div class="ttc" id="struct_k_s___d_i_x_o_n___d_u_a_l_r_e_a_d_t_r_a_p_html_a27bcab6a850006178697e513fa326e95"><div class="ttname"><a href="struct_k_s___d_i_x_o_n___d_u_a_l_r_e_a_d_t_r_a_p.html#a27bcab6a850006178697e513fa326e95">KS_DIXON_DUALREADTRAP::spare_time_pre</a></div><div class="ttdeci">int spare_time_pre</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1704</div></div>
<div class="ttc" id="struct_k_s___d_i_x_o_n___d_u_a_l_r_e_a_d_t_r_a_p_html_a0ce69da2ae616c582b49adec7d5e343b"><div class="ttname"><a href="struct_k_s___d_i_x_o_n___d_u_a_l_r_e_a_d_t_r_a_p.html#a0ce69da2ae616c582b49adec7d5e343b">KS_DIXON_DUALREADTRAP::min_nover</a></div><div class="ttdeci">int min_nover</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1708</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_a12bc11f81cb70202d41d89e2bfe245dc"><div class="ttname"><a href="_k_s_foundation__host_8c.html#a12bc11f81cb70202d41d89e2bfe245dc">ks_init_dixon_dualreadtrap</a></div><div class="ttdeci">void ks_init_dixon_dualreadtrap(KS_DIXON_DUALREADTRAP *dual_readtrap)</div><div class="ttdoc">Resets a KS_DIXON_DUALREADTRAP sequence object to its default value (KS_INIT_DIXON_DUALREADTRAP)</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:81</div></div>
<div class="ttc" id="struct_k_s___d_i_x_o_n___d_u_a_l_r_e_a_d_t_r_a_p_html_a304cb284861ddcc08f2e4d24b3d30ff2"><div class="ttname"><a href="struct_k_s___d_i_x_o_n___d_u_a_l_r_e_a_d_t_r_a_p.html#a304cb284861ddcc08f2e4d24b3d30ff2">KS_DIXON_DUALREADTRAP::paddingarea</a></div><div class="ttdeci">float paddingarea</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1707</div></div>
<div class="ttc" id="struct_k_s___d_i_x_o_n___d_u_a_l_r_e_a_d_t_r_a_p_html"><div class="ttname"><a href="struct_k_s___d_i_x_o_n___d_u_a_l_r_e_a_d_t_r_a_p.html">KS_DIXON_DUALREADTRAP</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1699</div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a5fc997556910df5890ca1c407984674d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5fc997556910df5890ca1c407984674d">&#9670;&nbsp;</a></span>abort_on_kserror</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int abort_on_kserror</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a4dcd93b4f67aeb25541105ec7953c67e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4dcd93b4f67aeb25541105ec7953c67e">&#9670;&nbsp;</a></span>ks_rhoboard</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_rhoboard</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a4bd8f92bd97315429605430e234dceb4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4bd8f92bd97315429605430e234dceb4">&#9670;&nbsp;</a></span>loggrd</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">LOG_GRAD loggrd</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="af51ba165cbaf874219789beaa48f2464"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af51ba165cbaf874219789beaa48f2464">&#9670;&nbsp;</a></span>phygrd</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PHYS_GRAD phygrd</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_edd0b46848e1966a9ba471eaad9abcfd.html">tmpfiles</a></li><li class="navelem"><a class="el" href="_k_s_foundation_8h.html">KSFoundation.h</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
