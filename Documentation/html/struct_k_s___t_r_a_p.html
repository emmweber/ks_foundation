<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>KSFoundation: KS_TRAP Struct Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="KarolinskaLogo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">KSFoundation
   &#160;<span id="projectnumber">[Feb-2019]</span>
   </div>
   <div id="projectbrief">A platform for simpler EPIC programming on GE MR systems</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('struct_k_s___t_r_a_p.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-attribs">Data Fields</a>  </div>
  <div class="headertitle">
<div class="title">KS_TRAP Struct Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;KSFoundation.h&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Data Fields</h2></td></tr>
<tr class="memitem:a06ab78e08959e925d92935c582469de8"><td class="memItemLeft" align="right" valign="top"><a class="el" href="struct_k_s___b_a_s_e.html">KS_BASE</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">base</a></td></tr>
<tr class="separator:a06ab78e08959e925d92935c582469de8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1c544bec41003a594ba4ec7d43a3a470"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_k_s_foundation_8h.html#a06d5868fa630d1c05faea3350dbf045c">KS_DESCRIPTION</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a></td></tr>
<tr class="separator:a1c544bec41003a594ba4ec7d43a3a470"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab508ded41392ee86a2a619d3e93d2373"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a></td></tr>
<tr class="separator:ab508ded41392ee86a2a619d3e93d2373"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a97ab43f6fd28920a42d987c8fec4afec"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___t_r_a_p.html#a97ab43f6fd28920a42d987c8fec4afec">area</a></td></tr>
<tr class="separator:a97ab43f6fd28920a42d987c8fec4afec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acbc719dc4e48c2a2df0447875e4348ca"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a></td></tr>
<tr class="separator:acbc719dc4e48c2a2df0447875e4348ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a878bb367b07dc7dfb5fef5728d2e5b1d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">plateautime</a></td></tr>
<tr class="separator:a878bb367b07dc7dfb5fef5728d2e5b1d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac6e4b2a3cf932b33832d4e4e4e7cd0de"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a></td></tr>
<tr class="separator:ac6e4b2a3cf932b33832d4e4e4e7cd0de"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3fb111f1302287e152078110b3b37d6f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___t_r_a_p.html#a3fb111f1302287e152078110b3b37d6f">gradnum</a> [3]</td></tr>
<tr class="separator:a3fb111f1302287e152078110b3b37d6f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a89785a274d251fd637bf40923ad5c345"><td class="memItemLeft" align="right" valign="top"><a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___t_r_a_p.html#a89785a274d251fd637bf40923ad5c345">locs</a> [<a class="el" href="_k_s_foundation_8h.html#ab088ee3b5494b35ca60219f0b4e46e3b">KS_MAXINSTANCES</a>]</td></tr>
<tr class="separator:a89785a274d251fd637bf40923ad5c345"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9428be182c75f60d1b4e6fe36c888afa"><td class="memItemLeft" align="right" valign="top">WF_PULSE **&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___t_r_a_p.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a></td></tr>
<tr class="separator:a9428be182c75f60d1b4e6fe36c888afa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a15be3edad342a49398ca841c2745dc9e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">wfi</a></td></tr>
<tr class="separator:a15be3edad342a49398ca841c2745dc9e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a997cdc9de09fbf7b61842aeb8ad3dfbb"><td class="memItemLeft" align="right" valign="top">float *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___t_r_a_p.html#a997cdc9de09fbf7b61842aeb8ad3dfbb">rtscale</a></td></tr>
<tr class="separator:a997cdc9de09fbf7b61842aeb8ad3dfbb"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><h4>Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards</h4>
<div class="image">
<img src="KS_TRAP.png" alt="KS_TRAP.png"/>
<div class="caption">
KS_TRAP</div></div>
<p> <br />
</p>
<p>When making trapezoids on X, Y, or Z boards, the amplitude units are [G/cm], while units are arbitrary on OMEGA.</p>
<p>First note that for RF slice selection, phase encoding, or readouts there are <em>other</em> sequence objects and functions that in use their own KS_TRAPs internally.</p>
<p>Direct use of <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> objects applies only to cases where a standalone gradient with a certain area is desired, usually acting as a gradient spoiler. To add a trapezoid to a pulse sequence as e.g. a gradient spoiler, first declare a <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> sequence object in the <code>@ipgexport</code> section (see example below). In <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code>, the desired area of the trapezoid (unit: [(G/cm) us]) is then set by assigning a value to the <code>.area</code> field in the <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object. This serves as input information, from which the duration, ramptime, and amplitude is calculated by calling <a class="el" href="_k_s_foundation_8h.html#af40cc818066c7757959bf3712bfc5e6f" title="Sets up a trapezoid using a KS_TRAP sequence object with preset gradient constraints">ks_eval_trap()</a>. The second argument to ks_eval_trap(..., "name", ...) is the <em>description</em> that is inserted into the <code>.description</code> field of the <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a>. On TGT, this name is also used in when naming the WF_PULSEs internally, with a '.#' suffix added at the end, where '#' is the first letter of the board it is placed on. Hence, for a description called "myspoiler", it will appear in TimeHist in <em>MGD Sim/WTools</em> as <code>myspoiler.xa</code> (ramp-up), <code>myspoiler.x</code> (plateau), and <code>myspoiler.xd</code> if it is placed on board XGRAD.</p>
<p>The general function for setting up a <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> is <a class="el" href="_k_s_foundation_8h.html#af40cc818066c7757959bf3712bfc5e6f" title="Sets up a trapezoid using a KS_TRAP sequence object with preset gradient constraints">ks_eval_trap()</a>, where slewrate and gradient amplitude are constrained by the default system limits to allow for <em>simultaneous</em> use on all 3 axis at the same time. The slewrate and gradient amplitude limits can be slacked if one can be sure that the <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> will be used on one or two axes at a time, by instead calling <a class="el" href="_k_s_foundation_8h.html#ade1d9d7d9be1c9e537b39ef98af04cfe" title="Sets up a trapezoid using a KS_TRAP sequence object with preset gradient constraints">ks_eval_trap1()</a> or <a class="el" href="_k_s_foundation_8h.html#abb3161153227b411c0518439c243a1ca" title="Sets up a trapezoid using a KS_TRAP sequence object with preset gradient constraints">ks_eval_trap2()</a>. The difference is seen for (double) oblique slices, where strong slice angulation and the use of <a class="el" href="_k_s_foundation_8h.html#ade1d9d7d9be1c9e537b39ef98af04cfe" title="Sets up a trapezoid using a KS_TRAP sequence object with preset gradient constraints">ks_eval_trap1()</a> can produce up to 3x stronger gradient than <a class="el" href="_k_s_foundation_8h.html#af40cc818066c7757959bf3712bfc5e6f" title="Sets up a trapezoid using a KS_TRAP sequence object with preset gradient constraints">ks_eval_trap()</a>. These <code>ks_eval_trap***()</code> functions are all calling the one and same <a class="el" href="_k_s_foundation_8h.html#a984e0201828c0e74696118ff6487a303" title="Sets up a trapezoid using a KS_TRAP sequence object with gradient constraints specified as input argu...">ks_eval_trap_constrained()</a> function, where slewrate and gradient amplitude limits as well as minimum plateautime are explicitly given as input arguments. This function can also be called directly. In summary, call:</p>
<ul>
<li><a class="el" href="_k_s_foundation_8h.html#af40cc818066c7757959bf3712bfc5e6f" title="Sets up a trapezoid using a KS_TRAP sequence object with preset gradient constraints">ks_eval_trap()</a> - for generic use</li>
<li><a class="el" href="_k_s_foundation_8h.html#ade1d9d7d9be1c9e537b39ef98af04cfe" title="Sets up a trapezoid using a KS_TRAP sequence object with preset gradient constraints">ks_eval_trap1()</a> - if this trapezoid will be placed on one board at a time, with no other gradients running on other boards simultaneously. This will increase the maximum amplitude for double oblique scans by up to 3 times.</li>
<li><a class="el" href="_k_s_foundation_8h.html#abb3161153227b411c0518439c243a1ca" title="Sets up a trapezoid using a KS_TRAP sequence object with preset gradient constraints">ks_eval_trap2()</a> - if this trapezoid will be placed on at most two boards at a time with no other gradients running on other boards simultaneously</li>
<li><a class="el" href="_k_s_foundation_8h.html#a984e0201828c0e74696118ff6487a303" title="Sets up a trapezoid using a KS_TRAP sequence object with gradient constraints specified as input argu...">ks_eval_trap_constrained()</a> - if manual control of slewrate, gradient max and minimum plateau time is desired</li>
</ul>
<p>Once a <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object has been <em>designed</em> using <a class="el" href="_k_s_foundation_8h.html#af40cc818066c7757959bf3712bfc5e6f" title="Sets up a trapezoid using a KS_TRAP sequence object with preset gradient constraints">ks_eval_trap()</a>, the same <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object can be freely placed on XGRAD, YGRAD and ZGRAD as many times as desired, by only changing the second argument each time (to avoid waveform overlaps). The second argument is a <a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> struct with three fields:</p><ul>
<li><code>.board</code>: Choose between XGRAD, YGRAD, ZGRAD (or OMEGA)</li>
<li><code>.pos</code>: Absolute time in [us] of the start of the attack ramp of the trapezoid</li>
<li><code>.ampscale</code>: A factor that must be in range [-1.0,1.0] that is multiplied with <code>.amp</code> to yield a per-instance (i.e. per-placement) amplitude ([G/cm]). The simplest is to use 1.0, which makes the <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object to be placed out on the board as initially designed using <a class="el" href="_k_s_foundation_8h.html#af40cc818066c7757959bf3712bfc5e6f" title="Sets up a trapezoid using a KS_TRAP sequence object with preset gradient constraints">ks_eval_trap()</a>.</li>
</ul>
<p>NOTE: Regardless of the order placed out in the <code>@pg</code> section, and on which boards (XGRAD, YGRAD, ZGRAD) the <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object is placed, the <em>instance</em> number of the <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> is automatically sorted in time. If two instances of one <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> occur at the same time (<code>.pos</code>) on different boards, XGRAD comes before YGRAD, which comes before ZGRAD. These abstract, sorted, instance numbers are used by `ks_scan_***() functions in <a class="el" href="ksepi_8e.html#a1669428052472d00b1c55a1291f8032f">scan()</a> to refer to a specific instance of a <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object in the sequence.</p>
<p>When a trapezoid is placed on OMEGA, neither the designed amplitude (<code>.amp</code> field in <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a>) nor the <code>.ampscale</code> (in <a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a>) has an effect on the final frequency modulation. Instead the run-time amplitude of a <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object on the OMEGA board is controlled in <a class="el" href="ksepi_8e.html#a1669428052472d00b1c55a1291f8032f">scan()</a> via a function called <a class="el" href="_k_s_foundation_8h.html#adbd649762fa938de96662bdc9a721863" title="Updates a KS_TRAP object on the OMEGA board to produce a frequency offset">ks_scan_omegatrap_hz()</a>.</p>
<p>Advanced tip: After calling <a class="el" href="_k_s_foundation_8h.html#af40cc818066c7757959bf3712bfc5e6f" title="Sets up a trapezoid using a KS_TRAP sequence object with preset gradient constraints">ks_eval_trap()</a>, the field <code>.duration</code> will correspond to the total duration of the trapezoid. If one manually sets this field to 0 (after <a class="el" href="_k_s_foundation_8h.html#af40cc818066c7757959bf3712bfc5e6f" title="Sets up a trapezoid using a KS_TRAP sequence object with preset gradient constraints">ks_eval_trap()</a>), <a class="el" href="_k_s_foundation_8h.html#a61651c54c4dfd4388fc939d804a9964b" title="Places a KS_TRAP sequence object on a board at some position in the pulse sequence">ks_pg_trap()</a> will detect the zero duration and ignore placing this out in the <code>@pg</code> section without an error. This can sometimes be a convienient way of conditionally or temporarily disable a trapezoid. Moreover, sequence dependent timing functions also see this trapezoid having zero duration, making timing calculations to correspond well to the ignored placement of the trapezoid in the <code>@pg</code> section.</p>
<p>In <a class="el" href="ksepi_8e.html#a1669428052472d00b1c55a1291f8032f">scan()</a> on TGT, the amplitude of each instance of the <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object can be individually scaled in run-time using <a class="el" href="_k_s_foundation_8h.html#a2c01e4ef0737a46f9c973b77ca284424" title="Updates the amplitude of one or all instances of a KS_TRAP sequence object">ks_scan_trap_ampscale()</a>. The third argument to this function is another amplitude scaling factor that must be in range [-1.0,1.0]. The final amplitude of the trapezoid in [G/cm] becomes the product of the following:</p><ul>
<li><code>.amp</code> field of <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> (set by <a class="el" href="_k_s_foundation_8h.html#af40cc818066c7757959bf3712bfc5e6f" title="Sets up a trapezoid using a KS_TRAP sequence object with preset gradient constraints">ks_eval_trap()</a> in <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code>)</li>
<li><code>.ampscale</code> field of <a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> (2nd arg to <a class="el" href="_k_s_foundation_8h.html#a61651c54c4dfd4388fc939d804a9964b" title="Places a KS_TRAP sequence object on a board at some position in the pulse sequence">ks_pg_trap()</a> in the <code>@pg</code> section that alters each instance)</li>
<li>3rd argument to <a class="el" href="_k_s_foundation_8h.html#a2c01e4ef0737a46f9c973b77ca284424" title="Updates the amplitude of one or all instances of a KS_TRAP sequence object">ks_scan_trap_ampscale()</a></li>
</ul>
<p>It is a <em>requirement</em> that there is a (<em>sequence generating</em>) function in the <code>@pg</code> section (containing the <a class="el" href="_k_s_foundation_8h.html#a61651c54c4dfd4388fc939d804a9964b" title="Places a KS_TRAP sequence object on a board at some position in the pulse sequence">ks_pg_trap()</a> call(s)) that can be run on both HOST and TGT. This function should be called exactly once in <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code> (after <a class="el" href="_k_s_foundation_8h.html#af40cc818066c7757959bf3712bfc5e6f" title="Sets up a trapezoid using a KS_TRAP sequence object with preset gradient constraints">ks_eval_trap()</a> and other <code>ks_eval_***()</code> functions). <a class="el" href="_k_s_foundation_8h.html#a61651c54c4dfd4388fc939d804a9964b" title="Places a KS_TRAP sequence object on a board at some position in the pulse sequence">ks_pg_trap()</a> will throw an error on TGT if this has not been done. See <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> for an example</p>
<p>The <code>.gradnum[]</code> array is modified by <a class="el" href="_k_s_foundation_8h.html#a61651c54c4dfd4388fc939d804a9964b" title="Places a KS_TRAP sequence object on a board at some position in the pulse sequence">ks_pg_trap()</a> when run on HOST, to keep count of how many times the <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> will be placed in the <code>@pg</code> section. This information is used in <a class="el" href="_k_s_foundation_8h.html#ab4c6e9f82b55a3db56765fc22f21b7b5" title="Returns the time required to play out a certain number of sequence modules over some interval...">ks_eval_gradrflimits()</a> together with the sequence module's common <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> object to calculate gradient heating limits for the sequence module.</p>
<h3>Example</h3>
<div class="fragment"><div class="line">@ipgexport (HOST)</div><div class="line"><a class="code" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> mytrap = <a class="code" href="_k_s_foundation_8h.html#a1ba17433713316fa65385237ebb0fb67">KS_INIT_TRAP</a>;</div><div class="line"><a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> seqctrl;</div><div class="line"></div><div class="line">@host (HOST)</div><div class="line"><a class="code" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval</a>() {</div><div class="line">  mytrap.<a class="code" href="struct_k_s___t_r_a_p.html#a97ab43f6fd28920a42d987c8fec4afec">area</a> = 1000.0; <span class="comment">// [(G/cm)*us]</span></div><div class="line">  <a class="code" href="_k_s_foundation_8h.html#af40cc818066c7757959bf3712bfc5e6f">ks_eval_trap</a>(&amp;mytrap, <span class="stringliteral">&quot;myspoiler&quot;</span>);</div><div class="line">}</div><div class="line"></div><div class="line">@pg</div><div class="line">  <a class="code" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> tmploc = <a class="code" href="_k_s_foundation_8h.html#ad01dd4f06fe226a502e872d4173ba7ae">KS_INIT_SEQLOC</a>;</div><div class="line"></div><div class="line">  tmploc.board = XGRAD;</div><div class="line">  tmploc.pos = 10ms;</div><div class="line">  tmploc.ampscale = 1.0;</div><div class="line"></div><div class="line">  <a class="code" href="_k_s_foundation_8h.html#a61651c54c4dfd4388fc939d804a9964b">ks_pg_trap</a>(&amp;mytrap, tmploc, &amp;seqctrl); <span class="comment">// first instance (#0) of this trap in the sequence</span></div><div class="line"></div><div class="line">  tmploc.pos += mytrap.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>;</div><div class="line">  tmploc.ampscale = -1.0;</div><div class="line"></div><div class="line">  <a class="code" href="_k_s_foundation_8h.html#a61651c54c4dfd4388fc939d804a9964b">ks_pg_trap</a>(&amp;mytrap, tmploc, &amp;seqctrl); <span class="comment">// a second instance (#1) of this trap right after the 0th, with negative amplitude</span></div><div class="line"></div><div class="line">@rsp (TGT)</div><div class="line"><a class="code" href="ksepi_8e.html#a1669428052472d00b1c55a1291f8032f">scan</a>() {</div><div class="line">  <a class="code" href="_k_s_foundation_8h.html#a2c01e4ef0737a46f9c973b77ca284424">ks_scan_trap_ampscale</a>(&amp;mytrap, 0, 0.68); <span class="comment">// will make the amplitude 0.68 times the original amp for the 0-th instance of this KS_TRAP</span></div><div class="line">}</div></div><!-- fragment --> </div><h2 class="groupheader">Field Documentation</h2>
<a id="a06ab78e08959e925d92935c582469de8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a06ab78e08959e925d92935c582469de8">&#9670;&nbsp;</a></span>base</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_k_s___b_a_s_e.html">KS_BASE</a> base</td>
        </tr>
      </table>
</div><div class="memdoc">
<p><em>Internal use</em> </p>

</div>
</div>
<a id="a1c544bec41003a594ba4ec7d43a3a470"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1c544bec41003a594ba4ec7d43a3a470">&#9670;&nbsp;</a></span>description</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_k_s_foundation_8h.html#a06d5868fa630d1c05faea3350dbf045c">KS_DESCRIPTION</a> description</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Descriptive string for the <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object with maximum KS_DESCRIPTION_LENGTH characters </p>

</div>
</div>
<a id="ab508ded41392ee86a2a619d3e93d2373"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab508ded41392ee86a2a619d3e93d2373">&#9670;&nbsp;</a></span>amp</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float amp</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Gradient amplitude in [G/cm] </p>

</div>
</div>
<a id="a97ab43f6fd28920a42d987c8fec4afec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a97ab43f6fd28920a42d987c8fec4afec">&#9670;&nbsp;</a></span>area</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float area</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Gradient area in [(G/cm)*us] </p>

</div>
</div>
<a id="acbc719dc4e48c2a2df0447875e4348ca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acbc719dc4e48c2a2df0447875e4348ca">&#9670;&nbsp;</a></span>ramptime</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ramptime</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Duration of each ramp of the trapezoid in [us] </p>

</div>
</div>
<a id="a878bb367b07dc7dfb5fef5728d2e5b1d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a878bb367b07dc7dfb5fef5728d2e5b1d">&#9670;&nbsp;</a></span>plateautime</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int plateautime</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Duration of the plateau of the trapezoid in [us] </p>

</div>
</div>
<a id="ac6e4b2a3cf932b33832d4e4e4e7cd0de"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac6e4b2a3cf932b33832d4e4e4e7cd0de">&#9670;&nbsp;</a></span>duration</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int duration</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Duration of the entire trapezoid (plateautime + 2*ramptime) in [us] </p>

</div>
</div>
<a id="a3fb111f1302287e152078110b3b37d6f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3fb111f1302287e152078110b3b37d6f">&#9670;&nbsp;</a></span>gradnum</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int gradnum[3]</td>
        </tr>
      </table>
</div><div class="memdoc">
<p><em>Internal use</em> for gradient heating calculations </p>

</div>
</div>
<a id="a89785a274d251fd637bf40923ad5c345"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a89785a274d251fd637bf40923ad5c345">&#9670;&nbsp;</a></span>locs</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> locs[<a class="el" href="_k_s_foundation_8h.html#ab088ee3b5494b35ca60219f0b4e46e3b">KS_MAXINSTANCES</a>]</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a9428be182c75f60d1b4e6fe36c888afa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9428be182c75f60d1b4e6fe36c888afa">&#9670;&nbsp;</a></span>wfpulse</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">WF_PULSE** wfpulse</td>
        </tr>
      </table>
</div><div class="memdoc">
<p><em>Internal use</em> </p>

</div>
</div>
<a id="a15be3edad342a49398ca841c2745dc9e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a15be3edad342a49398ca841c2745dc9e">&#9670;&nbsp;</a></span>wfi</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a>* wfi</td>
        </tr>
      </table>
</div><div class="memdoc">
<p><em>Internal use</em> </p>

</div>
</div>
<a id="a997cdc9de09fbf7b61842aeb8ad3dfbb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a997cdc9de09fbf7b61842aeb8ad3dfbb">&#9670;&nbsp;</a></span>rtscale</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float* rtscale</td>
        </tr>
      </table>
</div><div class="memdoc">
<p><em>Internal use</em> </p>

</div>
</div>
<hr/>The documentation for this struct was generated from the following file:<ul>
<li><a class="el" href="_k_s_foundation_8h.html">KSFoundation.h</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
