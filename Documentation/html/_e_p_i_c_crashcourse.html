<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>KSFoundation: EPIC crash course</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="KarolinskaLogo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">KSFoundation
   &#160;<span id="projectnumber">[Feb-2019]</span>
   </div>
   <div id="projectbrief">A platform for simpler EPIC programming on GE MR systems</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_e_p_i_c_crashcourse.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">EPIC crash course </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="index.html">Home</a> <br />
<br />
 </p>
<h1><a class="anchor" id="ECCcompile"></a>
Compiling pulse sequences (PSDs) for the MR-scanner</h1>
<p>Compiling pulse sequences (PSDs) for the MR-scanner usually involves the following steps:</p><ul>
<li>Making sure there is a match between the PSD main file <em>mypsd</em>.e and the following line in the Imakefile <div class="fragment"><div class="line">PSD = mypsd</div></div><!-- fragment --> <br />
</li>
<li>Setting up sub directories once before compiling by (do this after downloading/updating from Git): <div class="fragment"><div class="line">you@linux&gt; prep_psd_dir</div></div><!-- fragment --> <br />
</li>
<li>Compiling <em>mypsd</em>.e for Simulation and/or Hardware (and dealing with compilation errors) <div class="fragment"><div class="line">you@linux&gt; psdqmake clean sim <span class="comment">// compile for simulation, i.e. WTools (part of ESE distribution)</span></div><div class="line">you@linux&gt; psdqmake clean hw <span class="comment">// compile for hardware, i.e. the MR-scanner</span></div><div class="line">you@linux&gt; psdqmake clean all <span class="comment">// compile for simulation and hardware</span></div></div><!-- fragment --> <br />
</li>
<li>Running the sequence in simulation mode on a linux machine to figure out various <em>HOST</em> and <em>TGT</em> bugs and problems using tools such as: <br />
 - The debugger (e.g. <code>ddd</code> or some other graphical debugger) on HOST and TGT<ul>
<li><code>fprintf(stderr, "")</code> to see info in the <code>WTools</code> main window (but learn to use e.g. the <code>ddd</code> debugger, it's way better than printing). KSFoundation EPIC has also functions <a class="el" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5" title="Common error message function for HOST and TGT">ks_error()</a> and <a class="el" href="_k_s_foundation_8h.html#a763989ed463b618658bef9c2485051eb" title="Common debug message function for HOST and TGT">ks_dbg()</a>, which also stores the output in text files (<code>ks_errors.txt</code> and <code>ks_debug.txt</code>)</li>
<li>KSFoundation EPIC automatically saves PNG, SVG or PDF files for each sequence module and also a slice-time chart. See <a class="el" href="_plotting.html">Plotting (HTML)</a>.</li>
<li>Plotting in <code>WTools</code> using [Analysis]-&gt;[MGD Sim]-&gt;[LoadCVs-&gt;Pulsegen-&gt;PlotPulse]</li>
<li>Running the PSD using [Analysis]-&gt;[MGD Sim]-&gt;[LoadCVs-&gt;Pulsegen-&gt;RunEntry], while also hammering on the [PlotPulse] button to force a screen refresh in the PlotPulse window. Sometimes the [LoadCVs] or [Pulsegen] button hangs, and when it does, press the [Refresh] button at the bottom of the [MGD Sim] window. But see also <a class="el" href="_plotting.html">Plotting (HTML)</a>. <br />
<br />
</li>
</ul>
</li>
<li>Moving the sequence binaries (2 files) to the MR-scanner (<em>mypsd</em> and <em>mypsd</em>.psd.o). GE has its product PSDs in <code>/usr/g/bin</code>, so you must avoid overwriting these. A good practice is to put your own PSDs in <code>/usr/g/research/&lt;yourname&gt;/</code> and make symolic links to them from <code>/usr/g/bin</code>, where the MR-scanner expects PSDs to reside: <div class="fragment"><div class="line">you@linux&gt; scp mypsd mypsd.psd.o sdc@&lt;mrscanner&gt;:/usr/g/research/&lt;yourname&gt;/</div><div class="line">sdc@mrscanner&gt; cd /usr/g/bin/</div><div class="line">sdc@mrscanner&gt; rm mypsd mypsd.o <span class="comment">// remove old links that might be here. Don&#39;t remove any product PSDs!</span></div><div class="line">sdc@mrscanner&gt; ln -s /usr/g/research/&lt;yourname&gt;/mypsd .</div><div class="line">sdc@mrscanner&gt; ln -s /usr/g/research/&lt;yourname&gt;/mypsd.psd.o .</div></div><!-- fragment --> <br />
</li>
<li>Testing the user interface (UI) behavior on the MR-scanner, trying to predownload the PSD by pressing [Save Rx]. <br />
 <br />
</li>
<li>Download the PSD, start prescan and scan, by pressing [Scan]. <br />
<br />
<br />
 </li>
</ul>
<h1><a class="anchor" id="ECCsimhw"></a>
Simulation vs. Hardware</h1>
<p>Most code in a pulse sequence should run both in simulation (WTools) and on the MR-scanner. Exception to this include:</p><ul>
<li>Plotting and debugging calls that can not be run on the MR-scanner since it won't be able to keep up with its real-time scanning process at the same time</li>
<li>Fake slices (using e.g. <a class="el" href="_g_e_required_8e.html#a9e0525cfd14e06359ddb8fe37ad965f5" title="Simulate scan locations in simulation (WTools)">simscan()</a>) in simulation, as there is no one end user prescribing the slices in simulation</li>
</ul>
<p>The ESE environment have C-preprocessing directives that are automatically set when compiling using <code>psdqmake</code>:</p><ul>
<li>SIM (-DSIM): Simulation</li>
<li>PSD_HW (-DPSD_HW): Hardware <br />
<br />
<br />
 <div class="image">
<img src="EPIC_crashcourse1.png" alt="EPIC_crashcourse1.png"/>
<div class="caption">
Simulation vs. Hardware</div></div>
 <br />
<br />
<br />
 </li>
</ul>
<h1><a class="anchor" id="ECChosttgt"></a>
HOST vs. TGT</h1>
<p>The MR-scanner is really two computers, one for the user interface (HOST) and one for the real-time scanning (TGT, a.k.a. IPG). This is why the pulse sequence is split up into two binaries to be placed on the MR-scanner. In simulation (WTools), HOST is the EvalTool window and TGT is the MGDSim window.</p>
<p>When running <code>psdqmake</code>, first the EPIC preprocessor takes the <em>mypsd</em>.e file (including all other *.e files <em>mypsd</em>.e refers to) and generates <em>mypsd</em>.host.c (HOST code) and <em>mypsd</em>.tgt.c (TGT code). If there is a compilation error, it will refer to either the <code>.host.c</code> or the <code>.tgt.c</code> file and point to some line number. One can open these files to see <em>where</em> the compilation error is, but one must sure NOT to modify these autogenerated c-files but instead the corresponding lines in <em>mypsd</em>.e. <br />
<br />
<br />
 </p><div class="image">
<img src="EPIC_crashcourse2.png" alt="EPIC_crashcourse2.png"/>
<div class="caption">
HOST vs. TGT</div></div>
<p> <br />
<br />
<br />
 </p>
<h1><a class="anchor" id="ECCmancode"></a>
Mandatory code sections (@****) in *.e and their use</h1>
<ul>
<li>@global: Global C-code (variables declaration, #include). Accessible on both HOST and TGT. Limited use usually. <br />
<br />
</li>
<li>@cv: EPIC specific Control Variables (CVs). Modifyable on HOST, readable on TGT. Variables may be of type <code>int</code> or <code>float</code> and there is an associate (hidden) <code>_myvar</code> struct to each <code>myvar</code>. <br />
<br />
</li>
<li>@ipgexport: Section to put global C-arrays and C-structs in. Accessible on both HOST and TGT. <br />
<br />
</li>
<li>@host: HOST code containing mandatory functions <a class="el" href="ksepi_8e.html#ab86d8a9c08d382dc537ec69e0f1cc9dc">cvinit()</a>, <a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a>, <a class="el" href="ksepi_8e.html#ae8a4dba5f13b208e5a28acc5025ab3bc">cvcheck()</a> and <a class="el" href="ksepi_8e.html#a6dab68043b9947b6a659f72613c083ec">predownload()</a> (see below), etc. <br />
<br />
</li>
<li>@pg: TGT code (but also used on HOST by the <code>UsePgenOnHost()</code> entry in the Imakefile) related to the generation of pulses (waveforms and trapezoids) on hardware. No real-time execution here. KSFoundation EPIC PSDs heavily relies on running @pg function in <a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a> to figure out e.g. sequence durations and SAR limits. <br />
<br />
</li>
<li>@rspvar: Declaration of rsp-variables for TGT use, which are variables that can be modified manually <em>during</em> scanning on the MR-scanner (by [Scan]-&gt;[ModifyRSP]). This may be useful for debugging sometimes. <br />
<br />
</li>
<li>@rsp: TGT code containing the mandatory functions <a class="el" href="ksepi_8e.html#a634b7856e1aae937a975832684c4724f">mps2()</a>, <a class="el" href="ksepi_8e.html#a63c7aacbe675da7765a25e4bbc9ed264">aps2()</a> and <a class="el" href="ksepi_8e.html#a1669428052472d00b1c55a1291f8032f">scan()</a>, where <a class="el" href="ksepi_8e.html#a1669428052472d00b1c55a1291f8032f">scan()</a> corresponds to the actual pressing of the [Scan] button. <br />
<br />
<br />
 </li>
</ul>
<h1><a class="anchor" id="Eccmantop"></a>
Mandatory top-level functions in a PSD and what they do</h1>
<ul>
<li><a class="el" href="ksepi_8e.html#ab86d8a9c08d382dc537ec69e0f1cc9dc">cvinit()</a> - HOST: Should set up UI menu button content and initialize various things. Menu buttons are controlled by variables beginning with <code>pi**</code>, see epic.h for a complete list or e.g. <a class="el" href="ksepi__implementation_8e.html#a66351df684e62e29938634fa21c75518" title="Initial setup of user interface (UI) with default values for menus and fields">ksepi_init_UI()</a> for an example. In WTools, this function is normally called every time the user modifies a value in EvalTool. On the MR-scanner, it will execute when the PSD is selected (but actually also a few times whenever a UI value is changed). <br />
<br />
</li>
<li><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a> - HOST: Should evaluate UI selections, perform gradient/RF amplitude/time calculations, set up various timings etc. In WTools, this function is normally called multiple times every time the user modifies a value in EvalTool. On the MR-scanner it will execute 37+ times whenever a UI value is changed.<br />
<br />
</li>
<li><a class="el" href="ksepi_8e.html#ae8a4dba5f13b208e5a28acc5025ab3bc">cvcheck()</a> - HOST: Should contain <code>epic_error()</code> (or <code><a class="el" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5" title="Common error message function for HOST and TGT">ks_error()</a></code> for KSFoundation EPIC PSDs) with messages to the end user about e.g. errors in parameter combinations. In WTools, this function is normally called once only every time the user modifies a value in EvalTool. On the MR-scanner it will execute once only whenever a UI value is changed.<br />
<br />
</li>
<li><a class="el" href="ksepi_8e.html#a6dab68043b9947b6a659f72613c083ec">predownload()</a> - HOST: Should set e.g. recon steering variables (<code>rh**</code>) and other variables that are consequences of other parameter choices. See e.g. <a class="el" href="_g_e_required_8e.html#a6d51efff591f87dbcc7887e45c16db0f" title="Sets required global rh*** variables for Cartsian imaging">GEReq_predownload_setrecon_readphase()</a> for an example. In WTools, this function is normally called once only every time the user modifies a value in EvalTool. On the MR-scanner it will execute once when the user presses [Save Rx].<br />
<br />
</li>
<li><a class="el" href="ksepi_8e.html#a9229731c099971b90dbf7721bad586a9">pulsegen()</a> - TGT (but also HOST): Using the variables set up on HOST using <a class="el" href="ksepi_8e.html#ab86d8a9c08d382dc537ec69e0f1cc9dc">cvinit()</a>, <a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a>, and <a class="el" href="ksepi_8e.html#a6dab68043b9947b6a659f72613c083ec">predownload()</a>, <a class="el" href="ksepi_8e.html#a9229731c099971b90dbf7721bad586a9">pulsegen()</a> is creating actual waveform memory and instruction amplitudes on the hardware (TGT). <a class="el" href="ksepi_8e.html#a9229731c099971b90dbf7721bad586a9">pulsegen()</a> typically includes more than one pulse sequence (module), and the way to mark a new sequence is via the EPIC macro SEQLENGTH(). KSFoundation EPIC uses its own <a class="el" href="_g_e_required_8e.html#ab1fe30ecb27b541de01992692c1e9a47" title="Creates a hardware sequence for the current sequence module">KS_SEQLENGTH()</a> instead. A "sequence" may be the <em>main sequence</em> or e.g. a <em>fatsat</em> sequence, the latter to be conceptually viewed as a plugin/option to the <em>main sequence</em>. In <a class="el" href="ksepi_8e.html#a1669428052472d00b1c55a1291f8032f">scan()</a>, it is possible to switch between these sequences in real-time (not unlike a drum machine).<br />
<br />
</li>
<li><a class="el" href="ksepi_8e.html#a634b7856e1aae937a975832684c4724f">mps2()</a> - TGT: Manual Prescan 2. Prescan involves setting transmit gain (TG), center frequency (CFH, CFL), and receiver gain (R1, R2). TG, CFH/CFL are set by Prescan.e, but the receiver gain must be set by calling the current PSD without phase encoding gradients on. <a class="el" href="ksepi_8e.html#a634b7856e1aae937a975832684c4724f">mps2()</a> is called by selecting the [ScanTR R1/R2] button in [ManualPrescan] on the MR-scanner and should play the sequence in a way that the receiver can get a proper signal to tune gain settings from. R1 is the analog receiver gain and R2 the digital receiver gain (step 2).<br />
<br />
</li>
<li><a class="el" href="ksepi_8e.html#a63c7aacbe675da7765a25e4bbc9ed264">aps2()</a> - TGT: Same as <a class="el" href="ksepi_8e.html#a634b7856e1aae937a975832684c4724f">mps2()</a>, but executed during Auto Prescan, rather than Manual Prescan, before every scan.<br />
<br />
</li>
<li><a class="el" href="ksepi_8e.html#a1669428052472d00b1c55a1291f8032f">scan()</a> - TGT: Should play out the sequence in real-time and change phase encoding steps, RF frequencies etc. Switching between sequeneces (e.g. between the main sequence and a fatsat sequence) is done via a call to <code><a class="el" href="_k_s_foundation__tgt_8c.html#a17778e7ed4abcb39ee14e9e4d2966b18">boffset()</a></code>. In KSFoundation EPIC, the sequence switching and playout is done via <a class="el" href="_k_s_foundation_8h.html#a02e188307a4bd9dfdb00d37688c0487e">ks_scan_playsequence()</a>.<br />
<br />
 <br />
<br />
<br />
 </li>
</ul>
<h1><a class="anchor" id="ECCcv"></a>
CVs (Control Variables)</h1>
<p>A control variable may be an int or a float declared as (example with given numbers): </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> myvar = 12 with {2, 20, 12, VIS, <span class="stringliteral">&quot;My description of this variable&quot;</span>,};</div></div><!-- fragment --><p> In this example, <code>myvar</code> is declared as an int and initialized to 12, but behind the scenes a struct <code>_myvar</code> will be declared with fields <code>_myvar.minval = 2</code>, <code>_myvar.maxval = 20</code>, <code>_myvar.defval = 12</code>, and <code>_myvar.descr = "My description of this variable"</code>. "VIS" means that one can search and find the variable in [Display CVs] on the MR-scanner. In addition, this <code>_myvar</code> struct has the fields <code>.existflag</code> and <code>.fixedflag</code>.</p>
<p>The _struct should normally not be used directly. Instead, there are EPIC C-macros like cvmin(), cvmax(), cvdef(), cvmod() and cvoverride(), which takes <code>myvar</code> as an input argument, not <code>_myvar</code>. The idea behind min/max is to force a variable to be within a certain range. Often a UI error is passed to the end user if this is not the case, but sometimes the error is only shown as a "Download failure" when pressing [Scan].</p>
<p>The field <code>.existflag</code> is automatically set to <code>PSD_ON</code> (= <code>TRUE</code> = 1) when the CV exist. For all CVs that belong to a UI menu button or field (called <code>op***</code>), the UI sets the <code>_op***.existflag = TRUE</code> when the user has selected it. To ask if the user has selected a CV <em>myvar</em>: </p><div class="fragment"><div class="line"><span class="keywordflow">if</span> (existcv(myvar)) <span class="comment">// returns TRUE (= PSD_ON = 1) or FALSE (= PSD_OFF = 0)</span></div><div class="line">  dothis;</div></div><!-- fragment --><p> Tricker still, one may see the following look-a-like call, but with completely different result: </p><div class="fragment"><div class="line">x = exist(myvar) <span class="comment">// if the CV &quot;exist&quot;, x will be set to myvar, otherwise _myvar.defval</span></div></div><!-- fragment --><p>When the user sets an <code>op**</code> (i.e. UI) CV, the <code>.fixedflag</code> field is also set. If this field is set for a CV, any assignment in the PSD code will be ignored (!). For example, before the user has set the echo time (TE) corresponding to the CV <code>opte</code>, the following code </p><div class="fragment"><div class="line">opte = 15000; <span class="comment">// time in [us]</span></div></div><!-- fragment --><p> will set TE to 15 ms. But as soon as the user has selected/modified it, <code>_opte.fixedflag = TRUE</code>, and the very same assignment is ignored. They way this works it that the EPIC preprocessor (producing <code>.host.c</code> and <code>tgt.c</code> from the <code>.e</code> file), changes the line <code>opte = 15000;</code> to: </p><div class="fragment"><div class="line">opte = _opte.fixedflag ? ((void)(15000), opte) : 15000;</div></div><!-- fragment --><p> which effectively is the same thing as only assigning it to 15000 if <code>.fixedflag = FALSE</code>.</p>
<p>Sometimes this fixedflag mechanism can be good even though it makes the coding different. But sometimes, one may want to override the user's selection/change of a CV, which is done by (here <code>opte</code> as an example): </p><div class="fragment"><div class="line">cvoverride(opte, &lt;newval&gt;, PSD_FIX_ON, PSD_EXIST_ON);</div></div><!-- fragment --><p> where the second argument is the forced new value. The third argument sets the <code>_opte.fixedflag</code> field and the fourth argument set the <code>_opte.existflag</code> field afterwards.</p>
<p>See <code>/ESE_xxx/psd/psdsource/epic.h</code> for most pre-existing CVs, incl. <code>op***</code>. <br />
<br />
<br />
 </p>
<h1><a class="anchor" id="ECCinline"></a>
@inline and %ifdef</h1>
<p>A C preprocessor uses defines to include/exclude code using </p><div class="fragment"><div class="line"><span class="preprocessor">#ifdef SOMETHING</span></div><div class="line">   <span class="keywordflow">do</span> something;</div><div class="line"><span class="preprocessor">#else</span></div><div class="line">   <span class="keywordflow">do</span> somthing <span class="keywordflow">else</span>;   </div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line"><span class="comment">// or </span></div><div class="line"><span class="preprocessor">#if SOMETHING &gt; 10</span></div><div class="line">  <span class="keywordflow">do</span> something;</div><div class="line"><span class="preprocessor">#end</span></div></div><!-- fragment --><p> which is simply performed in-place in the code <em>before</em> the C-compiler sees it. A typical example in EPIC is to include/exclude code hunks for Simulation/Hardware or HOST/TGT.</p>
<p>However, before the C preprocessor acts on the <code>.host.c</code> and <code>.tgt.c</code> files generated from the <code>.e</code> file (by the EPIC preprocessor), there are also directives for the EPIC preprocessor in the <code>.e</code> file.</p>
<p>Analogously to #include for <code>.c</code> files, there is an </p><div class="fragment"><div class="line">@<span class="keyword">inline</span> somefiletoinclude.e</div></div><!-- fragment --><p> for EPIC's <code>.e</code> files. This includes the file <code>somefiletoinclude.e</code>, but any section (@pg, @host, etc.) in that file will be moved to the corresponding sections rather than placed at the point of @inline.</p>
<p>There is also a way to conditionally include/exclude code in the .e file parsed by the EPIC preprocessor using %ifdef instead of #ifdef. There is however no %if like #if. The need for %ifdef is rare, but must be used when one need to exclude EPIC specific code, e.g. a CV declaration dependent on release versions, before the EPIC processing to *.c files.</p>
<p>For example, for KSFoundation EPIC PSDs, their Imakefile adds two defines based on the EPIC release. To make a pulse sequence compatible with multiple EPIC releases, we let the Imakefile create one define for the EPIC preprocessor and one define for the C preprocessor (example here for release 25.x):</p><ul>
<li>EPIC_RELEASE_IS_25x (EPIC preprocessor). Allows <code>%ifdef EPIC_RELEASE_IS_25x</code></li>
<li>EPIC_RELEASE = 25 (C preprocessor). Allows <code>#if EPIC_RELEASE &gt;= 25</code></li>
</ul>
<p>These can be used in the sequence to handle quirks (e.g. change of # of arguments) in some functions, or new/obsolete functions, between releases. For KSFoundation EPIC PSDs, all release-specific stuff has already been placed in <a class="el" href="_g_e_required_8e.html" title="This file has several sections that should be @inline&#39;d for a main pulse sequence written entirely in...">GERequired.e</a> to make the PSDs compatible with multiple releases without clutter. <br />
<br />
<br />
 <a href="index.html">Home</a> <br />
 </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
