<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>KSFoundation: KS_SEQ_CONTROL Struct Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="KarolinskaLogo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">KSFoundation
   &#160;<span id="projectnumber">[Feb-2019]</span>
   </div>
   <div id="projectbrief">A platform for simpler EPIC programming on GE MR systems</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('struct_k_s___s_e_q___c_o_n_t_r_o_l.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-attribs">Data Fields</a>  </div>
  <div class="headertitle">
<div class="title">KS_SEQ_CONTROL Struct Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;KSFoundation.h&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Data Fields</h2></td></tr>
<tr class="memitem:a901ce6fe6b2fa774dc95ea6bab219bd0"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a901ce6fe6b2fa774dc95ea6bab219bd0">min_duration</a></td></tr>
<tr class="separator:a901ce6fe6b2fa774dc95ea6bab219bd0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5af9f3a7de19e7493ce64776bd8f3556"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a5af9f3a7de19e7493ce64776bd8f3556">nseqinstances</a></td></tr>
<tr class="separator:a5af9f3a7de19e7493ce64776bd8f3556"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac6037d68ff7b6f66735a92611628df57"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6037d68ff7b6f66735a92611628df57">ssi_time</a></td></tr>
<tr class="separator:ac6037d68ff7b6f66735a92611628df57"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac6e4b2a3cf932b33832d4e4e4e7cd0de"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a></td></tr>
<tr class="separator:ac6e4b2a3cf932b33832d4e4e4e7cd0de"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab9bf2aebde69b811853b4febc57ff5f8"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ab9bf2aebde69b811853b4febc57ff5f8">momentstart</a></td></tr>
<tr class="separator:ab9bf2aebde69b811853b4febc57ff5f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a729d02cb24cec9beeaf9a22ac9390754"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a729d02cb24cec9beeaf9a22ac9390754">rfscalingdone</a></td></tr>
<tr class="separator:a729d02cb24cec9beeaf9a22ac9390754"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1c544bec41003a594ba4ec7d43a3a470"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_k_s_foundation_8h.html#a06d5868fa630d1c05faea3350dbf045c">KS_DESCRIPTION</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a1c544bec41003a594ba4ec7d43a3a470">description</a></td></tr>
<tr class="separator:a1c544bec41003a594ba4ec7d43a3a470"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0dd6f20330fb1abf528ca46f34299f7c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="struct_k_s___s_e_q___h_a_n_d_l_e.html">KS_SEQ_HANDLE</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a0dd6f20330fb1abf528ca46f34299f7c">handle</a></td></tr>
<tr class="separator:a0dd6f20330fb1abf528ca46f34299f7c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2573e18f36ab5c3d3fc97072edcfab16"><td class="memItemLeft" align="right" valign="top"><a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html">KS_GRADRFCTRL</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a2573e18f36ab5c3d3fc97072edcfab16">gradrf</a></td></tr>
<tr class="separator:a2573e18f36ab5c3d3fc97072edcfab16"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><h4>A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching</h4>
<div class="image">
<img src="KS_SEQ_CONTROL.png" alt="KS_SEQ_CONTROL.png"/>
<div class="caption">
KS_SEQ_CONTROL</div></div>
<p> <br />
</p>
<p>Each sequence module in the pulse sequence should have a dedicated <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> struct associated with it. For example, one may have the following <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> structs in a pulse sequence, where there is one main sequence and an fatsat module plugin that technically are two sequences - or sequence modules - (via the use of <a class="el" href="_g_e_required_8e.html#ab1fe30ecb27b541de01992692c1e9a47" title="Creates a hardware sequence for the current sequence module">KS_SEQLENGTH()</a>):</p><ul>
<li>mymainseqctrl - Sequence control for the main sequence, i.e. the only sequence that is storing data (the <em>actual</em> sequence)</li>
<li>fatsatseqctrl - Sequence control for the fatsat sequence module</li>
</ul>
<p>The <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> struct has multiple uses and could be viewed as the <em>administrator</em> for each sequence module. Here is a list of uses and steps neccesary to achieve the intended functionality:</p>
<h4>In <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code> on HOST:</h4>
<ul>
<li>Collection of information on how many times each <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> or <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object is placed out in <code><a class="el" href="ksepi_8e.html#a9229731c099971b90dbf7721bad586a9">pulsegen()</a></code> for the particular sequence module.<ul>
<li>Preferrably, there is a <em>sequence generating function</em> that may be named e.g. <em>seqmodulename</em><code>_pg()</code>, which contains all <a class="el" href="_k_s_foundation_8h.html#a61651c54c4dfd4388fc939d804a9964b" title="Places a KS_TRAP sequence object on a board at some position in the pulse sequence">ks_pg_trap()</a>, <a class="el" href="_k_s_foundation_8h.html#a853cff23395e570cc88aa3405b78c3a9" title="Places a KS_RF sequence object on a board at some position in the pulse sequence">ks_pg_rf()</a> (and other <code>ks_pg_***()</code>) calls that build up the sequence module by placing out its sequence objects. The <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> struct for the current sequence module should be the last argument to each <code>ks_pg_***()</code> call in <em>seqmodulename</em><code>_pg()</code>.</li>
<li>By running <em>seqmodulename</em><code>_pg()</code> in <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code> the <code>seqctrl.gradrf</code> field will be updated with pointers to its sequence objects, allowing <code>seqctrl</code> to also know the number of occurrences of each trapezoid or RF.</li>
<li>This information is used for RF scaling, gradient heating and SAR calculations, after adding the sequence modules to one common <a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html" title="Collection handle of all sequence modules involved in the pulse sequence, used for RF scaling...">KS_SEQ_COLLECTION</a> struct using <a class="el" href="_k_s_foundation_8h.html#a9c627057bb753177d7b74e5cd9ba1a46" title="Adds a sequence module (KS_SEQ_CONTROL) to the KS_SEQ_COLLECTION struct for later RF scaling and SAR ...">ks_eval_addtoseqcollection()</a>.</li>
</ul>
</li>
<li>Somewhere in <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code>, the SSI time for the sequence modules needs to be set. This is the time the sequence module needs to update its waveforms from one playout to the next during scanning. Often 1 ms is enough, but for long sequence modules it may need to be increased, especially if debugging outputs are used. It can also be set lower, sometimes down to about 0.1 ms.</li>
<li>In <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code>, the <em>seqmodulename</em><code>_pg()</code> function for each sequence module should be called <em>after</em> the <code>ks_eval_***()</code> calls setting up the sequence objects, but <em>before</em> the TR timing, RF scaling and SAR calculations. Inside each <em>seqmodulename</em><code>_pg()</code> function the <code>.duration</code> and <code>.min_duration</code> fields of the <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> struct should be set to the actual minimum duration of the sequence module (the [us] value corresponding to the absolute position of the last gradient or RF waveform). See <a class="el" href="_k_s_foundation_8h.html#a75c403072633f5a42fe364af4454b245" title="Sets the minimum duration and duration fields of a KS_SEQ_CONTROL struct based on some minimum time (...">ks_eval_seqctrl_setminduration()</a> in the example below.</li>
</ul>
<h4>On TGT:</h4>
<ul>
<li>In <code><a class="el" href="ksepi_8e.html#a9229731c099971b90dbf7721bad586a9">pulsegen()</a></code>: The <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> struct is the 2nd arg to <a class="el" href="_g_e_required_8e.html#ab1fe30ecb27b541de01992692c1e9a47" title="Creates a hardware sequence for the current sequence module">KS_SEQLENGTH()</a>, which defines the hardware sequence duration (using the <code>seqctrl.duration</code> value) for the sequence module. Using <a class="el" href="_g_e_required_8e.html#ab1fe30ecb27b541de01992692c1e9a47" title="Creates a hardware sequence for the current sequence module">KS_SEQLENGTH()</a> instead of GE's SEQLENGTH() macro allows sequence module playouts, and switching between modules, in <code><a class="el" href="ksepi_8e.html#a1669428052472d00b1c55a1291f8032f">scan()</a></code> using <a class="el" href="_k_s_foundation_8h.html#a02e188307a4bd9dfdb00d37688c0487e">ks_scan_playsequence()</a>.</li>
<li>In <code><a class="el" href="ksepi_8e.html#a1669428052472d00b1c55a1291f8032f">scan()</a></code>, and its psd-specific subroutines: The <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> struct is passed to <a class="el" href="_k_s_foundation_8h.html#a02e188307a4bd9dfdb00d37688c0487e">ks_scan_playsequence()</a> to switch to and play out this sequence module in real time during scanning. <a class="el" href="_k_s_foundation_8h.html#a02e188307a4bd9dfdb00d37688c0487e">ks_scan_playsequence()</a> also returns <code>seqctrl.duration</code>, allowing timing checks on HOST by dry-running scan functions in <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code>. E.g. the scan clock is set by GE's <code>pitscan</code> variable, which can be set by calling <code>scanloop()</code> in the simplified example below.</li>
</ul>
<h3>Example use of <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> with one main sequence module and one fatsat sequence module</h3>
<div class="fragment"><div class="line">@ipgexport</div><div class="line"><a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> mymainseqctrl;</div><div class="line"><a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> fatsatseqctrl;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">@host</div><div class="line"></div><div class="line"><a class="code" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval</a>() {</div><div class="line"></div><div class="line">  setup_sequenceobjects(); <span class="comment">// see below</span></div><div class="line">  setup_fatsatsequenceobjects(); <span class="comment">// details not shown in this example</span></div><div class="line"></div><div class="line">  <span class="comment">// call each *seqmodule*_pg() function here and make sure each seqctrl.duration field &gt; 0 for those sequence modules that should be used in the current setting.</span></div><div class="line">  mypsd_pg(); <span class="comment">// also updates mymainseqctrl.gradrf, mymainseqctrl.min_duration = mymainseqctrl.duration &gt; 0</span></div><div class="line">  myfatsat_pg(); <span class="comment">// some fatsat sequence module that also updates fatsatseqctrl.gradrf, fatsatseqctrl.min_duration = fatsatseqctrl.duration &gt; 0</span></div><div class="line"></div><div class="line">  <span class="comment">// TR timing &amp; SAR calcs here (for details, see the KS_SEQ_COLLECTION documentation)</span></div><div class="line"></div><div class="line">  pitscan = scanloop(); <span class="comment">// Value of scan clock by dry-running the scan on HOST</span></div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> setup_sequenceobjects() {</div><div class="line"></div><div class="line">  <a class="code" href="_k_s_foundation_8h.html#ad77a28d39f423bca930ee2f8f392de17">ks_eval_selrf</a>(&amp;myselrf, <span class="stringliteral">&quot;myexc&quot;</span>); <span class="comment">// selective RF excitation</span></div><div class="line">  <a class="code" href="_k_s_foundation_8h.html#acc45c24d1996acd3d95ae2866c5ffb2b">ks_eval_phaser</a>(&amp;myphaser, <span class="stringliteral">&quot;myphaseenc&quot;</span>); <span class="comment">// phase encoding</span></div><div class="line">  <a class="code" href="_k_s_foundation_8h.html#af40cc818066c7757959bf3712bfc5e6f">ks_eval_trap</a>(&amp;mydephaser, <span class="stringliteral">&quot;readdephaser&quot;</span>); <span class="comment">// read dephaser</span></div><div class="line">  <a class="code" href="_k_s_foundation_8h.html#a0e06bd2e4433a2b508c7610d7056050f">ks_eval_readtrap</a>(&amp;myreadout, <span class="stringliteral">&quot;myreadout&quot;</span>); <span class="comment">// readout with trapezoid</span></div><div class="line"></div><div class="line">  <span class="comment">// Init seqctrl</span></div><div class="line">  <a class="code" href="_k_s_foundation_8h.html#ae789f20604371eec8036d0a63555d514">ks_init_seqcontrol</a>(&amp;mymainseqctrl); <span class="comment">// Reset contents of KS_SEQ_CONTROL to KS_INIT_SEQ_CONTROL</span></div><div class="line">  strcpy(mymainseqctrl.description, <span class="stringliteral">&quot;mymainseq&quot;</span>); <span class="comment">// add description to it</span></div><div class="line">  mymainseqctrl.ssi_time = 1ms; <span class="comment">// Optional: Set SSI time (default: 1 ms)</span></div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">@pg</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> mypsd_pg() {</div><div class="line">  <a class="code" href="struct_k_s___s_e_q_l_o_c.html">KS_SEQLOC</a> tmploc = <a class="code" href="_k_s_foundation_8h.html#ad01dd4f06fe226a502e872d4173ba7ae">KS_INIT_SEQLOC</a>;</div><div class="line"></div><div class="line">  tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> = 1ms;</div><div class="line">  <a class="code" href="_k_s_foundation_8h.html#a6e727c3449c63278cbfc2e35cfcfa9fa">ks_pg_selrf</a>(&amp;myselrf, tmploc, &amp;mymainseqctrl); <span class="comment">// play the RF pulse, beginning at 1ms into the sequence</span></div><div class="line"></div><div class="line">  tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> += myselrf.grad.duration + myselrf.postgrad.duration;</div><div class="line">  <a class="code" href="_k_s_foundation_8h.html#a094595db960708064dc1b8b645c4be71">ks_pg_phaser</a>(&amp;myphaser, tmploc, &amp;mymainseqctrl);</div><div class="line"></div><div class="line">  tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> += myphaser.grad.duration;</div><div class="line">  <a class="code" href="_k_s_foundation_8h.html#a21198913d5b1603f03a5e5d61d00408c">ks_pg_readtrap</a>(&amp;myreadout, tmploc, &amp;mymainseqctrl);</div><div class="line"></div><div class="line">  tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a> += myreadout.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>; <span class="comment">// time for the end of last sequence entry</span></div><div class="line"></div><div class="line"><span class="preprocessor">#ifndef IPG // On HOST only (i.e. not IPG/TGT)</span></div><div class="line">  <a class="code" href="_k_s_foundation_8h.html#a75c403072633f5a42fe364af4454b245">ks_eval_seqctrl_setminduration</a>(&amp;mymainseqctrl, tmploc.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a1910d262855b71da353ed0d07a6c7823">pos</a>); <span class="comment">// sets mymainseqctrl.duration = mymainseqctrl.min_duration = tmploc.pos + mymainseqctrl.ssi_time</span></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line"><a class="code" href="ksepi_8e.html#a9229731c099971b90dbf7721bad586a9">pulsegen</a>() {</div><div class="line"></div><div class="line">   mypsd_pg();</div><div class="line">   <a class="code" href="_g_e_required_8e.html#ab1fe30ecb27b541de01992692c1e9a47">KS_SEQLENGTH</a>(seqcore, mymainseqctrl);</div><div class="line"></div><div class="line">   myfatsat_pg();</div><div class="line">   <a class="code" href="_g_e_required_8e.html#ab1fe30ecb27b541de01992692c1e9a47">KS_SEQLENGTH</a>(seqfat, fatsatseqctrl);</div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// declare scanloop in @pg section instead of @rsp to allow it to be called on HOST too. This, to figure out how long one TR is.</span></div><div class="line"><span class="keywordtype">float</span> scanloop() {</div><div class="line">  <span class="keywordtype">float</span> time = 0.0;</div><div class="line"></div><div class="line">  <span class="keywordflow">for</span> (ky = 0; ky &lt; <a class="code" href="_k_s_foundation__common_8c.html#a62476b720a40200e94668beec660cac0">opyres</a>; ky++) {</div><div class="line">    <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; opslquant; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line">      <span class="comment">// ... do some phase encoding etc (not shown)...</span></div><div class="line">      time += <a class="code" href="_k_s_foundation_8h.html#a02e188307a4bd9dfdb00d37688c0487e">ks_scan_playsequence</a>(&amp;fatsatseqctrl); <span class="comment">// if fatsatseqctrl.duration &gt; 0, it plays sequence in real time (on TGT) and returns the time in [us] equal to value of fatsatseqctrl.duration</span></div><div class="line">      time += <a class="code" href="_k_s_foundation_8h.html#a02e188307a4bd9dfdb00d37688c0487e">ks_scan_playsequence</a>(&amp;mymainseqctrl); <span class="comment">// if mymainseqctrl.duration &gt; 0, it plays sequence in real time (on TGT) and returns the time in [us] equal to value of mymainseqctrl.duration</span></div><div class="line">    }</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> time; <span class="comment">// return the time in [us] for opslquant number of slices</span></div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">@rsp</div><div class="line"></div><div class="line"><a class="code" href="ksepi_8e.html#a1669428052472d00b1c55a1291f8032f">scan</a>() {</div><div class="line"></div><div class="line">  scanloop();</div><div class="line"></div><div class="line">}</div></div><!-- fragment --> </div><h2 class="groupheader">Field Documentation</h2>
<a id="a901ce6fe6b2fa774dc95ea6bab219bd0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a901ce6fe6b2fa774dc95ea6bab219bd0">&#9670;&nbsp;</a></span>min_duration</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int min_duration</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>In [us]. The minimum possible sequence duration based on the end of the last gradient/RF waveform. Lower limit of the .duration field that must be manually set </p>

</div>
</div>
<a id="a5af9f3a7de19e7493ce64776bd8f3556"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5af9f3a7de19e7493ce64776bd8f3556">&#9670;&nbsp;</a></span>nseqinstances</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nseqinstances</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Number of playouts in scan loop. <a class="el" href="_k_s_foundation_8h.html#a02e188307a4bd9dfdb00d37688c0487e">ks_scan_playsequence()</a> increments this on HOST for each call. Value is set to zero by <a class="el" href="_k_s_foundation_8h.html#acb34cd9d6c99193829696596b4d0271f" title="Set the .nseqinstances field of each sequence module (KS_SEQ_CONTROL) equal to 0">ks_eval_seqcollection_resetninst()</a> </p>

</div>
</div>
<a id="ac6037d68ff7b6f66735a92611628df57"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac6037d68ff7b6f66735a92611628df57">&#9670;&nbsp;</a></span>ssi_time</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ssi_time</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>In [us]. The SSI time (hardware update time) for the sequence module. Default is 1000 us </p>

</div>
</div>
<a id="ac6e4b2a3cf932b33832d4e4e4e7cd0de"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac6e4b2a3cf932b33832d4e4e4e7cd0de">&#9670;&nbsp;</a></span>duration</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int duration</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>In [us]. The actual duration of the sequence module. Must be &gt;= .min_duration, and is used in <a class="el" href="_g_e_required_8e.html#ab1fe30ecb27b541de01992692c1e9a47" title="Creates a hardware sequence for the current sequence module">KS_SEQLENGTH()</a> and for SAR check and TR validation (<a class="el" href="_g_e_required_8e.html#a027161dabe834c55750bd1e7f2fa8473" title="Runs the slice loop and validates TR and SAR/hardware limits">GEReq_eval_checkTR_SAR()</a>) </p>

</div>
</div>
<a id="ab9bf2aebde69b811853b4febc57ff5f8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab9bf2aebde69b811853b4febc57ff5f8">&#9670;&nbsp;</a></span>momentstart</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int momentstart</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>In [us]. Magnetic reference point for the excitation pulse (TE = 0) relative to the start of the sequence module. This field is set automatically by <a class="el" href="_k_s_foundation_8h.html#a853cff23395e570cc88aa3405b78c3a9" title="Places a KS_RF sequence object on a board at some position in the pulse sequence">ks_pg_rf()</a> if <code>rf.role = KS_RF_ROLE_EXC</code>, under the assumption that there is only one excitation RF pulse in each sequence module. If not, <code>.momentstart</code> should be set manually. Besides TE calculations in the sequence module's pg function itself, <code>.momentstart</code> for a main sequence is also used in <a class="el" href="_k_s_inversion_8e.html" title="This file contains an inversion preparation module that should be @inline&#39;d at the beginning of a KSF...">KSInversion.e</a> for TI timing. </p>

</div>
</div>
<a id="a729d02cb24cec9beeaf9a22ac9390754"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a729d02cb24cec9beeaf9a22ac9390754">&#9670;&nbsp;</a></span>rfscalingdone</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rfscalingdone</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Default FALSE (until <a class="el" href="_g_e_required_8e.html#af06136710d55a4b8a9d63d1c676e7565" title="Performs RF scaling of all RF pulses in the KS_SEQ_COLLECTION and Prescan">GEReq_eval_rfscaling()</a> sets it to TRUE). For safety reasons (and to make sure correct FA is set), <a class="el" href="_k_s_foundation_8h.html#a853cff23395e570cc88aa3405b78c3a9" title="Places a KS_RF sequence object on a board at some position in the pulse sequence">ks_pg_rf()</a> (and hence <a class="el" href="_k_s_foundation_8h.html#a6e727c3449c63278cbfc2e35cfcfa9fa" title="Places a KS_SELRF sequence object on a gradient (and RF) board at some position in the pulse sequence...">ks_pg_selrf()</a>) refuses to place the RF pulse belonging to this sequence module if <code>.rfscalingdone</code> = FALSE. </p>

</div>
</div>
<a id="a1c544bec41003a594ba4ec7d43a3a470"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1c544bec41003a594ba4ec7d43a3a470">&#9670;&nbsp;</a></span>description</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_k_s_foundation_8h.html#a06d5868fa630d1c05faea3350dbf045c">KS_DESCRIPTION</a> description</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Description of the sequence module </p>

</div>
</div>
<a id="a0dd6f20330fb1abf528ca46f34299f7c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0dd6f20330fb1abf528ca46f34299f7c">&#9670;&nbsp;</a></span>handle</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_k_s___s_e_q___h_a_n_d_l_e.html">KS_SEQ_HANDLE</a> handle</td>
        </tr>
      </table>
</div><div class="memdoc">
<p><em>Internal use</em>. Used to keep track of the global sequence index </p>

</div>
</div>
<a id="a2573e18f36ab5c3d3fc97072edcfab16"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2573e18f36ab5c3d3fc97072edcfab16">&#9670;&nbsp;</a></span>gradrf</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html">KS_GRADRFCTRL</a> gradrf</td>
        </tr>
      </table>
</div><div class="memdoc">
<p><em>Internal use</em>. Used to gather pointers to RF and gradient objects in the sequence module </p>

</div>
</div>
<hr/>The documentation for this struct was generated from the following file:<ul>
<li><a class="el" href="_k_s_foundation_8h.html">KSFoundation.h</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
