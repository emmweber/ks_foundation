<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>KSFoundation: KSFoundation_tgt.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="KarolinskaLogo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">KSFoundation
   &#160;<span id="projectnumber">[Feb-2019]</span>
   </div>
   <div id="projectbrief">A platform for simpler EPIC programming on GE MR systems</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_k_s_foundation__tgt_8c.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">KSFoundation_tgt.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;PromoCommon.h&gt;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">union &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="union_indices.html">Indices</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a6c406ab72abe3eadd93f7e889e9afd32"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#a6c406ab72abe3eadd93f7e889e9afd32">ks_scan_omegawave_hz</a> (<a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave, int instanceno, float Hz)</td></tr>
<tr class="separator:a6c406ab72abe3eadd93f7e889e9afd32"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a53e38393648beaa5a1d6ed9da63c6875"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#a53e38393648beaa5a1d6ed9da63c6875">ks_scan_omegatrap_hz</a> (<a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> *trp, int instanceno, float Hz)</td></tr>
<tr class="separator:a53e38393648beaa5a1d6ed9da63c6875"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a196a10609c8f75d0ff6d7a520d0b7c27"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#a196a10609c8f75d0ff6d7a520d0b7c27">ks_scan_wait</a> (<a class="el" href="struct_k_s___w_a_i_t.html">KS_WAIT</a> *wait, int waitperiod)</td></tr>
<tr class="separator:a196a10609c8f75d0ff6d7a520d0b7c27"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a981da87d928a921e5d179e8268b92f1f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#a981da87d928a921e5d179e8268b92f1f">ks_scan_trap_ampscale</a> (<a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> *trp, int instanceno, float ampscale)</td></tr>
<tr class="separator:a981da87d928a921e5d179e8268b92f1f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a097e1c05c128af69e214291a7b611b60"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#a097e1c05c128af69e214291a7b611b60">ks_scan_trap_ampscale_slice</a> (<a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> *trp, int start, int skip, int count, float ampscale)</td></tr>
<tr class="separator:a097e1c05c128af69e214291a7b611b60"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a183aef5f28e9491f792465e4b6d2b112"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#a183aef5f28e9491f792465e4b6d2b112">ks_scan_phaser_kmove</a> (<a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *phaser, int instanceno, double pixelunits)</td></tr>
<tr class="separator:a183aef5f28e9491f792465e4b6d2b112"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aff91e4da3b6ccabd607ec0da04f774ce"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#aff91e4da3b6ccabd607ec0da04f774ce">ks_scan_phaser_toline</a> (<a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *phaser, int instanceno, int <a class="el" href="_g_e_required_8e.html#a1cb6f035a0e9565bbf12c3ef04c3c229">view</a>)</td></tr>
<tr class="separator:aff91e4da3b6ccabd607ec0da04f774ce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a81a97893a74af952d90181aa858e709b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#a81a97893a74af952d90181aa858e709b">ks_scan_phaser_fromline</a> (<a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *phaser, int instanceno, int <a class="el" href="_g_e_required_8e.html#a1cb6f035a0e9565bbf12c3ef04c3c229">view</a>)</td></tr>
<tr class="separator:a81a97893a74af952d90181aa858e709b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aefb58d645ca29e4cfa68403df396e53f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#aefb58d645ca29e4cfa68403df396e53f">ks_scan_rf_ampscale</a> (<a class="el" href="struct_k_s___r_f.html">KS_RF</a> *rf, int instanceno, float ampscale)</td></tr>
<tr class="separator:aefb58d645ca29e4cfa68403df396e53f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ada6d1910f42394dc7fb363d85bd6e9c5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#ada6d1910f42394dc7fb363d85bd6e9c5">ks_scan_rf_on</a> (<a class="el" href="struct_k_s___r_f.html">KS_RF</a> *rf, int instanceno)</td></tr>
<tr class="separator:ada6d1910f42394dc7fb363d85bd6e9c5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa67267b854dda4b52334ba189f876bd7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#aa67267b854dda4b52334ba189f876bd7">ks_scan_rf_on_chop</a> (<a class="el" href="struct_k_s___r_f.html">KS_RF</a> *rf, int instanceno)</td></tr>
<tr class="separator:aa67267b854dda4b52334ba189f876bd7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a99675ab672242a3f37444f01b1246bda"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#a99675ab672242a3f37444f01b1246bda">ks_scan_rf_off</a> (<a class="el" href="struct_k_s___r_f.html">KS_RF</a> *rf, int instanceno)</td></tr>
<tr class="separator:a99675ab672242a3f37444f01b1246bda"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb1b77a3c2cb4a699081c3ba79ba428c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#adb1b77a3c2cb4a699081c3ba79ba428c">ks_scan_selrf_setfreqphase_pins</a> (<a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *selrf, int instanceno, SCAN_INFO sliceinfo, int sms_multiband_factor, float sms_slice_gap, float rfphase)</td></tr>
<tr class="separator:adb1b77a3c2cb4a699081c3ba79ba428c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae8766ce800f95dd75ca2eece6638326c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#ae8766ce800f95dd75ca2eece6638326c">ks_scan_selrf_setfreqphase</a> (<a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *selrf, int instanceno, SCAN_INFO sliceinfo, float rfphase)</td></tr>
<tr class="separator:ae8766ce800f95dd75ca2eece6638326c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abaf9de92fbb264944d41ef719f5bc438"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#abaf9de92fbb264944d41ef719f5bc438">ks_scan_rf_setphase</a> (<a class="el" href="struct_k_s___r_f.html">KS_RF</a> *rf, int instanceno, float rfphase)</td></tr>
<tr class="separator:abaf9de92fbb264944d41ef719f5bc438"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2e916337476b7566b3bf033824f964ba"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#a2e916337476b7566b3bf033824f964ba">ks_scan_wave2hardware</a> (<a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *wave, const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a> newwave)</td></tr>
<tr class="separator:a2e916337476b7566b3bf033824f964ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a27f5cab084726434159934c2b1594eb6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#a27f5cab084726434159934c2b1594eb6">ks_scan_offsetfov_iso</a> (<a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a> *readtrap, int instanceno, SCAN_INFO sliceinfo, double ky, double kz, double rcvphase)</td></tr>
<tr class="separator:a27f5cab084726434159934c2b1594eb6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a13039d7727a8f50dd649fb36c9f7d3a6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#a13039d7727a8f50dd649fb36c9f7d3a6">ks_scan_offsetfov_iso_readwave</a> (<a class="el" href="struct_k_s___r_e_a_d_w_a_v_e.html">KS_READWAVE</a> *readwave, int instanceno, SCAN_INFO sliceinfo, double ky, double kz, double rcvphase)</td></tr>
<tr class="separator:a13039d7727a8f50dd649fb36c9f7d3a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a567f7714943a0c78a422ee41defe2acf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#a567f7714943a0c78a422ee41defe2acf">ks_scan_offsetfov</a> (<a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a> *readtrap, int instanceno, SCAN_INFO sliceinfo, int kyview, float phasefovratio, float rcvphase)</td></tr>
<tr class="separator:a567f7714943a0c78a422ee41defe2acf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a368695617a7edf4fdba05325573efb12"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#a368695617a7edf4fdba05325573efb12">ks_scan_offsetfov3D</a> (<a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a> *readtrap, int instanceno, SCAN_INFO sliceinfo, int kyview, float phasefovratio, int kzview, float zphasefovratio, float rcvphase)</td></tr>
<tr class="separator:a368695617a7edf4fdba05325573efb12"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af21da495bf5fc72d19915129fdcbebe4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#af21da495bf5fc72d19915129fdcbebe4">ks_scan_offsetfov_readwave</a> (<a class="el" href="struct_k_s___r_e_a_d_w_a_v_e.html">KS_READWAVE</a> *readwave, int instanceno, SCAN_INFO sliceinfo, int kyview, float phasefovratio, float rcvphase)</td></tr>
<tr class="separator:af21da495bf5fc72d19915129fdcbebe4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1a51b640b1005f02c4475a1c5f673adb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#a1a51b640b1005f02c4475a1c5f673adb">ks_scan_update_slice_location</a> (SCAN_INFO *new_loc, const SCAN_INFO orig_loc, const <a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a> M_physical, const <a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a> M_logical)</td></tr>
<tr class="separator:a1a51b640b1005f02c4475a1c5f673adb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2fdfe2e655a76c4cd4fb1dac16d1834b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#a2fdfe2e655a76c4cd4fb1dac16d1834b">ks_scan_rotate</a> (SCAN_INFO slice_info)</td></tr>
<tr class="separator:a2fdfe2e655a76c4cd4fb1dac16d1834b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a520240c3153cf9ffe25a7617b2c72149"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#a520240c3153cf9ffe25a7617b2c72149">ks_scan_isirotate</a> (<a class="el" href="struct_k_s___i_s_i_r_o_t.html">KS_ISIROT</a> *isirot)</td></tr>
<tr class="separator:a520240c3153cf9ffe25a7617b2c72149"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa3ed2adea6f1023e3f926978e9a7b856"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#aa3ed2adea6f1023e3f926978e9a7b856">ks_scan_getsliceloc</a> (const <a class="el" href="struct_k_s___s_l_i_c_e___p_l_a_n.html">KS_SLICE_PLAN</a> *slice_plan, int <a class="el" href="ksgre__implementation_8e.html#aae477e374b559bf16a475321797d62cb">passindx</a>, int sltimeinpass)</td></tr>
<tr class="separator:aa3ed2adea6f1023e3f926978e9a7b856"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8fd0ecd6b54b0baaa731127c4520a3dd"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#a8fd0ecd6b54b0baaa731127c4520a3dd">ks_scan_getslicetime</a> (const <a class="el" href="struct_k_s___s_l_i_c_e___p_l_a_n.html">KS_SLICE_PLAN</a> *slice_plan, int <a class="el" href="ksgre__implementation_8e.html#aae477e374b559bf16a475321797d62cb">passindx</a>, int slloc)</td></tr>
<tr class="separator:a8fd0ecd6b54b0baaa731127c4520a3dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a27071ced949f926058771246110c119c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811">ks_enum_epiblipsign</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#a27071ced949f926058771246110c119c">ks_scan_epi_verify_phaseenc_plan</a> (<a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *epi, <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *phaseenc_plan, int shot)</td></tr>
<tr class="separator:a27071ced949f926058771246110c119c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0d83cf730d82612a87abc0f024bea336"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#a0d83cf730d82612a87abc0f024bea336">ks_scan_epi_shotcontrol</a> (<a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *epi, int echo, SCAN_INFO sliceinfo, <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *phaseenc_plan, int shot, float rcvphase)</td></tr>
<tr class="separator:a0d83cf730d82612a87abc0f024bea336"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a27b64905234db826096802c5a1f5bd6e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#a27b64905234db826096802c5a1f5bd6e">ks_scan_epi_loadecho</a> (<a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *epi, int echo, int storeecho, int slice, <a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *phaseenc_plan, int shot)</td></tr>
<tr class="separator:a27b64905234db826096802c5a1f5bd6e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a79ee6cf24d0783fd15699388ece79528"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#a79ee6cf24d0783fd15699388ece79528">ks_scan_acq_to_rtp</a> (<a class="el" href="struct_k_s___r_e_a_d.html">KS_READ</a> *acq, TYPDAB_PACKETS dabacqctrl, float fatoffset)</td></tr>
<tr class="separator:a79ee6cf24d0783fd15699388ece79528"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a17778e7ed4abcb39ee14e9e4d2966b18"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#a17778e7ed4abcb39ee14e9e4d2966b18">boffset</a> (long *offsets)</td></tr>
<tr class="separator:a17778e7ed4abcb39ee14e9e4d2966b18"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a595f599c90a3cb1f300c3c83b5fa116d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#a595f599c90a3cb1f300c3c83b5fa116d">ks_scan_switch_to_sequence</a> (<a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *ctrl)</td></tr>
<tr class="separator:a595f599c90a3cb1f300c3c83b5fa116d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a70f8570a5d1cca01d8d49d9cd34bed79"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#a70f8570a5d1cca01d8d49d9cd34bed79">setssitime</a> (long)</td></tr>
<tr class="separator:a70f8570a5d1cca01d8d49d9cd34bed79"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7a93838e7d53ff7ec9fbe98843181d03"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#a7a93838e7d53ff7ec9fbe98843181d03">startseq</a> (s16, s16)</td></tr>
<tr class="separator:a7a93838e7d53ff7ec9fbe98843181d03"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a02e188307a4bd9dfdb00d37688c0487e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#a02e188307a4bd9dfdb00d37688c0487e">ks_scan_playsequence</a> (<a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *ctrl)</td></tr>
<tr class="separator:a02e188307a4bd9dfdb00d37688c0487e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa4c29e21c8d521ebb578246daeb29178"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#aa4c29e21c8d521ebb578246daeb29178">ks_scan_loaddabwithindices_nex</a> (WF_PULSE_ADDR pulse, LONG slice, LONG echo, LONG <a class="el" href="_g_e_required_8e.html#a1cb6f035a0e9565bbf12c3ef04c3c229">view</a>, uint8_t acq, uint8_t vol, LONG operation, TYPDAB_PACKETS acqon_flag)</td></tr>
<tr class="separator:aa4c29e21c8d521ebb578246daeb29178"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3a09974d212d39bdc19d41b3fb3f1535"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#a3a09974d212d39bdc19d41b3fb3f1535">ks_scan_loaddabwithindices</a> (WF_PULSE_ADDR pulse, LONG slice, LONG echo, LONG <a class="el" href="_g_e_required_8e.html#a1cb6f035a0e9565bbf12c3ef04c3c229">view</a>, uint8_t acq, uint8_t vol, TYPDAB_PACKETS acqon_flag)</td></tr>
<tr class="separator:a3a09974d212d39bdc19d41b3fb3f1535"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a95c41e5b4697083f1c9840f70b157c31"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#a95c41e5b4697083f1c9840f70b157c31">ks_scan_wait_for_rtp</a> (void *rtpmsg, int maxmsgsize, int maxwait, <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *waitctrl)</td></tr>
<tr class="separator:a95c41e5b4697083f1c9840f70b157c31"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d73c466af30e53064824044894067a9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#a8d73c466af30e53064824044894067a9">ks_copy_and_reset_obj</a> (void *pobj)</td></tr>
<tr class="separator:a8d73c466af30e53064824044894067a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ec679c0fb8eb62c1776e67434e25b77"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#a4ec679c0fb8eb62c1776e67434e25b77">ks_tgt_reset_gradrfctrl</a> (<a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html">KS_GRADRFCTRL</a> *gradrfctrl)</td></tr>
<tr class="separator:a4ec679c0fb8eb62c1776e67434e25b77"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa5b257c3f42fff01e0a368d6c60e5919"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#aa5b257c3f42fff01e0a368d6c60e5919">ks_show_clock</a> (FLOAT scantime)</td></tr>
<tr class="separator:aa5b257c3f42fff01e0a368d6c60e5919"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a2875ace95558531062d08465b2bcc282"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a></td></tr>
<tr class="separator:a2875ace95558531062d08465b2bcc282"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af07bb294f9364bf5dc24e6cfca153409"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#af07bb294f9364bf5dc24e6cfca153409">cfreceiveroffsetfreq</a></td></tr>
<tr class="separator:af07bb294f9364bf5dc24e6cfca153409"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adbed7cbe302ef957a49dead6990d286f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#adbed7cbe302ef957a49dead6990d286f">rspent</a></td></tr>
<tr class="separator:adbed7cbe302ef957a49dead6990d286f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae2ab25cb5d89d5b4a1b693e8ad87fd75"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#ae2ab25cb5d89d5b4a1b693e8ad87fd75">pscR1</a></td></tr>
<tr class="separator:ae2ab25cb5d89d5b4a1b693e8ad87fd75"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:addb9fdd9991d3e67d8449a10df030b07"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#addb9fdd9991d3e67d8449a10df030b07">cfcoilswitchmethod</a></td></tr>
<tr class="separator:addb9fdd9991d3e67d8449a10df030b07"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a35c854f1f8f79b61a77569e84e172018"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#a35c854f1f8f79b61a77569e84e172018">cfswgut</a></td></tr>
<tr class="separator:a35c854f1f8f79b61a77569e84e172018"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a49fda6ebed3a78faf1db4fcbfd412de4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#a49fda6ebed3a78faf1db4fcbfd412de4">cfswrfut</a></td></tr>
<tr class="separator:a49fda6ebed3a78faf1db4fcbfd412de4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a327dd261edd2ec61105487e4073cba27"><td class="memItemLeft" align="right" valign="top">long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#a327dd261edd2ec61105487e4073cba27">rsprot</a> [DATA_ACQ_MAX][9]</td></tr>
<tr class="separator:a327dd261edd2ec61105487e4073cba27"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad152641fe076fd7c466bf3eff5d0a13f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#ad152641fe076fd7c466bf3eff5d0a13f">rhasset</a></td></tr>
<tr class="separator:ad152641fe076fd7c466bf3eff5d0a13f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d585d11b35cba1755ed2e74ae864997"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#a3d585d11b35cba1755ed2e74ae864997">cfhwgut</a></td></tr>
<tr class="separator:a3d585d11b35cba1755ed2e74ae864997"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aadbc69c4efac6c7b4d9ed5e6e2124ce3"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#aadbc69c4efac6c7b4d9ed5e6e2124ce3">piviews</a></td></tr>
<tr class="separator:aadbc69c4efac6c7b4d9ed5e6e2124ce3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5df117f51af67768c0a73513fb6b5e71"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#a5df117f51af67768c0a73513fb6b5e71">pitslice</a></td></tr>
<tr class="separator:a5df117f51af67768c0a73513fb6b5e71"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afcd1565ad59c6149ca316adbd09a3328"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_k_s_foundation__tgt_8c.html#afcd1565ad59c6149ca316adbd09a3328">opslicecnt</a></td></tr>
<tr class="separator:afcd1565ad59c6149ca316adbd09a3328"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This file contains functions only accessible on TGT. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a6c406ab72abe3eadd93f7e889e9afd32"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6c406ab72abe3eadd93f7e889e9afd32">&#9670;&nbsp;</a></span>ks_scan_omegawave_hz()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_omegawave_hz </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>instanceno</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>Hz</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Updates a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object on the OMEGA board to produce a frequency offset</h4>
</p>
<p>A <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object on OMEGA can be used to perform a dynamic frequency offset</p><ol type="1">
<li>while an RF pulse is played out. One example is Spectral-Spatial RF pulses</li>
<li>during data acquisition</li>
</ol>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">wave</td><td>Pointer to <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">instanceno</td><td>Instance of <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> to change (<code>INSTRALL</code> changes all instances) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Hz</td><td>Desired frequency offset in [Hz] for the point in the <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> with the largest absolute amplitude </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;                                                                   {</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <span class="keywordtype">int</span> iamp;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  <span class="keywordtype">float</span> omega_scale = 256.0;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  iamp = (int) (Hz / (TARDIS_FREQ_RES * omega_scale));</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  <span class="keywordflow">if</span> (abs(iamp) &gt; 32768) {</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_omegawave_hz(%s): the integer amplitude is too large (%d) for instance %d&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, iamp, instanceno);</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  }</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="keywordflow">if</span> (wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[instanceno].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> != OMEGA) {</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_omegawave_hz(%s): Only omega board is supported&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  }</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <span class="comment">/* input validation */</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <span class="keywordflow">if</span> (instanceno &lt; 0 || instanceno &gt;= wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>) {</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_omegawave_hz(%s): instanceno (%d) out of range [0,%d)&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, instanceno, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>);</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  }</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <span class="keywordflow">if</span> (setiamp((<span class="keywordtype">short</span>) iamp, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[instanceno].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">wf</a>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[instanceno].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">boardinstance</a>) != SUCCESS) {</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_omegawave_hz(%s): An error occurred calling &#39;setiampt()&#39;&quot;</span>, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  }</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <span class="keywordtype">int</span> numplaced = wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="keywordflow">if</span> (!numplaced) {</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  }</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <span class="keywordtype">float</span>* tmp = (<span class="keywordtype">float</span>*)realloc(wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a997cdc9de09fbf7b61842aeb8ad3dfbb">rtscale</a>, numplaced * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  <span class="keywordflow">if</span> (!tmp) {</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: rtscale realloc failed&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  }</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a997cdc9de09fbf7b61842aeb8ad3dfbb">rtscale</a> = tmp;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a997cdc9de09fbf7b61842aeb8ad3dfbb">rtscale</a>[instanceno] = Hz;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;} <span class="comment">/* ks_scan_omegawave_hz */</span></div><div class="ttc" id="struct_k_s___w_a_v_e_html_a997cdc9de09fbf7b61842aeb8ad3dfbb"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a997cdc9de09fbf7b61842aeb8ad3dfbb">KS_WAVE::rtscale</a></div><div class="ttdeci">float * rtscale</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:525</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a42df2e3be0bda47009caae1a7042b522"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">KS_WFINSTANCE::boardinstance</a></div><div class="ttdeci">int boardinstance</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:251</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a72a22b96ff3908d2b9a20a3a02647a2f"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">KS_BASE::ninst</a></div><div class="ttdeci">int ninst</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:261</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a2e3f5254967cadb9a41167c6fbf6743e"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">KS_SEQLOC::board</a></div><div class="ttdeci">int board</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:241</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a15be3edad342a49398ca841c2745dc9e"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">KS_WAVE::wfi</a></div><div class="ttdeci">KS_WFINSTANCE * wfi</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:524</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a78e529e1d86855310035845e03a4c107"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">KS_WFINSTANCE::loc</a></div><div class="ttdeci">KS_SEQLOC loc</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:253</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">KS_WAVE::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:516</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">KS_WAVE::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:515</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a558b0ff480e8db364962bd0f203d6958"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">KS_WFINSTANCE::wf</a></div><div class="ttdeci">WF_PULSE * wf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:252</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a53e38393648beaa5a1d6ed9da63c6875"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a53e38393648beaa5a1d6ed9da63c6875">&#9670;&nbsp;</a></span>ks_scan_omegatrap_hz()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_omegatrap_hz </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> *&#160;</td>
          <td class="paramname"><em>trap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>instanceno</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>Hz</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Updates a <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object on the OMEGA board to produce a frequency offset</h4>
</p>
<p>A <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object on OMEGA is used for rampsampled acquisitions and is placed out using <a class="el" href="_k_s_foundation_8h.html#a21198913d5b1603f03a5e5d61d00408c" title="Places a KS_READTRAP sequence object on a board at some position in the pulse sequence">ks_pg_readtrap()</a> for a <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> object if the field <code>.rampsampling</code> = 1. This will cause a trapezoidal frequency shift during the readout instead of a fixed frequency offset when rampsampling is not used. An error is returned if the current instance of the <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> is on another board than OMEGA</p>
<p>For Cartesian applications, there is no need to call this function directly, since <a class="el" href="_k_s_foundation_8h.html#a11a9b9d761ba64a74b88c222b2a949e3" title="Updates the frequency and phase of one or all instances of a KS_READTRAP to create a FOV shift...">ks_scan_offsetfov()</a> already calls this function</p>
<p>Special note for OMEGA: Neither the <code>.amp</code> field nor the <code>.ampscale</code> field passed in to <a class="el" href="_k_s_foundation_8h.html#a61651c54c4dfd4388fc939d804a9964b" title="Places a KS_TRAP sequence object on a board at some position in the pulse sequence">ks_pg_trap()</a> has an effect. Only the <code>Hz</code> argument controls the frequency shift</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">trap</td><td>Pointer to <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">instanceno</td><td>Instance of <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> to change (<code>INSTRALL</code> changes all instances) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Hz</td><td>Desired frequency offset in [Hz] at the plateau of the trapezoid </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;                                                                  {</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <span class="keywordtype">int</span> iamp;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <span class="keywordtype">float</span> omega_scale = 256.0;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  iamp = (int) (Hz / (TARDIS_FREQ_RES * omega_scale));</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="keywordflow">if</span> (abs(iamp) &gt; 32768) {</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_omegatrap_hz(%s): the integer amplitude is too large (%d) for instance %d&quot;</span>, trp-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, iamp, instanceno);</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  }</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <span class="keywordflow">if</span> (trp-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[instanceno].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> != OMEGA) {</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_omegatrap_hz(%s): Wrong function - use ks_scan_trap_ampscale() KS_TRAPs on XGRAD, YGRAD, ZGRAD&quot;</span>, trp-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  }</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  <span class="comment">/* input validation */</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  <span class="keywordflow">if</span> (instanceno &lt; 0 || instanceno &gt;= trp-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>) {</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_omegatrap_hz(%s): instanceno (%d) out of range [0,%d)&quot;</span>, trp-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, instanceno, trp-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>);</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  }</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  <span class="keywordflow">if</span> (setiampt((<span class="keywordtype">short</span>) iamp, trp-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[instanceno].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">wf</a>, trp-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[instanceno].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">boardinstance</a>) != SUCCESS) {</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_omegatrap_hz(%s): An error occurred calling &#39;setiampt()&#39;&quot;</span>, trp-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  }</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <span class="keywordtype">int</span> numplaced = trp-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <span class="keywordflow">if</span> (!numplaced) {</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  }</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  <span class="keywordtype">float</span>* tmp = (<span class="keywordtype">float</span>*)realloc(trp-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a997cdc9de09fbf7b61842aeb8ad3dfbb">rtscale</a>, numplaced * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <span class="keywordflow">if</span> (!tmp) {</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: rtscale realloc failed&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  }</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  trp-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a997cdc9de09fbf7b61842aeb8ad3dfbb">rtscale</a> = tmp;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  trp-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a997cdc9de09fbf7b61842aeb8ad3dfbb">rtscale</a>[instanceno] = Hz;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;} <span class="comment">/* ks_scan_omegatrap_hz */</span></div><div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a42df2e3be0bda47009caae1a7042b522"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">KS_WFINSTANCE::boardinstance</a></div><div class="ttdeci">int boardinstance</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:251</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">KS_TRAP::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:431</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a72a22b96ff3908d2b9a20a3a02647a2f"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">KS_BASE::ninst</a></div><div class="ttdeci">int ninst</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:261</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a2e3f5254967cadb9a41167c6fbf6743e"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">KS_SEQLOC::board</a></div><div class="ttdeci">int board</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:241</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a15be3edad342a49398ca841c2745dc9e"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">KS_TRAP::wfi</a></div><div class="ttdeci">KS_WFINSTANCE * wfi</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:441</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a78e529e1d86855310035845e03a4c107"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">KS_WFINSTANCE::loc</a></div><div class="ttdeci">KS_SEQLOC loc</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:253</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a558b0ff480e8db364962bd0f203d6958"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">KS_WFINSTANCE::wf</a></div><div class="ttdeci">WF_PULSE * wf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:252</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">KS_TRAP::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:432</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a997cdc9de09fbf7b61842aeb8ad3dfbb"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a997cdc9de09fbf7b61842aeb8ad3dfbb">KS_TRAP::rtscale</a></div><div class="ttdeci">float * rtscale</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:442</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a196a10609c8f75d0ff6d7a520d0b7c27"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a196a10609c8f75d0ff6d7a520d0b7c27">&#9670;&nbsp;</a></span>ks_scan_wait()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_wait </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___w_a_i_t.html">KS_WAIT</a> *&#160;</td>
          <td class="paramname"><em>wait</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>waitperiod</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Updates the wait period of all instances of a <a class="el" href="struct_k_s___w_a_i_t.html" title="Core sequence object that adds wait periods in the pulse sequence (see ks_eval_wait(), ks_pg_wait()). Can be placed on any sequence board">KS_WAIT</a> sequence object. The value of <code>waitperiod</code> must not exceed</h4>
<code>.duration</code>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">wait</td><td>Pointer to <a class="el" href="struct_k_s___w_a_i_t.html" title="Core sequence object that adds wait periods in the pulse sequence (see ks_eval_wait(), ks_pg_wait()). Can be placed on any sequence board">KS_WAIT</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">waitperiod</td><td>Time in [us] to wait </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                                                 {</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  <span class="keywordtype">int</span> numplaced = wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <span class="keywordtype">int</span> numplaced = wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <span class="keywordflow">if</span> (numplaced == 0) {</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  }</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  <span class="comment">/* input validation */</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  <span class="keywordflow">if</span> (waitperiod &lt; 0) {</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_wait(%s): wait period %d is negative&quot;</span>, wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, waitperiod);</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  }</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  <span class="keywordflow">if</span> (waitperiod &lt; GRAD_UPDATE_TIME) {</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    waitperiod = GRAD_UPDATE_TIME;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  }</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  <span class="keywordflow">if</span> (waitperiod % GRAD_UPDATE_TIME) {</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_wait(%s): waitperiod (3rd arg) on gradient boards must be divisible by 4&quot;</span>, wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  }</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <span class="keywordflow">if</span> (wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a15be3edad342a49398ca841c2745dc9e">wfi</a> == NULL) {</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_wait(%s): WF_INSTANCE of trap is NULL&quot;</span>, wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  }</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  <span class="comment">/* set amplitude(s) */</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; numplaced; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="keywordflow">if</span> (setperiod(waitperiod, wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">wf</a>, wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">boardinstance</a>) != SUCCESS) {</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;      <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_wait(%s): An error occurred calling &#39;setperiod()&#39;&quot;</span>, wait-&gt;<a class="code" href="struct_k_s___w_a_i_t.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    }</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  }</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;} <span class="comment">/* ks_scan_wait */</span></div><div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a42df2e3be0bda47009caae1a7042b522"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">KS_WFINSTANCE::boardinstance</a></div><div class="ttdeci">int boardinstance</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:251</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a72a22b96ff3908d2b9a20a3a02647a2f"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">KS_BASE::ninst</a></div><div class="ttdeci">int ninst</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:261</div></div>
<div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="struct_k_s___w_a_i_t_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___w_a_i_t.html#a1c544bec41003a594ba4ec7d43a3a470">KS_WAIT::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:310</div></div>
<div class="ttc" id="struct_k_s___w_a_i_t_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___w_a_i_t.html#a06ab78e08959e925d92935c582469de8">KS_WAIT::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:309</div></div>
<div class="ttc" id="struct_k_s___w_a_i_t_html_a15be3edad342a49398ca841c2745dc9e"><div class="ttname"><a href="struct_k_s___w_a_i_t.html#a15be3edad342a49398ca841c2745dc9e">KS_WAIT::wfi</a></div><div class="ttdeci">KS_WFINSTANCE * wfi</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:314</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a558b0ff480e8db364962bd0f203d6958"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">KS_WFINSTANCE::wf</a></div><div class="ttdeci">WF_PULSE * wf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:252</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a981da87d928a921e5d179e8268b92f1f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a981da87d928a921e5d179e8268b92f1f">&#9670;&nbsp;</a></span>ks_scan_trap_ampscale()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_trap_ampscale </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> *&#160;</td>
          <td class="paramname"><em>trap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>instanceno</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>ampscale</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Updates the amplitude of one or all instances of a <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> sequence object</h4>
</p>
<p>This function multiplies one instance of a <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object with an amplitude scale factor (3rd arg) that should be in range [-1.0,1.0] to avoid slewrate issues. To change all instances of a <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object, use <code>INSTRALL</code> as the 2nd argument.</p>
<p>The actual amplitude for an instance of a <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object is the multiplication of the three factors:</p><ol type="1">
<li>The designed amplitude [G/cm]</li>
<li>The per-instance <code>.ampscale</code> in the <a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> struct passed to <a class="el" href="_k_s_foundation_8h.html#a61651c54c4dfd4388fc939d804a9964b" title="Places a KS_TRAP sequence object on a board at some position in the pulse sequence">ks_pg_trap()</a></li>
<li>The <code>ampscale</code> value passed in as 3rd argument to this function.</li>
</ol>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">trap</td><td>Pointer to <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">instanceno</td><td>Instance of <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> to change (<code>INSTRALL</code> changes all instances) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ampscale</td><td>Gradient amplitude scale factor, normally in range [-1.0,1.0], but the range [-1.2, 1.2] is allowed to allow certain run-time gradient corrections </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                                                                         {</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  <span class="keywordtype">int</span> firstinstance, lastinstance, <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  <span class="keywordtype">int</span> iamp;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  <span class="keywordtype">float</span> gradmax;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <span class="keywordtype">int</span> numplaced = trp-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <span class="keywordtype">int</span> numplaced = trp-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  <span class="keywordflow">if</span> (!numplaced) {</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  }</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  <span class="keywordtype">float</span>* tmp = (<span class="keywordtype">float</span>*)realloc(trp-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a997cdc9de09fbf7b61842aeb8ad3dfbb">rtscale</a>, numplaced * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  <span class="keywordflow">if</span> (!tmp) {</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: rtscale realloc failed&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  }</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  trp-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a997cdc9de09fbf7b61842aeb8ad3dfbb">rtscale</a> = tmp;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  <span class="keywordflow">if</span> (instanceno == INSTRALL) {</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    firstinstance = 0;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    lastinstance = numplaced - 1;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    firstinstance = instanceno;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    lastinstance = instanceno;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  }</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  <span class="comment">/* input validation */</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  <span class="keywordflow">if</span> (numplaced == 0) {</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  }</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <span class="keywordflow">if</span> (firstinstance &lt; 0 || lastinstance &gt;= numplaced) {</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_trap_ampscale(%s): instanceno (%d) out of range [0,%d]&quot;</span>, trp-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, instanceno, numplaced - 1);</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  }</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <span class="comment">/* Allow ampscale to be 20% larger than 1. This, to allow future minor runtime changes of trapezoid amplitudes</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">     for e.g. (future possible implementations):</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">     - oblique ghost correction for EPI, where odd/even blip amps need to be made smaller/larger depending on slice angle and delays</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">     - eddy current correction for DW-EPI, where readout lobe amp needs to be changed per diffusion direction etc.</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">     If &#39;ampscale&#39; is larger than 1.0 (i.e. between 1.0 and 1.2), the trapezoid must have been designed with a slewrate that is slightly</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment">     under the very limit of the system (and the dB/dt limits for PNS). Use with caution. */</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <span class="keywordflow">if</span> (fabs(ampscale) &gt; sqrt(3)) {</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_trap_ampscale(%s): ampscale too large (%f)&quot;</span>, trp-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, ampscale);</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  }</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">    - trp-&gt;amp: The amplitude that was initially designed for the KS_TRAP. Should never be exceeded, or slew rate issues will occur</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment">    - trp-&gt;wfi[i].loc.ampscale: -1.0 -&gt; +1.0. Amp scale factor for each instance of the KS_TRAP placed in the sequence.</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment">    - ampscale (3rd input arg): -1.0 -&gt; +1.0 (in normal cases). The dynamic amp scale (i.e. over time, or TRs).</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">   The product [trp-&gt;wfi[i].loc.ampscale * ampscale] should be in range [-1, 1] to avoid slew rate issues.</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  <span class="keywordflow">if</span> (trp-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">wfi</a> == NULL) {</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_trap_ampscale(%s): WF_INSTANCE of trap is NULL&quot;</span>, trp-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  }</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  <span class="comment">/* set amplitude(s) */</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = firstinstance; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt;= lastinstance; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    gradmax = <a class="code" href="_k_s_foundation_8h.html#aa65115d54842eeffc47a1b324caa62ab">ks_syslimits_gradtarget</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>, trp-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a>);</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    iamp = ((ampscale * trp-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> * trp-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a> / gradmax) * MAX_PG_IAMP);</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <span class="keywordflow">if</span> (abs(iamp) &gt; 32768) {</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_trap_ampscale(%s): the integer amplitude is too large (%d) for instance %d&quot;</span>, trp-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, iamp, <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>);</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    }</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="keywordflow">if</span> (trp-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">board</a> == OMEGA) {</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_trap_ampscale(%s): Instance %d on board OMEGA. Please use ks_scan_omegatrap_hz() instead&quot;</span>, trp-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>);</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    }</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="keywordflow">if</span> (setiampt((<span class="keywordtype">short</span>) iamp, trp-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">wf</a>, trp-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">boardinstance</a>) != SUCCESS) {</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;      <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_trap_ampscale(%s): An error occurred calling &#39;setiampt()&#39;&quot;</span>, trp-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    }</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  }</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = firstinstance; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt;= lastinstance; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    trp-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a997cdc9de09fbf7b61842aeb8ad3dfbb">rtscale</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] = ampscale;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  }</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;} <span class="comment">/* ks_scan_trap_ampscale */</span></div><div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a42df2e3be0bda47009caae1a7042b522"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">KS_WFINSTANCE::boardinstance</a></div><div class="ttdeci">int boardinstance</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:251</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">KS_TRAP::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:431</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a72a22b96ff3908d2b9a20a3a02647a2f"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">KS_BASE::ninst</a></div><div class="ttdeci">int ninst</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:261</div></div>
<div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a2e3f5254967cadb9a41167c6fbf6743e"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a2e3f5254967cadb9a41167c6fbf6743e">KS_SEQLOC::board</a></div><div class="ttdeci">int board</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:241</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aa65115d54842eeffc47a1b324caa62ab"><div class="ttname"><a href="_k_s_foundation_8h.html#aa65115d54842eeffc47a1b324caa62ab">ks_syslimits_gradtarget</a></div><div class="ttdeci">float ks_syslimits_gradtarget(LOG_GRAD loggrd, WF_PROCESSOR board)</div><div class="ttdoc">Returns the maximum target amplitude for a board (internal use)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:176</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a606fbf556e8a297aa1f68b098f6ac2a2"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">KS_SEQLOC::ampscale</a></div><div class="ttdeci">float ampscale</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:243</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a15be3edad342a49398ca841c2745dc9e"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">KS_TRAP::wfi</a></div><div class="ttdeci">KS_WFINSTANCE * wfi</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:441</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a78e529e1d86855310035845e03a4c107"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">KS_WFINSTANCE::loc</a></div><div class="ttdeci">KS_SEQLOC loc</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:253</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ab508ded41392ee86a2a619d3e93d2373"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">KS_TRAP::amp</a></div><div class="ttdeci">float amp</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:433</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a558b0ff480e8db364962bd0f203d6958"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">KS_WFINSTANCE::wf</a></div><div class="ttdeci">WF_PULSE * wf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:252</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">KS_TRAP::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:432</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a997cdc9de09fbf7b61842aeb8ad3dfbb"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a997cdc9de09fbf7b61842aeb8ad3dfbb">KS_TRAP::rtscale</a></div><div class="ttdeci">float * rtscale</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:442</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a097e1c05c128af69e214291a7b611b60"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a097e1c05c128af69e214291a7b611b60">&#9670;&nbsp;</a></span>ks_scan_trap_ampscale_slice()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_trap_ampscale_slice </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___t_r_a_p.html">KS_TRAP</a> *&#160;</td>
          <td class="paramname"><em>trap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>skip</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>count</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>ampscale</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Updates the amplitude of a selection of instances of a <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> sequence object</h4>
</p>
<p>This function multiplies some instances of a <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> object with an amplitude scale factor (5th arg) that should be in range [-1.0,1.0] to avoid slewrate issues.</p>
<p>The instances to change are <code>start + i * skip</code>, where <code>i</code> goes from 0 to <code>count</code>. FAILURE is returned if either start or <code>start</code> + <code>count</code> * <code>skip</code> out of range or <code>count</code> is negative</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">trap</td><td>Pointer to <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">start</td><td>First instance number of the <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">skip</td><td>Difference in instance number between consecutive instances </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">count</td><td>Number of instances to change in total </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ampscale</td><td>Gradient amplitude scale factor, normally in range [-1.0,1.0], but the range [-1.2, 1.2] is allowed to allow certain run-time gradient corrections </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                                                                                               {</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  <span class="keywordtype">int</span> numplaced = trp-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <span class="keywordtype">int</span> numplaced = trp-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <span class="comment">/* check range */</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> end = start + (count - 1) * skip;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <span class="keywordflow">if</span> (start &lt; 0 || start &gt;= numplaced || end &lt; 0 || end &gt;= numplaced || count &lt; 0) {</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_trap_ampscale_slice(%s): slice with start = %d, skip = %d and count = %d has endpoints outside [0,%d)&quot;</span>, trp-&gt;<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, start, skip, count, numplaced);</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  }</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; count; ++<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>) {</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <a class="code" href="_k_s_foundation__tgt_8c.html#a981da87d928a921e5d179e8268b92f1f">ks_scan_trap_ampscale</a>(trp, start + <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> * skip, ampscale);</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  }</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;} <span class="comment">/* ks_scan_trap_ampscale_slice */</span></div><div class="ttc" id="struct_k_s___t_r_a_p_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a06ab78e08959e925d92935c582469de8">KS_TRAP::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:431</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a72a22b96ff3908d2b9a20a3a02647a2f"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">KS_BASE::ninst</a></div><div class="ttdeci">int ninst</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:261</div></div>
<div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">KS_TRAP::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:432</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a981da87d928a921e5d179e8268b92f1f"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a981da87d928a921e5d179e8268b92f1f">ks_scan_trap_ampscale</a></div><div class="ttdeci">void ks_scan_trap_ampscale(KS_TRAP *trp, int instanceno, float ampscale)</div><div class="ttdoc">Updates the amplitude of one or all instances of a KS_TRAP sequence object</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:182</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a183aef5f28e9491f792465e4b6d2b112"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a183aef5f28e9491f792465e4b6d2b112">&#9670;&nbsp;</a></span>ks_scan_phaser_kmove()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_phaser_kmove </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *&#160;</td>
          <td class="paramname"><em>phaser</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>instanceno</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>pixelunits</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Updates the amplitude of a <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> sequence object to move some arbitrary distance in k-space</h4>
</p>
<p>This function sets the amplitude of the gradient for a <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object so that a shift in k-space of <code>pixelunits</code> number of pixels is produced. If <code>pixelunits</code> is 1.0, the gradient area corresponds to one pixel shift in a fully sampled k-space (no parallel imaging) along the board the <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object is placed on. <code>pixelunits</code> is of type <code>float</code> and any non-integer value is accepted, and the sign of <code>pixelunits</code> determines the direction of k-space shift</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">phaser</td><td>Pointer to <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">instanceno</td><td>Instance of <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> to change (<code>INSTRALL</code> changes all instances) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pixelunits</td><td>Non-integer pixel units in a fully sampled k-space to move </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                                                                                {</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  <span class="keywordtype">double</span> phasepixelarea = (double) <a class="code" href="_k_s_foundation_8h.html#aeb07c1278254f0a40622fbbe10566f57">ks_calc_fov2gradareapixel</a>(phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#abfd94a01fc71278021802ca0d1e25e16">fov</a>);</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  <span class="keywordtype">double</span> newarea = pixelunits * phasepixelarea + (double) phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aad774d0423b06e30276673c8100a8ade">areaoffset</a>;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <span class="keywordtype">double</span> ampscale = newarea / phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a97ab43f6fd28920a42d987c8fec4afec">area</a>;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  if (phaser == NULL)</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  <span class="keywordflow">if</span> (fabs(ampscale) &gt; 1.00003) {  <span class="comment">/* 1.00003 corresponds to 32768 / 32767, i.e. excess of one short int */</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="preprocessor">#ifndef IPG</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_phaser_kmove(%s): Too large value (%g) in 3rd arg&quot;</span>, phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, pixelunits);</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fabs(ampscale) &gt; 1.0) {</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="comment">/* small round-off fix when ampscale is in range [1.0, 1.00003] */</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    ampscale = ampscale &lt; 0 ? -1.0 : 1.0;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  }</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  <a class="code" href="_k_s_foundation__tgt_8c.html#a981da87d928a921e5d179e8268b92f1f">ks_scan_trap_ampscale</a>(&amp;phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>, instanceno, ampscale);</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;} <span class="comment">/* ks_scan_phaser_kmove */</span></div><div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">KS_PHASER::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1525</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aeb07c1278254f0a40622fbbe10566f57"><div class="ttname"><a href="_k_s_foundation_8h.html#aeb07c1278254f0a40622fbbe10566f57">ks_calc_fov2gradareapixel</a></div><div class="ttdeci">float ks_calc_fov2gradareapixel(float fov)</div><div class="ttdoc">Calculates the gradient area needed to move one pixel in k-space</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:279</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_aad774d0423b06e30276673c8100a8ade"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#aad774d0423b06e30276673c8100a8ade">KS_PHASER::areaoffset</a></div><div class="ttdeci">float areaoffset</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1531</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a97ab43f6fd28920a42d987c8fec4afec"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a97ab43f6fd28920a42d987c8fec4afec">KS_TRAP::area</a></div><div class="ttdeci">float area</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:434</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">KS_TRAP::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:432</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a981da87d928a921e5d179e8268b92f1f"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a981da87d928a921e5d179e8268b92f1f">ks_scan_trap_ampscale</a></div><div class="ttdeci">void ks_scan_trap_ampscale(KS_TRAP *trp, int instanceno, float ampscale)</div><div class="ttdoc">Updates the amplitude of one or all instances of a KS_TRAP sequence object</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:182</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_abfd94a01fc71278021802ca0d1e25e16"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#abfd94a01fc71278021802ca0d1e25e16">KS_PHASER::fov</a></div><div class="ttdeci">float fov</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1526</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aff91e4da3b6ccabd607ec0da04f774ce"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aff91e4da3b6ccabd607ec0da04f774ce">&#9670;&nbsp;</a></span>ks_scan_phaser_toline()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_phaser_toline </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *&#160;</td>
          <td class="paramname"><em>phaser</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>instanceno</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>view</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Updates the amplitude of a <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> sequence object to move from the k-space center to a desired k-space line</h4>
</p>
<p>This function sets the amplitude of the gradient for a <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object to produce a k-space shift <em>from</em> the center of k-space <em>to</em> the <code>view</code> number (3rd arg). The <code>view</code> number must be an integer in range [0, <code>.res</code>-1], and the number refers to a fully sampled k-space (without parallel imaging)</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">phaser</td><td>Pointer to <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">instanceno</td><td>Instance of <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> to change (<code>INSTRALL</code> changes all instances) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">view</td><td>Phase encoding line to acquire with index corresponding to a fully sampled k-space [0, res-1] </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                                                                        {</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  <span class="keywordtype">double</span> kmax;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  <span class="keywordflow">if</span> (phaser == NULL)</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  <span class="keywordflow">if</span> (view &lt; 0 || view &gt;= phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a>) {</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <a class="code" href="_k_s_foundation__tgt_8c.html#a183aef5f28e9491f792465e4b6d2b112">ks_scan_phaser_kmove</a>(phaser, instanceno, 0.0);</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  }</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  <span class="comment">/* KSFoundation &#39;view&#39; is always 0-based: e.g. res = 256: view = 0-&gt;255. */</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  kmax = ((phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a> - 1.0) / 2.0);</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;  <a class="code" href="_k_s_foundation__tgt_8c.html#a183aef5f28e9491f792465e4b6d2b112">ks_scan_phaser_kmove</a>(phaser, instanceno, kmax - <a class="code" href="_g_e_required_8e.html#a1cb6f035a0e9565bbf12c3ef04c3c229">view</a>);</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;} <span class="comment">/* ks_scan_phaser_toline */</span></div><div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">KS_PHASER::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1527</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a183aef5f28e9491f792465e4b6d2b112"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a183aef5f28e9491f792465e4b6d2b112">ks_scan_phaser_kmove</a></div><div class="ttdeci">void ks_scan_phaser_kmove(KS_PHASER *phaser, int instanceno, double pixelunits)</div><div class="ttdoc">Updates the amplitude of a KS_PHASER sequence object to move some arbitrary distance in k-space...</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:297</div></div>
<div class="ttc" id="_g_e_required_8e_html_a1cb6f035a0e9565bbf12c3ef04c3c229"><div class="ttname"><a href="_g_e_required_8e.html#a1cb6f035a0e9565bbf12c3ef04c3c229">view</a></div><div class="ttdeci">int view</div><div class="ttdef"><b>Definition:</b> GERequired.e:2630</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a81a97893a74af952d90181aa858e709b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a81a97893a74af952d90181aa858e709b">&#9670;&nbsp;</a></span>ks_scan_phaser_fromline()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_phaser_fromline </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *&#160;</td>
          <td class="paramname"><em>phaser</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>instanceno</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>view</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Updates the amplitude of a <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> sequence object to move from a k-space line to the k-space center</h4>
</p>
<p>This function sets the amplitude of the gradient for a <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> object to produce a k-space shift <em>from</em> the <code>view</code> number (3rd arg) <em>to</em> the k-space center. The <code>view</code> number must be an integer in range [0, <code>.res</code>-1], and the number refers to a fully sampled k-space (without parallel imaging)</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">phaser</td><td>Pointer to <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">instanceno</td><td>Instance of <a class="el" href="struct_k_s___t_r_a_p.html" title="Core sequence object for making trapezoids on X,Y,Z, and OMEGA boards">KS_TRAP</a> to change (<code>INSTRALL</code> changes all instances) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">view</td><td>Phase encoding line to acquire with index corresponding to a fully sampled k-space [0, res-1] </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                                                                          {</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  <span class="keywordtype">double</span> kmax;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  <span class="keywordflow">if</span> (phaser == NULL)</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  <span class="keywordflow">if</span> (view &lt; 0 || view &gt;= phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a>) {</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <a class="code" href="_k_s_foundation__tgt_8c.html#a183aef5f28e9491f792465e4b6d2b112">ks_scan_phaser_kmove</a>(phaser, instanceno, 0.0);</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  }</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  <span class="comment">/* KSFoundation &#39;view&#39; is always 0-based: e.g. res = 256: view = 0-&gt;255. */</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  kmax = ((phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a> - 1.0) / 2.0);</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  <a class="code" href="_k_s_foundation__tgt_8c.html#a183aef5f28e9491f792465e4b6d2b112">ks_scan_phaser_kmove</a>(phaser, instanceno, <a class="code" href="_g_e_required_8e.html#a1cb6f035a0e9565bbf12c3ef04c3c229">view</a> - kmax);</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;} <span class="comment">/* ks_scan_phaser_fromline */</span></div><div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">KS_PHASER::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1527</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a183aef5f28e9491f792465e4b6d2b112"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a183aef5f28e9491f792465e4b6d2b112">ks_scan_phaser_kmove</a></div><div class="ttdeci">void ks_scan_phaser_kmove(KS_PHASER *phaser, int instanceno, double pixelunits)</div><div class="ttdoc">Updates the amplitude of a KS_PHASER sequence object to move some arbitrary distance in k-space...</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:297</div></div>
<div class="ttc" id="_g_e_required_8e_html_a1cb6f035a0e9565bbf12c3ef04c3c229"><div class="ttname"><a href="_g_e_required_8e.html#a1cb6f035a0e9565bbf12c3ef04c3c229">view</a></div><div class="ttdeci">int view</div><div class="ttdef"><b>Definition:</b> GERequired.e:2630</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aefb58d645ca29e4cfa68403df396e53f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aefb58d645ca29e4cfa68403df396e53f">&#9670;&nbsp;</a></span>ks_scan_rf_ampscale()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_rf_ampscale </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_f.html">KS_RF</a> *&#160;</td>
          <td class="paramname"><em>rf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>instanceno</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>ampscale</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Changes the amplitude of one or all instances of an RF pulse (<a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a>)</h4>
</p>
<p>This function multiplies one instance of a <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object with an amplitude scale factor (3rd arg) that must be in range [-1.0,1.0]. To change all instances of a <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object, use <code>INSTRALL</code> as the 2nd argument.</p>
<p>The actual flip angle for an instance of a <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> object is the multiplication of the three factors:</p><ol type="1">
<li>The designed flip angle</li>
<li>The per-instance <code>.ampscale</code> in the <a class="el" href="struct_k_s___s_e_q_l_o_c.html" title="typedef struct used as argument to ks_pg_*** functions to control where and when to place a sequence ...">KS_SEQLOC</a> struct passed to <a class="el" href="_k_s_foundation_8h.html#a853cff23395e570cc88aa3405b78c3a9" title="Places a KS_RF sequence object on a board at some position in the pulse sequence">ks_pg_rf()</a></li>
<li>The <code>ampscale</code> value passed in as 3rd argument to this function. Since both ampscale factors are forced to be in range [-1.0,1.0], it is not possible to increase the flip angle beyond the designed value (<code>.flip</code>)</li>
</ol>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">rf</td><td>Pointer to <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">instanceno</td><td>Instance of <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> to change (<code>INSTRALL</code> changes all instances) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ampscale</td><td>RF amplitude scale factor in range [-1.0,1.0] </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                                                                    {</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  <span class="keywordtype">int</span> firstinstance, lastinstance, <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  <span class="keywordtype">int</span> instramp;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  <a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a> *wfi;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  <span class="keywordtype">int</span> numplaced = rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  <span class="keywordtype">int</span> numplaced = rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  <span class="keywordflow">if</span> (!numplaced) {</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  }</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  <span class="keywordtype">float</span>* tmp = (<span class="keywordtype">float</span>*)realloc(rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a997cdc9de09fbf7b61842aeb8ad3dfbb">rtscale</a>, numplaced * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  <span class="keywordflow">if</span> (!tmp) {</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: rtscale realloc failed&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  }</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a997cdc9de09fbf7b61842aeb8ad3dfbb">rtscale</a> = tmp;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  <span class="keywordflow">if</span> (instanceno == INSTRALL) {</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    firstinstance = 0;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    lastinstance = numplaced - 1;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    firstinstance = instanceno;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    lastinstance = instanceno;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  }</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  <span class="comment">/* input validation */</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  <span class="keywordflow">if</span> (numplaced == 0) {</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  }</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  <span class="keywordflow">if</span> (firstinstance &lt; 0 || lastinstance &gt;= numplaced) {</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_rf_ampscale(%s): instanceno (%d) out of range [0,%d]&quot;</span>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, instanceno, numplaced - 1);</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  }</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  <span class="keywordflow">if</span> (fabs(ampscale) &gt; 1.0) {</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_rf_ampscale(%s): ampscale too large (%f)&quot;</span>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, ampscale);</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  }</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;  <span class="comment">/* set amplitude(s) */</span></div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = firstinstance; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt;= lastinstance; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    wfi = &amp;rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>];</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    instramp = rf-&gt;<a class="code" href="struct_k_s___r_f.html#ab508ded41392ee86a2a619d3e93d2373">amp</a> * wfi-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> * ampscale * MAX_PG_IAMP;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    setiamp(instramp, wfi-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">wf</a>, wfi-&gt;<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">boardinstance</a>);</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  } <span class="comment">/* for */</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = firstinstance; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt;= lastinstance; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a997cdc9de09fbf7b61842aeb8ad3dfbb">rtscale</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] = ampscale;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  }</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;} <span class="comment">/* ks_scan_rf_ampscale */</span></div><div class="ttc" id="struct_k_s___w_a_v_e_html_a997cdc9de09fbf7b61842aeb8ad3dfbb"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a997cdc9de09fbf7b61842aeb8ad3dfbb">KS_WAVE::rtscale</a></div><div class="ttdeci">float * rtscale</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:525</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a42df2e3be0bda47009caae1a7042b522"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">KS_WFINSTANCE::boardinstance</a></div><div class="ttdeci">int boardinstance</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:251</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html">KS_WFINSTANCE</a></div><div class="ttdoc">(Internal use) Structure being a part of various sequence objects to sort them in time across boards...</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:250</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a72a22b96ff3908d2b9a20a3a02647a2f"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">KS_BASE::ninst</a></div><div class="ttdeci">int ninst</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:261</div></div>
<div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a606fbf556e8a297aa1f68b098f6ac2a2"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">KS_SEQLOC::ampscale</a></div><div class="ttdeci">float ampscale</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:243</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a15be3edad342a49398ca841c2745dc9e"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">KS_WAVE::wfi</a></div><div class="ttdeci">KS_WFINSTANCE * wfi</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:524</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a78e529e1d86855310035845e03a4c107"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">KS_WFINSTANCE::loc</a></div><div class="ttdeci">KS_SEQLOC loc</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:253</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">KS_WAVE::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:516</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a2a9b610a78cdae3ac8ef682bd34f7e0d"><div class="ttname"><a href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">KS_RF::rfwave</a></div><div class="ttdeci">KS_WAVE rfwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:798</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">KS_WAVE::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:515</div></div>
<div class="ttc" id="struct_k_s___r_f_html_ab508ded41392ee86a2a619d3e93d2373"><div class="ttname"><a href="struct_k_s___r_f.html#ab508ded41392ee86a2a619d3e93d2373">KS_RF::amp</a></div><div class="ttdeci">float amp</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:792</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a558b0ff480e8db364962bd0f203d6958"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">KS_WFINSTANCE::wf</a></div><div class="ttdeci">WF_PULSE * wf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:252</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ada6d1910f42394dc7fb363d85bd6e9c5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ada6d1910f42394dc7fb363d85bd6e9c5">&#9670;&nbsp;</a></span>ks_scan_rf_on()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_rf_on </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_f.html">KS_RF</a> *&#160;</td>
          <td class="paramname"><em>rf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>instanceno</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Resets the amplitude of one or all instances of an RF pulse (<a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a>)</h4>
</p>
<p>This function (re)sets the RF amplitude to the state given by <a class="el" href="_k_s_foundation_8h.html#a853cff23395e570cc88aa3405b78c3a9" title="Places a KS_RF sequence object on a board at some position in the pulse sequence">ks_pg_rf()</a></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">rf</td><td>Pointer to <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">instanceno</td><td>Instance of <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> to change (<code>INSTRALL</code> changes all instances) </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                                              {</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  <a class="code" href="_k_s_foundation__tgt_8c.html#aefb58d645ca29e4cfa68403df396e53f">ks_scan_rf_ampscale</a>(rf, instanceno, 1.0);</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;}</div><div class="ttc" id="_k_s_foundation__tgt_8c_html_aefb58d645ca29e4cfa68403df396e53f"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#aefb58d645ca29e4cfa68403df396e53f">ks_scan_rf_ampscale</a></div><div class="ttdeci">void ks_scan_rf_ampscale(KS_RF *rf, int instanceno, float ampscale)</div><div class="ttdoc">Changes the amplitude of one or all instances of an RF pulse (KS_RF)</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:358</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa67267b854dda4b52334ba189f876bd7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa67267b854dda4b52334ba189f876bd7">&#9670;&nbsp;</a></span>ks_scan_rf_on_chop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_rf_on_chop </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_f.html">KS_RF</a> *&#160;</td>
          <td class="paramname"><em>rf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>instanceno</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Resets the amplitude of one or all instances of an RF pulse (<a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a>) and toggles the sign (chopping)</h4>
</p>
<p>Everytime this function is called, the magnitude of the RF amplitude will be (re)set the RF amplitude to the state given by <a class="el" href="_k_s_foundation_8h.html#a853cff23395e570cc88aa3405b78c3a9" title="Places a KS_RF sequence object on a board at some position in the pulse sequence">ks_pg_rf()</a> and the polarity of the RF amplitude will be changed. If this function is called each TR (RF chopping) for a linear single-line k-space acquisition, a FOV/2 shift will occur in the image with any DC component shifted out to the edges of the image FOV.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">rf</td><td>Pointer to <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">instanceno</td><td>Instance of <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> to change (<code>INSTRALL</code> changes all instances) </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;                                                   {</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">int</span> chopsign = 1.0;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  <a class="code" href="_k_s_foundation__tgt_8c.html#aefb58d645ca29e4cfa68403df396e53f">ks_scan_rf_ampscale</a>(rf, instanceno, (<span class="keywordtype">float</span>) chopsign);</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  chopsign *= -1;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;}</div><div class="ttc" id="_k_s_foundation__tgt_8c_html_aefb58d645ca29e4cfa68403df396e53f"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#aefb58d645ca29e4cfa68403df396e53f">ks_scan_rf_ampscale</a></div><div class="ttdeci">void ks_scan_rf_ampscale(KS_RF *rf, int instanceno, float ampscale)</div><div class="ttdoc">Changes the amplitude of one or all instances of an RF pulse (KS_RF)</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:358</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a99675ab672242a3f37444f01b1246bda"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a99675ab672242a3f37444f01b1246bda">&#9670;&nbsp;</a></span>ks_scan_rf_off()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_rf_off </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_f.html">KS_RF</a> *&#160;</td>
          <td class="paramname"><em>rf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>instanceno</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets the amplitude of one or all instances of an RF pulse (<a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a>) to zero</h4>
</p>
<p>This can be undone by calling <a class="el" href="_k_s_foundation_8h.html#ada6d1910f42394dc7fb363d85bd6e9c5" title="Resets the amplitude of one or all instances of an RF pulse (KS_RF)">ks_scan_rf_on()</a>, <a class="el" href="_k_s_foundation_8h.html#aa67267b854dda4b52334ba189f876bd7" title="Resets the amplitude of one or all instances of an RF pulse (KS_RF) and toggles the sign (chopping)...">ks_scan_rf_on_chop()</a>, or <a class="el" href="_k_s_foundation_8h.html#aefb58d645ca29e4cfa68403df396e53f" title="Changes the amplitude of one or all instances of an RF pulse (KS_RF)">ks_scan_rf_ampscale()</a></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">rf</td><td>Pointer to <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">instanceno</td><td>Instance of <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> to change (<code>INSTRALL</code> changes all instances) </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                                               {</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  <a class="code" href="_k_s_foundation__tgt_8c.html#aefb58d645ca29e4cfa68403df396e53f">ks_scan_rf_ampscale</a>(rf, instanceno, 0.0);</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;}</div><div class="ttc" id="_k_s_foundation__tgt_8c_html_aefb58d645ca29e4cfa68403df396e53f"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#aefb58d645ca29e4cfa68403df396e53f">ks_scan_rf_ampscale</a></div><div class="ttdeci">void ks_scan_rf_ampscale(KS_RF *rf, int instanceno, float ampscale)</div><div class="ttdoc">Changes the amplitude of one or all instances of an RF pulse (KS_RF)</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:358</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="adb1b77a3c2cb4a699081c3ba79ba428c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adb1b77a3c2cb4a699081c3ba79ba428c">&#9670;&nbsp;</a></span>ks_scan_selrf_setfreqphase_pins()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_selrf_setfreqphase_pins </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *&#160;</td>
          <td class="paramname"><em>selrf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>instanceno</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SCAN_INFO&#160;</td>
          <td class="paramname"><em>sliceinfo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sms_multiband_factor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>sms_slice_gap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>rfphase</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Updates the off-center phase-modulation of one or all instances of a PINS RF pulse (<a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a>)</h4>
</p>
<p>This function alters the phase of the PINS RF pulse in a <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> object to excite spatial locations corresponding to the information in <code>sliceinfo.tloc</code>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">selrf</td><td>Pointer to <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">instanceno</td><td>Instance of <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> to change (<code>INSTRALL</code> changes all instances) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sliceinfo</td><td>SCAN_INFO struct for the current slice to be played out </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sms_multiband_factor</td><td></td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sms_slice_gap</td><td>in [mm] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rfphase</td><td>Phase of the RF pulse in [degrees] </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                                                      {</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  <span class="keywordtype">int</span> firstinstance, lastinstance, j;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  <span class="keywordtype">int</span> phaseIndex = 1;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  <a class="code" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> newwave = <a class="code" href="_k_s_foundation_8h.html#ae837f68085b812e9e22a659cc26a42cc">KS_INIT_WAVE</a>;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  <span class="keywordtype">float</span> locOffset;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  <span class="keywordtype">float</span> phaseIncrement;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  <span class="keywordtype">int</span> numplaced = selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>;</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  <span class="keywordtype">int</span> numplaced = selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  <span class="keywordflow">if</span> (instanceno == INSTRALL) {</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    firstinstance = 0;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    lastinstance = numplaced - 1;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    firstinstance = instanceno;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    lastinstance = instanceno;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  }</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  <span class="keywordflow">if</span> (numplaced == 0) {</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  }</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  <span class="keywordflow">if</span> (firstinstance &lt; 0 || lastinstance &gt;= numplaced) {</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_selrf_setfreqphase_pins(%s): instanceno (%d) out of range [0,%d]&quot;</span>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, instanceno, numplaced - 1);</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  }</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  newwave = selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  locOffset = sliceinfo.optloc;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  phaseIncrement = (360.0 / sms_slice_gap) * locOffset;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  <span class="comment">/* If the MB-factor is even, center the slice group */</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  <span class="keywordflow">if</span> (sms_multiband_factor % 2 == 0) {</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    phaseIncrement += 180.0;</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  }</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  <span class="keywordflow">for</span> (j = 0; j &lt; selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>; j++) {</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <span class="keywordflow">if</span> (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[j] != 0) {</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;      newwave.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[j] = selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[j] + ((float)phaseIndex * phaseIncrement) + rfphase;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    }</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <span class="keywordflow">if</span> (j &lt; selrf-&gt;rf.thetawave.res - 1) {</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;      <span class="keywordflow">if</span> ((selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[j] != 0) &amp;&amp; (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>[j + 1] == 0)) {</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        phaseIndex++;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;      }</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    }</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  }</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = firstinstance; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt;= lastinstance; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <span class="comment">/* set RF frequency &amp; phase offset to zero */</span></div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    setfrequency(0.0, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">wf</a>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">boardinstance</a>);</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    setphase(0.0, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">wf</a>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">boardinstance</a>);</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <span class="comment">/* move modified thetawave to hardware */</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <a class="code" href="_k_s_foundation__tgt_8c.html#a2e916337476b7566b3bf033824f964ba">ks_scan_wave2hardware</a>(&amp;selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">thetawave</a>, newwave.<a class="code" href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">waveform</a>);</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  }</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;} <span class="comment">/* ks_scan_selrf_setfreqphase_pins */</span></div><div class="ttc" id="_k_s_foundation__tgt_8c_html_a2e916337476b7566b3bf033824f964ba"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a2e916337476b7566b3bf033824f964ba">ks_scan_wave2hardware</a></div><div class="ttdeci">void ks_scan_wave2hardware(KS_WAVE *wave, const KS_WAVEFORM newwave)</div><div class="ttdoc">Moves a waveform belonging to a KS_WAVE sequence object to hardware</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:694</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a42df2e3be0bda47009caae1a7042b522"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">KS_WFINSTANCE::boardinstance</a></div><div class="ttdeci">int boardinstance</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:251</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html"><div class="ttname"><a href="struct_k_s___w_a_v_e.html">KS_WAVE</a></div><div class="ttdoc">Core sequence object making arbitrary waveforms on any board (using float data format)</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:514</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ae837f68085b812e9e22a659cc26a42cc"><div class="ttname"><a href="_k_s_foundation_8h.html#ae837f68085b812e9e22a659cc26a42cc">KS_INIT_WAVE</a></div><div class="ttdeci">#define KS_INIT_WAVE</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:145</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a72a22b96ff3908d2b9a20a3a02647a2f"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">KS_BASE::ninst</a></div><div class="ttdeci">int ninst</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:261</div></div>
<div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a15be3edad342a49398ca841c2745dc9e"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">KS_WAVE::wfi</a></div><div class="ttdeci">KS_WFINSTANCE * wfi</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:524</div></div>
<div class="ttc" id="struct_k_s___r_f_html_aecd8b68c159a31a28e2a2ec003b593e2"><div class="ttname"><a href="struct_k_s___r_f.html#aecd8b68c159a31a28e2a2ec003b593e2">KS_RF::thetawave</a></div><div class="ttdeci">KS_WAVE thetawave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:800</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_adeab1cc34f1a7f20f41e8825d849981e"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">KS_SELRF::rf</a></div><div class="ttdeci">KS_RF rf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1334</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">KS_WAVE::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:516</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a2a9b610a78cdae3ac8ef682bd34f7e0d"><div class="ttname"><a href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">KS_RF::rfwave</a></div><div class="ttdeci">KS_WAVE rfwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:798</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">KS_WAVE::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:515</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a558b0ff480e8db364962bd0f203d6958"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">KS_WFINSTANCE::wf</a></div><div class="ttdeci">WF_PULSE * wf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:252</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a27640b66342aa92e2fecafb0e8471785"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a27640b66342aa92e2fecafb0e8471785">KS_WAVE::waveform</a></div><div class="ttdeci">KS_WAVEFORM waveform</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:519</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae8766ce800f95dd75ca2eece6638326c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae8766ce800f95dd75ca2eece6638326c">&#9670;&nbsp;</a></span>ks_scan_selrf_setfreqphase()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_selrf_setfreqphase </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_l_r_f.html">KS_SELRF</a> *&#160;</td>
          <td class="paramname"><em>selrf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>instanceno</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SCAN_INFO&#160;</td>
          <td class="paramname"><em>sliceinfo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>rfphase</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Updates the frequency and phase of one or all instances of a slice selective RF pulse (<a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a>)</h4>
</p>
<p>This function alters the frequency of the RF pulse in a <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> object to excite a spatial location corresponding to the information in <code>sliceinfo.tloc</code>. The phase of the RF pulse is also updated</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">selrf</td><td>Pointer to <a class="el" href="struct_k_s___s_e_l_r_f.html" title="Composite sequence object for slice-selective RF">KS_SELRF</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">instanceno</td><td>Instance of <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> to change (<code>INSTRALL</code> changes all instances) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sliceinfo</td><td>SCAN_INFO struct for the current slice to be played out </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rfphase</td><td>Phase of the RF pulse in [degrees] </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                                                                                                       {</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  <span class="keywordtype">int</span> firstinstance, lastinstance;</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;  <span class="keywordtype">float</span> freqoffHz, hertzPerMm, ampscale;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;  <span class="keywordtype">float</span> tloc = sliceinfo.optloc;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;  <span class="keywordtype">int</span> numplaced = selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  <span class="keywordtype">float</span> tloc = 1.0; <span class="comment">/* Simulate offset of 1 mm for plotting in units of [Hz/mm] */</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  <span class="keywordtype">int</span> numplaced = selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;  <span class="keywordflow">if</span> (instanceno == INSTRALL) {</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    firstinstance = 0;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    lastinstance = numplaced - 1;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    firstinstance = instanceno;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    lastinstance = instanceno;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  }</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;  <span class="keywordflow">if</span> (numplaced == 0) {</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  }</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;  <span class="keywordflow">if</span> (firstinstance &lt; 0 || lastinstance &gt;= numplaced) {</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_selrf_setfreqphase(%s): instanceno (%d) out of range [0,%d]&quot;</span>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, instanceno, numplaced - 1);</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  }</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  <span class="comment">/* set frequency */</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = firstinstance; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt;= lastinstance; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  <span class="keywordflow">if</span> (!(i &lt; selrf-&gt;rf.rfwave.base.ngenerated &amp;&amp;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">wf</a>-&gt;wavegen_type == TYPRHO1 &amp;&amp;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">wf</a>-&gt;assoc_pulse-&gt;tag == SSPFREQ)) { <span class="comment">/* make sure it has been set up properly */</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_rf_setfreqphase(%s): RF pulse not properly set up or instance # too high&quot;</span>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;  }</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;  <span class="keywordflow">if</span> (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> &gt; 0) {</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <span class="comment">/* gradwave */</span></div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <span class="keywordflow">if</span> (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a> != NULL) {</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;      ampscale = selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a>;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;      <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_rf_setfreqphase(%s): no gradwave has been set up, setting ampscale = 0&quot;</span>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;      ampscale = 0;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    }</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <span class="comment">/* trapezoid */</span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <span class="keywordflow">if</span> (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">wfi</a> != NULL) {</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;      ampscale = selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a>;</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;      <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_rf_setfreqphase(%s): no grad has been set up, setting ampscale = 0&quot;</span>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>);</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;      ampscale = 0; <span class="comment">/* protect against wfi[i] = NULL, then return 0 amp */</span></div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    }</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;  }</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;  ampscale = (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> &gt; 0) ? selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a89785a274d251fd637bf40923ad5c345">locs</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a></div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                                             : selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a89785a274d251fd637bf40923ad5c345">locs</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a>;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;#endif</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <span class="comment">/* ampscale (a.u.) * GAM [Hz/G] / 10.0 [cm-&gt;mm] * gradamp [G/cm] = [Hz/mm] */</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    hertzPerMm = ampscale * <a class="code" href="_k_s_foundation__tgt_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a> / 10.0 *</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;                 ((selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">gradwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> &gt; 0) ? <a class="code" href="_k_s_foundation_8h.html#a9261718b4f0e64bab0da0b9e9c2c02f0">ks_calc_selgradamp</a>(selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a6b955cde0388e60c3ec5f602072a8e0f">bw</a>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#aa89aa200e4334657ad976733bebcbc2a">slthick</a>) <span class="comment">/* gradwave slice selection */</span></div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;                                             : selrf-&gt;grad.amp); <span class="comment">/* trapezoid slice selection */</span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    freqoffHz = selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#add1e81760153252b7f921b8f9118edb2">cf_offset</a>; <span class="comment">/* [Hz] */</span></div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <span class="comment">/* optloc-dependent freq offset */</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <span class="keywordflow">if</span> (selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a> &gt; 0) {</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;      <a class="code" href="_k_s_foundation__tgt_8c.html#a6c406ab72abe3eadd93f7e889e9afd32">ks_scan_omegawave_hz</a>(&amp;selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">omegawave</a>, <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>, hertzPerMm * tloc <span class="comment">/* [Hz] */</span>);</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;      freqoffHz += hertzPerMm * tloc; <span class="comment">/* [Hz] */</span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    }</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="comment">/* set RF frequency offset */</span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    setfrequency(freqoffHz / TARDIS_FREQ_RES, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">wf</a>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">boardinstance</a>);</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    <span class="comment">/* calculate phase */</span></div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    {</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;      <span class="keywordtype">double</span> ftime_delay;           <span class="comment">/* floating point time delay in seconds */</span></div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;      <span class="keywordtype">double</span> temp_freq;             <span class="comment">/* frequency offset */</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;      <span class="keywordtype">double</span> tmpphase;</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;      <span class="keywordtype">int</span> syncpos, rfstartpos, time_delay;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;      <span class="comment">/* start of RF pulse wave form (for 1st boardinstance) */</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;      rfstartpos = selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">wf</a>-&gt;inst_hdr_tail-&gt;start;</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;      <span class="comment">/* start of RF SSP frq pulse  (for 1st boardinstance) */</span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;      syncpos = selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">wf</a>-&gt;assoc_pulse-&gt;inst_hdr_tail-&gt;start;</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;      <span class="comment">/* time difference between SSP frq and isocenter of RF pulse */</span></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;      time_delay = rfstartpos - syncpos - 9 <span class="comment">/* frq2sync_dly */</span> + RUP_FACTOR(selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> - selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#afa10c3dbec21b5cc34276e741deeb97e">iso2end</a>, 2);</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;      <span class="comment">/*** Modified from GE&#39;s setupphases() ***/</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;      ftime_delay = ((double)time_delay) / ((double) 1.0e6);</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;      temp_freq = (double) freqoffHz;</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;      tmpphase = (rfphase / 360.0 <span class="comment">/* deg-&gt;cycles */</span> - ( temp_freq * ftime_delay )) * 2.0 * PI; <span class="comment">/* radians */</span></div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;      setphase(tmpphase,  selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">wf</a>, selrf-&gt;<a class="code" href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">rf</a>.<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">boardinstance</a>);</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    }</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  } <span class="comment">/* for each instance */</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;} <span class="comment">/* ks_scan_selrf_setfreqphase */</span></div><div class="ttc" id="struct_k_s___s_e_l_r_f_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#af33317a98ade78e3ac252b33cbb794af">KS_SELRF::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1340</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a42df2e3be0bda47009caae1a7042b522"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">KS_WFINSTANCE::boardinstance</a></div><div class="ttdeci">int boardinstance</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:251</div></div>
<div class="ttc" id="struct_k_s___r_f_html_add1e81760153252b7f921b8f9118edb2"><div class="ttname"><a href="struct_k_s___r_f.html#add1e81760153252b7f921b8f9118edb2">KS_RF::cf_offset</a></div><div class="ttdeci">float cf_offset</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:791</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_a607347e9c1c7a9eef21fff556faccc3f"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#a607347e9c1c7a9eef21fff556faccc3f">KS_SELRF::gradwave</a></div><div class="ttdeci">KS_WAVE gradwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1342</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a89785a274d251fd637bf40923ad5c345"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a89785a274d251fd637bf40923ad5c345">KS_WAVE::locs</a></div><div class="ttdeci">KS_SEQLOC locs[KS_MAXINSTANCES]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:522</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a72a22b96ff3908d2b9a20a3a02647a2f"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">KS_BASE::ninst</a></div><div class="ttdeci">int ninst</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:261</div></div>
<div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a606fbf556e8a297aa1f68b098f6ac2a2"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">KS_SEQLOC::ampscale</a></div><div class="ttdeci">float ampscale</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:243</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a15be3edad342a49398ca841c2745dc9e"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">KS_TRAP::wfi</a></div><div class="ttdeci">KS_WFINSTANCE * wfi</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:441</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a15be3edad342a49398ca841c2745dc9e"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">KS_WAVE::wfi</a></div><div class="ttdeci">KS_WFINSTANCE * wfi</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:524</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a78e529e1d86855310035845e03a4c107"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">KS_WFINSTANCE::loc</a></div><div class="ttdeci">KS_SEQLOC loc</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:253</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_adeab1cc34f1a7f20f41e8825d849981e"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#adeab1cc34f1a7f20f41e8825d849981e">KS_SELRF::rf</a></div><div class="ttdeci">KS_RF rf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1334</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">KS_WAVE::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:516</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a6c406ab72abe3eadd93f7e889e9afd32"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a6c406ab72abe3eadd93f7e889e9afd32">ks_scan_omegawave_hz</a></div><div class="ttdeci">void ks_scan_omegawave_hz(KS_WAVE *wave, int instanceno, float Hz)</div><div class="ttdoc">Updates a KS_WAVE object on the OMEGA board to produce a frequency offset</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:40</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a2a9b610a78cdae3ac8ef682bd34f7e0d"><div class="ttname"><a href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">KS_RF::rfwave</a></div><div class="ttdeci">KS_WAVE rfwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:798</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">KS_WAVE::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:515</div></div>
<div class="ttc" id="struct_k_s___r_f_html_afa10c3dbec21b5cc34276e741deeb97e"><div class="ttname"><a href="struct_k_s___r_f.html#afa10c3dbec21b5cc34276e741deeb97e">KS_RF::iso2end</a></div><div class="ttdeci">int iso2end</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:794</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a89785a274d251fd637bf40923ad5c345"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a89785a274d251fd637bf40923ad5c345">KS_TRAP::locs</a></div><div class="ttdeci">KS_SEQLOC locs[KS_MAXINSTANCES]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:439</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a558b0ff480e8db364962bd0f203d6958"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">KS_WFINSTANCE::wf</a></div><div class="ttdeci">WF_PULSE * wf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:252</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a9261718b4f0e64bab0da0b9e9c2c02f0"><div class="ttname"><a href="_k_s_foundation_8h.html#a9261718b4f0e64bab0da0b9e9c2c02f0">ks_calc_selgradamp</a></div><div class="ttdeci">float ks_calc_selgradamp(float rfbw, float slthick)</div><div class="ttdoc">Returns the gradient amplitude in [G/cm] necessary for slice selection (internal use)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:242</div></div>
<div class="ttc" id="struct_k_s___r_f_html_aa283d0a503cfda1c25da9f9b9a0d8b1c"><div class="ttname"><a href="struct_k_s___r_f.html#aa283d0a503cfda1c25da9f9b9a0d8b1c">KS_RF::omegawave</a></div><div class="ttdeci">KS_WAVE omegawave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:799</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a2875ace95558531062d08465b2bcc282"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a></div><div class="ttdeci">float GAM</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_WAVE::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:518</div></div>
<div class="ttc" id="struct_k_s___s_e_l_r_f_html_aa89aa200e4334657ad976733bebcbc2a"><div class="ttname"><a href="struct_k_s___s_e_l_r_f.html#aa89aa200e4334657ad976733bebcbc2a">KS_SELRF::slthick</a></div><div class="ttdeci">float slthick</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1336</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a6b955cde0388e60c3ec5f602072a8e0f"><div class="ttname"><a href="struct_k_s___r_f.html#a6b955cde0388e60c3ec5f602072a8e0f">KS_RF::bw</a></div><div class="ttdeci">float bw</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:790</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="abaf9de92fbb264944d41ef719f5bc438"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abaf9de92fbb264944d41ef719f5bc438">&#9670;&nbsp;</a></span>ks_scan_rf_setphase()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_rf_setphase </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_f.html">KS_RF</a> *&#160;</td>
          <td class="paramname"><em>rf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>instanceno</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>rfphase</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Updates the phase of one or all instances of an RF pulse (<a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a>)</h4>
</p>
<p>This function sets the phase of an RF pulse object (<a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a>). Can be used for RF spoiling</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">rf</td><td>Pointer to KS_SEL </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">instanceno</td><td>Instance of <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> to change (<code>INSTRALL</code> changes all instances) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rfphase</td><td>Phase of the RF pulse in [degrees] </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                                                                     {</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;  <span class="keywordtype">int</span> firstinstance, lastinstance;</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;<span class="preprocessor">  #ifdef IPG</span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    <span class="keywordtype">int</span> numplaced = rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="preprocessor">  #else</span></div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <span class="keywordtype">int</span> numplaced = rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="preprocessor">  #endif</span></div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;  <span class="keywordflow">if</span> (instanceno == INSTRALL) {</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    firstinstance = 0;</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    lastinstance = numplaced - 1;</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    firstinstance = instanceno;</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    lastinstance = instanceno;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;  }</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;  <span class="keywordflow">if</span> (numplaced == 0) {</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;  }</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;  <span class="keywordflow">if</span> (firstinstance &lt; 0 || lastinstance &gt;= numplaced) {</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s(%s): instanceno (%d) out of range [0,%d]&quot;</span>, __FUNCTION__, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, instanceno, numplaced - 1);</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;  }</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;<span class="preprocessor">  #ifdef IPG</span></div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;  <span class="comment">/* set frequency */</span></div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = firstinstance; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt;= lastinstance; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    <span class="comment">/* calculate phase */</span></div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    {</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;      <span class="keywordtype">double</span> ftime_delay;           <span class="comment">/* floating point time delay in seconds */</span></div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;      <span class="keywordtype">double</span> cf_offset = (double) rf-&gt;<a class="code" href="struct_k_s___r_f.html#add1e81760153252b7f921b8f9118edb2">cf_offset</a>;             <span class="comment">/* frequency offset */</span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;      <span class="keywordtype">double</span> tmpphase;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;      <span class="keywordtype">int</span> syncpos, rfstartpos, time_delay;</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;      <span class="comment">/* start of RF pulse wave form (for 1st boardinstance) */</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;      rfstartpos = rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">wf</a>-&gt;inst_hdr_tail-&gt;start;</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;      <span class="comment">/* start of RF SSP frq pulse  (for 1st boardinstance) */</span></div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;      syncpos = rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">wf</a>-&gt;assoc_pulse-&gt;inst_hdr_tail-&gt;start;</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;      <span class="comment">/* time difference between SSP frq and isocenter of RF pulse */</span></div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;      time_delay = rfstartpos - syncpos - 9 <span class="comment">/* frq2sync_dly */</span> + RUP_FACTOR(rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> - rf-&gt;<a class="code" href="struct_k_s___r_f.html#afa10c3dbec21b5cc34276e741deeb97e">iso2end</a>, 2);</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;      <span class="comment">/*** Modified from GE&#39;s setupphases() ***/</span></div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;      ftime_delay = ((double)time_delay) / ((double) 1.0e6);</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;      tmpphase = (rfphase / 360.0 <span class="comment">/* deg-&gt;cycles */</span> - ( cf_offset * ftime_delay )) * 2.0 * PI; <span class="comment">/* radians */</span></div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;      setphase(tmpphase,  rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">wf</a>, rf-&gt;<a class="code" href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">rfwave</a>.<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">boardinstance</a>);</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    }</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;  } <span class="comment">/* for each instance */</span></div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;<span class="preprocessor">  #endif</span></div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;} <span class="comment">/* ks_scan_rf_setphase */</span></div><div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a42df2e3be0bda47009caae1a7042b522"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a42df2e3be0bda47009caae1a7042b522">KS_WFINSTANCE::boardinstance</a></div><div class="ttdeci">int boardinstance</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:251</div></div>
<div class="ttc" id="struct_k_s___r_f_html_add1e81760153252b7f921b8f9118edb2"><div class="ttname"><a href="struct_k_s___r_f.html#add1e81760153252b7f921b8f9118edb2">KS_RF::cf_offset</a></div><div class="ttdeci">float cf_offset</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:791</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a72a22b96ff3908d2b9a20a3a02647a2f"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">KS_BASE::ninst</a></div><div class="ttdeci">int ninst</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:261</div></div>
<div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a15be3edad342a49398ca841c2745dc9e"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">KS_WAVE::wfi</a></div><div class="ttdeci">KS_WFINSTANCE * wfi</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:524</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a1c544bec41003a594ba4ec7d43a3a470">KS_WAVE::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:516</div></div>
<div class="ttc" id="struct_k_s___r_f_html_a2a9b610a78cdae3ac8ef682bd34f7e0d"><div class="ttname"><a href="struct_k_s___r_f.html#a2a9b610a78cdae3ac8ef682bd34f7e0d">KS_RF::rfwave</a></div><div class="ttdeci">KS_WAVE rfwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:798</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">KS_WAVE::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:515</div></div>
<div class="ttc" id="struct_k_s___r_f_html_afa10c3dbec21b5cc34276e741deeb97e"><div class="ttname"><a href="struct_k_s___r_f.html#afa10c3dbec21b5cc34276e741deeb97e">KS_RF::iso2end</a></div><div class="ttdeci">int iso2end</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:794</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a558b0ff480e8db364962bd0f203d6958"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a558b0ff480e8db364962bd0f203d6958">KS_WFINSTANCE::wf</a></div><div class="ttdeci">WF_PULSE * wf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:252</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_WAVE::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:518</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2e916337476b7566b3bf033824f964ba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2e916337476b7566b3bf033824f964ba">&#9670;&nbsp;</a></span>ks_scan_wave2hardware()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_wave2hardware </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___w_a_v_e.html">KS_WAVE</a> *&#160;</td>
          <td class="paramname"><em>wave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#a98d69b5689c184e4f57ab124e726f964">KS_WAVEFORM</a>&#160;</td>
          <td class="paramname"><em>newwave</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Moves a waveform belonging to a <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> sequence object to hardware</h4>
</p>
<p>This function copies a waveform to one of the two hardware waveform buffers (belonging to the <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> object) that is currently not in use for the current sequence playout. The selection of which buffer to update is handled automatically by the function, which will also change the waveform pointer to the updated buffer so it will be used for the next sequence playout</p>
<p>If the 2nd argument (<code>newwave</code>, of type KS_WAVEFORM (float array)) is</p><ol type="1">
<li>not NULL, the content of <code>newwave</code> is used</li>
<li>NULL, it is assumed that the <code>.waveform</code> field of <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> has been updated with new contents and is copied to hardware instead of <code>newwave</code></li>
</ol>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">wave</td><td>Pointer to <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">newwave</td><td>KS_WAVEFORM to copy to hardware (if <code>NULL</code>, the <code>.waveform</code> field in <a class="el" href="struct_k_s___w_a_v_e.html" title="Core sequence object making arbitrary waveforms on any board (using float data format)">KS_WAVE</a> will be used instead) </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;                                                                     {</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#abba996c24da629eea72eecbd9a22a873">KS_IWAVE</a> iwave;</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;  WF_PULSE *wfpulse;</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;  LONG current_wave_ptrs[<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1a6e84527e5ca18e299429a1d00297b47f">KS_WF_SIZE</a>];</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;  LONG wave_ptr;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>,j;</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;  STATUS status;</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;  <span class="keywordtype">int</span> numplaced = wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>;</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  <span class="keywordtype">int</span> numplaced = wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>;</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;  <span class="keywordflow">if</span> (numplaced == 0) {</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;  }</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; 7; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    wfpulse = wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">wfpulse</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>];</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    <span class="keywordflow">if</span> (!wfpulse) {</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    }</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    <span class="keywordflow">if</span> (newwave != NULL) {</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;      <span class="comment">/* use the new float array passed in as 3rd argument */</span></div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;      status = <a class="code" href="_k_s_foundation_8h.html#acce0c0e51575bd8ce71eafcf92e153e0">ks_waveform2iwave</a>(iwave, newwave, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>, <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>);</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;      <span class="comment">/* use the data in the `.waveform` field of the KS_WAVE (1st arg) */</span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;      status = <a class="code" href="_k_s_foundation_8h.html#a016372aaa6f16b986000c56b9792fefd">ks_wave2iwave</a>(iwave, wave, <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>); <span class="comment">/* iwave is waveform memory */</span></div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    }</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    <span class="comment">/* Extract current wave pointers */</span></div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    <span class="keywordflow">for</span> (j = <a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a>; j &lt; <a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1a6e84527e5ca18e299429a1d00297b47f">KS_WF_SIZE</a>; j++) {</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;      getwave(&amp;current_wave_ptrs[j], &amp;wfpulse[j]);</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    }</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <span class="comment">/* Compare the main pointer with the buffers and find wich buffer was used </span></div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;<span class="comment">       last time, then move the new waveform to the other one. Also, get the new pointer. </span></div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;<span class="comment">       movewaveimm might take some time to compute if the wave is long, consider increasing</span></div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;<span class="comment">       the SSI-time if you expericence any problems */</span></div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    <span class="keywordflow">if</span> (current_wave_ptrs[<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a>] == current_wave_ptrs[<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1a976ecf9c65bb6a43d7cb791d681f0adc">KS_WF_BUF2</a>]) {</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;      movewaveimm(iwave, &amp;wfpulse[<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1acc45ff8f1dbeb7cef0129dd595e4031b">KS_WF_BUF1</a>], (<span class="keywordtype">int</span>) 0, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>, TOHARDWARE);</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;      getwave(&amp;wave_ptr, &amp;wfpulse[<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1acc45ff8f1dbeb7cef0129dd595e4031b">KS_WF_BUF1</a>]);</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;      movewaveimm(iwave, &amp;wfpulse[<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1a976ecf9c65bb6a43d7cb791d681f0adc">KS_WF_BUF2</a>], (<span class="keywordtype">int</span>) 0, wave-&gt;<a class="code" href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>, TOHARDWARE);</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;      getwave(&amp;wave_ptr, &amp;wfpulse[<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1a976ecf9c65bb6a43d7cb791d681f0adc">KS_WF_BUF2</a>]);</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    }</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    <span class="comment">/* Make the new pointer the main one */</span></div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    setwave(wave_ptr, &amp;wfpulse[<a class="code" href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a>], -1);</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;  } <span class="comment">/* for */</span></div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;} <span class="comment">/* ks_scan_wave2hardware */</span></div><div class="ttc" id="_k_s_foundation_8h_html_abba996c24da629eea72eecbd9a22a873"><div class="ttname"><a href="_k_s_foundation_8h.html#abba996c24da629eea72eecbd9a22a873">KS_IWAVE</a></div><div class="ttdeci">short KS_IWAVE[KS_MAXWAVELEN]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:180</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ac91cb32048e29f6e58bbf2c1acb8fdf1acc45ff8f1dbeb7cef0129dd595e4031b"><div class="ttname"><a href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1acc45ff8f1dbeb7cef0129dd595e4031b">KS_WF_BUF1</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1754</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a72a22b96ff3908d2b9a20a3a02647a2f"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">KS_BASE::ninst</a></div><div class="ttdeci">int ninst</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:261</div></div>
<div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a9428be182c75f60d1b4e6fe36c888afa"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a9428be182c75f60d1b4e6fe36c888afa">KS_WAVE::wfpulse</a></div><div class="ttdeci">WF_PULSE ** wfpulse</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:523</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a06ab78e08959e925d92935c582469de8">KS_WAVE::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:515</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_acce0c0e51575bd8ce71eafcf92e153e0"><div class="ttname"><a href="_k_s_foundation_8h.html#acce0c0e51575bd8ce71eafcf92e153e0">ks_waveform2iwave</a></div><div class="ttdeci">STATUS ks_waveform2iwave(KS_IWAVE iwave, const KS_WAVEFORM waveform, int res, int board) WARN_UNUSED_RESULT</div><div class="ttdoc">(Internal use) Conversion of a KS_WAVEFORM to a short int array for use on hardware</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1155</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32"><div class="ttname"><a href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1afbb0ca6c8698ca71f9c0cf056a43db32">KS_WF_MAIN</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1754</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ac91cb32048e29f6e58bbf2c1acb8fdf1a6e84527e5ca18e299429a1d00297b47f"><div class="ttname"><a href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1a6e84527e5ca18e299429a1d00297b47f">KS_WF_SIZE</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1754</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a016372aaa6f16b986000c56b9792fefd"><div class="ttname"><a href="_k_s_foundation_8h.html#a016372aaa6f16b986000c56b9792fefd">ks_wave2iwave</a></div><div class="ttdeci">STATUS ks_wave2iwave(KS_IWAVE iwave, const KS_WAVE *wave, int board) WARN_UNUSED_RESULT</div><div class="ttdoc">(Internal use) Conversion of waveform content in a KS_WAVE sequence object to a short int array for u...</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:1177</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_WAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:517</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ac91cb32048e29f6e58bbf2c1acb8fdf1a976ecf9c65bb6a43d7cb791d681f0adc"><div class="ttname"><a href="_k_s_foundation_8h.html#ac91cb32048e29f6e58bbf2c1acb8fdf1a976ecf9c65bb6a43d7cb791d681f0adc">KS_WF_BUF2</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1754</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a27f5cab084726434159934c2b1594eb6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a27f5cab084726434159934c2b1594eb6">&#9670;&nbsp;</a></span>ks_scan_offsetfov_iso()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_offsetfov_iso </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a> *&#160;</td>
          <td class="paramname"><em>readtrap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>instanceno</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SCAN_INFO&#160;</td>
          <td class="paramname"><em>sliceinfo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>ky</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>kz</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>rcvphase</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Updates the frequency and phase to create a FOV shift assuming that the k-space voxels/pixels are isometric</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">readtrap</td><td>Pointer to <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">instanceno</td><td>Instance of <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> to change (<code>INSTRALL</code> changes all instances) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sliceinfo</td><td>SCAN_INFO struct for the current slice to be played out </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ky</td><td>phase offset in k-space measured in voxels/pixels </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">kz</td><td>phase offset in k-space measured in voxels/pixels </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rcvphase</td><td>Receiver phase in [degrees] of the acquisition window corresponding to the <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> and instanceno </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;                                                                                                                              {</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;  <span class="comment">/* Warning: We never have more than one instance (i.e. instruction) per readtrap.echo[i] (see ks_pg_readtrap())</span></div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;<span class="comment">     unlike KS_TRAP and KS_RF. This means that the 2nd input arg here (&#39;instanceno&#39;) means the instanceno&#39;th echo. */</span></div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> numplaced = readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>;</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> halfreadoutdur = ((readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">filt</a>.outputs - 1) * readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">filt</a>.tsp / 2.0) * 1e-6; <span class="comment">/* [s], not [us] */</span></div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> numplaced = readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>;</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;  <span class="keywordtype">int</span> firstreadout, lastreadout;</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;  <span class="keywordflow">if</span> (instanceno == INSTRALL) {</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    firstreadout = 0;</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;    lastreadout = numplaced - 1;</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    firstreadout = instanceno;</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    lastreadout = instanceno;</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;  }</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;  <span class="keywordflow">if</span> (numplaced == 0) {</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;  }</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;  <span class="keywordflow">if</span> (firstreadout &lt; 0 || lastreadout &gt;= numplaced) {</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_offsetfov(%s): readout instance (%d) out of range [0,%d]&quot;</span>, readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, instanceno, numplaced - 1);</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;  }</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = firstreadout; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt;= lastreadout; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    <span class="comment">/* gradient amplitude for this instance -&gt; Hz */</span></div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> mmtoHz = readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a> * readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> * <a class="code" href="_k_s_foundation__tgt_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a> / 10.0; <span class="comment">/* [Hz/mm]. designed amp [G/cm] * instance amp * GAM [Hz/G] / 10.0 [cm-&gt;mm] */</span></div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    <span class="keywordtype">float</span> rloc = sliceinfo.oprloc;</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> mmtoHz = readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a> * readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a89785a274d251fd637bf40923ad5c345">locs</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> * <a class="code" href="_k_s_foundation__tgt_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a> / 10.0;</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    <span class="keywordtype">float</span> rloc = 1;</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    </div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    <span class="comment">/* omega offset for rampsampled cases */</span></div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    <span class="keywordflow">if</span> (readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#abd9ff216626c3fd76322a2a56dc606cc">omega</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> &gt; 0) {</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;      <a class="code" href="_k_s_foundation__tgt_8c.html#a53e38393648beaa5a1d6ed9da63c6875">ks_scan_omegatrap_hz</a>(&amp;readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#abd9ff216626c3fd76322a2a56dc606cc">omega</a>, <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>,  mmtoHz * rloc <span class="comment">/* [Hz] */</span>);</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    }</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> gradsign = (mmtoHz &gt;= 0) ? 1 : -1;</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    <span class="comment">/* Frequency offsets [Hz]:</span></div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;<span class="comment">       - cfreceiveroffsetfreq: GE&#39;s standard frequency offset</span></div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;<span class="comment">       - readtrap-&gt;freqoffHz: Additional frequency offset for current KS_READTRAP. This value is multiplied with the gradient polarity sign</span></div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;<span class="comment">       - mmtoHz * sliceinfo.oprloc: Slice-dependent and gradient polarity dependent frequency offset (when omega is off) */</span></div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> freqoffHz = <a class="code" href="_k_s_foundation__tgt_8c.html#af07bb294f9364bf5dc24e6cfca153409">cfreceiveroffsetfreq</a> + readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a33b2ed586c0bf44c2c8991f0ab1610c8">freqoffHz</a> * gradsign + (readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#abd9ff216626c3fd76322a2a56dc606cc">omega</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> == 0) * (mmtoHz * rloc); <span class="comment">/* [Hz] */</span></div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    <span class="comment">/* set readout frequency offset */</span></div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    <span class="keywordflow">if</span> (i &lt; readtrap-&gt;acq.base.ngenerated &amp;&amp; readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a0e0bae3aa47ae5b8aae488fa0eb920ce">echo</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].tag == SSPDAB) { <span class="comment">/* make sure it has been set up properly */</span></div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;      setfrequency(freqoffHz / TARDIS_FREQ_RES, &amp;readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a0e0bae3aa47ae5b8aae488fa0eb920ce">echo</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>], 0);</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    }</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    <span class="comment">/* set phase offset */</span></div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    <span class="keywordflow">if</span> (i &lt; readtrap-&gt;acq.base.ngenerated &amp;&amp; readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a0e0bae3aa47ae5b8aae488fa0eb920ce">echo</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].tag == SSPDAB) {</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> phase_due_to_freqoffset = 2 * PI * (mmtoHz * rloc) * halfreadoutdur; <span class="comment">/* [rad.] */</span></div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> phase_1ky = -2.0 * PI * sliceinfo.opphasoff / readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#abfd94a01fc71278021802ca0d1e25e16">fov</a>;</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> phase_1kz = -2.0 * PI * sliceinfo.optloc / readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#abfd94a01fc71278021802ca0d1e25e16">fov</a>;</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;      setphase((<span class="keywordtype">float</span>) (phase_1ky * ky + phase_1kz * kz + rcvphase * PI / 180.0 - phase_due_to_freqoffset),  &amp;readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a0e0bae3aa47ae5b8aae488fa0eb920ce">echo</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>], 0);</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    }</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;  } <span class="comment">/* for */</span></div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;} <span class="comment">/* ks_scan_offsetfov_iso */</span></div><div class="ttc" id="struct_k_s___r_e_a_d_html_a0e0bae3aa47ae5b8aae488fa0eb920ce"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a0e0bae3aa47ae5b8aae488fa0eb920ce">KS_READ::echo</a></div><div class="ttdeci">WF_PULSE * echo</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:587</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a53e38393648beaa5a1d6ed9da63c6875"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a53e38393648beaa5a1d6ed9da63c6875">ks_scan_omegatrap_hz</a></div><div class="ttdeci">void ks_scan_omegatrap_hz(KS_TRAP *trp, int instanceno, float Hz)</div><div class="ttdoc">Updates a KS_TRAP object on the OMEGA board to produce a frequency offset</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:88</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a72a22b96ff3908d2b9a20a3a02647a2f"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">KS_BASE::ninst</a></div><div class="ttdeci">int ninst</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:261</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_abfd94a01fc71278021802ca0d1e25e16"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#abfd94a01fc71278021802ca0d1e25e16">KS_READTRAP::fov</a></div><div class="ttdeci">float fov</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1425</div></div>
<div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_af07bb294f9364bf5dc24e6cfca153409"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#af07bb294f9364bf5dc24e6cfca153409">cfreceiveroffsetfreq</a></div><div class="ttdeci">int cfreceiveroffsetfreq</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">KS_READTRAP::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1435</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a606fbf556e8a297aa1f68b098f6ac2a2"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">KS_SEQLOC::ampscale</a></div><div class="ttdeci">float ampscale</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:243</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">KS_READ::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:581</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a15be3edad342a49398ca841c2745dc9e"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a15be3edad342a49398ca841c2745dc9e">KS_TRAP::wfi</a></div><div class="ttdeci">KS_WFINSTANCE * wfi</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:441</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a78e529e1d86855310035845e03a4c107"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">KS_WFINSTANCE::loc</a></div><div class="ttdeci">KS_SEQLOC loc</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:253</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_abd9ff216626c3fd76322a2a56dc606cc"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#abd9ff216626c3fd76322a2a56dc606cc">KS_READTRAP::omega</a></div><div class="ttdeci">KS_TRAP omega</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1436</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ab508ded41392ee86a2a619d3e93d2373"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">KS_TRAP::amp</a></div><div class="ttdeci">float amp</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:433</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a89785a274d251fd637bf40923ad5c345"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a89785a274d251fd637bf40923ad5c345">KS_TRAP::locs</a></div><div class="ttdeci">KS_SEQLOC locs[KS_MAXINSTANCES]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:439</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">KS_TRAP::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:432</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a292f93e48d34cda511fcfb72a05558c2"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">KS_READ::filt</a></div><div class="ttdeci">FILTER_INFO filt</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:585</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_a33b2ed586c0bf44c2c8991f0ab1610c8"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#a33b2ed586c0bf44c2c8991f0ab1610c8">KS_READTRAP::freqoffHz</a></div><div class="ttdeci">float freqoffHz</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1431</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_ac359c54a7c5f9e9a94105b3c0d0be9ea"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">KS_READTRAP::acq</a></div><div class="ttdeci">KS_READ acq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1423</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_TRAP::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:437</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a2875ace95558531062d08465b2bcc282"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a></div><div class="ttdeci">float GAM</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a13039d7727a8f50dd649fb36c9f7d3a6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a13039d7727a8f50dd649fb36c9f7d3a6">&#9670;&nbsp;</a></span>ks_scan_offsetfov_iso_readwave()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_offsetfov_iso_readwave </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_e_a_d_w_a_v_e.html">KS_READWAVE</a> *&#160;</td>
          <td class="paramname"><em>readwave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>instanceno</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SCAN_INFO&#160;</td>
          <td class="paramname"><em>sliceinfo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>ky</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>kz</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>rcvphase</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;                                                                                                                                       {</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;  <span class="comment">/* Warning: We never have more than one instance (i.e. instruction) per readwave.acq.echo[i] (see ks_pg_readwave())</span></div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;<span class="comment">     unlike KS_TRAP and KS_RF. This means that the 2nd input arg here (&#39;instanceno&#39;) means the instanceno&#39;th echo. */</span></div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> numplaced = readwave-&gt;<a class="code" href="struct_k_s___r_e_a_d_w_a_v_e.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>;</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> halfreadoutdur = ((readwave-&gt;<a class="code" href="struct_k_s___r_e_a_d_w_a_v_e.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">filt</a>.outputs - 1) * readwave-&gt;<a class="code" href="struct_k_s___r_e_a_d_w_a_v_e.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">filt</a>.tsp / 2.0) * 1e-6; <span class="comment">/* [s] */</span></div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> numplaced = readwave-&gt;<a class="code" href="struct_k_s___r_e_a_d_w_a_v_e.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>;</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;  <span class="keywordflow">if</span> (numplaced == 0) {</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;  }</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;  <span class="keywordtype">int</span> firstreadout, lastreadout;</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;  <span class="keywordflow">if</span> (instanceno == INSTRALL) {</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    firstreadout = 0;</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    lastreadout = numplaced - 1;</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    firstreadout = instanceno;</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    lastreadout = instanceno;</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;  }</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;  <span class="keywordflow">if</span> (firstreadout &lt; 0 || lastreadout &gt;= numplaced) {</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: readout instance (%d) out of range [0,%d]&quot;</span>, __FUNCTION__, instanceno, numplaced - 1);</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;  }</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">float</span> read_max = <a class="code" href="_k_s_foundation_8h.html#a8309ba456fc3e23a10111a1439b13e21">ks_wave_max</a>(&amp;readwave-&gt;<a class="code" href="struct_k_s___r_e_a_d_w_a_v_e.html#af46823093249b0b88b5091488f8a3c00">grads</a>[0]);</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">float</span> read_min = <a class="code" href="_k_s_foundation_8h.html#adce100a7702e71bfb10377f1652465a2">ks_wave_min</a>(&amp;readwave-&gt;<a class="code" href="struct_k_s___r_e_a_d_w_a_v_e.html#af46823093249b0b88b5091488f8a3c00">grads</a>[0]);</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">float</span> read_amp = read_max &gt; -read_min ? read_max : read_min; <span class="comment">/* Contains sign */</span></div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = firstreadout; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt;= lastreadout; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    <span class="comment">/* gradient amplitude for this instance -&gt; Hz */</span></div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> hertzPerMm = read_amp * readwave-&gt;<a class="code" href="struct_k_s___r_e_a_d_w_a_v_e.html#af46823093249b0b88b5091488f8a3c00">grads</a>[0].<a class="code" href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">wfi</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].<a class="code" href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">loc</a>.<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> * <a class="code" href="_k_s_foundation__tgt_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a> / 10.0; <span class="comment">/* [Hz/mm]. designed amp [G/cm] * instance amp * GAM [Hz/G] / 10.0 [cm-&gt;mm] */</span></div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;    <span class="keywordtype">float</span> rloc = sliceinfo.oprloc;</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> hertzPerMm = read_amp * readwave-&gt;<a class="code" href="struct_k_s___r_e_a_d_w_a_v_e.html#af46823093249b0b88b5091488f8a3c00">grads</a>[0].<a class="code" href="struct_k_s___w_a_v_e.html#a89785a274d251fd637bf40923ad5c345">locs</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].<a class="code" href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">ampscale</a> * <a class="code" href="_k_s_foundation__tgt_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a> / 10.0;</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    <span class="keywordtype">float</span> rloc = 1;</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> gradsign = (hertzPerMm &gt;= 0) ? 1 : -1;</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;    <span class="comment">/* Frequency offsets [Hz]:</span></div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;<span class="comment">       - cfreceiveroffsetfreq: GE&#39;s standard frequency offset</span></div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;<span class="comment">       - readwave-&gt;freqoffHz: Additional frequency offset for current KS_WAVE. This value is multiplied with the gradient polarity sign</span></div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;<span class="comment">       - hertzPerMm * rloc: Slice-dependent and gradient polarity dependent frequency offset (when omega is off) */</span></div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> freqoffHz = <a class="code" href="_k_s_foundation__tgt_8c.html#af07bb294f9364bf5dc24e6cfca153409">cfreceiveroffsetfreq</a> + readwave-&gt;<a class="code" href="struct_k_s___r_e_a_d_w_a_v_e.html#a33b2ed586c0bf44c2c8991f0ab1610c8">freqoffHz</a> * gradsign + (readwave-&gt;<a class="code" href="struct_k_s___r_e_a_d_w_a_v_e.html#a10fcfa13d3ec9e28ea3997e91a7a4284">omega</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> == 0) * (hertzPerMm * rloc); <span class="comment">/* [Hz] */</span></div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    <span class="comment">/* set readout frequency offset */</span></div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    <span class="keywordflow">if</span> (i &lt; readwave-&gt;acq.base.ngenerated &amp;&amp; readwave-&gt;<a class="code" href="struct_k_s___r_e_a_d_w_a_v_e.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a0e0bae3aa47ae5b8aae488fa0eb920ce">echo</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].tag == SSPDAB) {<span class="comment">/* make sure it has been set up properly */</span></div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;      setfrequency(freqoffHz / TARDIS_FREQ_RES, &amp;readwave-&gt;<a class="code" href="struct_k_s___r_e_a_d_w_a_v_e.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a0e0bae3aa47ae5b8aae488fa0eb920ce">echo</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>], 0);</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    }</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    <span class="comment">/* omega offset for rampsampled cases */</span></div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    <span class="keywordflow">if</span> (readwave-&gt;<a class="code" href="struct_k_s___r_e_a_d_w_a_v_e.html#a10fcfa13d3ec9e28ea3997e91a7a4284">omega</a>.<a class="code" href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> &gt; 0) {</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;      <a class="code" href="_k_s_foundation__tgt_8c.html#a6c406ab72abe3eadd93f7e889e9afd32">ks_scan_omegawave_hz</a>(&amp;readwave-&gt;<a class="code" href="struct_k_s___r_e_a_d_w_a_v_e.html#a10fcfa13d3ec9e28ea3997e91a7a4284">omega</a>, <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>,  hertzPerMm * rloc <span class="comment">/* [Hz] */</span>);</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    }</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    <span class="comment">/* set phase offset */</span></div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;    <span class="keywordflow">if</span> (i &lt; readwave-&gt;acq.base.ngenerated &amp;&amp; readwave-&gt;<a class="code" href="struct_k_s___r_e_a_d_w_a_v_e.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a0e0bae3aa47ae5b8aae488fa0eb920ce">echo</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].tag == SSPDAB) {</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> phase_due_to_freqoffset = 2 * PI * (hertzPerMm * rloc) * halfreadoutdur; <span class="comment">/* [rad.] */</span></div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> phase_1ky = -2.0 * PI * sliceinfo.opphasoff / readwave-&gt;<a class="code" href="struct_k_s___r_e_a_d_w_a_v_e.html#abfd94a01fc71278021802ca0d1e25e16">fov</a>;</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> phase_1kz = -2.0 * PI * sliceinfo.optloc / readwave-&gt;<a class="code" href="struct_k_s___r_e_a_d_w_a_v_e.html#abfd94a01fc71278021802ca0d1e25e16">fov</a>;</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;      setphase((<span class="keywordtype">float</span>) (phase_1ky * ky + phase_1kz * kz + rcvphase * PI / 180.0 - phase_due_to_freqoffset),  &amp;readwave-&gt;<a class="code" href="struct_k_s___r_e_a_d_w_a_v_e.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a0e0bae3aa47ae5b8aae488fa0eb920ce">echo</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>], 0);</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    }</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;  } <span class="comment">/* for */</span></div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;} <span class="comment">/* ks_scan_offsetfov_iso_readwave */</span></div><div class="ttc" id="struct_k_s___r_e_a_d_w_a_v_e_html_af46823093249b0b88b5091488f8a3c00"><div class="ttname"><a href="struct_k_s___r_e_a_d_w_a_v_e.html#af46823093249b0b88b5091488f8a3c00">KS_READWAVE::grads</a></div><div class="ttdeci">KS_WAVE grads[3]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1441</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_w_a_v_e_html_abfd94a01fc71278021802ca0d1e25e16"><div class="ttname"><a href="struct_k_s___r_e_a_d_w_a_v_e.html#abfd94a01fc71278021802ca0d1e25e16">KS_READWAVE::fov</a></div><div class="ttdeci">float fov</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1448</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a0e0bae3aa47ae5b8aae488fa0eb920ce"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a0e0bae3aa47ae5b8aae488fa0eb920ce">KS_READ::echo</a></div><div class="ttdeci">WF_PULSE * echo</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:587</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a89785a274d251fd637bf40923ad5c345"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a89785a274d251fd637bf40923ad5c345">KS_WAVE::locs</a></div><div class="ttdeci">KS_SEQLOC locs[KS_MAXINSTANCES]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:522</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a72a22b96ff3908d2b9a20a3a02647a2f"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">KS_BASE::ninst</a></div><div class="ttdeci">int ninst</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:261</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_w_a_v_e_html_a10fcfa13d3ec9e28ea3997e91a7a4284"><div class="ttname"><a href="struct_k_s___r_e_a_d_w_a_v_e.html#a10fcfa13d3ec9e28ea3997e91a7a4284">KS_READWAVE::omega</a></div><div class="ttdeci">KS_WAVE omega</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1442</div></div>
<div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_af07bb294f9364bf5dc24e6cfca153409"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#af07bb294f9364bf5dc24e6cfca153409">cfreceiveroffsetfreq</a></div><div class="ttdeci">int cfreceiveroffsetfreq</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_w_a_v_e_html_a33b2ed586c0bf44c2c8991f0ab1610c8"><div class="ttname"><a href="struct_k_s___r_e_a_d_w_a_v_e.html#a33b2ed586c0bf44c2c8991f0ab1610c8">KS_READWAVE::freqoffHz</a></div><div class="ttdeci">float freqoffHz</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1447</div></div>
<div class="ttc" id="struct_k_s___s_e_q_l_o_c_html_a606fbf556e8a297aa1f68b098f6ac2a2"><div class="ttname"><a href="struct_k_s___s_e_q_l_o_c.html#a606fbf556e8a297aa1f68b098f6ac2a2">KS_SEQLOC::ampscale</a></div><div class="ttdeci">float ampscale</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:243</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">KS_READ::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:581</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_a15be3edad342a49398ca841c2745dc9e"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#a15be3edad342a49398ca841c2745dc9e">KS_WAVE::wfi</a></div><div class="ttdeci">KS_WFINSTANCE * wfi</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:524</div></div>
<div class="ttc" id="struct_k_s___w_f_i_n_s_t_a_n_c_e_html_a78e529e1d86855310035845e03a4c107"><div class="ttname"><a href="struct_k_s___w_f_i_n_s_t_a_n_c_e.html#a78e529e1d86855310035845e03a4c107">KS_WFINSTANCE::loc</a></div><div class="ttdeci">KS_SEQLOC loc</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:253</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a6c406ab72abe3eadd93f7e889e9afd32"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a6c406ab72abe3eadd93f7e889e9afd32">ks_scan_omegawave_hz</a></div><div class="ttdeci">void ks_scan_omegawave_hz(KS_WAVE *wave, int instanceno, float Hz)</div><div class="ttdoc">Updates a KS_WAVE object on the OMEGA board to produce a frequency offset</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:40</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a292f93e48d34cda511fcfb72a05558c2"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">KS_READ::filt</a></div><div class="ttdeci">FILTER_INFO filt</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:585</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a8309ba456fc3e23a10111a1439b13e21"><div class="ttname"><a href="_k_s_foundation_8h.html#a8309ba456fc3e23a10111a1439b13e21">ks_wave_max</a></div><div class="ttdeci">float ks_wave_max(const KS_WAVE *wave)</div><div class="ttdoc">Returns the maximum value in a KS_WAVE sequence object</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:913</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_w_a_v_e_html_ac359c54a7c5f9e9a94105b3c0d0be9ea"><div class="ttname"><a href="struct_k_s___r_e_a_d_w_a_v_e.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">KS_READWAVE::acq</a></div><div class="ttdeci">KS_READ acq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1444</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_adce100a7702e71bfb10377f1652465a2"><div class="ttname"><a href="_k_s_foundation_8h.html#adce100a7702e71bfb10377f1652465a2">ks_wave_min</a></div><div class="ttdeci">float ks_wave_min(const KS_WAVE *wave)</div><div class="ttdoc">Returns the minimum value in a KS_WAVE sequence object</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:939</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a2875ace95558531062d08465b2bcc282"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a2875ace95558531062d08465b2bcc282">GAM</a></div><div class="ttdeci">float GAM</div></div>
<div class="ttc" id="struct_k_s___w_a_v_e_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___w_a_v_e.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_WAVE::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:518</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a567f7714943a0c78a422ee41defe2acf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a567f7714943a0c78a422ee41defe2acf">&#9670;&nbsp;</a></span>ks_scan_offsetfov()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_offsetfov </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a> *&#160;</td>
          <td class="paramname"><em>readtrap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>instanceno</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SCAN_INFO&#160;</td>
          <td class="paramname"><em>sliceinfo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>phasefovratio</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>rcvphase</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Updates the frequency and phase of one or all instances of a <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> to create a FOV shift</h4>
</p>
<p>This function can be used by 2D Cartesian pulse sequences to build up the phase ramp in k-space necessary to shift the image FOV. The desired image FOV shift is given by the SCAN_INFO struct passed in as 3rd argument. The <code>view</code> field and the <code>phasefovratio</code> arguments are necessary to know where in the physical k-space the acquired data is placed. Knowing this and the FOV offset in the phase encoding direction, the necessary receiver phase for the current <code>view</code> can be set. After this function has been called for all <code>view</code> numbers, the necessary phase ramp has been set up in k-space to perform the phase FOV shift in the image domain. The <code>rcvphase</code> is added to the receive phase required for the FOV shift. In general, the <code>rcvphase</code> should be the same as the phase of the RF excitation pulse.</p>
<p>For rampsampled acquisitions (<code>.rampsampling</code> = 1 in <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a>), the <a class="el" href="_k_s_foundation_8h.html#a27f5cab084726434159934c2b1594eb6" title="Updates the frequency and phase to create a FOV shift assuming that the k-space voxels/pixels are iso...">ks_scan_offsetfov_iso()</a> function called will internally call <a class="el" href="_k_s_foundation_8h.html#adbd649762fa938de96662bdc9a721863" title="Updates a KS_TRAP object on the OMEGA board to produce a frequency offset">ks_scan_omegatrap_hz()</a> for FOV shifts in the readout direction. Both <a class="el" href="_k_s_foundation_8h.html#a11a9b9d761ba64a74b88c222b2a949e3" title="Updates the frequency and phase of one or all instances of a KS_READTRAP to create a FOV shift...">ks_scan_offsetfov()</a> and <a class="el" href="_k_s_foundation_8h.html#a368695617a7edf4fdba05325573efb12" title="Updates the frequency and phase of one or all instances of a KS_READTRAP to create a FOV shift...">ks_scan_offsetfov3D()</a> calls the same <a class="el" href="_k_s_foundation_8h.html#a27f5cab084726434159934c2b1594eb6" title="Updates the frequency and phase to create a FOV shift assuming that the k-space voxels/pixels are iso...">ks_scan_offsetfov_iso()</a> function after performing unit conversions of the input arguments.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">readtrap</td><td>Pointer to <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">instanceno</td><td>Instance of <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> to change (<code>INSTRALL</code> changes all instances) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sliceinfo</td><td>SCAN_INFO struct for the current slice to be played out </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">view</td><td>Phase encoding line to acquire with index corresponding to a fully sampled k-space [0, res-1] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">phasefovratio</td><td>The ratio of FOVphase/FOVfreq (as <code>opphasefov</code>) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rcvphase</td><td>Receiver phase in [degrees] of the acquisition window corresponding to the <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> and instanceno </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;                                                                                                                                      {</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> validkyindx = (kyview &gt;= 0);</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> koffset = (double)(validkyindx * kyview) / phasefovratio;</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;  <a class="code" href="_k_s_foundation__tgt_8c.html#a27f5cab084726434159934c2b1594eb6">ks_scan_offsetfov_iso</a>(readtrap, instanceno, sliceinfo, koffset, 0, rcvphase);</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;}</div><div class="ttc" id="_k_s_foundation__tgt_8c_html_a27f5cab084726434159934c2b1594eb6"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a27f5cab084726434159934c2b1594eb6">ks_scan_offsetfov_iso</a></div><div class="ttdeci">void ks_scan_offsetfov_iso(KS_READTRAP *readtrap, int instanceno, SCAN_INFO sliceinfo, double ky, double kz, double rcvphase)</div><div class="ttdoc">Updates the frequency and phase to create a FOV shift assuming that the k-space voxels/pixels are iso...</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:758</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a368695617a7edf4fdba05325573efb12"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a368695617a7edf4fdba05325573efb12">&#9670;&nbsp;</a></span>ks_scan_offsetfov3D()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_offsetfov3D </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a> *&#160;</td>
          <td class="paramname"><em>readtrap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>instanceno</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SCAN_INFO&#160;</td>
          <td class="paramname"><em>sliceinfo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>kyview</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>phasefovratio</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>kzview</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>zphasefovratio</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>rcvphase</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Updates the frequency and phase of one or all instances of a <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> to create a FOV shift</h4>
</p>
<p>This function can be used by 3D Cartesian pulse sequences to build up the phase ramp in k-space necessary to shift the image FOV. The desired image FOV shift is given by the SCAN_INFO struct passed in as 3rd argument. The <code>kyview</code>/<code>kzview</code> field and the <code>phasefovratio</code>/<code>zphasefovratio</code> arguments are necessary to know where in the physical k-space the acquired data is placed. Knowing this and the FOV offset in both phase encoding directions, the necessary receiver phase for the current <code>kyview</code>/<code>kzview</code> can be set. After this function has been called for all <code>kyview</code>/<code>kzview</code> numbers, the necessary phase ramp has been set up in k-space to perform the phase FOV shift in the image domain. The <code>rcvphase</code> is added to the receive phase required for the FOV shift. In general, the <code>rcvphase</code> should be the same as the phase of the RF excitation pulse.</p>
<p>For rampsampled acquisitions (<code>.rampsampling</code> = 1 in <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a>), the <a class="el" href="_k_s_foundation_8h.html#a27f5cab084726434159934c2b1594eb6" title="Updates the frequency and phase to create a FOV shift assuming that the k-space voxels/pixels are iso...">ks_scan_offsetfov_iso()</a> function called will internally call <a class="el" href="_k_s_foundation_8h.html#adbd649762fa938de96662bdc9a721863" title="Updates a KS_TRAP object on the OMEGA board to produce a frequency offset">ks_scan_omegatrap_hz()</a> for FOV shifts in the readout direction. Both <a class="el" href="_k_s_foundation_8h.html#a11a9b9d761ba64a74b88c222b2a949e3" title="Updates the frequency and phase of one or all instances of a KS_READTRAP to create a FOV shift...">ks_scan_offsetfov()</a> and <a class="el" href="_k_s_foundation_8h.html#a368695617a7edf4fdba05325573efb12" title="Updates the frequency and phase of one or all instances of a KS_READTRAP to create a FOV shift...">ks_scan_offsetfov3D()</a> calls the same <a class="el" href="_k_s_foundation_8h.html#a27f5cab084726434159934c2b1594eb6" title="Updates the frequency and phase to create a FOV shift assuming that the k-space voxels/pixels are iso...">ks_scan_offsetfov_iso()</a> function after performing unit conversions of the input arguments.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">readtrap</td><td>Pointer to <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">instanceno</td><td>Instance of <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> to change (<code>INSTRALL</code> changes all instances) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sliceinfo</td><td>SCAN_INFO struct for the current slice to be played out </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">kyview</td><td>Phase encoding line to acquire with index corresponding to a fully sampled k-space [0, res-1] (YGRAD) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">phasefovratio</td><td>The ratio of FOVphase/FOVfreq (as <code>opphasefov</code>) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">kzview</td><td>Z Phase encoding line to acquire with index corresponding to a fully sampled k-space [0, res-1] (ZGRAD) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">zphasefovratio</td><td>The ratio of FOVslice/FOVfreq (as <code>(opslquant * opslthick) / opfov</code>) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rcvphase</td><td>Receiver phase in [degrees] of the acquisition window corresponding to the <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> and instanceno </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;                                                                                                                                                                          {</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> validkyindx = (kyview &gt;= 0);</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> kyoffset = (double)(validkyindx * kyview) / phasefovratio;</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> validkzindx = (kzview &gt;= 0);</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> kzoffset = (double)(validkzindx * kzview) / zphasefovratio;</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;  <a class="code" href="_k_s_foundation__tgt_8c.html#a27f5cab084726434159934c2b1594eb6">ks_scan_offsetfov_iso</a>(readtrap, instanceno, sliceinfo, kyoffset, kzoffset, rcvphase);</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;}</div><div class="ttc" id="_k_s_foundation__tgt_8c_html_a27f5cab084726434159934c2b1594eb6"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a27f5cab084726434159934c2b1594eb6">ks_scan_offsetfov_iso</a></div><div class="ttdeci">void ks_scan_offsetfov_iso(KS_READTRAP *readtrap, int instanceno, SCAN_INFO sliceinfo, double ky, double kz, double rcvphase)</div><div class="ttdoc">Updates the frequency and phase to create a FOV shift assuming that the k-space voxels/pixels are iso...</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:758</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af21da495bf5fc72d19915129fdcbebe4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af21da495bf5fc72d19915129fdcbebe4">&#9670;&nbsp;</a></span>ks_scan_offsetfov_readwave()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_offsetfov_readwave </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_e_a_d_w_a_v_e.html">KS_READWAVE</a> *&#160;</td>
          <td class="paramname"><em>readwave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>instanceno</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SCAN_INFO&#160;</td>
          <td class="paramname"><em>sliceinfo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>kyview</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>phasefovratio</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>rcvphase</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;                                                                                                                                             {</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> validkyindx = (kyview &gt;= 0);</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> koffset = (double)(validkyindx * kyview) / phasefovratio;</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;  <a class="code" href="_k_s_foundation__tgt_8c.html#a13039d7727a8f50dd649fb36c9f7d3a6">ks_scan_offsetfov_iso_readwave</a>(readwave, instanceno, sliceinfo, koffset, 0, rcvphase);</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;}</div><div class="ttc" id="_k_s_foundation__tgt_8c_html_a13039d7727a8f50dd649fb36c9f7d3a6"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a13039d7727a8f50dd649fb36c9f7d3a6">ks_scan_offsetfov_iso_readwave</a></div><div class="ttdeci">void ks_scan_offsetfov_iso_readwave(KS_READWAVE *readwave, int instanceno, SCAN_INFO sliceinfo, double ky, double kz, double rcvphase)</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:829</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1a51b640b1005f02c4475a1c5f673adb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1a51b640b1005f02c4475a1c5f673adb">&#9670;&nbsp;</a></span>ks_scan_update_slice_location()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_update_slice_location </td>
          <td>(</td>
          <td class="paramtype">SCAN_INFO *&#160;</td>
          <td class="paramname"><em>new_loc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const SCAN_INFO&#160;</td>
          <td class="paramname"><em>orig_loc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a>&#160;</td>
          <td class="paramname"><em>M_physical</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a>&#160;</td>
          <td class="paramname"><em>M_logical</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Updates a SCAN_INFO struct using physical and logical 4x4 transformation matrices</h4>
</p>
<p>Updates the slice location &ndash; e.g for motion correction (physical space) or propeller rotations (logical space)</p>
<p>M_physical and M_logical are row-major 4x4 matricies that describe rotations (R_physical, R_logical) and translations (T_physical, T_logical) of the FOV in the physical and logical coordinate systems, respectively. If R_slice and T_slice describe the position of the prescribed FOV contained in orig_loc then new_loc will describe the overall rotation R_new and translation T_new of the FOV such that:</p>
<p><code>R_new = R_physical * R_slice * R_logical</code></p>
<p><code>T_new = R_logical^-1 * (R_slice^-1 * R_physical^-1 * T_physical + T_slice + T_logical)</code></p>
<p>NOTE: All transformations are expected to be active (alibi) that denote a change of position/orientation, not passive (alias) that denote a change of coordinates system. See <a href="https://en.wikipedia.org/wiki/Active_and_passive_transformation">https://en.wikipedia.org/wiki/Active_and_passive_transformation</a></p>
<p>SCAN_INFO is defined in $ESE_TOP/psd/include/epic_geometry_types.h and the global <code>scan_info</code> variable is an array of SCAN_INFO structs holding information of the graphically prescribed slices</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">new_loc</td><td>Pointer to a SCAN_INFO struct holding the new slice information </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">orig_loc</td><td>SCAN_INFO struct holding the original slice information </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">M_physical</td><td>Transformation matrix (4x4) in the physical space </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">M_logical</td><td>Transformation matrix (4x4) in the logical (i.e. XGRAD, YGRAD, ZGRAD) space </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;                                                                                                                                        {</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a> R_m;</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a> R_l;</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a> R_ms;</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a> R_msl;</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> T_s[3] = {orig_loc.oprloc, orig_loc.opphasoff, orig_loc.optloc};</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;  <span class="keywordtype">double</span> T_m[3];</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;  <span class="keywordtype">double</span> T_l[3];</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;  <span class="keywordtype">double</span> T_msl[3];</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;  <span class="keywordtype">double</span> T_new[3];</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;  <span class="comment">/* initialize to identity matrix (will be used if NULL in 3rd or 4th arg) */</span></div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a> Mphys = <a class="code" href="_k_s_foundation_8h.html#afdbaf673741ec0d6d5ebb7ab5974338e">KS_MAT4x4_IDENTITY</a>;</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a> Mlog = <a class="code" href="_k_s_foundation_8h.html#afdbaf673741ec0d6d5ebb7ab5974338e">KS_MAT4x4_IDENTITY</a>;</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;  <span class="comment">/* copy slice rotation and translation */</span></div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a> R_s;</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; 9; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;    R_s[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] = orig_loc.oprot[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>];</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;  }</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;  <span class="comment">/* copy transformation matrices (if they are not NULL) to local matrices */</span></div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;  <span class="keywordflow">if</span> (M_physical != NULL) {</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    memcpy(Mphys, M_physical, <span class="keyword">sizeof</span>(<a class="code" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a>));</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;  }</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;  <span class="keywordflow">if</span> (M_logical != NULL) {</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    memcpy(Mlog, M_logical, <span class="keyword">sizeof</span>(<a class="code" href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a>));</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;  }</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#ace371e00b197f1e2810b8d113b367266">ks_mat4_extractrotation</a>(R_m, Mphys);</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#ace371e00b197f1e2810b8d113b367266">ks_mat4_extractrotation</a>(R_l, Mlog);</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a5367cf93c8126b5e1ebe7af1455bd12f">ks_mat4_extracttranslation</a>(T_m, Mphys);</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a5367cf93c8126b5e1ebe7af1455bd12f">ks_mat4_extracttranslation</a>(T_l, Mlog);</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;  <span class="comment">/* R_ms = R_m * R_s */</span></div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#aef9748ef561f24658a823f99823bf9f3">ks_mat3_multiply</a>(R_ms, R_m, R_s);</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;  <span class="comment">/* R_ms^-1 * T_m = T_m&#39; * R_ms&#39; */</span></div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a22ac65cbd45dee4eec9f4f2612af92a8">ks_mat3_invapply</a>(T_msl, R_ms, T_m);</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; 3; ++<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>) {</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    T_msl[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] += T_s[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] + T_l[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>];</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;  }</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a22ac65cbd45dee4eec9f4f2612af92a8">ks_mat3_invapply</a>(T_new, R_l, T_msl);</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;  new_loc-&gt;oprloc = T_new[0];</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;  new_loc-&gt;opphasoff = T_new[1];</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;  new_loc-&gt;optloc = T_new[2];</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#aef9748ef561f24658a823f99823bf9f3">ks_mat3_multiply</a>(R_msl, R_ms, R_l);</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>=0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>&lt;9; ++<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>) {</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    new_loc-&gt;oprot[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] = R_msl[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>];</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;  }</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;} <span class="comment">/* ks_scan_update_slice_location */</span></div><div class="ttc" id="_k_s_foundation_8h_html_aef9748ef561f24658a823f99823bf9f3"><div class="ttname"><a href="_k_s_foundation_8h.html#aef9748ef561f24658a823f99823bf9f3">ks_mat3_multiply</a></div><div class="ttdeci">void ks_mat3_multiply(KS_MAT3x3 lhs, const KS_MAT3x3 rhs_left, const KS_MAT3x3 rhs_right)</div><div class="ttdoc">Multiplication of two 3x3 matrices</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2888</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a7b8e8b52358de55dd1fb64ef924b2f48"><div class="ttname"><a href="_k_s_foundation_8h.html#a7b8e8b52358de55dd1fb64ef924b2f48">KS_MAT4x4</a></div><div class="ttdeci">double KS_MAT4x4[16]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:182</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ace371e00b197f1e2810b8d113b367266"><div class="ttname"><a href="_k_s_foundation_8h.html#ace371e00b197f1e2810b8d113b367266">ks_mat4_extractrotation</a></div><div class="ttdeci">void ks_mat4_extractrotation(KS_MAT3x3 R, const KS_MAT4x4 M)</div><div class="ttdoc">Extract a 3x3 rotation matrix from a 4x4 transformation matrix</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2861</div></div>
<div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aeecaa16a2b55b6aa37e125536b565657"><div class="ttname"><a href="_k_s_foundation_8h.html#aeecaa16a2b55b6aa37e125536b565657">KS_MAT3x3</a></div><div class="ttdeci">double KS_MAT3x3[9]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:181</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_afdbaf673741ec0d6d5ebb7ab5974338e"><div class="ttname"><a href="_k_s_foundation_8h.html#afdbaf673741ec0d6d5ebb7ab5974338e">KS_MAT4x4_IDENTITY</a></div><div class="ttdeci">#define KS_MAT4x4_IDENTITY</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:173</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a5367cf93c8126b5e1ebe7af1455bd12f"><div class="ttname"><a href="_k_s_foundation_8h.html#a5367cf93c8126b5e1ebe7af1455bd12f">ks_mat4_extracttranslation</a></div><div class="ttdeci">void ks_mat4_extracttranslation(double *T, const KS_MAT4x4 M)</div><div class="ttdoc">Extract a 3 element array with translations from a 4x4 transformation matrix</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2870</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a22ac65cbd45dee4eec9f4f2612af92a8"><div class="ttname"><a href="_k_s_foundation_8h.html#a22ac65cbd45dee4eec9f4f2612af92a8">ks_mat3_invapply</a></div><div class="ttdeci">void ks_mat3_invapply(double *w, const KS_MAT3x3 R, const double *v)</div><div class="ttdoc">Rotate a 3x1 vector by the inverse of 3x3 rotation matrix (alias)</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:2923</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2fdfe2e655a76c4cd4fb1dac16d1834b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2fdfe2e655a76c4cd4fb1dac16d1834b">&#9670;&nbsp;</a></span>ks_scan_rotate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_rotate </td>
          <td>(</td>
          <td class="paramtype">SCAN_INFO&#160;</td>
          <td class="paramname"><em>slice_info</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Performs a rotation of the logical system on hardware (WARP)</h4>
</p>
<p>The field <code>.oprot</code> (9-element array) in the SCAN_INFO struct holds the rotation matrix that should be played out</p>
<p>This function performs the necessary scaling of the rotation matrix using <code>loggrd</code> and <code>phygrd</code> and then calls <code>setrotatearray()</code>, which performs the actual rotation on hardware during the next SSI time.</p>
<p>See <a class="el" href="_k_s_foundation_8h.html#a1a51b640b1005f02c4475a1c5f673adb" title="Updates a SCAN_INFO struct using physical and logical 4x4 transformation matrices">ks_scan_update_slice_location()</a> for detail on how to create new SCAN_INFO structs in run-time</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">slice_info</td><td>SCAN_INFO struct holding new slice information </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;                                          {</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;  <span class="comment">/* scale to long int rotation matrix (accounting for gradient scaling) */</span></div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;  scale(&amp;slice_info.oprot, &amp;<a class="code" href="_k_s_foundation__tgt_8c.html#a327dd261edd2ec61105487e4073cba27">rsprot</a>[0], 1, &amp;<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>, &amp;<a class="code" href="_k_s_foundation_8h.html#af51ba165cbaf874219789beaa48f2464">phygrd</a>, 0);</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;  setrotatearray(1, <a class="code" href="_k_s_foundation__tgt_8c.html#a327dd261edd2ec61105487e4073cba27">rsprot</a>[0]);</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_af51ba165cbaf874219789beaa48f2464"><div class="ttname"><a href="_k_s_foundation_8h.html#af51ba165cbaf874219789beaa48f2464">phygrd</a></div><div class="ttdeci">PHYS_GRAD phygrd</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a327dd261edd2ec61105487e4073cba27"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a327dd261edd2ec61105487e4073cba27">rsprot</a></div><div class="ttdeci">long rsprot[DATA_ACQ_MAX][9]</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a520240c3153cf9ffe25a7617b2c72149"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a520240c3153cf9ffe25a7617b2c72149">&#9670;&nbsp;</a></span>ks_scan_isirotate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_isirotate </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___i_s_i_r_o_t.html">KS_ISIROT</a> *&#160;</td>
          <td class="paramname"><em>isirot</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Performs an immediate rotation of the logical system on hardware (WARP)</h4>
</p>
<p>This function needs a psd-specific wrapper function to execute (see <a class="el" href="_k_s_foundation_8h.html#a67d0db25c6c69ee17a9b4b0ee79b7fb7" title="Places out an intersequence interrupt at a specific time in the sequence module">ks_pg_isirot()</a>) since the ISI interupt routine is calling a void function without input arguments. This psd-specific wrapper function should only contain the call to <a class="el" href="_k_s_foundation_8h.html#a520240c3153cf9ffe25a7617b2c72149" title="Performs an immediate rotation of the logical system on hardware (WARP)">ks_scan_isirotate()</a> with the psd-specific <a class="el" href="struct_k_s___i_s_i_r_o_t.html" title="Struct for in-sequence rotations using ISI vector interupts">KS_ISIROT</a> set up in <a class="el" href="ksepi_8e.html#a9229731c099971b90dbf7721bad586a9">pulsegen()</a>.</p>
<p>For N number of calls to <a class="el" href="_k_s_foundation_8h.html#a67d0db25c6c69ee17a9b4b0ee79b7fb7" title="Places out an intersequence interrupt at a specific time in the sequence module">ks_pg_isirot()</a> in the sequence module's pg-function, the field <code>isirot.numinstances</code> will be set to N, and this many ISI interrupt with a corresponding <code>isirot.isinumber</code> exist in the sequence module. Valid ISI numbers are 4-7, and one available number should be linked to one specific wrapper function using <a class="el" href="_k_s_foundation_8h.html#a1d053f6867254f3b3acfc0589e490b5f" title="Sets up a KS_ISIROT object to be used for real-time coordinate rotations">ks_eval_isirot()</a> and <a class="el" href="_k_s_foundation_8h.html#a67d0db25c6c69ee17a9b4b0ee79b7fb7" title="Places out an intersequence interrupt at a specific time in the sequence module">ks_pg_isirot()</a>.</p>
<p>In real-time, <a class="el" href="_k_s_foundation_8h.html#a520240c3153cf9ffe25a7617b2c72149" title="Performs an immediate rotation of the logical system on hardware (WARP)">ks_scan_isirotate()</a> will increment the <code>isirot.counter</code> field by 1 and restart at 0 after <code>isirot-&gt;numinstances</code>. <code>isirot.counter</code> is set to 0 in <a class="el" href="_k_s_foundation_8h.html#a67d0db25c6c69ee17a9b4b0ee79b7fb7" title="Places out an intersequence interrupt at a specific time in the sequence module">ks_pg_isirot()</a>. Based on the value of the <code>.counter</code> field, it will assign a pre-stored SCAN_INFO struct corresponding to this counter value. Again, this connection is done by <a class="el" href="_k_s_foundation_8h.html#a67d0db25c6c69ee17a9b4b0ee79b7fb7" title="Places out an intersequence interrupt at a specific time in the sequence module">ks_pg_isirot()</a>.</p>
<p><a class="el" href="_k_s_foundation_8h.html#a520240c3153cf9ffe25a7617b2c72149" title="Performs an immediate rotation of the logical system on hardware (WARP)">ks_scan_isirotate()</a> takes the current SCAN_INFO and converts it to long int, and then calls setrotateimm(..., WARP_UPDATE_ON_SSP_INT);</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">isirot</td><td>Pointer to the <a class="el" href="struct_k_s___i_s_i_r_o_t.html" title="Struct for in-sequence rotations using ISI vector interupts">KS_ISIROT</a> struct set up by <a class="el" href="_k_s_foundation_8h.html#a67d0db25c6c69ee17a9b4b0ee79b7fb7" title="Places out an intersequence interrupt at a specific time in the sequence module">ks_pg_isirot()</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;                                          {</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;  <span class="keywordflow">if</span> (isirot == NULL || isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#aa571b5a96556f71c84be339d2e9193b4">numinstances</a> &lt; 1)</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;  <span class="comment">/* wrap around after numinstances interupts */</span></div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;  isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#a617a47c70795bcff659815ad0efd2266">counter</a> = isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#a617a47c70795bcff659815ad0efd2266">counter</a> % isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#aa571b5a96556f71c84be339d2e9193b4">numinstances</a>;</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;  <span class="comment">/* scale to long int rotation matrix (accounting for gradient scaling) */</span></div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;  scale(&amp;isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#a401a138c899d31df5f63f1971febe233">scan_info</a>[isirot-&gt;<a class="code" href="struct_k_s___i_s_i_r_o_t.html#a617a47c70795bcff659815ad0efd2266">counter</a>++].oprot, &amp;<a class="code" href="_k_s_foundation__tgt_8c.html#a327dd261edd2ec61105487e4073cba27">rsprot</a>[0], 1, &amp;<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>, &amp;<a class="code" href="_k_s_foundation_8h.html#af51ba165cbaf874219789beaa48f2464">phygrd</a>, 0);</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;  <span class="comment">/* rotate on SSP interrupt */</span></div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;  setrotateimm(<a class="code" href="_k_s_foundation__tgt_8c.html#a327dd261edd2ec61105487e4073cba27">rsprot</a>[0], WARP_UPDATE_ON_SSP_INT);</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;}</div><div class="ttc" id="struct_k_s___i_s_i_r_o_t_html_a401a138c899d31df5f63f1971febe233"><div class="ttname"><a href="struct_k_s___i_s_i_r_o_t.html#a401a138c899d31df5f63f1971febe233">KS_ISIROT::scan_info</a></div><div class="ttdeci">SCAN_INFO * scan_info</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:324</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_af51ba165cbaf874219789beaa48f2464"><div class="ttname"><a href="_k_s_foundation_8h.html#af51ba165cbaf874219789beaa48f2464">phygrd</a></div><div class="ttdeci">PHYS_GRAD phygrd</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a327dd261edd2ec61105487e4073cba27"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a327dd261edd2ec61105487e4073cba27">rsprot</a></div><div class="ttdeci">long rsprot[DATA_ACQ_MAX][9]</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
<div class="ttc" id="struct_k_s___i_s_i_r_o_t_html_a617a47c70795bcff659815ad0efd2266"><div class="ttname"><a href="struct_k_s___i_s_i_r_o_t.html#a617a47c70795bcff659815ad0efd2266">KS_ISIROT::counter</a></div><div class="ttdeci">int counter</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:327</div></div>
<div class="ttc" id="struct_k_s___i_s_i_r_o_t_html_aa571b5a96556f71c84be339d2e9193b4"><div class="ttname"><a href="struct_k_s___i_s_i_r_o_t.html#aa571b5a96556f71c84be339d2e9193b4">KS_ISIROT::numinstances</a></div><div class="ttdeci">int numinstances</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:328</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa3ed2adea6f1023e3f926978e9a7b856"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa3ed2adea6f1023e3f926978e9a7b856">&#9670;&nbsp;</a></span>ks_scan_getsliceloc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_scan_getsliceloc </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_k_s___s_l_i_c_e___p_l_a_n.html">KS_SLICE_PLAN</a> *&#160;</td>
          <td class="paramname"><em>slice_plan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>passindx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sltimeinpass</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the spatially sorted slice index from a DATA_ACQ_ORDER struct array</h4>
</p>
<p>This function finds the spatially sorted slice index (<code>.slloc</code>) in range [0, nslices-1] given the sequence's DATA_ACQ_ORDER struct array (in slice_plan.acq_order)</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">slice_plan</td><td>Pointer to the slice plan (<a class="el" href="struct_k_s___s_l_i_c_e___p_l_a_n.html" title="Struct holding all information about slice locations and aquisition order">KS_SLICE_PLAN</a>) for the sequence </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">passindx</td><td>Current pass index ([0, acqs-1]) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sltimeinpass</td><td>Temporal index of the <code>n</code> slices acquired in each pass ([0, n-1]) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">slloc</td><td>Spatially sorted slice index </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;                                                                                         {</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; slice_plan-&gt;<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a3414dc896f1276457707d70318d46770">nslices</a>; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;    <span class="keywordflow">if</span> (slice_plan-&gt;<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#af6c9bb6611e03718085512d2c90cfcd8">acq_order</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].slpass == <a class="code" href="ksfse__implementation_8e.html#aae477e374b559bf16a475321797d62cb">passindx</a> &amp;&amp; slice_plan-&gt;<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#af6c9bb6611e03718085512d2c90cfcd8">acq_order</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].sltime == sltimeinpass) {</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;      <span class="keywordflow">return</span> slice_plan-&gt;<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#af6c9bb6611e03718085512d2c90cfcd8">acq_order</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].slloc;</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;    }</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;  }</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>;</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;}</div><div class="ttc" id="struct_k_s___s_l_i_c_e___p_l_a_n_html_af6c9bb6611e03718085512d2c90cfcd8"><div class="ttname"><a href="struct_k_s___s_l_i_c_e___p_l_a_n.html#af6c9bb6611e03718085512d2c90cfcd8">KS_SLICE_PLAN::acq_order</a></div><div class="ttdeci">DATA_ACQ_ORDER acq_order[SLICE_FACTOR *DATA_ACQ_MAX]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1203</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_afd953f31b866a09e0418967c2bf65a59"><div class="ttname"><a href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a></div><div class="ttdeci">#define KS_NOTSET</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:60</div></div>
<div class="ttc" id="ksfse__implementation_8e_html_aae477e374b559bf16a475321797d62cb"><div class="ttname"><a href="ksfse__implementation_8e.html#aae477e374b559bf16a475321797d62cb">passindx</a></div><div class="ttdeci">int passindx</div><div class="ttdef"><b>Definition:</b> ksfse_implementation.e:2829</div></div>
<div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="struct_k_s___s_l_i_c_e___p_l_a_n_html_a3414dc896f1276457707d70318d46770"><div class="ttname"><a href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a3414dc896f1276457707d70318d46770">KS_SLICE_PLAN::nslices</a></div><div class="ttdeci">int nslices</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1200</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8fd0ecd6b54b0baaa731127c4520a3dd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8fd0ecd6b54b0baaa731127c4520a3dd">&#9670;&nbsp;</a></span>ks_scan_getslicetime()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_scan_getslicetime </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_k_s___s_l_i_c_e___p_l_a_n.html">KS_SLICE_PLAN</a> *&#160;</td>
          <td class="paramname"><em>slice_plan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>passindx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>slloc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Returns the temporally sorted slice index from a DATA_ACQ_ORDER struct array</h4>
</p>
<p>This function finds the temporally sorted slice index (<code>.sltime</code>) in range [0, nslices-1] given the sequence's DATA_ACQ_ORDER struct array (in slice_plan.acq_order)</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">slice_plan</td><td>Pointer to the slice plan (<a class="el" href="struct_k_s___s_l_i_c_e___p_l_a_n.html" title="Struct holding all information about slice locations and aquisition order">KS_SLICE_PLAN</a>) for the sequence </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">passindx</td><td>Current pass index ([0, acqs-1]) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">slloc</td><td>Spatially sorted slice index [0, nslices-1] </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">sltimeinpass</td><td>Temporal index of the <code>n</code> slices acquired in each pass ([0, n-1]) </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;                                                                                   {</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; slice_plan-&gt;<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a3414dc896f1276457707d70318d46770">nslices</a>; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;    <span class="keywordflow">if</span> (slice_plan-&gt;<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#af6c9bb6611e03718085512d2c90cfcd8">acq_order</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].slpass == <a class="code" href="ksfse__implementation_8e.html#aae477e374b559bf16a475321797d62cb">passindx</a> &amp;&amp; slice_plan-&gt;<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#af6c9bb6611e03718085512d2c90cfcd8">acq_order</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].slloc == slloc) {</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;      <span class="keywordflow">return</span> slice_plan-&gt;<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#af6c9bb6611e03718085512d2c90cfcd8">acq_order</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>].sltime;</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    }</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;  }</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>;</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;}</div><div class="ttc" id="struct_k_s___s_l_i_c_e___p_l_a_n_html_af6c9bb6611e03718085512d2c90cfcd8"><div class="ttname"><a href="struct_k_s___s_l_i_c_e___p_l_a_n.html#af6c9bb6611e03718085512d2c90cfcd8">KS_SLICE_PLAN::acq_order</a></div><div class="ttdeci">DATA_ACQ_ORDER acq_order[SLICE_FACTOR *DATA_ACQ_MAX]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1203</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_afd953f31b866a09e0418967c2bf65a59"><div class="ttname"><a href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a></div><div class="ttdeci">#define KS_NOTSET</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:60</div></div>
<div class="ttc" id="ksfse__implementation_8e_html_aae477e374b559bf16a475321797d62cb"><div class="ttname"><a href="ksfse__implementation_8e.html#aae477e374b559bf16a475321797d62cb">passindx</a></div><div class="ttdeci">int passindx</div><div class="ttdef"><b>Definition:</b> ksfse_implementation.e:2829</div></div>
<div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="struct_k_s___s_l_i_c_e___p_l_a_n_html_a3414dc896f1276457707d70318d46770"><div class="ttname"><a href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a3414dc896f1276457707d70318d46770">KS_SLICE_PLAN::nslices</a></div><div class="ttdeci">int nslices</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1200</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a27071ced949f926058771246110c119c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a27071ced949f926058771246110c119c">&#9670;&nbsp;</a></span>ks_scan_epi_verify_phaseenc_plan()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811">ks_enum_epiblipsign</a> ks_scan_epi_verify_phaseenc_plan </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *&#160;</td>
          <td class="paramname"><em>epi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *&#160;</td>
          <td class="paramname"><em>phaseenc_plan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>shot</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;                                                                                                                  {</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;  <span class="keywordtype">int</span> kystep[epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a>];</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811">ks_enum_epiblipsign</a> blipsign = <a class="code" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811a38ffa981f0cb6b0e4660575afb14f751">KS_EPI_NOBLIPS</a>;</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;  <a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html">KS_PHASEENCODING_COORD</a> coord = <a class="code" href="_k_s_foundation_8h.html#ae5e9ce52cebc9a6543bc6e69e9a03148">KS_INIT_PHASEENCODING_COORD</a>;</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;  <span class="keywordflow">if</span> (phaseenc_plan == NULL) {</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;    <span class="keywordflow">return</span> blipsign;</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;  }</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;  <span class="comment">/* verify phase encoding plan has equidistant ky step size */</span></div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;  <span class="comment">/* first store ky coords */</span></div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a>; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;    coord = <a class="code" href="_k_s_foundation_8h.html#a9712828cb11bdaf20671ac4e43c80d3a">ks_phaseencoding_get</a>(phaseenc_plan, <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>, shot);</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;    kystep[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] = coord.<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#ad097e95262501d52829d5cd9a827275c">ky</a>;</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;  }</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a>-1; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    kystep[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] = kystep[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>+1] - kystep[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>]; <span class="comment">/* calculate ky step */</span></div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &gt; 0) {</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;      <span class="comment">/* check that kystep is consistent */</span></div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;      <span class="keywordflow">if</span> (kystep[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] != kystep[0]) {</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;        <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: KS_EPI does not support varying ky step size&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811a38ffa981f0cb6b0e4660575afb14f751">KS_EPI_NOBLIPS</a>;</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;      }</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    }</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;  }</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;  <span class="keywordflow">if</span> (kystep[0] &lt; 0) {</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    blipsign = <a class="code" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811ab36b1c8bcdbe924fc9d4a36cde9ba4dd">KS_EPI_POSBLIPS</a>;</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (kystep[0] &gt; 0) {</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;    blipsign = <a class="code" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811a5b332d904cae8d59fc2f85b49ada0ae4">KS_EPI_NEGBLIPS</a>;</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;  }</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;  <span class="keywordflow">return</span> blipsign;</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_ae5e9ce52cebc9a6543bc6e69e9a03148"><div class="ttname"><a href="_k_s_foundation_8h.html#ae5e9ce52cebc9a6543bc6e69e9a03148">KS_INIT_PHASEENCODING_COORD</a></div><div class="ttdeci">#define KS_INIT_PHASEENCODING_COORD</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:139</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d_html_ad097e95262501d52829d5cd9a827275c"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#ad097e95262501d52829d5cd9a827275c">KS_PHASEENCODING_COORD::ky</a></div><div class="ttdeci">int ky</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1553</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a7582325a159d8ec89a4a4ba0fb89e9a9"><div class="ttname"><a href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">KS_EPI::etl</a></div><div class="ttdeci">int etl</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1690</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d_html"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html">KS_PHASEENCODING_COORD</a></div><div class="ttdoc">Struct holding a 3D k-space phase encoding location (ky,kz)</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1552</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a9712828cb11bdaf20671ac4e43c80d3a"><div class="ttname"><a href="_k_s_foundation_8h.html#a9712828cb11bdaf20671ac4e43c80d3a">ks_phaseencoding_get</a></div><div class="ttdeci">KS_PHASEENCODING_COORD ks_phaseencoding_get(const KS_PHASEENCODING_PLAN *phaseenc_plan_ptr, int echo, int shot)</div><div class="ttdoc">Get [ky,kz] coordinate from KS_PHASEENCODING_PLAN for given echo and shot</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:308</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ae3a267da7c3c7e4e6e523dafba9b7811ab36b1c8bcdbe924fc9d4a36cde9ba4dd"><div class="ttname"><a href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811ab36b1c8bcdbe924fc9d4a36cde9ba4dd">KS_EPI_POSBLIPS</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1741</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ae3a267da7c3c7e4e6e523dafba9b7811"><div class="ttname"><a href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811">ks_enum_epiblipsign</a></div><div class="ttdeci">ks_enum_epiblipsign</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1741</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ae3a267da7c3c7e4e6e523dafba9b7811a38ffa981f0cb6b0e4660575afb14f751"><div class="ttname"><a href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811a38ffa981f0cb6b0e4660575afb14f751">KS_EPI_NOBLIPS</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1741</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ae3a267da7c3c7e4e6e523dafba9b7811a5b332d904cae8d59fc2f85b49ada0ae4"><div class="ttname"><a href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811a5b332d904cae8d59fc2f85b49ada0ae4">KS_EPI_NEGBLIPS</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1741</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0d83cf730d82612a87abc0f024bea336"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0d83cf730d82612a87abc0f024bea336">&#9670;&nbsp;</a></span>ks_scan_epi_shotcontrol()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_epi_shotcontrol </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *&#160;</td>
          <td class="paramname"><em>epi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>echo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SCAN_INFO&#160;</td>
          <td class="paramname"><em>sliceinfo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *&#160;</td>
          <td class="paramname"><em>phaseenc_plan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>shot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>rcvphase</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Changes the gradient state of a <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> object for the given slice information</h4>
</p>
<p>This function has two different tasks. First, it controls the EPI blips and sets the EPI dephaser and rephaser amplitude given the current <code>phaseshot</code> and <code>blipsign</code>. If <code>phaseshot</code> is outside the valid range ([0, <code>.blipphaser.R</code>-1], all gradient amplitudes on the blip (phase encoding) axis will be zero. This can be useful to acquire a refscan for Nyquist ghost correction. Second, it sets up the proper frequency and phase modulation per readout lobe to produce the desired FOV offset in both the frequency and phase encoding directions</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">epi</td><td>Pointer to <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">echo</td><td>EPI echo index (up to 16 EPI trains supported) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sliceinfo</td><td>SCAN_INFO struct for the current slice to be played out </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">phaseenc_plan</td><td>Pointer to the phase encoding plan </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">shot</td><td>Linear ky kz <code>shot</code> index in range <code>[0, (phaseenc_plan.num_shots-1)]</code> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rcvphase</td><td>Receiver phase in degrees, for RF spoiling. </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;                                                                                                                                         {</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;  <span class="keywordtype">float</span> blipampscale = 1.0;</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;  <span class="keywordtype">float</span> yfovratio, zfovratio;</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>, readindx, blipindx, kyview, kzview;</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;  <span class="keywordtype">int</span> numblips = (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a> - 1);</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;  <a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html">KS_PHASEENCODING_COORD</a> coord = <a class="code" href="_k_s_foundation_8h.html#ae5e9ce52cebc9a6543bc6e69e9a03148">KS_INIT_PHASEENCODING_COORD</a>;</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;  </div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811">ks_enum_epiblipsign</a> blipsign = <a class="code" href="_k_s_foundation__tgt_8c.html#a27071ced949f926058771246110c119c">ks_scan_epi_verify_phaseenc_plan</a>(epi, phaseenc_plan, shot);</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;  <span class="keywordflow">if</span> (phaseenc_plan != NULL &amp;&amp; (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a> != phaseenc_plan-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a>)) {</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: ETL of KS_EPI (%d) and KS_PHASEENCODING_PLAN (%d) do not match&quot;</span>, __FUNCTION__, epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a>, phaseenc_plan-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a>);</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;    blipsign = <a class="code" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811a38ffa981f0cb6b0e4660575afb14f751">KS_EPI_NOBLIPS</a>;</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;  }</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;  <span class="comment">/* EPI read &amp; blips for current &#39;echo&#39; = EPI train. */</span></div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a>; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;    coord = <a class="code" href="_k_s_foundation_8h.html#a9712828cb11bdaf20671ac4e43c80d3a">ks_phaseencoding_get</a>(phaseenc_plan, <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>, shot);</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;    kyview = (blipsign != <a class="code" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811a38ffa981f0cb6b0e4660575afb14f751">KS_EPI_NOBLIPS</a>) ? coord.<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#ad097e95262501d52829d5cd9a827275c">ky</a> : <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>;</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;    kzview = (blipsign != <a class="code" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811a38ffa981f0cb6b0e4660575afb14f751">KS_EPI_NOBLIPS</a>) ? coord.<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#a7894f45c2928e5a523eeafc5ef4ae8b7">kz</a> : <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>;</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> == 0) { <span class="comment">/* EPI dephaser. From k-space center to this line */</span></div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;      <a class="code" href="_k_s_foundation__tgt_8c.html#aff91e4da3b6ccabd607ec0da04f774ce">ks_scan_phaser_toline</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>, 0 + 2 * echo, kyview); <span class="comment">/* KS_NOTSET =&gt; zero amplitude */</span></div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;      <span class="keywordflow">if</span> (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> &gt; 0) {</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;        <span class="comment">/* 3D epi z dephaser(s) for even instances &#39;2*echo&#39; */</span></div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;        <a class="code" href="_k_s_foundation__tgt_8c.html#aff91e4da3b6ccabd607ec0da04f774ce">ks_scan_phaser_toline</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>, 0 + 2 * echo, kzview);</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;      }</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;    }</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;    </div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> == epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a>-1) { <span class="comment">/* EPI rephaser. From this line to k-space center */</span></div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;      <a class="code" href="_k_s_foundation__tgt_8c.html#a81a97893a74af952d90181aa858e709b">ks_scan_phaser_fromline</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>, 1 + 2 * echo, kyview); <span class="comment">/* KS_NOTSET =&gt; zero amplitude */</span></div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;      <span class="keywordflow">if</span> (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> &gt; 0) {</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;        <span class="comment">/* 3D epi z rephaser(s) for odd instances &#39;1+2*echo&#39; */</span></div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;        <a class="code" href="_k_s_foundation__tgt_8c.html#a81a97893a74af952d90181aa858e709b">ks_scan_phaser_fromline</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>, 1 + 2 * echo, kzview);</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;      }</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    }</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;    readindx = <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> + echo * epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a>; <span class="comment">/* ETL# of readouts */</span></div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;    blipindx = <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> + echo * numblips;  <span class="comment">/* (ETL-1)# of blips */</span></div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; numblips) {</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;      <span class="comment">/* FUTURE: at this point, we could increase/decrease blipampscale for odd/even blips for oblique ghost correction */</span></div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;      blipampscale = blipsign / epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#ab758140f3ca23e746a312f34a0d9c3a9">blipoversize</a>;</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;      <a class="code" href="_k_s_foundation__tgt_8c.html#a981da87d928a921e5d179e8268b92f1f">ks_scan_trap_ampscale</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#aaa0021ab8174eb7806de89d599769a9b">blip</a>, blipindx, blipampscale);</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;    }</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;    <span class="comment">/* FOV offsets (by changing freq/phase of epi.read) */</span></div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;    yfovratio = epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#abfd94a01fc71278021802ca0d1e25e16">fov</a> / epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#abfd94a01fc71278021802ca0d1e25e16">fov</a>;</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;    <span class="keywordflow">if</span> (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> &gt; 0) {</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;      zfovratio = epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">zphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#abfd94a01fc71278021802ca0d1e25e16">fov</a> / epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#abfd94a01fc71278021802ca0d1e25e16">fov</a>;</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;      <a class="code" href="_k_s_foundation__tgt_8c.html#a368695617a7edf4fdba05325573efb12">ks_scan_offsetfov3D</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>, readindx, sliceinfo, kyview, yfovratio, kzview, zfovratio, rcvphase);</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;      <a class="code" href="_k_s_foundation__tgt_8c.html#a567f7714943a0c78a422ee41defe2acf">ks_scan_offsetfov</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>, readindx, sliceinfo, kyview, yfovratio, rcvphase);</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;    }</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;  } <span class="comment">/* for etl */</span></div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;} <span class="comment">/* ks_scan_epi_shotcontrol */</span></div><div class="ttc" id="struct_k_s___e_p_i_html_ab758140f3ca23e746a312f34a0d9c3a9"><div class="ttname"><a href="struct_k_s___e_p_i.html#ab758140f3ca23e746a312f34a0d9c3a9">KS_EPI::blipoversize</a></div><div class="ttdeci">float blipoversize</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1694</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_aaa0021ab8174eb7806de89d599769a9b"><div class="ttname"><a href="struct_k_s___e_p_i.html#aaa0021ab8174eb7806de89d599769a9b">KS_EPI::blip</a></div><div class="ttdeci">KS_TRAP blip</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1687</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ae5e9ce52cebc9a6543bc6e69e9a03148"><div class="ttname"><a href="_k_s_foundation_8h.html#ae5e9ce52cebc9a6543bc6e69e9a03148">KS_INIT_PHASEENCODING_COORD</a></div><div class="ttdeci">#define KS_INIT_PHASEENCODING_COORD</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:139</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_aff91e4da3b6ccabd607ec0da04f774ce"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#aff91e4da3b6ccabd607ec0da04f774ce">ks_scan_phaser_toline</a></div><div class="ttdeci">void ks_scan_phaser_toline(KS_PHASER *phaser, int instanceno, int view)</div><div class="ttdoc">Updates the amplitude of a KS_PHASER sequence object to move from the k-space center to a desired k-s...</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:319</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">KS_PHASER::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1525</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a567f7714943a0c78a422ee41defe2acf"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a567f7714943a0c78a422ee41defe2acf">ks_scan_offsetfov</a></div><div class="ttdeci">void ks_scan_offsetfov(KS_READTRAP *readtrap, int instanceno, SCAN_INFO sliceinfo, int kyview, float phasefovratio, float rcvphase)</div><div class="ttdoc">Updates the frequency and phase of one or all instances of a KS_READTRAP to create a FOV shift...</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:905</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_afd953f31b866a09e0418967c2bf65a59"><div class="ttname"><a href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a></div><div class="ttdeci">#define KS_NOTSET</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:60</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_abfd94a01fc71278021802ca0d1e25e16"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#abfd94a01fc71278021802ca0d1e25e16">KS_READTRAP::fov</a></div><div class="ttdeci">float fov</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1425</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a22cd0313e5ffabe8393f77745dba8d52"><div class="ttname"><a href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">KS_EPI::blipphaser</a></div><div class="ttdeci">KS_PHASER blipphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1688</div></div>
<div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d_html_ad097e95262501d52829d5cd9a827275c"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#ad097e95262501d52829d5cd9a827275c">KS_PHASEENCODING_COORD::ky</a></div><div class="ttdeci">int ky</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1553</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_ad76a5ac226f0d25f70349ef83b5bc38a"><div class="ttname"><a href="struct_k_s___e_p_i.html#ad76a5ac226f0d25f70349ef83b5bc38a">KS_EPI::zphaser</a></div><div class="ttdeci">KS_PHASER zphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1689</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a27071ced949f926058771246110c119c"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a27071ced949f926058771246110c119c">ks_scan_epi_verify_phaseenc_plan</a></div><div class="ttdeci">ks_enum_epiblipsign ks_scan_epi_verify_phaseenc_plan(KS_EPI *epi, KS_PHASEENCODING_PLAN *phaseenc_plan, int shot)</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1049</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d_html_a7894f45c2928e5a523eeafc5ef4ae8b7"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#a7894f45c2928e5a523eeafc5ef4ae8b7">KS_PHASEENCODING_COORD::kz</a></div><div class="ttdeci">int kz</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1554</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a7582325a159d8ec89a4a4ba0fb89e9a9"><div class="ttname"><a href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">KS_EPI::etl</a></div><div class="ttdeci">int etl</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1690</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d_html"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html">KS_PHASEENCODING_COORD</a></div><div class="ttdoc">Struct holding a 3D k-space phase encoding location (ky,kz)</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1552</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a9712828cb11bdaf20671ac4e43c80d3a"><div class="ttname"><a href="_k_s_foundation_8h.html#a9712828cb11bdaf20671ac4e43c80d3a">ks_phaseencoding_get</a></div><div class="ttdeci">KS_PHASEENCODING_COORD ks_phaseencoding_get(const KS_PHASEENCODING_PLAN *phaseenc_plan_ptr, int echo, int shot)</div><div class="ttdoc">Get [ky,kz] coordinate from KS_PHASEENCODING_PLAN for given echo and shot</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:308</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_a7582325a159d8ec89a4a4ba0fb89e9a9"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#a7582325a159d8ec89a4a4ba0fb89e9a9">KS_PHASEENCODING_PLAN::etl</a></div><div class="ttdeci">int etl</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1588</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a03d42c44e323f3203fe5beabcefa47a5"><div class="ttname"><a href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">KS_EPI::read</a></div><div class="ttdeci">KS_READTRAP read</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1685</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a368695617a7edf4fdba05325573efb12"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a368695617a7edf4fdba05325573efb12">ks_scan_offsetfov3D</a></div><div class="ttdeci">void ks_scan_offsetfov3D(KS_READTRAP *readtrap, int instanceno, SCAN_INFO sliceinfo, int kyview, float phasefovratio, int kzview, float zphasefovratio, float rcvphase)</div><div class="ttdoc">Updates the frequency and phase of one or all instances of a KS_READTRAP to create a FOV shift...</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:912</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ae3a267da7c3c7e4e6e523dafba9b7811"><div class="ttname"><a href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811">ks_enum_epiblipsign</a></div><div class="ttdeci">ks_enum_epiblipsign</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1741</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a981da87d928a921e5d179e8268b92f1f"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a981da87d928a921e5d179e8268b92f1f">ks_scan_trap_ampscale</a></div><div class="ttdeci">void ks_scan_trap_ampscale(KS_TRAP *trp, int instanceno, float ampscale)</div><div class="ttdoc">Updates the amplitude of one or all instances of a KS_TRAP sequence object</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:182</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a81a97893a74af952d90181aa858e709b"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a81a97893a74af952d90181aa858e709b">ks_scan_phaser_fromline</a></div><div class="ttdeci">void ks_scan_phaser_fromline(KS_PHASER *phaser, int instanceno, int view)</div><div class="ttdoc">Updates the amplitude of a KS_PHASER sequence object to move from a k-space line to the k-space cente...</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:338</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_TRAP::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:437</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ae3a267da7c3c7e4e6e523dafba9b7811a38ffa981f0cb6b0e4660575afb14f751"><div class="ttname"><a href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811a38ffa981f0cb6b0e4660575afb14f751">KS_EPI_NOBLIPS</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1741</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_abfd94a01fc71278021802ca0d1e25e16"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#abfd94a01fc71278021802ca0d1e25e16">KS_PHASER::fov</a></div><div class="ttdeci">float fov</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1526</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a27b64905234db826096802c5a1f5bd6e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a27b64905234db826096802c5a1f5bd6e">&#9670;&nbsp;</a></span>ks_scan_epi_loadecho()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_epi_loadecho </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *&#160;</td>
          <td class="paramname"><em>epi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>echo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>storeecho</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>slice</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html">KS_PHASEENCODING_PLAN</a> *&#160;</td>
          <td class="paramname"><em>phaseenc_plan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>shot</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Loads the data storage information to hardware for the acquisition windows in a <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> sequence object</h4>
</p>
<p>This function specifies where to store the data acquired for each readout lobe in the <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> train given current:</p><ul>
<li><code>echo</code>: First instance of the <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> train is 0</li>
<li><code>slice</code>: Slice index, 0-based</li>
<li><code>shot</code>: Linear ky kz <code>shot</code> index in range <code>[0, (phaseenc_plan.num_shots-1)]</code></li>
<li><code>phaseenc_plan</code>: phaseenc_plan Pointer to the phase encoding plan</li>
</ul>
<p>If <code>shot</code> is outside the valid range, a baseline view (view 0 in loaddab()) will be acquired.</p>
<p>If <code>slice</code> is &lt; 0, data acquisition is turned <em>off</em> in loaddab()</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">epi</td><td>Pointer to <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">echo</td><td>EPI echo index to work on (up to 16 EPI trains supported) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">storeecho</td><td>EPI echo index for storing (usually the same as echo) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">slice</td><td>Slice index where to store the data (0-based) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">phaseenc_plan</td><td>Pointer to the phase encoding plan </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">shot</td><td>Linear ky kz <code>shot</code> index in range <code>[0, (phaseenc_plan.num_shots-1)]</code> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;                                                                                                                           {</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>, readindx;</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;  <span class="keywordtype">int</span> validsliceindx = (slice &gt;= 0 &amp;&amp; slice &lt; 2048);</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;  <span class="keywordtype">int</span> validshotindx = (shot &gt;= 0 &amp;&amp; (phaseenc_plan == NULL || shot &lt; phaseenc_plan-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#aa2f98be84137da8386df3fc88763823c">num_shots</a>));</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;  <span class="keywordtype">int</span> kyview = <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>;</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;  TYPDAB_PACKETS dabacqctrl;</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;  <a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html">KS_PHASEENCODING_COORD</a> coord = <a class="code" href="_k_s_foundation_8h.html#ae5e9ce52cebc9a6543bc6e69e9a03148">KS_INIT_PHASEENCODING_COORD</a>;</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811">ks_enum_epiblipsign</a> blipsign = <a class="code" href="_k_s_foundation__tgt_8c.html#a27071ced949f926058771246110c119c">ks_scan_epi_verify_phaseenc_plan</a>(epi, phaseenc_plan, shot);</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;  <span class="keywordtype">int</span> centerecho = epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#aa29afe5800d6b5d4be29e1da24c63caf">time2center</a> / epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>; <span class="comment">/* etl index corresponding to k-space center */</span></div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;  <span class="keywordtype">int</span> numplaced = epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>;</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;  <span class="keywordtype">int</span> numplaced = epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">ninst</a>;</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;  <span class="keywordflow">if</span> (numplaced == 0) {</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;  }</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;  <span class="keywordflow">if</span> (storeecho &lt; 0 || storeecho &gt; 15) {</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: storeecho must be in range [0:15]&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;  }</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;  <span class="keywordflow">if</span> (echo &lt; 0 || (echo + 1) * epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a> &gt; numplaced) {</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: echo (%d) must be in range [0:%d]&quot;</span>, __FUNCTION__, echo, numplaced/epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a>-1);</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;  }</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a>; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;    readindx = <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> + echo * epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a>; <span class="comment">/* N.B.: &#39;echo&#39; is # of EPI trains, not EPI readout lobes (up to 16 possible, set by opnecho) */</span></div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;    <span class="keywordflow">if</span> (readindx &gt;= numplaced) {</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;      <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_scan_epi_loadecho(%s): Readout lobe index %d has not been placed in PG&quot;</span>, epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">description</a>, readindx);</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;    }</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;    <span class="keywordflow">if</span> (validshotindx &amp;&amp; (blipsign != <a class="code" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811a38ffa981f0cb6b0e4660575afb14f751">KS_EPI_NOBLIPS</a>)) {</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;      coord = <a class="code" href="_k_s_foundation_8h.html#a9712828cb11bdaf20671ac4e43c80d3a">ks_phaseencoding_get</a>(phaseenc_plan, <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>, shot);</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;      kyview = coord.<a class="code" href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#ad097e95262501d52829d5cd9a827275c">ky</a>;</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__tgt_8c.html#ad152641fe076fd7c466bf3eff5d0a13f">rhasset</a> == ASSET_SCAN &amp;&amp; epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a> &gt; 1 &amp;&amp; epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a4762b9a6307f0223b3d1dfde7e8ddce8">nacslines</a> == 0) {</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;        <span class="comment">/* Auto-detect ASSET scan, which uses compressed storage of accelerated data, i.e. only</span></div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;<span class="comment">           storing the acquired lines, without inteleaving with blank unacquired lines */</span></div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;        <span class="keywordflow">if</span> (blipsign == <a class="code" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811ab36b1c8bcdbe924fc9d4a36cde9ba4dd">KS_EPI_POSBLIPS</a>) {</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;          kyview = epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a>-1 - <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (blipsign == <a class="code" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811a5b332d904cae8d59fc2f85b49ada0ae4">KS_EPI_NEGBLIPS</a>) {</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;          kyview = <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;        }</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;      }</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;    }</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;    <span class="keywordflow">if</span> (validsliceindx &amp;&amp; validshotindx) {</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;      dabacqctrl = DABON; <span class="comment">/* turn receiver on */</span></div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;      dabacqctrl = DABOFF; <span class="comment">/* turn receiver off */</span></div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;      slice = 0; <span class="comment">/* necessary? */</span></div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;    }</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation__tgt_8c.html#adbed7cbe302ef957a49dead6990d286f">rspent</a> == L_APS2 || <a class="code" href="_k_s_foundation__tgt_8c.html#adbed7cbe302ef957a49dead6990d286f">rspent</a> == L_MPS2) {</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;      <span class="comment">/* Prescan (R1 &amp; R2) */</span></div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;      <span class="keywordflow">if</span> (readindx == centerecho)</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;        loaddab(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a0e0bae3aa47ae5b8aae488fa0eb920ce">echo</a>[readindx], slice, storeecho, DABSTORE, 0, dabacqctrl, PSD_LOAD_DAB_ALL); <span class="comment">/* turn on acquisition for center echo of 1st EPI train */</span></div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;        loaddab(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a0e0bae3aa47ae5b8aae488fa0eb920ce">echo</a>[readindx], slice, storeecho, DABSTORE, 0, DABOFF, PSD_LOAD_DAB_ALL); <span class="comment">/* turn off acquisition for all other lobes (and all later EPI trains) */</span></div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;      <span class="comment">/* N.B.: kyview = KS_NOTSET (-1) if shot = KS_NOTSET. Hence kyview + 1 = dabview = 0 without phase encodes */</span></div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;      loaddab(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a0e0bae3aa47ae5b8aae488fa0eb920ce">echo</a>[readindx], slice, storeecho, DABSTORE, kyview + 1 <span class="comment">/* GE&#39;s views are 1-based */</span>, dabacqctrl, PSD_LOAD_DAB_ALL);</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;    }</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;  } <span class="comment">/* per acq window (readout lobe) */</span></div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;} <span class="comment">/* ks_scan_epi_loadecho */</span></div><div class="ttc" id="_k_s_foundation_8h_html_ae5e9ce52cebc9a6543bc6e69e9a03148"><div class="ttname"><a href="_k_s_foundation_8h.html#ae5e9ce52cebc9a6543bc6e69e9a03148">KS_INIT_PHASEENCODING_COORD</a></div><div class="ttdeci">#define KS_INIT_PHASEENCODING_COORD</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:139</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a3d90133d3051fbc4816d02efd9566d8e"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">KS_PHASER::R</a></div><div class="ttdeci">int R</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1529</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a0e0bae3aa47ae5b8aae488fa0eb920ce"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a0e0bae3aa47ae5b8aae488fa0eb920ce">KS_READ::echo</a></div><div class="ttdeci">WF_PULSE * echo</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:587</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n_html_aa2f98be84137da8386df3fc88763823c"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___p_l_a_n.html#aa2f98be84137da8386df3fc88763823c">KS_PHASEENCODING_PLAN::num_shots</a></div><div class="ttdeci">int num_shots</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1587</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a4762b9a6307f0223b3d1dfde7e8ddce8"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a4762b9a6307f0223b3d1dfde7e8ddce8">KS_PHASER::nacslines</a></div><div class="ttdeci">int nacslines</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1530</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_afd953f31b866a09e0418967c2bf65a59"><div class="ttname"><a href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a></div><div class="ttdeci">#define KS_NOTSET</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:60</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a72a22b96ff3908d2b9a20a3a02647a2f"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a72a22b96ff3908d2b9a20a3a02647a2f">KS_BASE::ninst</a></div><div class="ttdeci">int ninst</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:261</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a22cd0313e5ffabe8393f77745dba8d52"><div class="ttname"><a href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">KS_EPI::blipphaser</a></div><div class="ttdeci">KS_PHASER blipphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1688</div></div>
<div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d_html_ad097e95262501d52829d5cd9a827275c"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html#ad097e95262501d52829d5cd9a827275c">KS_PHASEENCODING_COORD::ky</a></div><div class="ttdeci">int ky</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1553</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_adbed7cbe302ef957a49dead6990d286f"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#adbed7cbe302ef957a49dead6990d286f">rspent</a></div><div class="ttdeci">int rspent</div><div class="ttdef"><b>Definition:</b> GERequired.e:2614</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a27071ced949f926058771246110c119c"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a27071ced949f926058771246110c119c">ks_scan_epi_verify_phaseenc_plan</a></div><div class="ttdeci">ks_enum_epiblipsign ks_scan_epi_verify_phaseenc_plan(KS_EPI *epi, KS_PHASEENCODING_PLAN *phaseenc_plan, int shot)</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1049</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">KS_READTRAP::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1435</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">KS_READ::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:581</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a7582325a159d8ec89a4a4ba0fb89e9a9"><div class="ttname"><a href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">KS_EPI::etl</a></div><div class="ttdeci">int etl</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1690</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d_html"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_e_n_c_o_d_i_n_g___c_o_o_r_d.html">KS_PHASEENCODING_COORD</a></div><div class="ttdoc">Struct holding a 3D k-space phase encoding location (ky,kz)</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1552</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a9712828cb11bdaf20671ac4e43c80d3a"><div class="ttname"><a href="_k_s_foundation_8h.html#a9712828cb11bdaf20671ac4e43c80d3a">ks_phaseencoding_get</a></div><div class="ttdeci">KS_PHASEENCODING_COORD ks_phaseencoding_get(const KS_PHASEENCODING_PLAN *phaseenc_plan_ptr, int echo, int shot)</div><div class="ttdoc">Get [ky,kz] coordinate from KS_PHASEENCODING_PLAN for given echo and shot</div><div class="ttdef"><b>Definition:</b> KSFoundation_common.c:308</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a03d42c44e323f3203fe5beabcefa47a5"><div class="ttname"><a href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">KS_EPI::read</a></div><div class="ttdeci">KS_READTRAP read</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1685</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_ad152641fe076fd7c466bf3eff5d0a13f"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#ad152641fe076fd7c466bf3eff5d0a13f">rhasset</a></div><div class="ttdeci">int rhasset</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ae3a267da7c3c7e4e6e523dafba9b7811ab36b1c8bcdbe924fc9d4a36cde9ba4dd"><div class="ttname"><a href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811ab36b1c8bcdbe924fc9d4a36cde9ba4dd">KS_EPI_POSBLIPS</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1741</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_a1c544bec41003a594ba4ec7d43a3a470"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a1c544bec41003a594ba4ec7d43a3a470">KS_TRAP::description</a></div><div class="ttdeci">KS_DESCRIPTION description</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:432</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ae3a267da7c3c7e4e6e523dafba9b7811"><div class="ttname"><a href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811">ks_enum_epiblipsign</a></div><div class="ttdeci">ks_enum_epiblipsign</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1741</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_aa29afe5800d6b5d4be29e1da24c63caf"><div class="ttname"><a href="struct_k_s___e_p_i.html#aa29afe5800d6b5d4be29e1da24c63caf">KS_EPI::time2center</a></div><div class="ttdeci">int time2center</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1693</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_ac359c54a7c5f9e9a94105b3c0d0be9ea"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">KS_READTRAP::acq</a></div><div class="ttdeci">KS_READ acq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1423</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_TRAP::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:437</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ae3a267da7c3c7e4e6e523dafba9b7811a38ffa981f0cb6b0e4660575afb14f751"><div class="ttname"><a href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811a38ffa981f0cb6b0e4660575afb14f751">KS_EPI_NOBLIPS</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1741</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ae3a267da7c3c7e4e6e523dafba9b7811a5b332d904cae8d59fc2f85b49ada0ae4"><div class="ttname"><a href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811a5b332d904cae8d59fc2f85b49ada0ae4">KS_EPI_NEGBLIPS</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1741</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a79ee6cf24d0783fd15699388ece79528"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a79ee6cf24d0783fd15699388ece79528">&#9670;&nbsp;</a></span>ks_scan_acq_to_rtp()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_acq_to_rtp </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_e_a_d.html">KS_READ</a> *&#160;</td>
          <td class="paramname"><em>read</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">TYPDAB_PACKETS&#160;</td>
          <td class="paramname"><em>dabacqctrl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>fatoffset</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Data routing control for RTP</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">read</td><td>Pointer to <a class="el" href="struct_k_s___r_e_a_d.html" title="Core sequence object that handles a data acquisition window">KS_READ</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dabacqctrl</td><td>DABON or DABOFF </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fatoffset</td><td>Frequency offset in [Hz] for the current data acquisition window </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;                                                                                  {</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;  WF_PULSE *echo_ptr;</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;  WF_PULSE *xtr_ptr;</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;  WF_PULSE *rba_ptr;</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; acq-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">base</a>.<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a>; ++<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>) {</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;    echo_ptr = &amp;acq-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a0e0bae3aa47ae5b8aae488fa0eb920ce">echo</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>];</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;    setrfltrs((<span class="keywordtype">int</span>) acq-&gt;<a class="code" href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">filt</a>.fslot, echo_ptr);</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;    getssppulse(&amp;rba_ptr, echo_ptr, <span class="stringliteral">&quot;rba&quot;</span>, 0);</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;    getssppulse(&amp;xtr_ptr, echo_ptr, <span class="stringliteral">&quot;xtr&quot;</span>, 0);</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;    acqctrl(dabacqctrl, (INT)0, rba_ptr);</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;    setfreqphase((<span class="keywordtype">int</span>)(fatoffset / TARDIS_FREQ_RES), <span class="comment">/* freq ctrl */</span></div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;                 0, <span class="comment">/* phase ctrl */</span></div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;                 xtr_ptr);</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;    <span class="comment">/* TODO: Add r1 scaling here! */</span></div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;    <span class="comment">/*if (r1_scale != 1.0 &amp;&amp; (rspent==L_SCAN)) {</span></div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;<span class="comment">      newR1 = ceil(pscR1 * r1_scale);</span></div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;<span class="comment">      if (newR1 &gt; 13)</span></div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;<span class="comment">    newR1 = 13;</span></div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;<span class="comment">      else if (newR1 &lt; 1)</span></div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;<span class="comment">    newR1 = 1;</span></div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;<span class="comment">      loaddab_hub_r1(echo_ptr, dabslice, dabecho, DABSTORE, dabview, 0, newR1, dabacqctrl, PSD_LOAD_DAB_ALL | PSD_LOAD_DAB_R1);</span></div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;<span class="comment">      }*/</span> <span class="comment">/* if R1 change */</span></div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;    routeDataFrameDab(echo_ptr, ROUTE_TO_RTP, <a class="code" href="_k_s_foundation__tgt_8c.html#addb9fdd9991d3e67d8449a10df030b07">cfcoilswitchmethod</a>);</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;  }</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;}</div><div class="ttc" id="struct_k_s___r_e_a_d_html_a0e0bae3aa47ae5b8aae488fa0eb920ce"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a0e0bae3aa47ae5b8aae488fa0eb920ce">KS_READ::echo</a></div><div class="ttdeci">WF_PULSE * echo</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:587</div></div>
<div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a06ab78e08959e925d92935c582469de8"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a06ab78e08959e925d92935c582469de8">KS_READ::base</a></div><div class="ttdeci">KS_BASE base</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:581</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_addb9fdd9991d3e67d8449a10df030b07"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#addb9fdd9991d3e67d8449a10df030b07">cfcoilswitchmethod</a></div><div class="ttdeci">int cfcoilswitchmethod</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a292f93e48d34cda511fcfb72a05558c2"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">KS_READ::filt</a></div><div class="ttdeci">FILTER_INFO filt</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:585</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a17778e7ed4abcb39ee14e9e4d2966b18"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a17778e7ed4abcb39ee14e9e4d2966b18">&#9670;&nbsp;</a></span>boffset()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS boffset </td>
          <td>(</td>
          <td class="paramtype">long *&#160;</td>
          <td class="paramname"><em>offsets</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a595f599c90a3cb1f300c3c83b5fa116d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a595f599c90a3cb1f300c3c83b5fa116d">&#9670;&nbsp;</a></span>ks_scan_switch_to_sequence()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_scan_switch_to_sequence </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>ctrl</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;                                                      {</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;  <span class="keywordflow">if</span> (ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> &gt; 0) {</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;    <a class="code" href="_k_s_foundation__tgt_8c.html#a17778e7ed4abcb39ee14e9e4d2966b18">boffset</a>(ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a0dd6f20330fb1abf528ca46f34299f7c">handle</a>.<a class="code" href="struct_k_s___s_e_q___h_a_n_d_l_e.html#a625adc8d3d12f5199327f158aa4d166b">offset</a>);</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;  }</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;}</div><div class="ttc" id="_k_s_foundation__tgt_8c_html_a17778e7ed4abcb39ee14e9e4d2966b18"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a17778e7ed4abcb39ee14e9e4d2966b18">boffset</a></div><div class="ttdeci">STATUS boffset(long *offsets)</div></div>
<div class="ttc" id="struct_k_s___s_e_q___h_a_n_d_l_e_html_a625adc8d3d12f5199327f158aa4d166b"><div class="ttname"><a href="struct_k_s___s_e_q___h_a_n_d_l_e.html#a625adc8d3d12f5199327f158aa4d166b">KS_SEQ_HANDLE::offset</a></div><div class="ttdeci">long * offset</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:835</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_SEQ_CONTROL::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:984</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a0dd6f20330fb1abf528ca46f34299f7c"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a0dd6f20330fb1abf528ca46f34299f7c">KS_SEQ_CONTROL::handle</a></div><div class="ttdeci">KS_SEQ_HANDLE handle</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:991</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a70f8570a5d1cca01d8d49d9cd34bed79"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a70f8570a5d1cca01d8d49d9cd34bed79">&#9670;&nbsp;</a></span>setssitime()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS setssitime </td>
          <td>(</td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a7a93838e7d53ff7ec9fbe98843181d03"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7a93838e7d53ff7ec9fbe98843181d03">&#9670;&nbsp;</a></span>startseq()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS startseq </td>
          <td>(</td>
          <td class="paramtype">s16&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">s16&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a02e188307a4bd9dfdb00d37688c0487e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a02e188307a4bd9dfdb00d37688c0487e">&#9670;&nbsp;</a></span>ks_scan_playsequence()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_scan_playsequence </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>ctrl</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;                                               {</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;  <span class="keywordflow">if</span> (ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> &gt; 0) {</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;    {</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;      <a class="code" href="_k_s_foundation__tgt_8c.html#a595f599c90a3cb1f300c3c83b5fa116d">ks_scan_switch_to_sequence</a>(ctrl);</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;      <a class="code" href="_k_s_foundation__tgt_8c.html#a70f8570a5d1cca01d8d49d9cd34bed79">setssitime</a>(ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6037d68ff7b6f66735a92611628df57">ssi_time</a> / <a class="code" href="_k_s_foundation__tgt_8c.html#a3d585d11b35cba1755ed2e74ae864997">cfhwgut</a>);</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;      <a class="code" href="_k_s_foundation__tgt_8c.html#a7a93838e7d53ff7ec9fbe98843181d03">startseq</a>(0, (<span class="keywordtype">short</span>) MAY_PAUSE); <span class="comment">/* play out the sequence in real time */</span></div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;    }</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;    <span class="comment">/* HOST */</span></div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;    ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a5af9f3a7de19e7493ce64776bd8f3556">nseqinstances</a>++;</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;  } <span class="comment">/* ctrl-&gt;duration &gt; 0 */</span></div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;  <span class="keywordflow">return</span> ctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>;</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;}</div><div class="ttc" id="_k_s_foundation__tgt_8c_html_a7a93838e7d53ff7ec9fbe98843181d03"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a7a93838e7d53ff7ec9fbe98843181d03">startseq</a></div><div class="ttdeci">STATUS startseq(s16, s16)</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a70f8570a5d1cca01d8d49d9cd34bed79"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a70f8570a5d1cca01d8d49d9cd34bed79">setssitime</a></div><div class="ttdeci">STATUS setssitime(long)</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a3d585d11b35cba1755ed2e74ae864997"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a3d585d11b35cba1755ed2e74ae864997">cfhwgut</a></div><div class="ttdeci">int cfhwgut</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_SEQ_CONTROL::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:984</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a5af9f3a7de19e7493ce64776bd8f3556"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a5af9f3a7de19e7493ce64776bd8f3556">KS_SEQ_CONTROL::nseqinstances</a></div><div class="ttdeci">int nseqinstances</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:982</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a595f599c90a3cb1f300c3c83b5fa116d"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a595f599c90a3cb1f300c3c83b5fa116d">ks_scan_switch_to_sequence</a></div><div class="ttdeci">void ks_scan_switch_to_sequence(KS_SEQ_CONTROL *ctrl)</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1269</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_ac6037d68ff7b6f66735a92611628df57"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6037d68ff7b6f66735a92611628df57">KS_SEQ_CONTROL::ssi_time</a></div><div class="ttdeci">int ssi_time</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:983</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa4c29e21c8d521ebb578246daeb29178"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa4c29e21c8d521ebb578246daeb29178">&#9670;&nbsp;</a></span>ks_scan_loaddabwithindices_nex()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_scan_loaddabwithindices_nex </td>
          <td>(</td>
          <td class="paramtype">WF_PULSE_ADDR&#160;</td>
          <td class="paramname"><em>pulse</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LONG&#160;</td>
          <td class="paramname"><em>slice</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LONG&#160;</td>
          <td class="paramname"><em>echo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LONG&#160;</td>
          <td class="paramname"><em>view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>acq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>vol</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LONG&#160;</td>
          <td class="paramname"><em>operation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">TYPDAB_PACKETS&#160;</td>
          <td class="paramname"><em>acqon_flag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>loaddab() with extra arguments for current acquisition and image volume and current excitation (NEX)</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pulse</td><td>Pointer to WF_PULSE in a <a class="el" href="struct_k_s___r_e_a_d.html" title="Core sequence object that handles a data acquisition window">KS_READ</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">slice</td><td>0-based <em>temporal</em> slice index (2D) or kz encoding step typically (3D) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">echo</td><td>0-based echo in the echo train </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">view</td><td>1-based ky view number </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">acq</td><td>0-based acquisition index (always 0 if all slices fit in one TR) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">vol</td><td>0-based volume index (always 0 if only one volume) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">operation</td><td>DABSTORE, DABADD (for 2nd to last excitation) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">acqon_flag</td><td>DABON or DABOFF </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;                                                             {</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;<span class="preprocessor">#if EPIC_RELEASE &lt; 26</span></div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;  acq = acq;</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;  vol = vol;</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;  <span class="keywordflow">return</span> loaddab(pulse, slice, echo, operation, <a class="code" href="_g_e_required_8e.html#a1cb6f035a0e9565bbf12c3ef04c3c229">view</a>, acqon_flag, PSD_LOAD_DAB_ALL);</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;  <span class="keyword">union </span><a class="code" href="union_indices.html">Indices</a> idx;</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;  idx.<a class="code" href="union_indices.html#acb607650af9713167c308f9121560425">c</a>[0] = acq;</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;  idx.c[1] = vol;</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;  <span class="keywordflow">return</span> loaddabwithangle(pulse, idx.i, slice, echo, operation, <a class="code" href="_g_e_required_8e.html#a1cb6f035a0e9565bbf12c3ef04c3c229">view</a>, acqon_flag, PSD_LOAD_DAB_ALL);</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;}</div><div class="ttc" id="union_indices_html"><div class="ttname"><a href="union_indices.html">Indices</a></div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1300</div></div>
<div class="ttc" id="_g_e_required_8e_html_a1cb6f035a0e9565bbf12c3ef04c3c229"><div class="ttname"><a href="_g_e_required_8e.html#a1cb6f035a0e9565bbf12c3ef04c3c229">view</a></div><div class="ttdeci">int view</div><div class="ttdef"><b>Definition:</b> GERequired.e:2630</div></div>
<div class="ttc" id="union_indices_html_acb607650af9713167c308f9121560425"><div class="ttname"><a href="union_indices.html#acb607650af9713167c308f9121560425">Indices::c</a></div><div class="ttdeci">uint8_t c[4]</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1301</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3a09974d212d39bdc19d41b3fb3f1535"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3a09974d212d39bdc19d41b3fb3f1535">&#9670;&nbsp;</a></span>ks_scan_loaddabwithindices()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS ks_scan_loaddabwithindices </td>
          <td>(</td>
          <td class="paramtype">WF_PULSE_ADDR&#160;</td>
          <td class="paramname"><em>pulse</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LONG&#160;</td>
          <td class="paramname"><em>slice</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LONG&#160;</td>
          <td class="paramname"><em>echo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LONG&#160;</td>
          <td class="paramname"><em>view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>acq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>vol</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">TYPDAB_PACKETS&#160;</td>
          <td class="paramname"><em>acqon_flag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>loaddab() with extra arguments for current acquisition and image volume</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pulse</td><td>Pointer to WF_PULSE in a <a class="el" href="struct_k_s___r_e_a_d.html" title="Core sequence object that handles a data acquisition window">KS_READ</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">slice</td><td>0-based <em>temporal</em> slice index (2D) or kz encoding step typically (3D) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">echo</td><td>0-based echo in the echo train </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">view</td><td>1-based ky view number </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">acq</td><td>0-based acquisition index (always 0 if all slices fit in one TR) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">vol</td><td>0-based volume index (always 0 if only one volume) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">acqon_flag</td><td>DABON or DABOFF </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;                                                             {</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation__tgt_8c.html#aa4c29e21c8d521ebb578246daeb29178">ks_scan_loaddabwithindices_nex</a>(pulse, slice, echo, <a class="code" href="_g_e_required_8e.html#a1cb6f035a0e9565bbf12c3ef04c3c229">view</a>, acq, vol, DABSTORE, acqon_flag);</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;}</div><div class="ttc" id="_k_s_foundation__tgt_8c_html_aa4c29e21c8d521ebb578246daeb29178"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#aa4c29e21c8d521ebb578246daeb29178">ks_scan_loaddabwithindices_nex</a></div><div class="ttdeci">STATUS ks_scan_loaddabwithindices_nex(WF_PULSE_ADDR pulse, LONG slice, LONG echo, LONG view, uint8_t acq, uint8_t vol, LONG operation, TYPDAB_PACKETS acqon_flag)</div><div class="ttdoc">loaddab() with extra arguments for current acquisition and image volume and current excitation (NEX)...</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1305</div></div>
<div class="ttc" id="_g_e_required_8e_html_a1cb6f035a0e9565bbf12c3ef04c3c229"><div class="ttname"><a href="_g_e_required_8e.html#a1cb6f035a0e9565bbf12c3ef04c3c229">view</a></div><div class="ttdeci">int view</div><div class="ttdef"><b>Definition:</b> GERequired.e:2630</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a95c41e5b4697083f1c9840f70b157c31"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a95c41e5b4697083f1c9840f70b157c31">&#9670;&nbsp;</a></span>ks_scan_wait_for_rtp()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_scan_wait_for_rtp </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>rtpmsg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>maxmsgsize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>maxwait</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html">KS_SEQ_CONTROL</a> *&#160;</td>
          <td class="paramname"><em>waitctrl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>play a wait sequence in a loop untill a RTP message is received.</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">rtpmsg</td><td>pointer to memory that will be filled by the RTP message </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">maxmsgsize</td><td>size in bytes of the memory pointed by rtpmsg </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">maxwait</td><td>timing out period in [ms] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">waitctrl</td><td>pointer to the <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> of a wait sequence. If NULL, the provided maxwait is ignored and a value of zero used instead. </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">size</td><td>of the received message, zero if timed out </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;                                                                                              {</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;  <span class="keywordtype">int</span> maxplayouts;</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;  <span class="keywordtype">int</span> nBytes = 0;</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>;</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;  n32 packed = 1;</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;  setscantimestop();</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;  maxplayouts =  waitctrl ? maxwait / waitctrl-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> : 0;</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;  <span class="keywordflow">if</span> (maxplayouts &lt; 1) {</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;    waitctrl = NULL;</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;    maxplayouts = 0;</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;  }</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt;= maxplayouts; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>++) {</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> != 0 &amp;&amp; waitctrl) {</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;      <a class="code" href="_k_s_foundation__tgt_8c.html#a02e188307a4bd9dfdb00d37688c0487e">ks_scan_playsequence</a>(waitctrl);</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;    }</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;    nBytes = 0;</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;<span class="preprocessor">#if defined(MGD_TGT) &amp;&amp; defined(PSD_HW)</span></div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;<span class="preprocessor">#if EPIC_RELEASE&lt;26</span></div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;    nBytes = rtp_get_feedback_data(rtpmsg, maxmsgsize, &amp;packed);</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;    nBytes = rtp_get_feedback_data(rtpmsg, maxmsgsize, &amp;packed, 2, RTP_QUEUE_OLDEST); <span class="comment">/*according to RTP_RESULT_PROMO=2, defined in lx/include/PromoCommon.h */</span></div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;    <span class="keywordflow">if</span> (nBytes&gt;0 &amp;&amp; !packed) {</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;    }</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;  }</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;  setscantimestart();</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;  <span class="keywordflow">return</span> nBytes;</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;}</div><div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_SEQ_CONTROL::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:984</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a02e188307a4bd9dfdb00d37688c0487e"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a02e188307a4bd9dfdb00d37688c0487e">ks_scan_playsequence</a></div><div class="ttdeci">int ks_scan_playsequence(KS_SEQ_CONTROL *ctrl)</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1281</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8d73c466af30e53064824044894067a9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8d73c466af30e53064824044894067a9">&#9670;&nbsp;</a></span>ks_copy_and_reset_obj()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_copy_and_reset_obj </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>pobj</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Create a copy of any sequence object with a <a class="el" href="struct_k_s___b_a_s_e.html" title="(Internal use) Structure being a part of various sequence object to keep count of instances on HOST a...">KS_BASE</a> as first member</h4>
</p>
<p>Create a copy of the object pointed by pobj and insert it into the linked list in second position. finally reset the (base part of) original object.</p>
<p>It is <em>required</em> that <code>pobj</code> can be casted to (<a class="el" href="struct_k_s___b_a_s_e.html" title="(Internal use) Structure being a part of various sequence object to keep count of instances on HOST a...">KS_BASE</a> *), which is the pointed object should have a <a class="el" href="struct_k_s___b_a_s_e.html" title="(Internal use) Structure being a part of various sequence object to keep count of instances on HOST a...">KS_BASE</a> as first member. Note that other, object-specific, actions may need to be performed to finalize the reset. This includes calls to ks_instancereset_***() functions on each member of the current <code>pobj</code> </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pobj</td><td>Pointer to a sequence object of some kind </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;                                       {</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;  <a class="code" href="struct_k_s___b_a_s_e.html">KS_BASE</a> *head = (<a class="code" href="struct_k_s___b_a_s_e.html">KS_BASE</a>*) pobj;</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;  <span class="comment">/* create a copy */</span></div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;  <a class="code" href="struct_k_s___b_a_s_e.html">KS_BASE</a> *copy = (<a class="code" href="struct_k_s___b_a_s_e.html">KS_BASE</a>*) AllocNode(head-&gt;<a class="code" href="struct_k_s___b_a_s_e.html#a439227feff9d7f55384e8780cfc2eb82">size</a>);</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;  memcpy(copy, head, head-&gt;<a class="code" href="struct_k_s___b_a_s_e.html#a439227feff9d7f55384e8780cfc2eb82">size</a>);</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;  <span class="comment">/* link to the copy */</span></div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;  head-&gt;<a class="code" href="struct_k_s___b_a_s_e.html#a75b19ffcca77bfc647ff02695958fd95">next</a> = copy;</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;  <span class="comment">/* reset the count of generated instances */</span></div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;  head-&gt;<a class="code" href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">ngenerated</a> = 0;</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;}</div><div class="ttc" id="struct_k_s___b_a_s_e_html_a75b19ffcca77bfc647ff02695958fd95"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a75b19ffcca77bfc647ff02695958fd95">KS_BASE::next</a></div><div class="ttdeci">void * next</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:263</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html"><div class="ttname"><a href="struct_k_s___b_a_s_e.html">KS_BASE</a></div><div class="ttdoc">(Internal use) Structure being a part of various sequence object to keep count of instances on HOST a...</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:260</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a48a67aa9525b1eaff08aa809b53110dc"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a48a67aa9525b1eaff08aa809b53110dc">KS_BASE::ngenerated</a></div><div class="ttdeci">int ngenerated</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:262</div></div>
<div class="ttc" id="struct_k_s___b_a_s_e_html_a439227feff9d7f55384e8780cfc2eb82"><div class="ttname"><a href="struct_k_s___b_a_s_e.html#a439227feff9d7f55384e8780cfc2eb82">KS_BASE::size</a></div><div class="ttdeci">int size</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:264</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4ec679c0fb8eb62c1776e67434e25b77"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4ec679c0fb8eb62c1776e67434e25b77">&#9670;&nbsp;</a></span>ks_tgt_reset_gradrfctrl()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_tgt_reset_gradrfctrl </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html">KS_GRADRFCTRL</a> *&#160;</td>
          <td class="paramname"><em>gradrfctrl</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Clears <a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html" title="typedef struct that is a part of the KS_SEQ_CONTROL typedef struct, used internally to collect gradie...">KS_GRADRFCTRL</a> on TGT. Called in ks_pg_trap, ks_pg_wave, and ks_pg_rf if the field <code>is_cleared_on_tgt</code> is false. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">gradrfctrl</td><td>[pointer to <a class="el" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html" title="typedef struct that is a part of the KS_SEQ_CONTROL typedef struct, used internally to collect gradie...">KS_GRADRFCTRL</a>] </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;                                                        {</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0;</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ad1471d1cbc5ed7e8b1bc9d0987bf6eed">numrf</a>; ++<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>) {</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;    gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a753f71c73d8169393fcbe8a9b3f4d2c2">rfptr</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] = NULL;</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;  }</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a576774535b3b72525cf3821a0ded5124">numtrap</a>; ++<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>) {</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;    gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a218dab0fa00815bec264cb1170a615ef">trapptr</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] = NULL;</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;  }</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a176c1433ab0ff244ebdc3806d77fc3c9">numwave</a>; ++<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>) {</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;    gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ac44d46e0aeb2f3842bf0cfc1e14ebadc">waveptr</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] = NULL;</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;  }</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> = 0; <a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a> &lt; gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#abe25ffea5925df8869e60f527ce583b4">numacq</a>; ++<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>) {</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;    gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a2389836ad299458a5470e252c06b91dd">readptr</a>[<a class="code" href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">i</a>] = NULL;</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;  }</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;  gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ad1471d1cbc5ed7e8b1bc9d0987bf6eed">numrf</a> = 0;</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;  gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a576774535b3b72525cf3821a0ded5124">numtrap</a> = 0;</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;  gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a176c1433ab0ff244ebdc3806d77fc3c9">numwave</a> = 0;</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;  gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#abe25ffea5925df8869e60f527ce583b4">numacq</a> = 0;</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;  gradrfctrl-&gt;<a class="code" href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#af7f2aa8614e77ef8af0154c7e071ab0e">is_cleared_on_tgt</a> = TRUE;</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;}</div><div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a753f71c73d8169393fcbe8a9b3f4d2c2"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a753f71c73d8169393fcbe8a9b3f4d2c2">KS_GRADRFCTRL::rfptr</a></div><div class="ttdeci">KS_RF * rfptr[KS_MAXUNIQUE_RF]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:815</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a576774535b3b72525cf3821a0ded5124"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a576774535b3b72525cf3821a0ded5124">KS_GRADRFCTRL::numtrap</a></div><div class="ttdeci">int numtrap</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:818</div></div>
<div class="ttc" id="union_indices_html_ad9484f5522d0e5f033037c369365ec61"><div class="ttname"><a href="union_indices.html#ad9484f5522d0e5f033037c369365ec61">Indices::i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1302</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_ad1471d1cbc5ed7e8b1bc9d0987bf6eed"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ad1471d1cbc5ed7e8b1bc9d0987bf6eed">KS_GRADRFCTRL::numrf</a></div><div class="ttdeci">int numrf</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:816</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_ac44d46e0aeb2f3842bf0cfc1e14ebadc"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#ac44d46e0aeb2f3842bf0cfc1e14ebadc">KS_GRADRFCTRL::waveptr</a></div><div class="ttdeci">KS_WAVE * waveptr[KS_MAXUNIQUE_WAVE]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:819</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_af7f2aa8614e77ef8af0154c7e071ab0e"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#af7f2aa8614e77ef8af0154c7e071ab0e">KS_GRADRFCTRL::is_cleared_on_tgt</a></div><div class="ttdeci">int is_cleared_on_tgt</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:823</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a218dab0fa00815bec264cb1170a615ef"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a218dab0fa00815bec264cb1170a615ef">KS_GRADRFCTRL::trapptr</a></div><div class="ttdeci">KS_TRAP * trapptr[KS_MAXUNIQUE_TRAP]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:817</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a176c1433ab0ff244ebdc3806d77fc3c9"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a176c1433ab0ff244ebdc3806d77fc3c9">KS_GRADRFCTRL::numwave</a></div><div class="ttdeci">int numwave</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:820</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_a2389836ad299458a5470e252c06b91dd"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#a2389836ad299458a5470e252c06b91dd">KS_GRADRFCTRL::readptr</a></div><div class="ttdeci">KS_READ * readptr[KS_MAXUNIQUE_READ]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:821</div></div>
<div class="ttc" id="struct_k_s___g_r_a_d_r_f_c_t_r_l_html_abe25ffea5925df8869e60f527ce583b4"><div class="ttname"><a href="struct_k_s___g_r_a_d_r_f_c_t_r_l.html#abe25ffea5925df8869e60f527ce583b4">KS_GRADRFCTRL::numacq</a></div><div class="ttdeci">int numacq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:822</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa5b257c3f42fff01e0a368d6c60e5919"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa5b257c3f42fff01e0a368d6c60e5919">&#9670;&nbsp;</a></span>ks_show_clock()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ks_show_clock </td>
          <td>(</td>
          <td class="paramtype">FLOAT&#160;</td>
          <td class="paramname"><em>scantime</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Show the clock in the UI with the remaining scan time</h4>
</p>
<div class="fragment"><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;                                   {</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;  setscantimestop();</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;  setscantimeimm(PSD_CLOCK_NORM, (<span class="keywordtype">float</span>)scantime, <a class="code" href="_k_s_foundation__tgt_8c.html#aadbc69c4efac6c7b4d9ed5e6e2124ce3">piviews</a>, (<span class="keywordtype">float</span>)<a class="code" href="_k_s_foundation__tgt_8c.html#a5df117f51af67768c0a73513fb6b5e71">pitslice</a>, <a class="code" href="_k_s_foundation__tgt_8c.html#afcd1565ad59c6149ca316adbd09a3328">opslicecnt</a>);</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;  setscantimestart();</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;}</div><div class="ttc" id="_k_s_foundation__tgt_8c_html_aadbc69c4efac6c7b4d9ed5e6e2124ce3"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#aadbc69c4efac6c7b4d9ed5e6e2124ce3">piviews</a></div><div class="ttdeci">int piviews</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_afcd1565ad59c6149ca316adbd09a3328"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#afcd1565ad59c6149ca316adbd09a3328">opslicecnt</a></div><div class="ttdeci">int opslicecnt</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a5df117f51af67768c0a73513fb6b5e71"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a5df117f51af67768c0a73513fb6b5e71">pitslice</a></div><div class="ttdeci">int pitslice</div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a2875ace95558531062d08465b2bcc282"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2875ace95558531062d08465b2bcc282">&#9670;&nbsp;</a></span>GAM</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float GAM</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="af07bb294f9364bf5dc24e6cfca153409"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af07bb294f9364bf5dc24e6cfca153409">&#9670;&nbsp;</a></span>cfreceiveroffsetfreq</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cfreceiveroffsetfreq</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="adbed7cbe302ef957a49dead6990d286f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adbed7cbe302ef957a49dead6990d286f">&#9670;&nbsp;</a></span>rspent</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rspent</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ae2ab25cb5d89d5b4a1b693e8ad87fd75"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae2ab25cb5d89d5b4a1b693e8ad87fd75">&#9670;&nbsp;</a></span>pscR1</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int pscR1</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="addb9fdd9991d3e67d8449a10df030b07"></a>
<h2 class="memtitle"><span class="permalink"><a href="#addb9fdd9991d3e67d8449a10df030b07">&#9670;&nbsp;</a></span>cfcoilswitchmethod</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cfcoilswitchmethod</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a35c854f1f8f79b61a77569e84e172018"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a35c854f1f8f79b61a77569e84e172018">&#9670;&nbsp;</a></span>cfswgut</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cfswgut</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a49fda6ebed3a78faf1db4fcbfd412de4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a49fda6ebed3a78faf1db4fcbfd412de4">&#9670;&nbsp;</a></span>cfswrfut</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cfswrfut</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a327dd261edd2ec61105487e4073cba27"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a327dd261edd2ec61105487e4073cba27">&#9670;&nbsp;</a></span>rsprot</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">long rsprot[DATA_ACQ_MAX][9]</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ad152641fe076fd7c466bf3eff5d0a13f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad152641fe076fd7c466bf3eff5d0a13f">&#9670;&nbsp;</a></span>rhasset</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rhasset</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a3d585d11b35cba1755ed2e74ae864997"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3d585d11b35cba1755ed2e74ae864997">&#9670;&nbsp;</a></span>cfhwgut</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cfhwgut</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="aadbc69c4efac6c7b4d9ed5e6e2124ce3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aadbc69c4efac6c7b4d9ed5e6e2124ce3">&#9670;&nbsp;</a></span>piviews</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int piviews</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a5df117f51af67768c0a73513fb6b5e71"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5df117f51af67768c0a73513fb6b5e71">&#9670;&nbsp;</a></span>pitslice</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int pitslice</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="afcd1565ad59c6149ca316adbd09a3328"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afcd1565ad59c6149ca316adbd09a3328">&#9670;&nbsp;</a></span>opslicecnt</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int opslicecnt</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_edd0b46848e1966a9ba471eaad9abcfd.html">tmpfiles</a></li><li class="navelem"><a class="el" href="_k_s_foundation__tgt_8c.html">KSFoundation_tgt.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
