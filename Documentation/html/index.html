<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>KSFoundation: EPIC using KSFoundation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="KarolinskaLogo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">KSFoundation
   &#160;<span id="projectnumber">[Feb-2019]</span>
   </div>
   <div id="projectbrief">A platform for simpler EPIC programming on GE MR systems</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">EPIC using KSFoundation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>KSFoundation is a C-library with additional support functions and sequence modules for simpler pulse sequence programming on GE MR-systems using EPIC. This has been developed by the Neuro MR Physics group at Karolinska University Hospital, Stockholm, Sweden. The KSFoundation library acts as an abstraction layer, aiming at keeping information encapsulated and low-level EPIC functions hidden to the programmer. While the programming language is still C, without the ability to create actual C++ classes, <code>typedef structs</code> are used as class surrogates with a systematically named set of functions associated to them. While not strictly true, an instance of one of these <code>typedef structs</code> is referred to as a <em>sequence object</em>.</p>
<p>&ndash; <em>The Neuro MR Physics group, Karolinska University Hospital</em> </p><hr/>
<div class="image">
<img src="KSFSequenceObjects.png" alt="KSFSequenceObjects.png"/>
<div class="caption">
KSFoundation Sequence Objects</div></div>
<h1><a class="anchor" id="KeyFeatures"></a>
Key features</h1>
<ul>
<li>Self-contained sequence parts</li>
<li>No use of integer amplitudes or CVs for pulses/pulseparts (<code>pw_***, a_***, ia_***</code>)</li>
<li>Custom gradient waveforms in [G/cm] and THETA waveforms in [degrees]</li>
<li>No EPIC Macros (except for <a class="el" href="_g_e_required_8e.html#ab1fe30ecb27b541de01992692c1e9a47" title="Creates a hardware sequence for the current sequence module">KS_SEQLENGTH()</a>)</li>
<li>RF selection by one-line assignment</li>
<li>Automatic memory allocation for waveforms and trapezoids</li>
<li>Automatic RF and gradient counting for SAR and heating calculations</li>
<li>Arbitrary placement of one designed sequence object multiple times on different sequence boards</li>
<li>Sequence objects (KS_***) are built on other sequence objects to inherit functionality and increase consistency</li>
<li>Ability to build on existing sequence objects to make new sequence specific objects, or a whole sequence</li>
<li>ScanOnHost: Scan clock, TR timing, SAR-limits and PNG/SVG/PDF generation performed on HOST by calling scan loop functions on TGT</li>
<li><a class="el" href="_g_e_required_8e.html" title="This file has several sections that should be @inline&#39;d for a main pulse sequence written entirely in...">GERequired.e</a> keeps mandatory stuff out of sight</li>
<li>Interactive HTML/Javascript plotting of the sequence on HOST <br />
<br />
<br />
 <hr/>
 <br />
 </li>
</ul>
<h1><a class="anchor" id="Reference"></a>
Quick Reference</h1>
<ol type="1">
<li><a href="_e_p_i_c_crashcourse.html">EPIC Crash Course</a></li>
<li><a href="_phase_enc_plan.html">KS_PHASEENCODING_PLAN (NEW)</a></li>
<li><a href="_plotting.html">Plotting (new interactive HTML format on HOST)</a></li>
<li><a href="annotated.html">KSFoundation sequence objects</a> (Data Structures)</li>
<li><a href="globals_func_k.html#index_k">KSFoundation functions</a>, some of which are<ul>
<li><code>ks_eval_***()</code> (to design sequence objects in <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code>)</li>
<li><code>ks_pg_***()</code> (to place sequence objects in the <code>@pg</code> section)</li>
<li><code>ks_scan_***()</code> (to modify sequence objects in <code><a class="el" href="ksepi_8e.html#a1669428052472d00b1c55a1291f8032f">scan()</a></code>)</li>
</ul>
</li>
<li><a href="_g_e_required_8e.html#func-members">GERequired functions</a></li>
<li><a href="_k_s_foundation___g_e_r_f_8h.html">Selection of GE RF pulses</a> as <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> objects (see also <code>KSFoundation/rfpulses/*.eps</code>)</li>
<li><a href="globals_defs.html">KSFoundation defines</a></li>
<li><a href="globals_enum.html">KSFoundation enumerations</a> <br />
<br />
<br />
 <hr/>
 <br />
 </li>
</ol>
<h1><a class="anchor" id="Installation"></a>
Installation</h1>
<h2><a class="anchor" id="InstallationMain"></a>
Basic installation</h2>
<ol type="1">
<li>Clone the Git repository <a href="https://gitlab.com/neuromr_karolinska/psd_ksfoundation">https://gitlab.com/neuromr_karolinska/psd_ksfoundation</a> to a linux machine with EPIC installed (DV24, PET-MR24 and later, currently up to ESE_RX27.0_R02 (Contact us for ESE_RX27.0_R01)).<ul>
<li>Account on GitLab.com is required, please fill in the following form: <a href="http://goo.gl/forms/UKxgOYGFhPZgxDwr2">http://goo.gl/forms/UKxgOYGFhPZgxDwr2</a> to get access to this repository (If this method fails, please send your GitLab username to: <a href="#" onclick="location.href='mai'+'lto:'+'mrp'+'hy'+'sic'+'s@'+'neu'+'ro'+'rad'+'ka'+'rol'+'in'+'ska'+'.s'+'e'; return false;">mrphy<span style="display: none;">.nosp@m.</span>sics<span style="display: none;">.nosp@m.</span>@neur<span style="display: none;">.nosp@m.</span>orad<span style="display: none;">.nosp@m.</span>karol<span style="display: none;">.nosp@m.</span>insk<span style="display: none;">.nosp@m.</span>a.se</a>). <div class="fragment"><div class="line">&gt; cd /somepath/toput/mypsds/</div><div class="line">&gt; git clone https:<span class="comment">//gitlab.com/neuromr_karolinska/psd_ksfoundation  // use your GitLab.com user/passwd</span></div></div><!-- fragment --></li>
<li>The <code>psd_ksfoundation</code> repository contains the following directories: <div class="fragment"><div class="line">Documentation/   <span class="comment">// This documentation</span></div><div class="line">KSFoundation/    <span class="comment">// The KSFoundation library, GERequired.e and other support files</span></div><div class="line"><a class="code" href="ksfse__implementation_8e.html#a9c3ae9d44addcef6a9e09b7db6679baf">ksfse</a>/           <span class="comment">// The Fast Spin Echo sequence. ksfse.e (2D/3D)</span></div><div class="line"><a class="code" href="ksgre__implementation_8e.html#a49d5d3a953983bac06c7aa01958d5e71">ksgre</a>/           <span class="comment">// The Gradient Echo sequence. ksgre.e (2D/3D)</span></div><div class="line">ksgre_tutorial/  <span class="comment">// A simplified version of ksgre.e</span></div><div class="line"><a class="code" href="ksepi__implementation_8e.html#a6db646d881a5c19c6d6cc7068cc947e5">ksepi</a>/           <span class="comment">// The Echo Planar sequence. ksepi.e (2D/3D)</span></div><div class="line">ksmodules/       <span class="comment">// General sequence plugins (a.k.a. sequence modules) for various sequences</span></div></div><!-- fragment --></li>
</ul>
</li>
<li>Make sure <code>KSFoundation/common.mk</code> has a matching entry for your ESE top path<ul>
<li>Check the name of your ESE top-level directory (e.g. <code>/ESE_RX27.0_R02</code>). Many recent ESE distributions are already in <code>common.mk</code>, so you may not need to do anything. Including this file in the Imakefile of each psd is already taken care of, and will set the <code>RELEASE_NUM</code> (and PATCH_NUM) variable in the Imakefile, so the psds can compile for multiple ESE releases without need for changing the psd source code.</li>
<li>Further reading (when you have time): <a class="el" href="_imakefile.html">Imakefile modifications for KSFoundation and to sense EPIC releases</a>.</li>
</ul>
</li>
<li>If not already done, run <code>setupESE</code> to set your ESE variables (see GE's EPIC installation manual). Releases from DV24 and later are supported with KSFoundation EPIC.</li>
<li>Try to compile e.g. <a class="el" href="ksgre_8e.html" title="This file contains the overall structure for the ksgre psd. ">ksgre.e</a> in ksgre/ by <div class="fragment"><div class="line">&gt; prep_psd_dir</div><div class="line">&gt; psdqmake clean all</div></div><!-- fragment --> <br />
<br />
 </li>
</ol>
<h2><a class="anchor" id="InstallationDbg"></a>
Install DDD to debug in WTools (HOST &amp; TGT)</h2>
<p>Please take the time to install the DDD debugger or equivalent, it's a time investment. The debugger choice is located in GE's <code>.psdtoolsrc</code> (Debugger = "ddd") in your home directory and can be used both in EvalTool and MGDSim. There is nothing special about KSFoundation here other than it is very easy to see the sequence structs and its contents this way, all in one place. <br />
<br />
<br />
 </p><hr/>
<p> <br />
 </p>
<h1><a class="anchor" id="SeqMod"></a>
Sequences and modules</h1>
<p><br />
 </p>
<h2><a class="anchor" id="Sequences"></a>
Sequences written using KSFoundation EPIC</h2>
<ol type="1">
<li><a class="el" href="ksgre_8e.html" title="This file contains the overall structure for the ksgre psd. ">ksgre.e</a>: 2D/3D/4D Gradient Echo (GRE/SPGR/SSFP)</li>
<li>ksgre_tutorial.e: A simplified version of <a class="el" href="ksgre_8e.html" title="This file contains the overall structure for the ksgre psd. ">ksgre.e</a></li>
<li><a class="el" href="ksfse_8e.html" title="This file contains the overall structure for the ksfse psd. ">ksfse.e</a>: 2D/3D/4D Fast Spin Echo (T1-w, T2-w, T2-FLAIR, T1-FLAIR)</li>
<li><a class="el" href="ksepi_8e.html" title="This file contains the overall structure for the ksepi psd. ">ksepi.e</a>: 2D/3D/4D Spin-Echo/Gradient-Echo/Diffusion-weighted EPI, with optional IR preparation</li>
</ol>
<p>Please note that while 2D support for these sequences has been of clinical quality for a long time, the 3D support is new. For now, off-center FOV for 3D works as well as online parallel imaging and elliptical sampling (ksgre). However, as indicated at the end of the <a href="_phase_enc_plan.html">Phase encoding plans</a> section of the documentation, more work is needed to make clinical 3D scans out of the box.</p>
<p><br />
<br />
 </p>
<h2><a class="anchor" id="SeqModules"></a>
Sequence modules</h2>
<p>Pulse sequence modules are conceptually plugins to a main sequence, usually without data acquisition involved. Currently, there are three sequence modules in ksmodules/:</p><ol type="1">
<li><a class="el" href="_k_s_inversion_8e.html" title="This file contains an inversion preparation module that should be @inline&#39;d at the beginning of a KSF...">KSInversion.e</a>: Inversion sequence module (compatible with <a class="el" href="ksgre_8e.html" title="This file contains the overall structure for the ksgre psd. ">ksgre.e</a>, <a class="el" href="ksfse_8e.html" title="This file contains the overall structure for the ksfse psd. ">ksfse.e</a> and <a class="el" href="ksepi_8e.html" title="This file contains the overall structure for the ksepi psd. ">ksepi.e</a>)</li>
<li><a class="el" href="_k_s_chem_sat_8e.html" title="This file contains FatSat (KSChemSat) and should be @inline&#39;d at the beginning of a KSFoundation PSD...">KSChemSat.e</a>: Fat saturation sequence module (compatible with <a class="el" href="ksgre_8e.html" title="This file contains the overall structure for the ksgre psd. ">ksgre.e</a>, <a class="el" href="ksfse_8e.html" title="This file contains the overall structure for the ksfse psd. ">ksfse.e</a> and <a class="el" href="ksepi_8e.html" title="This file contains the overall structure for the ksepi psd. ">ksepi.e</a>)</li>
<li><a class="el" href="_k_s_sp_sat_8e.html" title="This file contains Spatial Sat and should be @inline&#39;d at the beginning of a KSFoundation PSD...">KSSpSat.e</a>: Spatial saturation sequence module (compatible with <a class="el" href="ksgre_8e.html" title="This file contains the overall structure for the ksgre psd. ">ksgre.e</a>, <a class="el" href="ksfse_8e.html" title="This file contains the overall structure for the ksfse psd. ">ksfse.e</a> and <a class="el" href="ksepi_8e.html" title="This file contains the overall structure for the ksepi psd. ">ksepi.e</a>) <br />
<br />
 </li>
</ol>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
