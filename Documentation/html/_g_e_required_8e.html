<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>KSFoundation: GERequired.e File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="KarolinskaLogo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">KSFoundation
   &#160;<span id="projectnumber">[Feb-2019]</span>
   </div>
   <div id="projectbrief">A platform for simpler EPIC programming on GE MR systems</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_g_e_required_8e.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">GERequired.e File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a4b4a61d24419e8929c363a2e9445b516"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a4b4a61d24419e8929c363a2e9445b516">seq_name</a>&#160;&#160;&#160;]_set</td></tr>
<tr class="separator:a4b4a61d24419e8929c363a2e9445b516"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad08ee889e7f476726128551c60c37c30"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#ad08ee889e7f476726128551c60c37c30">GEREQUIRED_E</a></td></tr>
<tr class="separator:ad08ee889e7f476726128551c60c37c30"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43ed1aedaae548fba169071b1c911983"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a43ed1aedaae548fba169071b1c911983">MAX_ENTRY_POINTS</a>&#160;&#160;&#160;15</td></tr>
<tr class="separator:a43ed1aedaae548fba169071b1c911983"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6aa2d3622908f1dd32bd380b28f1aa3a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a6aa2d3622908f1dd32bd380b28f1aa3a">MAX_TR_OVERSHOOT</a>&#160;&#160;&#160;200 /* 200 us round-up allowed per TR */</td></tr>
<tr class="separator:a6aa2d3622908f1dd32bd380b28f1aa3a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef66154f8c9725d4b95ddd70689465c2"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#aef66154f8c9725d4b95ddd70689465c2">DEFAULT_SCAN_INFO_HEAD</a>&#160;&#160;&#160;.optloc = 0.0, .oprloc = 0.0, .opphasoff = 0.0</td></tr>
<tr class="separator:aef66154f8c9725d4b95ddd70689465c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4c590873e5778394b3d52c4225250863"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a4c590873e5778394b3d52c4225250863">DEFAULT_AXIAL_SCAN_INFO</a></td></tr>
<tr class="separator:a4c590873e5778394b3d52c4225250863"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a82c2fa6d6c5d54c510859d52aff5ba93"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a82c2fa6d6c5d54c510859d52aff5ba93">DEFAULT_AX_SCAN_INFO_FREQ_LR</a>&#160;&#160;&#160;<a class="el" href="_g_e_required_8e.html#a4c590873e5778394b3d52c4225250863">DEFAULT_AXIAL_SCAN_INFO</a></td></tr>
<tr class="separator:a82c2fa6d6c5d54c510859d52aff5ba93"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a00e2a3c0d4b96dda4b9d0cddd8bcbd6a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a00e2a3c0d4b96dda4b9d0cddd8bcbd6a">DEFAULT_AX_SCAN_INFO_FREQ_AP</a></td></tr>
<tr class="separator:a00e2a3c0d4b96dda4b9d0cddd8bcbd6a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a98c72b79cd55dc14b2eeab198169e7c2"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a98c72b79cd55dc14b2eeab198169e7c2">DEFAULT_SAG_SCAN_INFO_FREQ_SI</a></td></tr>
<tr class="separator:a98c72b79cd55dc14b2eeab198169e7c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9241e753c3188137dbd972aa8e7f6c81"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a9241e753c3188137dbd972aa8e7f6c81">DEFAULT_SAG_SCAN_INFO_FREQ_AP</a></td></tr>
<tr class="separator:a9241e753c3188137dbd972aa8e7f6c81"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6a24ad3629eb58c819f00004c53a89df"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a6a24ad3629eb58c819f00004c53a89df">DEFAULT_COR_SCAN_INFO_FREQ_SI</a></td></tr>
<tr class="separator:a6a24ad3629eb58c819f00004c53a89df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a957fcaa766318f5df217d814212f9d39"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a957fcaa766318f5df217d814212f9d39">DEFAULT_COR_SCAN_INFO_FREQ_LR</a></td></tr>
<tr class="separator:a957fcaa766318f5df217d814212f9d39"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ada215f0345c9bef915020f3e381daa74"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#ada215f0345c9bef915020f3e381daa74">KS_PSD_USE_APX</a>&#160;&#160;&#160;0</td></tr>
<tr class="separator:ada215f0345c9bef915020f3e381daa74"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ab1fe30ecb27b541de01992692c1e9a47"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#ab1fe30ecb27b541de01992692c1e9a47">KS_SEQLENGTH</a> (<a class="el" href="_g_e_required_8e.html#a4b4a61d24419e8929c363a2e9445b516">seq_name</a>, seq_struct)</td></tr>
<tr class="separator:ab1fe30ecb27b541de01992692c1e9a47"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b2fe5b383ca739e400124ee465fa26e"><td class="memItemLeft" align="right" valign="top">ifndef EPIC_RELEASE_IS_25x ifndef EPIC_RELEASE_IS_24x endif endif STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a9b2fe5b383ca739e400124ee465fa26e">calcPulseParams</a> (void)</td></tr>
<tr class="separator:a9b2fe5b383ca739e400124ee465fa26e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9e0525cfd14e06359ddb8fe37ad965f5"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a9e0525cfd14e06359ddb8fe37ad965f5">simscan</a> (void)</td></tr>
<tr class="separator:a9e0525cfd14e06359ddb8fe37ad965f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aae6f05f5a408ae64a91705d67071e064"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#aae6f05f5a408ae64a91705d67071e064">GEReq_init_gradspecs</a> (LOG_GRAD *<a class="el" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>, PHYS_GRAD *<a class="el" href="_k_s_foundation_8h.html#af51ba165cbaf874219789beaa48f2464">phygrd</a>, float srfact)</td></tr>
<tr class="separator:aae6f05f5a408ae64a91705d67071e064"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a05e7d139f5f41deb6ed1c934ed6c6e64"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a05e7d139f5f41deb6ed1c934ed6c6e64">GEReq_init_accelUI</a> (int integeraccel, int maxaccel)</td></tr>
<tr class="separator:a05e7d139f5f41deb6ed1c934ed6c6e64"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad97ca73c80e23352aa79230ba0e068b6"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#ad97ca73c80e23352aa79230ba0e068b6">GEReq_eval_TRrange</a> (int *slperpass, int *timetoadd_perTR, int requested_minacqs, int mintr, int maxtr, <a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html">KS_SEQ_COLLECTION</a> *<a class="el" href="ksgre_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>, int(*play_loop)(int, int, void **), int nargs, void **args)</td></tr>
<tr class="separator:ad97ca73c80e23352aa79230ba0e068b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3bf65ebca3543f771e2d17799bbb0d3c"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a3bf65ebca3543f771e2d17799bbb0d3c">GEReq_eval_TR</a> (int *slperpass, int *timetoadd_perTR, int requested_minacqs, <a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html">KS_SEQ_COLLECTION</a> *<a class="el" href="ksgre_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>, int(*play_loop)(int, int, void **), int nargs, void **args)</td></tr>
<tr class="separator:a3bf65ebca3543f771e2d17799bbb0d3c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af06136710d55a4b8a9d63d1c676e7565"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#af06136710d55a4b8a9d63d1c676e7565">GEReq_eval_rfscaling</a> (<a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html">KS_SEQ_COLLECTION</a> *<a class="el" href="ksgre_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>)</td></tr>
<tr class="separator:af06136710d55a4b8a9d63d1c676e7565"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a789f2b2ac7ec21daa6a693820873e64a"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a789f2b2ac7ec21daa6a693820873e64a">GEReq_eval_checkTR_SAR_calcs</a> (<a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html">KS_SEQ_COLLECTION</a> *<a class="el" href="ksgre_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>, int intended_time)</td></tr>
<tr class="separator:a789f2b2ac7ec21daa6a693820873e64a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a027161dabe834c55750bd1e7f2fa8473"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a027161dabe834c55750bd1e7f2fa8473">GEReq_eval_checkTR_SAR</a> (<a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html">KS_SEQ_COLLECTION</a> *<a class="el" href="ksgre_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>, int nslices, int(*play_loop)(int, int, void **), int nargs, void **args)</td></tr>
<tr class="separator:a027161dabe834c55750bd1e7f2fa8473"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adafdd7c32e3e366cfdf89d47d463218d"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#adafdd7c32e3e366cfdf89d47d463218d">GEReq_predownload_store_sliceplan</a> (<a class="el" href="struct_k_s___s_l_i_c_e___p_l_a_n.html">KS_SLICE_PLAN</a> slice_plan)</td></tr>
<tr class="separator:adafdd7c32e3e366cfdf89d47d463218d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc4267e86a2b954a6dfbbc65bcee32f5"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#afc4267e86a2b954a6dfbbc65bcee32f5">GEReq_predownload_store_sliceplan3D</a> (int slices_in_slab, int slabs)</td></tr>
<tr class="separator:afc4267e86a2b954a6dfbbc65bcee32f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa2b5289cf54c04c4c834bad269af6c9b"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#aa2b5289cf54c04c4c834bad269af6c9b">GEReq_predownload_setfilter</a> (FILTER_INFO *filt)</td></tr>
<tr class="separator:aa2b5289cf54c04c4c834bad269af6c9b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7ea1ad4e9625baa434eecb32fc2f2563"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a7ea1ad4e9625baa434eecb32fc2f2563">GEReq_predownload_genVRGF</a> (const <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a> *const readtrap)</td></tr>
<tr class="separator:a7ea1ad4e9625baa434eecb32fc2f2563"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1df29f83c19052911e6775f350ff085d"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a1df29f83c19052911e6775f350ff085d">GEReq_predownload_genrowflip</a> (<a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *epi, int blipsign, int assetflag, int dorowflip)</td></tr>
<tr class="separator:a1df29f83c19052911e6775f350ff085d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a01275fda9ebd75eeb9e91d52d0063537"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a01275fda9ebd75eeb9e91d52d0063537">GEReq_predownload_setrecon_writekacq</a> (const <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a> *const readtrap, const <a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *const phaser, const <a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *const zphaser)</td></tr>
<tr class="separator:a01275fda9ebd75eeb9e91d52d0063537"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a415c7a5c8bc0caae269486095207382a"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a415c7a5c8bc0caae269486095207382a">GEReq_predownload_setrecon_accel</a> (const <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a> *const readtrap, const <a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *const phaser, const <a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *const zphaser, int datadestination)</td></tr>
<tr class="separator:a415c7a5c8bc0caae269486095207382a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a720f294485e798eca7bfc87fc991e934"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a720f294485e798eca7bfc87fc991e934">GEReq_predownload_setrecon_phase</a> (const <a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *const phaser, const float readfov, const int datadestination)</td></tr>
<tr class="separator:a720f294485e798eca7bfc87fc991e934"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac6d58434e3655f7314ad160a5b8cfa09"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#ac6d58434e3655f7314ad160a5b8cfa09">GEReq_predownload_setrecon_readwave</a> (const <a class="el" href="struct_k_s___r_e_a_d_w_a_v_e.html">KS_READWAVE</a> *const readwave, const int yres, int imsize_policy, int datadestination)</td></tr>
<tr class="separator:ac6d58434e3655f7314ad160a5b8cfa09"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6d51efff591f87dbcc7887e45c16db0f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a6d51efff591f87dbcc7887e45c16db0f">GEReq_predownload_setrecon_readphase</a> (const <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a> *const readtrap, const <a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *const phaser, const <a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *const zphaser, int imsize_policy, int datadestination)</td></tr>
<tr class="separator:a6d51efff591f87dbcc7887e45c16db0f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac4df6187ca227e0004dc46436145f057"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#ac4df6187ca227e0004dc46436145f057">GEReq_predownload_setrecon_annotations</a> (int tsp, int readdur, int time2center, int echogap)</td></tr>
<tr class="separator:ac4df6187ca227e0004dc46436145f057"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a99f608a4921aa9ad1baa47af182f1a66"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a99f608a4921aa9ad1baa47af182f1a66">GEReq_predownload_setrecon_annotations_readtrap</a> (<a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a> *readtrap, int echogap)</td></tr>
<tr class="separator:a99f608a4921aa9ad1baa47af182f1a66"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a64c7c04147ac9eef0043d6d76fc0f8f6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a64c7c04147ac9eef0043d6d76fc0f8f6">GEReq_predownload_setrecon_annotations_epi</a> (<a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *epi, int echogap)</td></tr>
<tr class="separator:a64c7c04147ac9eef0043d6d76fc0f8f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a37444b7139828ceb7a66e6755c506b84"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a37444b7139828ceb7a66e6755c506b84">GEReq_predownload_setrecon_voldata</a> (int numvols, const <a class="el" href="struct_k_s___s_l_i_c_e___p_l_a_n.html">KS_SLICE_PLAN</a> slice_plan)</td></tr>
<tr class="separator:a37444b7139828ceb7a66e6755c506b84"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7e6590863fa011fcf114dff217edc807"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a7e6590863fa011fcf114dff217edc807">GEReq_predownload_setrecon_epi</a> (<a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *epi, int numvols2store, const <a class="el" href="struct_k_s___s_l_i_c_e___p_l_a_n.html">KS_SLICE_PLAN</a> slice_plan, int echogap, int blipsign, int datadestination, int multishotflag, int ghostcorrflag, int imsize_policy)</td></tr>
<tr class="separator:a7e6590863fa011fcf114dff217edc807"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a67a331f96035253e5efbb3e2f2ad3f24"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a67a331f96035253e5efbb3e2f2ad3f24">GEReq_cvinit</a> (void)</td></tr>
<tr class="separator:a67a331f96035253e5efbb3e2f2ad3f24"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8e619b6a6b2266ea62b80c18280c5427"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a8e619b6a6b2266ea62b80c18280c5427">GEReq_cveval</a> (void)</td></tr>
<tr class="separator:a8e619b6a6b2266ea62b80c18280c5427"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a91a41d02810ad2b4d7ce00ab3adbdf72"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a91a41d02810ad2b4d7ce00ab3adbdf72">GEReq_cvcheck</a> (void)</td></tr>
<tr class="separator:a91a41d02810ad2b4d7ce00ab3adbdf72"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a994265c9b567cd3c6e5da34ad737dd4b"><td class="memItemLeft" align="right" valign="top">STATUS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a994265c9b567cd3c6e5da34ad737dd4b">GEReq_predownload</a> (void)</td></tr>
<tr class="separator:a994265c9b567cd3c6e5da34ad737dd4b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4d749446ac125194ceedcf63f9e10d57"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a4d749446ac125194ceedcf63f9e10d57">GEReq_pulsegenBegin</a> (void)</td></tr>
<tr class="separator:a4d749446ac125194ceedcf63f9e10d57"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9de74bec730c62cf3047e59473b86eec"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a9de74bec730c62cf3047e59473b86eec">GEReq_pulsegenEnd</a> (void)</td></tr>
<tr class="separator:a9de74bec730c62cf3047e59473b86eec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7d88db21119d2904e811676cff0a49a5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a7d88db21119d2904e811676cff0a49a5">GEReq_endofpass</a> ()</td></tr>
<tr class="separator:a7d88db21119d2904e811676cff0a49a5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a349421a095321de0c03b689de1802bce"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a349421a095321de0c03b689de1802bce">GEReq_endofscan</a> ()</td></tr>
<tr class="separator:a349421a095321de0c03b689de1802bce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a37f5e1924c7f2d89e8232d8d8d03bca6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a37f5e1924c7f2d89e8232d8d8d03bca6">GEReq_endofpassandscan</a> ()</td></tr>
<tr class="separator:a37f5e1924c7f2d89e8232d8d8d03bca6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a942c05b8388a80f047a275b6011efc4c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a942c05b8388a80f047a275b6011efc4c">dummylinks</a> (void)</td></tr>
<tr class="separator:a942c05b8388a80f047a275b6011efc4c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad56ed68dab054734d4e258fc33a45b71"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#ad56ed68dab054734d4e258fc33a45b71">GEReq_initRSP</a> (void)</td></tr>
<tr class="separator:ad56ed68dab054734d4e258fc33a45b71"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a6d5abc89b8bf79b4dcf745936944adcc"><td class="memItemLeft" align="right" valign="top">RF_PULSE_INFO&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a6d5abc89b8bf79b4dcf745936944adcc">rfpulseInfo</a> [RF_FREE] = { {0, 0} }</td></tr>
<tr class="separator:a6d5abc89b8bf79b4dcf745936944adcc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aab3baee33eebda2bcf24b20846ce32a9"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#aab3baee33eebda2bcf24b20846ce32a9">avail_image_time</a></td></tr>
<tr class="separator:aab3baee33eebda2bcf24b20846ce32a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a16ede8dd5ed24fd803dc270aa22e57c5"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a16ede8dd5ed24fd803dc270aa22e57c5">act_tr</a></td></tr>
<tr class="separator:a16ede8dd5ed24fd803dc270aa22e57c5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aedd5d7c8a00be480230531f3ab5f8bdb"><td class="memItemLeft" align="right" valign="top">SCAN_INFO&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#aedd5d7c8a00be480230531f3ab5f8bdb">ks_scan_info</a> [SLTAB_MAX] = {<a class="el" href="_g_e_required_8e.html#a4c590873e5778394b3d52c4225250863">DEFAULT_AXIAL_SCAN_INFO</a>}</td></tr>
<tr class="separator:aedd5d7c8a00be480230531f3ab5f8bdb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae6527c3b5637d870c648a7703c202985"><td class="memItemLeft" align="right" valign="top"><a class="el" href="struct_k_s___s_l_i_c_e___p_l_a_n.html">KS_SLICE_PLAN</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#ae6527c3b5637d870c648a7703c202985">ks_slice_plan</a> = <a class="el" href="_k_s_foundation_8h.html#a46bcd22394cbabe45e76cc0d4af01aa9">KS_INIT_SLICEPLAN</a></td></tr>
<tr class="separator:ae6527c3b5637d870c648a7703c202985"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac2a9639645541b0daab96065b217062d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#ac2a9639645541b0daab96065b217062d">ks_sarcheckdone</a> = FALSE</td></tr>
<tr class="separator:ac2a9639645541b0daab96065b217062d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af846b49be109f687e9863f2016029516"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#af846b49be109f687e9863f2016029516">ks_psdname</a> [256]</td></tr>
<tr class="separator:af846b49be109f687e9863f2016029516"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aece7287cee904292d20da04682670ccc"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#aece7287cee904292d20da04682670ccc">ks_perform_slicetimeplot</a> = FALSE</td></tr>
<tr class="separator:aece7287cee904292d20da04682670ccc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9e27acda2e5cc865747fa56d03d8f093"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a9e27acda2e5cc865747fa56d03d8f093">obl_debug</a> = 0 with {0, 1, 0, INVIS, &quot;On(=1) to print messages for obloptimize&quot;,}</td></tr>
<tr class="separator:a9e27acda2e5cc865747fa56d03d8f093"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a94b591f7f68b50312c2701df4d04b081"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a94b591f7f68b50312c2701df4d04b081">obl_method</a> = PSD_OBL_OPTIMAL with {PSD_OBL_RESTRICT, PSD_OBL_OPTIMAL, PSD_OBL_OPTIMAL, INVIS, &quot;On(=1) to optimize the targets based on actual rotation matrices&quot;,}</td></tr>
<tr class="separator:a94b591f7f68b50312c2701df4d04b081"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acfc18720dc0665e3e655b44e43c77b0f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#acfc18720dc0665e3e655b44e43c77b0f">filter_echo1</a> = 0 with {, , , INVIS, &quot;Scan filter slot number needed for prescan&quot;,}</td></tr>
<tr class="separator:acfc18720dc0665e3e655b44e43c77b0f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7efee96b237a605f9af1bbf8a6245451"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a7efee96b237a605f9af1bbf8a6245451">pw_passpacket</a> = 50ms with {10ms, 1000ms, 50ms, VIS, &quot;Duration of the passpacket sequence&quot;,}</td></tr>
<tr class="separator:a7efee96b237a605f9af1bbf8a6245451"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad5a93fbe6bb94b609d6d915d2c0247f7"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#ad5a93fbe6bb94b609d6d915d2c0247f7">ks_rfconf</a> = ENBL_RHO1 + ENBL_THETA + ENBL_OMEGA + ENBL_OMEGA_FREQ_XTR1</td></tr>
<tr class="separator:ad5a93fbe6bb94b609d6d915d2c0247f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a01c4c91785086ec18a8fc39595e22f0d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a01c4c91785086ec18a8fc39595e22f0d">ks_simscan</a> = 1 with {0, 1, 1, VIS, &quot;Simulate slice locations if 1 (and in simulation)&quot;,}</td></tr>
<tr class="separator:a01c4c91785086ec18a8fc39595e22f0d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac2162634eabe08843c90d8cf8a135042"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#ac2162634eabe08843c90d8cf8a135042">ks_srfact</a> = 1.0 with {0.01, 3.0, 1.0, VIS, &quot;Slewrate factor (low value = slower gradients)&quot;,}</td></tr>
<tr class="separator:ac2162634eabe08843c90d8cf8a135042"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7506e6224f5036fb1941843536b6f4a6"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a7506e6224f5036fb1941843536b6f4a6">ks_qfact</a> = 1.0 with {0.1, 40.0, 1.0, VIS, &quot;Quietness factor&quot;,}</td></tr>
<tr class="separator:a7506e6224f5036fb1941843536b6f4a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7ca8f149618c5cab125f422cd627c433"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a7ca8f149618c5cab125f422cd627c433">ks_gheatfact</a> = 1.0 with {0.0, 1.0, 1.0, VIS, &quot;Degree of honoring gradient heating calculations (0:ignore, 1:fully obey)&quot;}</td></tr>
<tr class="separator:a7ca8f149618c5cab125f422cd627c433"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adf724d7e25607bea3d8bf36bb6f8060d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#adf724d7e25607bea3d8bf36bb6f8060d">ks_plot_filefmt</a> = <a class="el" href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5fae199cefaae88fb3ffc5eee3109bbe3d7">KS_PLOT_MAKEPNG</a> with {<a class="el" href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5fadd75ba7d05d9527ea99f8643787d46ac">KS_PLOT_OFF</a>,<a class="el" href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5fae199cefaae88fb3ffc5eee3109bbe3d7">KS_PLOT_MAKEPNG</a>,<a class="el" href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5fae199cefaae88fb3ffc5eee3109bbe3d7">KS_PLOT_MAKEPNG</a>, VIS, &quot;Plot format 0:off 1:PDF 2:SVG 3:PNG&quot;}</td></tr>
<tr class="separator:adf724d7e25607bea3d8bf36bb6f8060d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad3bedeb2f38e3e2bcce90c31354a91d6"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#ad3bedeb2f38e3e2bcce90c31354a91d6">ks_plot_kstmp</a> = FALSE with {FALSE,TRUE,FALSE, VIS, &quot;0: off 1:Copy plots to mrraw/kstmp&quot;}</td></tr>
<tr class="separator:ad3bedeb2f38e3e2bcce90c31354a91d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5dfe9b1d5c3f79c53ef1e8513159ce18"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a5dfe9b1d5c3f79c53ef1e8513159ce18">maxB1</a> [<a class="el" href="_g_e_required_8e.html#a43ed1aedaae548fba169071b1c911983">MAX_ENTRY_POINTS</a>]</td></tr>
<tr class="separator:a5dfe9b1d5c3f79c53ef1e8513159ce18"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b1fc3ed469d5e2aaf046d9e17d72734"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a9b1fc3ed469d5e2aaf046d9e17d72734">maxB1Seq</a></td></tr>
<tr class="separator:a9b1fc3ed469d5e2aaf046d9e17d72734"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a546f02bf651781d02eea564390dfbd28"><td class="memItemLeft" align="right" valign="top">short&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a546f02bf651781d02eea564390dfbd28">debugstate</a></td></tr>
<tr class="separator:a546f02bf651781d02eea564390dfbd28"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a61baa55d5fb7d85e3ce00c63a279741d"><td class="memItemLeft" align="right" valign="top">short&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a61baa55d5fb7d85e3ce00c63a279741d">viewtable</a> [513]</td></tr>
<tr class="separator:a61baa55d5fb7d85e3ce00c63a279741d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae24c5d48aac45ac963ee37a5e9c51f08"><td class="memItemLeft" align="right" valign="top">PSD_EXIT_ARG&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#ae24c5d48aac45ac963ee37a5e9c51f08">psdexitarg</a></td></tr>
<tr class="separator:ae24c5d48aac45ac963ee37a5e9c51f08"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adbed7cbe302ef957a49dead6990d286f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#adbed7cbe302ef957a49dead6990d286f">rspent</a></td></tr>
<tr class="separator:adbed7cbe302ef957a49dead6990d286f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8eb9f37d56ba1ee0e7d05fdb45ee2eec"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a8eb9f37d56ba1ee0e7d05fdb45ee2eec">rspdda</a></td></tr>
<tr class="separator:a8eb9f37d56ba1ee0e7d05fdb45ee2eec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acf2311e6e88cda04fe6cbccd5b111251"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#acf2311e6e88cda04fe6cbccd5b111251">rspbas</a></td></tr>
<tr class="separator:acf2311e6e88cda04fe6cbccd5b111251"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6dfbf5d299a2ad43ca362ba50ee04009"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a6dfbf5d299a2ad43ca362ba50ee04009">rspvus</a></td></tr>
<tr class="separator:a6dfbf5d299a2ad43ca362ba50ee04009"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a78783810e215eb88373e39826c8fbcdf"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a78783810e215eb88373e39826c8fbcdf">rspgy1</a></td></tr>
<tr class="separator:a78783810e215eb88373e39826c8fbcdf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68f63429e4ed34d99e869e97784395a2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a68f63429e4ed34d99e869e97784395a2">rspasl</a></td></tr>
<tr class="separator:a68f63429e4ed34d99e869e97784395a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7e34e1f01390e268d94098834bc92665"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a7e34e1f01390e268d94098834bc92665">rspesl</a></td></tr>
<tr class="separator:a7e34e1f01390e268d94098834bc92665"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a59a6767a101d64662267c1c97abcb45f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a59a6767a101d64662267c1c97abcb45f">rspchp</a></td></tr>
<tr class="separator:a59a6767a101d64662267c1c97abcb45f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3ed03b6597358f5effb634c614bfdb64"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a3ed03b6597358f5effb634c614bfdb64">rspnex</a></td></tr>
<tr class="separator:a3ed03b6597358f5effb634c614bfdb64"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6b066a985730eb2ab973c6e41f1c1980"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a6b066a985730eb2ab973c6e41f1c1980">rspslq</a></td></tr>
<tr class="separator:a6b066a985730eb2ab973c6e41f1c1980"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac200bf912818c3a16c89b0fb4afdeacb"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#ac200bf912818c3a16c89b0fb4afdeacb">rspsct</a></td></tr>
<tr class="separator:ac200bf912818c3a16c89b0fb4afdeacb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a47b4e2484af16aab79c3eed3ab8eaece"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a47b4e2484af16aab79c3eed3ab8eaece">rsprep</a></td></tr>
<tr class="separator:a47b4e2484af16aab79c3eed3ab8eaece"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa2e40d6d2214b308eaf81d7253a54150"><td class="memItemLeft" align="right" valign="top">short&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#aa2e40d6d2214b308eaf81d7253a54150">chopamp</a></td></tr>
<tr class="separator:aa2e40d6d2214b308eaf81d7253a54150"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5b178b120a91fef15ac5ee30dd89577f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a5b178b120a91fef15ac5ee30dd89577f">seqCount</a></td></tr>
<tr class="separator:a5b178b120a91fef15ac5ee30dd89577f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1cb6f035a0e9565bbf12c3ef04c3c229"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a1cb6f035a0e9565bbf12c3ef04c3c229">view</a></td></tr>
<tr class="separator:a1cb6f035a0e9565bbf12c3ef04c3c229"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad96345992234a045c9b3cdff8432f94c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#ad96345992234a045c9b3cdff8432f94c">excitation</a></td></tr>
<tr class="separator:ad96345992234a045c9b3cdff8432f94c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac3e1795766a80ec63b157951b4b9a7d4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a></td></tr>
<tr class="separator:ac3e1795766a80ec63b157951b4b9a7d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7d63954ff7232fb00cbf2904576cde75"><td class="memItemLeft" align="right" valign="top">CHAR *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_g_e_required_8e.html#a7d63954ff7232fb00cbf2904576cde75">entry_name_list</a> [ENTRY_POINT_MAX]</td></tr>
<tr class="separator:a7d63954ff7232fb00cbf2904576cde75"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This file has several sections that should be @inline'd for a main pulse sequence written entirely in KSFoundation EPIC. See instructions for each section on where to @inline. </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a4b4a61d24419e8929c363a2e9445b516"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4b4a61d24419e8929c363a2e9445b516">&#9670;&nbsp;</a></span>seq_name</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define seq_name&#160;&#160;&#160;]_set</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ad08ee889e7f476726128551c60c37c30"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad08ee889e7f476726128551c60c37c30">&#9670;&nbsp;</a></span>GEREQUIRED_E</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define GEREQUIRED_E</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a43ed1aedaae548fba169071b1c911983"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a43ed1aedaae548fba169071b1c911983">&#9670;&nbsp;</a></span>MAX_ENTRY_POINTS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_ENTRY_POINTS&#160;&#160;&#160;15</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a6aa2d3622908f1dd32bd380b28f1aa3a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6aa2d3622908f1dd32bd380b28f1aa3a">&#9670;&nbsp;</a></span>MAX_TR_OVERSHOOT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_TR_OVERSHOOT&#160;&#160;&#160;200 /* 200 us round-up allowed per TR */</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="aef66154f8c9725d4b95ddd70689465c2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aef66154f8c9725d4b95ddd70689465c2">&#9670;&nbsp;</a></span>DEFAULT_SCAN_INFO_HEAD</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEFAULT_SCAN_INFO_HEAD&#160;&#160;&#160;.optloc = 0.0, .oprloc = 0.0, .opphasoff = 0.0</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a4c590873e5778394b3d52c4225250863"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4c590873e5778394b3d52c4225250863">&#9670;&nbsp;</a></span>DEFAULT_AXIAL_SCAN_INFO</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEFAULT_AXIAL_SCAN_INFO</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">{ <a class="code" href="_g_e_required_8e.html#aef66154f8c9725d4b95ddd70689465c2">DEFAULT_SCAN_INFO_HEAD</a>, .oprot = {1.0, 0.0, 0.0, \</div><div class="line">                                                                    0.0, 1.0, 0.0, \</div><div class="line">                                                                    0.0, 0.0, 1.0}}</div><div class="ttc" id="_g_e_required_8e_html_aef66154f8c9725d4b95ddd70689465c2"><div class="ttname"><a href="_g_e_required_8e.html#aef66154f8c9725d4b95ddd70689465c2">DEFAULT_SCAN_INFO_HEAD</a></div><div class="ttdeci">#define DEFAULT_SCAN_INFO_HEAD</div><div class="ttdef"><b>Definition:</b> GERequired.e:145</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a82c2fa6d6c5d54c510859d52aff5ba93"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a82c2fa6d6c5d54c510859d52aff5ba93">&#9670;&nbsp;</a></span>DEFAULT_AX_SCAN_INFO_FREQ_LR</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEFAULT_AX_SCAN_INFO_FREQ_LR&#160;&#160;&#160;<a class="el" href="_g_e_required_8e.html#a4c590873e5778394b3d52c4225250863">DEFAULT_AXIAL_SCAN_INFO</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a00e2a3c0d4b96dda4b9d0cddd8bcbd6a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a00e2a3c0d4b96dda4b9d0cddd8bcbd6a">&#9670;&nbsp;</a></span>DEFAULT_AX_SCAN_INFO_FREQ_AP</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEFAULT_AX_SCAN_INFO_FREQ_AP</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">{ <a class="code" href="_g_e_required_8e.html#aef66154f8c9725d4b95ddd70689465c2">DEFAULT_SCAN_INFO_HEAD</a>, .oprot = {0.0, 1.0, 0.0, \</div><div class="line">                                                                        -1.0, 0.0, 0.0, \</div><div class="line">                                                                         0.0, 0.0, 1.0}}</div><div class="ttc" id="_g_e_required_8e_html_aef66154f8c9725d4b95ddd70689465c2"><div class="ttname"><a href="_g_e_required_8e.html#aef66154f8c9725d4b95ddd70689465c2">DEFAULT_SCAN_INFO_HEAD</a></div><div class="ttdeci">#define DEFAULT_SCAN_INFO_HEAD</div><div class="ttdef"><b>Definition:</b> GERequired.e:145</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a98c72b79cd55dc14b2eeab198169e7c2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a98c72b79cd55dc14b2eeab198169e7c2">&#9670;&nbsp;</a></span>DEFAULT_SAG_SCAN_INFO_FREQ_SI</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEFAULT_SAG_SCAN_INFO_FREQ_SI</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">{ <a class="code" href="_g_e_required_8e.html#aef66154f8c9725d4b95ddd70689465c2">DEFAULT_SCAN_INFO_HEAD</a>, .oprot = {0.0, 0.0, 1.0, \</div><div class="line">                                                                          0.0, 1.0, 0.0, \</div><div class="line">                                                                         -1.0, 0.0, 0.0}}</div><div class="ttc" id="_g_e_required_8e_html_aef66154f8c9725d4b95ddd70689465c2"><div class="ttname"><a href="_g_e_required_8e.html#aef66154f8c9725d4b95ddd70689465c2">DEFAULT_SCAN_INFO_HEAD</a></div><div class="ttdeci">#define DEFAULT_SCAN_INFO_HEAD</div><div class="ttdef"><b>Definition:</b> GERequired.e:145</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9241e753c3188137dbd972aa8e7f6c81"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9241e753c3188137dbd972aa8e7f6c81">&#9670;&nbsp;</a></span>DEFAULT_SAG_SCAN_INFO_FREQ_AP</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEFAULT_SAG_SCAN_INFO_FREQ_AP</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">{ <a class="code" href="_g_e_required_8e.html#aef66154f8c9725d4b95ddd70689465c2">DEFAULT_SCAN_INFO_HEAD</a>, .oprot = {0.0, 0.0, 1.0, \</div><div class="line">                                                                          1.0, 0.0, 0.0, \</div><div class="line">                                                                          0.0, 1.0, 0.0}}</div><div class="ttc" id="_g_e_required_8e_html_aef66154f8c9725d4b95ddd70689465c2"><div class="ttname"><a href="_g_e_required_8e.html#aef66154f8c9725d4b95ddd70689465c2">DEFAULT_SCAN_INFO_HEAD</a></div><div class="ttdeci">#define DEFAULT_SCAN_INFO_HEAD</div><div class="ttdef"><b>Definition:</b> GERequired.e:145</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6a24ad3629eb58c819f00004c53a89df"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6a24ad3629eb58c819f00004c53a89df">&#9670;&nbsp;</a></span>DEFAULT_COR_SCAN_INFO_FREQ_SI</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEFAULT_COR_SCAN_INFO_FREQ_SI</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">{ <a class="code" href="_g_e_required_8e.html#aef66154f8c9725d4b95ddd70689465c2">DEFAULT_SCAN_INFO_HEAD</a>, .oprot = {0.0, 1.0, 0.0, \</div><div class="line">                                                                          0.0, 0.0, 1.0, \</div><div class="line">                                                                          1.0, 0.0, 0.0}}</div><div class="ttc" id="_g_e_required_8e_html_aef66154f8c9725d4b95ddd70689465c2"><div class="ttname"><a href="_g_e_required_8e.html#aef66154f8c9725d4b95ddd70689465c2">DEFAULT_SCAN_INFO_HEAD</a></div><div class="ttdeci">#define DEFAULT_SCAN_INFO_HEAD</div><div class="ttdef"><b>Definition:</b> GERequired.e:145</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a957fcaa766318f5df217d814212f9d39"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a957fcaa766318f5df217d814212f9d39">&#9670;&nbsp;</a></span>DEFAULT_COR_SCAN_INFO_FREQ_LR</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEFAULT_COR_SCAN_INFO_FREQ_LR</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">{ <a class="code" href="_g_e_required_8e.html#aef66154f8c9725d4b95ddd70689465c2">DEFAULT_SCAN_INFO_HEAD</a>, .oprot = {-1.0, 0.0, 0.0, \</div><div class="line">                                                                           0.0, 0.0, 1.0, \</div><div class="line">                                                                           0.0, 1.0, 0.0}}</div><div class="ttc" id="_g_e_required_8e_html_aef66154f8c9725d4b95ddd70689465c2"><div class="ttname"><a href="_g_e_required_8e.html#aef66154f8c9725d4b95ddd70689465c2">DEFAULT_SCAN_INFO_HEAD</a></div><div class="ttdeci">#define DEFAULT_SCAN_INFO_HEAD</div><div class="ttdef"><b>Definition:</b> GERequired.e:145</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ada215f0345c9bef915020f3e381daa74"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ada215f0345c9bef915020f3e381daa74">&#9670;&nbsp;</a></span>KS_PSD_USE_APX</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KS_PSD_USE_APX&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ab1fe30ecb27b541de01992692c1e9a47"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab1fe30ecb27b541de01992692c1e9a47">&#9670;&nbsp;</a></span>KS_SEQLENGTH()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">KS_SEQLENGTH </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_g_e_required_8e.html#a4b4a61d24419e8929c363a2e9445b516">seq_name</a>&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">seq_struct&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Creates a hardware sequence for the current sequence module</h4>
</p>
<p>This EPIC macro is adapted from GE's EPIC macro <code>SEQLENGTH</code>. The <code>seqctrl</code> (<a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a>) struct for the current sequence module is passed in as the second argument to this function, where <code>seqctrl.duration</code> holds the information on the duration of the sequence module and passed on to <code>createseq()</code>. During scanning, <a class="el" href="_k_s_foundation_8h.html#a02e188307a4bd9dfdb00d37688c0487e">ks_scan_playsequence()</a>, which takes a <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> struct as input, internally calls <code><a class="el" href="_k_s_foundation__tgt_8c.html#a17778e7ed4abcb39ee14e9e4d2966b18">boffset()</a></code> to make a real-time hardware switch to this sequence module by passing in <code>seqctrl.handle.offset</code> set by <a class="el" href="_g_e_required_8e.html#ab1fe30ecb27b541de01992692c1e9a47" title="Creates a hardware sequence for the current sequence module">KS_SEQLENGTH()</a>.</p>
<p><a class="el" href="_g_e_required_8e.html#ab1fe30ecb27b541de01992692c1e9a47" title="Creates a hardware sequence for the current sequence module">KS_SEQLENGTH()</a> must be called in <code><a class="el" href="ksepi_8e.html#a9229731c099971b90dbf7721bad586a9">pulsegen()</a></code> after the sequence (module) has been layed out using various <code>ks_pg_***</code> calls. It must also be after <a class="el" href="_g_e_required_8e.html#a4d749446ac125194ceedcf63f9e10d57" title="Helper function to be called at the beginning of pulsegen()">GEReq_pulsegenBegin()</a> and before <a class="el" href="_g_e_required_8e.html#a9de74bec730c62cf3047e59473b86eec" title="Helper function to be called at the end of pulsegen()">GEReq_pulsegenEnd()</a> and <code>buildinstr()</code>. The first argument to <a class="el" href="_g_e_required_8e.html#ab1fe30ecb27b541de01992692c1e9a47" title="Creates a hardware sequence for the current sequence module">KS_SEQLENGTH()</a> is GE's name of the pulse sequence module, which by convention usually begins with "seq***". The hardware sequence handle is then named <code>off_seq***</code> and this handle is stored in <code>seqctrl.handle.offset</code>.</p>
<h4>EPIC macro Parameters</h4>
<ul>
<li>arg 1: Name of the sequence module (only used for this function call)</li>
<li>arg 2: The <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> struct for the current sequence module </li>
</ul>
<div class="fragment"><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;                                   {</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;var: {</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="preprocessor">#ifndef $[seq_name]_set</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="preprocessor">#define $[seq_name]_set</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="preprocessor">#error KS_SEQLENGTH: Sequence name $[seq_name] (arg 1) already taken</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    SEQUENCE_ENTRIES  off_$[<a class="code" href="_g_e_required_8e.html#a4b4a61d24419e8929c363a2e9445b516">seq_name</a>];</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    WF_PULSE $[<a class="code" href="_g_e_required_8e.html#a4b4a61d24419e8929c363a2e9445b516">seq_name</a>];</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="preprocessor">#if defined(HOST_TGT)</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="keywordtype">int</span> idx_$[<a class="code" href="_g_e_required_8e.html#a4b4a61d24419e8929c363a2e9445b516">seq_name</a>];   <span class="comment">/* sequence entry index */</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  }</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;insert: <a class="code" href="ksepi_8e.html#a6dab68043b9947b6a659f72613c083ec">predownload</a> =&gt; {</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <span class="comment">/* dont indent the closing bracket */</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;}</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;insert: <a class="code" href="ksepi_8e.html#ab86d8a9c08d382dc537ec69e0f1cc9dc">cvinit</a> =&gt; {</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <span class="comment">/* dont indent the closing bracket */</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;}</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;subst: {</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    {</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;      <span class="keywordflow">if</span> ($[seq_struct].duration &gt; 0) {</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        <span class="keywordflow">if</span> ($[seq_struct].duration - $[seq_struct].ssi_time &lt; 0) {</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;          <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;KS_SEQLENGTH (%s): (.duration - .ssi_time) is negative&quot;</span>, $[seq_struct].description);</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;          STATUS status = pulsename(&amp;$[<a class="code" href="_g_e_required_8e.html#a4b4a61d24419e8929c363a2e9445b516">seq_name</a>], <span class="stringliteral">&quot;$[seq_name]&quot;</span>);</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;          <span class="keywordflow">if</span> (status != SUCCESS) {</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;            <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;KS_SEQLENGTH (%s): pulsename($[seq_name]) failed&quot;</span>, $[seq_struct].description);</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;          }  </div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;          status = createseq(&amp;$[<a class="code" href="_g_e_required_8e.html#a4b4a61d24419e8929c363a2e9445b516">seq_name</a>], $[seq_struct].duration - $[seq_struct].ssi_time, off_$[<a class="code" href="_g_e_required_8e.html#a4b4a61d24419e8929c363a2e9445b516">seq_name</a>]);</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;          <span class="keywordflow">if</span> (status != SUCCESS) {</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;            <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;KS_SEQLENGTH (%s): createseq($[seq_name]) failed&quot;</span>, $[seq_struct].description);</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;          } </div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="preprocessor">#if defined(HOST_TGT)</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;          <span class="comment">/* Update sequence counter and get current sequence entry index */</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;          status = updateIndex( &amp;idx_$[<a class="code" href="_g_e_required_8e.html#a4b4a61d24419e8929c363a2e9445b516">seq_name</a>] );</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;          <span class="keywordflow">if</span> (status != SUCCESS) {</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;            <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;KS_SEQLENGTH (%s): updateIndex($[seq_name]) failed&quot;</span>, $[seq_struct].description);</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;          }</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;          printDebug( DBLEVEL1, (dbLevel_t)seg_debug, <span class="stringliteral">&quot;KS_SEQLENGTH&quot;</span>,</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                      <span class="stringliteral">&quot;idx_$[seq_name] = %d\n&quot;</span>, idx_$[<a class="code" href="_g_e_required_8e.html#a4b4a61d24419e8929c363a2e9445b516">seq_name</a>] );</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;          $[seq_struct].handle.index = idx_$[<a class="code" href="_g_e_required_8e.html#a4b4a61d24419e8929c363a2e9445b516">seq_name</a>];</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;          <span class="comment">/* copy seqyence_enties to the KS_SEQ seq_struct */</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;          $[seq_struct].handle.offset = off_$[<a class="code" href="_g_e_required_8e.html#a4b4a61d24419e8929c363a2e9445b516">seq_name</a>];</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;          $[seq_struct].handle.pulse = &amp;$[<a class="code" href="_g_e_required_8e.html#a4b4a61d24419e8929c363a2e9445b516">seq_name</a>];</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        } <span class="comment">/* duration - ssi_time &gt; 0 */</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;      } <span class="comment">/* duration &gt; 0 */</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    }</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  }</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;}</div><div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="ksepi_8e_html_a6dab68043b9947b6a659f72613c083ec"><div class="ttname"><a href="ksepi_8e.html#a6dab68043b9947b6a659f72613c083ec">predownload</a></div><div class="ttdeci">STATUS predownload(void)</div><div class="ttdef"><b>Definition:</b> ksepi.e:227</div></div>
<div class="ttc" id="_g_e_required_8e_html_a4b4a61d24419e8929c363a2e9445b516"><div class="ttname"><a href="_g_e_required_8e.html#a4b4a61d24419e8929c363a2e9445b516">seq_name</a></div><div class="ttdeci">#define seq_name</div></div>
<div class="ttc" id="ksepi_8e_html_ab86d8a9c08d382dc537ec69e0f1cc9dc"><div class="ttname"><a href="ksepi_8e.html#ab86d8a9c08d382dc537ec69e0f1cc9dc">cvinit</a></div><div class="ttdeci">STATUS cvinit(void)</div><div class="ttdef"><b>Definition:</b> ksepi.e:85</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9b2fe5b383ca739e400124ee465fa26e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9b2fe5b383ca739e400124ee465fa26e">&#9670;&nbsp;</a></span>calcPulseParams()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ifndef EPIC_RELEASE_IS_25x ifndef EPIC_RELEASE_IS_24x endif endif STATUS calcPulseParams </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Mandatory GE function. Includes predownload.in</h4>
</p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                             {</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;} <span class="comment">/* calcPulseParams() */</span></div></div><!-- fragment -->
</div>
</div>
<a id="a9e0525cfd14e06359ddb8fe37ad965f5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9e0525cfd14e06359ddb8fe37ad965f5">&#9670;&nbsp;</a></span>simscan()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS simscan </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Simulate scan locations in simulation (WTools)</h4>
</p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                     {</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="preprocessor">#ifndef PSD_HW</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  <span class="keywordtype">int</span> i, j;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  <span class="keywordtype">int</span> num_slice;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <span class="keywordtype">float</span> z_delta;    <span class="comment">/* change in z_loc between slices */</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  <span class="keywordtype">float</span> r_delta;    <span class="comment">/* change in r_loc between slices */</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  <span class="keywordtype">double</span> alpha, beta, gamma; <span class="comment">/* rotation angles about x, y, z respectively */</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  num_slice = opslquant;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  r_delta = <a class="code" href="_k_s_foundation__common_8c.html#ad3c11a6737769e103948d107c1263749">opfov</a> / num_slice;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  z_delta = <a class="code" href="_k_s_foundation__common_8c.html#a04f737cdd207318e145bbed14eb487ae">opslthick</a> + opslspace;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  <a class="code" href="_g_e_required_8e.html#aedd5d7c8a00be480230531f3ab5f8bdb">ks_scan_info</a>[0].optloc = - 0.5 * z_delta * (num_slice - 1);</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  <a class="code" href="_g_e_required_8e.html#aedd5d7c8a00be480230531f3ab5f8bdb">ks_scan_info</a>[0].oprloc = 0;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  <span class="keywordflow">for</span> (i = 1; i &lt; 9; i++)</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <a class="code" href="_g_e_required_8e.html#aedd5d7c8a00be480230531f3ab5f8bdb">ks_scan_info</a>[0].oprot[i] = 0.0;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  <span class="keywordflow">switch</span> (exist(opplane)) {</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  <span class="keywordflow">case</span> PSD_AXIAL:</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <a class="code" href="_g_e_required_8e.html#aedd5d7c8a00be480230531f3ab5f8bdb">ks_scan_info</a>[0].oprot[0] = 1.0;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <a class="code" href="_g_e_required_8e.html#aedd5d7c8a00be480230531f3ab5f8bdb">ks_scan_info</a>[0].oprot[4] = 1.0;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <a class="code" href="_g_e_required_8e.html#aedd5d7c8a00be480230531f3ab5f8bdb">ks_scan_info</a>[0].oprot[8] = 1.0;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  <span class="keywordflow">case</span> PSD_SAG:</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <a class="code" href="_g_e_required_8e.html#aedd5d7c8a00be480230531f3ab5f8bdb">ks_scan_info</a>[0].oprot[2] = 1.0;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <a class="code" href="_g_e_required_8e.html#aedd5d7c8a00be480230531f3ab5f8bdb">ks_scan_info</a>[0].oprot[4] = 1.0;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <a class="code" href="_g_e_required_8e.html#aedd5d7c8a00be480230531f3ab5f8bdb">ks_scan_info</a>[0].oprot[6] = 1.0;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  <span class="keywordflow">case</span> PSD_COR:</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <a class="code" href="_g_e_required_8e.html#aedd5d7c8a00be480230531f3ab5f8bdb">ks_scan_info</a>[0].oprot[2] = 1.0;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <a class="code" href="_g_e_required_8e.html#aedd5d7c8a00be480230531f3ab5f8bdb">ks_scan_info</a>[0].oprot[6] = 1.0;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <a class="code" href="_g_e_required_8e.html#aedd5d7c8a00be480230531f3ab5f8bdb">ks_scan_info</a>[0].oprot[7] = 1.0;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  <span class="keywordflow">case</span> PSD_OBL:</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    alpha = PI / 4.0; <span class="comment">/* rotation about x (applied first) */</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    beta = 0;   <span class="comment">/* rotation about y (applied 2nd) */</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    gamma = 0;  <span class="comment">/* rotation about z (applied 3rd) */</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <a class="code" href="_g_e_required_8e.html#aedd5d7c8a00be480230531f3ab5f8bdb">ks_scan_info</a>[0].oprot[0] = cos(gamma) * cos(beta);</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <a class="code" href="_g_e_required_8e.html#aedd5d7c8a00be480230531f3ab5f8bdb">ks_scan_info</a>[0].oprot[1] = cos(gamma) * sin(beta) * sin(alpha) -</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                            sin(gamma) * cos(alpha);</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <a class="code" href="_g_e_required_8e.html#aedd5d7c8a00be480230531f3ab5f8bdb">ks_scan_info</a>[0].oprot[2] = cos(gamma) * sin(beta) * cos(alpha) +</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                            sin(gamma) * sin(alpha);</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <a class="code" href="_g_e_required_8e.html#aedd5d7c8a00be480230531f3ab5f8bdb">ks_scan_info</a>[0].oprot[3] = sin(gamma) * cos(beta);</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <a class="code" href="_g_e_required_8e.html#aedd5d7c8a00be480230531f3ab5f8bdb">ks_scan_info</a>[0].oprot[4] = sin(gamma) * sin(beta) * sin(alpha) +</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                            cos(gamma) * cos(alpha);</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <a class="code" href="_g_e_required_8e.html#aedd5d7c8a00be480230531f3ab5f8bdb">ks_scan_info</a>[0].oprot[5] = sin(gamma) * sin(beta) * cos(alpha) -</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                            cos(gamma) * sin(alpha);</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <a class="code" href="_g_e_required_8e.html#aedd5d7c8a00be480230531f3ab5f8bdb">ks_scan_info</a>[0].oprot[6] = -sin(beta);</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <a class="code" href="_g_e_required_8e.html#aedd5d7c8a00be480230531f3ab5f8bdb">ks_scan_info</a>[0].oprot[7] = cos(beta) * sin(alpha);</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <a class="code" href="_g_e_required_8e.html#aedd5d7c8a00be480230531f3ab5f8bdb">ks_scan_info</a>[0].oprot[8] = cos(beta) * cos(alpha);</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  }</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  <span class="keywordflow">for</span> (i = 1; i &lt; num_slice; i++) {</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <a class="code" href="_g_e_required_8e.html#aedd5d7c8a00be480230531f3ab5f8bdb">ks_scan_info</a>[i].optloc = <a class="code" href="_g_e_required_8e.html#aedd5d7c8a00be480230531f3ab5f8bdb">ks_scan_info</a>[i - 1].optloc + z_delta;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <a class="code" href="_g_e_required_8e.html#aedd5d7c8a00be480230531f3ab5f8bdb">ks_scan_info</a>[i].oprloc = i * r_delta;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="keywordflow">for</span> (j = 0; j &lt; 9; j++)</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;      <a class="code" href="_g_e_required_8e.html#aedd5d7c8a00be480230531f3ab5f8bdb">ks_scan_info</a>[i].oprot[j] = <a class="code" href="_g_e_required_8e.html#aedd5d7c8a00be480230531f3ab5f8bdb">ks_scan_info</a>[0].oprot[j];</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  }</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* ifdef SIM */</span><span class="preprocessor"></span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;} <span class="comment">/* simscan() */</span></div><div class="ttc" id="_g_e_required_8e_html_aedd5d7c8a00be480230531f3ab5f8bdb"><div class="ttname"><a href="_g_e_required_8e.html#aedd5d7c8a00be480230531f3ab5f8bdb">ks_scan_info</a></div><div class="ttdeci">SCAN_INFO ks_scan_info[SLTAB_MAX]</div><div class="ttdef"><b>Definition:</b> GERequired.e:212</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_ad3c11a6737769e103948d107c1263749"><div class="ttname"><a href="_k_s_foundation__common_8c.html#ad3c11a6737769e103948d107c1263749">opfov</a></div><div class="ttdeci">float opfov</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a04f737cdd207318e145bbed14eb487ae"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a04f737cdd207318e145bbed14eb487ae">opslthick</a></div><div class="ttdeci">float opslthick</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aae6f05f5a408ae64a91705d67071e064"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aae6f05f5a408ae64a91705d67071e064">&#9670;&nbsp;</a></span>GEReq_init_gradspecs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS GEReq_init_gradspecs </td>
          <td>(</td>
          <td class="paramtype">LOG_GRAD *&#160;</td>
          <td class="paramname"><em>loggrd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PHYS_GRAD *&#160;</td>
          <td class="paramname"><em>phygrd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>srfact</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Initialize logical and physical gradient specifications</h4>
</p>
<p>This function calls inittargets() to get the physical gradient characteristics from the MR-system, followed by a call to obloptimize() (slice angulation dependence) to get the logical gradient specifications for the current slice angulation.</p>
<p>The ramp times (loggrd.xrt/yrt/zrt) are quite conservative (and longer than the ramptimes for phygrd). Preliminary testing indicates that the difference between the loggrd and phygrad structs can be reduced by a factor of two (not very scientific!) as a standard measure.</p>
<p>For further control over the slewrate, the <code>srfact</code> argument is passed to <a class="el" href="_k_s_foundation_8h.html#a71229f8ff8869fa6d2c44f34559876ae" title="Changes existing (globally used) loggrd and phygrd structs (set up by inittargets() in e...">ks_init_slewratecontrol()</a>, which can both slow down and increase the gradient slewrate.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">loggrd</td><td>The global logical gradient specification struct (dependent on slice angulation via global SCAN_INFO scan_info[] struct).</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">phygrd</td><td>The global physical gradient struct </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">srfact</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                                                                               {</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  <span class="keywordtype">int</span> initnewgeo = 1;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  <span class="comment">/* default gradient specs */</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  inittargets(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>, <a class="code" href="_k_s_foundation_8h.html#af51ba165cbaf874219789beaa48f2464">phygrd</a>);</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  <span class="comment">/* optimal loggrd based on current slice angulations */</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  <span class="keywordflow">if</span> (obloptimize(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>, <a class="code" href="_k_s_foundation_8h.html#af51ba165cbaf874219789beaa48f2464">phygrd</a>, scan_info, exist(opslquant),</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                  ((<a class="code" href="_g_e_required_8e.html#a94b591f7f68b50312c2701df4d04b081">obl_method</a>==PSD_OBL_RESTRICT) ? 4 <span class="comment">/*oblique plane*/</span> : opphysplane), exist(opcoax), (<span class="keywordtype">int</span>) <a class="code" href="_g_e_required_8e.html#a94b591f7f68b50312c2701df4d04b081">obl_method</a>,</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                  exist(<a class="code" href="_g_e_required_8e.html#a9e27acda2e5cc865747fa56d03d8f093">obl_debug</a>), &amp;initnewgeo, <a class="code" href="_k_s_foundation__host_8c.html#abf6243f7d1afc6d9684f8aeaf71b10a7">cfsrmode</a>) == FAILURE) {</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;ks_init_loggrd: obloptimize failed&quot;</span>);</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  }</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  <span class="comment">/* obloptimize() ramptimes too conservative, let&#39;s cut the difference</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="comment">     between loggrd.xrt and phygrd.xrt in half */</span></div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>-&gt;xrt = (<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>-&gt;xrt - <a class="code" href="_k_s_foundation_8h.html#af51ba165cbaf874219789beaa48f2464">phygrd</a>-&gt;xrt) / 2 + <a class="code" href="_k_s_foundation_8h.html#af51ba165cbaf874219789beaa48f2464">phygrd</a>-&gt;xrt;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>-&gt;yrt = (<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>-&gt;yrt - <a class="code" href="_k_s_foundation_8h.html#af51ba165cbaf874219789beaa48f2464">phygrd</a>-&gt;yrt) / 2 + <a class="code" href="_k_s_foundation_8h.html#af51ba165cbaf874219789beaa48f2464">phygrd</a>-&gt;yrt;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>-&gt;zrt = (<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>-&gt;zrt - <a class="code" href="_k_s_foundation_8h.html#af51ba165cbaf874219789beaa48f2464">phygrd</a>-&gt;zrt) / 2 + <a class="code" href="_k_s_foundation_8h.html#af51ba165cbaf874219789beaa48f2464">phygrd</a>-&gt;zrt;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  <span class="comment">/* reduce slewrate if srfact &lt; 1 */</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  if (<a class="code" href="_k_s_foundation_8h.html#a71229f8ff8869fa6d2c44f34559876ae">ks_init_slewratecontrol</a>(<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>, <a class="code" href="_k_s_foundation_8h.html#af51ba165cbaf874219789beaa48f2464">phygrd</a>, srfact) == FAILURE)</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;} <span class="comment">/* GEReq_init_gradspecs() */</span></div><div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="_g_e_required_8e_html_a94b591f7f68b50312c2701df4d04b081"><div class="ttname"><a href="_g_e_required_8e.html#a94b591f7f68b50312c2701df4d04b081">obl_method</a></div><div class="ttdeci">int obl_method</div><div class="ttdef"><b>Definition:</b> GERequired.e:231</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_af51ba165cbaf874219789beaa48f2464"><div class="ttname"><a href="_k_s_foundation_8h.html#af51ba165cbaf874219789beaa48f2464">phygrd</a></div><div class="ttdeci">PHYS_GRAD phygrd</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
<div class="ttc" id="_g_e_required_8e_html_a9e27acda2e5cc865747fa56d03d8f093"><div class="ttname"><a href="_g_e_required_8e.html#a9e27acda2e5cc865747fa56d03d8f093">obl_debug</a></div><div class="ttdeci">int obl_debug</div><div class="ttdef"><b>Definition:</b> GERequired.e:230</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a71229f8ff8869fa6d2c44f34559876ae"><div class="ttname"><a href="_k_s_foundation_8h.html#a71229f8ff8869fa6d2c44f34559876ae">ks_init_slewratecontrol</a></div><div class="ttdeci">STATUS ks_init_slewratecontrol(LOG_GRAD *loggrd, PHYS_GRAD *phygrd, float srfact) WARN_UNUSED_RESULT</div><div class="ttdoc">Changes existing (globally used) loggrd and phygrd structs (set up by inittargets() in e...</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:104</div></div>
<div class="ttc" id="_k_s_foundation__host_8c_html_abf6243f7d1afc6d9684f8aeaf71b10a7"><div class="ttname"><a href="_k_s_foundation__host_8c.html#abf6243f7d1afc6d9684f8aeaf71b10a7">cfsrmode</a></div><div class="ttdeci">int cfsrmode</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a05e7d139f5f41deb6ed1c934ed6c6e64"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a05e7d139f5f41deb6ed1c934ed6c6e64">&#9670;&nbsp;</a></span>GEReq_init_accelUI()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS GEReq_init_accelUI </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>integeraccel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>maxaccel</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets up the menu for parallel imaging (ARC or ASSET) with max/min range</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">integeraccel</td><td>Flag to make acceleration menu contain only integer acceleration factors enums: KS_ARCMENU_FRACTACCEL (0), KS_ARCMENU_INTACCEL (1) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">maxaccel</td><td>Maximum allowed acceleration factor for the sequence </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                                                          {</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  <span class="comment">/* Acceleration menu */</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  cfaccel_ph_maxstride = maxaccel;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  cvmax(opaccel_ph_stride, cfaccel_ph_maxstride);</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  avminaccel_ph_stride = 1.0;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  avmaxaccel_ph_stride = cfaccel_ph_maxstride;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  piarccoilrestrict = 1; <span class="comment">/* disable ARC option for single-channel coil (cf. epic.h) */</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation_8h.html#a969816ef84367f11542f3473473260dc">KS_3D_SELECTED</a>) { <span class="comment">/* PSD_3D or PSD_3DM */</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    cfaccel_sl_maxstride = maxaccel;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    cvmax(opaccel_sl_stride, cfaccel_sl_maxstride);</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    avminaccel_sl_stride = 1.0;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    avmaxaccel_sl_stride = cfaccel_sl_maxstride;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  }</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  <span class="keywordflow">if</span> ((oparc || opasset == ASSET_SCAN) &amp;&amp; maxaccel &gt; 1) {</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <span class="keywordflow">if</span> (integeraccel) {</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;      piaccel_phnub = 1 + maxaccel;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;      piaccel_phval2 = 1.0;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;      piaccel_phval3 = 2.0;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;      piaccel_phval4 = 3.0;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;      piaccel_phval5 = 4.0;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;      piaccel_phval6 = 5.0;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;      piaccel_phedit = 0; <span class="comment">/* don&#39;t allow user to type in value */</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;      piaccel_phnub = IMin(2, 6, maxaccel * 2);</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;      piaccel_phval2 = 1.0;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;      piaccel_phval3 = 1.5;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;      piaccel_phval4 = 2.0;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;      piaccel_phval5 = 2.5;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;      piaccel_phval6 = 3.0;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;      piaccel_phedit = 1;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    }</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    piaccel_ph_stride = 2.0;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation_8h.html#a969816ef84367f11542f3473473260dc">KS_3D_SELECTED</a>) {</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;      <span class="keywordflow">if</span> (integeraccel) {</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        piaccel_slnub = 1 + maxaccel;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        piaccel_slval2 = 1.0;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        piaccel_slval3 = 2.0;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        piaccel_slval4 = 3.0;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;        piaccel_slval5 = 4.0;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        piaccel_slval6 = 5.0;</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        piaccel_sledit = 0; <span class="comment">/* don&#39;t allow user to type in value */</span></div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        piaccel_slnub = IMin(2, 6, maxaccel * 2);</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        piaccel_slval2 = 1.0;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;        piaccel_slval3 = 1.5;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        piaccel_slval4 = 2.0;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        piaccel_slval5 = 2.5;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        piaccel_slval6 = 3.0;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        piaccel_sledit = 1;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;      }</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;      piaccel_sl_stride = 1.0;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;      piaccel_slnub = 0;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    }</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    piaccel_phnub = 0;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    piaccel_slnub = 0;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    cvoverride(opaccel_ph_stride, 1.0, PSD_FIX_OFF, PSD_EXIST_OFF);</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    cvoverride(opaccel_sl_stride, 1.0, PSD_FIX_OFF, PSD_EXIST_OFF);</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  }</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;} <span class="comment">/* GEReq_init_accelUI() */</span></div><div class="ttc" id="_k_s_foundation_8h_html_a969816ef84367f11542f3473473260dc"><div class="ttname"><a href="_k_s_foundation_8h.html#a969816ef84367f11542f3473473260dc">KS_3D_SELECTED</a></div><div class="ttdeci">#define KS_3D_SELECTED</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:104</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad97ca73c80e23352aa79230ba0e068b6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad97ca73c80e23352aa79230ba0e068b6">&#9670;&nbsp;</a></span>GEReq_eval_TRrange()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS GEReq_eval_TRrange </td>
          <td>(</td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>slperpass</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>timetoadd_perTR</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>requested_minacqs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>mintr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>maxtr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html">KS_SEQ_COLLECTION</a> *&#160;</td>
          <td class="paramname"><em>seqcollection</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int(*)(int, int, void **)&#160;</td>
          <td class="paramname"><em>play_loop</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nargs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void **&#160;</td>
          <td class="paramname"><em>args</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Calculate the number of slices per TR and TR padding time (2D imaging)</h4>
</p>
<p>This function calculates the number of slices that can fit in one TR (optr) based on the duration and occurences of the sequence modules in the sequence collection (<a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html" title="Collection handle of all sequence modules involved in the pulse sequence, used for RF scaling...">KS_SEQ_COLLECTION</a>) determined by calling the sequence sliceloop (wrapper) function.</p>
<p>As the number of arguments to the sequence's sliceloop is psd-dependent, the function pointer <code>play_loop</code> must be a wrapper function to the sliceloop function taking standardized input arguments <code>(int) nargs</code> and <code>(void **) args</code>. This sliceloop wrapper function must be on the form: <code>int sliceloop_nargs(int slperpass, int nargs, void **args);</code> returning the duration in [us] to play out <code>slperpass</code> number of slices. If the sliceloop function does not need any additional input arguments, <code>nargs = 0</code>, and <code>args = NULL</code>.</p>
<p>The minimum allowed TR is determined by <a class="el" href="_k_s_foundation_8h.html#af38e51235c90bff510cae4ee1955dd95" title="Returns the minimum TR based on the content of a slice loop, adding additional time due to SAR and ha...">ks_eval_mintr()</a>, which honors SAR/heating limitations. If <code>opautotr = 1</code>, <code>optr</code> will be updated here, otherwise if <code>optr</code> is too short, an error will be returned to the operator.</p>
<p>The calling function can specify the minimum acqs that are allowed, as well as a minimum and maximum TR interval. Setting <code>maxtr = 0</code> disables the upper TR limit. Setting <code>requested_minacqs &lt;= 1</code>, disables the min acqs requirement.</p>
<p>This function should be called at the end of <a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a> after all sequence modules have been set up and dry-runned on host by calling each sequence module's <code>****_pg()</code> function. See also the documentation for <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> and <a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html" title="Collection handle of all sequence modules involved in the pulse sequence, used for RF scaling...">KS_SEQ_COLLECTION</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">slperpass</td><td>Number of slices that can fit within each TR </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">timetoadd_perTR</td><td>The total time in [us] that must be distributed manually to one or more sequence modules after the call to <a class="el" href="_g_e_required_8e.html#a3bf65ebca3543f771e2d17799bbb0d3c">GEReq_eval_TR()</a> in order to meet the desired TR </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">requested_minacqs</td><td>The desired minimum number of acquisitions (passes) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">mintr</td><td>Lowest allowed TR in [us] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">maxtr</td><td>Highest allowed TR in [us]. 0: Disabled </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">seqcollection</td><td>Pointer to the <a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html" title="Collection handle of all sequence modules involved in the pulse sequence, used for RF scaling...">KS_SEQ_COLLECTION</a> struct holding all sequence modules </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">play_loop</td><td>Function pointer to (the wrapper function to) the sliceloop function of the sequence </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nargs</td><td>Number of extra input arguments to the sliceloop wrapper function. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">args</td><td>Void pointer array pointing to the variables containing the actual values needed for the sequence's sliceloop function </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                                                                                                    {</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  STATUS status;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  <span class="keywordtype">int</span> numacqs = 0;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;  <span class="keywordtype">int</span> numrfexclocations = (<a class="code" href="_k_s_foundation_8h.html#a969816ef84367f11542f3473473260dc">KS_3D_SELECTED</a>) ? exist(opvquant) : exist(opslquant);</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;  <span class="keywordtype">int</span> slicetime;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  <span class="keywordtype">int</span> nslices_perTR = <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  <span class="keywordtype">int</span> nslices_shortest_scantime = <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;  <span class="keywordtype">int</span> lowest_scantime = <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  <span class="keywordtype">int</span> singleslice_time = <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  <span class="keywordtype">int</span> requested_maxslices = <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;  <span class="keywordtype">int</span> maxslices_time = <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  <span class="comment">/* if another function has already performed TR timing calcs, don&#39;t do it again */</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#aaa31b32f56e7b425f15f4191ef1f92be">evaltrdone</a> == TRUE) {</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;  }</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  </div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a> == NULL || <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a65c4aa433169274a52c448793e82e12e">numseq</a> == 0) {</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: Please add pulse sequence modules to the sequence collection before calling this function&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  }</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  <span class="keywordflow">if</span> (mintr &lt; 0 || maxtr &lt; 0) {</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: min/max TR cannot be negative&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((maxtr &gt; 0) &amp;&amp; (maxtr &lt;= mintr)) {</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: max TR must be &gt; minTR, or 0 (disabled)&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  }</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;  <span class="comment">/* make sure seqctrl.duration at least equal to seqctrl.min_duration */</span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;  status = <a class="code" href="_k_s_foundation_8h.html#a3de8410411e4caddbabb57b40fc3abe1">ks_eval_seqcollection_durations_atleastminimum</a>(<a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>);</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  <span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;  singleslice_time = <a class="code" href="_k_s_foundation_8h.html#af38e51235c90bff510cae4ee1955dd95">ks_eval_mintr</a>(1, <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>, <a class="code" href="_g_e_required_8e.html#a7ca8f149618c5cab125f422cd627c433">ks_gheatfact</a>, play_loop, nargs, args);</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;  <span class="keywordflow">if</span> (singleslice_time &lt;= 0) <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  <span class="keywordflow">if</span> ((maxtr &gt; 0) &amp;&amp; (maxtr &lt; singleslice_time)) {</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: Max TR must be &gt; %.1f ms&quot;</span>, __FUNCTION__, singleslice_time / 1000.0);</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;  }</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  <span class="keywordflow">if</span> ((mintr &gt; 0) &amp;&amp; (mintr &lt; singleslice_time)) {</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: Min TR must be &gt; %.1f ms&quot;</span>, __FUNCTION__, singleslice_time / 1000.0);</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;  }</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    <span class="keywordflow">if</span> ((maxtr &gt; 0) &amp;&amp; ((maxtr - mintr) &lt; singleslice_time)) {</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: The TR interval must be &gt; %.1f ms&quot;</span>, __FUNCTION__, singleslice_time / 1000.0);</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;  }</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;  <span class="comment">/* #acqs cannot exceed #slices. If sequential scanning, #acqs = #slices */</span></div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  <span class="keywordflow">if</span> (requested_minacqs &lt; 1) {</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    requested_minacqs = 1;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((requested_minacqs &gt; numrfexclocations) || (opirmode == TRUE)) {</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    requested_minacqs = numrfexclocations;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  }</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;  requested_maxslices = CEIL_DIV(numrfexclocations, requested_minacqs);</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;  maxslices_time = <a class="code" href="_k_s_foundation_8h.html#af38e51235c90bff510cae4ee1955dd95">ks_eval_mintr</a>(requested_maxslices, <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>, <a class="code" href="_g_e_required_8e.html#a7ca8f149618c5cab125f422cd627c433">ks_gheatfact</a>, play_loop, nargs, args);</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;  <span class="keywordflow">if</span> (opautotr) {  <span class="comment">/* AutoTR: User selected pitrval2 = PSD_MINIMUMTR */</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <span class="keywordflow">if</span> (maxtr &gt; 0 || mintr &gt; 0) { <span class="comment">/* in-range autoTR */</span></div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;      <span class="comment">/* Check which combination that results in the lowest scan time, and max/min # slices in range */</span></div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;      <span class="keywordflow">for</span> (i = 1; i &lt;= numrfexclocations; i++) {</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        numacqs = CEIL_DIV(numrfexclocations, i);</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        slicetime = <a class="code" href="_k_s_foundation_8h.html#af38e51235c90bff510cae4ee1955dd95">ks_eval_mintr</a>(i, <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>, <a class="code" href="_g_e_required_8e.html#a7ca8f149618c5cab125f422cd627c433">ks_gheatfact</a>, play_loop, nargs, args);</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        <span class="keywordflow">if</span> (slicetime &gt;= mintr &amp;&amp; (maxtr == 0 || slicetime &lt;= maxtr) &amp;&amp; (numacqs &gt;= requested_minacqs)) {</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;          <span class="keywordflow">if</span> (lowest_scantime == <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>) {</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;            nslices_shortest_scantime = i;</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;            lowest_scantime = slicetime * numacqs;</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (slicetime * numacqs &lt;= lowest_scantime * 1.01) {</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;            <span class="comment">/* 1.01 to avoid round-off effects of slicetime and to slightly favor fewer acqs and longer TRs</span></div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="comment">            when the scantime is nearly identical */</span></div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;            nslices_shortest_scantime = i;</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;            lowest_scantime = slicetime * numacqs;</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;          }</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;        }</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;      }</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;      <span class="keywordflow">if</span> (lowest_scantime == <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>) {</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        <span class="comment">/* failed to find solution within the interval, the range is probably too high for the set</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="comment">           of slices.  Need to add padding to reach mintr. This</span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;<span class="comment">             is done by setting optr = avmintr = mintr (see also timetoadd_perTR below)*/</span></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;        <span class="keywordflow">if</span> (maxslices_time &lt; mintr) {</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;          nslices_perTR = requested_maxslices;</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;          avmintr = mintr;</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: Programming error&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;        }</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        nslices_perTR = nslices_shortest_scantime;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        avmintr = <a class="code" href="_k_s_foundation_8h.html#af38e51235c90bff510cae4ee1955dd95">ks_eval_mintr</a>(nslices_perTR, <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>, <a class="code" href="_g_e_required_8e.html#a7ca8f149618c5cab125f422cd627c433">ks_gheatfact</a>, play_loop, nargs, args);</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;      }</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    } <span class="keywordflow">else</span> { <span class="comment">/* minimum TR (using requested_minacqs) */</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;      nslices_perTR = requested_maxslices;</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;      avmintr = <a class="code" href="_k_s_foundation_8h.html#af38e51235c90bff510cae4ee1955dd95">ks_eval_mintr</a>(nslices_perTR, <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>, <a class="code" href="_g_e_required_8e.html#a7ca8f149618c5cab125f422cd627c433">ks_gheatfact</a>, play_loop, nargs, args);</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    }</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    avmaxtr = avmintr;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    cvoverride(optr, avmintr, PSD_FIX_ON, PSD_EXIST_ON);</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;  } <span class="keywordflow">else</span> { <span class="comment">/* Manual TR */</span></div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    avmintr = singleslice_time;</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    avmaxtr = _optr.maxval;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <span class="comment">/* how many slices can we MAXIMALLY fit in one TR ? */</span></div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    <span class="keywordflow">if</span> (opirmode == 1) { <span class="comment">/* sequential */</span></div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;      nslices_perTR = 1;</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;      <span class="keywordflow">if</span> (existcv(optr)) {</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        <span class="keywordflow">if</span> (optr &lt; avmintr)</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: Increase the TR to %.1f ms&quot;</span>, __FUNCTION__, avmintr / 1000.0);</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;        <span class="keywordflow">if</span> ((mintr &gt; 0) &amp;&amp; (optr &lt; mintr))</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: Increase the TR to %.1f ms&quot;</span>, __FUNCTION__, mintr / 1000.0);</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        <span class="keywordflow">if</span> ((maxtr &gt; 0) &amp;&amp; (optr &gt; maxtr))</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: Decrease the TR to %.1f ms&quot;</span>, __FUNCTION__, maxtr / 1000.0);</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      }      </div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;      nslices_perTR = <a class="code" href="_k_s_foundation_8h.html#a86ab45a04531e1e9353667c9ca6d5fbd">ks_eval_maxslicespertr</a>(exist(optr), <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>, <a class="code" href="_g_e_required_8e.html#a7ca8f149618c5cab125f422cd627c433">ks_gheatfact</a>, play_loop, nargs, args);</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;      nslices_perTR = IMax(2, 1, nslices_perTR); <span class="comment">/* safeguard against &lt; 1 */</span></div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    }</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;  } <span class="comment">/* Auto/Manual TR */</span></div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;  <span class="comment">/* how many acqs (runs) do we need to get all prescribed slices ? */</span></div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;  numacqs = CEIL_DIV(numrfexclocations, nslices_perTR);</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;  <span class="comment">/* how many slices SHOULD we play out per pass (keeping numrfexclocations and numacqs)?</span></div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;<span class="comment">     This may be less than nslices_perTR depending on divisibility */</span></div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;  *slperpass = CEIL_DIV(numrfexclocations, numacqs); <span class="comment">/* round up */</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;  <span class="comment">/* run once more with the actual number of slices per TR, mostly so that ks_eval_gradrflimits() will set the</span></div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;<span class="comment">  description of `optr` correctly */</span></div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#af38e51235c90bff510cae4ee1955dd95">ks_eval_mintr</a>(*slperpass, <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>, <a class="code" href="_g_e_required_8e.html#a7ca8f149618c5cab125f422cd627c433">ks_gheatfact</a>, play_loop, nargs, args);</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;  <span class="comment">/* run before each call to function pointer `play_loop()` (next line) to set all `seqctrl.ninst` to 0 */</span></div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#acb34cd9d6c99193829696596b4d0271f">ks_eval_seqcollection_resetninst</a>(<a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>);</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;  <span class="comment">/* Update seqcollection.seqctrl[*].ninst given &#39;*slperpass&#39; number of slices</span></div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;<span class="comment">     time [us] for one sequence playout incl. the SSI time and necessary dead time to</span></div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;<span class="comment">     make up the expected TR. To be used in KS_SEQLENGTH() in pulsegen() */</span></div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;  *timetoadd_perTR = exist(optr) - play_loop(*slperpass, nargs, args);</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;  <span class="comment">/* prevent further addition of new sequence modules */</span></div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;  <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a1ea5d0cb93f22f7d0fdf804bd68c3326">mode</a> = <a class="code" href="_k_s_foundation_8h.html#a99fb83031ce9923c84392b4e92f956b5af64c78cedb5f88bb17738bcf993a7755">KS_SEQ_COLLECTION_LOCKED</a>;</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;  <span class="comment">/* Flag that we have completed this function */</span></div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;  <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#aaa31b32f56e7b425f15f4191ef1f92be">evaltrdone</a> = TRUE;</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;  <span class="comment">/* Set UI and advisory panel variables */</span></div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;  <a class="code" href="_g_e_required_8e.html#aab3baee33eebda2bcf24b20846ce32a9">avail_image_time</a> = RDN_GRD(exist(optr));</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;  <a class="code" href="_g_e_required_8e.html#a16ede8dd5ed24fd803dc270aa22e57c5">act_tr</a> = <a class="code" href="_g_e_required_8e.html#aab3baee33eebda2bcf24b20846ce32a9">avail_image_time</a>;</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;  ihtr = <a class="code" href="_g_e_required_8e.html#a16ede8dd5ed24fd803dc270aa22e57c5">act_tr</a>; <span class="comment">/* image header TR */</span></div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;  avminslquant = 1;</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation_8h.html#a969816ef84367f11542f3473473260dc">KS_3D_SELECTED</a> == FALSE) {</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;  avmaxslquant = nslices_perTR; <span class="comment">/* UI value (&quot;Max # Slices:&quot;) */</span></div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;  avmaxacqs = numacqs; <span class="comment">/* UI value (&quot;# of Acqs:&quot;) */</span></div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    avmaxslquant = 2048;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    avmaxacqs = 1;</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;  }</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;} <span class="comment">/* GEReq_eval_TRrange() */</span></div><div class="ttc" id="_k_s_foundation_8h_html_afd953f31b866a09e0418967c2bf65a59"><div class="ttname"><a href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a></div><div class="ttdeci">#define KS_NOTSET</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:60</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a969816ef84367f11542f3473473260dc"><div class="ttname"><a href="_k_s_foundation_8h.html#a969816ef84367f11542f3473473260dc">KS_3D_SELECTED</a></div><div class="ttdeci">#define KS_3D_SELECTED</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:104</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n_html_a1ea5d0cb93f22f7d0fdf804bd68c3326"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a1ea5d0cb93f22f7d0fdf804bd68c3326">KS_SEQ_COLLECTION::mode</a></div><div class="ttdeci">int mode</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1150</div></div>
<div class="ttc" id="_g_e_required_8e_html_a16ede8dd5ed24fd803dc270aa22e57c5"><div class="ttname"><a href="_g_e_required_8e.html#a16ede8dd5ed24fd803dc270aa22e57c5">act_tr</a></div><div class="ttdeci">int act_tr</div><div class="ttdef"><b>Definition:</b> GERequired.e:208</div></div>
<div class="ttc" id="ksepi_8e_html_ab5adb9efc118dc1cc8a0dc3c32cb73bf"><div class="ttname"><a href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a></div><div class="ttdeci">KS_SEQ_COLLECTION seqcollection</div><div class="ttdef"><b>Definition:</b> ksepi.e:79</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a3de8410411e4caddbabb57b40fc3abe1"><div class="ttname"><a href="_k_s_foundation_8h.html#a3de8410411e4caddbabb57b40fc3abe1">ks_eval_seqcollection_durations_atleastminimum</a></div><div class="ttdeci">STATUS ks_eval_seqcollection_durations_atleastminimum(KS_SEQ_COLLECTION *seqcollection) WARN_UNUSED_RESULT</div><div class="ttdoc">Assures the .duration fields of all sequence modules being part of the sequence collection (KS_SEQ_CO...</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:2992</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n_html_aaa31b32f56e7b425f15f4191ef1f92be"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#aaa31b32f56e7b425f15f4191ef1f92be">KS_SEQ_COLLECTION::evaltrdone</a></div><div class="ttdeci">int evaltrdone</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1152</div></div>
<div class="ttc" id="_g_e_required_8e_html_a7ca8f149618c5cab125f422cd627c433"><div class="ttname"><a href="_g_e_required_8e.html#a7ca8f149618c5cab125f422cd627c433">ks_gheatfact</a></div><div class="ttdeci">float ks_gheatfact</div><div class="ttdef"><b>Definition:</b> GERequired.e:241</div></div>
<div class="ttc" id="_g_e_required_8e_html_aab3baee33eebda2bcf24b20846ce32a9"><div class="ttname"><a href="_g_e_required_8e.html#aab3baee33eebda2bcf24b20846ce32a9">avail_image_time</a></div><div class="ttdeci">int avail_image_time</div><div class="ttdef"><b>Definition:</b> GERequired.e:207</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_acb34cd9d6c99193829696596b4d0271f"><div class="ttname"><a href="_k_s_foundation_8h.html#acb34cd9d6c99193829696596b4d0271f">ks_eval_seqcollection_resetninst</a></div><div class="ttdeci">void ks_eval_seqcollection_resetninst(KS_SEQ_COLLECTION *seqcollection)</div><div class="ttdoc">Set the .nseqinstances field of each sequence module (KS_SEQ_CONTROL) equal to 0</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3235</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a99fb83031ce9923c84392b4e92f956b5af64c78cedb5f88bb17738bcf993a7755"><div class="ttname"><a href="_k_s_foundation_8h.html#a99fb83031ce9923c84392b4e92f956b5af64c78cedb5f88bb17738bcf993a7755">KS_SEQ_COLLECTION_LOCKED</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1771</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_af38e51235c90bff510cae4ee1955dd95"><div class="ttname"><a href="_k_s_foundation_8h.html#af38e51235c90bff510cae4ee1955dd95">ks_eval_mintr</a></div><div class="ttdeci">int ks_eval_mintr(int nslices, KS_SEQ_COLLECTION *seqcollection, float gheatfact, int(*play_loop)(int, int, void **), int nargs, void **args)</div><div class="ttdoc">Returns the minimum TR based on the content of a slice loop, adding additional time due to SAR and ha...</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3199</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n_html_a65c4aa433169274a52c448793e82e12e"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a65c4aa433169274a52c448793e82e12e">KS_SEQ_COLLECTION::numseq</a></div><div class="ttdeci">int numseq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1149</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a86ab45a04531e1e9353667c9ca6d5fbd"><div class="ttname"><a href="_k_s_foundation_8h.html#a86ab45a04531e1e9353667c9ca6d5fbd">ks_eval_maxslicespertr</a></div><div class="ttdeci">int ks_eval_maxslicespertr(int TR, KS_SEQ_COLLECTION *seqcollection, float gheatfact, int(*play_loop)(int, int, void **), int nargs, void **args)</div><div class="ttdoc">Returns the maximum number of slices that can be played out in one TR, honoring SAR and hardware cons...</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3212</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3bf65ebca3543f771e2d17799bbb0d3c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3bf65ebca3543f771e2d17799bbb0d3c">&#9670;&nbsp;</a></span>GEReq_eval_TR()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS GEReq_eval_TR </td>
          <td>(</td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>slperpass</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>timetoadd_perTR</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>requested_minacqs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html">KS_SEQ_COLLECTION</a> *&#160;</td>
          <td class="paramname"><em>seqcollection</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int(*)(int, int, void **)&#160;</td>
          <td class="paramname"><em>play_loop</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nargs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void **&#160;</td>
          <td class="paramname"><em>args</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;                                                                                                    {</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160; </div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_g_e_required_8e.html#ad97ca73c80e23352aa79230ba0e068b6">GEReq_eval_TRrange</a>(slperpass, timetoadd_perTR, requested_minacqs, 0, 0, <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>, play_loop, nargs, args);</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;} <span class="comment">/* GEReq_eval_TR() */</span></div><div class="ttc" id="_g_e_required_8e_html_ad97ca73c80e23352aa79230ba0e068b6"><div class="ttname"><a href="_g_e_required_8e.html#ad97ca73c80e23352aa79230ba0e068b6">GEReq_eval_TRrange</a></div><div class="ttdeci">STATUS GEReq_eval_TRrange(int *slperpass, int *timetoadd_perTR, int requested_minacqs, int mintr, int maxtr, KS_SEQ_COLLECTION *seqcollection, int(*play_loop)(int, int, void **), int nargs, void **args)</div><div class="ttdoc">Calculate the number of slices per TR and TR padding time (2D imaging)</div><div class="ttdef"><b>Definition:</b> GERequired.e:539</div></div>
<div class="ttc" id="ksepi_8e_html_ab5adb9efc118dc1cc8a0dc3c32cb73bf"><div class="ttname"><a href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a></div><div class="ttdeci">KS_SEQ_COLLECTION seqcollection</div><div class="ttdef"><b>Definition:</b> ksepi.e:79</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af06136710d55a4b8a9d63d1c676e7565"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af06136710d55a4b8a9d63d1c676e7565">&#9670;&nbsp;</a></span>GEReq_eval_rfscaling()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS GEReq_eval_rfscaling </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html">KS_SEQ_COLLECTION</a> *&#160;</td>
          <td class="paramname"><em>seqcollection</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Performs RF scaling of all RF pulses in the <a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html" title="Collection handle of all sequence modules involved in the pulse sequence, used for RF scaling...">KS_SEQ_COLLECTION</a> and Prescan</h4>
</p>
<p>RF scaling is a complicated process across RF pulses in scan (multiple sequence modules) and prescan, where the desired flip angles should be met partly using the maxB1 info for each RF pulse and scale it relative to the prescan result. This is done via a combination of scan and prescan attenuation factors (xmtaddScan) in the <code>entry_point_table[]</code>, an extra global scaling factor, and change of the (instruction) amplitude of each RF pulse.</p>
<p>This function performs all these tasks using a <a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html" title="Collection handle of all sequence modules involved in the pulse sequence, used for RF scaling...">KS_SEQ_COLLECTION</a> as input. The sequence collection struct contains one <a class="el" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html" title="A multi-purpose controller struct for each sequence module to facilitate RF scaling, SAR calculations, sequence duration and sequence switching">KS_SEQ_CONTROL</a> struct for each sequence module, which via the field <code>gradrf.rfptr[]</code> has access to all <a class="el" href="struct_k_s___r_f.html" title="Composite sequence object for RF (with optional OMEGA &amp; THETA pulses)">KS_RF</a> objects in the sequence module. As the <code>***_pg()</code> function for each sequence module should have been called prior to this function, the number of occurrences of each RF pulse is known. Moreover, the rfstat specification for every RF pulse is located in: seqcollection-&gt;seqctrl[]-&gt;gradrf-&gt;rfptr[]-&gt;rf.rfpulse which is used by <a class="el" href="_k_s_foundation_8h.html#a736f7a360ad913bc8295ee2bddc6525e" title="(Internal use) Sets up GE&#39;s rfpulse[] array from the contents of a KS_SEQ_COLLECTION struct...">ks_eval_seqcollection2rfpulse()</a> to rewrite the global <code>rfpulse[]</code> struct array required by GE's RF scaling functions peakB1() and setScale().</p>
<p>At the end of this function, the seqcollection mode is locked, preventing accidental addition of new sequence modules to the seqcollection using <a class="el" href="_k_s_foundation_8h.html#a9c627057bb753177d7b74e5cd9ba1a46" title="Adds a sequence module (KS_SEQ_CONTROL) to the KS_SEQ_COLLECTION struct for later RF scaling and SAR ...">ks_eval_addtoseqcollection()</a>. Moreover, each sequence module will have its <code>rfscalingdone</code> field set to TRUE to signal to <a class="el" href="_k_s_foundation_8h.html#a853cff23395e570cc88aa3405b78c3a9" title="Places a KS_RF sequence object on a board at some position in the pulse sequence">ks_pg_rf()</a> that the RF pulse belonging to that sequence module has indeed been RF scaled properly. This extra safety mechanism makes it difficult to use <a class="el" href="_k_s_foundation_8h.html#a853cff23395e570cc88aa3405b78c3a9" title="Places a KS_RF sequence object on a board at some position in the pulse sequence">ks_pg_rf()</a> without first passing through this function and have the seqcollection struct set up.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">seqcollection</td><td>Pointer to the <a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html" title="Collection handle of all sequence modules involved in the pulse sequence, used for RF scaling...">KS_SEQ_COLLECTION</a> struct holding all sequence modules </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;                                                              {</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;  STATUS status;</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a> == NULL || <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a65c4aa433169274a52c448793e82e12e">numseq</a> == 0) {</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: Please add pulse sequence modules to the sequence collection before calling this function&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;  }</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;  <span class="comment">/* use global rfpulse[] array (that is also featuring in Prescan.e) */</span></div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="_k_s_foundation_8h.html#a4becfb20a2ad2227c16c4ce772ed8d51">KS_MAXUNIQUE_RF</a>; i++) {</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    <a class="code" href="grad__rf__empty_8h.html#a53f2690e6af35d559b80182016987d22">rfpulse</a>[i].activity = 0;</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;  }</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;  <span class="comment">/* Update the global RF pulse array rfpulse[] with the contents of the RF pulses in the sequence modules.</span></div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;<span class="comment">     This also includes resetting all .activity fields to zero for the first KS_MAXUNIQUE_RF elements in rfpulse[] */</span></div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;  status = <a class="code" href="_k_s_foundation_8h.html#a736f7a360ad913bc8295ee2bddc6525e">ks_eval_seqcollection2rfpulse</a>(<a class="code" href="grad__rf__empty_8h.html#a53f2690e6af35d559b80182016987d22">rfpulse</a>, <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>);</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;  <span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;  <span class="comment">/* find the peak B1 for each entry point and the max B1 across all entry points */</span></div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;<span class="preprocessor">#if EPIC_RELEASE &gt;= 24</span></div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;  status = findMaxB1Seq(&amp;<a class="code" href="_g_e_required_8e.html#a9b1fc3ed469d5e2aaf046d9e17d72734">maxB1Seq</a>, <a class="code" href="_g_e_required_8e.html#a5dfe9b1d5c3f79c53ef1e8513159ce18">maxB1</a>, <a class="code" href="_g_e_required_8e.html#a43ed1aedaae548fba169071b1c911983">MAX_ENTRY_POINTS</a>, <a class="code" href="grad__rf__empty_8h.html#a53f2690e6af35d559b80182016987d22">rfpulse</a>, RF_FREE);</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;  <span class="keywordflow">if</span> (status != SUCCESS) {</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: findMaxB1Seq() failed&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;  }</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;  {</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    <span class="keywordtype">int</span> entry;</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    <a class="code" href="_g_e_required_8e.html#a9b1fc3ed469d5e2aaf046d9e17d72734">maxB1Seq</a> = 0.0;</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    <span class="keywordflow">for</span> (entry = 0; entry &lt; <a class="code" href="_g_e_required_8e.html#a43ed1aedaae548fba169071b1c911983">MAX_ENTRY_POINTS</a>; entry++) {</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;      status = peakB1(&amp;<a class="code" href="_g_e_required_8e.html#a5dfe9b1d5c3f79c53ef1e8513159ce18">maxB1</a>[entry], entry, RF_FREE, <a class="code" href="grad__rf__empty_8h.html#a53f2690e6af35d559b80182016987d22">rfpulse</a>);</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;      <span class="keywordflow">if</span> (status != SUCCESS) {</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: peakB1() failed&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;      }</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="_g_e_required_8e.html#a5dfe9b1d5c3f79c53ef1e8513159ce18">maxB1</a>[entry] &gt; <a class="code" href="_g_e_required_8e.html#a9b1fc3ed469d5e2aaf046d9e17d72734">maxB1Seq</a>) {</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;        <a class="code" href="_g_e_required_8e.html#a9b1fc3ed469d5e2aaf046d9e17d72734">maxB1Seq</a> = <a class="code" href="_g_e_required_8e.html#a5dfe9b1d5c3f79c53ef1e8513159ce18">maxB1</a>[entry];</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;      }</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    } <span class="comment">/* for */</span></div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;  }</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;  <span class="comment">/* RF: How much do we need to attenuate the RF pulses in scan. */</span></div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;  <span class="keywordtype">double</span> my_xmtaddScan = -200 * log10(<a class="code" href="_g_e_required_8e.html#a5dfe9b1d5c3f79c53ef1e8513159ce18">maxB1</a>[L_SCAN] / <a class="code" href="_g_e_required_8e.html#a9b1fc3ed469d5e2aaf046d9e17d72734">maxB1Seq</a>) + getCoilAtten();</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;  <span class="keywordflow">if</span> (my_xmtaddScan &gt; cfdbmax) {</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    extraScale = (float) pow(10.0, (cfdbmax - my_xmtaddScan) / 200.0); <span class="comment">/* N.B.: &#39;extraScale&#39; is declared as CV in Prescan.e */</span></div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    my_xmtaddScan = cfdbmax;</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    extraScale = 1.0;</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;  }</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;  <span class="comment">/* RF: Scale the rfpulse amplitudes */</span></div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;  status = setScale(L_SCAN, RF_FREE, <a class="code" href="grad__rf__empty_8h.html#a53f2690e6af35d559b80182016987d22">rfpulse</a>, <a class="code" href="_g_e_required_8e.html#a5dfe9b1d5c3f79c53ef1e8513159ce18">maxB1</a>[L_SCAN], extraScale);</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;  <span class="keywordflow">if</span> (status != SUCCESS) {</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: setScale failed&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;  }</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;  <span class="comment">/* fill entry_point_table */</span></div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;  status = entrytabinit(entry_point_table, (<span class="keywordtype">int</span>)ENTRY_POINT_MAX);</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;  <span class="keywordflow">if</span> (status != SUCCESS) {</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: entrytabinit() failed&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;  }</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;  strcpy( entry_point_table[L_SCAN].epname, <span class="stringliteral">&quot;scan&quot;</span>);</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;  entry_point_table[L_SCAN].epxmtadd = (short)rint( (<span class="keywordtype">double</span>) my_xmtaddScan);</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;  entry_point_table[L_SCAN].epstartrec = rhdab0s;</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;  entry_point_table[L_SCAN].ependrec = rhdab0e;</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;  entry_point_table[L_SCAN].epfastrec = 0;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;  entry_point_table[L_APS2] = entry_point_table[L_MPS2] = entry_point_table[L_SCAN];</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;  strcpy(entry_point_table[L_APS2].epname, <span class="stringliteral">&quot;aps2&quot;</span>);</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;  strcpy(entry_point_table[L_MPS2].epname, <span class="stringliteral">&quot;mps2&quot;</span>);</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;  <span class="comment">/* Prescan: Final RF scaling of the Prescan entries, using the maxB1[] and maxB1Seq values computed above */</span></div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;  <span class="comment">/* prevent further addition of new sequence modules */</span></div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;  <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a1ea5d0cb93f22f7d0fdf804bd68c3326">mode</a> = <a class="code" href="_k_s_foundation_8h.html#a99fb83031ce9923c84392b4e92f956b5af64c78cedb5f88bb17738bcf993a7755">KS_SEQ_COLLECTION_LOCKED</a>;</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;  <span class="comment">/* Flag each sequence module that RF scaling has been done */</span></div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a65c4aa433169274a52c448793e82e12e">numseq</a>; i++) {</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">seqctrlptr</a>[i]-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a729d02cb24cec9beeaf9a22ac9390754">rfscalingdone</a> = TRUE;</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;  }</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;} <span class="comment">/* GEReq_eval_rfscaling() */</span></div><div class="ttc" id="_k_s_foundation_8h_html_a4becfb20a2ad2227c16c4ce772ed8d51"><div class="ttname"><a href="_k_s_foundation_8h.html#a4becfb20a2ad2227c16c4ce772ed8d51">KS_MAXUNIQUE_RF</a></div><div class="ttdeci">#define KS_MAXUNIQUE_RF</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:114</div></div>
<div class="ttc" id="grad__rf__empty_8h_html_a53f2690e6af35d559b80182016987d22"><div class="ttname"><a href="grad__rf__empty_8h.html#a53f2690e6af35d559b80182016987d22">rfpulse</a></div><div class="ttdeci">RF_PULSE rfpulse[RF_FREE]</div><div class="ttdef"><b>Definition:</b> grad_rf_empty.h:56</div></div>
<div class="ttc" id="_g_e_required_8e_html_a43ed1aedaae548fba169071b1c911983"><div class="ttname"><a href="_g_e_required_8e.html#a43ed1aedaae548fba169071b1c911983">MAX_ENTRY_POINTS</a></div><div class="ttdeci">#define MAX_ENTRY_POINTS</div><div class="ttdef"><b>Definition:</b> GERequired.e:139</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_n_t_r_o_l_html_a729d02cb24cec9beeaf9a22ac9390754"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_n_t_r_o_l.html#a729d02cb24cec9beeaf9a22ac9390754">KS_SEQ_CONTROL::rfscalingdone</a></div><div class="ttdeci">int rfscalingdone</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:988</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n_html_a1ea5d0cb93f22f7d0fdf804bd68c3326"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a1ea5d0cb93f22f7d0fdf804bd68c3326">KS_SEQ_COLLECTION::mode</a></div><div class="ttdeci">int mode</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1150</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n_html_a8ab39b275ee333fc1e568a0994db98d1"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a8ab39b275ee333fc1e568a0994db98d1">KS_SEQ_COLLECTION::seqctrlptr</a></div><div class="ttdeci">KS_SEQ_CONTROL * seqctrlptr[KS_MAXUNIQUE_SEQUENCES]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1155</div></div>
<div class="ttc" id="ksepi_8e_html_ab5adb9efc118dc1cc8a0dc3c32cb73bf"><div class="ttname"><a href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a></div><div class="ttdeci">KS_SEQ_COLLECTION seqcollection</div><div class="ttdef"><b>Definition:</b> ksepi.e:79</div></div>
<div class="ttc" id="_g_e_required_8e_html_a9b1fc3ed469d5e2aaf046d9e17d72734"><div class="ttname"><a href="_g_e_required_8e.html#a9b1fc3ed469d5e2aaf046d9e17d72734">maxB1Seq</a></div><div class="ttdeci">float maxB1Seq</div><div class="ttdef"><b>Definition:</b> GERequired.e:260</div></div>
<div class="ttc" id="_g_e_required_8e_html_a5dfe9b1d5c3f79c53ef1e8513159ce18"><div class="ttname"><a href="_g_e_required_8e.html#a5dfe9b1d5c3f79c53ef1e8513159ce18">maxB1</a></div><div class="ttdeci">float maxB1[MAX_ENTRY_POINTS]</div><div class="ttdef"><b>Definition:</b> GERequired.e:260</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a99fb83031ce9923c84392b4e92f956b5af64c78cedb5f88bb17738bcf993a7755"><div class="ttname"><a href="_k_s_foundation_8h.html#a99fb83031ce9923c84392b4e92f956b5af64c78cedb5f88bb17738bcf993a7755">KS_SEQ_COLLECTION_LOCKED</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1771</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n_html_a65c4aa433169274a52c448793e82e12e"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a65c4aa433169274a52c448793e82e12e">KS_SEQ_COLLECTION::numseq</a></div><div class="ttdeci">int numseq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1149</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a736f7a360ad913bc8295ee2bddc6525e"><div class="ttname"><a href="_k_s_foundation_8h.html#a736f7a360ad913bc8295ee2bddc6525e">ks_eval_seqcollection2rfpulse</a></div><div class="ttdeci">STATUS ks_eval_seqcollection2rfpulse(RF_PULSE *rfpulse, KS_SEQ_COLLECTION *seqcollection)</div><div class="ttdoc">(Internal use) Sets up GE&amp;#39;s rfpulse[] array from the contents of a KS_SEQ_COLLECTION struct...</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3296</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a789f2b2ac7ec21daa6a693820873e64a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a789f2b2ac7ec21daa6a693820873e64a">&#9670;&nbsp;</a></span>GEReq_eval_checkTR_SAR_calcs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS GEReq_eval_checkTR_SAR_calcs </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html">KS_SEQ_COLLECTION</a> *&#160;</td>
          <td class="paramname"><em>seqcollection</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>intended_time</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Checks that sequence modules sum up to TR, honoring SAR/heating limits</h4>
</p>
<p>This function is called by <a class="el" href="_g_e_required_8e.html#a027161dabe834c55750bd1e7f2fa8473" title="Runs the slice loop and validates TR and SAR/hardware limits">GEReq_eval_checkTR_SAR()</a> (non-inversion use) and <a class="el" href="_k_s_inversion_8e.html#aa08a7ecfbf13a621a577fa984bda2b5a" title="Runs the inversion slice loop and validates TR and SAR/hardware limits">ksinv_eval_checkTR_SAR()</a> (inversion use) to check that the sequence modules played out in the slice loop sum up to the specified TR (optr) accounting for SAR/heating limits. Moreover, the SAR values are updated in the UI, and the CV ks_sarcheckdone is set to TRUE. This CV is set to FALSE in <a class="el" href="_g_e_required_8e.html#a67a331f96035253e5efbb3e2f2ad3f24" title="Helper function to be called at the beginning of cvinit()">GEReq_cvinit()</a> and check whether it is TRUE in <a class="el" href="_g_e_required_8e.html#a994265c9b567cd3c6e5da34ad737dd4b" title="Helper function to be called at the beginning of predownload()">GEReq_predownload()</a> to make sure SAR calculation have been performed before scanning.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">seqcollection</td><td>Pointer to the <a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html" title="Collection handle of all sequence modules involved in the pulse sequence, used for RF scaling...">KS_SEQ_COLLECTION</a> struct holding all sequence modules </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">intended_time</td><td>Usually repetition time (optr) if this function was called from <a class="el" href="_g_e_required_8e.html#a027161dabe834c55750bd1e7f2fa8473" title="Runs the slice loop and validates TR and SAR/hardware limits">GEReq_eval_checkTR_SAR()</a>, but should correspond to the intended time to play the corresponding number of sequence instances now set in seqcollection[]-&gt;seqctrl.ninst </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;                                                                                         {</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;  <a class="code" href="struct_k_s___s_a_r.html">KS_SAR</a> sar;</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;  <span class="keywordtype">int</span> duration_withinlimits;</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;  <span class="keywordtype">int</span> nettime;</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;  STATUS status;</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#aaa31b32f56e7b425f15f4191ef1f92be">evaltrdone</a> == FALSE) {</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: Please call GEReq_eval_TR() before calling this function&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;  }</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;  <span class="comment">/* Print out the sequence collection time table. In simulation it appears in the WTools main window */</span></div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;<span class="preprocessor">#ifdef PSD_HW</span></div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    FILE *fp = fopen(<span class="stringliteral">&quot;/usr/g/mrraw/seqcollection.txt&quot;</span>, <span class="stringliteral">&quot;w&quot;</span>);</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ac39743a45d5ad00147e24218523f88c8">ks_print_seqcollection</a>(<a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>, fp);</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    fclose(fp);</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ac39743a45d5ad00147e24218523f88c8">ks_print_seqcollection</a>(<a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>, stderr);</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;<span class="comment">  The duration based on the sequence collection struct, which is the product .nseqinstances and .duration fields in each sequence</span></div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;<span class="comment">  modules, summed over all sequence modules.</span></div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;<span class="comment">  The .nseqinstances field becomes &gt; 0 by the call to: GEReq_eval_TR()-&gt;ks_eval_mintr()-&gt;play_loop()-&gt;ks_scan_playsequence()</span></div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;<span class="comment">  The .duration field is initially set to .min_duration by GEReq_eval_TR()-&gt;ks_eval_seqcollection_durations_atleastminimum(), but the</span></div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;<span class="comment">  .duration field of at least one sequence module should have been set larger than its .min_duration based on the amount of</span></div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;<span class="comment">  timetoadd_perTR returned by GEReq_eval_TR()  */</span></div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;  nettime = <a class="code" href="_k_s_foundation_8h.html#aeb213f86f7f6172f91b3ab69a518afe7">ks_eval_seqcollection_gettotalduration</a>(<a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>);</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;  <span class="keywordflow">if</span> (nettime &lt;= 0) {</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    </div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;  }</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;  <span class="comment">/* duration_withinlimits = nettime + grad/RF SAR/heat penalty time */</span></div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;  duration_withinlimits = <a class="code" href="_k_s_foundation_8h.html#ab4c6e9f82b55a3db56765fc22f21b7b5">ks_eval_gradrflimits</a>(&amp;sar, <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>, <a class="code" href="_g_e_required_8e.html#a7ca8f149618c5cab125f422cd627c433">ks_gheatfact</a>);</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;  <span class="keywordflow">if</span> (duration_withinlimits == <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>) {</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    <span class="keywordflow">return</span> FAILURE;</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;  }</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;  <span class="comment">/* Make sure the global RF pulse array rfpulse[] is updated with the contents of the RF pulses in the sequence modules.</span></div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;<span class="comment">     This also includes resetting all .activity fields to zero for the first KS_MAXUNIQUE_RF elements in rfpulse[] */</span></div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;  status = <a class="code" href="_k_s_foundation_8h.html#a736f7a360ad913bc8295ee2bddc6525e">ks_eval_seqcollection2rfpulse</a>(<a class="code" href="grad__rf__empty_8h.html#a53f2690e6af35d559b80182016987d22">rfpulse</a>, <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>);</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;  <span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;  <span class="comment">/* report to UI */</span></div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;  piasar = (float) sar.<a class="code" href="struct_k_s___s_a_r.html#a2e50537b138c27e2e30e8d3a568fbee0">average</a>;</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;  picasar = (<span class="keywordtype">float</span>) sar.<a class="code" href="struct_k_s___s_a_r.html#a2ce680a3ce053dc060c5616496615726">coil</a>;</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;  pipsar = (float) sar.<a class="code" href="struct_k_s___s_a_r.html#aa7fd5e56ed5028cc63702f999df5cbfd">peak</a>;</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;#<span class="keywordflow">if</span> EPIC_RELEASE &gt;= 24</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;  pib1rms = (<span class="keywordtype">float</span>) sar.<a class="code" href="struct_k_s___s_a_r.html#a3c77a7baa865a44ae8c49c408f42a5d9">b1rms</a>;</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;  <span class="keywordflow">if</span> (existcv(opslquant) == FALSE) {</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;    <span class="comment">/* if #slices has not been set yet, hold on complaining */</span></div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;    <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;  }</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;  <span class="keywordflow">if</span> (nettime &lt; duration_withinlimits) {</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: Duration of seq. modules (%d) &lt; grad/rf limits (%d)&quot;</span>, __FUNCTION__, nettime, duration_withinlimits);</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;  }</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;  <span class="keywordflow">if</span> (nettime &lt; intended_time) {</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: Duration of seq. modules (%d) &lt; %d&quot;</span>, __FUNCTION__, nettime, intended_time);</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;  }</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;  <span class="keywordflow">if</span> (nettime - intended_time &gt; <a class="code" href="_g_e_required_8e.html#a6aa2d3622908f1dd32bd380b28f1aa3a">MAX_TR_OVERSHOOT</a>) {</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    <span class="comment">/* small excess in nettime is expected due to roundups of .duration to nearest 4us, but we cannot accept too much */</span></div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;    <span class="comment">/* return */</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: Duration of seq. modules (%d) %d us too long&quot;</span>, __FUNCTION__, nettime, nettime - intended_time);</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;  }</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;<span class="preprocessor">#if EPIC_RELEASE &gt; 27 || (EPIC_RELEASE == 27 &amp;&amp; EPIC_PATCHNUM &gt; 1)</span></div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;  status = setupPowerMonitor(&amp;entry_point_table[L_SCAN], sar.<a class="code" href="struct_k_s___s_a_r.html#a2e50537b138c27e2e30e8d3a568fbee0">average</a>);</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;<span class="preprocessor">#else  </span></div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;  status = setupPowerMonitor(&amp;entry_point_table[L_SCAN], L_SCAN, RF_FREE, <a class="code" href="grad__rf__empty_8h.html#a53f2690e6af35d559b80182016987d22">rfpulse</a>,</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;                             nettime, sar.<a class="code" href="struct_k_s___s_a_r.html#a2e50537b138c27e2e30e8d3a568fbee0">average</a>, sar.<a class="code" href="struct_k_s___s_a_r.html#a2ce680a3ce053dc060c5616496615726">coil</a>, sar.<a class="code" href="struct_k_s___s_a_r.html#aa7fd5e56ed5028cc63702f999df5cbfd">peak</a>);</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;<span class="preprocessor">#endif                             </span></div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;  <span class="keywordflow">if</span> (status != SUCCESS) {</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: setupPowerMonitor failed&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;  }</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;  <span class="comment">/* prevent further addition of new sequence modules */</span></div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;  <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a1ea5d0cb93f22f7d0fdf804bd68c3326">mode</a> = <a class="code" href="_k_s_foundation_8h.html#a99fb83031ce9923c84392b4e92f956b5af64c78cedb5f88bb17738bcf993a7755">KS_SEQ_COLLECTION_LOCKED</a>;</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;  <span class="comment">/* Flag that SAR check has been done */</span></div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;  <a class="code" href="_g_e_required_8e.html#ac2a9639645541b0daab96065b217062d">ks_sarcheckdone</a> = TRUE;</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;} <span class="comment">/* GEReq_eval_checkTR_SAR_calcs() */</span></div><div class="ttc" id="_k_s_foundation_8h_html_ab4c6e9f82b55a3db56765fc22f21b7b5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab4c6e9f82b55a3db56765fc22f21b7b5">ks_eval_gradrflimits</a></div><div class="ttdeci">int ks_eval_gradrflimits(KS_SAR *sar, KS_SEQ_COLLECTION *seqcollection, float gheatfact)</div><div class="ttdoc">Returns the time required to play out a certain number of sequence modules over some interval...</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3014</div></div>
<div class="ttc" id="struct_k_s___s_a_r_html_a3c77a7baa865a44ae8c49c408f42a5d9"><div class="ttname"><a href="struct_k_s___s_a_r.html#a3c77a7baa865a44ae8c49c408f42a5d9">KS_SAR::b1rms</a></div><div class="ttdeci">double b1rms</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1168</div></div>
<div class="ttc" id="grad__rf__empty_8h_html_a53f2690e6af35d559b80182016987d22"><div class="ttname"><a href="grad__rf__empty_8h.html#a53f2690e6af35d559b80182016987d22">rfpulse</a></div><div class="ttdeci">RF_PULSE rfpulse[RF_FREE]</div><div class="ttdef"><b>Definition:</b> grad_rf_empty.h:56</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_afd953f31b866a09e0418967c2bf65a59"><div class="ttname"><a href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a></div><div class="ttdeci">#define KS_NOTSET</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:60</div></div>
<div class="ttc" id="struct_k_s___s_a_r_html_a2e50537b138c27e2e30e8d3a568fbee0"><div class="ttname"><a href="struct_k_s___s_a_r.html#a2e50537b138c27e2e30e8d3a568fbee0">KS_SAR::average</a></div><div class="ttdeci">double average</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1165</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___s_a_r_html_a2ce680a3ce053dc060c5616496615726"><div class="ttname"><a href="struct_k_s___s_a_r.html#a2ce680a3ce053dc060c5616496615726">KS_SAR::coil</a></div><div class="ttdeci">double coil</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1166</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ac39743a45d5ad00147e24218523f88c8"><div class="ttname"><a href="_k_s_foundation_8h.html#ac39743a45d5ad00147e24218523f88c8">ks_print_seqcollection</a></div><div class="ttdeci">void ks_print_seqcollection(KS_SEQ_COLLECTION *seqcollection, FILE *fp)</div><div class="ttdoc">Print out the duration of each sequence module in the sequence collection to a file pointerBesides pr...</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3621</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n_html_a1ea5d0cb93f22f7d0fdf804bd68c3326"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a1ea5d0cb93f22f7d0fdf804bd68c3326">KS_SEQ_COLLECTION::mode</a></div><div class="ttdeci">int mode</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1150</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aeb213f86f7f6172f91b3ab69a518afe7"><div class="ttname"><a href="_k_s_foundation_8h.html#aeb213f86f7f6172f91b3ab69a518afe7">ks_eval_seqcollection_gettotalduration</a></div><div class="ttdeci">int ks_eval_seqcollection_gettotalduration(KS_SEQ_COLLECTION *seqcollection)</div><div class="ttdoc">Returns the total duration of the sequence collection</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3248</div></div>
<div class="ttc" id="ksepi_8e_html_ab5adb9efc118dc1cc8a0dc3c32cb73bf"><div class="ttname"><a href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a></div><div class="ttdeci">KS_SEQ_COLLECTION seqcollection</div><div class="ttdef"><b>Definition:</b> ksepi.e:79</div></div>
<div class="ttc" id="struct_k_s___s_a_r_html"><div class="ttname"><a href="struct_k_s___s_a_r.html">KS_SAR</a></div><div class="ttdoc">Struct to keep SAR parameters together. Used in ks_eval_gradrflimits() and GEReq_eval_checkTR_SAR_cal...</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1164</div></div>
<div class="ttc" id="_g_e_required_8e_html_a6aa2d3622908f1dd32bd380b28f1aa3a"><div class="ttname"><a href="_g_e_required_8e.html#a6aa2d3622908f1dd32bd380b28f1aa3a">MAX_TR_OVERSHOOT</a></div><div class="ttdeci">#define MAX_TR_OVERSHOOT</div><div class="ttdef"><b>Definition:</b> GERequired.e:142</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n_html_aaa31b32f56e7b425f15f4191ef1f92be"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#aaa31b32f56e7b425f15f4191ef1f92be">KS_SEQ_COLLECTION::evaltrdone</a></div><div class="ttdeci">int evaltrdone</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1152</div></div>
<div class="ttc" id="_g_e_required_8e_html_a7ca8f149618c5cab125f422cd627c433"><div class="ttname"><a href="_g_e_required_8e.html#a7ca8f149618c5cab125f422cd627c433">ks_gheatfact</a></div><div class="ttdeci">float ks_gheatfact</div><div class="ttdef"><b>Definition:</b> GERequired.e:241</div></div>
<div class="ttc" id="_g_e_required_8e_html_ac2a9639645541b0daab96065b217062d"><div class="ttname"><a href="_g_e_required_8e.html#ac2a9639645541b0daab96065b217062d">ks_sarcheckdone</a></div><div class="ttdeci">int ks_sarcheckdone</div><div class="ttdef"><b>Definition:</b> GERequired.e:216</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a99fb83031ce9923c84392b4e92f956b5af64c78cedb5f88bb17738bcf993a7755"><div class="ttname"><a href="_k_s_foundation_8h.html#a99fb83031ce9923c84392b4e92f956b5af64c78cedb5f88bb17738bcf993a7755">KS_SEQ_COLLECTION_LOCKED</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1771</div></div>
<div class="ttc" id="struct_k_s___s_a_r_html_aa7fd5e56ed5028cc63702f999df5cbfd"><div class="ttname"><a href="struct_k_s___s_a_r.html#aa7fd5e56ed5028cc63702f999df5cbfd">KS_SAR::peak</a></div><div class="ttdeci">double peak</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1167</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a736f7a360ad913bc8295ee2bddc6525e"><div class="ttname"><a href="_k_s_foundation_8h.html#a736f7a360ad913bc8295ee2bddc6525e">ks_eval_seqcollection2rfpulse</a></div><div class="ttdeci">STATUS ks_eval_seqcollection2rfpulse(RF_PULSE *rfpulse, KS_SEQ_COLLECTION *seqcollection)</div><div class="ttdoc">(Internal use) Sets up GE&amp;#39;s rfpulse[] array from the contents of a KS_SEQ_COLLECTION struct...</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3296</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a027161dabe834c55750bd1e7f2fa8473"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a027161dabe834c55750bd1e7f2fa8473">&#9670;&nbsp;</a></span>GEReq_eval_checkTR_SAR()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS GEReq_eval_checkTR_SAR </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html">KS_SEQ_COLLECTION</a> *&#160;</td>
          <td class="paramname"><em>seqcollection</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nslices</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int(*)(int, int, void **)&#160;</td>
          <td class="paramname"><em>play_loop</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nargs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void **&#160;</td>
          <td class="paramname"><em>args</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Runs the slice loop and validates TR and SAR/hardware limits</h4>
</p>
<p>This function first makes sure that the <code>.nseqinstances</code> field for each sequence module in the sequence collection corresponds to the number of times played out in the sequence's sliceloop function.</p>
<p>In simulation (WTools), <a class="el" href="_k_s_foundation_8h.html#ac39743a45d5ad00147e24218523f88c8" title="Print out the duration of each sequence module in the sequence collection to a file pointerBesides pr...">ks_print_seqcollection()</a> will print out a table of the sequence modules in the sequence collection in the WToolsMgd window.</p>
<p>Finally, <a class="el" href="_g_e_required_8e.html#a789f2b2ac7ec21daa6a693820873e64a" title="Checks that sequence modules sum up to TR, honoring SAR/heating limits">GEReq_eval_checkTR_SAR_calcs()</a> is called to check that the TR is correct and within SAR/hardware limits.</p>
<p>N.B.: For inversion sequences, <a class="el" href="_k_s_inversion_8e.html#aa08a7ecfbf13a621a577fa984bda2b5a" title="Runs the inversion slice loop and validates TR and SAR/hardware limits">ksinv_eval_checkTR_SAR()</a> is used to do the same thing, with the difference that <a class="el" href="_k_s_inversion_8e.html#af0adb26c729e5b3bd252f5e1918869c4" title="Plays out slice_plan.nslices_per_pass slices corresponding to one TR for inversion psds...">ksinv_scan_sliceloop()</a> is used instead.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">seqcollection</td><td>Pointer to the <a class="el" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html" title="Collection handle of all sequence modules involved in the pulse sequence, used for RF scaling...">KS_SEQ_COLLECTION</a> struct holding all sequence modules </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nslices</td><td>Number of slices in TR </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">play_loop</td><td>Function pointer to (the wrapper function to) the sliceloop function </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nargs</td><td>Number of extra input arguments to the sliceloop wrapper function. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">args</td><td>Void pointer array pointing to the variables containing the actual values needed for the sliceloop function </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;                                                                                                                                                {</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a> == NULL || <a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>-&gt;<a class="code" href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a65c4aa433169274a52c448793e82e12e">numseq</a> == 0) {</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: Please add pulse sequence modules to the sequence collection before calling this function&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;  }</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;  <span class="comment">/* set all `seqctrl.nseqinstances` to 0 */</span></div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#acb34cd9d6c99193829696596b4d0271f">ks_eval_seqcollection_resetninst</a>(<a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>);</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;  play_loop(nslices, nargs, args); <span class="comment">/* =&gt; seqctrl.nseqinstances = # times each seq. module has been played out */</span></div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_g_e_required_8e.html#a789f2b2ac7ec21daa6a693820873e64a">GEReq_eval_checkTR_SAR_calcs</a>(<a class="code" href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a>, optr);</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;} <span class="comment">/* GEReq_eval_checkTR_SAR() */</span></div><div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="ksepi_8e_html_ab5adb9efc118dc1cc8a0dc3c32cb73bf"><div class="ttname"><a href="ksepi_8e.html#ab5adb9efc118dc1cc8a0dc3c32cb73bf">seqcollection</a></div><div class="ttdeci">KS_SEQ_COLLECTION seqcollection</div><div class="ttdef"><b>Definition:</b> ksepi.e:79</div></div>
<div class="ttc" id="_g_e_required_8e_html_a789f2b2ac7ec21daa6a693820873e64a"><div class="ttname"><a href="_g_e_required_8e.html#a789f2b2ac7ec21daa6a693820873e64a">GEReq_eval_checkTR_SAR_calcs</a></div><div class="ttdeci">STATUS GEReq_eval_checkTR_SAR_calcs(KS_SEQ_COLLECTION *seqcollection, int intended_time)</div><div class="ttdoc">Checks that sequence modules sum up to TR, honoring SAR/heating limits</div><div class="ttdef"><b>Definition:</b> GERequired.e:857</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_acb34cd9d6c99193829696596b4d0271f"><div class="ttname"><a href="_k_s_foundation_8h.html#acb34cd9d6c99193829696596b4d0271f">ks_eval_seqcollection_resetninst</a></div><div class="ttdeci">void ks_eval_seqcollection_resetninst(KS_SEQ_COLLECTION *seqcollection)</div><div class="ttdoc">Set the .nseqinstances field of each sequence module (KS_SEQ_CONTROL) equal to 0</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3235</div></div>
<div class="ttc" id="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n_html_a65c4aa433169274a52c448793e82e12e"><div class="ttname"><a href="struct_k_s___s_e_q___c_o_l_l_e_c_t_i_o_n.html#a65c4aa433169274a52c448793e82e12e">KS_SEQ_COLLECTION::numseq</a></div><div class="ttdeci">int numseq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1149</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="adafdd7c32e3e366cfdf89d47d463218d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adafdd7c32e3e366cfdf89d47d463218d">&#9670;&nbsp;</a></span>GEReq_predownload_store_sliceplan()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS GEReq_predownload_store_sliceplan </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___s_l_i_c_e___p_l_a_n.html">KS_SLICE_PLAN</a>&#160;</td>
          <td class="paramname"><em>slice_plan</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets mandatory global GE arrays for data acquisition</h4>
</p>
<p>The following global GE arrays are set based on slperpass (arg 1) and global op** variables:</p><ul>
<li><code>data_acq_order[]</code>: Critical for scanning</li>
<li><code>rsp_info[]</code>: Copied from scan_info[] (the graphically prescibed slices), for conformance. Is a temporally sorted version of scan_info[] with integer rotation matrices. Not needed for scanning.</li>
<li><code>rsptrigger[]</code>: Set to TRIG_INTERN for now.</li>
</ul>
<p>data_acq_order[] is only available on HOST, why this function also copies data_acq_order[] to ks_data_acq_order[], which is an <code>ipgexport</code> array accessible on both HOST and TGT. This can be used by <a class="el" href="_k_s_foundation_8h.html#aa3ed2adea6f1023e3f926978e9a7b856" title="Returns the spatially sorted slice index from a DATA_ACQ_ORDER struct array">ks_scan_getsliceloc()</a> to be independent on rsp_info[] during scan.</p>
<p>The slice plan is stored as a text file ("ks_sliceplan.txt") in the current directory in simulation and in /usr/g/mrraw on the MR scanner by calling <a class="el" href="_k_s_foundation_8h.html#a4052b13d56c45955a6bd6c8f57f4cbc6" title="Writes a KS_SLICE_PLAN to a file pointer">ks_print_sliceplan()</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">slice_plan</td><td>The current slice plan (<a class="el" href="struct_k_s___s_l_i_c_e___p_l_a_n.html" title="Struct holding all information about slice locations and aquisition order">KS_SLICE_PLAN</a>) set up for the sequence (see <a class="el" href="_k_s_foundation_8h.html#a99557514f220cf0e97668286792e79cb" title="Calculates the data acquisition order for a standard interleaved 2D scans using one or more passes...">ks_calc_sliceplan()</a>) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;                                                                   {</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;  <span class="keywordtype">int</span> i, j, time;</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;  <span class="keywordflow">if</span> (CEIL_DIV(slice_plan.<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a3414dc896f1276457707d70318d46770">nslices</a>, slice_plan.<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a3c4ea64a2a861da12849cb565afab129">nslices_per_pass</a>) != slice_plan.<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a9cd9ebd93187231e5c4109d14c0dd69c">npasses</a>) {</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: inconsistent slice plan - #acqs&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;  }</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="_k_s_foundation_8h.html#a969816ef84367f11542f3473473260dc">KS_3D_SELECTED</a> &amp;&amp; slice_plan.<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a3414dc896f1276457707d70318d46770">nslices</a> != exist(opslquant)) {</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: inconsistent slice plan - #slices&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;  }</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;  <span class="comment">/* initialize rsp_info, rtsprot and rsptrigger */</span></div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; DATA_ACQ_MAX; i++) {</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;    rsp_info[i].rsptloc = 0;</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;    rsp_info[i].rsprloc = 0;</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;    rsp_info[i].rspphasoff = 0;</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;    rsptrigger[i] = TRIG_INTERN;</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;    <span class="keywordflow">for</span> (j = 0; j &lt; 9; j++)</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;      <a class="code" href="_k_s_foundation__tgt_8c.html#a327dd261edd2ec61105487e4073cba27">rsprot</a>[i][j] = 0;</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;  }</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;  <span class="comment">/* copy to global data_acq_order, which must be correct for main sequence or scan will not start */</span></div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; slice_plan.<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a3414dc896f1276457707d70318d46770">nslices</a>; i++) {</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;    data_acq_order[i].slloc = slice_plan.<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#af6c9bb6611e03718085512d2c90cfcd8">acq_order</a>[i].slloc;</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;    data_acq_order[i].slpass = slice_plan.<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#af6c9bb6611e03718085512d2c90cfcd8">acq_order</a>[i].slpass;</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;    data_acq_order[i].sltime = slice_plan.<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#af6c9bb6611e03718085512d2c90cfcd8">acq_order</a>[i].sltime;</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;  } <span class="comment">/* for slice locations */</span></div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;  <span class="keywordflow">for</span> (i = slice_plan.<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a3414dc896f1276457707d70318d46770">nslices</a>; i &lt; SLICE_FACTOR*DATA_ACQ_MAX; i++) {</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;    data_acq_order[i].slloc = 0;</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;    data_acq_order[i].slpass = 0;</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;    data_acq_order[i].sltime = 0;</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;  } <span class="comment">/* for rest of data_acq_order */</span></div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;  time = 0;</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; slice_plan.<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a9cd9ebd93187231e5c4109d14c0dd69c">npasses</a>; ++i) {</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;    <span class="keywordflow">for</span> (j = 0; j &lt; slice_plan.<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a3c4ea64a2a861da12849cb565afab129">nslices_per_pass</a>; ++j) {</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;      <span class="keywordtype">int</span> slloc = <a class="code" href="_k_s_foundation_8h.html#aa3ed2adea6f1023e3f926978e9a7b856">ks_scan_getsliceloc</a>(&amp;slice_plan, i, j);</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;      <span class="keywordflow">if</span> (slloc == <a class="code" href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a>) {<span class="keywordflow">continue</span>;}</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;      rsp_info[time].rsptloc = scan_info[slloc].optloc;</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;      rsp_info[time].rsprloc = scan_info[slloc].oprloc;</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;      rsp_info[time].rspphasoff = scan_info[slloc].opphasoff;</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;      scale(&amp;scan_info[slloc].oprot, &amp;<a class="code" href="_k_s_foundation__tgt_8c.html#a327dd261edd2ec61105487e4073cba27">rsprot</a>[time], 1, &amp;<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>, &amp;<a class="code" href="_k_s_foundation_8h.html#af51ba165cbaf874219789beaa48f2464">phygrd</a>, 0);</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;      <span class="comment">/* Future: here we could change to a variable to support gating. TRIG_ECG, TRIG_AUX etc */</span></div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;      rsptrigger[time] = TRIG_INTERN;</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;      ++time;</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;    }</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;  }</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;  STATUS status = calcChecksumScanInfo(&amp;chksum_scaninfo, scan_info, slice_plan.<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a3414dc896f1276457707d70318d46770">nslices</a>, psdcrucial_debug);</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;  <span class="keywordflow">if</span> (status != SUCCESS) {</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    epic_error(1, <span class="stringliteral">&quot;PSD data integrity violation detected in PSD, Please try again or restart the system.&quot;</span>,</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;               EM_PSD_PSDCRUCIAL_DATA_FAILURE, EE_ARGS(1), SYSLOG_ARG);</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    <span class="keywordflow">return</span> status;</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;  }</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;  <span class="comment">/* Save acquisition table to disk for debugging */</span></div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;<span class="preprocessor">#ifdef PSD_HW</span></div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;  FILE *daqfp = fopen(<span class="stringliteral">&quot;/usr/g/mrraw/ks_sliceplan.txt&quot;</span>, <span class="stringliteral">&quot;w&quot;</span>);</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;  FILE *daqfp = fopen(<span class="stringliteral">&quot;./ks_sliceplan.txt&quot;</span>, <span class="stringliteral">&quot;w&quot;</span>);</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a4052b13d56c45955a6bd6c8f57f4cbc6">ks_print_sliceplan</a>(slice_plan, daqfp);</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;  fclose(daqfp);</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;  <span class="comment">/* set GE acqs and slquant1 CVs for look and feel */</span></div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;  _slquant1.fixedflag = 0;</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;  _acqs.fixedflag = 0;</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;  slquant1 = slice_plan.<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a3c4ea64a2a861da12849cb565afab129">nslices_per_pass</a>;</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;  acqs = slice_plan.<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a9cd9ebd93187231e5c4109d14c0dd69c">npasses</a>;</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;  <span class="comment">/* prescan */</span></div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;  picalmode = 0;</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;  pislquant = slquant1;</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;}</div><div class="ttc" id="struct_k_s___s_l_i_c_e___p_l_a_n_html_af6c9bb6611e03718085512d2c90cfcd8"><div class="ttname"><a href="struct_k_s___s_l_i_c_e___p_l_a_n.html#af6c9bb6611e03718085512d2c90cfcd8">KS_SLICE_PLAN::acq_order</a></div><div class="ttdeci">DATA_ACQ_ORDER acq_order[SLICE_FACTOR *DATA_ACQ_MAX]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1203</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_afd953f31b866a09e0418967c2bf65a59"><div class="ttname"><a href="_k_s_foundation_8h.html#afd953f31b866a09e0418967c2bf65a59">KS_NOTSET</a></div><div class="ttdeci">#define KS_NOTSET</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:60</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4052b13d56c45955a6bd6c8f57f4cbc6"><div class="ttname"><a href="_k_s_foundation_8h.html#a4052b13d56c45955a6bd6c8f57f4cbc6">ks_print_sliceplan</a></div><div class="ttdeci">void ks_print_sliceplan(const KS_SLICE_PLAN slice_plan, FILE *fp)</div><div class="ttdoc">Writes a KS_SLICE_PLAN to a file pointer</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3640</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a969816ef84367f11542f3473473260dc"><div class="ttname"><a href="_k_s_foundation_8h.html#a969816ef84367f11542f3473473260dc">KS_3D_SELECTED</a></div><div class="ttdeci">#define KS_3D_SELECTED</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:104</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_af51ba165cbaf874219789beaa48f2464"><div class="ttname"><a href="_k_s_foundation_8h.html#af51ba165cbaf874219789beaa48f2464">phygrd</a></div><div class="ttdeci">PHYS_GRAD phygrd</div></div>
<div class="ttc" id="struct_k_s___s_l_i_c_e___p_l_a_n_html_a3c4ea64a2a861da12849cb565afab129"><div class="ttname"><a href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a3c4ea64a2a861da12849cb565afab129">KS_SLICE_PLAN::nslices_per_pass</a></div><div class="ttdeci">int nslices_per_pass</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1202</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a327dd261edd2ec61105487e4073cba27"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a327dd261edd2ec61105487e4073cba27">rsprot</a></div><div class="ttdeci">long rsprot[DATA_ACQ_MAX][9]</div></div>
<div class="ttc" id="struct_k_s___s_l_i_c_e___p_l_a_n_html_a9cd9ebd93187231e5c4109d14c0dd69c"><div class="ttname"><a href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a9cd9ebd93187231e5c4109d14c0dd69c">KS_SLICE_PLAN::npasses</a></div><div class="ttdeci">int npasses</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1201</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
<div class="ttc" id="struct_k_s___s_l_i_c_e___p_l_a_n_html_a3414dc896f1276457707d70318d46770"><div class="ttname"><a href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a3414dc896f1276457707d70318d46770">KS_SLICE_PLAN::nslices</a></div><div class="ttdeci">int nslices</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1200</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_aa3ed2adea6f1023e3f926978e9a7b856"><div class="ttname"><a href="_k_s_foundation_8h.html#aa3ed2adea6f1023e3f926978e9a7b856">ks_scan_getsliceloc</a></div><div class="ttdeci">int ks_scan_getsliceloc(const KS_SLICE_PLAN *slice_plan, int passindx, int sltimeinpass)</div><div class="ttdoc">Returns the spatially sorted slice index from a DATA_ACQ_ORDER struct array</div><div class="ttdef"><b>Definition:</b> KSFoundation_tgt.c:1022</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="afc4267e86a2b954a6dfbbc65bcee32f5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afc4267e86a2b954a6dfbbc65bcee32f5">&#9670;&nbsp;</a></span>GEReq_predownload_store_sliceplan3D()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS GEReq_predownload_store_sliceplan3D </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>slices_in_slab</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>slabs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets mandatory global GE arrays for data acquisition (3D imaging)</h4>
</p>
<p>The following global GE arrays are set based on slperpass (arg 1) and global op** variables:</p><ul>
<li><code>data_acq_order[]</code>: Critical for scanning</li>
<li><code>rsp_info[]</code>: Copied from scan_info[] (the graphically prescibed slices), for conformance. Is a temporally sorted version of scan_info[] with integer rotation matrices. Not needed for scanning.</li>
<li><code>rsptrigger[]</code>: Set to TRIG_INTERN for now.</li>
</ul>
<p>data_acq_order[] is only available on HOST, why this function also copies data_acq_order[] to ks_data_acq_order[], which is an <code>ipgexport</code> array accessible on both HOST and TGT. This can be used by <a class="el" href="_k_s_foundation_8h.html#aa3ed2adea6f1023e3f926978e9a7b856" title="Returns the spatially sorted slice index from a DATA_ACQ_ORDER struct array">ks_scan_getsliceloc()</a> to be independent on rsp_info[] during scan.</p>
<p><a class="el" href="_g_e_required_8e.html#afc4267e86a2b954a6dfbbc65bcee32f5" title="Sets mandatory global GE arrays for data acquisition (3D imaging)">GEReq_predownload_store_sliceplan3D()</a> has different input args compared to the 2D version. Here, a temporary slice plan is created based on slices_in_slab and slabs in order to create the proper content of data_acq_order[]. Note that it wouldn't have worked to pass ks_slice_plan for 3D. This is because we need a ks_slice_plan that is consistent with RF excitations for 2D, 3D, 3DMS in each sequence's looping structure in scan. For 3D, this very ks_slice_plan can then not also create the proper data_acq_order array here. This is why we pass in slices_in_slab and slabs instead and create e temp slice plan solely for the purpose of data_acq_order.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">slices_in_slab</td><td>Number of slices in a slab </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">slabs</td><td>Number slabs </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;                                                                          {</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;  <a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html">KS_SLICE_PLAN</a> slice_plan;</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;  <span class="comment">/* TODO: unclear for 3D MS, inteleaved and sequential */</span></div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;  <a class="code" href="_k_s_foundation_8h.html#a7f48f728f188959481f3a203f7ffe853">ks_calc_sliceplan_interleaved</a>(&amp;slice_plan, slices_in_slab * slabs, slices_in_slab, 1);</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="_g_e_required_8e.html#adafdd7c32e3e366cfdf89d47d463218d">GEReq_predownload_store_sliceplan</a>(slice_plan);</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;  }</div><div class="ttc" id="_g_e_required_8e_html_adafdd7c32e3e366cfdf89d47d463218d"><div class="ttname"><a href="_g_e_required_8e.html#adafdd7c32e3e366cfdf89d47d463218d">GEReq_predownload_store_sliceplan</a></div><div class="ttdeci">STATUS GEReq_predownload_store_sliceplan(KS_SLICE_PLAN slice_plan)</div><div class="ttdoc">Sets mandatory global GE arrays for data acquisition</div><div class="ttdef"><b>Definition:</b> GERequired.e:1012</div></div>
<div class="ttc" id="struct_k_s___s_l_i_c_e___p_l_a_n_html"><div class="ttname"><a href="struct_k_s___s_l_i_c_e___p_l_a_n.html">KS_SLICE_PLAN</a></div><div class="ttdoc">Struct holding all information about slice locations and aquisition order</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1199</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a7f48f728f188959481f3a203f7ffe853"><div class="ttname"><a href="_k_s_foundation_8h.html#a7f48f728f188959481f3a203f7ffe853">ks_calc_sliceplan_interleaved</a></div><div class="ttdeci">STATUS ks_calc_sliceplan_interleaved(KS_SLICE_PLAN *slice_plan, int nslices, int slperpass, int inpass_interleaves)</div><div class="ttdoc">Calculates the data acquisition order for custom interleaved 2D scans using one or more passes...</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3435</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa2b5289cf54c04c4c834bad269af6c9b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa2b5289cf54c04c4c834bad269af6c9b">&#9670;&nbsp;</a></span>GEReq_predownload_setfilter()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS GEReq_predownload_setfilter </td>
          <td>(</td>
          <td class="paramtype">FILTER_INFO *&#160;</td>
          <td class="paramname"><em>filt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Assigns a global filter slot for a main sequence</h4>
</p>
<p>This function must be called in <a class="el" href="ksepi_8e.html#a6dab68043b9947b6a659f72613c083ec">predownload()</a> after GE's initfilter() function, which resets all filter slots for scan and prescan entry points. The initfilter() function is called in <a class="el" href="_g_e_required_8e.html#a67a331f96035253e5efbb3e2f2ad3f24" title="Helper function to be called at the beginning of cvinit()">GEReq_cvinit()</a>.</p>
<p>Given the FILTER_INFO of the acquisition window for the main pulse sequence (arg 1), this function assigns a new slot number (that matches one of the hardware slots in the data receive chain.</p>
<p>The <code>.epfilter</code> and <code>.epprexres</code> of GE's global struct array <code>entry_point_table[]</code> is also set.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">filt</td><td>Pointer to FILTER_INFO struct (<code>.filt</code> field in <a class="el" href="struct_k_s___r_e_a_d.html" title="Core sequence object that handles a data acquisition window">KS_READ</a>) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;                                                      {</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;  setfilter(filt, SCAN);</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;  entry_point_table[L_SCAN].epfilter = (<span class="keywordtype">unsigned</span> char) filt-&gt;fslot;</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;  entry_point_table[L_SCAN].epprexres = filt-&gt;outputs;</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;  <span class="comment">/* APS2 &amp; MPS2 */</span></div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;  entry_point_table[L_APS2] = entry_point_table[L_MPS2] = entry_point_table[L_SCAN];  <span class="comment">/* copy scan into APS2 &amp; MPS2 */</span></div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;  strcpy(entry_point_table[L_APS2].epname, <span class="stringliteral">&quot;aps2&quot;</span>);</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;  strcpy(entry_point_table[L_MPS2].epname, <span class="stringliteral">&quot;mps2&quot;</span>);</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;} <span class="comment">/* GEReq_predownload_setfilter() */</span></div></div><!-- fragment -->
</div>
</div>
<a id="a7ea1ad4e9625baa434eecb32fc2f2563"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7ea1ad4e9625baa434eecb32fc2f2563">&#9670;&nbsp;</a></span>GEReq_predownload_genVRGF()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS GEReq_predownload_genVRGF </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a> *const&#160;</td>
          <td class="paramname"><em>readtrap</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Generates the vrgf.param file for rampsampling correction</h4>
</p>
<p>When the <code>.rampsampling</code> field of a <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> is set to 1, 1D gridding in the frequency encoding direction is necessary before FFT to obtain an equidistant k-space. GE's product reconstruction uses a file (<code>vrgf.param</code>) for this, which is generated by this function.</p>
<p>See also <a class="el" href="_g_e_required_8e.html#a6d51efff591f87dbcc7887e45c16db0f" title="Sets required global rh*** variables for Cartsian imaging">GEReq_predownload_setrecon_readphase()</a>, which sets VRGF-specific global variables.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">readtrap</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;                                                                     {</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;  FILE *fpVRGF;</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;  <span class="keywordtype">float</span> beta = 1.0;</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;  <span class="keywordtype">float</span> alpha = 2.0 / (beta + 1.0);</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;<span class="preprocessor">#ifdef SIM</span></div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;  fpVRGF = fopen(<span class="stringliteral">&quot;./vrgf.param&quot;</span>, <span class="stringliteral">&quot;w&quot;</span>);</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;  fpVRGF = fopen(<span class="stringliteral">&quot;/usr/g/bin/vrgf.param&quot;</span>, <span class="stringliteral">&quot;w&quot;</span>);</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;  <span class="comment">/* based on: /ESE.../.../psdsupport/genVRGF.c  */</span></div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;  <span class="comment">/* NOTE: The static file /usr/g/bin/vrgf.param2, i.e. with a trailing &quot;2&quot;, containing the following </span></div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;<span class="comment">     must exist on the system in order for the executable /usr/g/bin/vrgf to generate vrgf.dat from </span></div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;<span class="comment">     the vrgf.param we are about to write:</span></div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;<span class="comment">     VRGFNORM=   1</span></div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;<span class="comment">     GAIN=     1.0</span></div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;<span class="comment">     VRGFWN=     1</span></div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;<span class="comment">     ALPHA=   0.46</span></div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;<span class="comment">     BETA=     1.0</span></div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;<span class="comment">     VRGFODS=  0.0</span></div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;<span class="comment">     VRGFCC=     0</span></div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;<span class="comment">     VRGFGS=     1</span></div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;<span class="comment">     VRGFSGG=    0</span></div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;<span class="comment">     VRGFBWF= -1.0</span></div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;  fprintf(fpVRGF, <span class="stringliteral">&quot;VRGFIP=    %d\n&quot;</span>, readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">filt</a>.outputs);</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;  fprintf(fpVRGF, <span class="stringliteral">&quot;VRGFOP=    %d\n&quot;</span>, readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#aac31eb68bff694554a182bd796b2f1c5">res</a>);</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;  fprintf(fpVRGF, <span class="stringliteral">&quot;PERIOD=    %f\n&quot;</span>, readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">filt</a>.tsp);</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;  fprintf(fpVRGF, <span class="stringliteral">&quot;WAVE_CHOICE=  %d\n&quot;</span>, 1);</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;  fprintf(fpVRGF, <span class="stringliteral">&quot;G1=        %d\n&quot;</span>, 1);</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;  fprintf(fpVRGF, <span class="stringliteral">&quot;G2=        %f\n&quot;</span>, readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a>);</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;  fprintf(fpVRGF, <span class="stringliteral">&quot;G3=        %f\n&quot;</span>, (readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">plateautime</a> / 2) / 1.0e6);</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;  fprintf(fpVRGF, <span class="stringliteral">&quot;G4=        %f\n&quot;</span>, readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a> / 1.0e6);</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;  fprintf(fpVRGF, <span class="stringliteral">&quot;G5=        %f\n&quot;</span>, alpha);</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;  fprintf(fpVRGF, <span class="stringliteral">&quot;G6=        %f\n&quot;</span>, beta);</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;  fprintf(fpVRGF, <span class="stringliteral">&quot;G7=        %f\n&quot;</span>, 0.0);</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;  fprintf(fpVRGF, <span class="stringliteral">&quot;G8=        %f\n&quot;</span>, readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a544d58cc06d73e0f73e464114f6e5318">rbw</a> * 1.0e3);</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;  fprintf(fpVRGF, <span class="stringliteral">&quot;G9=        %f\n&quot;</span>, 0.0);</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;  <span class="keywordflow">if</span> (fclose(fpVRGF) != 0) {</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;    <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;Can&#39;t close vrgf.param&quot;</span>);</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;  }</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;} <span class="comment">/* GEReq_predownload_genVRGF() */</span></div><div class="ttc" id="struct_k_s___t_r_a_p_html_a878bb367b07dc7dfb5fef5728d2e5b1d"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">KS_TRAP::plateautime</a></div><div class="ttdeci">int plateautime</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:436</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a544d58cc06d73e0f73e464114f6e5318"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a544d58cc06d73e0f73e464114f6e5318">KS_READ::rbw</a></div><div class="ttdeci">float rbw</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:584</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">KS_READTRAP::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1435</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#aac31eb68bff694554a182bd796b2f1c5">KS_READTRAP::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1426</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ab508ded41392ee86a2a619d3e93d2373"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">KS_TRAP::amp</a></div><div class="ttdeci">float amp</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:433</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a292f93e48d34cda511fcfb72a05558c2"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">KS_READ::filt</a></div><div class="ttdeci">FILTER_INFO filt</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:585</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_ac359c54a7c5f9e9a94105b3c0d0be9ea"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">KS_READTRAP::acq</a></div><div class="ttdeci">KS_READ acq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1423</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_acbc719dc4e48c2a2df0447875e4348ca"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">KS_TRAP::ramptime</a></div><div class="ttdeci">int ramptime</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:435</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1df29f83c19052911e6775f350ff085d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1df29f83c19052911e6775f350ff085d">&#9670;&nbsp;</a></span>GEReq_predownload_genrowflip()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS GEReq_predownload_genrowflip </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *&#160;</td>
          <td class="paramname"><em>epi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>blipsign</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>assetflag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dorowflip</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Generates the rowflip.param file for <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a></h4>
</p>
<p>GE's reconstruction (and data dumping) of EPI data (where every other readout is negative) needs to know which k-space lines that have been acquired with a negative gradient to perform a row flip on these lines before proceeding with Pfile writing and FFT processing.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">epi</td><td>Pointer to <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">blipsign</td><td>KS_EPI_POSBLIPS or KS_EPI_NEGBLIPS </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">assetflag</td><td>Flag for ASSET mode or not (0: off, 2: ASSET_SCAN (on)) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dorowflip</td><td>If 0, write just ones to let rowflipping process for Pfiles being executed without actual flipping </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;                                                                                             {</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;  FILE *rowflipfp;</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;  <span class="keywordtype">int</span> i = 0;</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;  <span class="keywordtype">int</span> j = 0;</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;  <span class="keywordtype">int</span> kyview = 0;</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;  <span class="keywordtype">int</span> view1st, viewskip;</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;  <span class="keywordtype">int</span> readsign = 1;</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;  <span class="keywordtype">int</span> rowskip, res;</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;<span class="preprocessor">#ifdef SIM</span></div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;  rowflipfp = fopen(<span class="stringliteral">&quot;./rowflip.param&quot;</span>, <span class="stringliteral">&quot;w&quot;</span>);</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;  rowflipfp = fopen(<span class="stringliteral">&quot;/usr/g/bin/rowflip.param&quot;</span>, <span class="stringliteral">&quot;w&quot;</span>);</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;  fprintf(rowflipfp, <span class="stringliteral">&quot;# EPI recon control\n&quot;</span>);</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;  fprintf(rowflipfp, <span class="stringliteral">&quot;#\n&quot;</span>);</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;  fprintf(rowflipfp, <span class="stringliteral">&quot;# ky line number/flip operation\n&quot;</span>);</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;  fprintf(rowflipfp, <span class="stringliteral">&quot;%d %d\n&quot;</span>, 0, 1);</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;  <span class="keywordflow">if</span> (assetflag == ASSET_SCAN) {</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;    rowskip = 1;</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;    res = epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a> / epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a>;</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;    rowskip = epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a>;</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;    res = epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a>;</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;  }</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a>; i++) {</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;    <span class="keywordflow">for</span> (j = 0; j &lt; rowskip; j++) {</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;      kyview = i * rowskip + j;</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;      readsign = (i % 2) ? -1 : 1;</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;      <span class="keywordflow">if</span> (blipsign == <a class="code" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811ab36b1c8bcdbe924fc9d4a36cde9ba4dd">KS_EPI_POSBLIPS</a> &amp;&amp; (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a> % 2 == 0)) {</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;        readsign *= -1;</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;      }</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;      fprintf(rowflipfp, <span class="stringliteral">&quot;%d %d\n&quot;</span>, kyview + 1, (dorowflip) ? readsign : 1);</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;    }</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;  }</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;  <span class="keywordflow">for</span> (kyview = i * rowskip + j; kyview &lt; res; kyview++)</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;    fprintf(rowflipfp, <span class="stringliteral">&quot;%d %d\n&quot;</span>, kyview + 1, 1);</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;  fprintf(rowflipfp, <span class="stringliteral">&quot;#\n#\n#intleave 1stview skip gpol bpol gy1f rfpol tf nechoes init_echo_pol\n&quot;</span> );</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;  <span class="keywordflow">for</span> (j = 0; j &lt; rowskip; j++) {</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;    <span class="keywordflow">if</span> (blipsign == <a class="code" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811ab36b1c8bcdbe924fc9d4a36cde9ba4dd">KS_EPI_POSBLIPS</a> &amp;&amp; (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a> % 2 == 0)) {</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;      view1st = (assetflag == ASSET_SCAN) ? (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a> - 1) : (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[(epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a> - 1)] + j);</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;      viewskip = -rowskip;</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;      view1st = (assetflag == ASSET_SCAN) ? 0 : (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[0] + j);</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;      viewskip = rowskip;</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;    }</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;    fprintf(rowflipfp, <span class="stringliteral">&quot;%d %d %d %d %d %d %d %d %d %d\n&quot;</span>, j, view1st + 1, viewskip, 1, blipsign, 0 <span class="comment">/* max int dephaser */</span>, 1 <span class="comment">/* rfpol*/</span>, 0 <span class="comment">/* tf */</span>, epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a>, 1);</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;  }</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;  fprintf(rowflipfp, <span class="stringliteral">&quot;# esp (usec)\n&quot;</span>);</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;  fprintf(rowflipfp, <span class="stringliteral">&quot;%d \n&quot;</span>, epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>);</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;  fprintf(rowflipfp, <span class="stringliteral">&quot;# tsp (usec)\n&quot;</span>);</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;  fprintf(rowflipfp, <span class="stringliteral">&quot;%f \n&quot;</span>, epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">filt</a>.tsp);</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;  fprintf(rowflipfp, <span class="stringliteral">&quot;# input samples\n&quot;</span>);</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;  fprintf(rowflipfp, <span class="stringliteral">&quot;%d \n&quot;</span>, epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">filt</a>.outputs);</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;  fprintf(rowflipfp, <span class="stringliteral">&quot;# readout amplitude (G/cm)\n&quot;</span>);</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;  fprintf(rowflipfp, <span class="stringliteral">&quot;%f \n&quot;</span>, epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a>);</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;  fprintf(rowflipfp, <span class="stringliteral">&quot;# Row FT size\n&quot;</span>);</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;  fprintf(rowflipfp, <span class="stringliteral">&quot;%d \n&quot;</span>, epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#aac31eb68bff694554a182bd796b2f1c5">res</a>);</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;  fprintf(rowflipfp, <span class="stringliteral">&quot;# rhhnover \n&quot;</span>);</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;  fprintf(rowflipfp, <span class="stringliteral">&quot;%d \n&quot;</span>, epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a>);</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;  fprintf(rowflipfp, <span class="stringliteral">&quot;# etl\n&quot;</span>);</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;  fprintf(rowflipfp, <span class="stringliteral">&quot;%d \n&quot;</span>, epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a>);</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;  fprintf(rowflipfp, <span class="stringliteral">&quot;# number of interleaves\n&quot;</span>);</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;  fprintf(rowflipfp, <span class="stringliteral">&quot;%d \n&quot;</span>, epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a>);</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;  fprintf(rowflipfp, <span class="stringliteral">&quot;# low pass filter setting (kHz), or -1 for std. rcvr.\n&quot;</span>);</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;  fprintf(rowflipfp, <span class="stringliteral">&quot;%d \n&quot;</span>, -1);</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;  fprintf(rowflipfp, <span class="stringliteral">&quot;# total number of images\n&quot;</span>);</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;  fprintf(rowflipfp, <span class="stringliteral">&quot;%d \n&quot;</span>, opslquant);</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;  fprintf(rowflipfp, <span class="stringliteral">&quot;# end of file&quot;</span>);</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;  fclose(rowflipfp);</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;} <span class="comment">/* GEReq_predownload_genrowflip() */</span></div><div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a3d90133d3051fbc4816d02efd9566d8e"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">KS_PHASER::R</a></div><div class="ttdeci">int R</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1529</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">KS_PHASER::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1527</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a22cd0313e5ffabe8393f77745dba8d52"><div class="ttname"><a href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">KS_EPI::blipphaser</a></div><div class="ttdeci">KS_PHASER blipphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1688</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a09b1a7dc77a7cf8c4e8421a23608a42a"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">KS_PHASER::numlinestoacq</a></div><div class="ttdeci">int numlinestoacq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1532</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a090fbced834ec878a08eadc4f829b8a3"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">KS_PHASER::linetoacq</a></div><div class="ttdeci">int linetoacq[KS_MAX_PHASEDYN]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1533</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">KS_READTRAP::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1435</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a7582325a159d8ec89a4a4ba0fb89e9a9"><div class="ttname"><a href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">KS_EPI::etl</a></div><div class="ttdeci">int etl</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1690</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#aac31eb68bff694554a182bd796b2f1c5">KS_READTRAP::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1426</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a03d42c44e323f3203fe5beabcefa47a5"><div class="ttname"><a href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">KS_EPI::read</a></div><div class="ttdeci">KS_READTRAP read</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1685</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ae3a267da7c3c7e4e6e523dafba9b7811ab36b1c8bcdbe924fc9d4a36cde9ba4dd"><div class="ttname"><a href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811ab36b1c8bcdbe924fc9d4a36cde9ba4dd">KS_EPI_POSBLIPS</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1741</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ab508ded41392ee86a2a619d3e93d2373"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">KS_TRAP::amp</a></div><div class="ttdeci">float amp</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:433</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a29cf05caf131eb2c5915a41b18af16d0"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">KS_PHASER::nover</a></div><div class="ttdeci">int nover</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1528</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a292f93e48d34cda511fcfb72a05558c2"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">KS_READ::filt</a></div><div class="ttdeci">FILTER_INFO filt</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:585</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_ac359c54a7c5f9e9a94105b3c0d0be9ea"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">KS_READTRAP::acq</a></div><div class="ttdeci">KS_READ acq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1423</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_TRAP::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:437</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a01275fda9ebd75eeb9e91d52d0063537"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a01275fda9ebd75eeb9e91d52d0063537">&#9670;&nbsp;</a></span>GEReq_predownload_setrecon_writekacq()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS GEReq_predownload_setrecon_writekacq </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a> *const&#160;</td>
          <td class="paramname"><em>readtrap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *const&#160;</td>
          <td class="paramname"><em>phaser</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *const&#160;</td>
          <td class="paramname"><em>zphaser</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Writes a kacq_yz.txt.***** file for use with GE's product ARC recon</h4>
</p>
<p>If phaser.R &gt; 1, a file is written to disk with phase encoding steps in an ARC accelerated scan ("kacq_yz.txt.*****"). This function has been adapted from GE's ARC.e, but supports only 2D (i.e. 1D-acceleration)</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">readtrap</td><td>Pointer to readout trapezoid. Used to determine k-space peak along kx </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">phaser</td><td>Pointer to phase encoding object (<a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a>) with acceleration </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">zphaser</td><td>Pointer to z phase encoding object (<a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a>) with acceleration. NULL for 2D </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;                                                                                                                                                 {</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;  FILE *fp;</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;  CHAR kacqFilename[BUFSIZ];</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="_g_e_required_8e.html#a1cb6f035a0e9565bbf12c3ef04c3c229">view</a>;</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;  <span class="keywordtype">int</span> arc_kx_peak_pos = 0; <span class="comment">/* sample point units */</span></div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;  <span class="keywordtype">int</span> arc_ky_peak_pos = -1;</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;  <span class="keyword">const</span> CHAR kacqArcFilename[BUFSIZ] = <span class="stringliteral">&quot;kacq_yz.txt&quot;</span>;</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;  <span class="keywordtype">int</span> num_echoes = 1; <span class="comment">/* we don&#39;t understand what a value &gt; 1 would mean. cf. ARC.e */</span></div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;  <span class="keywordtype">int</span> echo_index, slice;</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;  <span class="keywordtype">int</span> numzencodes = (zphaser != NULL) ? zphaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a> : 1;</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;#ifdef PSD_HW</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;  <span class="keyword">const</span> CHAR kacqPath[BUFSIZ] = <span class="stringliteral">&quot;/usr/g/psddata/&quot;</span>;</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;  <span class="keyword">const</span> CHAR kacqRawPath[BUFSIZ] = <span class="stringliteral">&quot;/usr/g/mrraw/&quot;</span>;</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;  sprintf(kacqFilename, <span class="stringliteral">&quot;%s%s.%d&quot;</span>, kacqPath, kacqArcFilename, <a class="code" href="_k_s_foundation__common_8c.html#a2e788c6338615164f241b755f219c961">rhkacq_uid</a>);</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;  <span class="keyword">const</span> CHAR kacqPath[BUFSIZ] = <span class="stringliteral">&quot;./&quot;</span>;</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;  <span class="keyword">const</span> CHAR kacqRawPath[BUFSIZ] = <span class="stringliteral">&quot;./&quot;</span>;</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;  sprintf(kacqFilename, <span class="stringliteral">&quot;%s%s&quot;</span>, kacqPath, kacqArcFilename);</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;  fp = fopen(kacqFilename, <span class="stringliteral">&quot;w&quot;</span>);</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;  <span class="comment">/* position of k-space center in sample points along kx</span></div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;<span class="comment">     time2center - acqdelay is the time in [us] from start of acq window to the center of k-space</span></div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;<span class="comment">     acq.filt.tsp is the time in [us] for one sample point (with or without ramp sampling */</span></div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;  arc_kx_peak_pos = (readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#aa29afe5800d6b5d4be29e1da24c63caf">time2center</a> - readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a13d3424b69abfaa66668757e06fed900">acqdelay</a>) / readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">filt</a>.tsp;</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;  <span class="comment">/* disabled flag ? */</span></div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;  arc_ky_peak_pos = -1;</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;  <span class="comment">/* kacq header */</span></div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;GE_KTACQ\t201\t0\n&quot;</span>);</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;num_sampling_patterns\t%d\n&quot;</span>, num_echoes);</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;num_mask_patterns\t%d\n&quot;</span>, 0);</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;kx_peak_pos\t%d\n&quot;</span>, arc_kx_peak_pos);</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;  <span class="comment">/* fprintf(fp, &quot;ky_peak_pos\t%d\n&quot;, arc_ky_peak_pos); */</span></div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;---\n&quot;</span>);</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;  <span class="comment">/* Reconstruction schedule */</span></div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;# Reconstruction schedule\n&quot;</span>);</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;# t, Echo, Cal Table, Cal Pass, Accel Table, Accel Pass, Mask Table\n&quot;</span>);</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;RECON_SCHEDULE\t%d\t%d\n&quot;</span>, num_echoes, 7);</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;---\n&quot;</span>);</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;  <span class="keywordflow">for</span> (echo_index = 0; echo_index &lt; num_echoes; echo_index++) {</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;    fprintf(fp,<span class="stringliteral">&quot;%d\t%d\t%d\t%d\t%d\t%d\t%d\n&quot;</span>, 0, echo_index, -1, 0, echo_index, 0, -1);</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;  }</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;  <span class="comment">/* Accelerated sampling pattern */</span></div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;<span class="keywordflow">for</span> (echo_index = 0; echo_index &lt; num_echoes; echo_index++) {</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;# Sampling Pattern 0 (Accel)\n&quot;</span>);</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;# View Offset, Pass Offset, ky, kz\n&quot;</span>);</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;SAMPLING_PATTERN\t%d\t%d\n&quot;</span>, phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a> * numzencodes, 4);</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;max_stride\t%d\t%d\n&quot;</span>, phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a>, (zphaser != NULL) ? zphaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a> : 1);</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;  <span class="keywordtype">int</span> dimy;</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;  <span class="keywordflow">if</span> (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a> != 0)</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;    dimy = phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a> / 2 + abs(phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a>); <span class="comment">/* half nex */</span></div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;    dimy = phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a>;</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;    fprintf(fp, <span class="stringliteral">&quot;pattern_dimensions\t%d\t%d\n&quot;</span>, dimy, (zphaser != NULL) ? exist(opslquant) : 1);</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;  fprintf(fp, <span class="stringliteral">&quot;---\n&quot;</span>);</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;    <span class="keywordflow">for</span> (slice = 0; slice &lt; numzencodes; slice++) {</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="_g_e_required_8e.html#a1cb6f035a0e9565bbf12c3ef04c3c229">view</a> = 0; <a class="code" href="_g_e_required_8e.html#a1cb6f035a0e9565bbf12c3ef04c3c229">view</a> &lt; phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a>; <a class="code" href="_g_e_required_8e.html#a1cb6f035a0e9565bbf12c3ef04c3c229">view</a>++) {</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;        <span class="keywordflow">if</span> (zphaser != NULL)</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;%d\t%d\t%d\t%d\n&quot;</span>, phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[<a class="code" href="_g_e_required_8e.html#a1cb6f035a0e9565bbf12c3ef04c3c229">view</a>] + 1 + (zphaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[<a class="code" href="_g_e_required_8e.html#a1cb6f035a0e9565bbf12c3ef04c3c229">view</a>] * num_echoes + echo_index) * rhdayres, 0, phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[<a class="code" href="_g_e_required_8e.html#a1cb6f035a0e9565bbf12c3ef04c3c229">view</a>], zphaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[slice]);</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;          fprintf(fp, <span class="stringliteral">&quot;%d\t%d\t%d\t%d\n&quot;</span>, phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[<a class="code" href="_g_e_required_8e.html#a1cb6f035a0e9565bbf12c3ef04c3c229">view</a>] + 1 + echo_index * rhdayres, 0, phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">linetoacq</a>[<a class="code" href="_g_e_required_8e.html#a1cb6f035a0e9565bbf12c3ef04c3c229">view</a>], 0);</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;  }</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;    }</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;  } <span class="comment">/* echo */</span></div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;  fclose(fp);</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;  <span class="comment">/* Automatically copy kacq file to a unique filename in</span></div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;<span class="comment">     /usr/g/mrraw if autolock is on */</span></div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;  <span class="keywordflow">if</span> (autolock == TRUE) {</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;    <span class="comment">/* Copy file by reading to and writing from a buffer */</span></div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;    CHAR kacqMrrawFilename[BUFSIZ];</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;    CHAR kacqRawFilename[BUFSIZ];</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;    FILE *srcFile = NULL;</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;    FILE *dstFile = NULL;</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;    <span class="keywordtype">size_t</span> elemRead, elemWritten;</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;    <span class="keywordtype">size_t</span> bufSz = 8192;</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;    <span class="keywordtype">char</span> buf[8192];</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;    sprintf(kacqRawFilename, <span class="stringliteral">&quot;%s.%d&quot;</span>, kacqArcFilename, <a class="code" href="_k_s_foundation__common_8c.html#a2e788c6338615164f241b755f219c961">rhkacq_uid</a>);</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;    sprintf(kacqMrrawFilename, <span class="stringliteral">&quot;%s%s&quot;</span>, kacqRawPath, kacqRawFilename);</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;    srcFile = fopen(kacqFilename, <span class="stringliteral">&quot;rb&quot;</span>);</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;    dstFile = fopen(kacqMrrawFilename, <span class="stringliteral">&quot;wb&quot;</span>);</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;    elemRead = bufSz;</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;    <span class="keywordflow">while</span> (elemRead == bufSz) {</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;      elemRead = fread(buf, <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>), bufSz, srcFile);</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;      elemWritten = fwrite(buf, <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>), elemRead, dstFile);</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;    }</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;    fclose(srcFile);</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;    fclose(dstFile);</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;  } <span class="comment">/* autolock */</span></div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;    <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;} <span class="comment">/* GEReq_predownload_setrecon_writekacq() */</span></div><div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a3d90133d3051fbc4816d02efd9566d8e"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">KS_PHASER::R</a></div><div class="ttdeci">int R</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1529</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">KS_PHASER::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1527</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a2e788c6338615164f241b755f219c961"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a2e788c6338615164f241b755f219c961">rhkacq_uid</a></div><div class="ttdeci">int rhkacq_uid</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a09b1a7dc77a7cf8c4e8421a23608a42a"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">KS_PHASER::numlinestoacq</a></div><div class="ttdeci">int numlinestoacq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1532</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a090fbced834ec878a08eadc4f829b8a3"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a090fbced834ec878a08eadc4f829b8a3">KS_PHASER::linetoacq</a></div><div class="ttdeci">int linetoacq[KS_MAX_PHASEDYN]</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1533</div></div>
<div class="ttc" id="_g_e_required_8e_html_a1cb6f035a0e9565bbf12c3ef04c3c229"><div class="ttname"><a href="_g_e_required_8e.html#a1cb6f035a0e9565bbf12c3ef04c3c229">view</a></div><div class="ttdeci">int view</div><div class="ttdef"><b>Definition:</b> GERequired.e:2630</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a29cf05caf131eb2c5915a41b18af16d0"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">KS_PHASER::nover</a></div><div class="ttdeci">int nover</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1528</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a292f93e48d34cda511fcfb72a05558c2"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">KS_READ::filt</a></div><div class="ttdeci">FILTER_INFO filt</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:585</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_ac359c54a7c5f9e9a94105b3c0d0be9ea"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">KS_READTRAP::acq</a></div><div class="ttdeci">KS_READ acq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1423</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_aa29afe5800d6b5d4be29e1da24c63caf"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#aa29afe5800d6b5d4be29e1da24c63caf">KS_READTRAP::time2center</a></div><div class="ttdeci">int time2center</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1434</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_a13d3424b69abfaa66668757e06fed900"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#a13d3424b69abfaa66668757e06fed900">KS_READTRAP::acqdelay</a></div><div class="ttdeci">int acqdelay</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1429</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a415c7a5c8bc0caae269486095207382a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a415c7a5c8bc0caae269486095207382a">&#9670;&nbsp;</a></span>GEReq_predownload_setrecon_accel()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS GEReq_predownload_setrecon_accel </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a> *const&#160;</td>
          <td class="paramname"><em>readtrap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *const&#160;</td>
          <td class="paramname"><em>phaser</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *const&#160;</td>
          <td class="paramname"><em>zphaser</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>datadestination</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets rh*** variables related to parallel imaging acceleration</h4>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">readtrap</td><td>Pointer to <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">phaser</td><td>Pointer to <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> (phase) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">zphaser</td><td>Pointer to <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> (slice). NULL for 2D </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">datadestination</td><td>Value to assign to <code>rhexecctrl</code> (c.f. epic.h)</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;                                                                                                                                                                  {</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;  STATUS status;</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;  <span class="comment">/* make sure we will be able to set all these CVs */</span></div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;  _rhasset.fixedflag = FALSE;</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;  _rhasset_R.fixedflag = FALSE;</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;  _rhhnover.fixedflag = FALSE;</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;  _rhnframes.fixedflag = FALSE;</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;  _rhdayres.fixedflag = FALSE;</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;  <span class="keywordflow">if</span> (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a> &lt;= 1 &amp;&amp; (zphaser == NULL || zphaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a> &lt;= 1)) {</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;    <a class="code" href="_k_s_foundation__tgt_8c.html#ad152641fe076fd7c466bf3eff5d0a13f">rhasset</a> = 0;</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;    rhasset_R = 1.0;</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;    rhassetsl_R = 1.0;</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;    <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;  }</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;  rhtype1 |= RHTYP1BAM0FILL; <span class="comment">/* once more, just in case */</span></div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;  <span class="keywordflow">if</span> (datadestination &amp; RHXC_XFER_IM) {</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;    <span class="comment">/* if we are going to use GE recon (RHXC_XFER_IM = 8) */</span></div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;    <span class="keywordflow">if</span> (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a4762b9a6307f0223b3d1dfde7e8ddce8">nacslines</a> &gt; 0) { <span class="comment">/* ARC */</span></div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;      <span class="comment">/* ARC uses full BAM, i.e. stores the acquired lines at their proper locations in k-space with zero lines in between */</span></div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;      rhhnover = abs(phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a>);</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;      rhnframes = phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a>; <span class="comment">/* # of acquired lines */</span></div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;      rhdayres = (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a> != 0) ? (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a>/2 + abs(phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a>) + 1) : (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a> + 1);</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;      <a class="code" href="_k_s_foundation__tgt_8c.html#ad152641fe076fd7c466bf3eff5d0a13f">rhasset</a> = ACCEL_ARC; <span class="comment">/* tell recon we are doing ARC only if we have ACS lines  */</span></div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;      status = <a class="code" href="_g_e_required_8e.html#a01275fda9ebd75eeb9e91d52d0063537">GEReq_predownload_setrecon_writekacq</a>(readtrap, phaser, zphaser);</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;      <span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;    } <span class="keywordflow">else</span> { <span class="comment">/* ASSET */</span></div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;      <span class="comment">/* ASSET uses compressed BAM, i.e. stores only the acquired lines */</span></div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;      rhhnover = abs(phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a>) / phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a>;</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;      rhnframes = (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a> != 0) ? (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a> / (2 * phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a>)) : (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a> / phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a>);</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;      rhdayres = rhnframes + rhhnover + 1;</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;      <a class="code" href="_k_s_foundation__tgt_8c.html#ad152641fe076fd7c466bf3eff5d0a13f">rhasset</a> = ASSET_SCAN; <span class="comment">/* if we don&#39;t have ACS lines, we will need to recon the data using some external calibration */</span></div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;    }</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;    <span class="comment">/* store data as ARC (full BAM) */</span></div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;    rhhnover = abs(phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a>);</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;    rhnframes = phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a>; <span class="comment">/* # of acquired lines */</span></div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;    rhdayres = (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a> != 0) ? (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a> / 2 + abs(phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a>) + 1) : (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a> + 1);</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;    <a class="code" href="_k_s_foundation__tgt_8c.html#ad152641fe076fd7c466bf3eff5d0a13f">rhasset</a> = 0; <span class="comment">/* we are going to do the reconstruction offline */</span></div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;  }</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;  rhasset_R = 1.0 / phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a>; <span class="comment">/* inverse of acceleration factor */</span></div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;  rhassetsl_R = (zphaser != NULL) ? (1.0 / zphaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a>) : 1;</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;} <span class="comment">/* GEReq_predownload_setrecon_accel() */</span></div><div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a3d90133d3051fbc4816d02efd9566d8e"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">KS_PHASER::R</a></div><div class="ttdeci">int R</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1529</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">KS_PHASER::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1527</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a4762b9a6307f0223b3d1dfde7e8ddce8"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a4762b9a6307f0223b3d1dfde7e8ddce8">KS_PHASER::nacslines</a></div><div class="ttdeci">int nacslines</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1530</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a09b1a7dc77a7cf8c4e8421a23608a42a"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">KS_PHASER::numlinestoacq</a></div><div class="ttdeci">int numlinestoacq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1532</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_ad152641fe076fd7c466bf3eff5d0a13f"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#ad152641fe076fd7c466bf3eff5d0a13f">rhasset</a></div><div class="ttdeci">int rhasset</div></div>
<div class="ttc" id="_g_e_required_8e_html_a01275fda9ebd75eeb9e91d52d0063537"><div class="ttname"><a href="_g_e_required_8e.html#a01275fda9ebd75eeb9e91d52d0063537">GEReq_predownload_setrecon_writekacq</a></div><div class="ttdeci">STATUS GEReq_predownload_setrecon_writekacq(const KS_READTRAP *const readtrap, const KS_PHASER *const phaser, const KS_PHASER *const zphaser)</div><div class="ttdoc">Writes a kacq_yz.txt.***** file for use with GE&amp;#39;s product ARC recon</div><div class="ttdef"><b>Definition:</b> GERequired.e:1357</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a29cf05caf131eb2c5915a41b18af16d0"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">KS_PHASER::nover</a></div><div class="ttdeci">int nover</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1528</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a720f294485e798eca7bfc87fc991e934"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a720f294485e798eca7bfc87fc991e934">&#9670;&nbsp;</a></span>GEReq_predownload_setrecon_phase()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GEReq_predownload_setrecon_phase </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *const&#160;</td>
          <td class="paramname"><em>phaser</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const float&#160;</td>
          <td class="paramname"><em>readfov</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>datadestination</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;                                                                                                                       {</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;  <span class="comment">/* make sure we will be able to set all these CVs */</span></div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;  _rhasset.fixedflag = FALSE;</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;  _rhasset_R.fixedflag = FALSE;</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;  _rhhnover.fixedflag = FALSE;</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;  _rhnframes.fixedflag = FALSE;</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;  _rhdayres.fixedflag = FALSE;</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;  <span class="keywordflow">if</span> (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a> != 0) { <span class="comment">/* partial Fourier ky */</span></div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;    rhnframes = phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a> / 2;</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;    rhtype |= RHTYPFRACTNEX;</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;    rhnframes = phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a>;</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;    rhtype &amp;= ~RHTYPFRACTNEX;</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;  }</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;  rhhnover = abs(phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a>);</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;  rhdayres = rhnframes + rhhnover + 1;</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;  rhexecctrl = datadestination;</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;  <span class="keywordflow">if</span> (op3dgradwarp &amp;&amp; !(rhexecctrl &amp; RHXC_XFER_IM)) {</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;    <span class="comment">/* 3D gradwarp requires at least one of the following bits set:</span></div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;<span class="comment">       #define RHXC_XFER_IM                    0x0008  8 (GE online recon)</span></div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;<span class="comment">       #define RHXC_SAVE_IM                    0x0010  16</span></div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;    (rhexecctrl) |= RHXC_SAVE_IM; <span class="comment">/* parentheses around rhexecctrl prevents EPIC preprocessor to add fixedflag check */</span></div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;  }</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;  rhphasescale = phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#abfd94a01fc71278021802ca0d1e25e16">fov</a> / readfov;</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;  <span class="keywordflow">if</span> (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a> &lt;= 1) {</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;    <a class="code" href="_k_s_foundation__tgt_8c.html#ad152641fe076fd7c466bf3eff5d0a13f">rhasset</a> = 0;</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;    rhasset_R = 1.0;</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;  }</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;  rhtype1 |= RHTYP1BAM0FILL; <span class="comment">/* once more, just in case */</span></div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;  <span class="keywordflow">if</span> (datadestination &amp; RHXC_XFER_IM) {</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;    <span class="comment">/* if we are going to use GE recon (RHXC_XFER_IM = 8) */</span></div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;    <span class="keywordflow">if</span> (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a4762b9a6307f0223b3d1dfde7e8ddce8">nacslines</a> &gt; 0) { <span class="comment">/* ARC */</span></div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;      <span class="comment">/* ARC uses full BAM, i.e. stores the acquired lines at their proper locations in k-space with zero lines in between */</span></div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;      rhhnover = abs(phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a>);</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;      rhnframes = phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a>; <span class="comment">/* # of acquired lines */</span></div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;      rhdayres = (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a> != 0) ? (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a>/2 + abs(phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a>) + 1) : (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a> + 1);</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;      <a class="code" href="_k_s_foundation__tgt_8c.html#ad152641fe076fd7c466bf3eff5d0a13f">rhasset</a> = ACCEL_ARC; <span class="comment">/* tell recon we are doing ARC only if we have ACS lines  */</span></div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;    } <span class="keywordflow">else</span> { <span class="comment">/* ASSET */</span></div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;      <span class="comment">/* ASSET uses compressed BAM, i.e. stores only the acquired lines */</span></div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;      rhhnover = abs(phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a>) / phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a>;</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;      rhnframes = (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a> != 0) ? (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a> / (2 * phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a>)) : (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a> / phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a>);</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;      rhdayres = rhnframes + rhhnover + 1;</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;      <a class="code" href="_k_s_foundation__tgt_8c.html#ad152641fe076fd7c466bf3eff5d0a13f">rhasset</a> = ASSET_SCAN; <span class="comment">/* if we don&#39;t have ACS lines, we will need to recon the data using some external calibration */</span></div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;    }</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;    <span class="comment">/* store data as ARC (full BAM) */</span></div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;    rhhnover = abs(phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a>);</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;    rhnframes = phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">numlinestoacq</a>; <span class="comment">/* # of acquired lines */</span></div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;    rhdayres = (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a> != 0) ? (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a> / 2 + abs(phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a>) + 1) : (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a> + 1);</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;    <a class="code" href="_k_s_foundation__tgt_8c.html#ad152641fe076fd7c466bf3eff5d0a13f">rhasset</a> = 0; <span class="comment">/* we are going to do the reconstruction offline */</span></div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;  }</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;  rhasset_R = 1.0 / phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a>; <span class="comment">/* inverse of acceleration factor */</span></div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;} <span class="comment">/* GEReq_predownload_setrecon_phase() */</span></div><div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a3d90133d3051fbc4816d02efd9566d8e"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">KS_PHASER::R</a></div><div class="ttdeci">int R</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1529</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">KS_PHASER::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1527</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a4762b9a6307f0223b3d1dfde7e8ddce8"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a4762b9a6307f0223b3d1dfde7e8ddce8">KS_PHASER::nacslines</a></div><div class="ttdeci">int nacslines</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1530</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a09b1a7dc77a7cf8c4e8421a23608a42a"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a09b1a7dc77a7cf8c4e8421a23608a42a">KS_PHASER::numlinestoacq</a></div><div class="ttdeci">int numlinestoacq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1532</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_ad152641fe076fd7c466bf3eff5d0a13f"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#ad152641fe076fd7c466bf3eff5d0a13f">rhasset</a></div><div class="ttdeci">int rhasset</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a29cf05caf131eb2c5915a41b18af16d0"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">KS_PHASER::nover</a></div><div class="ttdeci">int nover</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1528</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_abfd94a01fc71278021802ca0d1e25e16"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#abfd94a01fc71278021802ca0d1e25e16">KS_PHASER::fov</a></div><div class="ttdeci">float fov</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1526</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac6d58434e3655f7314ad160a5b8cfa09"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac6d58434e3655f7314ad160a5b8cfa09">&#9670;&nbsp;</a></span>GEReq_predownload_setrecon_readwave()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GEReq_predownload_setrecon_readwave </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_k_s___r_e_a_d_w_a_v_e.html">KS_READWAVE</a> *const&#160;</td>
          <td class="paramname"><em>readwave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>yres</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>imsize_policy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>datadestination</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;                                                                                                                                    {</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;  <span class="keywordtype">int</span> max_xy;</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;  <span class="comment">/* make sure we will be able to set all these CVs */</span></div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;  _rhfrsize.fixedflag = FALSE;</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;  _rhdaxres.fixedflag = FALSE;</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;  _rhvrgf.fixedflag = FALSE;</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;  _rhvrgfxres.fixedflag = FALSE;</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;</div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;  <span class="comment">/* raw data freq (x) size (works for both non-VRGF and VRGF) */</span></div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;  rhfrsize = readwave-&gt;<a class="code" href="struct_k_s___r_e_a_d_w_a_v_e.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">filt</a>.outputs;</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;  rhdaxres = readwave-&gt;<a class="code" href="struct_k_s___r_e_a_d_w_a_v_e.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">filt</a>.outputs;</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;  <span class="comment">/* ramp sampling */</span></div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;  rhvrgf = readwave-&gt;<a class="code" href="struct_k_s___r_e_a_d_w_a_v_e.html#a6a2cc013660b66a4c7793c6e55bfcaa8">rampsampling</a>;</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;  rhvrgfxres = readwave-&gt;<a class="code" href="struct_k_s___r_e_a_d_w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>;</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;  piforkvrgf = 0; <span class="comment">/* 1 causes scan to spawn the vrgf process upon download */</span></div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;  rhtype1 &amp;= ~(RHTYP1FVRGF + RHTYP1PCORVRGF);</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;  rhuser32 = 0.0;</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;  rhuser33 = 0.0;</div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;  rhuser34 = 0.0;</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;  rhuser35 = 0.0;</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;  </div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;  <span class="comment">/* image size */</span></div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;  max_xy = IMax(2, readwave-&gt;<a class="code" href="struct_k_s___r_e_a_d_w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>, yres);</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;  rhmethod = 1; <span class="comment">/* enable reduced image size, so we are in control */</span></div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;  <span class="keywordflow">if</span> (imsize_policy == <a class="code" href="_k_s_foundation_8h.html#ae418ab3d6fe87794cd978b12d10ed699ad8ee9fcfbd4ce48b046b2c6bd8557bb0">KS_IMSIZE_MIN256</a>) {</div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;    max_xy = (max_xy &gt; 256) ? 512 : 256; <span class="comment">/* final image size is either 512 or 256 */</span></div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (imsize_policy == <a class="code" href="_k_s_foundation_8h.html#ae418ab3d6fe87794cd978b12d10ed699a27dfe464db7e9579482065d43f0d9118">KS_IMSIZE_POW2</a>) {</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;    max_xy = <a class="code" href="_k_s_foundation_8h.html#ac43539de32839ff2bf2166f69c04e44d">ks_calc_nextpow2</a>((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) max_xy); <span class="comment">/* round up to nearest power of 2 if imsize_policy = KS_IMSIZE_POW2 */</span></div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;  }</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;  <span class="comment">/* recon image size with optional zerofilling */</span></div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;  <span class="keywordflow">if</span> (opzip512 &amp;&amp; max_xy &lt; 512) {</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;    max_xy = 512;</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (opzip1024 &amp;&amp; max_xy &lt; 1024) {</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;    max_xy = 1024;</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;  }</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;  rhimsize = max_xy;</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;  rhrcxres = rhimsize;</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;  rhrcyres = rhimsize;</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;  <span class="comment">/* freq. partial Fourier */</span></div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;  <span class="keywordflow">if</span> (abs(readwave-&gt;<a class="code" href="struct_k_s___r_e_a_d_w_a_v_e.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a>) &gt; 0) {</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;    <span class="comment">/* fractional echo (partial Fourier kx) */</span></div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;    pitfeextra = rhfrsize * abs(readwave-&gt;<a class="code" href="struct_k_s___r_e_a_d_w_a_v_e.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a>) / (float)(readwave-&gt;<a class="code" href="struct_k_s___r_e_a_d_w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">res</a>/2 + abs(readwave-&gt;<a class="code" href="struct_k_s___r_e_a_d_w_a_v_e.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a>));</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;    pitfeextra = 0;</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;  }</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;  rhfeextra = pitfeextra;</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;  rhheover = readwave-&gt;<a class="code" href="struct_k_s___r_e_a_d_w_a_v_e.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a>;</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;  <span class="comment">/* chopping control */</span></div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;  rhtype |= RHTYPCHP; <span class="comment">/* ( |= 1) no chopping processing needed in recon */</span></div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;</div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;  <span class="comment">/* 3D recon flag */</span></div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;  <span class="keywordflow">if</span>(opimode == PSD_3D || opimode == PSD_3DM)</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;    rhtype |= RHTYP3D;</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;    rhtype &amp;= ~RHTYP3D;</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;} <span class="comment">/* GEReq_predownload_setrecon_readwave() */</span></div><div class="ttc" id="struct_k_s___r_e_a_d_w_a_v_e_html_a6a2cc013660b66a4c7793c6e55bfcaa8"><div class="ttname"><a href="struct_k_s___r_e_a_d_w_a_v_e.html#a6a2cc013660b66a4c7793c6e55bfcaa8">KS_READWAVE::rampsampling</a></div><div class="ttdeci">int rampsampling</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1450</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ae418ab3d6fe87794cd978b12d10ed699a27dfe464db7e9579482065d43f0d9118"><div class="ttname"><a href="_k_s_foundation_8h.html#ae418ab3d6fe87794cd978b12d10ed699a27dfe464db7e9579482065d43f0d9118">KS_IMSIZE_POW2</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1745</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ae418ab3d6fe87794cd978b12d10ed699ad8ee9fcfbd4ce48b046b2c6bd8557bb0"><div class="ttname"><a href="_k_s_foundation_8h.html#ae418ab3d6fe87794cd978b12d10ed699ad8ee9fcfbd4ce48b046b2c6bd8557bb0">KS_IMSIZE_MIN256</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1745</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a292f93e48d34cda511fcfb72a05558c2"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">KS_READ::filt</a></div><div class="ttdeci">FILTER_INFO filt</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:585</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ac43539de32839ff2bf2166f69c04e44d"><div class="ttname"><a href="_k_s_foundation_8h.html#ac43539de32839ff2bf2166f69c04e44d">ks_calc_nextpow2</a></div><div class="ttdeci">unsigned int ks_calc_nextpow2(unsigned int x)</div><div class="ttdoc">Gives the next higher 2^N for a given number</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3329</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_w_a_v_e_html_ac359c54a7c5f9e9a94105b3c0d0be9ea"><div class="ttname"><a href="struct_k_s___r_e_a_d_w_a_v_e.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">KS_READWAVE::acq</a></div><div class="ttdeci">KS_READ acq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1444</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_w_a_v_e_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___r_e_a_d_w_a_v_e.html#aac31eb68bff694554a182bd796b2f1c5">KS_READWAVE::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1449</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_w_a_v_e_html_a29cf05caf131eb2c5915a41b18af16d0"><div class="ttname"><a href="struct_k_s___r_e_a_d_w_a_v_e.html#a29cf05caf131eb2c5915a41b18af16d0">KS_READWAVE::nover</a></div><div class="ttdeci">int nover</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1451</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6d51efff591f87dbcc7887e45c16db0f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6d51efff591f87dbcc7887e45c16db0f">&#9670;&nbsp;</a></span>GEReq_predownload_setrecon_readphase()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GEReq_predownload_setrecon_readphase </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a> *const&#160;</td>
          <td class="paramname"><em>readtrap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *const&#160;</td>
          <td class="paramname"><em>phaser</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_k_s___p_h_a_s_e_r.html">KS_PHASER</a> *const&#160;</td>
          <td class="paramname"><em>zphaser</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>imsize_policy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>datadestination</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets required global rh*** variables for Cartsian imaging</h4>
</p>
<p>For Cartesian pulse sequences, using one <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> and one <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> (each of which may have multiple instances), the required rh*** variables are set based on the content of the sequence objects <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> (arg 1) and <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> (arg 2). The fields in each sequence object, including e.g. partial Fourier and rampsampling, controls the setting of GE's rh*** variables. In addition, the third argument specifies the desired upsampling policy for small matrix sizes.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">readtrap</td><td>Pointer to <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">phaser</td><td>Pointer to <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">zphaser</td><td>Pointer to <a class="el" href="struct_k_s___p_h_a_s_e_r.html" title="Composite sequence object for phase encoding using a trapezoid gradient">KS_PHASER</a> (slice). NULL for 2D </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">imsize_policy</td><td>Choose between <code>KS_IMSIZE_NATIVE</code>, <code>KS_IMSIZE_POW2</code>, <code>KS_IMSIZE_MIN256</code> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">datadestination</td><td>Value for the rhexecctrl variable. Bitmasks for: KS_SAVEPFILES (dump Pfiles) and KS_GERECON (product recon) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;                                                                                                                                                                                       {</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;  <span class="keywordtype">int</span> max_xy;</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;  <span class="comment">/* make sure we will be able to set all these CVs */</span></div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;  _rhfrsize.fixedflag = FALSE;</div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;  _rhdaxres.fixedflag = FALSE;</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;  _rhdayres.fixedflag = FALSE;</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;  _rhnframes.fixedflag = FALSE;</div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;  _rhhnover.fixedflag = FALSE;</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;  _rhvrgf.fixedflag = FALSE;</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;  _rhvrgfxres.fixedflag = FALSE;</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;  _rhasset.fixedflag = FALSE;</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;  _rhasset_R.fixedflag = FALSE;</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;  <span class="comment">/* raw data freq (x) size (works for both non-VRGF and VRGF) */</span></div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;  rhfrsize = readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">filt</a>.outputs;</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;  rhdaxres = readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">filt</a>.outputs;</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;  <span class="comment">/* ramp sampling */</span></div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;  rhvrgf = readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a6a2cc013660b66a4c7793c6e55bfcaa8">rampsampling</a>;</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;  rhvrgfxres = readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#aac31eb68bff694554a182bd796b2f1c5">res</a>;</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;</div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;  <span class="keywordflow">if</span> (readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a6a2cc013660b66a4c7793c6e55bfcaa8">rampsampling</a>) {</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;    piforkvrgf = 1; <span class="comment">/* 1 causes scan to spawn the vrgf process upon download */</span></div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;    rhtype1 |= (RHTYP1FVRGF + RHTYP1PCORVRGF); <span class="comment">/* VRGF and VRGFafterPC */</span></div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;    <span class="comment">/* write vrgf.param */</span></div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;    <a class="code" href="_g_e_required_8e.html#a7ea1ad4e9625baa434eecb32fc2f2563">GEReq_predownload_genVRGF</a>(readtrap);</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;</div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;    <span class="comment">/* VRGF (rampsampling): Store shape of the read lobe to determine the k-space travel along kx (freq. dir.) for offline VRGF correction */</span></div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;    rhuser32 = readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">filt</a>.tsp; <span class="comment">/* time between sample points [often 2us] */</span></div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;    rhuser33 = readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">amp</a>; <span class="comment">/* Readout gradient amplitude */</span></div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;    rhuser34 = (float) (readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">plateautime</a> / 2) / 1.0e6; <span class="comment">/* half plateau time */</span></div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;    rhuser35 = (float) (readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">ramptime</a>) / 1.0e6; <span class="comment">/* attack/decay time */</span></div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;    piforkvrgf = 0; <span class="comment">/* 1 causes scan to spawn the vrgf process upon download */</span></div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;    rhtype1 &amp;= ~(RHTYP1FVRGF + RHTYP1PCORVRGF);</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;    rhuser32 = 0.0;</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;    rhuser33 = 0.0;</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;    rhuser34 = 0.0;</div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;    rhuser35 = 0.0;</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;  }</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;  <span class="comment">/* image size */</span></div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;  <span class="keywordflow">if</span> (phaser != NULL) {</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;    max_xy = IMax(2, readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#aac31eb68bff694554a182bd796b2f1c5">res</a>, phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a>);</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;    max_xy = readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#aac31eb68bff694554a182bd796b2f1c5">res</a>;</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;  }</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;  rhmethod = 1; <span class="comment">/* enable reduced image size, so we are in control */</span></div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;  <span class="keywordflow">if</span> (imsize_policy == <a class="code" href="_k_s_foundation_8h.html#ae418ab3d6fe87794cd978b12d10ed699ad8ee9fcfbd4ce48b046b2c6bd8557bb0">KS_IMSIZE_MIN256</a>) {</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;    max_xy = (max_xy &gt; 256) ? 512 : 256; <span class="comment">/* final image size is either 512 or 256 */</span></div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (imsize_policy == <a class="code" href="_k_s_foundation_8h.html#ae418ab3d6fe87794cd978b12d10ed699a27dfe464db7e9579482065d43f0d9118">KS_IMSIZE_POW2</a>) {</div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;    max_xy = <a class="code" href="_k_s_foundation_8h.html#ac43539de32839ff2bf2166f69c04e44d">ks_calc_nextpow2</a>((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) max_xy); <span class="comment">/* round up to nearest power of 2 if imsize_policy = KS_IMSIZE_POW2 */</span></div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;  }</div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;  <span class="comment">/* recon image size with optional zerofilling */</span></div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;  <span class="keywordflow">if</span> (opzip512 &amp;&amp; max_xy &lt; 512) {</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;    max_xy = 512;</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (opzip1024 &amp;&amp; max_xy &lt; 1024) {</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;    max_xy = 1024;</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;  }</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;  rhimsize = max_xy;</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;  rhrcxres = rhimsize;</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;  rhrcyres = rhimsize;</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;  <span class="comment">/* freq. partial Fourier */</span></div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;  <span class="keywordflow">if</span> (abs(readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a>) &gt; 0) {</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;    <span class="comment">/* fractional echo (partial Fourier kx) */</span></div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;    pitfeextra = rhfrsize - readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#aac31eb68bff694554a182bd796b2f1c5">res</a> / 2;</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;    pitfeextra = 0;</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;  }</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;  rhfeextra = pitfeextra;</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;  <span class="comment">/* chopping control */</span></div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;  rhtype |= RHTYPCHP; <span class="comment">/* ( |= 1) no chopping processing needed in recon */</span></div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;</div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;  <span class="comment">/* 3D recon flag */</span></div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_k_s_foundation_8h.html#a969816ef84367f11542f3473473260dc">KS_3D_SELECTED</a>)</div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;    rhtype |= RHTYP3D;</div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;    rhtype &amp;= ~RHTYP3D;</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;</div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;  <span class="comment">/* phase encoding (see also GEReq_predownload_setrecon_accel(), which may override these values) */</span></div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;  <span class="keywordflow">if</span> (phaser != NULL) {</div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;    <span class="keywordflow">if</span> (phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a> != 0) { <span class="comment">/* partial Fourier ky */</span></div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;      rhnframes = phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a> / 2;</div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;      rhtype |= RHTYPFRACTNEX;</div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;      rhnframes = phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">res</a>;</div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;      rhtype &amp;= ~RHTYPFRACTNEX;</div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;    }</div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;</div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;    rhhnover = abs(phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a>);</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;    rhdayres = rhnframes + rhhnover + 1;</div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;</div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;    rhexecctrl = datadestination;</div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;    <span class="keywordflow">if</span> (op3dgradwarp &amp;&amp; !(rhexecctrl &amp; RHXC_XFER_IM)) {</div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;      <span class="comment">/* 3D gradwarp requires at least one of the following bits set:</span></div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;<span class="comment">         #define RHXC_XFER_IM                    0x0008  8 (GE online recon)</span></div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;<span class="comment">         #define RHXC_SAVE_IM                    0x0010  16</span></div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;<span class="comment">      */</span></div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;      (rhexecctrl) |= RHXC_SAVE_IM; <span class="comment">/* parentheses around rhexecctrl prevents EPIC preprocessor to add fixedflag check */</span></div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;    }</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;<span class="preprocessor">#if EPIC_RELEASE &gt;= 26</span></div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;    <span class="keywordflow">if</span> (datadestination &amp; RHXC_XFER_IM) {</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;      rhdacqctrl &amp;= ~8192; <span class="comment">/* enable GE&#39;s Orchestra Live recon */</span></div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;      rhdacqctrl |= 8192; <span class="comment">/* disable GE&#39;s Orchestra Live recon */</span></div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;    }</div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;</div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;    <span class="comment">/* Set up ARC/ASSET flags if R &gt; 1 otherwise shut them off */</span></div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;    <a class="code" href="_g_e_required_8e.html#a415c7a5c8bc0caae269486095207382a">GEReq_predownload_setrecon_accel</a>(readtrap, phaser, zphaser, datadestination);</div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;</div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;    rhphasescale = phaser-&gt;<a class="code" href="struct_k_s___p_h_a_s_e_r.html#abfd94a01fc71278021802ca0d1e25e16">fov</a> / readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#abfd94a01fc71278021802ca0d1e25e16">fov</a>;</div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;</div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;  } <span class="comment">/* phaser != NULL */</span></div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;</div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;} <span class="comment">/* GEReq_predownload_setrecon_readphase() */</span></div><div class="ttc" id="struct_k_s___t_r_a_p_html_a878bb367b07dc7dfb5fef5728d2e5b1d"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#a878bb367b07dc7dfb5fef5728d2e5b1d">KS_TRAP::plateautime</a></div><div class="ttdeci">int plateautime</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:436</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#aac31eb68bff694554a182bd796b2f1c5">KS_PHASER::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1527</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ae418ab3d6fe87794cd978b12d10ed699a27dfe464db7e9579482065d43f0d9118"><div class="ttname"><a href="_k_s_foundation_8h.html#ae418ab3d6fe87794cd978b12d10ed699a27dfe464db7e9579482065d43f0d9118">KS_IMSIZE_POW2</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1745</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_abfd94a01fc71278021802ca0d1e25e16"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#abfd94a01fc71278021802ca0d1e25e16">KS_READTRAP::fov</a></div><div class="ttdeci">float fov</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1425</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ae418ab3d6fe87794cd978b12d10ed699ad8ee9fcfbd4ce48b046b2c6bd8557bb0"><div class="ttname"><a href="_k_s_foundation_8h.html#ae418ab3d6fe87794cd978b12d10ed699ad8ee9fcfbd4ce48b046b2c6bd8557bb0">KS_IMSIZE_MIN256</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1745</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a969816ef84367f11542f3473473260dc"><div class="ttname"><a href="_k_s_foundation_8h.html#a969816ef84367f11542f3473473260dc">KS_3D_SELECTED</a></div><div class="ttdeci">#define KS_3D_SELECTED</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:104</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">KS_READTRAP::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1435</div></div>
<div class="ttc" id="_g_e_required_8e_html_a7ea1ad4e9625baa434eecb32fc2f2563"><div class="ttname"><a href="_g_e_required_8e.html#a7ea1ad4e9625baa434eecb32fc2f2563">GEReq_predownload_genVRGF</a></div><div class="ttdeci">STATUS GEReq_predownload_genVRGF(const KS_READTRAP *const readtrap)</div><div class="ttdoc">Generates the vrgf.param file for rampsampling correction</div><div class="ttdef"><b>Definition:</b> GERequired.e:1186</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_aac31eb68bff694554a182bd796b2f1c5"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#aac31eb68bff694554a182bd796b2f1c5">KS_READTRAP::res</a></div><div class="ttdeci">int res</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1426</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ab508ded41392ee86a2a619d3e93d2373"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ab508ded41392ee86a2a619d3e93d2373">KS_TRAP::amp</a></div><div class="ttdeci">float amp</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:433</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a29cf05caf131eb2c5915a41b18af16d0"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">KS_PHASER::nover</a></div><div class="ttdeci">int nover</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1528</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a292f93e48d34cda511fcfb72a05558c2"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">KS_READ::filt</a></div><div class="ttdeci">FILTER_INFO filt</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:585</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ac43539de32839ff2bf2166f69c04e44d"><div class="ttname"><a href="_k_s_foundation_8h.html#ac43539de32839ff2bf2166f69c04e44d">ks_calc_nextpow2</a></div><div class="ttdeci">unsigned int ks_calc_nextpow2(unsigned int x)</div><div class="ttdoc">Gives the next higher 2^N for a given number</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3329</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_a29cf05caf131eb2c5915a41b18af16d0"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#a29cf05caf131eb2c5915a41b18af16d0">KS_READTRAP::nover</a></div><div class="ttdeci">int nover</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1428</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_a6a2cc013660b66a4c7793c6e55bfcaa8"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#a6a2cc013660b66a4c7793c6e55bfcaa8">KS_READTRAP::rampsampling</a></div><div class="ttdeci">int rampsampling</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1427</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_ac359c54a7c5f9e9a94105b3c0d0be9ea"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">KS_READTRAP::acq</a></div><div class="ttdeci">KS_READ acq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1423</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_abfd94a01fc71278021802ca0d1e25e16"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#abfd94a01fc71278021802ca0d1e25e16">KS_PHASER::fov</a></div><div class="ttdeci">float fov</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1526</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_acbc719dc4e48c2a2df0447875e4348ca"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#acbc719dc4e48c2a2df0447875e4348ca">KS_TRAP::ramptime</a></div><div class="ttdeci">int ramptime</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:435</div></div>
<div class="ttc" id="_g_e_required_8e_html_a415c7a5c8bc0caae269486095207382a"><div class="ttname"><a href="_g_e_required_8e.html#a415c7a5c8bc0caae269486095207382a">GEReq_predownload_setrecon_accel</a></div><div class="ttdeci">STATUS GEReq_predownload_setrecon_accel(const KS_READTRAP *const readtrap, const KS_PHASER *const phaser, const KS_PHASER *const zphaser, int datadestination)</div><div class="ttdoc">Sets rh*** variables related to parallel imaging acceleration</div><div class="ttdef"><b>Definition:</b> GERequired.e:1480</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac4df6187ca227e0004dc46436145f057"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac4df6187ca227e0004dc46436145f057">&#9670;&nbsp;</a></span>GEReq_predownload_setrecon_annotations()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GEReq_predownload_setrecon_annotations </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>tsp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>readdur</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>time2center</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>echogap</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets ih*** variables for TE and rBW annotation</h4>
</p>
<p>Uses the global UI CVs <code>opnecho</code>, <code>opnex</code>, <code>opte</code> and <code>opte2</code></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">tsp</td><td>Dwell time in [us], i.e. the duration of one sample (which is also 1/rBW) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">readdur</td><td>Duration in [us] of the readout window </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">time2center</td><td>Time in [us] to the center of the echo </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">echogap</td><td>Gap between two echoes </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;                                                                                                {</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;  <span class="keywordtype">int</span> duration1, duration2;</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;  <span class="keywordtype">int</span> echo_timeoffset2evenecho, echo_timeoffset2oddecho;</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;  <span class="keywordtype">int</span> roundinglimit = 40ms;</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;  <span class="comment">/* rBW annotation */</span></div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;  ihvbw1 = 1.0e3 / (tsp * 2.0);</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;  ihvbw2 = ihvbw1;</div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;  ihvbw3 = ihvbw1;</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;  ihvbw4 = ihvbw1;</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;  ihvbw5 = ihvbw1;</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;  ihvbw6 = ihvbw1;</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;  ihvbw7 = ihvbw1;</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;  ihvbw8 = ihvbw1;</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;  ihvbw9 = ihvbw1;</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;  ihvbw10 = ihvbw1;</div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;  ihvbw11 = ihvbw1;</div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;  ihvbw12 = ihvbw1;</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;  ihvbw13 = ihvbw1;</div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;  ihvbw14 = ihvbw1;</div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;  ihvbw15 = ihvbw1;</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;  ihvbw16 = ihvbw1;</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;  <span class="comment">/* NEX annotation */</span></div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;  ihnex = opnex;</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;</div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;  <span class="comment">/* TE */</span></div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;  ihte1 = (opte &gt; roundinglimit) ? <a class="code" href="_k_s_foundation_8h.html#a0b690996b2c3e240bfa03e435feb4bc9">ks_calc_roundupms</a>(opte) : opte;</div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;</div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;  duration1 = (readdur - time2center) * 2 + echogap; <span class="comment">/* 2x (time from k-space center to edge for 1st echo) + additional echo gap */</span></div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;  duration2 = time2center * 2 + echogap; <span class="comment">/* 2x (time from start to k-space center for 1st echo) + additional echo gap */</span></div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;</div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;  <span class="keywordflow">if</span> ((eeff == 1 &amp;&amp; oeff == 0) || (eeff == 0 &amp;&amp; oeff == 1) || (acq_type == TYPSPIN)) { <span class="comment">/* alternating readout gradient polarity across echoes (like often in GRE), or SpinEcho */</span></div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;    echo_timeoffset2evenecho = duration1; <span class="comment">/* between 1 and 2, 3 and 4 etc. */</span></div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;    echo_timeoffset2oddecho  = duration2; <span class="comment">/* between 2 and 3, 4 and 5 etc. */</span></div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;  } <span class="keywordflow">else</span> { <span class="comment">/* same readout gradient polarity across echoes */</span></div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;    <span class="comment">/* we have a GRE sequence, and there are likely flyback gradients</span></div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;<span class="comment">       between each readout to allow for the readout gradient polarity to have the same sign for all echoes */</span></div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;    echo_timeoffset2evenecho = readdur + echogap; <span class="comment">/* between 1 and 2, 3 and 4 etc. */</span></div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;    echo_timeoffset2oddecho  = readdur + echogap; <span class="comment">/* between 2 and 3, 4 and 5 etc. */</span></div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;  }</div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;  <span class="keywordflow">if</span> (opnecho == 2) {</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;    <span class="keywordflow">if</span> (pite2nub &amp;&amp; existcv(opte2) &amp;&amp; opte2 &gt; 0) { <span class="comment">/* use opte2 if the button is visible and it was selected */</span></div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;      ihte2 = opte2;</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;      <span class="comment">/* partial Fourier note: 2nd readout will have its relative k-space center mirrored */</span></div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;      ihte2 = opte + echo_timeoffset2evenecho;</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;    }</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (opnecho &gt; 2) {</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;    <span class="keywordtype">int</span> pos = opte + echo_timeoffset2evenecho;</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;    ihte2 =  (pos &gt; roundinglimit) ? <a class="code" href="_k_s_foundation_8h.html#a0b690996b2c3e240bfa03e435feb4bc9">ks_calc_roundupms</a>(pos) : pos; pos += echo_timeoffset2oddecho;</div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;    ihte3 =  (pos &gt; roundinglimit) ? <a class="code" href="_k_s_foundation_8h.html#a0b690996b2c3e240bfa03e435feb4bc9">ks_calc_roundupms</a>(pos) : pos; pos += echo_timeoffset2oddecho;</div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;    ihte4 =  (pos &gt; roundinglimit) ? <a class="code" href="_k_s_foundation_8h.html#a0b690996b2c3e240bfa03e435feb4bc9">ks_calc_roundupms</a>(pos) : pos; pos += echo_timeoffset2oddecho;</div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;    ihte5 =  (pos &gt; roundinglimit) ? <a class="code" href="_k_s_foundation_8h.html#a0b690996b2c3e240bfa03e435feb4bc9">ks_calc_roundupms</a>(pos) : pos; pos += echo_timeoffset2oddecho;</div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;    ihte6 =  (pos &gt; roundinglimit) ? <a class="code" href="_k_s_foundation_8h.html#a0b690996b2c3e240bfa03e435feb4bc9">ks_calc_roundupms</a>(pos) : pos; pos += echo_timeoffset2oddecho;</div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;    ihte7 =  (pos &gt; roundinglimit) ? <a class="code" href="_k_s_foundation_8h.html#a0b690996b2c3e240bfa03e435feb4bc9">ks_calc_roundupms</a>(pos) : pos; pos += echo_timeoffset2oddecho;</div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;    ihte8 =  (pos &gt; roundinglimit) ? <a class="code" href="_k_s_foundation_8h.html#a0b690996b2c3e240bfa03e435feb4bc9">ks_calc_roundupms</a>(pos) : pos; pos += echo_timeoffset2oddecho;</div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;    ihte9 =  (pos &gt; roundinglimit) ? <a class="code" href="_k_s_foundation_8h.html#a0b690996b2c3e240bfa03e435feb4bc9">ks_calc_roundupms</a>(pos) : pos; pos += echo_timeoffset2oddecho;</div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;    ihte10 = (pos &gt; roundinglimit) ? <a class="code" href="_k_s_foundation_8h.html#a0b690996b2c3e240bfa03e435feb4bc9">ks_calc_roundupms</a>(pos) : pos; pos += echo_timeoffset2oddecho;</div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;    ihte11 = (pos &gt; roundinglimit) ? <a class="code" href="_k_s_foundation_8h.html#a0b690996b2c3e240bfa03e435feb4bc9">ks_calc_roundupms</a>(pos) : pos; pos += echo_timeoffset2oddecho;</div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;    ihte12 = (pos &gt; roundinglimit) ? <a class="code" href="_k_s_foundation_8h.html#a0b690996b2c3e240bfa03e435feb4bc9">ks_calc_roundupms</a>(pos) : pos; pos += echo_timeoffset2oddecho;</div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;    ihte13 = (pos &gt; roundinglimit) ? <a class="code" href="_k_s_foundation_8h.html#a0b690996b2c3e240bfa03e435feb4bc9">ks_calc_roundupms</a>(pos) : pos; pos += echo_timeoffset2oddecho;</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;    ihte14 = (pos &gt; roundinglimit) ? <a class="code" href="_k_s_foundation_8h.html#a0b690996b2c3e240bfa03e435feb4bc9">ks_calc_roundupms</a>(pos) : pos; pos += echo_timeoffset2oddecho;</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;    ihte15 = (pos &gt; roundinglimit) ? <a class="code" href="_k_s_foundation_8h.html#a0b690996b2c3e240bfa03e435feb4bc9">ks_calc_roundupms</a>(pos) : pos; pos += echo_timeoffset2oddecho;</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;    ihte16 = (pos &gt; roundinglimit) ? <a class="code" href="_k_s_foundation_8h.html#a0b690996b2c3e240bfa03e435feb4bc9">ks_calc_roundupms</a>(pos) : pos;</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;  }</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;  <span class="comment">/* rhte/rhte2 end up in the raw section of the rawdata header (rdb_hdr_te, rdb_hdr_te2)</span></div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;<span class="comment">     while opte/opte in the image section (te,te2). For opnecho &gt; 2, the te2 field is sometimes 0, why</span></div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;<span class="comment">     we also need to rely on rdb_hdr_te2 for offline reconstruction */</span></div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;  rhte = ihte1;</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;  rhte2 = ihte2;</div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;</div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;  <span class="comment">/* Flip Angle */</span></div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;  ihflip = opflip;</div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;</div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;} <span class="comment">/* GEReq_predownload_setrecon_annotations() */</span></div><div class="ttc" id="_k_s_foundation_8h_html_a0b690996b2c3e240bfa03e435feb4bc9"><div class="ttname"><a href="_k_s_foundation_8h.html#a0b690996b2c3e240bfa03e435feb4bc9">ks_calc_roundupms</a></div><div class="ttdeci">int ks_calc_roundupms(int time)</div><div class="ttdoc">Rounds up a value in [us] to nearest whole [ms]</div><div class="ttdef"><b>Definition:</b> KSFoundation_host.c:3341</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a99f608a4921aa9ad1baa47af182f1a66"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a99f608a4921aa9ad1baa47af182f1a66">&#9670;&nbsp;</a></span>GEReq_predownload_setrecon_annotations_readtrap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GEReq_predownload_setrecon_annotations_readtrap </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html">KS_READTRAP</a> *&#160;</td>
          <td class="paramname"><em>readtrap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>echogap</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets ih*** variables for TE and rBW annotation based on a <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a></h4>
</p>
<p>This is a wrapper function to <a class="el" href="_g_e_required_8e.html#ac4df6187ca227e0004dc46436145f057" title="Sets ih*** variables for TE and rBW annotation">GEReq_predownload_setrecon_annotations()</a> using a <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">readtrap</td><td>Pointer to <a class="el" href="struct_k_s___r_e_a_d_t_r_a_p.html" title="Composite sequence object for data readout using a trapezoid gradient">KS_READTRAP</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">echogap</td><td>Gap between two echoes </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;                                                                                         {</div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;</div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;  <a class="code" href="_g_e_required_8e.html#ac4df6187ca227e0004dc46436145f057">GEReq_predownload_setrecon_annotations</a>(readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">filt</a>.tsp, readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>, readtrap-&gt;<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#aa29afe5800d6b5d4be29e1da24c63caf">time2center</a>, echogap);</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;} <span class="comment">/* GEReq_predownload_setrecon_annotations_readtrap() */</span></div><div class="ttc" id="_g_e_required_8e_html_ac4df6187ca227e0004dc46436145f057"><div class="ttname"><a href="_g_e_required_8e.html#ac4df6187ca227e0004dc46436145f057">GEReq_predownload_setrecon_annotations</a></div><div class="ttdeci">void GEReq_predownload_setrecon_annotations(int tsp, int readdur, int time2center, int echogap)</div><div class="ttdoc">Sets ih*** variables for TE and rBW annotation</div><div class="ttdef"><b>Definition:</b> GERequired.e:1833</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">KS_READTRAP::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1435</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a292f93e48d34cda511fcfb72a05558c2"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">KS_READ::filt</a></div><div class="ttdeci">FILTER_INFO filt</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:585</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_ac359c54a7c5f9e9a94105b3c0d0be9ea"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">KS_READTRAP::acq</a></div><div class="ttdeci">KS_READ acq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1423</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_TRAP::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:437</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_aa29afe5800d6b5d4be29e1da24c63caf"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#aa29afe5800d6b5d4be29e1da24c63caf">KS_READTRAP::time2center</a></div><div class="ttdeci">int time2center</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1434</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a64c7c04147ac9eef0043d6d76fc0f8f6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a64c7c04147ac9eef0043d6d76fc0f8f6">&#9670;&nbsp;</a></span>GEReq_predownload_setrecon_annotations_epi()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GEReq_predownload_setrecon_annotations_epi </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *&#160;</td>
          <td class="paramname"><em>epi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>echogap</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets ih*** variables for TE and rBW annotation based on a <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a></h4>
</p>
<p>This is a wrapper function to <a class="el" href="_g_e_required_8e.html#ac4df6187ca227e0004dc46436145f057" title="Sets ih*** variables for TE and rBW annotation">GEReq_predownload_setrecon_annotations()</a> using a <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">epi</td><td>Pointer to <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">echogap</td><td>Gap between two EPI trains </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;                                                                          {</div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;  <span class="keywordtype">int</span> maxtime_dephasers = IMax(2, epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#abc81c5867684b6e31b65459ec9431269">readphaser</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>, epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>);</div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;  <span class="keywordtype">int</span> maxtime_rephasers = IMax(2, epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#abc81c5867684b6e31b65459ec9431269">readphaser</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>, epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>);</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;  <span class="keywordtype">int</span> halfkspace_duration = ((epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> + epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a035bb76f8cc944eff7afd9333c2688e3">read_spacing</a>) * epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a> / 2) - epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a035bb76f8cc944eff7afd9333c2688e3">read_spacing</a> / 2;</div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;  <span class="comment">/* time for extra lines beyond half-kspace for partial Fourier in ky */</span></div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;  <span class="keywordtype">int</span> overscan_duration = ((epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a> + epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a035bb76f8cc944eff7afd9333c2688e3">read_spacing</a>) * (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">nover</a> / epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a>)) - epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a035bb76f8cc944eff7afd9333c2688e3">read_spacing</a> / 2;</div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;  <span class="keywordtype">int</span> epiduration, time2center;</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;</div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;  if (opautote == PSD_MINTE) {</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;    epiduration = (maxtime_dephasers + overscan_duration + halfkspace_duration + maxtime_rephasers);</div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;    time2center = maxtime_dephasers + overscan_duration;</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;    epiduration = (maxtime_dephasers + 2 * halfkspace_duration + maxtime_rephasers);</div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;    time2center = maxtime_dephasers + halfkspace_duration;</div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;  }</div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;  <a class="code" href="_g_e_required_8e.html#ac4df6187ca227e0004dc46436145f057">GEReq_predownload_setrecon_annotations</a>(epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">acq</a>.<a class="code" href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">filt</a>.tsp, epiduration, time2center, echogap);</div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;</div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;} <span class="comment">/* GEReq_predownload_setrecon_annotations_epi() */</span></div><div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a3d90133d3051fbc4816d02efd9566d8e"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">KS_PHASER::R</a></div><div class="ttdeci">int R</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1529</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#af33317a98ade78e3ac252b33cbb794af">KS_PHASER::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1525</div></div>
<div class="ttc" id="_g_e_required_8e_html_ac4df6187ca227e0004dc46436145f057"><div class="ttname"><a href="_g_e_required_8e.html#ac4df6187ca227e0004dc46436145f057">GEReq_predownload_setrecon_annotations</a></div><div class="ttdeci">void GEReq_predownload_setrecon_annotations(int tsp, int readdur, int time2center, int echogap)</div><div class="ttdoc">Sets ih*** variables for TE and rBW annotation</div><div class="ttdef"><b>Definition:</b> GERequired.e:1833</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a22cd0313e5ffabe8393f77745dba8d52"><div class="ttname"><a href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">KS_EPI::blipphaser</a></div><div class="ttdeci">KS_PHASER blipphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1688</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">KS_READTRAP::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1435</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a7582325a159d8ec89a4a4ba0fb89e9a9"><div class="ttname"><a href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">KS_EPI::etl</a></div><div class="ttdeci">int etl</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1690</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a03d42c44e323f3203fe5beabcefa47a5"><div class="ttname"><a href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">KS_EPI::read</a></div><div class="ttdeci">KS_READTRAP read</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1685</div></div>
<div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a29cf05caf131eb2c5915a41b18af16d0"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a29cf05caf131eb2c5915a41b18af16d0">KS_PHASER::nover</a></div><div class="ttdeci">int nover</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1528</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_abc81c5867684b6e31b65459ec9431269"><div class="ttname"><a href="struct_k_s___e_p_i.html#abc81c5867684b6e31b65459ec9431269">KS_EPI::readphaser</a></div><div class="ttdeci">KS_TRAP readphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1686</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_html_a292f93e48d34cda511fcfb72a05558c2"><div class="ttname"><a href="struct_k_s___r_e_a_d.html#a292f93e48d34cda511fcfb72a05558c2">KS_READ::filt</a></div><div class="ttdeci">FILTER_INFO filt</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:585</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a035bb76f8cc944eff7afd9333c2688e3"><div class="ttname"><a href="struct_k_s___e_p_i.html#a035bb76f8cc944eff7afd9333c2688e3">KS_EPI::read_spacing</a></div><div class="ttdeci">int read_spacing</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1691</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_ac359c54a7c5f9e9a94105b3c0d0be9ea"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#ac359c54a7c5f9e9a94105b3c0d0be9ea">KS_READTRAP::acq</a></div><div class="ttdeci">KS_READ acq</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1423</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_TRAP::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:437</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a37444b7139828ceb7a66e6755c506b84"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a37444b7139828ceb7a66e6755c506b84">&#9670;&nbsp;</a></span>GEReq_predownload_setrecon_voldata()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GEReq_predownload_setrecon_voldata </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>numvols</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_k_s___s_l_i_c_e___p_l_a_n.html">KS_SLICE_PLAN</a>&#160;</td>
          <td class="paramname"><em>slice_plan</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets rh*** variables related to multi-volume imaging</h4>
</p>
<p>The combination of rh*** variables allow for 50,000 image planes in GE's database.</p>
<p>However, Pfile data stops writing after 512 planes. To store more than 512 image planes as rawdata, RDS (Raw Data Server) or multivolume Pfiles can be used instead. It is possible that other mechanisms will be available through GE's upcoming Orchestra Live in the future.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">numvols</td><td>Number of volumes (<code>opfphases</code>) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">slice_plan</td><td>The slice plan (<a class="el" href="struct_k_s___s_l_i_c_e___p_l_a_n.html" title="Struct holding all information about slice locations and aquisition order">KS_SLICE_PLAN</a>), set up using <a class="el" href="_k_s_foundation_8h.html#a99557514f220cf0e97668286792e79cb" title="Calculates the data acquisition order for a standard interleaved 2D scans using one or more passes...">ks_calc_sliceplan()</a> or similar </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;                                                                                     {</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;  <span class="keywordtype">int</span> numechoes;</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;</div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;  <span class="keywordflow">if</span> (numvols &lt; 1)</div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;    numvols = 1;</div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;</div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;  <span class="comment">/* GE&#39;s CVs for #slices/TR and #passes (acqs) */</span></div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;  _slquant1.fixedflag = 0;</div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;  _acqs.fixedflag = 0;</div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;  slquant1 = slice_plan.<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a3c4ea64a2a861da12849cb565afab129">nslices_per_pass</a>;</div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;  acqs = slice_plan.<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a9cd9ebd93187231e5c4109d14c0dd69c">npasses</a>;</div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;  <span class="comment">/* prescan */</span></div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;  picalmode = 0;</div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;  pislquant = slquant1;</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;</div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;  <span class="comment">/* rhscnframe and rhpasframe are used when scanning in auto-pass mode w/o specific pass-packets (like GEendpass).</span></div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;<span class="comment">  To enable auto-pass mode, set rhtype1 |= RHTYP1AUTOPASS and set these variables to the proper value.</span></div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;<span class="comment">  It is unclear how this would work with partial Fourier and ARC, and has not been tested. */</span></div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;  rhscnframe = 0 <span class="comment">/* rhnslices*ceil(opnex)*rhdayres */</span>;</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;  rhpasframe = 0 <span class="comment">/* slquant1*ceil(opnex)*rhdayres */</span>;</div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;  rhtype1 &amp;= ~RHTYP1AUTOPASS; <span class="comment">/* diable auto-pass. I.e. require the use of pass packets (which is standard anyway) in scan to dump Pfiles */</span></div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;</div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;  <span class="comment">/* raw size */</span></div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;  numechoes = IMax(2, rhnecho, opnecho);</div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="_k_s_foundation_8h.html#a969816ef84367f11542f3473473260dc">KS_3D_SELECTED</a>) {</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;    rhrawsize = slquant1 * numechoes * (2 * rhptsize) * rhdaxres * rhdayres;</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;    rhrawsize = opslquant * numechoes * (2 * rhptsize) * rhdaxres * rhdayres;</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;  }</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;  {</div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;    <span class="keywordtype">char</span> tmpstr[100];</div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;    sprintf(tmpstr, <span class="stringliteral">&quot;rhrawsize = %d bytes/channel (KSFoundation)&quot;</span>, (<span class="keywordtype">int</span>) rhrawsize);</div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;    cvdesc(rhrawsizeview, tmpstr);</div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;  }</div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;</div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;  <span class="comment">/* Volumes &amp; total size */</span></div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;  rhnphases = numvols;  <span class="comment">/* must be = numvols (not numvols*acqs=#pfiles !!)</span></div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;<span class="comment">         - if 1 when numvols &gt;1:</span></div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;<span class="comment">         Prep Action failed: error please try again. ErrorLog=&quot;The integer value for ps_to_rs[0] in the header = 0 &quot;</span></div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;<span class="comment">         - if numvols*acqs when acqs &gt; 1 and numvols == 1:</span></div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;<span class="comment">         Scan failed (after few secs, no images)  */</span></div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;  rhnpasses = rhnphases * slice_plan.<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a9cd9ebd93187231e5c4109d14c0dd69c">npasses</a>;  <span class="comment">/* must be == # volumes (Pfiles) dumped or system hangs and needs rebooting ! */</span></div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;  rhreps    = rhnphases;</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="_k_s_foundation_8h.html#a969816ef84367f11542f3473473260dc">KS_3D_SELECTED</a>) {</div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;    rhnslices = slice_plan.<a class="code" href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a3414dc896f1276457707d70318d46770">nslices</a> * rhnphases;</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;    rhnslices = opslquant * opvquant * rhnphases;</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;  }</div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;  rhmphasetype = 0; <span class="comment">/* Interleaved multiphase */</span></div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;</div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;  rhtype1 |= RHTYP1BAM0FILL ; <span class="comment">/* zerofill BAM for clean Pfiles */</span></div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;  rhformat &amp;= ~RHF_ZCHOP; <span class="comment">/* no z chopping by default */</span></div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;  rhformat |= RHF_SINGLE_PHASE_INFO;</div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;  <span class="comment">/* Gradwarp Mode */</span></div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;  rhuser47 = cfgradcoil;</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;  </div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;  <span class="comment">/* copy useful variables to raw header for recon */</span></div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;  <span class="comment">/* rhuser32-35 are reserved for off-line VRGF correction (Karolinska) */</span></div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;  rhuser48 = pitscan; <span class="comment">/* scan time */</span></div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;</div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;} <span class="comment">/* GEReq_predownload_setrecon_voldata() */</span></div><div class="ttc" id="_k_s_foundation_8h_html_a969816ef84367f11542f3473473260dc"><div class="ttname"><a href="_k_s_foundation_8h.html#a969816ef84367f11542f3473473260dc">KS_3D_SELECTED</a></div><div class="ttdeci">#define KS_3D_SELECTED</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:104</div></div>
<div class="ttc" id="struct_k_s___s_l_i_c_e___p_l_a_n_html_a3c4ea64a2a861da12849cb565afab129"><div class="ttname"><a href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a3c4ea64a2a861da12849cb565afab129">KS_SLICE_PLAN::nslices_per_pass</a></div><div class="ttdeci">int nslices_per_pass</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1202</div></div>
<div class="ttc" id="struct_k_s___s_l_i_c_e___p_l_a_n_html_a9cd9ebd93187231e5c4109d14c0dd69c"><div class="ttname"><a href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a9cd9ebd93187231e5c4109d14c0dd69c">KS_SLICE_PLAN::npasses</a></div><div class="ttdeci">int npasses</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1201</div></div>
<div class="ttc" id="struct_k_s___s_l_i_c_e___p_l_a_n_html_a3414dc896f1276457707d70318d46770"><div class="ttname"><a href="struct_k_s___s_l_i_c_e___p_l_a_n.html#a3414dc896f1276457707d70318d46770">KS_SLICE_PLAN::nslices</a></div><div class="ttdeci">int nslices</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1200</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7e6590863fa011fcf114dff217edc807"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7e6590863fa011fcf114dff217edc807">&#9670;&nbsp;</a></span>GEReq_predownload_setrecon_epi()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS GEReq_predownload_setrecon_epi </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_k_s___e_p_i.html">KS_EPI</a> *&#160;</td>
          <td class="paramname"><em>epi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>numvols2store</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_k_s___s_l_i_c_e___p_l_a_n.html">KS_SLICE_PLAN</a>&#160;</td>
          <td class="paramname"><em>slice_plan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>echogap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>blipsign</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>datadestination</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>multishotflag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ghostcorrflag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>imsize_policy</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Wrapper function that set up rh*** variable for a <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> object using other functions</h4>
</p>
<p>Calls <a class="el" href="_g_e_required_8e.html#a6d51efff591f87dbcc7887e45c16db0f" title="Sets required global rh*** variables for Cartsian imaging">GEReq_predownload_setrecon_readphase()</a>, <a class="el" href="_g_e_required_8e.html#a37444b7139828ceb7a66e6755c506b84" title="Sets rh*** variables related to multi-volume imaging">GEReq_predownload_setrecon_voldata()</a> and <a class="el" href="_g_e_required_8e.html#a64c7c04147ac9eef0043d6d76fc0f8f6" title="Sets ih*** variables for TE and rBW annotation based on a KS_EPI">GEReq_predownload_setrecon_annotations_epi()</a>, and <a class="el" href="_g_e_required_8e.html#a1df29f83c19052911e6775f350ff085d" title="Generates the rowflip.param file for KS_EPI">GEReq_predownload_genrowflip()</a>. Additionally, some rh*** variables are overridden for EPI.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">epi</td><td>Pointer to <a class="el" href="struct_k_s___e_p_i.html" title="Composite sequence object for EPI readout">KS_EPI</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">numvols2store</td><td>Number of volumes to store (including calibration vols such as ghostcorr) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">slice_plan</td><td>The slice plan (<a class="el" href="struct_k_s___s_l_i_c_e___p_l_a_n.html" title="Struct holding all information about slice locations and aquisition order">KS_SLICE_PLAN</a>) set up using <a class="el" href="_g_e_required_8e.html#ae6527c3b5637d870c648a7703c202985">ks_slice_plan()</a> or similar </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">echogap</td><td>Gap between two EPI trains in [us] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">blipsign</td><td>KS_EPI_POSBLIPS or KS_EPI_NEGBLIPS </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">datadestination</td><td>Value passed on to <a class="el" href="_g_e_required_8e.html#a6d51efff591f87dbcc7887e45c16db0f" title="Sets required global rh*** variables for Cartsian imaging">GEReq_predownload_setrecon_readphase()</a> to set rhexecctrl </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">multishotflag</td><td>0: Parallel imaging mode 1: Multishot mode </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ghostcorrflag</td><td>Integrated refscan (Nyquist ghost correction). 0:Off, 1:On </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">imsize_policy</td><td>Choice between <code>KS_IMSIZE_NATIVE</code>, <code>KS_IMSIZE_POW2</code>, <code>KS_IMSIZE_MIN256</code> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;                                                                                                                                                                                                               {</div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;</div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;<span class="preprocessor">#if EPIC_RELEASE &gt;= 26  </span></div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;        <span class="keywordflow">if</span> (datadestination &amp; RHXC_XFER_IM) {</div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: Online recon not supported for KS_EPI data on DV26 or later&quot;</span>, __FUNCTION__); </div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;        }</div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;</div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;  <a class="code" href="_g_e_required_8e.html#a6d51efff591f87dbcc7887e45c16db0f">GEReq_predownload_setrecon_readphase</a>(&amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>, &amp;epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>, NULL, imsize_policy, datadestination); <span class="comment">/* also sets rhasset when R &gt; 1 */</span></div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;  <a class="code" href="_g_e_required_8e.html#a37444b7139828ceb7a66e6755c506b84">GEReq_predownload_setrecon_voldata</a>(numvols2store, slice_plan); <span class="comment">/* opfphases = number of volumes */</span></div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;  <a class="code" href="_g_e_required_8e.html#a64c7c04147ac9eef0043d6d76fc0f8f6">GEReq_predownload_setrecon_annotations_epi</a>(epi, echogap);</div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;</div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;</div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;  <span class="comment">/* EPI specific rh* vars  */</span></div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;  rhileaves = epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a>;</div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;  rhkydir = (blipsign == <a class="code" href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811ab36b1c8bcdbe924fc9d4a36cde9ba4dd">KS_EPI_POSBLIPS</a>) ? 2 : 0;</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;  rhmphasetype = 0; <span class="comment">/* Interleaved multiphase */</span></div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;</div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;  <span class="keywordflow">if</span> (multishotflag &gt; 0) {</div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;    <span class="comment">/* .R for multi-shot. Override values set in GEReq_predownload_setrecon_readphase()-&gt;GEReq_predownload_setrecon_accel() */</span></div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;    _rhasset.fixedflag = FALSE;</div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;    _rhasset_R.fixedflag = FALSE;</div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;    <a class="code" href="_k_s_foundation__tgt_8c.html#ad152641fe076fd7c466bf3eff5d0a13f">rhasset</a> = 0;</div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;    rhasset_R = 1.0;</div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;  }</div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;</div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;  <span class="comment">/* Turn on row-flipping if ETL &gt; 1 */</span></div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;  <span class="keywordflow">if</span> (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">etl</a> &gt; 1) {</div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;    rhformat |= RHF_USE_FLIPTABLE;</div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;    <span class="keywordflow">if</span> (datadestination &amp; RHXC_XFER_IM) {</div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;      <span class="comment">/* Online recon: Single-shot w/ or w/o ASSET */</span></div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;      <a class="code" href="_g_e_required_8e.html#a1df29f83c19052911e6775f350ff085d">GEReq_predownload_genrowflip</a>(epi, blipsign, <a class="code" href="_k_s_foundation__tgt_8c.html#ad152641fe076fd7c466bf3eff5d0a13f">rhasset</a>, TRUE);</div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;      <span class="comment">/* Offline recon, say we do rowflip in rhformat, because otherwise GERecon(&#39;EPI.ComputeCoefficients&#39;) does not</span></div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;<span class="comment">      work (requires RHF_USE_FLIPTABLE to be set).</span></div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;<span class="comment">      But let&#39;s not set any negative entries in the file for offline use to avoid rowflipping to actually occur:</span></div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;<span class="comment">      DV26+: This file is ignored for scan archives</span></div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;<span class="comment">      Pre DV26: We don&#39;t want the rows to be flipped correctly in the Pfile currently since we don&#39;t understand</span></div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;<span class="comment">      why the lines are flipped wrong for mulitshot EPI. We deal with rowflipping ourselves in the recon</span></div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;<span class="comment">      */</span></div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;      <a class="code" href="_g_e_required_8e.html#a1df29f83c19052911e6775f350ff085d">GEReq_predownload_genrowflip</a>(epi, blipsign, <a class="code" href="_k_s_foundation__tgt_8c.html#ad152641fe076fd7c466bf3eff5d0a13f">rhasset</a>, FALSE);      </div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;    }</div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;    rhformat &amp;= ~RHF_USE_FLIPTABLE;</div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;  }</div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;</div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;  <span class="comment">/* fermi filter */</span></div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;  rhfermr = <a class="code" href="_k_s_foundation__common_8c.html#a66aaa6a3300240048d37097ded69ba53">opxres</a>/2;</div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;</div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;</div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;  <span class="comment">/* override flip control set in GEReq_predownload()-&gt;{@inline loadrheader.e rheaderinit} </span></div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;<span class="comment">  N.B.: ks_scan_epi_loadecho() changes the view indices based on the blipsign argument. Hence, </span></div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;<span class="comment">  there is no need to inform recon that k-space data should be flipped (as opposed to the product</span></div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;<span class="comment">  epi.e/epi2.e, which use oepf = 1 when pepolar = 1) */</span></div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;  eepf = 0;</div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;  eeff = 0;</div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;  oepf = 0;</div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;  oeff = 0;</div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;  set_echo_flip(&amp;rhdacqctrl, &amp;chksum_rhdacqctrl, eepf, oepf, eeff, oeff); <span class="comment">/* clear bit 1 - flips image in phase dir */</span></div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;</div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;<span class="preprocessor">#if EPIC_RELEASE &gt;= 26</span></div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;    rhdacqctrl |= 8192; <span class="comment">/* disable Orchestra recon */</span></div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;</div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;  <span class="comment">/* save echo spacing value into rhesp */</span></div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;  rhesp = epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">read</a>.<a class="code" href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">grad</a>.<a class="code" href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">duration</a>;</div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;</div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;</div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;</div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;  <span class="comment">/* default but see below */</span></div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;  rhpctemporal = 1;</div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;  rhpccoil = 0;</div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;  rhref = 0;</div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;  rhtype1 &amp;= ~RHTYP1DIFFUSIONEPI;</div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;</div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;  <span class="comment">/* Nyquist ghost correction using integrated ref scan combined with online recon (RHXC_XFER_IM) requires diffusion mode</span></div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;<span class="comment">     so here we pretend we are doing this */</span></div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;  <span class="keywordflow">if</span> (ghostcorrflag) {</div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;</div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;    rhtype1 |= RHTYP1DIFFUSIONEPI; </div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;</div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;<span class="preprocessor">  #if EPIC_RELEASE &lt; 26</span></div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;    <span class="keywordflow">if</span> (datadestination &amp; RHXC_XFER_IM) {</div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;</div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;        <span class="keywordflow">if</span> ((multishotflag &gt; 0) &amp;&amp; (epi-&gt;<a class="code" href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">blipphaser</a>.<a class="code" href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">R</a> &gt; 1)) {</div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;      </div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;          <span class="comment">/* GE&#39;s online recon cannot do this type of ghost correction for multi-shot */</span></div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: GhostCal+OnlineRecon requires single-shot&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;      </div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;</div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;          <span class="keywordflow">if</span> (opdiffuse != <a class="code" href="_k_s_foundation_8h.html#a11a05c3ea650ef64c6421ced6c56bff4a74ba4041bf3d1545f9bfdba233bddb7b">KS_EPI_DIFFUSION_ON</a>) {</div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;            <span class="comment">/* we have a non-diffusion EPI scan (e.g. SE-EPI or GE-EPI) that we want to use with GE&#39;s integrated</span></div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;<span class="comment">            refscan (rhref = 5), which only allows single-shot DW-EPI</span></div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;<span class="comment">            DV26 Update: The new Orchestra recon does not accept normal DAB packets, only HyperDAB packets (loadhsdab())</span></div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;<span class="comment">            which is not supported by the use of KS_EPI objects. This means that as of DV26+, GE&#39;s online recon cannot be used</span></div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;<span class="comment">            to recon EPI data with KS_EPI (i.e. not ksepi.e) */</span></div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;            cvoverride(opdiffuse, <a class="code" href="_k_s_foundation_8h.html#a11a05c3ea650ef64c6421ced6c56bff4aa4576cd2d3b8dc8631cc85b1c4a7edaf">KS_EPI_DIFFUSION_PRETEND_FOR_RECON</a>, PSD_FIX_ON, PSD_EXIST_ON);</div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;            cvoverride(optensor, 16, PSD_FIX_ON, PSD_EXIST_ON);</div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;            cvoverride(rhnumdifdirs, 1, PSD_FIX_ON, PSD_EXIST_ON); <span class="comment">/* Prep Action Failed if 0 */</span></div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;            cvoverride(opdifnumdirs, 0, PSD_FIX_ON, PSD_EXIST_ON);</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;            cvoverride(opdifnumt2, opfphases, PSD_FIX_ON, PSD_EXIST_ON);</div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;          }                </div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;</div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;          rhref = 5;<span class="comment">/* inform GE&#39;s product recon that we want this type of ghost correction */</span></div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;</div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;        } <span class="comment">/* Online recon prior to DV26 */</span></div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;   }</div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;<span class="preprocessor">  #endif</span></div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;</div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;  }</div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;</div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;</div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;</div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;</div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;} <span class="comment">/* GEReq_predownload_setrecon_epi() */</span></div><div class="ttc" id="struct_k_s___p_h_a_s_e_r_html_a3d90133d3051fbc4816d02efd9566d8e"><div class="ttname"><a href="struct_k_s___p_h_a_s_e_r.html#a3d90133d3051fbc4816d02efd9566d8e">KS_PHASER::R</a></div><div class="ttdeci">int R</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1529</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a66aaa6a3300240048d37097ded69ba53"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a66aaa6a3300240048d37097ded69ba53">opxres</a></div><div class="ttdeci">int opxres</div></div>
<div class="ttc" id="_g_e_required_8e_html_a6d51efff591f87dbcc7887e45c16db0f"><div class="ttname"><a href="_g_e_required_8e.html#a6d51efff591f87dbcc7887e45c16db0f">GEReq_predownload_setrecon_readphase</a></div><div class="ttdeci">void GEReq_predownload_setrecon_readphase(const KS_READTRAP *const readtrap, const KS_PHASER *const phaser, const KS_PHASER *const zphaser, int imsize_policy, int datadestination)</div><div class="ttdoc">Sets required global rh*** variables for Cartsian imaging</div><div class="ttdef"><b>Definition:</b> GERequired.e:1693</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a22cd0313e5ffabe8393f77745dba8d52"><div class="ttname"><a href="struct_k_s___e_p_i.html#a22cd0313e5ffabe8393f77745dba8d52">KS_EPI::blipphaser</a></div><div class="ttdeci">KS_PHASER blipphaser</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1688</div></div>
<div class="ttc" id="_g_e_required_8e_html_a1df29f83c19052911e6775f350ff085d"><div class="ttname"><a href="_g_e_required_8e.html#a1df29f83c19052911e6775f350ff085d">GEReq_predownload_genrowflip</a></div><div class="ttdeci">STATUS GEReq_predownload_genrowflip(KS_EPI *epi, int blipsign, int assetflag, int dorowflip)</div><div class="ttdoc">Generates the rowflip.param file for KS_EPI</div><div class="ttdef"><b>Definition:</b> GERequired.e:1253</div></div>
<div class="ttc" id="struct_k_s___r_e_a_d_t_r_a_p_html_af33317a98ade78e3ac252b33cbb794af"><div class="ttname"><a href="struct_k_s___r_e_a_d_t_r_a_p.html#af33317a98ade78e3ac252b33cbb794af">KS_READTRAP::grad</a></div><div class="ttdeci">KS_TRAP grad</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1435</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a7582325a159d8ec89a4a4ba0fb89e9a9"><div class="ttname"><a href="struct_k_s___e_p_i.html#a7582325a159d8ec89a4a4ba0fb89e9a9">KS_EPI::etl</a></div><div class="ttdeci">int etl</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1690</div></div>
<div class="ttc" id="_g_e_required_8e_html_a64c7c04147ac9eef0043d6d76fc0f8f6"><div class="ttname"><a href="_g_e_required_8e.html#a64c7c04147ac9eef0043d6d76fc0f8f6">GEReq_predownload_setrecon_annotations_epi</a></div><div class="ttdeci">void GEReq_predownload_setrecon_annotations_epi(KS_EPI *epi, int echogap)</div><div class="ttdoc">Sets ih*** variables for TE and rBW annotation based on a KS_EPI</div><div class="ttdef"><b>Definition:</b> GERequired.e:1946</div></div>
<div class="ttc" id="struct_k_s___e_p_i_html_a03d42c44e323f3203fe5beabcefa47a5"><div class="ttname"><a href="struct_k_s___e_p_i.html#a03d42c44e323f3203fe5beabcefa47a5">KS_EPI::read</a></div><div class="ttdeci">KS_READTRAP read</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1685</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_ad152641fe076fd7c466bf3eff5d0a13f"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#ad152641fe076fd7c466bf3eff5d0a13f">rhasset</a></div><div class="ttdeci">int rhasset</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a11a05c3ea650ef64c6421ced6c56bff4a74ba4041bf3d1545f9bfdba233bddb7b"><div class="ttname"><a href="_k_s_foundation_8h.html#a11a05c3ea650ef64c6421ced6c56bff4a74ba4041bf3d1545f9bfdba233bddb7b">KS_EPI_DIFFUSION_ON</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1742</div></div>
<div class="ttc" id="_g_e_required_8e_html_a37444b7139828ceb7a66e6755c506b84"><div class="ttname"><a href="_g_e_required_8e.html#a37444b7139828ceb7a66e6755c506b84">GEReq_predownload_setrecon_voldata</a></div><div class="ttdeci">void GEReq_predownload_setrecon_voldata(int numvols, const KS_SLICE_PLAN slice_plan)</div><div class="ttdoc">Sets rh*** variables related to multi-volume imaging</div><div class="ttdef"><b>Definition:</b> GERequired.e:1983</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ae3a267da7c3c7e4e6e523dafba9b7811ab36b1c8bcdbe924fc9d4a36cde9ba4dd"><div class="ttname"><a href="_k_s_foundation_8h.html#ae3a267da7c3c7e4e6e523dafba9b7811ab36b1c8bcdbe924fc9d4a36cde9ba4dd">KS_EPI_POSBLIPS</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1741</div></div>
<div class="ttc" id="struct_k_s___t_r_a_p_html_ac6e4b2a3cf932b33832d4e4e4e7cd0de"><div class="ttname"><a href="struct_k_s___t_r_a_p.html#ac6e4b2a3cf932b33832d4e4e4e7cd0de">KS_TRAP::duration</a></div><div class="ttdeci">int duration</div><div class="ttdef"><b>Definition:</b> KSFoundation.h:437</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a11a05c3ea650ef64c6421ced6c56bff4aa4576cd2d3b8dc8631cc85b1c4a7edaf"><div class="ttname"><a href="_k_s_foundation_8h.html#a11a05c3ea650ef64c6421ced6c56bff4aa4576cd2d3b8dc8631cc85b1c4a7edaf">KS_EPI_DIFFUSION_PRETEND_FOR_RECON</a></div><div class="ttdef"><b>Definition:</b> KSFoundation.h:1742</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a67a331f96035253e5efbb3e2f2ad3f24"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a67a331f96035253e5efbb3e2f2ad3f24">&#9670;&nbsp;</a></span>GEReq_cvinit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS GEReq_cvinit </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Helper function to be called at the beginning of <a class="el" href="ksepi_8e.html#ab86d8a9c08d382dc537ec69e0f1cc9dc">cvinit()</a></h4>
</p>
<p>In the beginning of <code><a class="el" href="ksepi_8e.html#ab86d8a9c08d382dc537ec69e0f1cc9dc">cvinit()</a></code> the following lines should be added: </p><div class="fragment"><div class="line">STATUS status = <a class="code" href="_g_e_required_8e.html#a67a331f96035253e5efbb3e2f2ad3f24">GEReq_cvinit</a>();</div><div class="line"><span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div></div><!-- fragment --><p>This function sets up various global GE stuff, including e.g. the gradient specs. The gradient specs are controlled by <code>ks_srfact</code> and <code>ks_qfact</code>. <code>ks_srfact</code> Should have a value that will allow scanning on all MR systems without PNS effects. Also, <code>ks_srfact</code> does not affect the EPI train in <a class="el" href="ksepi_8e.html" title="This file contains the overall structure for the ksepi psd. ">ksepi.e</a>, since it controls the slewrate and gradient max separately. <code>ks_qfact</code> is supposed to be 1 by default, with the purpose to from an optimal setting reduce the slewrate to reduce the acoustic noise. A default value of 1.0 will make the system perform best but with high acoustic noise. A value of about 8-10 may be a good trade-off between acoustic noise reduction and reasonable image quality.</p>
<p>In this function, <code>ks_sarcheckdone</code> is set to FALSE. This CV is checked in <a class="el" href="_g_e_required_8e.html#a994265c9b567cd3c6e5da34ad737dd4b" title="Helper function to be called at the beginning of predownload()">GEReq_predownload()</a> and <a class="el" href="_k_s_foundation_8h.html#a853cff23395e570cc88aa3405b78c3a9" title="Places a KS_RF sequence object on a board at some position in the pulse sequence">ks_pg_rf()</a>, which both will complain if it is not has been set to TRUE. <a class="el" href="_g_e_required_8e.html#a789f2b2ac7ec21daa6a693820873e64a" title="Checks that sequence modules sum up to TR, honoring SAR/heating limits">GEReq_eval_checkTR_SAR_calcs()</a> sets this CV to TRUE.</p>
<p>It is important that an error returned from <a class="el" href="_g_e_required_8e.html#a67a331f96035253e5efbb3e2f2ad3f24" title="Helper function to be called at the beginning of cvinit()">GEReq_cvinit()</a> also results in an error in <code><a class="el" href="ksepi_8e.html#ab86d8a9c08d382dc537ec69e0f1cc9dc">cvinit()</a></code>, otherwise it will not show up in the UI.</p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;                          {</div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;</div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;  <span class="comment">/* ART: Acoustic noise reduction</span></div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;<span class="comment">    Imaging option button &quot;Acoustic reduction&quot;:</span></div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;<span class="comment">      - PSD_IOPT_MILDNOTE in sequence_iopts[]</span></div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;<span class="comment">      - Sets CV opsilent = TRUE</span></div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;<span class="comment">    When acoustic noise reduction (ART) imaging option is checked, enable the ART tab in the UI too</span></div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;<span class="comment">    by forcing cfnumartlevels = 2</span></div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;<span class="comment">    - &quot;Moderate&quot; radio button on ART tab: CV opsilentlevel = 1</span></div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;<span class="comment">    - &quot;High&quot; radio button on ART tab: CV opsilentlevel = 2</span></div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;  cvoverride(cfnumartlevels, 2, PSD_FIX_OFF, PSD_EXIST_ON);</div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;  pinumartlevels = cfnumartlevels;</div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;  </div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;  <span class="keywordflow">if</span> (opsilent) {</div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;    _ks_qfact.existflag = TRUE;</div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;    <span class="keywordflow">if</span> (opsilentlevel == 1) {</div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;      <span class="comment">/* moderate */</span></div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;      <a class="code" href="_g_e_required_8e.html#a7506e6224f5036fb1941843536b6f4a6">ks_qfact</a> = 8;</div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;      <span class="comment">/* high */</span></div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;      <a class="code" href="_g_e_required_8e.html#a7506e6224f5036fb1941843536b6f4a6">ks_qfact</a> = 20;</div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;    }</div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;    <a class="code" href="_g_e_required_8e.html#a7506e6224f5036fb1941843536b6f4a6">ks_qfact</a> = 1;</div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;  }</div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;</div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;</div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;  {</div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;  }</div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;</div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;  EpicConf();</div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;</div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;  <span class="comment">/* set gradient limitations (calling GEs obloptimize() &amp; further ramptime modifications) */</span></div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;  <a class="code" href="_g_e_required_8e.html#aae6f05f5a408ae64a91705d67071e064">GEReq_init_gradspecs</a>(&amp;<a class="code" href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a>, &amp;<a class="code" href="_k_s_foundation_8h.html#af51ba165cbaf874219789beaa48f2464">phygrd</a>, <a class="code" href="_g_e_required_8e.html#ac2162634eabe08843c90d8cf8a135042">ks_srfact</a> / <a class="code" href="_g_e_required_8e.html#a7506e6224f5036fb1941843536b6f4a6">ks_qfact</a>);</div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;</div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;  <span class="comment">/* resets all filter #. From this point, ok to call setfilter() */</span></div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;  initfilter();</div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;</div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;  <span class="comment">/* setsysparams() sets psd_grd_wait and psd_rf_wait for the system */</span></div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;  setsysparms();</div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;<span class="preprocessor">#ifdef SIM</span></div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;  <span class="comment">/* In simulation, we don&#39;t want them to confuse the timing in WTools */</span></div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;  _psd_grd_wait.fixedflag = 0;</div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;  _psd_rf_wait.fixedflag = 0;</div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#aa4225c3edfbcb8e85d91fc491a495058">psd_grd_wait</a> = 0;</div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#a636634b6eb50758af3826332f9180e9b">psd_rf_wait</a> = 0;</div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;</div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;</div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;  <span class="comment">/* GE CVs that could use a wider min/max range: */</span></div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;  cvmax(rhfrsize, 32768);</div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;  cvmax(rhdaxres, 32768);</div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;  cvmax(opphasefov, 5); <span class="comment">/* to allow larger FOV in phase enc dir that freq */</span></div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;  cvmax(rhnslices, 50000); <span class="comment">/* 50,000, which is 5x of RHF_MAX_IMAGES_MULTIPHASE = 10000 */</span></div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;  cvmax(rhreps, 2048); <span class="comment">/* max 2048 vols */</span></div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;  cvmax(rhnphases, 2048); <span class="comment">/* max 2048 vols */</span></div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;  cvmax(opfphases, 2048); <span class="comment">/* max 2048 vols */</span></div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;  cvmax(<a class="code" href="_k_s_foundation__common_8c.html#a62476b720a40200e94668beec660cac0">opyres</a>, 1024); <span class="comment">/* max 1024 yres */</span></div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;  cvmax(<a class="code" href="_k_s_foundation__common_8c.html#a04f737cdd207318e145bbed14eb487ae">opslthick</a>, 200); <span class="comment">/* max 200 mm slice thickness */</span></div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;  cvmax(optr, 60s); <span class="comment">/* max 60s TR */</span></div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;  cvmax(ihtr, 60s);</div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;  cvmax(rhref, 5); <span class="comment">/* Allow 1st-volume ghost correction as GE&#39;s diffusion EPI (only works for single shot) */</span></div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;  cvmax(opbval, 30000);</div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;  cvmax(opileave, 1);</div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;</div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;  <span class="comment">/* activate Advisory panel */</span></div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;  piadvise = PSD_ON;</div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;  piadvmin  = (1 &lt;&lt; PSD_ADVTE); <span class="comment">/* TE Advisory on */</span></div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;  piadvmin |= (1 &lt;&lt; PSD_ADVTR);  <span class="comment">/* TR Advisory on */</span></div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;  piadvmin |= (1 &lt;&lt; PSD_ADVRCVBW);<span class="comment">/* rBW Advisory on */</span></div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;  piadvmin |= (1 &lt;&lt; PSD_ADVFOV);<span class="comment">/* FOV Advisory on */</span></div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;  piadvmax = piadvmin;</div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;</div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;  {</div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;  }</div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;</div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;</div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;  <span class="comment">/* KSFoundation indicator variable for completed SAR checks (c.f. GEReq_eval_checkTR_SAR_calcs(), which sets it to TRUE) */</span></div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;  <a class="code" href="_g_e_required_8e.html#ac2a9639645541b0daab96065b217062d">ks_sarcheckdone</a> = FALSE;</div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;</div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160; <span class="comment">/* GE&#39;s psd_name seems not be available on TGT, to let&#39;s copy this one */</span></div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;<span class="preprocessor">#if EPIC_RELEASE &gt; 27 || (EPIC_RELEASE == 27 &amp;&amp; EPIC_PATCHNUM &gt; 1)</span></div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;<span class="comment">/* #if EPIC_RELEASE &gt;= 27 */</span></div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;<span class="comment">/* Since RX27R02, GE&#39;s psd_name no longer exists */</span></div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;{</div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;  strcpy(<a class="code" href="_g_e_required_8e.html#af846b49be109f687e9863f2016029516">ks_psdname</a>, get_psd_name());</div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;}</div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;  strcpy(<a class="code" href="_g_e_required_8e.html#af846b49be109f687e9863f2016029516">ks_psdname</a>, psd_name);</div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;</div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;</div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;</div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;} <span class="comment">/* GEReq_cvinit() */</span></div><div class="ttc" id="_k_s_foundation__common_8c_html_a62476b720a40200e94668beec660cac0"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a62476b720a40200e94668beec660cac0">opyres</a></div><div class="ttdeci">int opyres</div></div>
<div class="ttc" id="_g_e_required_8e_html_aae6f05f5a408ae64a91705d67071e064"><div class="ttname"><a href="_g_e_required_8e.html#aae6f05f5a408ae64a91705d67071e064">GEReq_init_gradspecs</a></div><div class="ttdeci">STATUS GEReq_init_gradspecs(LOG_GRAD *loggrd, PHYS_GRAD *phygrd, float srfact)</div><div class="ttdoc">Initialize logical and physical gradient specifications</div><div class="ttdef"><b>Definition:</b> GERequired.e:388</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_af51ba165cbaf874219789beaa48f2464"><div class="ttname"><a href="_k_s_foundation_8h.html#af51ba165cbaf874219789beaa48f2464">phygrd</a></div><div class="ttdeci">PHYS_GRAD phygrd</div></div>
<div class="ttc" id="_g_e_required_8e_html_af846b49be109f687e9863f2016029516"><div class="ttname"><a href="_g_e_required_8e.html#af846b49be109f687e9863f2016029516">ks_psdname</a></div><div class="ttdeci">char ks_psdname[256]</div><div class="ttdef"><b>Definition:</b> GERequired.e:218</div></div>
<div class="ttc" id="_g_e_required_8e_html_a7506e6224f5036fb1941843536b6f4a6"><div class="ttname"><a href="_g_e_required_8e.html#a7506e6224f5036fb1941843536b6f4a6">ks_qfact</a></div><div class="ttdeci">float ks_qfact</div><div class="ttdef"><b>Definition:</b> GERequired.e:240</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_a4bd8f92bd97315429605430e234dceb4"><div class="ttname"><a href="_k_s_foundation_8h.html#a4bd8f92bd97315429605430e234dceb4">loggrd</a></div><div class="ttdeci">LOG_GRAD loggrd</div></div>
<div class="ttc" id="_g_e_required_8e_html_ac2a9639645541b0daab96065b217062d"><div class="ttname"><a href="_g_e_required_8e.html#ac2a9639645541b0daab96065b217062d">ks_sarcheckdone</a></div><div class="ttdeci">int ks_sarcheckdone</div><div class="ttdef"><b>Definition:</b> GERequired.e:216</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_aa4225c3edfbcb8e85d91fc491a495058"><div class="ttname"><a href="_k_s_foundation__common_8c.html#aa4225c3edfbcb8e85d91fc491a495058">psd_grd_wait</a></div><div class="ttdeci">int psd_grd_wait</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a636634b6eb50758af3826332f9180e9b"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a636634b6eb50758af3826332f9180e9b">psd_rf_wait</a></div><div class="ttdeci">int psd_rf_wait</div></div>
<div class="ttc" id="_k_s_foundation__common_8c_html_a04f737cdd207318e145bbed14eb487ae"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a04f737cdd207318e145bbed14eb487ae">opslthick</a></div><div class="ttdeci">float opslthick</div></div>
<div class="ttc" id="_g_e_required_8e_html_ac2162634eabe08843c90d8cf8a135042"><div class="ttname"><a href="_g_e_required_8e.html#ac2162634eabe08843c90d8cf8a135042">ks_srfact</a></div><div class="ttdeci">float ks_srfact</div><div class="ttdef"><b>Definition:</b> GERequired.e:239</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8e619b6a6b2266ea62b80c18280c5427"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8e619b6a6b2266ea62b80c18280c5427">&#9670;&nbsp;</a></span>GEReq_cveval()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS GEReq_cveval </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Helper function to be called at the beginning of <a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></h4>
</p>
<p>In the beginning of <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code> the following lines should be added: </p><div class="fragment"><div class="line">STATUS status = <a class="code" href="_g_e_required_8e.html#a8e619b6a6b2266ea62b80c18280c5427">GEReq_cveval</a>();</div><div class="line"><span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div></div><!-- fragment --><p>This function up various global GE stuff, and copies also the struct array <code>scan_info</code>, holding the prescribed slice locations to <code>ks_scan_info</code>, the latter which can also be accessible on TGT.</p>
<p>Simulation (WTools): If we have ks_simscan = 1 (default), <a class="el" href="_g_e_required_8e.html#a9e0525cfd14e06359ddb8fe37ad965f5" title="Simulate scan locations in simulation (WTools)">simscan()</a> will have make up slice locations in ks_scan_info based on opslthick, opslspace and opslquant. Note, GE clears scan_info between <a class="el" href="ksepi_8e.html#ae8a4dba5f13b208e5a28acc5025ab3bc">cvcheck()</a> and <a class="el" href="ksepi_8e.html#a6dab68043b9947b6a659f72613c083ec">predownload()</a> when in simulation. Hence, we now have the opposite case, i.e. we have some slice info data in ks_scan_info but nothing in scan_info.</p>
<p>It is important that an error returned from <a class="el" href="_g_e_required_8e.html#a8e619b6a6b2266ea62b80c18280c5427" title="Helper function to be called at the beginning of cveval()">GEReq_cveval()</a> also results in an error in <code><a class="el" href="ksepi_8e.html#afc7958d04bdf5f15ffeec67d3c4c490d">cveval()</a></code>, otherwise it will not show up in the UI.</p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;                          {</div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;</div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;  {</div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;  }</div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;</div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160; InitAdvPnlCVs();</div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;</div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;<span class="preprocessor">#ifdef PSD_HW</span></div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160; <span class="comment">/* MR scanner (hardware): copy scan_info to ks_scan_info, so we can use this data on TGT */</span></div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160; memcpy(<a class="code" href="_g_e_required_8e.html#aedd5d7c8a00be480230531f3ab5f8bdb">ks_scan_info</a>, scan_info, opslquant*<span class="keyword">sizeof</span>(SCAN_INFO));</div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;  <span class="comment">/* WTools (sim) */</span></div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_g_e_required_8e.html#a01c4c91785086ec18a8fc39595e22f0d">ks_simscan</a>)</div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;    <a class="code" href="_g_e_required_8e.html#a9e0525cfd14e06359ddb8fe37ad965f5">simscan</a>();</div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;</div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;</div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;} <span class="comment">/* GEReq_cveval() */</span></div><div class="ttc" id="_g_e_required_8e_html_a9e0525cfd14e06359ddb8fe37ad965f5"><div class="ttname"><a href="_g_e_required_8e.html#a9e0525cfd14e06359ddb8fe37ad965f5">simscan</a></div><div class="ttdeci">STATUS simscan(void)</div><div class="ttdoc">Simulate scan locations in simulation (WTools)</div><div class="ttdef"><b>Definition:</b> GERequired.e:294</div></div>
<div class="ttc" id="_g_e_required_8e_html_aedd5d7c8a00be480230531f3ab5f8bdb"><div class="ttname"><a href="_g_e_required_8e.html#aedd5d7c8a00be480230531f3ab5f8bdb">ks_scan_info</a></div><div class="ttdeci">SCAN_INFO ks_scan_info[SLTAB_MAX]</div><div class="ttdef"><b>Definition:</b> GERequired.e:212</div></div>
<div class="ttc" id="_g_e_required_8e_html_a01c4c91785086ec18a8fc39595e22f0d"><div class="ttname"><a href="_g_e_required_8e.html#a01c4c91785086ec18a8fc39595e22f0d">ks_simscan</a></div><div class="ttdeci">int ks_simscan</div><div class="ttdef"><b>Definition:</b> GERequired.e:238</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a91a41d02810ad2b4d7ce00ab3adbdf72"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a91a41d02810ad2b4d7ce00ab3adbdf72">&#9670;&nbsp;</a></span>GEReq_cvcheck()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS GEReq_cvcheck </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Mandatory APx functions for PSDs from DV26</h4>
</p>
<p>DV26 requires getAPxAlgorithm() and getAPxParam() functions to exist in each PSD. Empty getAPxAlgorithm() and getAPxParam() functions are declared below in <a class="el" href="_g_e_required_8e.html" title="This file has several sections that should be @inline&#39;d for a main pulse sequence written entirely in...">GERequired.e</a> to allow compilation on DV26. If a PSD wants to use this new functionality in DV26 it should add the following line: #define KS_PSD_USE_APX 1 in its  section, so that KS_PSD_USE_APX is not set to 0 here, and hence getAPxAlgorithm() and getAPxParam() wont be redeclared here in <a class="el" href="_g_e_required_8e.html" title="This file has several sections that should be @inline&#39;d for a main pulse sequence written entirely in...">GERequired.e</a>. <br />
 </p><h4>Helper function to be called at the beginning of <a class="el" href="ksepi_8e.html#ae8a4dba5f13b208e5a28acc5025ab3bc">cvcheck()</a></h4>
<p>In the beginning of <code><a class="el" href="ksepi_8e.html#ae8a4dba5f13b208e5a28acc5025ab3bc">cvcheck()</a></code> the following lines should be added: </p><div class="fragment"><div class="line">STATUS status = <a class="code" href="_g_e_required_8e.html#a8e619b6a6b2266ea62b80c18280c5427">GEReq_cveval</a>();</div><div class="line"><span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div></div><!-- fragment --><p>It is important that an error returned from <a class="el" href="_g_e_required_8e.html#a91a41d02810ad2b4d7ce00ab3adbdf72" title="Mandatory APx functions for PSDs from DV26">GEReq_cvcheck()</a> also results in an error in <code><a class="el" href="ksepi_8e.html#ae8a4dba5f13b208e5a28acc5025ab3bc">cvcheck()</a></code>, otherwise it will not show up in the UI.</p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;                           {</div><div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;</div><div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;  <span class="keywordflow">if</span> (existcv(optr) &amp;&amp; optr &lt; avmintr) {</div><div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;    epic_error(use_ermes, <span class="stringliteral">&quot;The minimum TR is %-d ms&quot;</span>, EM_PSD_TR_OUT_OF_RANGE, EE_ARGS(1), INT_ARG, (avmintr / 1ms));</div><div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;    <span class="keywordflow">return</span> ADVISORY_FAILURE;</div><div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;  }</div><div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;  <span class="keywordflow">if</span> ((exist(opte) &lt; avminte) &amp;&amp; existcv(opte)) {</div><div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;    epic_error(use_ermes, <span class="stringliteral">&quot;The minimum TE is %-d ms&quot;</span>, EM_PSD_TE_OUT_OF_RANGE1, 1, INT_ARG, (avminte / 1ms));</div><div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;    <span class="keywordflow">return</span> ADVISORY_FAILURE;</div><div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;  }</div><div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;  <span class="keywordflow">if</span> ((exist(opte) &gt; avmaxte) &amp;&amp; existcv(opte)) {</div><div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;    epic_error(use_ermes, <span class="stringliteral">&quot;The maximum TE is %-d ms&quot;</span>, EM_PSD_TE_OUT_OF_RANGE1, 1, INT_ARG, (avmaxte / 1ms));</div><div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;    <span class="keywordflow">return</span> ADVISORY_FAILURE;</div><div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;  }</div><div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;</div><div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;  <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;</div><div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;} <span class="comment">/* GEReq_cvcheck() */</span></div></div><!-- fragment -->
</div>
</div>
<a id="a994265c9b567cd3c6e5da34ad737dd4b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a994265c9b567cd3c6e5da34ad737dd4b">&#9670;&nbsp;</a></span>GEReq_predownload()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATUS GEReq_predownload </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Helper function to be called at the beginning of <a class="el" href="ksepi_8e.html#a6dab68043b9947b6a659f72613c083ec">predownload()</a></h4>
</p>
<p>In the beginning of <code><a class="el" href="ksepi_8e.html#a6dab68043b9947b6a659f72613c083ec">predownload()</a></code> the following lines should be added: </p><div class="fragment"><div class="line">STATUS status = <a class="code" href="_g_e_required_8e.html#a994265c9b567cd3c6e5da34ad737dd4b">GEReq_predownload</a>();</div><div class="line"><span class="keywordflow">if</span> (status != SUCCESS) <span class="keywordflow">return</span> status;</div></div><!-- fragment --><p>This function up various global GE stuff related to recon and data filters. Also, <code>ks_sarcheckdone</code> is checked to make sure that <a class="el" href="_g_e_required_8e.html#a789f2b2ac7ec21daa6a693820873e64a" title="Checks that sequence modules sum up to TR, honoring SAR/heating limits">GEReq_eval_checkTR_SAR_calcs()</a> has been called to monitor SAR/heating limits.</p>
<p>It is important that an error returned from <a class="el" href="_g_e_required_8e.html#a994265c9b567cd3c6e5da34ad737dd4b" title="Helper function to be called at the beginning of predownload()">GEReq_predownload()</a> also results in an error in <code><a class="el" href="ksepi_8e.html#a6dab68043b9947b6a659f72613c083ec">predownload()</a></code>, otherwise it will not show up in the UI.</p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">STATUS</td><td><code>SUCCESS</code> or <code>FAILURE</code> </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;                               {</div><div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;</div><div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;  {</div><div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;  }</div><div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;</div><div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;  nex = ceil(opnex); <span class="comment">/* nex is used in rheaderinit instead of opnex, so must set it here. otherwise prescan fails */</span></div><div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;</div><div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;  <span class="comment">/* UsePgenOnHost() (Imakefile) likes calling calcPulseParams() at this spot, containing &quot;predownload.in&quot; */</span></div><div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;  <a class="code" href="_g_e_required_8e.html#a9b2fe5b383ca739e400124ee465fa26e">calcPulseParams</a>();</div><div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;</div><div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160; {</div><div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;  }</div><div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;</div><div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;  <span class="comment">/* Set rhkacq_uid for ARC support and linking plots */</span></div><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;  <span class="keywordtype">int</span> uid;</div><div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;  <span class="keyword">struct </span>tm now;</div><div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;  time_t now_epoch = time(NULL);</div><div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;  <span class="comment">/* Generate unique ID for this scan for naming kacq files and</span></div><div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;<span class="comment">     debug files.  Use the current date and time (MMDDHHMMSS).</span></div><div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;<span class="comment">     Cannot include the year because this is larger than a</span></div><div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;<span class="comment">     signed 32-bit integer */</span></div><div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;  localtime_r(&amp;now_epoch, &amp;now);</div><div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;  uid = now.tm_sec +</div><div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;        now.tm_min  * 100 +</div><div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;        now.tm_hour * 10000 +</div><div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;        now.tm_mday * 1000000 +</div><div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;        (now.tm_mon + 1) * 100000000;</div><div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;  <a class="code" href="_k_s_foundation__common_8c.html#a2e788c6338615164f241b755f219c961">rhkacq_uid</a> = uid;</div><div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;</div><div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;</div><div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160; <span class="comment">/* Check that SAR calculations have been performed */</span></div><div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="_g_e_required_8e.html#ac2a9639645541b0daab96065b217062d">ks_sarcheckdone</a> != TRUE) {</div><div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;<span class="preprocessor">#ifdef SIM</span></div><div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;    <span class="keywordflow">if</span> (existcv(optr) == TRUE &amp;&amp; existcv(opte) == TRUE &amp;&amp; existcv(opslquant) == TRUE) {</div><div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;      <span class="comment">/* In simulation (WTools), predownload is called every time a CV is changed but</span></div><div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;<span class="comment">      ks_sarcheckdone will not be set to TRUE in GEReq_eval_checkTR_SAR_calcs() unless</span></div><div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;<span class="comment">      optr, opte and opslquant have all been set (existcv() != FALSE). Hence, in simulation,</span></div><div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;<span class="comment">      we cannot throw an error before these have been set */</span></div><div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: Missing call to GEReq_eval_checkTR_SAR()&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;    }</div><div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a>(<span class="stringliteral">&quot;%s: Missing call to GEReq_eval_checkTR_SAR()&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;  }</div><div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;</div><div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160; <span class="keywordflow">return</span> SUCCESS;</div><div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;</div><div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;} <span class="comment">/* GEReq_predownload() */</span></div><div class="ttc" id="_k_s_foundation__common_8c_html_a2e788c6338615164f241b755f219c961"><div class="ttname"><a href="_k_s_foundation__common_8c.html#a2e788c6338615164f241b755f219c961">rhkacq_uid</a></div><div class="ttdeci">int rhkacq_uid</div></div>
<div class="ttc" id="_k_s_foundation_8h_html_ab08efc665b1013671852ab756840e1a5"><div class="ttname"><a href="_k_s_foundation_8h.html#ab08efc665b1013671852ab756840e1a5">ks_error</a></div><div class="ttdeci">STATUS ks_error(const char *format,...) __attribute__((format(printf</div><div class="ttdoc">Common error message function for HOST and TGT</div></div>
<div class="ttc" id="_g_e_required_8e_html_a9b2fe5b383ca739e400124ee465fa26e"><div class="ttname"><a href="_g_e_required_8e.html#a9b2fe5b383ca739e400124ee465fa26e">calcPulseParams</a></div><div class="ttdeci">ifndef EPIC_RELEASE_IS_25x ifndef EPIC_RELEASE_IS_24x endif endif STATUS calcPulseParams(void)</div><div class="ttdoc">Mandatory GE function. Includes predownload.in</div><div class="ttdef"><b>Definition:</b> GERequired.e:278</div></div>
<div class="ttc" id="_g_e_required_8e_html_ac2a9639645541b0daab96065b217062d"><div class="ttname"><a href="_g_e_required_8e.html#ac2a9639645541b0daab96065b217062d">ks_sarcheckdone</a></div><div class="ttdeci">int ks_sarcheckdone</div><div class="ttdef"><b>Definition:</b> GERequired.e:216</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4d749446ac125194ceedcf63f9e10d57"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4d749446ac125194ceedcf63f9e10d57">&#9670;&nbsp;</a></span>GEReq_pulsegenBegin()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GEReq_pulsegenBegin </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Helper function to be called at the beginning of <a class="el" href="ksepi_8e.html#a9229731c099971b90dbf7721bad586a9">pulsegen()</a></h4>
</p>
<p>In the beginning of <code><a class="el" href="ksepi_8e.html#a9229731c099971b90dbf7721bad586a9">pulsegen()</a></code> the following lines should be added: </p><div class="fragment"><div class="line"><a class="code" href="_g_e_required_8e.html#a4d749446ac125194ceedcf63f9e10d57">GEReq_pulsegenBegin</a>();</div></div><!-- fragment --><p>This function up various global GE stuff related to <a class="el" href="ksepi_8e.html#a9229731c099971b90dbf7721bad586a9">pulsegen()</a> </p>
<div class="fragment"><div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;                               {</div><div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;</div><div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;  sspinit(psd_board_type);</div><div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;</div><div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;  {</div><div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;  }</div><div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;} <span class="comment">/* GEReq_pulsegenBegin() */</span></div></div><!-- fragment -->
</div>
</div>
<a id="a9de74bec730c62cf3047e59473b86eec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9de74bec730c62cf3047e59473b86eec">&#9670;&nbsp;</a></span>GEReq_pulsegenEnd()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GEReq_pulsegenEnd </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Helper function to be called at the end of <a class="el" href="ksepi_8e.html#a9229731c099971b90dbf7721bad586a9">pulsegen()</a></h4>
</p>
<p>In the end of <code><a class="el" href="ksepi_8e.html#a9229731c099971b90dbf7721bad586a9">pulsegen()</a></code>, but before <code>buildinstr()</code>, the following lines should be added: </p><div class="fragment"><div class="line"><a class="code" href="_g_e_required_8e.html#a9de74bec730c62cf3047e59473b86eec">GEReq_pulsegenEnd</a>();</div></div><!-- fragment --><p>This function up prescan pulsegen and adds a PASSPACK sequence ("GEendpass"), which is used to dump rawdata and mark the end of scan. See <a class="el" href="_g_e_required_8e.html#a7d88db21119d2904e811676cff0a49a5" title="Sets SSP word in sequence off_GEpass() to trigger data (Pfile) writing and reconstruction">GEReq_endofpass()</a> and <a class="el" href="_g_e_required_8e.html#a349421a095321de0c03b689de1802bce" title="Sets SSP word in sequence off_GEpass() to tell system that scan is done">GEReq_endofscan()</a> and how they are used in a psd. </p>
<div class="fragment"><div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;                             {</div><div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;</div><div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;  {</div><div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;  }</div><div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;</div><div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;<span class="comment">/* pass sequence to dump Pfiles */</span></div><div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;PASSPACK(GEendpass, <a class="code" href="_g_e_required_8e.html#a7efee96b237a605f9af1bbf8a6245451">pw_passpacket</a>-1ms);</div><div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;SEQLENGTH(GEpass, <a class="code" href="_g_e_required_8e.html#a7efee96b237a605f9af1bbf8a6245451">pw_passpacket</a>, GEpass);</div><div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;</div><div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;} <span class="comment">/* GEReq_pulsegenEnd() */</span></div><div class="ttc" id="_g_e_required_8e_html_a7efee96b237a605f9af1bbf8a6245451"><div class="ttname"><a href="_g_e_required_8e.html#a7efee96b237a605f9af1bbf8a6245451">pw_passpacket</a></div><div class="ttdeci">int pw_passpacket</div><div class="ttdef"><b>Definition:</b> GERequired.e:235</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7d88db21119d2904e811676cff0a49a5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7d88db21119d2904e811676cff0a49a5">&#9670;&nbsp;</a></span>GEReq_endofpass()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GEReq_endofpass </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets SSP word in sequence off_GEpass() to trigger data (Pfile) writing and reconstruction</h4>
</p>
<p>After calling this function, the parent function must switch back to the previous/main sequence using <a class="el" href="_k_s_foundation_8h.html#a02e188307a4bd9dfdb00d37688c0487e">ks_scan_playsequence()</a> (or <em><a class="el" href="_k_s_foundation__tgt_8c.html#a17778e7ed4abcb39ee14e9e4d2966b18">boffset()</a></em>). </p>
<div class="fragment"><div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;                       {</div><div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;  <a class="code" href="_k_s_foundation__tgt_8c.html#a17778e7ed4abcb39ee14e9e4d2966b18">boffset</a>(off_GEpass);</div><div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;  setwamp(SSPD + DABPASS, &amp;GEendpass, 2 ); <span class="comment">/* end of pass */</span></div><div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;  <a class="code" href="_k_s_foundation__tgt_8c.html#a7a93838e7d53ff7ec9fbe98843181d03">startseq</a>(0, (<span class="keywordtype">short</span>) MAY_PAUSE);</div><div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;} <span class="comment">/* GEReq_endofpass() */</span></div><div class="ttc" id="_k_s_foundation__tgt_8c_html_a7a93838e7d53ff7ec9fbe98843181d03"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a7a93838e7d53ff7ec9fbe98843181d03">startseq</a></div><div class="ttdeci">STATUS startseq(s16, s16)</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a17778e7ed4abcb39ee14e9e4d2966b18"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a17778e7ed4abcb39ee14e9e4d2966b18">boffset</a></div><div class="ttdeci">STATUS boffset(long *offsets)</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a349421a095321de0c03b689de1802bce"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a349421a095321de0c03b689de1802bce">&#9670;&nbsp;</a></span>GEReq_endofscan()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GEReq_endofscan </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets SSP word in sequence off_GEpass() to tell system that scan is done</h4>
</p>
<div class="fragment"><div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;                       {</div><div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;<span class="preprocessor">#ifdef IPG</span></div><div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;  <a class="code" href="_k_s_foundation__tgt_8c.html#a17778e7ed4abcb39ee14e9e4d2966b18">boffset</a>(off_GEpass);</div><div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;  setwamp(SSPD + DABSCAN, &amp;GEendpass, 2 ); <span class="comment">/* end of scan */</span></div><div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;  <a class="code" href="_k_s_foundation__tgt_8c.html#a7a93838e7d53ff7ec9fbe98843181d03">startseq</a>(0, (<span class="keywordtype">short</span>) MAY_PAUSE);</div><div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;} <span class="comment">/* GEReq_endofscan() */</span></div><div class="ttc" id="_k_s_foundation__tgt_8c_html_a7a93838e7d53ff7ec9fbe98843181d03"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a7a93838e7d53ff7ec9fbe98843181d03">startseq</a></div><div class="ttdeci">STATUS startseq(s16, s16)</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a17778e7ed4abcb39ee14e9e4d2966b18"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a17778e7ed4abcb39ee14e9e4d2966b18">boffset</a></div><div class="ttdeci">STATUS boffset(long *offsets)</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a37f5e1924c7f2d89e8232d8d8d03bca6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a37f5e1924c7f2d89e8232d8d8d03bca6">&#9670;&nbsp;</a></span>GEReq_endofpassandscan()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GEReq_endofpassandscan </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Sets SSP word in sequence off_GEpass() to tell system that scan is done</h4>
</p>
<div class="fragment"><div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;                              {</div><div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;<span class="preprocessor">  #ifdef IPG</span></div><div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;    <a class="code" href="_k_s_foundation__tgt_8c.html#a17778e7ed4abcb39ee14e9e4d2966b18">boffset</a>(off_GEpass);</div><div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;    setwamp(SSPD + DABPASS + DABSCAN, &amp;GEendpass, 2 ); <span class="comment">/* end of scan */</span></div><div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;    <a class="code" href="_k_s_foundation__tgt_8c.html#a7a93838e7d53ff7ec9fbe98843181d03">startseq</a>(0, (<span class="keywordtype">short</span>) MAY_PAUSE);</div><div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;<span class="preprocessor">  #endif</span></div><div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;  } <span class="comment">/* GEReq_endofscan() */</span></div><div class="ttc" id="_k_s_foundation__tgt_8c_html_a7a93838e7d53ff7ec9fbe98843181d03"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a7a93838e7d53ff7ec9fbe98843181d03">startseq</a></div><div class="ttdeci">STATUS startseq(s16, s16)</div></div>
<div class="ttc" id="_k_s_foundation__tgt_8c_html_a17778e7ed4abcb39ee14e9e4d2966b18"><div class="ttname"><a href="_k_s_foundation__tgt_8c.html#a17778e7ed4abcb39ee14e9e4d2966b18">boffset</a></div><div class="ttdeci">STATUS boffset(long *offsets)</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a942c05b8388a80f047a275b6011efc4c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a942c05b8388a80f047a275b6011efc4c">&#9670;&nbsp;</a></span>dummylinks()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dummylinks </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>Not sure what this function does, but it exists in all product psds.</h4>
</p>
<div class="fragment"><div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;                      {</div><div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;  epic_loadcvs( <span class="stringliteral">&quot;thefile&quot;</span> ); <span class="comment">/* for downloading CVs */</span></div><div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="ad56ed68dab054734d4e258fc33a45b71"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad56ed68dab054734d4e258fc33a45b71">&#9670;&nbsp;</a></span>GEReq_initRSP()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GEReq_initRSP </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><h4>RSP Init. To be inserted in the psdinit() function (or <a class="el" href="ksepi_8e.html#a1669428052472d00b1c55a1291f8032f">scan()</a>) in the main sequence</h4>
</p>
<div class="fragment"><div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;                         {</div><div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;</div><div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;  <span class="comment">/* Initialize everything to a known state */</span></div><div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;  setrfconfig((<span class="keywordtype">short</span>) <a class="code" href="_g_e_required_8e.html#ad5a93fbe6bb94b609d6d915d2c0247f7">ks_rfconf</a>);   <span class="comment">/* ENBL_RHO1 + ENBL_THETA + ENBL_OMEGA + ENBL_OMEGA_FREQ_XTR1 = 141 */</span></div><div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;  rspqueueinit(200);  <span class="comment">/* Initialize to 200 entries */</span></div><div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;  syncoff(&amp;GEpass);   <span class="comment">/* Deactivate sync during pass */</span></div><div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;}</div><div class="ttc" id="_g_e_required_8e_html_ad5a93fbe6bb94b609d6d915d2c0247f7"><div class="ttname"><a href="_g_e_required_8e.html#ad5a93fbe6bb94b609d6d915d2c0247f7">ks_rfconf</a></div><div class="ttdeci">int ks_rfconf</div><div class="ttdef"><b>Definition:</b> GERequired.e:237</div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a6d5abc89b8bf79b4dcf745936944adcc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6d5abc89b8bf79b4dcf745936944adcc">&#9670;&nbsp;</a></span>rfpulseInfo</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">RF_PULSE_INFO rfpulseInfo[RF_FREE] = { {0, 0} }</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="aab3baee33eebda2bcf24b20846ce32a9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aab3baee33eebda2bcf24b20846ce32a9">&#9670;&nbsp;</a></span>avail_image_time</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int avail_image_time</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a16ede8dd5ed24fd803dc270aa22e57c5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a16ede8dd5ed24fd803dc270aa22e57c5">&#9670;&nbsp;</a></span>act_tr</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int act_tr</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="aedd5d7c8a00be480230531f3ab5f8bdb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aedd5d7c8a00be480230531f3ab5f8bdb">&#9670;&nbsp;</a></span>ks_scan_info</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SCAN_INFO ks_scan_info[SLTAB_MAX] = {<a class="el" href="_g_e_required_8e.html#a4c590873e5778394b3d52c4225250863">DEFAULT_AXIAL_SCAN_INFO</a>}</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ae6527c3b5637d870c648a7703c202985"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae6527c3b5637d870c648a7703c202985">&#9670;&nbsp;</a></span>ks_slice_plan</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_k_s___s_l_i_c_e___p_l_a_n.html">KS_SLICE_PLAN</a> ks_slice_plan = <a class="el" href="_k_s_foundation_8h.html#a46bcd22394cbabe45e76cc0d4af01aa9">KS_INIT_SLICEPLAN</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ac2a9639645541b0daab96065b217062d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac2a9639645541b0daab96065b217062d">&#9670;&nbsp;</a></span>ks_sarcheckdone</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_sarcheckdone = FALSE</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="af846b49be109f687e9863f2016029516"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af846b49be109f687e9863f2016029516">&#9670;&nbsp;</a></span>ks_psdname</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char ks_psdname[256]</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="aece7287cee904292d20da04682670ccc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aece7287cee904292d20da04682670ccc">&#9670;&nbsp;</a></span>ks_perform_slicetimeplot</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_perform_slicetimeplot = FALSE</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a9e27acda2e5cc865747fa56d03d8f093"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9e27acda2e5cc865747fa56d03d8f093">&#9670;&nbsp;</a></span>obl_debug</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int obl_debug = 0 with {0, 1, 0, INVIS, &quot;On(=1) to print messages for obloptimize&quot;,}</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a94b591f7f68b50312c2701df4d04b081"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a94b591f7f68b50312c2701df4d04b081">&#9670;&nbsp;</a></span>obl_method</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int obl_method = PSD_OBL_OPTIMAL with {PSD_OBL_RESTRICT, PSD_OBL_OPTIMAL, PSD_OBL_OPTIMAL, INVIS, &quot;On(=1) to optimize the targets based on actual rotation matrices&quot;,}</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="acfc18720dc0665e3e655b44e43c77b0f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acfc18720dc0665e3e655b44e43c77b0f">&#9670;&nbsp;</a></span>filter_echo1</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int filter_echo1 = 0 with {, , , INVIS, &quot;Scan filter slot number needed for prescan&quot;,}</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a7efee96b237a605f9af1bbf8a6245451"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7efee96b237a605f9af1bbf8a6245451">&#9670;&nbsp;</a></span>pw_passpacket</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int pw_passpacket = 50ms with {10ms, 1000ms, 50ms, VIS, &quot;Duration of the passpacket sequence&quot;,}</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ad5a93fbe6bb94b609d6d915d2c0247f7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad5a93fbe6bb94b609d6d915d2c0247f7">&#9670;&nbsp;</a></span>ks_rfconf</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_rfconf = ENBL_RHO1 + ENBL_THETA + ENBL_OMEGA + ENBL_OMEGA_FREQ_XTR1</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a01c4c91785086ec18a8fc39595e22f0d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a01c4c91785086ec18a8fc39595e22f0d">&#9670;&nbsp;</a></span>ks_simscan</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_simscan = 1 with {0, 1, 1, VIS, &quot;Simulate slice locations if 1 (and in simulation)&quot;,}</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ac2162634eabe08843c90d8cf8a135042"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac2162634eabe08843c90d8cf8a135042">&#9670;&nbsp;</a></span>ks_srfact</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_srfact = 1.0 with {0.01, 3.0, 1.0, VIS, &quot;Slewrate factor (low value = slower gradients)&quot;,}</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a7506e6224f5036fb1941843536b6f4a6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7506e6224f5036fb1941843536b6f4a6">&#9670;&nbsp;</a></span>ks_qfact</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_qfact = 1.0 with {0.1, 40.0, 1.0, VIS, &quot;Quietness factor&quot;,}</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a7ca8f149618c5cab125f422cd627c433"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7ca8f149618c5cab125f422cd627c433">&#9670;&nbsp;</a></span>ks_gheatfact</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ks_gheatfact = 1.0 with {0.0, 1.0, 1.0, VIS, &quot;Degree of honoring gradient heating calculations (0:ignore, 1:fully obey)&quot;}</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="adf724d7e25607bea3d8bf36bb6f8060d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adf724d7e25607bea3d8bf36bb6f8060d">&#9670;&nbsp;</a></span>ks_plot_filefmt</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_plot_filefmt = <a class="el" href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5fae199cefaae88fb3ffc5eee3109bbe3d7">KS_PLOT_MAKEPNG</a> with {<a class="el" href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5fadd75ba7d05d9527ea99f8643787d46ac">KS_PLOT_OFF</a>,<a class="el" href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5fae199cefaae88fb3ffc5eee3109bbe3d7">KS_PLOT_MAKEPNG</a>,<a class="el" href="_k_s_foundation_8h.html#a0af3c4f49a609b3bc02c7be25b9c7c5fae199cefaae88fb3ffc5eee3109bbe3d7">KS_PLOT_MAKEPNG</a>, VIS, &quot;Plot format 0:off 1:PDF 2:SVG 3:PNG&quot;}</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ad3bedeb2f38e3e2bcce90c31354a91d6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad3bedeb2f38e3e2bcce90c31354a91d6">&#9670;&nbsp;</a></span>ks_plot_kstmp</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ks_plot_kstmp = FALSE with {FALSE,TRUE,FALSE, VIS, &quot;0: off 1:Copy plots to mrraw/kstmp&quot;}</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a5dfe9b1d5c3f79c53ef1e8513159ce18"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5dfe9b1d5c3f79c53ef1e8513159ce18">&#9670;&nbsp;</a></span>maxB1</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float maxB1[<a class="el" href="_g_e_required_8e.html#a43ed1aedaae548fba169071b1c911983">MAX_ENTRY_POINTS</a>]</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a9b1fc3ed469d5e2aaf046d9e17d72734"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9b1fc3ed469d5e2aaf046d9e17d72734">&#9670;&nbsp;</a></span>maxB1Seq</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float maxB1Seq</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a546f02bf651781d02eea564390dfbd28"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a546f02bf651781d02eea564390dfbd28">&#9670;&nbsp;</a></span>debugstate</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">short debugstate</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a61baa55d5fb7d85e3ce00c63a279741d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a61baa55d5fb7d85e3ce00c63a279741d">&#9670;&nbsp;</a></span>viewtable</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">short viewtable[513]</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ae24c5d48aac45ac963ee37a5e9c51f08"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae24c5d48aac45ac963ee37a5e9c51f08">&#9670;&nbsp;</a></span>psdexitarg</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PSD_EXIT_ARG psdexitarg</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="adbed7cbe302ef957a49dead6990d286f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adbed7cbe302ef957a49dead6990d286f">&#9670;&nbsp;</a></span>rspent</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rspent</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a8eb9f37d56ba1ee0e7d05fdb45ee2eec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8eb9f37d56ba1ee0e7d05fdb45ee2eec">&#9670;&nbsp;</a></span>rspdda</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rspdda</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="acf2311e6e88cda04fe6cbccd5b111251"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acf2311e6e88cda04fe6cbccd5b111251">&#9670;&nbsp;</a></span>rspbas</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rspbas</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a6dfbf5d299a2ad43ca362ba50ee04009"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6dfbf5d299a2ad43ca362ba50ee04009">&#9670;&nbsp;</a></span>rspvus</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rspvus</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a78783810e215eb88373e39826c8fbcdf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a78783810e215eb88373e39826c8fbcdf">&#9670;&nbsp;</a></span>rspgy1</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rspgy1</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a68f63429e4ed34d99e869e97784395a2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a68f63429e4ed34d99e869e97784395a2">&#9670;&nbsp;</a></span>rspasl</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rspasl</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a7e34e1f01390e268d94098834bc92665"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7e34e1f01390e268d94098834bc92665">&#9670;&nbsp;</a></span>rspesl</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rspesl</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a59a6767a101d64662267c1c97abcb45f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a59a6767a101d64662267c1c97abcb45f">&#9670;&nbsp;</a></span>rspchp</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rspchp</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a3ed03b6597358f5effb634c614bfdb64"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3ed03b6597358f5effb634c614bfdb64">&#9670;&nbsp;</a></span>rspnex</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rspnex</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a6b066a985730eb2ab973c6e41f1c1980"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6b066a985730eb2ab973c6e41f1c1980">&#9670;&nbsp;</a></span>rspslq</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rspslq</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ac200bf912818c3a16c89b0fb4afdeacb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac200bf912818c3a16c89b0fb4afdeacb">&#9670;&nbsp;</a></span>rspsct</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rspsct</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a47b4e2484af16aab79c3eed3ab8eaece"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a47b4e2484af16aab79c3eed3ab8eaece">&#9670;&nbsp;</a></span>rsprep</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rsprep</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="aa2e40d6d2214b308eaf81d7253a54150"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa2e40d6d2214b308eaf81d7253a54150">&#9670;&nbsp;</a></span>chopamp</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">short chopamp</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a5b178b120a91fef15ac5ee30dd89577f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5b178b120a91fef15ac5ee30dd89577f">&#9670;&nbsp;</a></span>seqCount</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int seqCount</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a1cb6f035a0e9565bbf12c3ef04c3c229"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1cb6f035a0e9565bbf12c3ef04c3c229">&#9670;&nbsp;</a></span>view</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int view</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ad96345992234a045c9b3cdff8432f94c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad96345992234a045c9b3cdff8432f94c">&#9670;&nbsp;</a></span>excitation</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int excitation</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ac3e1795766a80ec63b157951b4b9a7d4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac3e1795766a80ec63b157951b4b9a7d4">&#9670;&nbsp;</a></span>debug</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int debug</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a7d63954ff7232fb00cbf2904576cde75"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7d63954ff7232fb00cbf2904576cde75">&#9670;&nbsp;</a></span>entry_name_list</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CHAR* entry_name_list[ENTRY_POINT_MAX]</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div><div class="line">  <span class="stringliteral">&quot;scan&quot;</span>,</div><div class="line">  <span class="stringliteral">&quot;mps2&quot;</span>,</div><div class="line">  <span class="stringliteral">&quot;aps2&quot;</span>,</div><div class="line">}</div></div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_edd0b46848e1966a9ba471eaad9abcfd.html">tmpfiles</a></li><li class="navelem"><a class="el" href="_g_e_required_8e.html">GERequired.e</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
