# Makefile generated by imake - do not edit!
# $Xorg: imake.c,v 1.6 2001/02/09 02:03:15 xorgcvs Exp $

#
#
#

# ====================================================================
#
#  Included macros and rules from <Imake.cf> and <Imake.rules>
#
# ====================================================================

PWD        = /home/weber/psd_ksfoundation/DDE_test3
TOP        = /ESE_RX27.0_R03
OS_NAME    = Linux
OS_RELEASE = 2_6_32__696_16_1_el6_x86_64

SHELL = /bin/sh

BASENAME = /bin/basename
CAT      = /bin/cat
CHMOD    = /bin/chmod
CP       = /bin/cp
CUT      = /usr/bin/cut
DD       = /bin/dd
GREP     = /bin/grep
MV       = /bin/mv
RM       = /bin/rm -f
SED      = /bin/sed
SORT     = /bin/sort
TAIL     = /usr/bin/tail
TAR      = /bin/tar
TOUCH    = /bin/touch

# ====================================================================

#
#
#
#
#
#

# ====================================================================
#
#  Common targets found in all makefiles
#
# ====================================================================

# --------------------------------------------------------------------
#
#  Rule: "CommonTargets()"
#

all:: hw sim

clean::

hw::

hw-ice::

hw-mgd::

install::

sim::

test::

# --------------------------------------------------------------------

# ====================================================================

#
#
#
#
#
#

# ====================================================================
#
#  Beginning of included template file: "EPIC.tmpl"
#
# ====================================================================

#
# These are parameter definitions common to all users who use the
#    Epic and Epic+ preprocessors.
#

CREATE_HOSTDECL_DEFS    = $(TOP)/psd/bin/createHostdeclDefs
CREATE_CNV_ENDIAN_INPUT = $(TOP)/psd/bin/createCnvEndianInput
EC                      = $(TOP)/psd/bin/ec
EP_PROCESS              = $(TOP)/psd/bin/processefile
EP_MERGE                = $(TOP)/psd/bin/mergehfiles
EP_BRT                  = $(TOP)/psd/bin/buildruntime
EP_CONTIG               = $(TOP)/psd/bin/contigCVs
EP_LINK                 = $(TOP)/psd/bin/createEpicPlusLinks

ENDIAN_CONVERTER =     $(TOP)/3p/endian_converter/endian_converter

# Locking flag to modify CVs.
# Use -DMCVALL to allow all CVs to be modified.
M_CVS =

#
# These are endian conversion definitions
# The idea is to pass to the endian-converter, the same flags as the
# host-hardware PSD.
#

ENDIAN_CONVERTER_FLAGS =     -m32     $(M_CVS)     -DHOST_TGT     -DMGD_IF     -DLX_ENBLpopup     -DPSD_HW

ENDIAN_EFLAG =

ENDIAN_EPFLAG =     -DEXTERN=extern

#
# End common Epic/Epic+ parameter definitions.
#

CNV_ENDIAN_FILES = $(PSD).cnvendian.input.c \
                   $(PSD).cnvendian.input.i \
                   $(PSD).cnvendian.private.h \
                   $(PSD).cnvendian.globalvar.h \
                   $(PSD).cnvendian.c \
                   $(PSD).cnvendian.api.h

# --------------------------------------------------------------------
#
#  Rule: "NoWarnings()"
#
#  This rule is empty for the Epic/Epic+ compilers.  It is only used
#  by the host and target compilers.
#
# --------------------------------------------------------------------

# --------------------------------------------------------------------
#
#  Rule: "StandardSuffixRules()"
#

.SUFFIXES:
.SUFFIXES: .e .epic .epicplus

.e.epic:
	@echo "=========================================================="
	@echo "   Processing $*"
	@echo "=========================================================="

	$(RM) ${@F} $*.host.c $*.host.cpp $*.tgt.c $*.tgt.cpp \
		$*.global.h $*.allcv.h \
		$*.tgtex.h $*.hostdecl.h $*.tgtdecl.h $*.exportstr.h \
		$*.runtime.h $*.ext.h $*.host.map \
		cvinit.in predownload.in

	$(EC) $(PG_FLAG) $(ADD_EFLAGS) $(EPIC_INCLUDES) $<

	$(TOUCH) ${@F}

.e.epicplus:
	@echo "=========================================================="
	@echo "   Processing $*"
	@echo "=========================================================="

	$(RM) ${@F} $*.host.c $*.host.cpp $*.tgt.c $*.tgt.cpp \
	    $*.global.h $*.allcv.h \
		$*.tgtex.h $*.hostdecl.h $*.tgtdecl.h $*.exportstr.h \
		$*.runtime.h $*.host.map \
		cvinit.in predownload.in \
		$*.cvinit.in $*.predownload.in $*.tgt_hdr.h \
		$*.allcv_hwdefs.h $*.allcv_simdefs.h \
		$*.exportstr_hwdefs.h $*.exportstr_simdefs.h \
		$*.tgtdecl_hwdefs.h $*.tgtdecl_simdefs.h \
		$*.tgtex_hwdefs.h $*.tgtex_simdefs.h $*.tgt_hdr.h

	$(RM) -r $(EPDIR)

	$(EP_PROCESS) $(PSD) $* "$(EP_SIMFLAGS) $(EPIC_INCLUDES)" \
	"$(EP_HWFLAGS) $(EPIC_INCLUDES)" \
	"$(PG_FLAG) $(ADD_EPFLAGS) $(EPIC_INCLUDES)"

	$(TOUCH) $(EPDIR)/$*.tgt_hdr.h

	cd $(EPDIR); $(MV) -f $*.allcv_hwdefs.h $*.allcv_simdefs.h \
		$*.exportstr_hwdefs.h $*.exportstr_simdefs.h \
		$*.hostdecl_hwdefs.h $*.hostdecl_simdefs.h \
		$*.tgtdecl_hwdefs.h $*.tgtdecl_simdefs.h \
		$*.tgtex_hwdefs.h $*.tgtex_simdefs.h $*.tgt_hdr.h \
		$(PWD)

	$(RM) cvinit.in predownload.in

	$(RM) -r $(EPDIR)

	$(TOUCH) ${@F}

# --------------------------------------------------------------------

# --------------------------------------------------------------------
#
#  Rule: "CleanRule()"
#
#
#  Epic+ creates an "EPIC+" subdirectory in the current directory.
#     This rule ensures that "EPIC+" will be removed when the "clean"
#     target is invoked.
#

clean::
	$(RM) -r ./EPIC+
	-$(RM) *.epic *.host.c *.host.cpp *.tgt.c *.tgt.cpp \
	    *.global.h *.allcv.h \
		*.tgtex.h *.hostdecl.h *.tgtdecl.h *.exportstr.h \
		*.runtime.h *.ext.h *.host.map \
		cvinit.in predownload.in
	-$(RM) *.epicplus *.cvinit.in *.predownload.in *.tgt_hdr.h \
		*.allcv_hwdefs.h *.allcv_simdefs.h \
		*.exportstr_hwdefs.h *.exportstr_simdefs.h \
		*.hostdecl_hwdefs.h *.hostdecl_simdefs.h \
		*.tgtdecl_hwdefs.h *.tgtdecl_simdefs.h \
		*.tgtex_hwdefs.h *.tgtex_simdefs.h *.tgt_hdr.h

# --------------------------------------------------------------------

# ====================================================================
#
#  End of included template file: "EPIC.tmpl"
#
# ====================================================================

#
#
#
#
#
#

# ====================================================================
#
#  Local Imakefile begins here
#
# ====================================================================

GITREV = 0000aaa
CLINICAL_MODE = 0
-include ../psd_config.mk
-include psd_config.mk

TMP01 = $(patsubst /ESE_HD%_V01,%,        $(TOP))
TMP02 = $(patsubst /ESE_DV%_VO1,%,        $(TMP01))
TMP03 = $(patsubst /ESE_DV%_VO2,%,        $(TMP02))
TMP04 = $(patsubst /ESE_DV%_0_V01,%,      $(TMP03))
TMP05 = $(patsubst /ESE_DV%.0_V01,%,      $(TMP04))
TMP06 = $(patsubst /ESE_DV%_1_V02,%,      $(TMP05))
TMP07 = $(patsubst /ESE_DV%.0_EA,%,       $(TMP06))
TMP08 = $(patsubst /ESE_DV%.0_EB,%,       $(TMP07))
TMP09 = $(patsubst /ESE_DV%.0_R01,%,      $(TMP08))
TMP10 = $(patsubst /ESE_DV%.0_R02,%,      $(TMP09))
TMP11 = $(patsubst /ESE_DV%.1_R01,%,      $(TMP10))
TMP12 = $(patsubst /ESE_DV%.1_R02,%,      $(TMP11))
TMP13 = $(patsubst /ESE_MP%.0_EA,%,       $(TMP12))
TMP14 = $(patsubst /ESE_MP%.0_R01,%,      $(TMP13))
TMP15 = $(patsubst /ESE_MP%.0_R02,%,      $(TMP14))
TMP16 = $(patsubst /ESE_RX%.0_EB,%,       $(TMP15))
TMP17 = $(patsubst /ESE_PX%.1_R01,%,      $(TMP16))
TMP18 = $(patsubst /ESE_RX%.0_R01,%,      $(TMP17))
TMP19 = $(patsubst /ESE_RX%.0_R02,%,      $(TMP18))
RELEASE_NUM = $(patsubst /ESE_RX%.0_R03,%, $(TMP19))

PATCHTMP01 = $(patsubst /ESE_DV24_0_V0%,%, $(TOP))
PATCHTMP02 = $(patsubst /ESE_DV24.0_R0%,%, $(PATCHTMP01))
PATCHTMP03 = $(patsubst /ESE_DV25.0_R0%,%, $(PATCHTMP02))
PATCHTMP04 = $(patsubst /ESE_DV25.1_R0%,%, $(PATCHTMP03))
PATCHTMP05 = $(patsubst /ESE_DV26.0_R0%,%, $(PATCHTMP04))
PATCHTMP06 = $(patsubst /ESE_MP24.0_R0%,%, $(PATCHTMP05))
PATCHTMP07 = $(patsubst /ESE_MP26.0_R0%,%, $(PATCHTMP06))
PATCHTMP08 = $(patsubst /ESE_PX26.1_R0%,%, $(PATCHTMP07))
PATCH_NUM = $(patsubst /ESE_RX27.0_R0%,%,  $(PATCHTMP08))

ifeq ($(TOOLSET), PSD_TGT_ICE)
TGT_DIR = tgt_ice
endif
ifeq ($(TOOLSET), PSD_TGT_MGD)
TGT_DIR = tgt_mgd
endif
ifeq ($(TOOLSET), PSD_TGT_C)
TGT_DIR = tgt
endif

ifndef ENDIAN_CONVERTER
PARENT_DIR = ../..
else
PARENT_DIR = ..
endif

SKIP_BUILD = FALSE

ifeq ($(TOOLSET), PSD_TGT_MGD)
ifeq ($(RELEASE_NUM), 27)

SKIP_BUILD = TRUE

endif
endif

TOOLSET = EPIC

MAKE_TARGET = programs

PSD = ksepi

ADD_INLINE_FILES =

ADD_EFILES =

ADD_CFILES_HOST =

ADD_CFILES_TGT =

ADD_EFLAGS = -z

ADD_E_INCLUDES = -DEPIC_RELEASE_IS_$(RELEASE_NUM)x -I$(PARENT_DIR)/KSFoundation -I$(PARENT_DIR)/ksmodules

ADD_CFLAGS_HH =  -DEPIC_RELEASE=$(RELEASE_NUM) -DEPIC_PATCHNUM=$(PATCH_NUM) -DREV=\"$(GITREV)\" -I$(PARENT_DIR)/KSFoundation

ADD_CFLAGS_HS =  -DEPIC_RELEASE=$(RELEASE_NUM) -DEPIC_PATCHNUM=$(PATCH_NUM) -DREV=\"$(GITREV)\" -I$(PARENT_DIR)/KSFoundation

ADD_CFLAGS_TH =  -DEPIC_RELEASE=$(RELEASE_NUM) -DEPIC_PATCHNUM=$(PATCH_NUM) -DREV=\"$(GITREV)\" -I$(PARENT_DIR)/KSFoundation

ADD_CFLAGS_TS =  -DEPIC_RELEASE=$(RELEASE_NUM) -DEPIC_PATCHNUM=$(PATCH_NUM) -DREV=\"$(GITREV)\" -I$(PARENT_DIR)/KSFoundation

ADD_LINKFLAGS_HH = -L$(PARENT_DIR)/KSFoundation/$(RELEASE_NUM)/host

ADD_LINKFLAGS_HS = -L$(PARENT_DIR)/KSFoundation/$(RELEASE_NUM)/sim_linux

ADD_LINKFLAGS_TH = -L$(PARENT_DIR)/KSFoundation/$(RELEASE_NUM)/$(TGT_DIR)

ADD_LINKFLAGS_TS = -L$(PARENT_DIR)/KSFoundation/$(RELEASE_NUM)/sim_linux

ADD_LIBS_HH = -lKSFoundation_hh

ADD_LIBS_HS = -lKSFoundation_hs

ADD_LIBS_TH = -lKSFoundation_th

ADD_LIBS_TS = -lKSFoundation_ts

# --------------------------------------------------------------------
#
#  Rule: "UsePgenOnHost()"
#
#  This rule sets an Epic compiler flag to activate the Pulsegen on
#  the Host feature.  Basically, the Epic preprocessor will put the
#  contents of the @pg section in both the Host and Tgt C sources.
#

PG_FLAG = -P

# --------------------------------------------------------------------

# --------------------------------------------------------------------
#
#  Rule: "PsdParameters()"
#
#

#
#  Rule: "EpicParameters1()"
#

hw-mgd:: hw

hw-ice:: hw

DIR_CVCONST_INCLUDE = $(TOP)/psd/include/private

DIR_EP_FEATURES_INCLUDE = $(TOP)/psd/epicplus_features

EPIC_INCLUDES = \
    $(ADD_E_INCLUDES) \
    -I. \
    -I$(TOP)/psd/include \
    -I$(TOP)/psd/include/private \
    -I$(TOP)/psd/include/private/support \
    -I$(TOP)/psd/psdsource \
    -I$(TOP)/lx/em/include \
    -I$(TOP)/lx/include \
    -I$(TOP)/host/foundation-libs/CnvEndianLib/host_static \
    -I$(TOP)/host/include \
    -I$(TOP)/mgd/include \
    -I$(TOP)/vre/support

EP_SIMFLAGS = \
    -DHOST_IO \
    -DINIT \
    -DEXTERN= \
    -DINC4CPP \
    $(M_CVS)

EP_HWFLAGS = $(EP_SIMFLAGS)

EPDIR = ./EPIC+

#
#  Rule: "EpicParameters2()"
#

MERGE_FLAG = 1

# --------------------------------------------------------------------

ifeq ($(SKIP_BUILD), FALSE)

# --------------------------------------------------------------------
#
#  Rule: "BuildingEpicPsd()"
#
#

#
#  Rule: "EpicMakeTargets()"
#

hw sim $(MAKE_TARGET):: $(PSD).epic

#
#  Rule: "EpicCvCopy()"
#

hw $(MAKE_TARGET):: $(PSD).cnvendian.c
hw sim $(MAKE_TARGET):: $(PSD).cvcopy.cpp

$(PSD).cvcopy.cpp: $(PSD).epic $(PSD).allcv.h $(PSD).tgtex.h

	@echo "=========================================================="
	@echo "   Generating cvcopy functions"
	@echo "=========================================================="

	$(RM) $@

	$(EP_CONTIG) $(PSD) $@ $(PSD).allcv.h $(PSD).tgtex.h

$(PSD).cnvendian.c: $(PSD).epic $(PSD).global.h $(PSD).allcv.h \
	$(PSD).tgtex.h

	@echo "=========================================================="
	@echo "   Generating CV endian conversion code"
	@echo "=========================================================="

	$(RM) $(CNV_ENDIAN_FILES)

	$(CREATE_CNV_ENDIAN_INPUT) $(PSD).cnvendian.input.c \
		$(PSD).global.h $(PSD).allcv.h $(PSD).tgtex.h

	$(ENDIAN_CONVERTER) -i $(PSD).cnvendian.input.c -h $(PSD).cnvendian.private.h -ha $(PSD).cnvendian.api.h -hg $(PSD).cnvendian.globalvar.h -o $(PSD).cnvendian.c $(EPIC_INCLUDES) $(ENDIAN_CONVERTER_FLAGS) $(ENDIAN_EFLAG) -pre cv_cnv_endian_ -no_inc

clean::
	$(RM) $(CNV_ENDIAN_FILES) $(PSD).cvcopy.cpp $(PSD).cvcopy.c

# --------------------------------------------------------------------
endif

CFLAGS2_HS += -O0 -Wno-float-equal
CFLAGS2_HH += -O0 -Wno-float-equal
CFLAGS2_TS += -O0 -Wno-float-equal
CFLAGS2_TH += -O0 -Wno-float-equal

# ====================================================================

#
#
#
#
#
#

# ====================================================================
#
#  This dependency line is found in all makefiles.  $(MAKE_TARGET)
#     should be defined in the local Imakefile.
#
# ====================================================================

all $(MAKE_TARGET):: $(ALL_OBJS)

# ====================================================================

